<!DOCTYPE html>
<html>

<head>

<meta charset="utf-8">
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<meta name="viewport" content="width=device-width, height=device-height, maximum-scale=1, user-scalable=no" />
<meta name="apple-mobile-web-app-capable" content="yes" />

<link rel="stylesheet" href="html-tools.css" />

<title>VPL Tools</title>

<style>
td {
	padding: 0.5ex;
}
</style>

<script src="../vpl/thymio/thymio.js"></script>
<script src="ns.js"></script>
<script src="util-url.js"></script>
<script src="../client.js"></script>
<script src="students.js"></script>

<script>

function clearTable(id, labels) {
	var table = document.getElementById(id);
	while (table.firstElementChild) {
		table.removeChild(table.firstElementChild);
	}
	if (labels) {
		var tr = document.createElement("tr");
		labels.forEach(function (label) {
			var th = document.createElement("th");
			th.textContent = label;
			tr.appendChild(th);
		});
		table.appendChild(tr);
	}
}

function fillStudentTable(studentArray, students) {
	clearTable("students");
	var table = document.getElementById("students");

	function addRow(studentName, groupName) {

		function selectRow() {
			students.selectStudent(studentName);
			fillStudentTable(studentArray, students);
		}

		var tr = document.createElement("tr");

		// drag student name
		tr.draggable = true;
		tr.addEventListener("dragstart", function (ev) {
			ev.dataTransfer.setData("text/plain", studentName);
			ev.dataTransfer.setDragImage(tr.getElementsByTagName("td")[0], 0, 0);
			ev.dataTransfer.effectAllowed = "copy";
		});

		var td = document.createElement("td");
		td.textContent = studentName;
		// td.addEventListener("click", selectRow, false);
		td.className = students.isStudentSelected(studentName) ? "rect selected" : "rect";
		tr.appendChild(td);

		td = document.createElement("td");
		var btn = document.createElement("button");
		btn.textContent = "remove";
		btn.addEventListener("click", function () {
			students.removeStudent(studentName);
		}, false);
		td.appendChild(btn);
		tr.appendChild(td);

		table.appendChild(tr);
	}

	studentArray.forEach(function (student) {
		addRow(student.name, student.group);
	});

	// row for adding a new student
	var tr = document.createElement("tr");

	var td = document.createElement("td");
	td.className = "rect";
	var fldStudentName = document.createElement("input");
	var btnAddStudent = document.createElement("button");
	btnAddStudent.disabled = true;
	fldStudentName.addEventListener("input", function () {
		btnAddStudent.disabled = !students.canAddStudent(fldStudentName.value);
	}, false);
	fldStudentName.addEventListener("change", function () {
		students.addStudent(fldStudentName.value);
	}, false);
	td.appendChild(fldStudentName);
	tr.appendChild(td);

	td = document.createElement("td");
	btnAddStudent.textContent = "add";
	btnAddStudent.addEventListener("click", function () {
		students.addStudent(fldStudentName.value);
	}, false);
	td.appendChild(btnAddStudent);
	tr.appendChild(td);

	table.appendChild(tr);

	fldStudentName.select();
	fldStudentName.focus();
}

window.addEventListener("load", function () {
	var students = new VPLTeacherTools.StudentManagement({
		onStudents: function (studentArray, students) {
    		fillStudentTable(studentArray, students);
		},
	});

}, false);

</script>

</head>

<body>

<nav>
<ul>
<li><a class="current" href="students.html">Pupils</a></li>
<li><a href="filebrowser.html">Files</a></li>
<li><a class="disabled" href="#">VPL</a></li>
<li><a class="disabled" href="#">Simulator</a></li>
<li><a href="pairing.html">Classroom setup</a></li>
<li><a href="dashboard.html">Dashboard</a></li>
<li><a href="doc.html">Documentation</a></li>
<li><span class="space"></span></li>
<li><a href="initdb-dev.html">Test data</a></li>
<li><a href="dev.html">Development doc</a></li>
</ul>
</nav>

<main>

<div class="border">

	<h2>Pupils</h2>

	<table id="students">
	</table>

</div>

</main>

</body>

</html>
