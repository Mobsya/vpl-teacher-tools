/* Copyright 2018-2020 ECOLE POLYTECHNIQUE FEDERALE DE LAUSANNE - author Yves Piguet */
(function(){
var w,aa,ca,da;function ea(a,b){this.name=a;this.Sd=b}var fa=[];function ha(){var a=ia;if(a)for(var b=fa.length-1;0<=b;b--)fa[b]instanceof a&&fa.splice(b,1);else fa=[]}ea.prototype.b=function(){throw"not implemented";};ea.prototype.addEventListener=function(){throw"not implemented";};function ia(a,b,c){ea.call(this,a,b);this.url=c}ia.prototype=Object.create(ea.prototype);ia.prototype.constructor=ia;function ja(a,b,c,d){var f=new XMLHttpRequest;f.timeout=5E3;c&&(f.addEventListener("timeout",function(){c(null)}),f.addEventListener("error",function(){c(null)}),f.addEventListener("load",function(){switch(f.status){case 200:c(f.responseText);break;default:c(null)}}));f.open(a,b,!0);f.send(d)}
function ka(a,b){a=a||"";ja("GET",a+"/nodes",function(c){null!==c&&(c=JSON.parse(c),0===c.length?ka(a,b):(ha(),c.forEach(function(b){var c=new ia(b.name,b.aeslId,a+"/nodes/"+b.name,b.protocolVersion);ja("GET",a+"/nodes/"+b.name,function(a){c.description=a?JSON.parse(a):""});fa.push(c)}),b&&b()))})}
function ma(a,b){return"<!DOCTYPE aesl-source>\n<network>\n"+[].map(function(a){return"<event size='"+(a.size||0).toString(10)+"' name='"+a.name+"'/>\n"}).join("")+"<keywords flag='true'/>\n<node nodeId='"+(a.Sd||1).toString(10)+"' name='"+a.name+"'><![CDATA["+b+"]]\x3e</node>\n</network>\n"}ia.prototype.b=function(a){a=ma(this,a);ja("PUT",this.url,void 0,a)};
ia.prototype.addEventListener=function(a,b){a=a.toString();var c=this.url+"/events";a&&(c+="/"+a);c=new EventSource(c);c.onmessage=function(c){b(c.data.split(" ").slice(1).map(function(a){return parseInt(a,10)}),a)};return c};function y(a){this.name=a.name;this.type=a.type;this.la=a.la||["b","a"];this.Fg=a.Fg||!1;this.ga=a.ga||null;this.hb=a.hb||null;this.ve=a.ve||null;this.gf=a.gf||null;this.ke=a.ke||null;this.Ac=a.Ac||null;this.Nb=a.Nb||{aseba:"e"===this.type?function(a){return{Ld:"# onevent "+a.V.name+"\n"}}:function(a){return{ka:"# "+a.V.name+"\n"}}};this.H=a.H||function(a,c){a.text(c.V.name)};this.ae=a.ae||!1;this.$=a.$||null;this.Sa=a.Sa||null;this.Lc=a.Lc||null}var na=[];
function oa(a,b,c,d){for(var f=null;;){var e=/`([^`]*)`/.exec(a);if(null==e)break;f=(new Function("$","i","rgb","toFixed","return "+e[1]+";"))(b,c,function(a){a=[a[0],Math.max(.2+.8*a[1],a[2]/2),a[2]];var b=Math.max(a[0],Math.max(a[1],a[2]));return a.map(function(a){return.88*(1-b)+(.12+.88*b)*a})},function(a,b){return parseFloat(a.toFixed(void 0===b?2:b)).toString()});a=a.slice(0,e.index)+f+a.slice(e.index+e[0].length)}return d?f:a};function z(a,b,c){this.V=a;this.Bb=b;this.oe=c;this.locked=this.disabled=!1;this.g=a.ga?a.ga():null;this.ie=this.b=null}z.prototype.lb=function(a,b,c){a=new z(this.V,a,b);a.disabled=this.disabled;a.b=c;this.g&&(a.g=this.g.slice());return a};function A(a){a.b&&a.b()}z.prototype.h=function(a){return this.disabled?{}:this.V.Nb[a]?this.V.Nb[a](this):pa[a].h(this)};function qa(a,b,c){z.call(this,ra[a],b,c)}qa.prototype=Object.create(z.prototype);qa.prototype.constructor=qa;var ra={e:new y({name:"empty e",type:"e",H:function(a,b,c,d){var f=ua("!empty event");f&&f.H(a,b,c,d)}}),a:new y({name:"empty a",type:"a",H:function(a,b,c,d){var f=ua("!empty action");f&&f.H(a,b,c,d)}}),s:new y({name:"empty s",type:"s",H:function(a,b,c,d){var f=ua("!empty state")||ua("!empty event");f&&f.H(a,b,c,d)}})};qa.prototype.h=function(){return{}};function wa(){this.U=[];this.actions=[];this.error=null;this.locked=this.disabled=!1}wa.prototype.lb=function(){for(var a=new wa,b=0;b<this.U.length;b++)xa(a,this.U[b],null,null);for(b=0;b<this.actions.length;b++)xa(a,this.actions[b],null,null);return a};wa.prototype.Ob=function(){return 0===this.U.length&&0===this.actions.length};function ya(a){for(var b=0;b<a.U.length;b++)if("init"===a.U[b].V.name)return a.U[b];return null}
function xa(a,b,c,d,f){if(b){switch(b.V.type){case "e":case "s":if(b.Bb===a)c&&(a.U.splice(b.oe.index,1),f?b.b=d:b=b.lb(a,c,d),a.U.splice(c.index,0,b));else if(c){if(a.U[c.index]===b)return;f?b.b=d:b=b.lb(a,c,d);a.U[c.index]=b}else f?b.b=d:b=b.lb(a,{$c:!0,index:a.U.length},d),a.U.push(b);break;case "a":case "c":if(b.Bb===a)c&&(za(a,b.oe),f?b.b=d:b=b.lb(a,c,d),(c.$c?a.U:a.actions).splice(c.index,0,b));else if(c){if((c.$c?a.U:a.actions)[c.index]===b)return;f?b.b=d:b=b.lb(a,c,d);(c.$c?a.U:a.actions)[c.index]=
b}else f?b.b=d:b=b.lb(a,{$c:!1,index:a.actions.length},d),a.actions.push(b)}Aa(a)}}function za(a,b){b.$c?a.U[b.index]&&a.U.splice(b.index,1):a.actions[b.index]&&a.actions.splice(b.index,1)}function Aa(a){a.U.forEach(function(a,c){a.Bb=this;a.oe={$c:!0,index:c}},a);a.actions.forEach(function(a,c){a.Bb=this;a.oe={$c:!1,index:c}},a)}
function Ba(a,b){function c(a,b){if(a.disabled)return b.disabled?0:1;if(b.disabled)return-1;a=a.V.name;b=b.V.name;return a>b?1:a<b?-1:0}function d(a,b){if(null===a.g&&null===b.g)return!0;if(null===a.g||null===b.g||a.g.length!==b.g.length)return!1;for(var c=0;c<a.g.length;c++)if(a.g[c]!==b.g[c])return!1;return!0}function f(a){for(var b=0;b<a.U.length;b++)if(!a.U[b].disabled)return!1;return!0}if(!(a.disabled||b.disabled||f(a)||f(b)||0===a.U.length||b.U.length!==a.U.length)){for(var e=a.U.slice(0,1).concat(a.U.slice(1).sort(c)),
h=b.U.slice(0,1).concat(b.U.slice(1).sort(c)),g=0;g<e.length&&!e[g].disabled&&!h[g].disabled;g++)if(e[g].V!==h[g].V||!d(e[g],h[g]))return;if(null==a.error||a.error.Db)e=new Da("Rules with same events"),Ea(e,b),a.error=e;if(null==b.error||b.error.Db)e=new Da("Rules with same events"),Ea(e,a),b.error=e}};function Fa(){this.b=[];this.yb=this.te=this.Zb=!1}function Ga(a,b){a.b=b.slice()}Fa.prototype.toggle=function(a){var b=this.b.indexOf(a);0<=b?this.b.splice(b,1):this.b.push(a)};function Ha(){this.b={};this.language="en"}function Ja(a,b,c){a.b[b]||(a.b[b]={});a=a.b[b];for(var d in c)c.hasOwnProperty(d)&&(a[d]=c[d])}Ha.prototype.translate=function(a,b){return(b=this.b[b||this.language])&&b[a]||a};function Ka(){this.b={};this.xe={}}Ka.prototype.add=function(a){for(var b in a)if(a.hasOwnProperty(b)){this.b[b]||(this.b[b]={});for(var c in a[b])if(a[b].hasOwnProperty(c)){this.b[b][c]||(this.b[b][c]={});for(var d in a[b][c])a[b][c].hasOwnProperty(d)&&(this.b[b][c][d]=a[b][c][d].slice())}}};Ka.prototype.get=function(a,b,c){return this.b[a]&&this.b[a][b]&&this.b[a][b][c]?this.b[a][b][c]:null};
function Ma(a,b){var c="";b.forEach(function(a){function b(b,c){b=a.split(b);if(1<b.length){a=b[0];for(var d=1;d<b.length;d++)a+=(1==d%2?"<":"</")+c+">"+b[d];0==b.length%2&&(a+="</"+c+">")}}a=a.replace(/&\s/g,"&amp; ");var d="p";/^###/.test(a)?(a=a.slice(2),d="h4"):/^##/.test(a)?(a=a.slice(2),d="h3"):/^#/.test(a)&&(a=a.slice(1),d="h2");b(/\*\*|__/,"strong");for(b(/\*|_/,"em");;){var h=/!\[([^\]]*)\]\(([^)]*)\)/.exec(a);if(!h)break;a=a.slice(0,h.index)+'<img src="'+(this.xe[h[2]]||h[2])+'" alt="'+
h[1]+'">'+a.slice(h.index+h[0].length)}a=a.replace(/\[([^\]]*)\]\(([^)]*)\)/g,'<a href="$2">$1</a>');c="p"===d&&/^<img /.test(a)&&!/^.+<img/.test(a)?c+('<p class="md parimg">'+a+"</"+d+">\n"):c+("<"+d+' class="md">'+a+"</"+d+">\n")},a);return c}
Ka.prototype.Ec=function(a,b,c,d){d=d&&d[a]?"<div style='padding: 2em; max-width: 60em; margin-left: auto; margin-right: auto;'>\n"+d[a]+"</div>\n":"<html>\n<style>\nbody {font-family: sans-serif;}\nimg {float: left; margin-right: 10px; margin-bottom: 20px;}\nh1, h2, hr {clear: left;}\np {margin-left: 120px}\np.parimg {margin-left: 0}\n</style>\n<body>\n<div style='padding: 2em; max-width: 60em; margin-left: auto; margin-right: auto;'>\nBUTTONS<hr>\nBLOCKS</div>\n</body>\n</html>\n";var f="";b.forEach(function(b){(b=
this.get(a,"buttons",b))&&(f+=Ma(this,b))},this);var e="";c.forEach(function(b){(b=this.get(a,"blocks",b))&&(e+=Ma(this,b))},this);return d.replace("BUTTONS",f).replace("BLOCKS",e)};function Na(a){this.filename=null;this.readOnly=!1;this.mode="b";this.fa=!1;this.Fb=Oa;this.yg=!1;this.i=[];this.Hb=!1;this.Qf=!0;this.gc=this.$b=!1;this.u=this.o=this.ra=null;this.Wc=new Pa;this.code={};this.rb="aseba";this.message=null;this.fc=Qa;this.b=Ra;this.tc=Sa;this.h=Ta;this.ia=a||new Fa;this.m=null}var pa={},Ua=!0,Qa=[],Ra=!1,Ta=!0,Sa=[];function Va(){Qa=Wa("b").map(function(a){return a.name});Sa=Wa("a").map(function(a){return a.name})}
function Xa(a){var b=Za.map(function(a){return a.name});switch(a){case "b":Qa=b;break;case "a":Sa=b}}w=Na.prototype;w.pe=function(){this.ia.b=[]};function $a(a,b){b?(b=a.Wc,b.mc=[],b.ed=[]):a.Cb();a.mode="b";a.fc=Qa;a.b=Ra;a.tc=Sa;a.h=Ta;a.i=[];a.code={};a.Qf=!0}w.Ob=function(){for(var a=0;a<this.i.length;a++)if(!this.i[a].Ob())return!1;return!0};w.getError=function(){for(var a=0;a<this.i.length;a++)if(null!==this.i[a].error)return this.i[a].error;return null};
function ab(a){if("b"===a.mode?a.b:a.h)return!1;for(var b=0;b<a.i.length;b++)if(1<a.i[b].U.length||0<a.i[b].U.length&&"s"===a.i[b].U[0].V.type)return!1;return!0}w.Cb=function(){this.Wc.Cb(bb(this),{Hb:this.Hb,$b:this.$b,gc:this.gc});this.code={};this.gc=this.$b=this.Hb=!1};w.eg=function(a){if(0<this.Wc.mc.length){var b=this.Wc.eg(bb(this),{Hb:this.Hb,$b:this.$b,gc:this.gc});cb(this,b.state,a);this.Hb=b.b.Hb;this.$b=b.b.$b;this.gc=b.b.gc;this.code={}}};
w.Vf=function(a){if(0<this.Wc.ed.length){var b=this.Wc.Vf(bb(this),{Hb:this.Hb,$b:this.$b,gc:this.gc});cb(this,b.state,a);this.Hb=b.b.Hb;this.$b=b.b.$b;this.gc=b.b.gc;this.code={}}};function db(a,b){b!==a.mode&&(a.Cb(),a.mode=b,a.i.forEach(function(a){a.U.forEach(function(b,c){a.U[c]=b});a.actions.forEach(function(b,c){a.actions[c]=b})}))}var Oa="s";function eb(a){if(0!==a.i.length&&a.i[a.i.length-1].Ob())for(;1<a.i.length&&a.i[a.i.length-2].Ob();)a.i.splice(-2,1);else a.i.push(new wa)}
function bb(a,b){var c={};b&&!1===b.ad||(c.basicBlocks=a.fc,c.basicMultiEvent=a.b,Ua&&(c.advanced="a"===a.mode,c.advancedBlocks=a.tc,c.advancedMultiEvent=a.h),c.disabledUI=a.ia.b);if(b&&!1===b.dd)return c;b=a.o?a.o():null;var d=null;null==b&&(d=a.i.map(function(a){function b(a){a&&c.push({name:a.V.name,disabled:a.disabled,locked:a.locked,param:a.V.gf?a.V.gf(a):a.g?a.g.slice():null})}var c=[];a.U.forEach(function(a){b(a)});a.actions.forEach(function(a){b(a)});return{blocks:c,disabled:a.disabled,locked:a.locked}}));
c.program=d;c.code=b;return c}function fb(a,b){return JSON.stringify(bb(a,b),null,"\t")}
function cb(a,b,c,d){var f=!1,e="vpl";try{if(b){!b.disabledUI||d&&d.Bh||Ga(a.ia,b.disabledUI);if(!d||!d.Ah){var h=1==b.advanced;Ua?(a.mode=h?"a":"b",a.fc=b.basicBlocks||Qa,a.b=void 0!==b.basicMultiEvent?b.basicMultiEvent:Ra,a.tc=b.advancedBlocks||Sa,a.h=void 0!==b.advancedMultiEvent?b.advancedMultiEvent:Ta):(a.mode="b",a.fc=h?b.advancedBlocks||Sa:b.basicBlocks||Qa,a.b=h?void 0!==b.advancedMultiEvent?b.advancedMultiEvent:Ta:void 0!==b.basicMultiEvent?b.basicMultiEvent:Ra)}if(!d||!d.ug)if(b.program?
a.i=b.program.map(function(b){var d=new wa;b.blocks.forEach(function(b){var e=ua(b.name);if(e){var h=new z(e,null,null);h.disabled=b.disabled||!1;h.locked=b.locked||!1;e.ke?e.ke(h,b.param,function(){f&&c&&c("vpl")}):h.g=b.param;xa(d,h,null,function(){a.Cb()},!0)}},this);d.disabled=b.disabled||!1;d.locked=b.locked||!1;return d},a):a.i=[],a.u){var g=b.code;a.u(void 0==b.code?null:g);null!=g&&(e="src")}}}catch(k){}eb(a);a.fa="src"===e;c&&c(e);f=!0}
function gb(a,b,c,d){try{var f=JSON.parse(b);cb(a,f,c,d);var e=a.Wc;e.mc=[];e.ed=[]}catch(h){}}Na.prototype.ac=function(a){"string"!==typeof this.code[a]&&(this.code[a]=pa[a].Ec(this));return this.code[a]};function hb(a,b){var c=pa[a];a=ib(c,b,!0);b=ib(c,b,!1);return 0<=a&&0<=b?{Ld:a,end:b}:null}function jb(a,b){a.m=b}Na.prototype.log=function(a){this.m&&this.m(a)};function kb(a,b,c){this.language=a;this.m=b;this.o=c;this.b=[]}function lb(a,b,c){this.id=a;this.m=b;this.h=c;if(0>a||6399<a)throw"internal";this.A=String.fromCharCode(57344+a);this.b=-1}
function mb(a,b){a.forEach(function(a){a.b=b.indexOf(a.A)});a.sort(function(a,b){return a.b-b.b});for(var c=0;c<a.length;c++)a[c].b-=c,b=b.replace(a[c].A,"");a.forEach(function(a){var c;if(a.h){for(;;){for(c=a.b;" "===b[c]||"\t"===b[c];c++);if("\n"===b[c])a.b=c+1;else break}if(" "===b[a.b-1]||"\t"===b[a.b-1]){for(c=a.b-1;" "===b[c]||"\t"===b[c];c--);"\n"===b[c]&&(a.b=c+1)}}else if(" "===b[a.b-1]||"\t"===b[a.b-1]){for(c=a.b-1;" "===b[c]||"\t"===b[c];c--);"\n"===b[c]&&(a.b=c+1)}});return b}
function ob(a){return a.replace(/[\ue000-\uf8ff]/g,"")}function pb(a,b,c){var d=a.b.length,f=new lb(d,c,!0);a.b.push(f);c=new lb(d+1,c,!1);a.b.push(c);return f.A+b+c.A}function ib(a,b,c){for(var d=0;d<a.b.length;d++)if(a.b[d].m===b&&a.b[d].h===c)return a.b[d].b;return-1}
function qb(a,b){if(b.disabled||b.Ob())return{};b.error=null;for(var c=!1,d=!1,f=0;f<b.U.length;f++)if(!b.U[f].disabled)if("e"===b.U[f].V.type){if(c=!0,b.U[f].V.Ac){var e=b.U[f].V.Ac(b.U[f]);if(e&&(rb(e,[f]),!e.Db||!b.error)&&(b.error=e,!e.Db))return{error:e}}}else"s"===b.U[f].V.type&&(d=!0);e=!1;for(f=0;f<b.actions.length;f++)if(!b.actions[f].disabled&&"a"===b.actions[f].V.type){e=!0;break}if(!c&&!e)return b.error?{error:b.error}:{};if(!c&&!d)return e=new Da("Missing event block"),rb(e,[]),b.error=
e,{error:e};if(!e)return e=new Da("Missing action block"),e.b.push(0),b.error=e,{error:e};if(!b.error)for(f=0;f<b.actions.length;f++)for(c=f+1;c<b.actions.length;c++)"a"===b.actions[c].V.type&&b.actions[c].V===b.actions[f].V&&(e=new Da("Duplicate action blocks",!0),e.b.push(f),e.b.push(c),b.error=e);var h=[],g=[],k=[],m="",q=[],n="",r=[],u="";b.U.forEach(function(a,b){var c=a.h(this.language);if(0===b&&c.R)c.Va&&(m=pb(this,c.Va,a),c.ba&&(n+=c.ba));else if(c.tg||c.Va)q.push(pb(this,c.tg||c.Va,a)),
c.ba&&(r=r.concat(c.ba));c.Wb&&(h=h.concat(c.Wb));c.hc&&(g=g.concat(c.hc));c.Vb&&(k=k.concat(c.Vb));c.ka&&(u+=pb(this,c.ka,a))},a);for(f=0;f<b.actions.length;f++)c=b.actions[f].h(a.language),u+=c.ka?pb(a,c.ka,b.actions[f]):"",c.Wb&&c.Wb.forEach(function(a){0>h.indexOf(a)&&h.push(a)}),c.hc&&c.hc.forEach(function(a){0>g.indexOf(a)&&g.push(a)}),c.Vb&&c.Vb.forEach(function(a){0>k.indexOf(a)&&k.push(a)});return 0<u.length?(f="e"===b.U[0].V.type?b.U[0].h(a.language):null,c=b.U.slice(1).filter(function(a){return"e"===
a.V.type}).map(function(a){return a.h(this.language)},a),{Eh:b.U[0]?b.U[0].V.name:"",Wb:h,hc:g,Vb:k,R:f?f.R:"",ib:f?f.ib:"",Xa:f?f.Xa:"",sd:c.map(function(a){return a.R||""}),Se:c.map(function(a){return a.ib||""}),Te:c.map(function(a){return a.Xa||""}),ba:n,rd:r,Va:m,Kb:q.join(" "+a.m+" "),ka:(f&&f.ka||"")+u}):{}}kb.prototype.Ec=function(){throw"internal";};kb.prototype.h=function(){throw"internal";};function sb(){kb.call(this,"aseba","and","1 == 1")}sb.prototype=Object.create(kb.prototype);sb.prototype.constructor=sb;
sb.prototype.Ec=function(a,b){this.b=[];var c=a.i.map(function(a){return qb(this,a)},this),d={},f=[];c.forEach(function(a){a.R&&(d[a.R]={R:a.R,ib:a.ib,Xa:a.Xa,ba:"",Ja:""},0>f.indexOf(a.R)&&f.push(a.R));a.sd&&a.sd.forEach(function(b,c){d[b]={R:b,ib:a.Se[c],Xa:a.Te[c],ba:"",Ja:""};0>f.indexOf(b)&&f.push(b)})});var e=[],h=[],g=[],k=[];c.forEach(function(b,c){b.Wb&&b.Wb.forEach(function(a){0>e.indexOf(a)&&e.push(a)});b.hc&&b.hc.forEach(function(a){0>h.indexOf(a)&&h.push(a)});b.Vb&&b.Vb.forEach(function(a){0>
g.indexOf(a)&&g.push(a)});if(b.R&&(b.Za=k.indexOf(ob(b.Va||b.R)),0>b.Za)){b.Za=k.length;k.push(ob(b.Va||b.R));var f=d[b.R];b.ba&&0>f.ba.indexOf(b.ba)&&(f.ba+=b.ba);f.Ja+=b.Va?"when "+b.Va+" do\neventCache["+b.Za+"] = 1\nend\n":"eventCache["+b.Za+"] = 1\n"}b.R||(b.ka=pb(this,b.ka||"",a.i[c]))},this);var m="";if(b){var q=new wa,n=new z(ua("init"),null,null);xa(q,n,null,null);b.forEach(function(a){xa(q,a,null,null)});n=qb(this,q);var r=!0;n.Wb.forEach(function(a){0>e.indexOf(a)&&(r=!1)});n.Vb.forEach(function(a){0>
g.indexOf(a)&&(r=!1)});r?m=n.ka:n.rh&&(m=n.rh)}var u=[],l="",p="",v=0;for(n=0;n<a.i.length;n++)0<=c[n].Za?(c[n].rd&&c[n].rd.forEach(function(a){0>u.indexOf(a)&&u.push(a)}),l+="if eventCache["+c[n].Za+"] != 0"+(c[n].Kb?" and "+c[n].Kb:"")+" then\ntodo["+v+"] = 1\nend\n",p+="if todo["+v+"] != 0 then\n"+c[n].ka+"end\n",v++):c[n].Kb&&(l+="when "+c[n].Kb+" do\ntodo["+v+"] = 1\nend\n",p+="if todo["+v+"] != 0 then\n"+c[n].ka+"end\n",v++);c=0<e.length?"\n"+e.join("\n"):"";0<k.length&&(c+="var eventCache[] = ["+
k.map(function(){return"0"}).join(", ")+"]\n");if(0<v){c+="var todo[] = [";for(n=0;n<v;n++)c+=0<n?", 0":"0";c+="]\n"}b?c+="\n"+m:(0<h.length&&(c+="\n"+h.join("\n")),l&&(c+=(0<c.length?"\n":"")+"timer.period[1] = 50\n"));for(n=0;n<f.length;n++)!/onevent/.test(d[f[n]].R)&&(d[f[n]].Xa||d[f[n]].ba||d[f[n]].Ja)&&(c+="\n"+(d[f[n]].R||"")+(d[f[n]].Xa||"")+(d[f[n]].ba||"")+(d[f[n]].Ja||"")+(d[f[n]].ib||""));0<g.length&&(c+="\n"+g.join("\n"));for(n=0;n<f.length;n++)/onevent/.test(d[f[n]].R)&&(d[f[n]].Xa||
d[f[n]].ba||d[f[n]].Ja)&&(c+="\n"+(d[f[n]].R||"")+(d[f[n]].Xa||"")+(d[f[n]].ba||"")+(d[f[n]].Ja||"")+(d[f[n]].ib||""));if(l){c+="\nonevent timer1\n"+u.join("")+l+p;for(n=0;n<k.length;n++)c+="eventCache["+n+"] = 0\n";for(n=0;n<v;n++)c+="todo["+n+"] = 0\n"}"\n"===c[0]&&(c=c.slice(1));var F=0;b=c.split("\n").map(function(a){return a.trim()}).map(function(a){function b(b){for(var c=ob(a),d=0;d<b.length;d++)if(c.slice(0,b[d].length)===b[d]&&!/^\w/.test(c.slice(b[d].length)))return!0;return!1}if(0<a.length){var c=
b("if else elseif for onevent sub when while".split(" "));b(["else","elseif","end","onevent","sub"])&&(F=Math.max(F-1,0));a="\t\t\t\t\t".slice(0,F)+a;c&&F++}return a});for(n=b.length-2;0<=n;n--)/^\s*#/.test(b[n])&&(m=b[n+1].replace(/^(\s*).*$/,"$1"),b[n]=m+b[n].replace(/^\s*/,""));c=b.join("\n");for(n=0;n<a.i.length;n++)for(b=n+1;b<a.i.length;b++)Ba(a.i[n],a.i[b]);return c=mb(this.b,c)};
sb.prototype.h=function(a){var b="# missing Aseba implementation for block "+a.V.name+"\n";switch(a.V.type){case "e":case "s":return{ba:b,Va:"1 == 1"};case "a":return{ka:b};default:return{}}};pa.aseba=new sb;function tb(){kb.call(this,"l2","&&","true")}tb.prototype=Object.create(kb.prototype);tb.prototype.constructor=tb;
tb.prototype.Ec=function(a,b){this.b=[];var c=a.i.map(function(a){return qb(this,a)},this),d={},f=[];c.forEach(function(a){a.R&&(d[a.R]={R:a.R,ib:a.ib,Xa:a.Xa,ba:"",Ja:""},0>f.indexOf(a.R)&&f.push(a.R));a.sd&&a.sd.forEach(function(b,c){d[b]={R:b,ib:a.Se[c],Xa:a.Te[c],ba:"",Ja:""};0>f.indexOf(b)&&f.push(b)})});var e=[],h=[],g=[],k=[];c.forEach(function(b,c){b.Wb&&b.Wb.forEach(function(a){0>e.indexOf(a)&&e.push(a)});b.hc&&b.hc.forEach(function(a){0>h.indexOf(a)&&h.push(a)});b.Vb&&b.Vb.forEach(function(a){0>
g.indexOf(a)&&g.push(a)});if(b.R&&(b.Za=k.indexOf(ob(b.Va||b.R)),0>b.Za)){b.Za=k.length;k.push(ob(b.Va||b.R));var f=d[b.R];b.ba&&0>f.ba.indexOf(b.ba)&&(f.ba+=b.ba);f.Ja+=b.Va?"when ("+b.Va+") {\neventCache["+b.Za+"] = true;\n}\n":"eventCache["+b.Za+"] = true;\n"}b.R||(b.ka=pb(this,b.ka||"",a.i[c]))},this);var m="";if(b){var q=new wa,n=new z(ua("init"),null,null);xa(q,n,null,null);b.forEach(function(a){xa(q,a,null,null)});m=qb(this,q).ka}var r=[],u="",l="",p=0;for(n=0;n<a.i.length;n++)0<=c[n].Za?(c[n].rd&&
c[n].rd.forEach(function(a){0>r.indexOf(a)&&r.push(a)}),u+="if (eventCache["+c[n].Za+"]"+(c[n].Kb?" && "+c[n].Kb:"")+") {\ntodo["+p+"] = true;\n}\n",l+="if (todo["+p+"]) {\n"+c[n].ka+"}\n",p++):c[n].Kb&&(u+="when ("+c[n].Kb+") {\ntodo["+p+"] = true;\n}\n",l+="if (todo["+p+"]) {\n"+c[n].ka+"}\n",p++);c=0<e.length?"\n"+e.join("\n"):"";0<k.length&&(c+="bool eventCache["+k.length+"] = false;\n");b?c+="\n"+m:(n="",0<h.length&&(n+="\n"+h.join("\n")),n&&(c+=(0<c.length?"\n":"")+n.slice(1)),u&&(c+=(0<c.length?
"\n":"")+"timer.period[1] = 50;\n"));for(n=0;n<f.length;n++)!/onevent/.test(d[f[n]].R)&&(d[f[n]].Xa||d[f[n]].ba||d[f[n]].Ja)&&(c+="\n"+(d[f[n]].R||"")+(d[f[n]].Xa||"")+(d[f[n]].ba||"")+(d[f[n]].Ja||"")+(d[f[n]].ib||""));0<g.length&&(c+="\n"+g.join("\n"));for(n=0;n<f.length;n++)/onevent/.test(d[f[n]].R)&&(d[f[n]].Xa||d[f[n]].ba||d[f[n]].Ja)&&(c+="\n"+(d[f[n]].R||"")+(d[f[n]].Xa||"")+(d[f[n]].ba||"")+(d[f[n]].Ja||"")+(d[f[n]].ib||""));u&&(c+="\nonevent timer1 {\n",0<p&&(c+="bool todo["+p+"] = false;\n"),
c+=r.join("")+u+l+"eventCache = false;\n}\n");"\n"===c[0]&&(c=c.slice(1));var v=0;b=c.split("\n").map(function(a){return a.trim()}).map(function(a){var b=ob(a);if(0<b.length){var c="{"===b.slice(-1);"}"===b[0]&&(v=Math.max(v-1,0));a="\t\t\t\t\t".slice(0,v)+a;c&&v++}return a});for(n=b.length-2;0<=n;n--)/^\s*#/.test(b[n])&&(u=b[n+1].replace(/^(\s*).*$/,"$1"),b[n]=u+b[n].replace(/^\s*/,""));c=b.join("\n");for(n=0;n<a.i.length;n++)for(b=n+1;b<a.i.length;b++)Ba(a.i[n],a.i[b]);return c=mb(this.b,c)};
tb.prototype.h=function(a){var b="// missing L2 implementation for block "+a.V.name+"\n";switch(a.V.type){case "e":case "s":return{ba:b,Va:"true"};case "a":return{ka:b};default:return{}}};pa.l2=new tb;function ub(){kb.call(this,"js","&&","true")}ub.prototype=Object.create(kb.prototype);ub.prototype.constructor=ub;
ub.prototype.Ec=function(a,b){this.b=[];var c=a.i.map(function(a){return qb(this,a)},this),d={},f=[];c.forEach(function(a){a.R&&(d[a.R]={R:a.R,ib:a.ib,Xa:a.Xa,ba:"",Ja:""},0>f.indexOf(a.R)&&f.push(a.R));a.sd&&a.sd.forEach(function(b,c){d[b]={R:b,ib:a.Se[c],Xa:a.Te[c],ba:"",Ja:""};0>f.indexOf(b)&&f.push(b)})});var e=[],h=[],g=[],k=[],m=[],q=0;c.forEach(function(b,c){b.Wb&&b.Wb.forEach(function(a){0>e.indexOf(a)&&e.push(a)});b.hc&&b.hc.forEach(function(a){0>h.indexOf(a)&&h.push(a)});b.Vb&&b.Vb.forEach(function(a){0>
g.indexOf(a)&&g.push(a)});var f=b.ka||"";b.Va&&(f="cond = "+b.Va+";\nif (cond && !cond0["+q+"]) {\n"+f+"}\ncond0["+q+"] = cond;\n",q++);if(b.R&&(b.Za=k.indexOf(ob(b.Va||b.R)),0>b.Za)){b.Za=k.length;k.push(ob(b.Va||b.R));var l=d[b.R];b.ba&&0>l.ba.indexOf(b.ba)&&(l.ba+=b.ba);b.Va?(l.Ja+="cond = "+b.Va+";\nif (cond && !cond0["+q+"]) {\neventCache["+b.Za+"] = true;\n}\ncond0["+q+"] = cond;\n",q++):l.Ja+="eventCache["+b.Za+"] = true;\n"}b.R||(b.ka=pb(this,f,a.i[c]));ya(a.i[c])&&m.push(c)},this);var n=
"";if(b){var r=new wa,u=new z(ua("init"),null,null);xa(r,u,null,null);b.forEach(function(a){xa(r,a,null,null)});n=qb(this,r).ka}var l=[],p="",v="",F=0;for(u=0;u<a.i.length;u++)0<=c[u].Za?(c[u].rd&&c[u].rd.forEach(function(a){0>l.indexOf(a)&&l.push(a)}),p+="if (eventCache["+c[u].Za+"]"+(c[u].Kb?" && "+c[u].Kb:"")+") {\ntodo["+F+"] = true;\n}\n",v+="if (todo["+F+"]) {\n"+c[u].ka+"}\n",F++):c[u].Kb&&(p+="cond = "+c[u].Kb+";\nif (cond && !cond0["+q+"]) {\ntodo["+F+"] = true;\n}\ncond0["+q+"] = cond;\n",
q++,v+="if (todo["+F+"]) {\n"+c[u].ka+"}\n",F++);0<q&&(e.unshift("var cond0;\nvar cond;\n"),h.unshift("cond0 = [];\n"));var x=0<e.length?"\n"+e.join("\n"):"";0<k.length&&(x+="var eventCache = [];\n");0<F&&(x+="var todo = [];\n");if(b)x+="\n"+n;else{b="";0<h.length&&(b+="\n"+h.join("\n"));p&&(b+="this.setTimer(1, 0.1, true);\n");for(u=0;u<a.i.length;u++)0<=m.indexOf(u)&&c[u].ka&&(b+=(0<b.length?"\n":"")+(c[u].R||"")+(c[u].ka||"")+(c[u].ib||""));b&&(x+=(0<x.length?"\n":"")+'this.addEventListener("init", function (name, param) {\n'+
b.slice(1)+"});\n")}if(0<g.length)throw"internal error, unsupported sub/onevent in js";for(u=0;u<f.length;u++)if(d[f[u]].Xa||d[f[u]].ba||d[f[u]].Ja)x+="\n"+(d[f[u]].R||"")+(d[f[u]].Xa||"")+(d[f[u]].ba||"")+(d[f[u]].Ja||"")+(d[f[u]].ib||"");if(p){x+='\nthis.addEventListener("timer1", function (name, param) {\n'+l.join("")+p+v;for(u=0;u<k.length;u++)x+="eventCache["+u+"] = false;\n";for(u=0;u<F;u++)x+="todo["+u+"] = false;\n"}0<x.trim().length&&(x+="});");"\n"===x[0]&&(x=x.slice(1));var t=0;c=x.split("\n").map(function(a){return a.trim()}).map(function(a){var b=
ob(a);if(0<b.length){var c="{"===b.slice(-1);"}"===b[0]&&(t=Math.max(t-1,0));a="\t\t\t\t\t".slice(0,t)+a;c&&t++}return a});for(u=c.length-2;0<=u;u--)/^\s*#/.test(c[u])&&(x=c[u+1].replace(/^(\s*).*$/,"$1"),c[u]=x+c[u].replace(/^\s*/,""));x=c.join("\n");for(u=0;u<a.i.length;u++)for(c=u+1;c<a.i.length;c++)Ba(a.i[u],a.i[c]);return x=mb(this.b,x)};
ub.prototype.h=function(a){var b="// missing JavaScript implementation for block "+a.V.name+"\n";switch(a.V.type){case "e":case "s":return{ba:b,Va:"true"};case "a":return{ka:b};default:return{}}};pa.js=new ub;function vb(){kb.call(this,"python","and","True")}vb.prototype=Object.create(kb.prototype);vb.prototype.constructor=vb;
vb.prototype.Ec=function(a,b){this.b=[];var c=a.i.map(function(a){return qb(this,a)},this),d={},f=[];c.forEach(function(a){a.R&&(d[a.R]={R:a.R,ib:a.ib,Xa:a.Xa,ba:"",Ja:""},0>f.indexOf(a.R)&&f.push(a.R));a.sd&&a.sd.forEach(function(b,c){d[b]={R:b,ib:a.Se[c],Xa:a.Te[c],ba:"",Ja:""};0>f.indexOf(b)&&f.push(b)})});var e=[],h=[],g=[],k=[],m=0;c.forEach(function(b,c){b.Wb&&b.Wb.forEach(function(a){0>e.indexOf(a)&&e.push(a)});b.hc&&b.hc.forEach(function(a){0>h.indexOf(a)&&h.push(a)});b.Vb&&b.Vb.forEach(function(a){0>
g.indexOf(a)&&g.push(a)});if(b.R&&(b.Za=k.indexOf(ob(b.Va||b.R)),0>b.Za)){b.Za=k.length;k.push(ob(b.Va||b.R));var f=d[b.R];b.ba&&0>f.ba.indexOf(b.ba)&&(f.ba+=b.ba);b.Va?(f.Ja+="cond = "+b.Va+"\nif cond and not cond0["+m+"]:\neventCache["+b.Za+"] = True\n<\ncond0["+m+"] = cond\n",m++):f.Ja+="eventCache["+b.Za+"] = True\n"}b.R||(b.ka=pb(this,b.ka||"",a.i[c]))},this);if(b){var q=new wa,n=new z(ua("init"),null,null);xa(q,n,null,null);b.forEach(function(a){xa(q,a,null,null)});var r=qb(this,q);r.Wb.forEach(function(){});
r.Vb.forEach(function(){})}0<m&&h.unshift("cond0 = [False for i in range("+m+")]\n");var u=[],l="",p="",v=0;for(n=0;n<a.i.length;n++)0<=c[n].Za?(c[n].rd&&c[n].rd.forEach(function(a){0>u.indexOf(a)&&u.push(a)}),l+="if eventCache["+c[n].Za+"]"+(c[n].Kb?" and "+c[n].Kb:"")+":\ntodo["+v+"] = True\n<\n",p+="if todo["+v+"]:\n"+c[n].ka+"<\n",v++):c[n].Kb&&(l+="cond = "+c[n].Kb+"\nif cond and not cond0["+n+"]:\ntodo["+v+"] = 1\n<\ncond0["+n+"] = cond\n",p+="if todo["+v+"]:\n"+c[n].ka+"<\n",v++);c=0<e.length?
e.join("\n"):"";0<k.length&&(c+="eventCache = ["+k.map(function(){return"0"}).join(", ")+"]\n");if(0<v){c+="todo = [";for(n=0;n<v;n++)c+=0<n?", 0":"0";c+="]\n"}b?c+="\n"+r:(0<h.length&&(c+="\n"+h.join("\n")),l&&(c+=(0<c.length?"\n":"")+"thymio.timer.period[1] = 50\n"));for(n=0;n<f.length;n++)!/onevent/.test(d[f[n]].R)&&(d[f[n]].Xa||d[f[n]].ba||d[f[n]].Ja)&&(c+="\n"+(d[f[n]].R||"")+(d[f[n]].Xa||"")+(d[f[n]].ba||"")+(d[f[n]].Ja||"")+(d[f[n]].ib||""));0<g.length&&(c+="\n"+g.join("\n"));for(n=0;n<f.length;n++)/onevent/.test(d[f[n]].R)&&
(d[f[n]].Xa||d[f[n]].ba||d[f[n]].Ja)&&(c+="\n"+(d[f[n]].R||"")+(d[f[n]].Xa||"")+(d[f[n]].ba||"")+(d[f[n]].Ja||"")+(d[f[n]].ib||""));if(l){c+="\n@thymio.onevent(thymio.TIMER1)\ndef onevent_timer1():\n"+u.join("")+l+p;for(n=0;n<k.length;n++)c+="eventCache["+n+"] = False\n";for(n=0;n<v;n++)c+="todo["+n+"] = False\n";c+="<\n"}"\n"===c[0]&&(c=c.slice(1));c&&(c="import thymio\n\n"+c);c=ob(c);c=c.replace(/\n[ \t]+/g,"\n").replace(/\n<\n\n<\n/g,"\n<\n<\n");var F=0,x="";c.split("\n").map(function(a){return a.trim()}).forEach(function(a){var b=
ob(a);if(0<b.length){var c=":"===b.slice(-1);"<"===b&&(F=Math.max(F-1,0));"<"!==b&&(a="\t\t\t\t\t".slice(0,F)+a,c&&F++)}"<"!==b&&(x+=a+"\n")});c=x;for(n=0;n<a.i.length;n++)for(b=n+1;b<a.i.length;b++)Ba(a.i[n],a.i[b]);return c=mb(this.b,c)};vb.prototype.h=function(a){var b="# missing Python implementation for block "+a.V.name+"\n";switch(a.V.type){case "e":case "s":return{ba:b,Va:"True"};case "a":return{ka:b};default:return{}}};pa.python=new vb;function wb(){sb.call(this)}wb.prototype=Object.create(kb.prototype);wb.prototype.constructor=wb;wb.prototype.Ec=function(a,b){a=sb.prototype.Ec.call(this,a,b);b=new xb(yb);a=new zb(b,a);a.ha=Ab;a=Bb(a);return Cb(a,!0)};pa.asm=new wb;function Db(a){this.M=[];this.b=a||null}w=Db.prototype;w.add=function(a,b){this.M.push(new Eb(a,b))};w.find=function(a){for(var b=0;b<this.M.length;b++)if(this.M[b].name===a)return this.M[b];return null};function Fb(a,b){a=a.find(b);return null!=a&&null!=a.m}function Gb(a,b){if(a.b){var c=a.find(b);b={cmd:b};c.h&&(b.selected=c.Ka());c.b&&(b.state=c.getState());a.b({type:"cmd",data:b})}}w.mb=function(a,b){this.b&&this.b({type:"drop",data:{cmd:a}});(a=this.find(a))&&a.mb(b)};
w.kb=function(a,b){a=this.find(a);return null!=a&&a.kb(b)};w.S=function(a){if(window.vplConfig&&window.vplConfig.ignoredCommands&&0<=window.vplConfig.ignoredCommands.indexOf(a))return!1;a=this.find(a);return null!=a&&a.S()};w.isEnabled=function(a){a=this.find(a);return null!=a&&a.isEnabled()};w.Ka=function(a){a=this.find(a);return null!=a&&a.Ka()};w.getState=function(a){a=this.find(a);return null!=a?a.getState():null};
function Eb(a,b){this.name=a;this.o=b.isEnabled||null;this.h=b.Ka||null;this.b=b.getState||null;this.m=b.action||null;this.K=b.mb||null;this.u=b.kb||null;this.Hc=b.object||null;this.Sc=b.Sc||!1;this.P=b.S||null;this.fb=b.fb||null}function Hb(a,b){a.isEnabled()&&a.m&&a.m(a.Hc,b)}function Ib(a,b){if(!a.b)return!1;var c=a.getState();if(b===c)return!0;for(var d=0;100>d;d++){Hb(a,void 0);var f=a.getState();if(f===b)return!0;if(f===c)break}return!1}w=Eb.prototype;
w.mb=function(a){this.kb(a)&&this.K&&this.K(this.Hc,a)};w.kb=function(a){return null!=this.u&&this.u(this.Hc,a)};w.isEnabled=function(){return null==this.o||this.o(this.Hc)};w.Ka=function(){return null!=this.h&&this.h(this.Hc)};w.getState=function(){return null!=this.b?this.b(this.Hc):null};w.S=function(){return null==this.P||this.P(this.Hc)};function Jb(a){Kb||(Va(),Kb=!0);this.qb=a;this.ca=new Lb;this.h=new Ha;this.ia=new Fa;var b=this;this.M=new Db(function(a){b.log(a)});this.Tb=null;this.o="vpl:close !space vpl:about vpl:help !space vpl:new vpl:save vpl:load vpl:upload vpl:filename vpl:exportToHTML !space vpl:advanced !stretch vpl:readonly !stretch vpl:undo vpl:redo !stretch vpl:connected !stretch vpl:run vpl:stop vpl:debug vpl:robot !space vpl:flash !stretch vpl:sim vpl:text !stretch vpl:teacher-reset vpl:teacher-save vpl:teacher-setasnew vpl:teacher".split(" ");
this.m="!!stretch vpl:message-error vpl:message-warning !!stretch vpl:duplicate vpl:disable vpl:lock vpl:trashcan".split(" ");this.bb="src:close !space src:new src:save !space src:language src:disass !stretch src:run src:stop !stretch src:sim src:vpl !space src:locked !stretch src:teacher-reset src:teacher".split(" ");this.Na="sim:close !stretch sim:restart sim:pause !space sim:speedup sim:noise !stretch sim:pen sim:clear !space sim:map-kind sim:map sim:map-ground sim:map-obstacles sim:map-height !stretch sim:vpl sim:text !stretch sim:teacher-reset sim:teacher".split(" ");
this.Ba=["vpl"];this.qc={vpl:1,src:1,sim:1};this.Vc=["ground","height","obstacles"];this.Xd=this.Nf=this.Le=this.ye=this.Je=null;this.zc=!1;this.ua={};this.username=null;this.i=new Na(this.ia);jb(this.i,function(a){b.log(a)});this.Uf=!0;this.Ib="";this.md=!1;this.da=new Mb(a,{ca:this.ca});this.da.state={uh:new Nb};this.ha="";this.G=this.b=null;this.Ea=[];this.na=-1;this.hg=this.Rd=!1;this.P=null;this.da.Na=function(){null!==b.P&&(b.P=null,Ob(b))};this.K=null;this.oc=[];this.Qe=this.Jb=null}
var Kb=!1;Jb.prototype.translate=function(a,b){return this.h.translate(a,b)};function Pb(a,b){a.ye=b?new Qb(b):null}function Rb(a,b){var c=new Sb;c.width=c.height=64;var d=Tb(16,16);c=Ub(function(b){(a.i.Gd||Vb)("vpl:save",b,d,a.ca,["vpl","top","detached"],a.h,!0,!1,!1,null)},c.width,c.height,c,d,1);c='<img src="'+c.url+'" width='+c.width+" height="+c.height+">";a.Nf=b?new Qb(b,!1,[{title:"\u21d3",lh:c,Aa:function(){Wb(b,"doc.html","text/html")}}],!0):null}
function Xb(a){if(a.u){var b=a.o.concat(a.m).filter(function(a){return"!"!==a[0]&&this.M.S(a)},a),c="b"===a.i.mode?a.i.fc:a.i.tc;c.sort(function(a,b){a=Za.indexOf(ua(a));b=Za.indexOf(ua(b));return a<b?-1:a>b?1:0});a.u.xe={};var d=Tb(100,100),f=Yb(a,a.ca),e=Zb(a,a.o,["vpl","top"]),h=Zb(a,a.m,["vpl","bottom"]);a.Tb={disabled:!1,S:!0,Ag:!1,isEnabled:!0,Ka:!1,state:null};var g=$b(a,a.o,["vpl","top"],f.lc,f.cg,e),k=$b(a,a.m,["vpl","bottom"],f.ld,f.bg,h),m=50/e["vpl:new"].width;a.o.forEach(function(a){var b=
ac(g,a,[a],d,m);b&&(a="vpl:cmd:"+a.replace(/:/g,"-"),this.u.xe[a]=b.url)},a);a.m.forEach(function(a){var b=ac(k,a,[a],d,m);b&&(a="vpl:cmd:"+a.replace(/:/g,"-"),this.u.xe[a]=b.url)},a);a.Tb=null;Za.forEach(function(a){try{var b=new z(a,null,null);b.g=a.hb?a.hb():b.g;var c="vpl:block:"+a.name.replace(/ /g,"-"),e=b.toDataURL(this.ca,d,1);this.u.xe[c]=e}catch(l){}},a);b=a.u.Ec(a.h.language,b,c,a.ua);Rb(a,b)}}function bc(a,b){var c=a.zc;c&&a.Xd&&a.Xd.Gc();a.Xd=b?new Qb(b,!0):null;b&&c&&a.Xd.show()}
Jb.prototype.gb=function(a,b){function c(){0<=a.indexOf("vpl")&&C(d.da);0<=a.indexOf("src")&&C(d.J.Ia);0<=a.indexOf("sim")&&C(d.b)}var d=this;b&&(b.fa||b.fg)&&(this.i.fa=!0,this.J.fa=!0,cc(this.J,!1));if(1===a.length&&b&&b.Qd&&1<this.Ba.length){if(0<=this.Ba.indexOf(a[0]))return;var f=this.Ba.slice();f[this.Ba[0]===b.Qd?1:0]=a[0];a=f}else b&&b.Td?0>this.Ba.indexOf(a[0])&&(a=this.Ba.concat(a)):1===a.length&&b&&b.af&&1<this.Ba.length&&0<=this.Ba.indexOf(a[0])?(this.Ba.splice(this.Ba.indexOf(a[0]),1),
a=this.Ba):1===a.length&&b&&b.toggle&&(0<=this.Ba.indexOf(a[0])?(this.Ba.splice(this.Ba.indexOf(a[0]),1),a=this.Ba):a=this.Ba.concat(a));this.Ba=a;null!=this.G&&this.b.Gc();this.da.Gc();null!=this.J&&(document.getElementById("src-editor").style.display=0<=a.indexOf("src")?"block":"none",this.J.Ia.Gc());0<=a.indexOf("vpl")&&this.da.show();0<=a.indexOf("src")&&this.J.Ia.show();null!=this.G&&0<=a.indexOf("sim")&&this.b.show();dc(this,window.innerWidth<window.innerHeight);for(f=0;f<a.length;f++)switch(a[f]){case "vpl":this.da.ra=
function(){if(!d.i.fa){d.i.code={};eb(d.i);if(d.J){var a=d.J,b=d.i.ac(d.i.rb);if(a.jd){var c=a.he(a.language,b);null!==c&&(ec(a,c,!0),a.kc.wb.readOnly=!0,a.jd=b)}else ec(a,b)}d.log()}Ob(d)};break;case "src":cc(this.J,!(b&&(b.fa||b.fg)));this.J.focus();this.J.resize(window.innerWidth,window.innerHeight);break;case "sim":this.b.ra=function(){fc(d)}}b&&(b.af||b.Td)&&gc(d);this.da&&(this.da.pb=c);this.J&&this.J.Ia&&(this.J.Ia.pb=c);this.b&&(this.b.pb=c);0<=a.indexOf("vpl")&&(this.da.ra(),this.da.pb?this.da.pb():
C(this.da));0<=a.indexOf("src")&&(hc(this),this.J.Ia.pb?this.J.Ia.pb():C(this.J.Ia));0<=a.indexOf("sim")&&(this.start(!1),this.b.ra(),this.b.pb?this.b.pb():C(this.b))};Jb.prototype.setView=Jb.prototype.gb;
function dc(a,b){for(var c=a.Ba.map(function(a){return this.qc[a]},a),d=c.reduce(function(a,b){return a+b},0),f=0,e=0;e<a.Ba.length;e++){var h=b?{W:0,pa:1,X:f,ma:f+c[e]/d}:{W:f,pa:f+c[e]/d,X:0,ma:1};f+=c[e]/d;switch(a.Ba[e]){case "vpl":ic(a.da,h);break;case "src":ic(a.J.Ia,h);break;case "sim":ic(a.b,h)}}}
function gc(a){var b=a.da.b.parentElement.getBoundingClientRect(),c=b.width;b=window.innerHeight-b.top;dc(a,c<b);window.vplDisableResize&&(b=a.da.b.getBoundingClientRect(),c=b.width,b=b.height);a.da.resize(c,b);a.J&&a.J.resize(c,b);a.G&&a.b.resize(c,b);a.Ba.forEach(function(a){switch(a){case "vpl":Ob(this);break;case "src":C(this.J.Ia);break;case "sim":this.G&&fc(this)}},a);a.ye&&jc(a.ye)}
function kc(a,b){if(0<=a.na){var c=null;b&&(c=ua("!stop and blink"));c||(c=ua("!stop"));b=a.i.rb;(c=c&&c.Nb[b])&&a.Ea[a.na].Wa.ec(c(null).ka,b)}}function lc(a){return!a.i.fa&&a.Ea[a.na].Wa.isEnabled(a.i.rb)}function mc(a,b){a.oc.push(b)}
Jb.prototype.log=function(a){if(null==a){nc(this);a={type:"vpl-changed",data:{filename:this.i.filename,nrules:this.i.i.reduce(function(a,b){return 0<b.U.length+b.actions.length?a+1:a},0),nblocks:this.i.i.reduce(function(a,b){return a+b.U.length+b.actions.length},0),uploadedToServer:this.i.$b,error:this.Ib&&!this.md?this.Ib:null,warning:this.Ib&&this.md?this.Ib:null,"error-tr":this.Ib&&!this.md?this.h.translate(this.Ib):null,"warning-tr":this.Ib&&this.md?this.h.translate(this.Ib):null,robot:0<=this.na?
this.Ea[this.na].Wa.isConnected()&&this.Ea[this.na].Wa.getName():null}};var b=JSON.stringify(a);if(b===this.Jb)return;this.Jb=b}this.oc.forEach(function(b){try{b(a)}catch(d){}})};function oc(a){function b(b){function d(b){for(var c=0;c<F.length;c++)if(F[c].uri){var d=pc(F[c].uri);if(a.vb[d.Mc].Mf(b,d.id))return!0}return!1}var f=b.name;if("!"===f[0])return 0;var g=0;/^\w/.test(f)||(c+='Bad block name "'+f+'"\n',g++);var k=b.defaultParameters,m=b.typicalParameters,q=b.buttons,n=b.radiobuttons,r=b.sliders,u=b.rotating,l=b.diffwheelmotion,p=b.score,v=b.otherParameters?parseInt(b.otherParameters,10):0,F=b.draw;if(F){b=null;for(var x=0;x<F.length;x++)if(F[x].uri)if(null==b){b=pc(F[x].uri).Mc;
var t=a.vb[b]}else{var K=pc(F[x].uri);K.Mc!==b?(c+='In block "'+f+'", multiple svg\n',g++):t.vc(K.id)||(c+='In block "'+f+'", uri "'+F[x].uri+'" not found\n',g++)}}q&&q.forEach(function(a){t.vc(a.id)?d(a.id)||(c+='In block "'+f+'", button id "'+a.id+'" not displayed\n',g++):(c+='In block "'+f+'", button id "'+a.id+'" not found\n',g++);void 0==a.val?(c+='In block "'+f+'", missing property "val"\n',g++):void 0==a.st?(c+='In block "'+f+'", missing property "st"\n',g++):a.val.length!==a.st.length&&(c+=
'In block "'+f+'", properties "val" and "st" have different lengths\n',g++)});n&&n.forEach(function(a){t.vc(a.id)?d(a.id)?void 0==a.val?(c+='In block "'+f+'", missing property "val"\n',g++):a.val instanceof Array?(c+='In block "'+f+'", illegal array in property "val"\n',g++):void 0==a.st?(c+='In block "'+f+'", missing property "st"\n',g++):2!==a.st.length&&(c+='In block "'+f+'", property "st" must have length 2\n',g++):(c+='In block "'+f+'", radiobutton id "'+a.id+'" not displayed\n',g++):(c+='In block "'+
f+'", radiobutton id "'+a.id+'" not found\n',g++)});r&&r.forEach(function(a){t.vc(a.id)?d(a.id)||(c+='In block "'+f+'", slider id "'+a.id+'" not displayed\n',g++):(c+='In block "'+f+'", slider id "'+a.id+'" not found\n',g++);t.vc(a.thumbId)?d(a.thumbId)||(c+='In block "'+f+'", slider thumbId "'+a.thumbId+'" not displayed\n',g++):(c+='In block "'+f+'", slider thumbId "'+a.thumbId+'" not found\n',g++);void 0==a.min&&(c+='In block "'+f+'", slider min undefined\n',g++);void 0==a.max&&(c+='In block "'+
f+'", slider max undefined\n',g++);a.lowerPartId&&!t.vc(a.lowerPartId)&&(c+='In block "'+f+'", slider lowerPartId "'+a.lowerPartId+'" not found\n',g++);if(a.snap&&(a=a.snap,a instanceof Array))for(var b=0;b<a.length;b++)"string"===typeof a[b]?/^`.+`$/.test(a[b])||(c+='In block "'+f+'", invalid slider snap expression\n',g++):"number"!==typeof a[b]&&(c+='In block "'+f+'", slider snap must be a number or a string\n',g++)});u&&u.forEach(function(a){var b=a.id,e=a.centerId;a=a.thumbId;t.vc(b)?d(b)||(c+=
'In block "'+f+'", rotating id "'+b+'" not displayed\n',g++):(c+='In block "'+f+'", rotating id "'+b+'" not found\n',g++);t.vc(e)||(c+='In block "'+f+'", rotating centerId "'+e+'" not found\n',g++);t.vc(a)?d(a)||(c+='In block "'+f+'", rotating thumbId "'+a+'" not displayed\n',g++):(c+='In block "'+f+'", rotating thumbId "'+a+'" not found\n',g++);t.Mf(a,b)||(c+='In block "'+f+'", rotating thumbId "'+a+'" not a descendent of id "'+b+'"\n',g++)});l&&(t.vc(l.id)?d(l.id)||(c+='In block "'+f+'", diffwheelmotion id "'+
l.id+'" not displayed\n',g++):(c+='In block "'+f+'", diffwheelmotion id "'+l.id+'" not found\n',g++));p&&(t.vc(p.id)?d(p.id)||(c+='In block "'+f+'", score id "'+p.id+'" not displayed\n',g++):(c+='In block "'+f+'", score id "'+p.id+'" not found\n',g++),"number"!==typeof p.numHeights||p.numHeights!==Math.round(p.numHeights)||0>=p.numHeights)&&(c+='In block "'+f+'", score numHeights must be a strictly positive integer\n',g++);(q||n||r||u||p||0<v)&&!k&&(c+='In block "'+f+'", missing defaultParameters\n',
g++);k&&(l=0,q&&(l+=q.length),n&&(l+=1),r&&(l+=r.length),u&&(l+=u.length),p&&(l+=2*Math.floor((k.length-l)/2)),l+=v,l!==k.length?(c+='In block "'+f+'", defaultParameters.length='+k.length+", needs "+l+" parameters\n",g++):m&&m.length!=l&&(c+='In block "'+f+'", typicalParameters.length='+m.length+", needs "+l+" parameters\n",g++));return g}var c="",d=0;a.blocks&&a.blocks.forEach(function(a){d+=b(a)});0<d&&(c+=d+" error"+(1<d?"s":"")+"\n");return c||null};function qc(a){a.M.add("vpl:close",{action:function(a){a.gb(["vpl"],{af:!0})},object:a,S:function(a){return 1<a.Ba.length&&0<=a.Ba.indexOf("vpl")}});a.M.add("vpl:about",{action:function(a){a.ye.show()},object:a,S:function(a){return null!=a.ye}});a.M.add("vpl:help",{action:function(a){a.Nf.show()},object:a,S:function(a){return null!=a.Nf}});a.M.add("vpl:readonly",{isEnabled:function(){return!1},object:a,S:function(a){return a.i.readOnly||a.i.fa}});a.M.add("vpl:suspend",{action:function(a){a.zc=!a.zc;
a.zc?(lc(a)&&(kc(a,!0),a.i.Hb=!1),a.Xd.show()):a.Xd.Gc()},Ka:function(a){return a.zc},object:a,S:function(a){return a.i.Fb===Oa&&null!=a.Xd}});a.M.add("vpl:new",{action:function(a){$a(a.i);a.Je&&rc(a,a.Je)},isEnabled:function(a){return!a.i.fa&&!a.i.readOnly&&!a.i.Ob()},object:a,S:function(a){return!a.i.readOnly}});a.M.add("vpl:save",{action:function(a,c){c?(a=sc(a,a.ca),Wb(a,"vpl-program.html","text/html")):(c=fb(a.i,{ad:!0,dd:!0}),Wb(c,a.i.filename||"program.vpl3","application/x-vpl3"))},isEnabled:function(a){return!a.i.fa&&
!a.i.Ob()},object:a,S:function(a){return!a.i.readOnly}});a.M.add("vpl:load",{action:function(a){a.Le.show("Open program file",".aesl,.json,.vpl3,.vpl3ui",function(b){tc(a,b)})},isEnabled:function(a){return!a.i.fa&&!a.i.readOnly},object:a,S:function(a){return!a.i.readOnly}});a.M.add("vpl:upload",{action:function(a){var b=fb(a.i,{ad:!1,dd:!0});window.vplUpload(a.i.filename,b);a.i.$b=!0;a.Uf=!1},isEnabled:function(a){return!a.i.fa&&!a.i.readOnly&&!a.i.Ob()},Ka:function(a){return a.i.$b},getState:function(a){return a.i.Ob()?
"empty":a.i.$b?"uploaded":a.Uf?"canUpload":"canUploadAgain"},object:a,S:function(a){return null!=window.vplUpload&&!a.i.readOnly}});a.M.add("vpl:exportToHTML",{action:function(a,c){c?(a=uc(a,a.ca),Wb(a,"vpl-ui.html","text/html")):(a=sc(a,a.ca),Wb(a,"vpl-program.html","text/html"))},isEnabled:function(a){return!a.i.fa&&!a.i.Ob()},object:a});a.M.add("vpl:text",{action:function(a){a.Rd?a.gb(["src"],{Td:!0}):a.gb(["src"],{Qd:"vpl"})},isEnabled:function(a){return!a.i.fa},mb:function(a,c){if(c.data instanceof
z&&c.data.Bb){if(c=hb(a.i.rb,c.data))a.gb(["src"]),a.J.uf(c.Ld,c.end)}else c.data instanceof wa&&(c=hb(a.i.rb,c.data))&&(a.gb(["src"]),a.J.uf(c.Ld,c.end))},kb:function(a,c){return c.data instanceof z&&null!=c.data.Bb||c.data instanceof wa},object:a,S:function(a){return a.J&&0>a.Ba.indexOf("src")}});a.M.add("vpl:text-toggle",{action:function(a){a.gb(["src"],{toggle:!0})},isEnabled:function(a){return!a.i.fa},Ka:function(a){return 0<=a.Ba.indexOf("src")},object:a,fb:[{selected:!1},{selected:!0}]});a.M.add("vpl:advanced",
{action:function(a){db(a.i,"b"===a.i.mode?"a":"b");Xb(a)},isEnabled:function(a){return!a.i.fa&&!a.i.readOnly},Ka:function(a){return"a"===a.i.mode},object:a,S:function(a){return Ua&&!a.i.readOnly},fb:[{selected:!1},{selected:!0}]});a.M.add("vpl:undo",{action:function(a){a.i.eg(function(){Ob(a)})},isEnabled:function(a){return!a.i.fa&&0<a.i.Wc.mc.length},object:a,S:function(a){return!a.i.readOnly}});a.M.add("vpl:redo",{action:function(a){a.i.Vf(function(){Ob(a)})},isEnabled:function(a){return!a.i.fa&&
0<a.i.Wc.ed.length},object:a,S:function(a){return!a.i.readOnly}});a.M.add("vpl:run",{action:function(a){var b=a.i.ac(a.i.rb);a.Ea[a.na].Wa.ec(b,a.i.rb);a.i.Hb=!0;a.i.Qf=!1},isEnabled:function(a){if(a.i.fa||!a.Ea[a.na].Wa.isEnabled(a.i.rb))return!1;a=a.i.getError();return null==a||a.Db},Ka:function(a){return a.i.Hb},getState:function(a){if(a.i.Ob())return"empty";if(a.i.Hb)return"running";var b=a.i.getError();return b&&!b.Db?"error":a.i.Qf?"canLoad":"canReload"},mb:function(a,c){c.data instanceof z?
c.data.Bb?(c=pa[a.i.rb].Ec(a.i,[c.data]),a.Ea[a.na].Wa.ec(c,a.i.rb)):a.da.xb=vc(a.da,c):c.data instanceof wa&&(c=pa[a.i.rb].Ec(a.i,c.data.actions),a.Ea[a.na].Wa.ec(c,a.i.rb))},kb:function(a,c){if(a=a.Ea[a.na].Wa.isEnabled(a.i.rb)&&c.data instanceof wa)a:{a=c.data;for(var b=0;b<a.U.length;b++)if("a"===a.U[b].V.type){a=!0;break a}for(b=0;b<a.actions.length;b++)if("a"===a.actions[b].V.type){a=!0;break a}a=!1}return a||c.data instanceof z&&null!=c.data.Bb&&"a"===c.data.V.type},object:a,S:function(a){return 0<=
a.na},fb:[{selected:!1},{selected:!0},{state:"empty"},{state:"running"},{state:"error"},{state:"canLoad"},{state:"canReload"}]});a.M.add("vpl:stop",{action:function(a){kc(a);a.i.Hb=!1},isEnabled:function(a){return lc(a)},object:a,S:function(a){return 0<=a.na}});a.M.add("vpl:stop-abnormally",{action:function(a){kc(a,!0);a.i.Hb=!1},isEnabled:function(a){return lc(a)},object:a,S:function(a){return 0<=a.na}});a.M.add("vpl:debug",{action:function(){},Ka:function(){return!1},object:a,S:function(){return!1},
fb:[{selected:!1},{selected:!0}]});a.M.add("vpl:flash",{action:function(a){var b=a.i.ac(a.i.rb);a.Ea[a.na].Wa.hf(b,a.i.rb);a.i.gc=!0},isEnabled:function(a){if(a.i.fa||!a.Ea[a.na].Wa.Ge(a.i.rb))return!1;a=a.i.getError();return null==a||a.Db},Ka:function(a){return a.i.gc},object:a,S:function(a){return 0<=a.na&&null!=a.Ea[a.na].Wa.If}});a.M.add("vpl:connected",{Ka:function(a){return!a.i.fa&&a.Ea[a.na].Wa.isConnected()},getState:function(a){return a.Qe?"monitored":!1===a.Qe?"nonmonitored":""},object:a,
S:function(a){return 0<=a.na},fb:[{selected:!1},{selected:!0},{selected:!1,state:"monitored"},{selected:!0,state:"monitored"},{selected:!1,state:"nonmonitored"},{selected:!0,state:"nonmonitored"}]});a.M.add("vpl:robot",{action:function(a){a.na=(a.na+1)%a.Ea.length},getState:function(a){return a.Ea[a.na].name},object:a,S:function(a){return 1<a.Ea.length}});a.M.add("vpl:sim",{action:function(a){a.Rd?a.gb(["sim"],{Td:!0}):a.gb(["sim"],{Qd:"vpl"})},isEnabled:function(a){return!a.i.fa},object:a,S:function(a){return 0<=
a.na&&null!=a.G&&0>a.Ba.indexOf("sim")}});a.M.add("vpl:duplicate",{isEnabled:function(a){return!a.i.fa},mb:function(a,c){var b=a.i.i.indexOf(c.data);0<=b&&(a.i.Cb(),a.i.i.splice(b+1,0,c.data.lb()),a.da.ra&&a.da.ra(),a.log())},kb:function(a,c){return c.data instanceof wa&&!c.data.Ob()},object:a,S:function(a){return!a.i.readOnly}});a.M.add("vpl:disable",{isEnabled:function(a){return!a.i.fa},mb:function(a,c){c.data instanceof z?(a.i.Cb(),c.data.disabled=!c.data.disabled,a.da.ra&&a.da.ra(),a.log()):c.data instanceof
wa&&(a.i.Cb(),c=c.data,c.disabled=!c.disabled,c.disabled&&(c.error=null),a.da.ra&&a.da.ra(),a.log())},kb:function(a,c){return c.data instanceof wa?!c.data.Ob():c.data instanceof z&&null!==c.data.Bb},object:a,S:function(a){return!a.i.readOnly}});a.M.add("vpl:lock",{isEnabled:function(a){return!a.i.fa},mb:function(a,c){c.data instanceof z?(a.i.Cb(),c.data.locked=!c.data.locked,a.da.ra&&a.da.ra(),a.log()):c.data instanceof wa&&(a.i.Cb(),c.data.locked=!c.data.locked,a.da.ra&&a.da.ra(),a.log())},kb:function(a,
c){return c.data instanceof wa?!c.data.Ob():c.data instanceof z&&null!==c.data.Bb},object:a,S:function(a){return a.i.yg&&"t"===a.i.Fb&&!a.i.readOnly}});a.M.add("vpl:trashcan",{isEnabled:function(a){return!a.i.fa},mb:function(a,c){c.data instanceof z?null!==c.data.Bb&&(a.i.Cb(),za(c.data.Bb,c.data.oe),a.da.ra&&a.da.ra(),a.log()):c.data instanceof wa&&(c=a.i.i.indexOf(c.data),0<=c&&(a.i.Cb(),a.i.i.splice(c,1),a.da.ra&&a.da.ra(),a.log()))},kb:function(a,c){return c.data instanceof z?null!==c.data.Bb&&
!c.data.locked:c.data instanceof wa&&(!c.data.Ob()||a.i.i.indexOf(c.data)+1<a.i.i.length)&&!c.data.locked},object:a,S:function(a){return!a.i.readOnly}});a.M.add("vpl:message-error",{isEnabled:function(){return!1},getState:function(a){return a.Ib},object:a,S:function(a){return a.Ib&&!a.md}});a.M.add("vpl:message-warning",{isEnabled:function(){return!1},getState:function(a){return a.Ib},object:a,S:function(a){return a.Ib&&a.md}});a.M.add("vpl:message-empty",{isEnabled:function(){return!1},object:a,
S:function(a){return!a.Ib}});a.M.add("vpl:filename",{isEnabled:function(){return!1},getState:function(a){return(a.i.filename||"")+(a.username?"\n"+a.username:"")},object:a,S:function(a){return a.i.filename||a.username?!0:!1}});a.M.add("vpl:teacher",{action:function(a){a.i.ia.yb=!a.i.ia.yb;"t"===a.i.Fb?a.i.ia.Zb=a.i.ia.yb:a.i.ia.te=a.i.ia.yb;a.i.ia.yb||Xb(a)},isEnabled:function(a){return!a.i.fa&&!a.i.readOnly},Ka:function(a){return a.i.ia.yb},object:a,Sc:!0,S:function(a){return a.i.Fb!==Oa&&!a.i.readOnly},
fb:[{selected:!1},{selected:!0}]});a.M.add("vpl:teacher-reset",{action:function(a,c){c?(Xa(a.i.mode),a.i.fc=Qa,a.i.tc=Sa):(Va(),$a(a.i),a.i.pe())},isEnabled:function(a){return!a.i.fa},object:a,Sc:!0,S:function(a){return a.i.Fb!==Oa&&a.i.ia.yb&&!a.i.readOnly}});a.M.add("vpl:teacher-save",{action:function(a){a=fb(a.i,{ad:!0,dd:!1});Wb(a,"ui.vpl3ui","application/x-vpl3-ui")},isEnabled:function(a){return!a.i.fa},object:a,Sc:!0,S:function(a){return a.i.Fb!==Oa&&a.i.ia.yb&&!a.i.readOnly}});a.M.add("vpl:teacher-setasnew",
{action:function(a){var b=fb(a.i,{ad:!0,dd:!1});a.Je=a.Je===b?null:b},Ka:function(a){return a.Je===fb(a.i,{ad:!0,dd:!1})},object:a,Sc:!0,S:function(a){return a.i.Fb!==Oa&&a.i.ia.yb&&!a.i.readOnly},fb:[{selected:!1},{selected:!0}]})};function wc(a){this.h=a;this.controls=[];this.b="";this.y=this.x=0}function xc(a,b,c,d,f,e,h){a.controls.push({H:b,action:d||null,mb:f||null,kb:e||null,id:h||"",Kc:c,x:0,y:0});a.b+="X"}
function yc(a,b,c,d){a.x=b.x;a.y=b.y;for(var f=a.b.replace(/^[s ]+/,"").replace(/[s ]+$/,"").replace(/ +/g," ").replace(/s +/g,"s").replace(/ +s/g,"s").replace(/s+/g,"s"),e=0,h=0,g=0,k=0,m=0;m<f.length;m++)switch(f[m]){case "X":e+=D(c[a.controls[k].id]);k++;break;case " ":case "_":h++;break;case "s":case "S":g++}d=d?D(d):0;var q=0;if(e>=b.width)d=0;else for(;;){q=(b.width-(e+d*h))/g;if(q>=d||!(0<d))break;d/=2}k=0;e=b.x;for(m=0;m<f.length;m++)switch(f[m]){case "X":h=a.controls[k];h.x=e+c[h.id].offsetLeft();
e+=D(c[h.id]);h.y=b.y+c[h.id].offsetTop();k++;break;case " ":case "_":e+=d;break;case "s":case "S":e+=q}}
function zc(a,b,c,d){Ac(a.h,function(c){Bc(b,c,a.x,a.y)});a.controls.forEach(function(b){Cc(this.h,b.x,b.y,c[b.id],function(c,d,f){var e=Math.min(d.width/(b.Kc.pa-b.Kc.W),d.height/(b.Kc.ma-b.Kc.X));c.save();c.translate(-b.Kc.W,-b.Kc.X);1!==e&&(c.scale(e,e),d=d.lb(),d.width/=e,d.height/=e);f=b.H(c,d,f);c.restore();f&&Dc(a.h,0,0,d.width,d.height,["button"],["button"])},b.action,b.mb,b.kb,d?function(){d(b.id)}:null,b.id)},a)};function Vb(a,b,c,d,f,e,h,g,k,m,q){function n(a,d,e){b.save();e&&(b.scale(-1,1),b.translate(-2*a-c.c,0));b.fillStyle=m&&g?l.xa:l.ta;b.fillRect(a,d,c.c,c.c);b.fillStyle=g?l.O:l.aa;b.beginPath();b.moveTo(a+.1*c.c,d+.6*c.c);b.lineTo(a+.4*c.c,d+.6*c.c);b.lineTo(a+.25*c.c,d+.34*c.c);b.closePath();b.fill();b.beginPath();b.arc(a+.5*c.c,d+.83*c.c,.4*c.c,4.2,5.6);b.strokeStyle=b.fillStyle;b.lineWidth=.08*c.c;b.stroke();b.restore()}function r(a,d,e){var f=c.c;b.save();b.fillStyle=m?l.xa:l.ta;b.fillRect(a,d,
f,f);b.translate(a+f/2,d+f/2);b.rotate(-e*Math.PI/2);b.translate(-a-f/2,-d-f/2);b.beginPath();b.moveTo(a+.3557*f,d+.25*f);b.lineTo(a+.3557*f,d+.75*f);b.lineTo(a+.7887*f,d+.5*f);b.closePath();b.strokeStyle=l.O;b.lineWidth=2*c.va;b.stroke();b.restore()}function u(){b.beginPath();b.moveTo(0,.5*c.c);b.lineTo(.5*c.c,.5*c.c);b.lineTo(.5*c.c,-.25*c.c);b.bezierCurveTo(.3*c.c,-.5*c.c,.02*c.c,-.5*c.c,0,-.5*c.c);b.lineTo(0,-.5*c.c);b.bezierCurveTo(-.02*c.c,-.5*c.c,-.3*c.c,-.5*c.c,-.5*c.c,-.25*c.c);b.lineTo(-.5*
c.c,.5*c.c);b.closePath();b.fillStyle=g?l.O:l.aa;b.fill()}var l={ta:"navy",xa:"#37f",Zc:"#06f",O:"white",aa:"#777",uc:"#44a",Ff:"#ddf",Od:"#99a",Ae:"#a00",zf:"#d10",Be:"#d00",Af:"#f50",Pd:"#c66",Gf:"#800"};l={ta:"white",xa:"#ddd",Zc:"white",O:"#333",aa:"#999",uc:"#ddd",Ff:"#555",Od:"#666",Ae:"#fcc",zf:"#fcc",Be:"#faa",Af:"#faa",Pd:"#866",Gf:"#faa"};var p={"vpl:close":function(){b.fillStyle=m&&g?l.xa:l.ta;b.fillRect(0,0,.5*c.c,c.c);b.beginPath();b.moveTo(.1*c.c,.1*c.c);b.lineTo(.4*c.c,.4*c.c);b.moveTo(.1*
c.c,.4*c.c);b.lineTo(.4*c.c,.1*c.c);b.strokeStyle=g?l.O:l.aa;b.lineWidth=c.va;b.stroke()},"vpl:about":function(){b.fillStyle=m&&g?l.xa:l.ta;b.fillRect(0,0,c.c,c.c);b.textAlign="center";b.textBaseline="middle";b.font="bold "+Math.round(.7*c.c).toString(10)+"px times";b.fillStyle=g?l.O:l.aa;b.fillText("i",.5*c.c,.5*c.c)},"vpl:help":function(){b.fillStyle=m&&g?l.xa:l.ta;b.fillRect(0,0,c.c,c.c);b.textAlign="center";b.textBaseline="middle";b.font="bold "+Math.round(.7*c.c).toString(10)+"px times";b.fillStyle=
g?l.O:l.aa;b.fillText("?",.5*c.c,.5*c.c)},"vpl:readonly":function(){var a=c.c;b.save();b.fillStyle=l.Od;b.strokeStyle=l.Od;b.lineWidth=c.va;b.translate(.5*a,.7*a);b.save();b.rotate(.6);b.beginPath();b.moveTo(-.015/.22*a,.07*a);b.lineTo(0,.22*a);b.lineTo(.015/.22*a,.07*a);b.fill();b.beginPath();b.moveTo(-.1*a,-.4*a);b.lineTo(-.1*a,0);b.lineTo(0,.22*a);b.lineTo(.1*a,0);b.lineTo(.1*a,-.4*a);b.restore();b.moveTo(-.2*a,-.4*a);b.lineTo(.4*a,.2*a);b.stroke();b.restore()},"vpl:new":function(){b.fillStyle=
m&&g?l.xa:l.ta;b.fillRect(0,0,c.c,c.c);b.beginPath();b.moveTo(.25*c.c,.2*c.c);b.lineTo(.25*c.c,.8*c.c);b.lineTo(.75*c.c,.8*c.c);b.lineTo(.75*c.c,.3*c.c);b.lineTo(.65*c.c,.2*c.c);b.closePath();b.moveTo(.65*c.c,.2*c.c);b.lineTo(.65*c.c,.3*c.c);b.lineTo(.75*c.c,.3*c.c);b.strokeStyle=g?l.O:l.aa;b.lineWidth=c.va;b.stroke()},"vpl:save":function(){b.fillStyle=m&&g?l.xa:l.ta;b.fillRect(0,0,c.c,c.c);b.beginPath();b.moveTo(.25*c.c,.2*c.c);b.lineTo(.25*c.c,.7*c.c);b.lineTo(.67*c.c,.7*c.c);b.lineTo(.67*c.c,.27*
c.c);b.lineTo(.6*c.c,.2*c.c);b.closePath();b.moveTo(.6*c.c,.2*c.c);b.lineTo(.6*c.c,.27*c.c);b.lineTo(.67*c.c,.27*c.c);b.strokeStyle=g?l.O:l.aa;b.lineWidth=c.va;b.stroke();b.lineWidth=1.5*c.va;b.beginPath();b.moveTo(.8*c.c,.5*c.c);b.lineTo(.8*c.c,.8*c.c);b.moveTo(.7*c.c,.7*c.c);b.lineTo(.8*c.c,.8*c.c);b.lineTo(.9*c.c,.7*c.c);b.stroke()},"vpl:exportToHTML":function(){b.fillStyle=m&&g?l.xa:l.ta;b.fillRect(0,0,c.c,c.c);b.strokeStyle=g?l.O:l.aa;b.lineWidth=1.5*c.va;b.beginPath();b.moveTo(.8*c.c,.2*c.c);
b.lineTo(.8*c.c,.5*c.c);b.moveTo(.7*c.c,.4*c.c);b.lineTo(.8*c.c,.5*c.c);b.lineTo(.9*c.c,.4*c.c);b.textAlign="center";b.textBaseline="middle";b.font="bold "+Math.round(.3*c.c).toString(10)+"px sans-serif";b.fillStyle=g?l.O:l.aa;b.fillText("HTML",.5*c.c,.7*c.c);b.stroke()},"vpl:load":function(){b.fillStyle=m&&g?l.xa:l.ta;b.fillRect(0,0,c.c,c.c);b.beginPath();b.moveTo(.25*c.c,.2*c.c);b.lineTo(.25*c.c,.7*c.c);b.lineTo(.67*c.c,.7*c.c);b.lineTo(.67*c.c,.27*c.c);b.lineTo(.6*c.c,.2*c.c);b.closePath();b.moveTo(.6*
c.c,.2*c.c);b.lineTo(.6*c.c,.27*c.c);b.lineTo(.67*c.c,.27*c.c);b.strokeStyle=g?l.O:l.aa;b.lineWidth=c.va;b.stroke();b.lineWidth=1.5*c.va;b.beginPath();b.moveTo(.8*c.c,.55*c.c);b.lineTo(.8*c.c,.85*c.c);b.moveTo(.7*c.c,.65*c.c);b.lineTo(.8*c.c,.55*c.c);b.lineTo(.9*c.c,.65*c.c);b.stroke()},"vpl:upload":function(){b.fillStyle=m&&g?l.xa:l.ta;b.fillRect(0,0,c.c,c.c);b.beginPath();b.moveTo(.25*c.c,.25*c.c);b.lineTo(.25*c.c,.75*c.c);b.lineTo(.67*c.c,.75*c.c);b.lineTo(.67*c.c,.32*c.c);b.lineTo(.6*c.c,.25*
c.c);b.closePath();b.moveTo(.6*c.c,.25*c.c);b.lineTo(.6*c.c,.32*c.c);b.lineTo(.67*c.c,.32*c.c);b.strokeStyle=g?l.O:l.aa;b.lineWidth=c.va;b.stroke();var a=.15;if("uploaded"===q||"canUploadAgain"===q)b.beginPath(),b.moveTo(.7*c.c,.1*c.c),b.lineTo(.7*c.c,.35*c.c),b.lineTo(.9*c.c,.35*c.c),b.lineTo(.9*c.c,.16*c.c),b.lineTo(.84*c.c,.1*c.c),b.closePath(),b.fillStyle=l.Od,b.fill(),a=.4;b.lineWidth=1.5*c.va;b.beginPath();b.moveTo(.8*c.c,c.c*(a/1.5+.35));b.lineTo(.8*c.c,c.c*a);b.moveTo(.7*c.c,c.c*(a+.1));b.lineTo(.8*
c.c,c.c*a);b.lineTo(.9*c.c,c.c*(a+.1));b.stroke();b.fillStyle=g?k||m?l.O:l.uc:l.aa;b.fillRect(.1*c.c,.8*c.c,.8*c.c,.1*c.c)},"vpl:text":function(){b.fillStyle=m&&g?l.xa:l.ta;b.fillRect(0,0,c.c,c.c);b.beginPath();b.moveTo(.25*c.c,.2*c.c);b.lineTo(.25*c.c,.8*c.c);b.lineTo(.75*c.c,.8*c.c);b.lineTo(.75*c.c,.3*c.c);b.lineTo(.65*c.c,.2*c.c);b.closePath();b.moveTo(.65*c.c,.2*c.c);b.lineTo(.65*c.c,.3*c.c);b.lineTo(.75*c.c,.3*c.c);for(var a=.2;.6>a;a+=.1)b.moveTo(.3*c.c,c.c*(.2+a)),b.lineTo(.7*c.c,c.c*(.2+
a));b.strokeStyle=g?l.O:l.aa;b.lineWidth=c.va;b.stroke()},"vpl:text-toggle":function(){b.fillStyle=m&&g?l.xa:l.ta;b.fillRect(0,0,c.c,c.c);b.beginPath();b.moveTo(.28*c.c,.2*c.c);b.lineTo(.28*c.c,.7*c.c);b.lineTo(.7*c.c,.7*c.c);b.lineTo(.7*c.c,.27*c.c);b.lineTo(.63*c.c,.2*c.c);b.closePath();b.moveTo(.63*c.c,.2*c.c);b.lineTo(.63*c.c,.27*c.c);b.lineTo(.7*c.c,.27*c.c);for(var a=.1;.5>a;a+=.1)b.moveTo(.33*c.c,c.c*(.2+a)),b.lineTo(.63*c.c,c.c*(.2+a));b.strokeStyle=g?l.O:l.aa;b.lineWidth=c.va;b.stroke();
b.fillStyle=g?k||m?l.O:l.uc:l.aa;b.fillRect(.1*c.c,.8*c.c,.8*c.c,.1*c.c)},"vpl:advanced":function(){b.fillStyle=m&&g?l.xa:k?l.Zc:l.ta;b.fillRect(0,0,c.c,c.c);b.fillStyle=g?l.O:l.aa;for(var a=0;4>a;a++)for(var d=0;5>d;d++)b.fillRect(.1*c.c*(1+a)+(2>a?0:.43*c.c),.1*c.c*(2+d),.07*c.c,.07*c.c);b.fillStyle=g?k||m?l.O:l.uc:l.aa;b.fillRect(.1*c.c,.8*c.c,.8*c.c,.1*c.c)},"vpl:undo":function(){n(0,0,!1)},"vpl:redo":function(){n(0,0,!0)},"vpl:run":function(){b.fillStyle=m&&g?l.xa:l.ta;b.fillRect(0,0,c.c,c.c);
b.beginPath();b.moveTo(.3*c.c,.25*c.c);b.lineTo(.3*c.c,.75*c.c);b.lineTo(.8*c.c,.5*c.c);b.closePath();b.fillStyle=g?l.O:l.aa;b.fill();b.fillStyle=g?k||m?l.O:l.uc:l.aa;b.fillRect(.1*c.c,.8*c.c,.8*c.c,.1*c.c)},"vpl:stop":function(){b.fillStyle=m&&g?l.xa:l.ta;b.fillRect(0,0,c.c,c.c);b.fillStyle=g?l.O:l.aa;b.fillRect(.28*c.c,.28*c.c,.44*c.c,.44*c.c)},"vpl:debug":function(){b.fillStyle=m&&g?l.xa:l.ta;b.fillRect(0,0,c.c,c.c);b.strokeStyle=g?l.O:l.aa;b.lineWidth=c.va;b.save();b.translate(.5*c.c,.42*c.c);
b.scale(.0085*c.c,.012*c.c);b.beginPath();b.arc(0,0,20,0,2*Math.PI);b.moveTo(-13,-10);b.bezierCurveTo(0,-5,0,-5,13,-10);b.moveTo(0,-5);b.lineTo(0,20);b.moveTo(-18,-5);b.lineTo(-30,-10);b.moveTo(-18,2);b.lineTo(-32,6);b.moveTo(-15,10);b.lineTo(-26,18);b.moveTo(18,-5);b.lineTo(30,-10);b.moveTo(18,2);b.lineTo(32,6);b.moveTo(15,10);b.lineTo(26,18);b.restore();b.stroke();b.fillStyle=g?k||m?l.O:l.uc:l.aa;b.fillRect(.1*c.c,.8*c.c,.8*c.c,.1*c.c)},"vpl:flash":function(){var a=c.c;b.fillStyle=m&&g?l.xa:l.ta;
b.fillRect(0,0,a,a);b.save();b.translate(.6*a,.4*a);b.scale(.4,.4);u();b.restore();b.save();b.textAlign="center";b.textBaseline="middle";b.translate(.25*a,.4*a);b.rotate(-Math.PI/2);b.font="bold "+Math.round(a/4).toString(10)+"px sans-serif";b.fillStyle=g?l.O:l.aa;b.fillText("flash",0,0);b.restore();b.fillStyle=g?k||m?l.O:l.uc:l.aa;b.fillRect(.1*c.c,.8*c.c,.8*c.c,.1*c.c)},"vpl:connected":function(){function a(a,d){var e=.08*c.c;b.save();b.fillStyle=g?l.xa:l.ta;b.fillRect(a-e,d-e,2*e,2*e);b.beginPath();
b.moveTo(a-e,d-e);b.lineTo(a+e,d+e);b.moveTo(a+e,d-e);b.lineTo(a-e,d+e);b.stroke();b.restore()}g=!1;b.translate(0,.1*c.c);b.save();b.translate(.8*c.c,.2*c.c);b.scale(.35,.35);u();b.restore();b.fillStyle=g?l.O:l.aa;b.strokeStyle=g?l.O:l.aa;b.lineWidth=1.5*c.va;q&&b.strokeRect(0,.05*c.c,.3*c.c,.3*c.c);b.strokeRect(.3*c.c,.55*c.c,.4*c.c,.3*c.c);b.lineWidth=c.va;b.beginPath();b.moveTo(.7*c.c,.7*c.c);b.bezierCurveTo(.9*c.c,.7*c.c,.9*c.c,.7*c.c,.85*c.c,.35*c.c);q&&(b.moveTo(.3*c.c,.7*c.c),b.bezierCurveTo(.1*
c.c,.7*c.c,.1*c.c,.7*c.c,.15*c.c,.35*c.c));b.stroke();k||a(.86*c.c,.55*c.c);"nonmonitored"===q&&a(.14*c.c,.55*c.c)},"vpl:robot":function(){b.fillStyle=m?l.xa:l.ta;b.fillRect(0,0,c.c,c.c);switch(q){case "thymio":b.save();b.translate(c.c/2,.35*c.c);b.scale(.3,.3);b.rotate(.2);u();b.restore();break;case "thymio-tdm":b.save();b.translate(c.c/2,.35*c.c);b.scale(.3,.3);b.rotate(.2);u();b.restore();b.fillStyle=l.O;b.fillRect(.4*c.c,.65*c.c,.2*c.c,.2*c.c);break;case "sim":b.save(),b.translate(c.c/2,.35*c.c),
b.scale(.3,.3),b.rotate(.2),u(),b.beginPath(),b.strokeStyle=l.O,b.lineWidth=c.va/.3,b.strokeRect(-c.c,-.8*c.c,2*c.c,1.6*c.c),b.restore()}b.beginPath();b.moveTo(.2*c.c,.75*c.c);b.lineTo(.5*c.c,.75*c.c);b.lineTo(.5*c.c,c.c*("sim"===q?.6:.3));b.strokeStyle=l.O;b.lineWidth=c.va;b.stroke()},"vpl:sim":function(){b.fillStyle=m&&g?l.xa:l.ta;b.fillRect(0,0,c.c,c.c);b.save();b.translate(c.c/2,.35*c.c);b.scale(.4,.4);b.rotate(.2);u();b.beginPath();b.arc(c.c,.5*c.c,1.4*c.c,-3.2,-3.8,!0);b.strokeStyle=m&&g?l.Ff:
l.Od;b.lineWidth=.2*c.c;b.stroke();b.beginPath();b.arc(c.c,.5*c.c,.6*c.c,-3.3,-3.8,!0);b.stroke();b.restore()},"vpl:message-empty":function(){},"vpl:message-error":function(){if(q){b.fillStyle=e.color;b.font=Ec(e);b.textAlign="center";b.textBaseline="middle";var a=h.translate(q);b.fillText(a,e.width/2,e.height/2)}},"vpl:filename":function(){if(q){b.beginPath();var a=3*c.c;b.rect(0,0,a,c.c);b.clip();b.fillStyle=e.color;b.font=Ec(e);b.textAlign="center";b.textBaseline="middle";var d=q.trim().split("\n").slice(0,
2).map(function(c){c=c.slice(0,80);if(1<c.length&&b.measureText(c).width>a){for(;1<c.length&&b.measureText(c+"\u2026").width>a;)c=c.slice(0,-1);c+="\u2026"}return c});1<d.length?(b.fillText(d[0],e.width/2,.25*e.height),b.fillText(d[1],e.width/2,.75*e.height)):b.fillText(d[0],e.width/2,e.height/2)}},"vpl:duplicate":function(){b.fillStyle=m&&g?l.xa:l.ta;b.fillRect(0,0,c.c,c.c);b.strokeStyle=g?l.O:l.aa;b.lineWidth=c.va;b.strokeRect(.3*c.c,.3*c.c,.4*c.c,.15*c.c);b.strokeRect(.3*c.c,.55*c.c,.4*c.c,.15*
c.c)},"vpl:disable":function(){b.fillStyle=m&&g?l.xa:l.ta;b.fillRect(0,0,c.c,c.c);b.strokeStyle=g?l.O:l.aa;b.lineWidth=c.va;b.strokeRect(.3*c.c,.3*c.c,.4*c.c,.4*c.c);b.beginPath();b.moveTo(.2*c.c,.6*c.c);b.lineTo(.8*c.c,.4*c.c);b.stroke()},"vpl:lock":function(){b.fillStyle=m&&g?l.xa:l.ta;b.fillRect(0,0,c.c,c.c);b.strokeStyle=g?l.O:l.aa;b.fillStyle=g?l.O:l.aa;b.lineWidth=c.va;b.strokeRect(.3*c.c,.3*c.c,.4*c.c,.4*c.c);Fc(b,.5*c.c,.52*c.c,.04*c.c,l.O)},"vpl:trashcan":function(){b.fillStyle=m&&g?l.xa:
l.ta;b.fillRect(0,0,c.c,c.c);b.beginPath();b.moveTo(.25*c.c,.2*c.c);b.lineTo(.32*c.c,.8*c.c);b.lineTo(.68*c.c,.8*c.c);b.lineTo(.75*c.c,.2*c.c);b.closePath();b.strokeStyle=g?l.O:l.aa;b.lineWidth=c.va;b.stroke()},"vpl:teacher-reset":function(){b.fillStyle=m&&g?l.Be:l.Ae;b.fillRect(0,0,c.c,c.c);b.beginPath();b.moveTo(.25*c.c,.2*c.c);b.lineTo(.25*c.c,.8*c.c);b.lineTo(.75*c.c,.8*c.c);b.lineTo(.75*c.c,.3*c.c);b.lineTo(.65*c.c,.2*c.c);b.closePath();b.moveTo(.65*c.c,.2*c.c);b.lineTo(.65*c.c,.3*c.c);b.lineTo(.75*
c.c,.3*c.c);b.strokeStyle=g?l.O:l.Pd;b.lineWidth=c.va;b.stroke();b.fillStyle=g?l.O:l.Pd;Gc(b,.63*c.c,.7*c.c,.2*c.c)},"vpl:teacher-save":function(){b.fillStyle=m&&g?l.Be:l.Ae;b.fillRect(0,0,c.c,c.c);b.strokeStyle=g?l.O:l.Pd;b.beginPath();b.moveTo(.25*c.c,.2*c.c);b.lineTo(.25*c.c,.7*c.c);b.lineTo(.67*c.c,.7*c.c);b.lineTo(.67*c.c,.27*c.c);b.lineTo(.6*c.c,.2*c.c);b.closePath();b.moveTo(.6*c.c,.2*c.c);b.lineTo(.6*c.c,.27*c.c);b.lineTo(.67*c.c,.27*c.c);b.lineWidth=c.va;b.stroke();b.lineWidth=1.5*c.va;b.beginPath();
b.moveTo(.8*c.c,.5*c.c);b.lineTo(.8*c.c,.8*c.c);b.moveTo(.7*c.c,.7*c.c);b.lineTo(.8*c.c,.8*c.c);b.lineTo(.9*c.c,.7*c.c);b.stroke();b.fillStyle=g?l.O:l.Pd;Gc(b,.46*c.c,.45*c.c,.2*c.c)},"vpl:teacher-setasnew":function(){b.fillStyle=m&&g?k?l.Af:l.Be:k&&g?l.zf:l.Ae;b.fillRect(0,0,c.c,c.c);b.strokeStyle=g?l.O:l.Pd;b.beginPath();b.moveTo(.25*c.c,.2*c.c);b.lineTo(.25*c.c,.7*c.c);b.lineTo(.67*c.c,.7*c.c);b.lineTo(.67*c.c,.27*c.c);b.lineTo(.6*c.c,.2*c.c);b.closePath();b.moveTo(.6*c.c,.2*c.c);b.lineTo(.6*c.c,
.27*c.c);b.lineTo(.67*c.c,.27*c.c);b.lineWidth=c.va;b.stroke();b.lineWidth=1.5*c.va;b.beginPath();b.moveTo(.8*c.c,.5*c.c);b.lineTo(.5*c.c,.5*c.c);b.moveTo(.6*c.c,.4*c.c);b.lineTo(.5*c.c,.5*c.c);b.lineTo(.6*c.c,.6*c.c);b.stroke();b.fillStyle=g?k||m?l.O:l.Gf:l.aa;b.fillRect(.1*c.c,.8*c.c,.8*c.c,.1*c.c)},"vpl:teacher":function(){b.fillStyle=m&&g?k?l.Af:l.Be:k&&g?l.zf:l.Ae;b.fillRect(0,0,c.c,c.c);b.fillStyle=g?l.O:l.Pd;Gc(b,.5*c.c,.4*c.c,.27*c.c);b.fillStyle=g?k||m?l.O:l.Gf:l.aa;b.fillRect(.1*c.c,.8*
c.c,.8*c.c,.1*c.c)},"src:vpl":function(){b.save();b.fillStyle=m&&g?l.xa:l.ta;b.fillRect(0,0,c.c,c.c);b.beginPath();b.moveTo(.25*c.c,.2*c.c);b.lineTo(.25*c.c,.8*c.c);b.lineTo(.75*c.c,.8*c.c);b.lineTo(.75*c.c,.3*c.c);b.lineTo(.65*c.c,.2*c.c);b.closePath();b.moveTo(.65*c.c,.2*c.c);b.lineTo(.65*c.c,.3*c.c);b.lineTo(.75*c.c,.3*c.c);b.strokeStyle=g?l.O:l.aa;b.lineWidth=c.va;b.stroke();b.fillStyle=m&&g?l.O:l.Od;for(var a=.15;.6>a;a+=.15)b.fillRect(.3*c.c,c.c*(.2+a),.4*c.c,.1*c.c);b.restore()},"src:locked":function(){b.save();
b.fillStyle=g?m?l.xa:k?l.Zc:l.ta:l.ta;b.fillRect(0,0,c.c,c.c);b.strokeStyle=g?l.O:l.aa;b.lineWidth=c.va;b.fillStyle=g?k?l.Ff:l.Od:l.aa;for(var a=.15;.6>a;a+=.15)b.fillRect(.15*c.c,c.c*a,.4*c.c,.1*c.c);Fc(b,.77*c.c,.36*c.c,.06*c.c,g?l.O:l.aa,!k);b.fillStyle=g?k||m?l.O:l.uc:l.aa;b.fillRect(.1*c.c,.8*c.c,.8*c.c,.1*c.c);b.restore()},"src:language":function(){var a=c.c;b.save();b.fillStyle=g?m?l.xa:l.ta:l.ta;b.fillRect(0,0,a,a);b.beginPath();for(var d=0;3>d;d++)b.moveTo(.2*a,a*(.2+.1*d)),b.lineTo(.5*a,
a*(.2+.1*d));b.strokeStyle=g?l.O:l.aa;b.lineWidth=c.va;b.stroke();for(d=0;3>d;d++){var e=2*(d+.25)/3*Math.PI;Hc(b,.75*a,.3*a,.15*a,e-.3*Math.PI,e+.3*Math.PI,{Jd:!1,Yc:3*c.va,style:g?l.O:l.aa})}b.textAlign="center";b.textBaseline="middle";b.font="bold "+Math.round(a/3).toString(10)+"px sans-serif";b.fillStyle=g?l.O:l.aa;b.fillText({aseba:"Aa",l2:"l2",asm:"asm",js:"js",python:"Py"}[q],.5*a,.7*a);b.restore()},"src:disass":function(){var a=c.c;b.save();b.fillStyle=g&&m?l.xa:k?l.Zc:l.ta;b.fillRect(0,0,
a,a);b.beginPath();b.moveTo(.2*a,.2*a);b.lineTo(.3*a,.2*a);for(var d=0;5>d;d++)b.moveTo(.4*a,a*(.2+.1*d)),b.lineTo(.45*a,a*(.2+.1*d)),b.moveTo(.55*a,a*(.2+.1*d)),b.lineTo(.65*a,a*(.2+.1*d));b.strokeStyle=g?l.O:l.aa;b.lineWidth=c.va;b.stroke();b.fillStyle=g&&(k||m)?l.O:l.uc;b.fillRect(.1*c.c,.8*c.c,.8*c.c,.1*c.c);b.restore()},"sim:restart":function(){b.save();b.fillStyle=m?l.xa:l.ta;b.fillRect(0,0,e.width,e.height);var a=c.c;b.lineWidth=.05*a;Hc(b,.5*a,.5*a,.25*a,1.56,0,{Jd:!1,Yc:.2*a,style:l.O});
b.restore()},"sim:pause":function(){b.save();b.fillStyle=m?l.xa:k?l.Zc:l.ta;b.fillRect(0,0,c.c,c.c);b.fillStyle=g?l.O:l.aa;b.fillRect(.28*c.c,.28*c.c,.15*c.c,.44*c.c);k?(b.beginPath(),b.moveTo(.54*c.c,.28*c.c),b.lineTo(.62*c.c,.28*c.c),b.lineTo(.75*c.c,.5*c.c),b.lineTo(.62*c.c,.72*c.c),b.lineTo(.54*c.c,.72*c.c),b.fill()):b.fillRect(.57*c.c,.28*c.c,.15*c.c,.44*c.c);b.restore()},"sim:speedup":function(){b.save();b.fillStyle=m&&g?l.xa:k?l.Zc:l.ta;b.fillRect(0,0,c.c,c.c);b.fillStyle=g?l.O:l.aa;b.beginPath();
for(var a=0;2>a;a++)b.moveTo(c.c*(.3+.22*a),.25*c.c/2),b.lineTo(c.c*(.3+.22*a),.75*c.c/2),b.lineTo(c.c*(.5+.22*a),.5*c.c/2),b.closePath();b.fill();b.textAlign="center";b.textBaseline="middle";b.font="bold "+Math.round(c.c/3).toString(10)+"px sans-serif";b.fillText(1<=q?"\u00d7"+q.toString(10):"\u00f7"+Math.round(1/q).toString(10),.5*c.c,.7*c.c);b.restore()},"sim:noise":function(){b.save();b.fillStyle=m&&g?l.xa:k?l.Zc:l.ta;b.fillRect(0,0,c.c,c.c);b.beginPath();var a=[.58,1.48,.96,.39,1.36,.09,-.75,
-1.58,-.32,-1.36,-1.39,-.94,-1.1,-1.04,-.1,.93,1.22,.6,.89,.61];b.moveTo(.1*c.c,(.4+.1*a[0])*c.c);for(var d=1;d<a.length;d++)b.lineTo((.1+.8/(a.length-1)*d)*c.c,(.4+.1*a[d])*c.c);b.strokeStyle=g?l.O:l.aa;b.lineWidth=c.va;b.stroke();b.fillStyle=g?k||m?l.O:l.uc:l.aa;b.fillRect(.1*c.c,.8*c.c,.8*c.c,.1*c.c);b.restore()},"sim:pen":function(){var a=c.c;b.save();b.fillStyle=m&&g?l.xa:k?l.Zc:l.ta;b.fillRect(0,0,a,a);b.fillStyle=g?k||m?l.O:l.uc:l.aa;b.fillRect(.1*a,.8*a,.8*a,.1*a);b.translate(.5*a,a*(.4+(k?
.13:0)));b.beginPath();b.moveTo(-.015/.22*a,.07*a);b.lineTo(0,.22*a);b.lineTo(.015/.22*a,.07*a);b.fillStyle=g?l.O:l.aa;b.fill();b.beginPath();b.moveTo(-.1*a,-.22*a);b.lineTo(-.1*a,0);b.lineTo(0,.22*a);b.lineTo(.1*a,0);b.lineTo(.1*a,-.22*a);b.strokeStyle=g?l.O:l.aa;b.lineWidth=c.va;b.stroke();b.restore()},"sim:clear":function(){var a=c.c;b.save();b.fillStyle=m&&g?l.xa:l.ta;b.fillRect(0,0,a,a);b.strokeStyle=g?l.O:l.aa;b.lineWidth=c.va;b.strokeRect(.15*a,.25*a,.7*a,.5*a);b.translate(.5*a,.4*a);b.rotate(.4);
b.fillStyle=g?l.O:l.aa;b.fillRect(0,0,.3*a,.2*a);b.restore()},"sim:map-kind":function(){var a=c.c,d=c.va;b.save();b.fillStyle=m&&g?l.xa:l.ta;b.fillRect(0,0,c.c,c.c);b.lineWidth=d;b.strokeStyle=g?l.O:l.aa;b.fillStyle=g?l.O:l.aa;for(var e=["ground","height","obstacles"].indexOf(q),f=0;3>f;f++){var h=2*(f+.25)/3*Math.PI;f===e?b.fillRect(a*(.35+.25*Math.cos(h)),a*(.39+.25*Math.sin(h)),.3*a,.22*a):b.strokeRect(a*(.35+.25*Math.cos(h)),a*(.39+.25*Math.sin(h)),.3*a,.22*a);Hc(b,.5*a,.5*a,.36*a,h-.42*Math.PI,
h-.22*Math.PI,{Jd:!1,Yc:3*d,style:l.O})}b.restore()},"sim:map":function(){var a=c.c;b.save();b.fillStyle=m&&g?l.xa:k?l.Zc:l.ta;b.fillRect(0,0,c.c,c.c);b.fillStyle=g?k||m?l.O:l.uc:l.aa;b.fillRect(.1*a,.8*a,.8*a,.1*a);b.lineWidth=c.va;b.strokeStyle=g?l.O:l.aa;b.strokeRect(.15*a,.15*a,.7*a,.5*a);switch(q){case "ground":b.lineWidth=.08*a;b.beginPath();b.arc(.6*a,.4*a,.15*a,-.5*Math.PI,.5*Math.PI);b.lineTo(.4*a,.55*a);b.arc(.4*a,.4*a,.15*a,.5*Math.PI,1.5*Math.PI);b.closePath();b.stroke();break;case "height":b.beginPath();
for(var d=0;.75>=d;d+=.25)for(var e=0;1>=e;e+=.1){var f=a*(.2+.5*e+.15*d),h=a*(.5-.3*d-.2*(.2*Math.cos(5*e+2*d-3)-(d-.9)*(d-.9)/3));0===e?b.moveTo(f,h):b.lineTo(f,h)}b.stroke();break;case "obstacles":b.strokeRect(.2*a,.2*a,.6*a,.4*a),b.beginPath(),b.moveTo(.4*a,.2*a),b.lineTo(.4*a,.43*a),b.moveTo(.6*a,.6*a),b.lineTo(.6*a,.37*a),b.stroke()}b.restore()},"sim:map-ground":function(){q="ground";p["sim:map"]()},"sim:map-height":function(){q="height";p["sim:map"]()},"sim:map-obstacles":function(){q="obstacles";
p["sim:map"]()},"sim-event:forward":function(){r(0,0,1)},"sim-event:backward":function(){r(0,0,3)},"sim-event:left":function(){r(0,0,2)},"sim-event:right":function(){r(0,0,0)},"sim-event:center":function(){var a=c.c;b.save();b.fillStyle=m?l.xa:l.ta;b.fillRect(0,0,a,a);b.beginPath();b.arc(.5*a,.5*a,.25*a,0,2*Math.PI);b.strokeStyle=l.O;b.lineWidth=2*c.va;b.stroke();b.restore()},"sim-event:clap":function(){var a=c.c;b.save();b.fillStyle=m?l.xa:l.ta;b.fillRect(0,0,a,a);b.beginPath();b.strokeStyle=l.O;
b.lineWidth=2*c.va;b.translate(.5*a,.5*a);b.rotate(.1);for(var d=0;9>d;d++)b.beginPath(),b.moveTo(.12*a,0),b.lineTo(.24*a,0),b.moveTo(.28*a,0),b.lineTo(.36*a,0),b.stroke(),b.rotate(Math.PI/4.5);b.restore()},"sim-event:tap":function(){var a=c.c;b.save();b.fillStyle=m?l.xa:l.ta;b.fillRect(0,0,a,a);b.beginPath();b.strokeStyle=l.O;b.lineWidth=2*c.va;b.translate(.6*a,.6*a);for(var d=1;3>=d;d++)b.beginPath(),b.arc(0,0,.15*a*d,.9*Math.PI,1.7*Math.PI),b.stroke();b.moveTo(.3*a,0);b.lineTo(0,0);b.lineTo(0,
.3*a);b.stroke();b.restore()}};p["vpl:message-warning"]=p["vpl:message-error"];p["src:close"]=p["vpl:close"];p["src:new"]=p["vpl:new"];p["src:save"]=p["vpl:save"];p["src:load"]=p["vpl:load"];p["src:run"]=p["vpl:run"];p["src:stop"]=p["vpl:stop"];p["src:connected"]=p["vpl:connected"];p["src:sim"]=p["vpl:sim"];p["src:teacher"]=p["vpl:teacher"];p["src:teacher-reset"]=p["vpl:teacher-reset"];p["sim:close"]=p["vpl:close"];p["sim:vpl"]=p["src:vpl"];p["sim:text"]=p["vpl:text"];p["sim:teacher"]=p["vpl:teacher"];
p["sim:teacher-reset"]=p["vpl:teacher-reset"];(a=p[a])&&a();return!1}function Ic(a,b){switch(a){case "vpl:close":case "src:close":case "sim:close":return{W:0,pa:b.c/2,X:0,ma:b.c};case "vpl:message-error":case "vpl:message-warning":case "vpl:message-empty":return{W:0,pa:5*b.c,X:0,ma:b.c};case "vpl:filename":return{W:0,pa:3*b.c,X:0,ma:b.c}}return{W:0,pa:b.c,X:0,ma:b.c}};function Jc(a,b,c,d,f,e){var h=0<=b.ia.b.indexOf(c);if((b.Tb?b.Tb.S:b.M.S(c))&&(b.ia.Zb||!h)){var g=a.h,k=b.M.find(c).Sc;xc(a,function(a,e,n){b.Tb?f(c,a,g.w,g.ca,d,e,b.h,b.Tb.isEnabled&&(k||!b.ia.te),b.Tb.Ka,b.Tb.Ag,b.Tb.state):f(c,a,g.w,g.ca,d,e,b.h,b.M.isEnabled(c)&&(k||!b.ia.te),b.M.Ka(c),n,b.M.getState(c));return b.Tb?b.Tb.disabled:h},e,b.ia.Zb&&!k?function(){b.ia.toggle(c);return 1}:!Fb(b.M,c)||!k&&b.ia.te?null:function(a){var d=b.M;a=a.mh;var e=d.find(c);e&&(Hb(e,a),Gb(d,c))},b.ia.Zb&&!k&&b.ia.te?
null:function(a,d){b.M.mb(c,d)},b.ia.Zb&&!k&&b.ia.te?null:function(a,d){return b.M.kb(c,d)},c)}}function Kc(a,b,c,d,f,e){a.controls=[];a.b="";for(var h=0;h<c.length;h++)switch(c[h]){case "!space":a.b+=" ";break;case "!!space":a.b+="_";break;case "!stretch":a.b+="s";break;case "!!stretch":a.b+="S";break;default:Jc(a,b,c[h],d,f,e(c[h],a.h.w,b.M.find(c[h]).Hc))}}function Lc(a,b){for(var c=0;c<b.length;c++)if("!"!==b[c][0]&&a.M.S(b[c]))return!0;return!1}
function Zb(a,b,c){for(var d={},f=0;f<b.length;f++)if("!"!==b[f][0]){var e=E(a.ca,{tag:"button",id:b[f].replace(/:/g,"-"),Y:c});d[b[f]]=e}return d}function Mc(a){var b=0,c;for(c in a)a.hasOwnProperty(c)&&(b=Math.max(b,a[c].sa()));return b};var Nc={"vpl:then":function(a,b,c,d){b=Math.min(d.width,d.height);a.strokeStyle=c.Wf;a.lineWidth=.2*b;a.beginPath();a.moveTo(-.25*b,-.5*b);a.lineTo(.25*b,0);a.lineTo(-.25*b,.5*b);a.stroke()},"vpl:error":function(a,b,c,d){b=Math.min(d.width,d.height);a.fillStyle="white";a.strokeStyle=c.Ef;a.lineWidth=.07*b;a.beginPath();a.arc(0,0,.5*b,0,2*Math.PI);a.fill();a.stroke();a.fillStyle=c.Ef;a.font="bold "+Math.round(.75*b).toString()+"px sans-serif";a.textAlign="center";a.textBaseline="middle";a.fillText("?",
0,.05*b)},"vpl:warning":function(a,b,c,d){b=Math.min(d.width,d.height);a.fillStyle="white";a.strokeStyle=c.ig;a.lineWidth=.07*b;a.beginPath();a.arc(0,0,.5*b,0,2*Math.PI);a.fill();a.stroke();a.fillStyle=c.ig;a.font="bold "+Math.round(.75*b).toString()+"px sans-serif";a.textAlign="center";a.textBaseline="middle";a.fillText("!",0,.05*b)},"vpl:moreHigh":function(a,b,c,d){b=Math.min(d.width,d.height);a.beginPath();a.moveTo(-.2*b,.1*b);a.lineTo(0,-.1*b);a.lineTo(.2*b,.1*b);a.lineWidth=.1*b;a.strokeStyle=
"black";a.shadowColor="white";a.shadowBlur=.2*b;a.stroke()},"vpl:moreLow":function(a,b,c,d){b=Math.min(d.width,d.height);a.beginPath();a.moveTo(-.2*b,-.1*b);a.lineTo(0,.1*b);a.lineTo(.2*b,-.1*b);a.lineWidth=.1*b;a.strokeStyle="black";a.shadowColor="white";a.shadowBlur=.2*b;a.stroke()},"vpl:customize":function(a,b,c,d){b=Math.min(d.width,d.height)/2;a.fillStyle=c.Wf;Gc(a,0,0,b)}};function Nb(){this.m=new Oc;this.b=new Oc;this.b.P=!0;this.h=new Oc}function Pc(a,b){return function(){a.P!==b&&(a.P=b,Ob(a))}}function Qc(a){return function(b){a.P!==b&&(a.P=b,Ob(a))}}
function Rc(a,b,c,d,f,e,h,g){function k(a){return"a"===a||"c"===a}var m=a.i,q=Math.min(d.width,d.height),n=0!=b.w.j?q/b.w.j:1;e=new Sc(c,d.width,d.height,e,h,function(a,b,e,h,k){var l=a.I;l.save();var m=a.w;a.w=Tb(q,a.w.c*n);Bc(d,l,b.x+e,b.y+h);var r=c.V,v=b.data,p=b.x+e,u=b.y+h;a.I.save();a.I.translate(p,u);r.H(a,v,d,k);a.I.restore();c.locked&&Tc(a,b.x+e,b.y+h,q,q,!0);(c.disabled||g.disabled)&&Dc(a,b.x+e,b.y+h,q,q,f,f,!c.disabled&&!g.hh);a.w=m;l.restore()},g&&g.sf||c.disabled||c.locked||c.Bb&&c.Bb.locked||
!c.V.$?g&&g.$?{$:g.$}:null:{$:c.V.$,Sa:c.V.Sa},g&&g.rf?null:function(a,c){a.data.Bb&&(m.Cb(),xa(a.data.Bb,c.data,a.data.oe,function(){m.Cb()}));b.ra&&b.ra()},g&&g.rf?null:function(a,b){return b.data instanceof z&&(k(a.data.V.type)===k(b.data.V.type)||"c"===b.data.V.type)&&a.data!==b.data});if(!(g&&g.sf||!c.V.$)){if(m.P||c.V.ae)e.u=function(a){return vc(b,a)};if(m.K||c.V.ae)e.K=function(a){return vc(b,a)}}e.Na=!(g&&g.qf);e.m=!(g&&g.Ne);e.P=Pc(a,c.V.name);Uc(b,e,Vc(b,c));return e}
function Wc(a,b,c,d,f,e){var h=new z(c,null,null);c.hb&&(h.g=c.hb());var g=a.i,k=0>("b"===g.mode?g.fc:g.tc).indexOf(c.name);a=Rc(a,b,h,d,["block","library"],f,e,{sf:!0,rf:!0,Ne:a.fa||a.readOnly,disabled:k||a.readOnly,hh:k,$:!a.ia.yb||a.fa||g.readOnly?null:function(){var a="b"===g.mode?g.fc:g.tc;0<=a.indexOf(c.name)?a.splice(a.indexOf(c.name),1):a.push(c.name);return 1}});c.hb&&(a.ua=function(a){a=a.clone();a.data=new z(c,null,null);return a})}
function Xc(a,b,c){var d=[],f=0;d=a.U.map(function(b,e){var g=a.error&&a.error.h&&(0===a.error.m.length||0<=a.error.m.indexOf(e))?a.error.Db?c.ud:c.td:c.Fa;g.width=null==b?D(1===d.length?c.Xe:c.We):D(Yc(b,0===e,c));f+=D(g);return c.Fa.width});if(0===a.U.length||!b&&null!==a.U[a.U.length-1])c.Fa.width=D(0===a.U.length?c.Xe:c.We),d.push(c.Fa.width),f+=D(c.Fa);b=D(c.Eb);var e=[],h=0;e=a.actions.map(function(b,d){var f=a.error&&!a.error.h&&(0===a.error.b.length||0<=a.error.b.indexOf(d))?a.error.Db?c.ud:
c.td:c.Fa;f.width=null==b?D(1===e.length?c.Ve:c.Ue):D(Yc(b,0===d,c));h+=D(f);return D(f)});if(0===a.actions.length||null!==a.actions[a.actions.length-1])c.Fa.width=D(0===a.actions.length?c.Ve:c.Ue),e.push(c.Fa.width),h+=D(c.Fa);return{total:f+b+h,U:d,dg:f,Gh:b,actions:e,sh:h}}function Yc(a,b,c){switch(a.V.type){case "e":return b?c.Bc:c.rc;case "a":return c.Jc;case "s":return c.eh;case "c":return c.ah;default:throw"internal";}}
function Zc(a,b){switch(a.verticalAlign){case "middle":return(b.height-a.sa())/2;case "bottom":return b.height-a.sa();case "top":return 0;default:return b.height-a.sa()-a.verticalAlign}}
function $c(a,b,c,d,f,e,h,g,k){var m=e,q=Xc(c,d,k),n=a.i,r=0<c.U.length&&"e"===c.U[0].V.type?k.Bc:k.rc,u=new Sc(c,ad(k.La),bd(k.La),m-k.La.paddingLeft-k.Fa.offsetLeft()-r.offsetLeft(),g-k.La.paddingTop-k.Fa.offsetTop()-r.offsetTop(),function(a,b,d,g){var l=a.I;Bc(k.La,l,b.x+d,b.y+g,!0);Bc(k.Eb,l,h-k.Eb.width-k.Eb.marginRight-k.Eb.paddingRight-k.Fa.offsetLeft()-k.Jc.offsetLeft()+d,b.y+(bd(k.La)-k.Eb.height)/2+g);cd(a,"vpl:then",h-D(k.Eb)/2-k.Fa.offsetLeft()-k.Jc.offsetLeft()+d,b.y+bd(k.La)/2+g,k.Eb);
c.locked&&Tc(a,b.x,b.y,b.width,b.height,!1,c.disabled?"#ddd":"");var m=b.x+d+k.La.paddingLeft;0<f&&(m+=f-q.dg);p.forEach(function(a,d){var e=c.error&&c.error.h&&(0===c.error.m.length||0<=c.error.m.indexOf(d))?c.error.Db?k.ud:k.td:k.Fa;e.width=null==a?D(1===p.length?k.Xe:k.We):D(Yc(a,0===d,k));Bc(e,l,m+e.marginLeft,b.y+g+k.La.paddingTop+k.Fa.marginTop,!0);m+=D(e)});m=b.x+d+k.La.paddingLeft+h-e;v.forEach(function(a,d){var e=c.error&&!c.error.h&&(0===c.error.b.length||0<=c.error.b.indexOf(d))?c.error.Db?
k.ud:k.td:k.Fa;e.width=null==a?D(1===v.length?k.Ve:k.Ue):D(Yc(a,0===d,k));Bc(e,l,m+e.marginLeft,b.y+g+k.La.paddingTop+k.Fa.marginTop,!0);m+=D(e)})},null,function(a,c){if(c.data instanceof wa){a=n.i.indexOf(a.data);var d=n.i.indexOf(c.data);0<=a&&0<=d&&(n.Cb(),n.i.splice(d,1),n.i.splice(a,0,c.data))}else c.data instanceof z&&(n.Cb(),xa(a.data,c.data,null,function(){n.Cb()}));b.ra&&b.ra()},function(a,b){return b.data instanceof wa?b.data!==a.data:b.data.Bb!==a.data&&("a"===n.mode||0===a.data.U.length||
b.data instanceof z&&"a"===b.data.V.type)});c.disabled&&(u.h=function(a,c,d,e){Dc(b,c.x+d,c.y+e,c.width,c.height,["rule"],["rule"])});if(a.i.fa||a.i.readOnly)u.m=!1;Uc(b,u);var l,p=c.U;if(0===p.length||!d&&null!==p[p.length-1])p=p.concat(null);m=e;0<f&&(m+=f-q.dg);p.forEach(function(a,d){var e=a?Yc(a,0===d,k):1===p.length?k.Xe:k.We,f=c.error&&c.error.h&&(0===c.error.m.length||0<=c.error.m.indexOf(d))?c.error.Db?k.ud:k.td:k.Fa,h=Zc(e,f);a?(f.width=D(e),l=Rc(this,b,a,e,["block"],m,g+h,{sf:c.disabled||
this.i.fa||this.i.readOnly,qf:c.disabled||this.i.fa||this.i.readOnly,Ne:this.i.fa||this.i.readOnly})):(f.width=D(e),l=Rc(this,b,new qa("e",c,{$c:!0,index:d}),e,["block"],m,g+h,{rf:c.disabled||this.readOnly,qf:!0,Ne:!0}));u.ha.push(l);m+=D(f)},a);var v=c.actions;if(0===v.length||null!==v[v.length-1])v=v.concat(null);m=h;v.forEach(function(a,d){var e=a?Yc(a,0==d,k):1===v.length?k.Ve:k.Ue,f=c.error&&!c.error.h&&(0===c.error.b.length||0<=c.error.b.indexOf(d))?c.error.Db?k.ud:k.td:k.Fa,h=Zc(e,f);a?(f.width=
D(e),l=Rc(this,b,a,Yc(a,0===d,k),["block"],m,g+h,{sf:c.disabled||this.i.fa||this.i.readOnly,qf:c.disabled||this.i.fa||this.i.readOnly,Ne:this.i.fa||this.i.readOnly})):(f.width=D(e),l=Rc(this,b,new qa("a",c,{$c:!1,index:d}),e,["block"],m,g,{rf:n.readOnly,qf:!0,Ne:!0}));u.ha.push(l);m+=D(f)},a);Ac(b,function(){if(null!==c.error){var a=c.error.Db?k.Xg:k.ef;cd(b,c.error.Db?"vpl:warning":"vpl:error",e-k.La.paddingLeft-k.La.marginLeft-k.Fa.offsetLeft()-r.offsetLeft()-a.width/2-a.marginRight-a.paddingRight,
g+.5*r.height,a)}})}function dd(a,b,c,d,f,e){var h=e?f.Xg:f.ef;Ac(a,function(g){var k=ed(a.ca,{tag:"conflict-line",Y:[e?"warning":"error"]}),m=b-f.La.paddingLeft-f.La.marginLeft-f.Fa.offsetLeft()-f.Bc.offsetLeft()-h.width/2-h.marginRight-h.paddingRight,q=c+(f.Fa.height+h.height)/2,n=d+(f.Fa.height-h.height)/2;g.beginPath();g.moveTo(m,q);g.lineTo(m,n);k.stroke(g);g.beginPath();g.arc(m,q,k.lineWidth,0,Math.PI);k.stroke(g);g.beginPath();g.arc(m,n,k.lineWidth,-Math.PI,0);k.stroke(g)})}
function Yb(a,b){var c={};a=window.matchMedia&&window.matchMedia("(pointer: coarse)").matches?a.i.K:a.i.P;c.Ca=E(b,{tag:"view",Y:["vpl"]});c.cg=E(b,{tag:"separator",Y:["vpl","top"]});c.bg=E(b,{tag:"separator",Y:["vpl","bottom"]});c.lc=E(b,{tag:"toolbar",Y:["vpl","top"]});c.ld=E(b,{tag:"toolbar",Y:["vpl","bottom"]});c.Ma=E(b,{tag:"vpl",id:"scrolling-vpl"});c.Bc=E(b,{tag:"block",Y:["event","event-main"],nb:a?["small"]:[]});c.rc=E(b,{tag:"block",Y:["event","event-aux"],nb:a?["small"]:[]});c.Jc=E(b,{tag:"block",
Y:["action"],nb:a?["small"]:[]});c.eh=E(b,{tag:"block",Y:["state"],nb:a?["small"]:[]});c.ah=E(b,{tag:"block",Y:["comment"],nb:a?["small"]:[]});c.vh=E(b,{tag:"block",Y:["event","empty"],nb:a?["small"]:[]});c.Ue=E(b,{tag:"block",Y:["action","empty"],nb:a?["small"]:[]});c.Xe=E(b,{tag:"block",Y:["event","empty"],nb:a?["only-child","small"]:["only-child"]});c.We=E(b,{tag:"block",Y:["event","event-aux","empty"],nb:a?["small"]:[]});c.Ve=E(b,{tag:"block",Y:["action","empty"],nb:a?["only-child","small"]:["only-child"]});
c.Fa=E(b,{tag:"block-container"});c.td=E(b,{tag:"block-container",Y:["error"]});c.ud=E(b,{tag:"block-container",Y:["warning"]});c.La=E(b,{tag:"rule",nb:a?["small"]:[]});c.Eb=E(b,{tag:"widget",id:"widget-then",nb:a?["small"]:[]});c.Ce=E(b,{tag:"block",Y:["library","event"]});c.be=E(b,{tag:"block",Y:["library","action"]});c.fh=E(b,{tag:"block",Y:["library","state"]});c.bh=E(b,{tag:"block",Y:["library","comment"]});c.Qa=E(b,{tag:"block-library",Y:["event"]});c.Ua=E(b,{tag:"block-library",Y:["action"]});
c.ef=E(b,{tag:"widget",id:"widget-error",nb:a?["small"]:[]});c.Xg=E(b,{tag:"widget",id:"widget-warning",nb:a?["small"]:[]});return c}function nc(a){var b=a.ia,c=a.i;c.ac(c.rb);a.Ib="";a.md=!1;if(!b.yb)for(b=0;b<c.i.length;b++)if(c.i[b].error)if(c.i[b].error.Db)a.Ib||(a.Ib=c.i[b].error.u,a.md=!0);else{a.Ib=c.i[b].error.u;a.md=!1;break}}function $b(a,b,c,d,f,e){var h=new wc(a.da);Kc(h,a,b,c,a.i.Gd||Vb,a.i.ue||Ic);yc(h,d,e,f);return h}
function Ob(a){function b(a,b){switch(b.type){case "e":return a.Ce;case "a":return a.be;case "s":return a.fh;case "c":return a.bh;default:throw"internal";}}var c=a.ia,d=a.da,f=a.i,e=Yb(a,d.ca);fd(d);nc(a);f.P=d.w.j<d.w.Cg;f.K=d.w.j<d.w.Dg;var h=gd(d),g=d.state.uh,k=Lc(a,a.m),m=ab(f),q=0,n=0;f.i.forEach(function(a){a=Xc(a,m,e);q=Math.max(q,a.dg);n=Math.max(n,a.sh)});var r=0,u=0;Za.forEach(function(a){if(c.yb||0<=("b"===f.mode?f.fc:f.tc).indexOf(a.name))switch(a.type){case "e":case "s":r++;break;case "a":case "c":u++}},
a);hd(d,function(b,c,d){if(a.M.kb("vpl:trashcan",c)){b=K-e.La.offsetLeft()-e.Fa.offsetLeft()-e.Bc.offsetLeft();var f=D(e.La);if(d<b||d>b+f)return a.M.mb("vpl:trashcan",c),!0}return!1});var l=Zb(a,a.o,["vpl","top"]),p=Mc(l),v=Zb(a,a.m,["vpl","bottom"]),F=Mc(v);e.Ca.yc(h.width);e.Ca.jc(h.height);e.Ca.setPosition(0,0);e.lc.yc(e.Ca.width);e.lc.height=p;e.lc.setPosition(e.Ca.x,e.Ca.y);e.Qa.jc(e.Ca.height-e.lc.sa());var x=Math.max(Math.floor(e.Qa.height/e.Ce.sa()),1);p=e.Qa.scroll?1:Math.ceil(r/x);e.Qa.width=
p*D(e.Ce);e.Qa.setPosition(e.Ca.x,e.Ca.y+e.lc.sa());e.Ua.jc(e.Ca.height-e.lc.sa());var t=e.Ua.scroll?1:Math.ceil(u/x);e.Ua.width=t*D(e.be);e.Ua.setPosition(e.Ca.x+e.Ca.width-D(e.Ua),e.Ca.y+e.lc.sa());e.ld.yc(e.Ca.width-D(e.Qa)-D(e.Ua));e.ld.height=F;e.ld.setPosition(e.Ca.x+D(e.Qa),e.Ca.y+e.Ca.height-e.ld.sa());e.Ma.yc(e.Ca.width-D(e.Qa)-D(e.Ua));e.Ma.jc(e.Ca.height-e.lc.sa()-(k?e.ld.sa():0));e.Ma.setPosition(e.Ca.x+D(e.Qa),e.Ca.y+e.lc.sa());e.Fa.width=e.td.width=e.ud.width=D(e.Bc);e.Fa.height=e.td.height=
e.ud.height=e.Bc.sa();F=D(e.Eb);x=q+n+F;var K=e.Ca.x+(e.Ca.width-x+D(e.ef))/2,Y=K+q+F;e.La.width=x;e.La.height=e.Fa.sa();d.ab=[];Ac(d,function(a){e.Ca.H(a)});zc($b(a,a.o,["vpl","top"],e.lc,e.cg,l),e.lc,l,Qc(a));0<k&&zc($b(a,a.m,["vpl","bottom"],e.ld,e.bg,v),e.ld,v,Qc(a));var O=e.Ce.sa(),va=e.be.sa(),La=0,sa=0;if(e.Qa.scroll){La=D(e.Ce);g.b.jc(r*O);e.Qa.width=La;e.Qa.height=e.Qa.height;g.b.resize(e.Qa.x,e.Qa.y,e.Qa.width,e.Qa.height);Ac(d,function(a){e.Qa.H(a)});g.b.Ld(d);var L=0;Za.forEach(function(a){if(("e"===
a.type||"s"===a.type)&&(c.yb||0<=("b"===f.mode?f.fc:f.tc).indexOf(a.name))){var g=b(e,a);Wc(this,d,a,g,e.Qa.x+g.offsetLeft(),e.Qa.y+g.offsetTop()+L*O);L++}},a);g.b.end();Ac(d,function(){var a=E(d.ca,{tag:"widget",id:"widget-moreHigh"}),b=E(d.ca,{tag:"widget",id:"widget-moreLow"});id(g.b)||cd(d,"vpl:moreHigh",e.Qa.x+e.Qa.width/2,e.Qa.y+a.sa()/2,a);jd(g.b)||cd(d,"vpl:moreLow",e.Qa.x+e.Qa.width/2,e.Qa.y+e.Qa.height-b.sa()/2,b)})}else{Ac(d,function(a){e.Qa.H(a)});La=p*O+kd(e.Qa);var P=Math.ceil(r/p);
L=0;Za.forEach(function(g){if(("e"===g.type||"s"===g.type)&&(c.yb||0<=("b"===f.mode?f.fc:f.tc).indexOf(g.name))){var h=b(e,g),k=e.Qa.x+h.offsetLeft()+Math.floor(L/P)*O,l=e.Qa.y+h.offsetTop()+L%P*O;Wc(a,d,g,h,k,l);L++}},a)}e.Ua.scroll?(sa=D(e.be),g.h.jc(u*va),e.Ua.width=sa,e.Ua.height=e.Ua.height,g.h.resize(e.Ua.x,e.Ua.y,e.Ua.width,e.Ua.height),Ac(d,function(a){e.Ua.H(a)}),g.h.Ld(d),L=0,Za.forEach(function(a){if(("a"===a.type||"c"===a.type)&&(c.yb||0<=("b"===f.mode?f.fc:f.tc).indexOf(a.name))){var g=
b(e,a);Wc(this,d,a,g,e.Ua.x+e.be.offsetLeft(),e.Ua.y+e.be.offsetTop()+L*va);L++}},a),g.h.end(),Ac(d,function(){var a=E(d.ca,{tag:"widget",id:"widget-moreHigh"}),b=E(d.ca,{tag:"widget",id:"widget-moreLow"});id(g.h)||cd(d,"vpl:moreHigh",e.Ua.x+e.Ua.width/2,e.Ua.y+a.sa()/2,a);jd(g.h)||cd(d,"vpl:moreLow",e.Ua.x+e.Ua.width/2,e.Ua.y+e.Ua.height-b.sa()/2,b)})):(Ac(d,function(a){e.Ua.H(a)}),sa=t*va+kd(e.Ua),P=Math.ceil(u/t),L=0,Za.forEach(function(g){if(("a"===g.type||"c"===g.type)&&(c.yb||0<=("b"===f.mode?
f.fc:f.tc).indexOf(g.name))){var h=b(e,g),k=e.Ua.x+h.offsetLeft()+e.Ua.width-(t-Math.floor(L/P))*va,l=e.Ua.y+h.offsetTop()+L%P*va;Wc(a,d,g,h,k,l);L++}},a));if(c.yb){(function(){var b=e.Fa.lb();b.width=D(e.Bc);var c=e.Fa.lb();c.width=D(e.rc);var f=e.Fa.lb();f.width=D(e.Jc);var g=D(b)+D(c)+D(e.Eb)+D(f),h=e.La.lb();h.width=g;var k=e.Ca.x+(e.Ca.width-g)/2+(La-sa)/2-d.w.Uc/2,l=k+g-D(f);g=e.Ma.y+h.offsetTop()+b.offsetTop();var m=!1;g=new Sc(a,ad(h),bd(h),k-h.paddingLeft-b.offsetLeft(),g-h.paddingTop-b.offsetTop(),
function(d,g,n,v){var r=d.I;Bc(h,r,g.x+n,g.y+v,!0);Bc(e.Eb,r,l-e.Eb.width-e.Eb.marginRight-e.Eb.paddingRight-e.Fa.offsetLeft()-e.Jc.offsetLeft()+n,g.y+(bd(e.La)-e.Eb.height)/2+v);cd(d,"vpl:then",l-D(e.Eb)/2-e.Fa.offsetLeft()-e.Jc.offsetLeft()+n,g.y+bd(e.La)/2+v,e.Eb);var q=g.x+n+h.paddingLeft;Bc(b,r,q+b.marginLeft,g.y+v+h.paddingTop+b.marginTop,!0);Bc(e.Bc,r,q+b.offsetLeft()+e.Bc.marginLeft,g.y+v+h.paddingTop+b.offsetTop()+e.Bc.marginTop+Zc(e.Bc,b),!0);q+=D(b);Bc(c,r,q+c.marginLeft,g.y+v+h.paddingTop+
c.marginTop,!0);Bc(e.rc,r,q+b.offsetLeft()+e.rc.marginLeft,g.y+v+h.paddingTop+c.offsetTop()+e.rc.marginTop+Zc(e.rc,c),!0);!("a"===a.i.mode?a.i.h:a.i.b)^m&&Dc(d,q+b.offsetLeft()+e.rc.marginLeft,g.y+v+h.paddingTop+c.offsetTop()+e.rc.marginTop+Zc(e.rc,c),e.rc.width,e.rc.height,["block"],["block"],!1);q=g.x+n+e.La.paddingLeft+l-k;Bc(f,r,q+f.marginLeft,g.y+v+h.paddingTop+f.marginTop,!0);Bc(e.Jc,r,q+f.offsetLeft()+e.Jc.marginLeft,g.y+v+h.paddingTop+f.offsetTop()+e.Jc.marginTop+Zc(e.Jc,f),!0)},{$:function(a){m=
!0;C(a);return 0},Sa:function(a,b,c,d,e,f,g,h){c=a.b.getBoundingClientRect();b=h.x-c.left;h=h.y-c.top;m=b>=f&&b<f+d&&h>=g&&h<g+e;C(a)},pf:function(b){m&&("a"===a.i.mode?a.i.h=!a.i.h:a.i.b=!a.i.b);C(b)}},null,null);g.m=!1;Uc(d,g)})();var ba=E(d.ca,{tag:"widget",id:"vpl-customize"});ba.width=e.Ma.width/2;ba.height=(e.Ma.height-e.La.sa())/2;Ac(d,function(){cd(d,"vpl:customize",e.Ma.x+e.Ma.width/2,e.Ma.y+(e.Ma.height+e.La.sa())/2,ba)})}else if(f.message)Ac(d,function(a){var b=f.message.split("\n"),c=
Math.min(14,h.height/b.length);a.font=c+"px sans-serif";a.textAlign="start";a.textBaseline="top";var d=e.Ma.x+c,g=e.Ma.y+c;b.forEach(function(b,e){a.fillText(b,d,g+1.2*c*e)})});else{k=D(e.La)+e.Ma.paddingLeft+e.Ma.paddingRight+D(e.ef);g.m.yc(k);g.m.jc(f.i.length*e.La.sa());g.m.resize(e.Ma.x,e.Ma.y,e.Ma.width,e.Ma.height);Ac(d,function(a){e.Ma.H(a)});g.m.Ld(d);K+=(La-sa)/2-d.w.Uc/2;Y+=(La-sa)/2-d.w.Uc/2;k>e.Ma.width&&(K+=(k-e.Ma.width)/2+e.Ma.paddingLeft+e.Ma.marginLeft,Y+=(k-e.Ma.width)/2+e.Ma.paddingLeft+
e.Ma.marginLeft);var ta="";f.i.forEach(function(a,b){$c(this,d,a,m,d.w.xg?q:0,K,Y,e.Ma.y+e.La.sa()*b+e.La.offsetTop()+e.Fa.offsetTop(),e);if(null!==a.error&&""===ta&&(ta=a.error.u,null!==a.error.o))for(var c=b+1;c<f.i.length;c++)if(f.i[c]===a.error.o){dd(d,K,e.Ma.y+e.La.sa()*b+e.La.offsetTop()+e.Fa.offsetTop(),e.Ma.y+e.La.sa()*c+e.La.offsetTop()+e.Fa.offsetTop(),e,a.error.Db);break}},a);g.m.end();f.fa&&Ac(d,function(){Dc(d,e.Ma.x,e.Ma.y,e.Ma.width,e.Ma.height,["vpl"],["vpl"])})}a.P&&Ac(d,function(b){var c=
E(d.ca,{tag:"hint"});b.fillStyle=c.color;b.font=Ec(c);b.textAlign="start";b.textBaseline="middle";var e=a.h.translate(a.P);c.width=b.measureText(e).width;c.height=1.2*c.fontSize;Bc(c,b,c.marginLeft,h.height-c.sa()+c.marginTop,!0);b.fillText(e,c.offsetLeft(),h.height-c.sa()+c.offsetTop()+c.height/2)});f.ra&&f.ra();C(d)};function ld(){this.P={};this.m=[];this.Na={px:1,cm:96/2.54,mm:96/25.4,"in":96,pc:16,pt:96/72};this.ha={rad:1,deg:Math.PI/180,grad:Math.PI/200,turn:2*Math.PI};this.b=null}ld.prototype.K=function(){this.P={};this.m=[]};
function md(a,b,c){function d(){return b+" line "+q+" col "+n}function f(){for(;m<c.length;)if(" "===c[m]||"\t"===c[m])m++,n++;else if("\n"===c[m])m++,n=1,q++;else if("\r"===c[m])m++;else if("/*"===c.slice(m,m+2))for(m+=2,n+=2;m<c.length;)if("*/"===c.slice(m,m+2)){m+=2;n+=2;break}else m++,n++;else break}function e(){"\n"===c[m]?(n=1,q++):"\r"!==c[m]&&n++;m++}function h(){for(var a=0;m+a<c.length&&/[-_a-z0-9]/i.test(c[m+a]);)a++;m+=a;n+=a;return c.slice(m-a,m)}function g(){var a=new nd;if(!/[a-z_.#*:]/i.test(c[m]))throw"Syntax error "+
d();for(/[a-z_]/i.test(c[m])?a.tag=h():"*"===c[m]&&e();;)if("#"===c[m]){if(a.id)throw"Multiple ids in selector "+d();e();a.id=h()}else if("."===c[m])e(),a.Y.push(h());else if(":"===c[m])e(),a.nb.push(h());else break;return a}function k(){for(var a=0;m+a<c.length&&";"!==c[m+a]&&"}"!==c[m+a];)"\n"===c[m]?(q++,n=1):"\r"!==c[m]&&n++,a++;m+=a;return c.slice(m-a,m).trim()}a.P[b]=c;for(var m=0,q=1,n=1;m<c.length;){f();if(m>=c.length)break;for(var r=[];;){r.push(g());f();if(","!==c[m])break;m++;n++;f()}if("{"!==
c[m])throw"Syntax error "+d();m++;n++;for(var u={};;){for(;;){f();if(";"!==c[m])break;m++}if(m>=c.length)throw"Unclosed block "+d();if("}"===c[m]){m++;n++;break}else if(!/[a-z_]/i.test(c[m]))throw"Syntax error "+d();var l=h();f();if(":"!==c[m])throw"Missing colon "+d();m++;n++;var p=k();u[l]=a.bb(l,p)}for(l=0;l<r.length;l++)a.m.push({Zf:r[l],Tc:u})}}ld.prototype.bb=function(a,b){return b};
function od(a,b){if(/^(max|min)\(.*\)$/.test(b))return a=b.slice(4,-1).split(",").map(function(a){return od(this,a)},a),new pd(b.slice(0,3),a);b=/^(-?([0-9]+\.?|[0-9]*\.[0-9]+))([a-z]*|%)$/.exec(b);var c=1,d=qd;if(null==b)throw"Illegal length";if("%"===b[3])d=rd;else if(a.Na.hasOwnProperty(b[3]))c=a.Na[b[3]];else if("vw"===b[3])d=sd;else if("vh"===b[3])d=td;else if("vmin"===b[3])d=ud;else if("vmax"===b[3])d=vd;else if("ww"===b[3])d=wd;else if("wh"===b[3])d=xd;else if("wmin"===b[3])d=yd;else if("wmax"===
b[3])d=zd;else if(0==parseFloat(b[1]))c=0;else throw"Unknown length unit";return new Ad(parseFloat(b[1])*c,d)}
var Bd={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgreen:"#006400",
darkgrey:"#A9A9A9",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",
ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",green:"#008000",greenyellow:"#ADFF2F",grey:"#808080",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgreen:"#90EE90",lightgrey:"#D3D3D3",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",
lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",
moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",
seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32",transparent:"rgba(0,0,0,0)"};function Ad(a,b){this.T=a;this.type=b?b:qd}
var qd="abs",rd="%",sd="vw",td="vh",ud="vmin",vd="vmax",wd="ww",xd="wh",yd="wmin",zd="wmax";
Ad.prototype.N=function(a){switch(this.type){case qd:return this.T;case rd:return this.T*(a?a.u/100:1);case sd:return this.T*(a?a.h:1);case td:return this.T*(a?a.b:1);case ud:return this.T*(a?Math.min(a.h,a.b):1);case vd:return this.T*(a?Math.max(a.h,a.b):1);case wd:return this.T*(a?a.o:1);case xd:return this.T*(a?a.m:1);case yd:return this.T*(a?Math.min(a.o,a.m):1);case zd:return this.T*(a?Math.max(a.o,a.m):1);default:throw"internal";}};function pd(a,b){Ad.call(this,0);this.Aa=a;this.values=b}
pd.prototype=Object.create(Ad.prototype);pd.prototype.constructor=pd;pd.prototype.N=function(a){switch(this.Aa){case "max":return this.values.reduce(function(b,c){return Math.max(b,c.N(a))},-Infinity);case "min":return this.values.reduce(function(b,c){return Math.min(b,c.N(a))},Infinity);default:throw"internal";}};function Cd(a,b,c,d,f){this.u=a;this.h=b;this.b=c;this.o=d;this.m=f}function nd(){this.id=this.tag=null;this.Y=[];this.nb=[]}
function Dd(a,b){a=a.id?"#"+a.id:(a.tag||"")+(a.Y&&0<a.Y.length?"."+a.Y.join("."):"")+(a.nb&&0<a.nb.length?":"+a.nb.join("."):"")||"*";b&&(a+="/"+Math.round(b.u).toString(10)+","+Math.round(b.h).toString(10)+","+Math.round(b.b).toString(10)+","+Math.round(b.o).toString(10)+","+Math.round(b.m).toString(10));return a}
nd.prototype.match=function(a){if(a.tag&&this.tag&&a.tag!==this.tag||this.id&&this.id!==a.id)return!1;for(var b=0;b<this.Y.length;b++)if(void 0==a.Y||0>a.Y.indexOf(this.Y[b]))return!1;for(b=0;b<this.nb.length;b++)if(void 0==a.nb||0>a.nb.indexOf(this.nb[b]))return!1;return!0};function Lb(){ld.call(this);this.h=[];this.o={};this.u={};this.ua="none hidden dotted dashed solid double".split(" ");this.qb=["normal","italic","oblique"];this.Jb=["normal","bold"]}Lb.prototype=Object.create(ld.prototype);Lb.prototype.constructor=Lb;Lb.prototype.K=function(){ld.prototype.K.call(this);this.o={};this.u={}};Lb.prototype.defineProperties=function(){for(var a=0;a<this.m.length;a++){var b=new Ed;Fd(b,this.m[a].Tc);this.h.push({Zf:this.m[a].Zf,Pg:b})}};
Lb.prototype.bb=function(a,b){function c(a){try{od(f,a)}catch(u){return!1}return!0}function d(a){return Bd.hasOwnProperty(a)||/^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(a)||/^rgba\([^()]*\)$/.test(a)}var f=this;b=b.replace(/\s+(?=[^()]*\))/g,"");switch(a){case "margin-left":case "margin-right":case "margin-top":case "margin-bottom":case "padding-left":case "padding-right":case "padding-top":case "padding-bottom":case "border-left-width":case "border-right-width":case "border-top-width":case "border-bottom-width":case "line-width":case "width":case "height":case "min-width":case "min-height":case "max-width":case "max-height":case "font-size":return od(this,
b);case "margin":case "padding":case "border-width":switch(a=b.replace(/ +/g," ").split(" ").map(function(a){return od(f,a)}),a.length){case 1:return[a[0],a[0],a[0],a[0]];case 2:return[a[0],a[1],a[0],a[1]];case 3:return[a[0],a[1],a[2],a[1]];case 4:return a;default:throw"Wrong number of lengths";}case "border-style":case "border-left-style":case "border-right-style":case "border-top-style":case "border-bottom-style":case "line-style":if(!(0<=f.ua.indexOf(b)))throw"Unknown border style";return b;case "line-cap":if(!(0<=
["butt","round","square"].indexOf(b)))throw"Unknown line cap";return b;case "border-color":case "border-left-color":case "border-right-color":case "border-top-color":case "border-bottom-color":case "color":case "background-color":case "background":case "border-cut-background":if(!d(b))throw"Unknown border color";return b;case "border-left":case "border-right":case "border-top":case "border-bottom":case "border":case "line":var e=null,h=null,g=null;b.replace(/ +/g," ").split(" ").forEach(function(a){if(d(a))e=
a;else if(0<=f.ua.indexOf(a))h=a;else if(c(a))g=od(f,a);else throw"Illegal border property";});return{color:e,style:null===h&&(e||g)?"solid":h,width:null===g&&(e||h)?new Ad(1):g};case "border-top-left-radius":case "border-top-right-radius":case "border-bottom-right-radius":case "border-bottom-left-radius":case "border-top-left-cut":case "border-top-right-cut":case "border-bottom-left-cut":case "border-bottom-right-cut":switch(a=b.replace(/ +/g," ").split(" ").map(function(a){return od(f,a)}),a.length){case 1:return[a[0],
a[0]];case 2:return a;default:throw"Wrong number of radii";}case "border-radius":case "border-cut":switch(a=b.split("/").map(function(a){a=a.replace(/ +/g," ").split(" ").map(function(a){return"/"===a?"/":od(f,a)});switch(a.length){case 1:return[a[0],a[0],a[0],a[0]];case 2:return[a[0],a[1],a[0],a[1]];case 3:return[a[0],a[1],a[2],a[1]];case 4:return a;default:throw"Wrong number of radii";}}),a.length){case 1:return a[0].concat(a[0]);case 2:return a[0].concat(a[1]);default:throw"Wrong number of radius dimensions";
}case "font":var k="",m="",q=null,n="";b.replace(/ +/g," ").split(" ").forEach(function(a){if(null===q)if(c(a))q=od(f,a);else if(0<=f.qb.indexOf(a))k=a;else if(0<=f.Jb.indexOf(a))m=a;else throw"Unknown font style "+a;else{if(""!==n)throw"Unexpected font style after font-family";n=a}});return{fontFamily:n,fontSize:q,fontStyle:k,fontWeight:m};case "box-shadow":case "line-shadow":return b=b.split(",")[0],a=b.replace(/ +/g," ").split(" "),"inset"===a[0]&&(a=a.slice(1)),3<=a.length&&5>=a.length?{offset:[od(this,
a[0]),od(this,a[1])],color:a[a.length-1],Ye:4<=a.length?od(this,a[2]):null,vf:5<=a.length?od(this,a[3]):null}:{};case "overflow":if(0>["wrap","scroll"].indexOf(b))throw"Unknown overflow mode";return b;case "vertical-align":return 0<=["top","middle","bottom"].indexOf(b)?b:od(this,b);default:return b}};
function Gd(a,b){for(var c=null,d=0;d<a.h.length;d++)if(a.h[d].Zf.match(b)){if(c){var f=void 0;var e=a.h[d].Pg;c=c.lb();for(f in e.Tc)e.Tc.hasOwnProperty(f)&&(c.Tc[f]=e.Tc[f]);f=c}else f=a.h[d].Pg.lb();c=f}for(var h in c)c.hasOwnProperty(h)&&c[h]instanceof Ad&&(c[h]=c[h].N(a.b));return c}function E(a,b){var c=Dd(b,a.b);if(a.o[c])return a.o[c];b=Gd(a,b);b=new Sb(b,a.b);return a.o[c]=b}function ed(a,b){var c=Dd(b,a.b);if(a.u[c])return a.u[c];b=Gd(a,b);b=new Hd(b,a.b);return a.u[c]=b}
function Ed(){this.Tc={}}function Fd(a,b){for(var c in b)b.hasOwnProperty(c)&&(a.Tc[c]=b[c])}Ed.prototype.lb=function(){var a=new Ed;Fd(a,this.Tc);return a};
function Sb(a,b){this.marginBottom=this.marginTop=this.marginRight=this.marginLeft=this.y=this.x=this.height=this.width=0;this.tb=!0;this.ic=!1;this.borderBottomWidth=this.borderTopWidth=this.borderRightWidth=this.borderLeftWidth=0;this.borderBottomStyle=this.borderTopStyle=this.borderRightStyle=this.borderLeftStyle="none";this.borderBottomColor=this.borderTopColor=this.borderRightColor=this.borderLeftColor="black";this.borderTopLeftRadius=[0,0];this.borderTopRightRadius=[0,0];this.borderBottomRightRadius=
[0,0];this.borderBottomLeftRadius=[0,0];this.De=this.de=this.Fe=this.Ee=!1;this.paddingBottom=this.paddingTop=this.paddingRight=this.paddingLeft=0;this.backgroundColor=this.ze="transparent";this.color="black";this.fontFamily="sans-serif";this.fontSize=10;this.fontWeight=this.fontStyle="";this.scroll=!1;this.verticalAlign="middle";this.Rb=null;this.Wd=this.fd=0;this.shadowColor=null;a&&Id(this,a.Tc,b)}Sb.prototype=Object.create(Ed.prototype);w=Sb.prototype;w.constructor=Sb;
function Id(a,b,c){var d=-1,f=-1,e=-1,h=-1,g=1E9,k=1E9,m;for(m in b)switch(m){case "margin-left":a.marginLeft=b[m].N(c);break;case "margin-right":a.marginRight=b[m].N(c);break;case "margin-top":a.marginTop=b[m].N(c);break;case "margin-bottom":a.marginBottom=b[m].N(c);break;case "border-left-width":a.borderLeftWidth=b[m].N(c);a.tb=!1;break;case "border-right-width":a.borderRightWidth=b[m].N(c);a.tb=!1;break;case "border-top-width":a.borderTopWidth=b[m].N(c);a.tb=!1;break;case "border-bottom-width":a.borderBottomWidth=
b[m].N(c);a.tb=!1;break;case "padding-left":a.paddingLeft=b[m].N(c);break;case "padding-right":a.paddingRight=b[m].N(c);break;case "padding-top":a.paddingTop=b[m].N(c);break;case "padding-bottom":a.paddingBottom=b[m].N(c);break;case "margin":a.marginTop=b[m][0].N(c);a.marginRight=b[m][1].N(c);a.marginBottom=b[m][2].N(c);a.marginLeft=b[m][3].N(c);break;case "border-width":a.borderTopWidth=b[m][0].N(c);"none"===a.borderTopStyle&&0<a.borderTopWidth&&(a.borderTopStyle=null);a.borderRightWidth=b[m][1].N(c);
"none"===a.borderRightStyle&&0<a.borderRightWidth&&(a.borderRightStyle=null);a.borderBottomWidth=b[m][2].N(c);"none"===a.borderBottomStyle&&0<a.borderBottomWidth&&(a.borderBottomStyle=null);a.borderLeftWidth=b[m][3].N(c);"none"===a.borderLeftStyle&&0<a.borderLeftWidth&&(a.borderLeftStyle=null);break;case "padding":a.paddingTop=b[m][0].N(c);a.paddingRight=b[m][1].N(c);a.paddingBottom=b[m][2].N(c);a.paddingLeft=b[m][3].N(c);break;case "border-style":a.borderLeftStyle=b[m];a.borderRightStyle=b[m];a.borderTopStyle=
b[m];a.borderBottomStyle=b[m];break;case "border-left-style":a.borderLeftStyle=b[m];a.tb=!1;break;case "border-right-style":a.borderRightStyle=b[m];a.tb=!1;break;case "border-top-style":a.borderTopStyle=b[m];a.tb=!1;break;case "border-bottom-style":a.borderBottomStyle=b[m];a.tb=!1;break;case "border-color":a.borderLeftColor=b[m];a.borderRightColor=b[m];a.borderTopColor=b[m];a.borderBottomColor=b[m];break;case "border-left-color":a.borderLeftColor=b[m];a.tb=!1;break;case "border-right-color":a.borderRightColor=
b[m];a.tb=!1;break;case "border-top-color":a.borderTopColor=b[m];a.tb=!1;break;case "border-bottom-color":a.borderBottomColor=b[m];a.tb=!1;break;case "border-left":null!==b[m].color&&(a.borderLeftColor=b[m].color);null!==b[m].style&&(a.borderLeftStyle=b[m].style);null!==b[m].width&&(a.borderLeftWidth=b[m].width.N(c));a.tb=!1;break;case "border-right":null!==b[m].color&&(a.borderRightColor=b[m].color);null!==b[m].style&&(a.borderRightStyle=b[m].style);null!==b[m].width&&(a.borderRightWidth=b[m].width.N(c));
a.tb=!1;break;case "border-top":null!==b[m].color&&(a.borderTopColor=b[m].color);null!==b[m].style&&(a.borderTopStyle=b[m].style);null!==b[m].width&&(a.borderTopWidth=b[m].width.N(c));a.tb=!1;break;case "border-bottom":null!==b[m].color&&(a.borderBottomColor=b[m].color);null!==b[m].style&&(a.borderBottomStyle=b[m].style);null!==b[m].width&&(a.borderBottomWidth=b[m].width.N(c));a.tb=!1;break;case "border":null!==b[m].color&&(a.borderLeftColor=a.borderRightColor=a.borderTopColor=a.borderBottomColor=
b[m].color);null!==b[m].style&&(a.borderLeftStyle=a.borderRightStyle=a.borderTopStyle=a.borderBottomStyle=b[m].style);null!==b[m].width&&(a.borderLeftWidth=a.borderRightWidth=a.borderTopWidth=a.borderBottomWidth=b[m].width.N(c));a.tb=!0;break;case "border-top-left-radius":a.borderTopLeftRadius=b[m].map(function(a){return a.N(c)});a.ic=!0;break;case "border-top-right-radius":a.borderTopRightRadius=b[m].map(function(a){return a.N(c)});a.ic=!0;break;case "border-bottom-right-radius":a.borderBottomRightRadius=
b[m].map(function(a){return a.N(c)});a.ic=!0;break;case "border-bottom-left-radius":a.borderBottomLeftRadius=b[m].map(function(a){return a.N(c)});a.ic=!0;break;case "border-radius":a.borderTopLeftRadius=[b[m][0].N(c),b[m][4].N(c)];a.borderTopRightRadius=[b[m][1].N(c),b[m][5].N(c)];a.borderBottomRightRadius=[b[m][2].N(c),b[m][6].N(c)];a.borderBottomLeftRadius=[b[m][3].N(c),b[m][7].N(c)];a.ic=!0;break;case "border-top-left-cut":a.borderTopLeftRadius=b[m].map(function(a){return a.N(c)});a.Ee=!0;a.ic=
!0;break;case "border-top-right-cut":a.borderTopRightRadius=b[m].map(function(a){return a.N(c)});a.Fe=!0;a.ic=!0;break;case "border-bottom-left-cut":a.de=b[m].map(function(a){return a.N(c)});a.de=!0;a.ic=!0;break;case "border-bottom-right-cut":a.borderBottomRightRadius=b[m].map(function(a){return a.N(c)});a.De=!0;a.ic=!0;break;case "border-cut":a.borderTopLeftRadius=[b[m][0].N(c),b[m][4].N(c)];a.borderTopRightRadius=[b[m][1].N(c),b[m][5].N(c)];a.borderBottomRightRadius=[b[m][2].N(c),b[m][6].N(c)];
a.borderBottomLeftRadius=[b[m][3].N(c),b[m][7].N(c)];a.Ee=!0;a.Fe=!0;a.de=!0;a.De=!0;a.ic=!0;break;case "backdrop-color":a.ze=b[m];break;case "background-color":case "background":a.backgroundColor=b[m];break;case "color":a.color=b[m];break;case "font":a.fontFamily=b[m].fontFamily;a.fontSize=b[m].fontSize.N(c);a.fontStyle=b[m].fontStyle;a.fontWeight=b[m].fontWeight;break;case "font-family":a.fontFamily=b[m];break;case "font-size":a.fontSize=b[m].N(c);break;case "font-style":a.fontStyle=b[m];break;
case "font-weight":a.fontWeight=b[m];break;case "overflow":a.scroll="scroll"===b[m];break;case "vertical-align":a.verticalAlign=b[m]instanceof Ad?b[m].N(c):b[m];break;case "box-shadow":null!==b[m].Rb&&(a.Rb=b[m].offset.map(function(a){return a?a.N(c):0}),a.fd=b[m].Ye?b[m].Ye.N(c):0,a.Wd=b[m].vf?b[m].vf.N(c):0,a.shadowColor=b[m].color);break;case "width":d=b[m].N(c);break;case "min-width":e=b[m].N(c);break;case "max-width":g=b[m].N(c);break;case "height":f=b[m].N(c);break;case "min-height":h=b[m].N(c);
break;case "max-height":k=b[m].N(c)}d=Math.max(Math.min(d,g),e);f=Math.max(Math.min(f,k),h);0<=d&&(a.width=d);0<=f&&(a.height=f)}w.setPosition=function(a,b){this.x=a+this.offsetLeft();this.y=b+this.offsetTop()};function D(a){return a.width+kd(a)}w.sa=function(){return this.height+(this.marginTop+this.borderTopWidth+this.paddingTop+this.paddingBottom+this.borderBottomWidth+this.marginBottom)};
w.yc=function(a){this.width=a-(this.marginLeft+this.borderLeftWidth+this.paddingLeft+this.paddingRight+this.borderRightWidth+this.marginRight)};w.jc=function(a){this.height=a-(this.marginTop+this.borderTopWidth+this.paddingTop+this.paddingBottom+this.borderBottomWidth+this.marginBottom)};
w.lb=function(){var a=new Sb;a.width=this.width;a.height=this.height;a.x=this.x;a.y=this.y;a.marginLeft=this.marginLeft;a.marginRight=this.marginRight;a.marginTop=this.marginTop;a.marginBottom=this.marginBottom;a.tb=this.tb;a.ic=this.ic;a.borderLeftWidth=this.borderLeftWidth;a.borderRightWidth=this.borderRightWidth;a.borderTopWidth=this.borderTopWidth;a.borderBottomWidth=this.borderBottomWidth;a.borderLeftStyle=this.borderLeftStyle;a.borderRightStyle=this.borderRightStyle;a.borderTopStyle=this.borderTopStyle;
a.borderBottomStyle=this.borderBottomStyle;a.borderLeftColor=this.borderLeftColor;a.borderRightColor=this.borderRightColor;a.borderTopColor=this.borderTopColor;a.borderBottomColor=this.borderBottomColor;a.borderTopLeftRadius=this.borderTopLeftRadius;a.borderTopRightRadius=this.borderTopRightRadius;a.borderBottomRightRadius=this.borderBottomRightRadius;a.borderBottomLeftRadius=this.borderBottomLeftRadius;a.Ee=this.Ee;a.Fe=this.Fe;a.de=this.de;a.De=this.De;a.paddingLeft=this.paddingLeft;a.paddingRight=
this.paddingRight;a.paddingTop=this.paddingTop;a.paddingBottom=this.paddingBottom;a.ze=this.ze;a.backgroundColor=this.backgroundColor;a.color=this.color;a.fontFamily=this.fontFamily;a.fontSize=this.fontSize;a.fontStyle=this.fontStyle;a.fontWeight=this.fontWeight;a.scroll=this.scroll;a.verticalAlign=this.verticalAlign;a.Rb=this.Rb;a.fd=this.fd;a.Wd=this.Wd;a.shadowColor=this.shadowColor;return a};w.offsetLeft=function(){return this.marginLeft+this.borderLeftWidth+this.paddingLeft};
function kd(a){return a.marginLeft+a.borderLeftWidth+a.paddingLeft+a.paddingRight+a.borderRightWidth+a.marginRight}w.offsetTop=function(){return this.marginTop+this.borderTopWidth+this.paddingTop};function ad(a){return a.width+a.paddingLeft+a.paddingRight}function bd(a){return a.height+a.paddingTop+a.paddingBottom}function Ec(a){return(a.fontStyle?a.fontStyle+" ":"")+(a.fontWeight?a.fontWeight+" ":"")+a.fontSize.toFixed(1)+"px "+a.fontFamily}
function Hd(a,b){this.margin=0;this.fe=this.style=this.width=null;this.color="black";this.Rb=null;this.Wd=this.fd=0;this.shadowColor=null;this.Sf={};a&&Jd(this,a.Tc,b);null===this.width&&(this.width=null!==this.style&&"none"!==this.style?1:0);null===this.style&&(this.style=0<this.width?"solid":"none");null===this.fe&&(this.fe="butt")}Hd.prototype=Object.create(Ed.prototype);Hd.prototype.constructor=Hd;
function Jd(a,b,c){for(var d in b)switch(d){case "margin":a.margin=b[d].N(c);break;case "line-width":a.width=b[d].N(c);break;case "line-style":a.style=b[d];break;case "line-cap":a.fe=b[d];break;case "color":a.color=b[d];break;case "line":null!==b[d].color&&(a.color=b[d].color);null!==b[d].style&&(a.style=b[d].style);null!==b[d].width&&(a.width=b[d].width.N(c));break;case "line-shadow":null!==b[d].Rb&&(a.Rb=b[d].offset.map(function(a){return a?a.N(c):0}),a.fd=b[d].Ye?b[d].Ye.N(c):0,a.Wd=b[d].vf?b[d].vf.N(c):
0,a.shadowColor=b[d].color);break;default:b.hasOwnProperty(d)&&(a.Sf[d]=b[d])}}Hd.prototype.lb=function(){var a=new Hd;a.margin=this.margin;a.width=this.width;a.style=this.style;a.fe=this.fe;a.color=this.color;a.Rb=this.Rb;a.fd=this.fd;a.Wd=this.Wd;a.shadowColor=this.shadowColor;return a};var Kd=!1;function Ld(a,b,c,d){a.strokeStyle=c||"black";switch(d){case "dotted":a.setLineDash([2*b,3*b]);a.lineDashOffset=0;break;case "dashed":a.setLineDash([3*b,3*b]),a.lineDashOffset=0}a.lineWidth=b||0}
function Bc(a,b,c,d,f){function e(){var a=Math.min(h.borderTopLeftRadius[0],g/2),e=Math.min(h.borderTopLeftRadius[1],k/2);b.moveTo(c,d+e);h.Ee?b.lineTo(c+a,d):b.bezierCurveTo(c,d+e/2,c+a/2,d,c+a,d);a=Math.min(h.borderTopRightRadius[0],g/2);e=Math.min(h.borderTopRightRadius[1],k/2);b.lineTo(c+g-a,d);h.Fe?b.lineTo(c+g,d+e):b.bezierCurveTo(c+g-a/2,d,c+g,d+e/2,c+g,d+e);a=Math.min(h.borderBottomRightRadius[0],g/2);e=Math.min(h.borderBottomRightRadius[1],k/2);b.lineTo(c+g,d+k-e);h.De?b.lineTo(c+g-a,d+k):
b.bezierCurveTo(c+g,d+k-e/2,c+g-a/2,d+k,c+g-a,d+k);a=Math.min(h.borderBottomLeftRadius[0],g/2);e=Math.min(h.borderBottomLeftRadius[1],k/2);b.lineTo(c+a,d+k);h.de?b.lineTo(c,d+k-e):b.bezierCurveTo(c+a/2,d+k,c,d+k-e/2,c,d+k-e);b.closePath()}f||(c-=a.paddingLeft,d-=a.paddingTop);var h=a,g=a.width+a.paddingLeft+a.paddingRight,k=a.height+a.paddingTop+a.paddingBottom;Kd&&(b.save(),b.strokeStyle="black",b.lineWidth=1,b.strokeRect(c,d,g,k),b.strokeRect(c+a.paddingLeft,d+a.paddingTop,a.width,a.height),b.strokeRect(c-
a.marginLeft,d-a.marginTop,g+a.marginLeft+a.marginRight,k+a.marginTop+a.marginBottom),b.restore());b.save();"transparent"!==a.ze&&(b.fillStyle=a.ze,b.fillRect(c,d,g,k));b.beginPath();a.ic?(b.beginPath(),e()):b.rect(c,d,g,k);b.save();a.Rb&&(b.shadowOffsetX=a.Rb[0],b.shadowOffsetY=a.Rb[1],b.shadowColor=a.shadowColor,b.shadowBlur=a.fd);a.backgroundColor?b.fillStyle=a.backgroundColor:a.Rb&&(b.fillStyle="transparent");b.fill();b.restore();a.tb?0<a.borderLeftWidth&&a.borderLeftColor&&"none"!==a.borderLeftStyle&&
"hidden"!==a.borderLeftStyle&&(Ld(b,a.borderLeftWidth,a.borderLeftColor,a.borderLeftStyle),"double"===a.borderLeftStyle&&(b.save(),b.translate(c+g/2,d+k/2),b.scale((g-3*a.borderLeftWidth)/g,(k-3*a.borderLeftWidth)/k),b.translate(-c-g/2,-d-k/2),e(),b.restore()),b.stroke()):(0<a.borderLeftWidth&&a.borderLeftColor&&"none"!==a.borderLeftStyle&&"hidden"!==a.borderLeftStyle&&(Ld(b,a.borderLeftWidth,a.borderLeftColor,a.borderLeftStyle),b.beginPath(),b.moveTo(c,d),b.lineTo(c,d+k),b.stroke()),0<a.borderRightWidth&&
a.borderRightColor&&"none"!==a.borderRightStyle&&"hidden"!==a.borderRightStyle&&(Ld(b,a.borderRightWidth,a.borderRightColor,a.borderRightStyle),b.beginPath(),b.moveTo(c+g,d),b.lineTo(c+g,d+k),b.stroke()),0<a.borderTopWidth&&a.borderTopColor&&"none"!==a.borderTopStyle&&"hidden"!==a.borderTopStyle&&(Ld(b,a.borderTopWidth,a.borderTopColor,a.borderTopStyle),b.beginPath(),b.moveTo(c,d),b.lineTo(c+g,d),b.stroke()),0<a.borderBottomWidth&&a.borderBottomColor&&"none"!==a.borderBottomStyle&&"hidden"!==a.borderBottomStyle&&
(Ld(b,a.borderBottomWidth,a.borderBottomColor,a.borderBottomStyle),b.beginPath(),b.moveTo(c,d+k),b.lineTo(c+g,d+k),b.stroke()));b.restore()}Sb.prototype.H=function(a){Bc(this,a,this.x,this.y)};Hd.prototype.stroke=function(a){a.save();this.Rb&&(a.shadowOffsetX=this.Rb[0],a.shadowOffsetY=this.Rb[1],a.shadowColor=this.shadowColor,a.shadowBlur=this.fd);0<this.width&&this.color&&"none"!==this.style&&"hidden"!==this.style&&(Ld(a,this.width,this.color,this.style),a.lineCap=this.fe,a.stroke());a.restore()};function Sc(a,b,c,d,f,e,h,g,k,m){this.data=a;this.width=b;this.height=c;this.x=d;this.y=f;this.b=null;this.ha=[];this.o=e;this.h=null;this.m=this.Na=!0;this.ua=null;this.Pc=h||null;this.mb=g||null;this.kb=k||null;this.Df=this.bb=!1;this.P=this.doScroll=null;this.id=m||"";this.ie=this.ra=this.K=this.u=null}Sc.prototype.clone=function(){var a=new Sc(this.data,this.width,this.height,this.x,this.y,this.o,this.Pc,this.mb,this.kb,this.id);a.h=this.h;return a};
Sc.prototype.H=function(a,b,c,d,f){var e=a.I,h=this.b&&void 0===b;h&&(e.save(),e.beginPath(),e.rect(this.b.x,this.b.y,this.b.Xc,this.b.Nc),e.clip(),b=this.b.jg,c=this.b.kg);d?this.h&&this.h(a,this,b||0,c||0,f):this.o&&this.o(a,this,b||0,c||0,f);h&&e.restore()};Sc.prototype.toDataURL=function(a,b,c){var d=document.createElement("canvas");b=b||1;d.width=b*this.width;d.height=b*this.height;b=new Mb(d,{Ig:b});b.w=a;this.H(b);this.H(b,0,0,!0);return d.toDataURL(c||"image/png")};
function Md(a){return a.b?{Lb:a.b.jg,Mb:a.b.kg}:{Lb:0,Mb:0}}
function Mb(a,b){function c(a){function b(a){var b=f.b.getBoundingClientRect(),d=Md(a);a.ie=a.Pc.$(f,a.data,a.width,a.height,b.left+a.x+d.Lb,b.top+a.y+d.Mb,c);return null!==a.ie?(a.Pc.Sa&&a.Pc.Sa(f,a.data,a.ie,a.width,a.height,b.left+a.x+d.Lb,b.top+a.y+d.Mb,c),f.ra&&f.ra(),f.pb?f.pb():C(f),Nd=a.Pc.Sa?function(c,e){e?a.Pc.pf&&(a.Pc.pf(f,a.data,a.ie),f.ra&&f.ra(),f.pb?f.pb():C(f)):(a.Pc.Sa(f,a.data,a.ie,a.width,a.height,b.left+a.x+d.Lb,b.top+a.y+d.Mb,Od(f,c)),f.ra&&f.ra(),f.pb?f.pb():C(f))}:null,f.ra&&
f.ra(),f.pb?f.pb():C(f),!0):!1}if(f.P){var c=Od(f,a);if(Pd(f,c)){var d=f.xb;d.Pc&&b(d)}else if(f.xb)f.u=-1,f.xb=null,f.ra&&f.ra(),f.pb?f.pb():C(f);else{var e=Qd(f,c,!0);if(0<e.length){if(d=f.ab[e[0]],0<=f.u&&f.u!==e[0]&&(f.u=-1,f.xb=null),f.qb=Date.now(),(!d.Pc||(a instanceof MouseEvent?d.u:d.K)&&f.u!==e[0]||!b(d))&&d.m){var q=d.ua?d.ua(d):d,n=null;a=Md(q);var r=c.x-a.Lb,u=c.y-a.Mb;Nd=function(a,b,c){var g=Od(f,a);if(b){if((c?d.K:d.u)&&d===f.ab[Qd(f,g,!1)[0]])f.u=e[0],f.xb=(c?d.K:d.u)(d,c);else if(n&&
n.mb&&(!n.kb||n.kb(n,q)))n.mb(n,q);else if(null==n||null==n.mb||n.kb&&!n.kb(n,q))for(b=0;b<f.ua.length&&!f.ua[b].mb(n,q,g.x,g.y);b++);C(f);f.b.style.cursor="default"}else{c=Qd(f,g,!1);n=null;a=!1;for(b=0;!a&&b<c.length;b++)n=f.ab[c[b]],a=n.mb&&(!n.kb||n.kb(n,q));a&&null!=n?(n.Df=!0,C(f),n.Df=!1):C(f);b=f.I;a&&!n.bb&&(c=Md(n),Rd(f,n.x+c.Lb,n.y+c.Mb,n.width,n.height,["drop-target"]));b.save();Sd(f);f.transform&&(b.translate(f.width/2,f.height/2),CanvasRenderingContext2D.prototype.transform.apply(b,
f.transform),b.translate(-f.width/2,-f.height/2));b.translate(f.m*f.ya.W,f.h*f.ya.X);b.globalAlpha=.5;q.H(f,g.x-r,g.y-u);q.ha.forEach(function(a){a.H(f,g.x-r,g.y-u);a.H(f,g.x-r,g.y-u,!0)});q.H(f,g.x-r,g.y-u,!0);b.restore();f.b.style.cursor=a?"copy":"default"}}}}else 0<=f.u&&(f.u=-1,f.xb=null,C(f))}}}var d=b&&b.Ig||("devicePixelRatio"in window?window.devicePixelRatio:1);this.b=a;this.m=a.width/d;this.h=a.height/d;this.ya=b&&b.ya||{W:0,pa:1,X:0,ma:1};this.width=this.m*(this.ya.pa-this.ya.W);this.height=
this.h*(this.ya.ma-this.ya.X);this.P=!0;this.transform=this.bb=null;this.I=this.b.getContext("2d");this.Na=this.state=null;this.ua=[];this.qb=0;this.u=-1;this.xb=null;this.o={};this.clientData={};this.ca=b&&b.ca||new Lb;this.w=null;this.resize(this.width,this.height,b&&b.Ig);this.ha={};var f=this;a.addEventListener("mousedown",c,!1);a.addEventListener("touchstart",function(a){var b=a.targetTouches;1===b.length&&(a.preventDefault(),c(b[0]),Td=b[0])},!1);a.addEventListener("wheel",function(a){function b(b){b.doScroll&&
(a.preventDefault(),b.doScroll(0===a.deltaMode?a.deltaX:1===a.deltaMode?10*a.deltaX:30*a.deltaX,0===a.deltaMode?a.deltaY:1===a.deltaMode?10*a.deltaY:30*a.deltaY))}if(f.P){var c=Od(f,a);if(Pd(f,c))f.xb&&b(f.xb);else if(0>f.u){c=Qd(f,c,!0);for(var d=0;d<c.length;d++)if(null!=f.ab[c[d]].doScroll){b(f.ab[c[d]]);break}}}},!1);a.addEventListener("mousemove",function(a){if(f.P){var b=Od(f,a);b=Qd(f,b,!0);for(var c=0;c<b.length;c++)if(null!=f.ab[b[c]].P){a.preventDefault();f.ab[b[c]].P();return}f.Na&&f.Na()}},
!1);this.ab=[];this.K=[];this.pb=this.ra=null}function ic(a,b){a.ya=b||{W:0,pa:1,X:0,ma:1};a.width=a.m*(a.ya.pa-a.ya.W);a.height=a.h*(a.ya.ma-a.ya.X)}function hd(a,b){for(var c=0;c<a.ua.length;c++)if("delete"===a.ua[c].tag){a.ua[c].mb=b;return}a.ua.push({tag:"delete",mb:b})}Mb.prototype.show=function(){this.P=!0};Mb.prototype.Gc=function(){this.P=!1};function Ud(a,b){a.b.style.filter=b}function Vd(a,b){a.bb=b&&b.slice();a.transform=a.bb}
function Od(a,b){a.b.getBoundingClientRect();b={x:b.clientX,y:b.clientY,mh:b.altKey};var c=[b.x,b.y];c=[c[0]-a.m*a.ya.W,c[1]-a.h*a.ya.X];var d=a.transform;if(d){var f=a.width/2;a=a.height/2;d=d.slice(0,4).concat(d[4]-f*d[0]-a*d[2]+f,d[5]-f*d[1]-a*d[3]+a);a=d[0]*d[3]-d[1]*d[2];c=[(d[3]*c[0]-d[2]*c[1]+d[2]*d[5]-d[3]*d[4])/a,(-d[1]*c[0]+d[0]*c[1]+d[1]*d[4]-d[0]*d[5])/a]}b.x=c[0];b.y=c[1];return b}function Wd(a){a.ra&&a.ra();a.pb?a.pb():C(a)}
function Tb(a,b){return{j:a,Cg:60,Dg:120,xg:!1,ja:Math.max(1,Math.min(3,Math.round(a/40))),Bf:Math.round(a/4).toString(10)+"px sans-serif",yh:"navy",zh:"#37f",xh:"#06f",c:b,va:Math.max(1,Math.min(3,b/30)),gh:"bold 15px sans-serif",Yf:"navy",Xf:"#ccc",Uc:5,Ef:"#e44",ig:"#f88",Wf:"#bbb"}}
function fd(a,b){a.width=a.m*(a.ya.pa-a.ya.W);a.height=a.h*(a.ya.ma-a.ya.X);a.I=a.b.getContext("2d");b=b||("devicePixelRatio"in window?window.devicePixelRatio:1);1!=b&&(a.I.resetTransform(),a.I.scale(b,b));a.ca.b=new Cd(a.width,a.width/100,a.height/100,a.m/100,a.h/100);b=E(a.ca,{tag:"block"}).width;var c=E(a.ca,{tag:"button"}).width;a.w=Tb(b,c)}
Mb.prototype.resize=function(a,b,c){var d=c||("devicePixelRatio"in window?window.devicePixelRatio:1);this.b.width=a*d;this.b.height=b*d;1!=d&&(this.b.style.width=a+"px",this.b.style.height=b+"px");this.m=a;this.h=b;fd(this,c)};function Vc(a,b){for(var c=0;c<a.ab.length;c++)if(a.ab[c].data===b)return c;return-1}
function Qd(a,b,c){var d=a.b.getBoundingClientRect(),f=b.x-d.left;b=b.y-d.top;d=[];for(var e=a.ab.length-1;0<=e;e--){var h=Md(a.ab[e]);if(h=(!c||a.ab[e].Na)&&f>=a.ab[e].x+h.Lb&&f<=a.ab[e].x+h.Lb+a.ab[e].width&&b>=a.ab[e].y+h.Mb&&b<=a.ab[e].y+h.Mb+a.ab[e].height)h=a.ab[e],h=!h.b||f>=h.b.x&&f<h.b.x+h.b.Xc&&b>=h.b.y&&b<h.b.y+h.b.Nc;h&&d.push(e)}return d}
function vc(a,b){var c=b.clone();a=gd(a);var d=Math.min(a.width,a.height)/1.5/c.width;c.width*=d;c.height*=d;c.x=(a.width-c.width)/2;c.y=(a.height-c.height)/2;c.u=null;c.K=null;c.o=function(a,e){var f=a.I;f.save();f.translate(e.x,e.y);f.scale(d,d);f.translate(-e.x,-e.y);b.o(a,c,e.x-c.x,e.y-c.y,!0);f.restore()};b.h&&(c.h=function(a,e){var f=a.I;f.save();f.translate(e.x,e.y);f.scale(d,d);f.translate(-e.x,-e.y);b.h(a,c,e.x-c.x,e.y-c.y,!0);f.restore()});return c}
function Pd(a,b){if(null==a.xb)return!1;var c=a.b.getBoundingClientRect(),d=b.x-c.left;b=b.y-c.top;return d>=a.xb.x&&d<=a.xb.x+a.xb.width&&b>=a.xb.y&&b<=a.xb.y+a.xb.height}function gd(a){return{width:a.width,height:a.height}}function Sd(a){a.I.beginPath();a.I.rect(a.m*a.ya.W,a.h*a.ya.X,a.m*(a.ya.pa-a.ya.W),a.h*(a.ya.ma-a.ya.X));a.I.clip()}
function Xd(a,b,c,d,f,e,h){e=e||0;h=h||0;if(0<a.K.length){var g=a.K[a.K.length-1];g.x>b&&(d-=g.x-b,b=g.x);g.x+g.Xc<b+d&&(d=g.x+g.Xc-b);g.y>c&&(f-=g.y-c,c=g.y);g.y+g.Nc<c+f&&(f=g.y+g.Nc-c);e+=g.jg;h+=g.kg}a.K.push({x:b,y:c,Xc:d,Nc:f,jg:e,kg:h})}function Uc(a,b,c){0<a.K.length&&(b.b=a.K[a.K.length-1]);0<=c?a.ab[c]=b:a.ab.push(b)}function Ac(a,b){var c=new Sc(null,-1,-1,0,0,function(a,c,e,h){a=a.I;a.save();a.translate(c.x+e,c.y+h);b(a);a.restore()});Uc(a,c);return c}
function Cc(a,b,c,d,f,e,h,g,k,m){var q,n=new Sc(null,d.width,d.height,b,c,function(b,c,e,g){b=b.I;b.save();Bc(d,b,c.x+e,c.y+g);b.translate(c.x+e,c.y+g);f(b,d,a.o.id===m&&a.o.xd||c.Df);b.restore()},e?{$:function(b,c,d,e,f,g,h){a.o={id:m,rect:{x:n.x,y:n.y,Xc:d,Nc:e},xd:!0};q=h;C(a);return 0},Sa:function(b,c,d,e,f,g,h,k){d=b.b.getBoundingClientRect();c=k.x-d.left;k=k.y-d.top;a.o.xd=c>=a.o.rect.x&&c<a.o.rect.x+a.o.rect.Xc&&k>=a.o.rect.y&&k<a.o.rect.y+a.o.rect.Nc;C(b)},pf:function(){a.o.xd&&e(q);a.o={};
C(a)}}:null,h,g,m);n.P=k||null;n.m=!1;n.bb=!0;Uc(a,n);return n}function cd(a,b,c,d,f){Bc(f,a.I,c-f.width/2,d-f.height/2);var e=a.ha[b];void 0!=e&&(a.I.save(),a.I.translate(c,d),e(a.I,b,a.w,f),a.I.restore())}
function C(a){a.P&&(a.I.clearRect(a.m*a.ya.W,a.h*a.ya.X,a.m*(a.ya.pa-a.ya.W),a.h*(a.ya.ma-a.ya.X)),a.I.save(),a.transform&&(a.I.translate(a.width/2,a.height/2),CanvasRenderingContext2D.prototype.transform.apply(a.I,a.transform),a.I.translate(-a.width/2,-a.height/2)),a.I.translate(a.m*a.ya.W,a.h*a.ya.X),a.ab.forEach(function(a){a.H(this)},a),a.ab.forEach(function(a){a.H(this,void 0,void 0,!0)},a),a.xb&&(a.I.save(),a.I.globalAlpha=.5,a.I.fillStyle="black",a.I.fillRect(a.m*a.ya.W,a.h*a.ya.X,a.m*(a.ya.pa-
a.ya.W),a.h*(a.ya.ma-a.ya.X)),a.I.restore(),a.xb.H(a),a.xb.H(a,0,0,!0)),a.I.restore())};function Oc(){this.u=this.K=1;this.b=this.h=this.y=this.x=0;this.P=!1;this.ua="";this.Zd=this.m=this.Yd=this.o=0;this.ha=null}w=Oc.prototype;w.yc=function(a){this.K=a;this.o=Math.max(0,Math.min(this.o,this.K-this.h))};w.jc=function(a){this.u=a;this.m=Math.max(0,Math.min(this.m,this.u-this.b))};w.resize=function(a,b,c,d){this.x=a;this.y=b;this.h=c;this.b=d;this.o=Math.max(0,Math.min(this.o,this.K-this.h));this.m=Math.max(0,Math.min(this.m,this.u-this.b))};
w.Ld=function(a){this.ha=a;var b=this,c=new Sc(null,this.h,this.b,this.x,this.y,null,this.K>this.h||this.u>this.b?{$:function(a,c,e,h,g,k,m){b.Yd=m.x;b.Zd=m.y;return 0},Sa:function(a,c,e,h,g,k,m,q){a=Math.max(Math.min(q.x-b.Yd,b.o),b.o-b.K+b.h);b.o-=a;b.Yd+=a;q=Math.max(Math.min(q.y-b.Zd,b.m),b.m-b.u+b.b);b.m-=q;b.Zd+=q}}:null,null,null);c.m=!1;c.doScroll=function(c,f){b.o+=c;b.m+=f;a.ra()};Uc(a,c);this.ua&&Ac(a,function(a){a.save();a.fillStyle=b.ua;a.fillRect(b.x,b.y,b.h,b.b);a.restore()});(this.K>
this.h||this.u>this.b)&&Ac(a,function(c){c.save();if(b.K>b.h){var d=b.h/b.K;d=Math.max(d*b.h,Math.min(20,b.h));var e=b.h-d,h=b.o/(b.K-b.h);e*=h;c.fillStyle=a.w.Xf;c.fillRect(b.x,b.y+b.b+2,b.h,a.w.Uc);c.fillStyle=a.w.Yf;c.fillRect(b.x+e,b.y+b.b+2,d,a.w.Uc)}b.u>b.b&&(d=b.b/b.u,d=Math.max(d*b.b,Math.min(20,b.b)),e=b.b-d,h=b.m/(b.u-b.b),e*=h,c.save(),c.fillStyle=a.w.Xf,c.fillRect(b.P?b.x-2-a.w.Uc:b.x+b.h+2,b.y,a.w.Uc,b.b),c.fillStyle=a.w.Yf,c.fillRect(b.P?b.x-2-a.w.Uc:b.x+b.h+2,b.y+e,a.w.Uc,d));c.restore()});
Xd(a,this.x,this.y,this.h,this.b,-this.o,-this.m)};w.end=function(){this.ha.K.pop()};function id(a){return a.m<=.001*a.b}function jd(a){return a.m>=a.u-1.001*a.b};function Rd(a,b,c,d,f,e){e=E(a.ca,{tag:"overlay-rectangle",Y:e||[]});e.x=b;e.y=c;e.width=d;e.height=f;e.H(a.I)}
function Dc(a,b,c,d,f,e,h,g){Rd(a,b,c,d,f,(e||[]).concat("disabled"));E(a.ca,{tag:"overlay-rectangle",Y:e||[]});if(!g){a.I.save();e=ed(a.ca,{tag:"crossout-line",Y:h||[]});a.I.beginPath();g=a.ca;h=/^(-?([0-9]+\.?|[0-9]*\.[0-9]+))([a-z]*)$/.exec(e.Sf["line-angle"]||"0");if(null==h)throw"Illegal angle";if(g.ha.hasOwnProperty(h[3]))g=g.ha[h[3]];else if(0==parseFloat(h[1]))g=0;else throw"Unknown angle unit";h=parseFloat(h[1])*g;g=od(a.ca,e.Sf["line-overflow"]||"0").N(a.ca.b);if(Math.abs(h%Math.PI)<.25*
Math.PI||Math.abs((Math.PI-h)%Math.PI)<.25*Math.PI){g=(d/2+g)*Math.sign(Math.cos(h));var k=f/2*Math.sin(h)*Math.sqrt(2)}else k=(f/2+g)*Math.sign(Math.sin(h)),g=d/2*Math.cos(h)*Math.sqrt(2);a.I.moveTo(b+d/2-g,c+f/2-k);a.I.lineTo(b+d/2+g,c+f/2+k);e.stroke(a.I);a.I.restore()}}
function Fc(a,b,c,d,f,e){a.save();a.strokeStyle=f;a.fillStyle=f;a.lineWidth=d;a.fillRect(b-2.5*d,c-d,5*d,4*d);a.beginPath();a.moveTo(b-1.7*d,c);a.lineTo(b-1.7*d,c);e?(a.arc(b-3.4*d,c-2*d,1.7*d,0,Math.PI,!0),a.lineTo(b-5.1*d,c)):(a.arc(b,c-2*d,1.7*d,-Math.PI,0),a.lineTo(b+1.7*d,c));a.stroke();a.restore()}function Tc(a,b,c,d,f,e,h){var g=.03*a.w.j;Fc(a.I,b+d+(e?-5:5)*g,c+.15*f,g,h||"#333")}
function Hc(a,b,c,d,f,e,h){a.save();h&&(h.style&&(a.strokeStyle=h.style,a.fillStyle=h.style),void 0!==h.lineWidth&&(a.lineWidth=h.lineWidth),void 0!==h.alpha&&(a.globalAlpha=h.alpha));var g=h&&void 0!==h.Yc?h.Yc:5*a.lineWidth;a.beginPath();var k=f+(h&&h.Jd?g/d:0),m=e-(h&&h.Jd?0:g/d);a.arc(b,c,d,k,m);a.stroke();h&&h.Jd?(a.translate(b+d*Math.cos(f),c+d*Math.sin(f)),a.rotate((f+k)/2+Math.PI)):(a.translate(b+d*Math.cos(e),c+d*Math.sin(e)),a.rotate((e+m)/2));a.beginPath();a.moveTo(0,0);a.lineTo(g/2,1.2*
-g);a.lineTo(-g/2,1.2*-g);a.fill();a.restore()}Mb.prototype.text=function(a,b){var c=this.I,d=this.w;c.save();c.fillStyle=b&&b.fillStyle||"white";c.font=d.Bf;c.textAlign="center";c.textBaseline="middle";c.translate(.5*d.j+(b&&b.x||0),.5*d.j-(b&&b.y||0));b&&b.oh&&c.rotate(-b.oh);c.translate(-.5*d.j,-.5*d.j);c.fillText(a,.5*d.j,.5*d.j);c.restore()};
function G(a,b){var c=a.I,d=a.w;c.save();c.beginPath();c.rect(0,0,a.w.j,a.w.j);c.clip();b&&(b.scale||b.rotation)&&(b.wf&&c.translate(-b.wf[0],-b.wf[1]),c.translate(.5*d.j,.5*d.j),b.scale&&c.scale(b.scale,b.scale),b.rotation&&c.rotate(-b.rotation),c.translate(-.5*d.j,-.5*d.j));c.beginPath();c.moveTo(.5*d.j,d.j-d.ja);b&&"left"===b.Pe||(c.lineTo(d.j-d.ja,d.j-d.ja),c.lineTo(d.j-d.ja,.25*d.j),c.bezierCurveTo(.8*d.j,d.ja,.52*d.j,d.ja,.5*d.j,d.ja));b&&"right"===b.Pe||(c.lineTo(.5*d.j,d.ja),c.bezierCurveTo(.48*
d.j,d.ja,.2*d.j,d.ja,d.ja,.25*d.j),c.lineTo(d.ja,d.j-d.ja));c.closePath();if(b&&b.Xb){a=[b.Xb[0],Math.max(.2+.8*b.Xb[1],b.Xb[2]/2),b.Xb[2]];var f=Math.max(a[0],Math.max(a[1],a[2]));c.fillStyle="rgb("+a.map(function(a){return Math.round(225*(1-f)+(30+225*f)*a)}).join(",")+")"}else c.fillStyle="white";c.fill();b&&b.Xb&&(c.strokeStyle="white",c.lineWidth=d.ja,c.stroke());b&&b.nc&&(c.fillStyle="black",c.fillRect(0,.6*d.j,.1*d.j,.35*d.j),c.fillRect(.9*d.j,.6*d.j,.1*d.j,.35*d.j));c.restore()}
function Yd(a,b){var c=(b-a)/2,d=b===a?Infinity:(b+a)/(2*c);return{eb:c,yf:d,x:Math.abs(d)>1E3*Math.abs(a+b)?0:d*(.01>c?c*c/2:1-Math.cos(c)),y:Math.abs(d)>1E3*Math.abs(a+b)?(a+b)/2:d*Math.sin(c)}}
function Zd(a,b,c,d,f){var e=a.I;a=a.w;d*=a.j;var h=f&&f.r||[-1,0,1],g=f&&f.color||"black";f=f&&void 0!==f.Ke?f.Ke:1;var k=Yd(b,c);e.save();e.translate(.5*a.j,.5*a.j);e.strokeStyle=g;e.lineWidth=a.ja*f;20<Math.abs(k.yf)?(e.beginPath(),h.forEach(function(a){e.moveTo(a*d,0);e.lineTo((k.x+a)*d,-k.y*d)}),e.stroke()):h.forEach(function(a){e.beginPath();var b=-k.yf*d;a=(k.yf+a)*d;var c=k.eb;0<a?e.arc(b,0,a,0,-c,0<c):0>a&&e.arc(b,0,-a,Math.PI,Math.PI-c,0<c);e.stroke()});e.restore();return k}
function $d(a,b,c,d,f,e,h){a=a.w;f*=a.j;e*=a.j;a=.21*a.j;c=h.x-c-b/2;b=d+b/2-h.y;f=Yd(f,e);return(c-f.x)*(c-f.x)+(b-f.y)*(b-f.y)<a*a}
function ae(a){var b=a.I;a=a.w;b.save();b.translate(.5*a.j,.5*a.j);b.scale(.7,.7);b.translate(-.5*a.j,-.5*a.j);b.fillStyle="white";b.fillRect(a.ja,.45*a.j,a.j-2*a.ja,.35*a.j);b.fillStyle="black";b.beginPath();b.arc(.27*a.j,.72*a.j,.2*a.j,0,2*Math.PI);b.fill();b.fillStyle="white";b.beginPath();b.arc(.27*a.j,.72*a.j,.12*a.j,0,2*Math.PI);b.fill();b.beginPath();b.arc(.8*a.j,.8*a.j-a.ja,.1*a.j,0,2*Math.PI);b.fill();b.restore()}
function be(a){var b=a.I;a=a.w;b.save();b.lineWidth=a.ja;b.strokeStyle="white";for(var c=1;3>=c;c++)b.beginPath(),b.arc(.185*a.j,.48*a.j,.05*a.j*c,.9*Math.PI,1.7*Math.PI),b.stroke();b.restore()}
Mb.prototype.buttons=function(a,b,c){var d=this.I,f=this.w;a.forEach(function(a,h){d.save();d.translate(f.j*(.5+a.x),f.j*(.5-a.y));d.rotate(a.r||0);d.fillStyle=a.fillStyle?a.fillStyle:c&&c.Hf&&b?c.Hf[b[h]]:b&&!0===b[h]?"red":b&&1===b[h]?"#f66":b&&-1===b[h]?"#333":"white";d.strokeStyle=a.strokeStyle?a.strokeStyle:c&&c.$f&&b?c.$f[b[h]]:!b||1!==b[h]&&!0!==b[h]?b&&0>b[h]?"black":"#aaa":"#700";d.lineWidth=f.ja;d.lineJoin="round";var e=a.size||1;switch(a.D){case "r":d.fillRect(.08*-f.j*e,.08*-f.j*e,.16*
f.j*e,.16*f.j*e);d.strokeRect(.08*-f.j*e,.08*-f.j*e,.16*f.j*e,.16*f.j*e);break;case "t":d.beginPath();d.moveTo(0,-.122*f.j*e);d.lineTo(.106*f.j*e,.062*f.j*e);d.lineTo(-.106*f.j*e,.062*f.j*e);d.closePath();d.fill();d.stroke();break;case "c":d.beginPath(),d.arc(0,0,.112*f.j*e,0,2*Math.PI),d.fill(),d.stroke()}b&&c&&void 0!==c.Md&&c.Md===b[h]&&(d.strokeStyle="white",d.beginPath(),d.moveTo(.06*-f.j*e,.06*-f.j*e),d.lineTo(.06*f.j*e,.06*f.j*e),d.moveTo(.06*-f.j*e,.06*f.j*e),d.lineTo(.06*f.j*e,.06*-f.j*e),
d.stroke());d.restore()})};function ce(a,b,c,d,f,e,h,g,k){var m=a.I;a=a.w;m.save();m.strokeStyle="black";m.lineWidth=a.ja*k;k=b.length/2;for(var q=0;q<k;q++)0<b[2*q+1]&&(m.fillStyle=2===b[2*q+1]?"white":"black",m.beginPath(),m.arc(a.j*(c+(d-c)/k*(q+.5)),a.j*(f+(e-f)/h*(b[2*q]+.5)),a.j*g/2,0,2*Math.PI),m.fill(),m.stroke());m.restore()}
function de(a,b){var c=a.I,d=a.w,f=null===b?-.15*d.j:0;c.save();c.beginPath();c.moveTo(.4*d.j+f,.3*d.j);c.lineTo(.4*d.j+f,.7*d.j);c.lineTo(.7*d.j+f,.7*d.j);c.lineTo(.7*d.j+f,.37*d.j);c.lineTo(.63*d.j+f,.3*d.j);c.closePath();c.lineWidth=d.ja;c.strokeStyle="white";c.lineJoin="round";c.stroke();for(var e=.15;.31>e;e+=.06)c.beginPath(),c.arc(.65*d.j+f,.5*d.j,d.j*e,-.6,.6),c.stroke();null===b?(c.beginPath(),c.moveTo(.12*d.j,.6*d.j),c.lineTo(.88*d.j,.4*d.j),c.lineWidth=1.5*d.ja,c.stroke()):a.text(b.toString(10),
{x:-.3*d.j});c.restore()}function ee(a){var b=a.I;a=a.w;b.beginPath();b.arc(0,0,.4*a.j,0,2*Math.PI,!0);b.moveTo(0,0);b.lineTo(0,.4*-a.j);b.strokeStyle="#666";b.lineWidth=a.ja;b.stroke();b.beginPath();b.arc(0,.4*-a.j,.1*a.j,0,2*Math.PI);b.fillStyle="white";b.fill();b.strokeStyle="black";b.stroke()}
function fe(a,b,c){var d=a.I,f=a.w;c=c*Math.PI/12;d.save();d.translate(.5*f.j,.5*f.j);d.rotate(c);ee(a);d.fillRect(-.28*f.j,-.1*f.j,.56*f.j,.2*f.j);d.fillStyle="black";b?(d.beginPath(),d.arc(-.15*f.j,.03*f.j,.11*f.j,0,2*Math.PI),d.fill(),d.fillStyle="white",d.beginPath(),d.arc(-.15*f.j,.03*f.j,.07*f.j,0,2*Math.PI),d.fill(),d.beginPath(),d.arc(.15*f.j,.07*f.j,.06*f.j,0,2*Math.PI)):(d.fillRect(-.28*f.j,.1*f.j,.08*f.j,.04*f.j),d.fillRect(.2*f.j,.1*f.j,.08*f.j,.04*f.j),d.fillStyle="white",d.beginPath(),
d.arc(0,.06*f.j,.06*f.j,0,2*Math.PI));d.fill();d.restore()}function ge(a,b,c,d,f){b=d.x-b-a/2;c=c+a/2-d.y;a=(b*b+c*c)/(a*a/4);return 1>a&&.4<a&&(f||0<=c)}function he(a,b,c,d,f){a=Math.round(12*Math.atan2(d.x-b-a/2,c+a/2-d.y)/Math.PI);return f?12===a?-12:a:Math.max(-6,Math.min(6,a))}
function ie(a,b,c,d,f,e,h,g,k){var m=k?0>=h?0:Math.max(Math.log(10*h)/Math.log(100),0):h/4;a.save();!g&&e&&e(h);a.beginPath();a.arc(b,c,d,0,2*Math.PI);a.fillStyle="white";a.fill();e=.9*d;h=k?.8*d:.6*d;var q=2*Math.PI*(g?.2:m),n=g?"#ddd":"red";k=(h-(k?.5*d:.6*d))/4;a.save();a.beginPath();a.arc(b,c,e,-Math.PI/2,3*Math.PI/2-.05);a.arc(b,c,h-4*k,3*Math.PI/2-.05,Math.PI,!0);a.arc(b+k,c,h-3*k,Math.PI,Math.PI/2,!0);a.arc(b+k,c-k,h-2*k,Math.PI/2,0,!0);a.arc(b,c-k,h-k,0,-Math.PI/2,!0);a.clip();a.fillStyle=
n;a.beginPath();a.arc(b,c,e,-Math.PI/2,-Math.PI/2+q);a.lineTo(b,c);a.fill();a.restore();a.beginPath();a.arc(b,c,d/2,0,2*Math.PI);a.fill();a.beginPath();a.arc(b,c,d,0,2*Math.PI);a.strokeStyle="black";a.lineWidth=f;a.stroke();a.beginPath();a.moveTo(b-.1*d*Math.sin(2*m*Math.PI),c+.1*d*Math.cos(2*m*Math.PI));a.lineTo(b+.9*d*Math.sin(2*m*Math.PI),c-.9*d*Math.cos(2*m*Math.PI));a.lineWidth=2*f;a.stroke();g&&Hc(a,b,c,1.25*d,.5*-Math.PI,.1*-Math.PI,{Jd:!0,Yc:5*f,style:"black"});a.restore()}
function je(a,b,c,d){var f=a.I,e=a.w.j;ie(f,e/2+(c?-.05*e:.05*e),e/2+(c?.07*e:.03*e),.4*e,a.w.ja,function(a){f.textAlign="start";f.textBaseline="top";f.font=Math.round(e/6).toString(10)+"px sans-serif";f.fillStyle="white";f.fillText(a.toFixed(1>a?2:1),e/20,e/40)},b,c,d)}
function ke(a,b,c,d,f,e,h){a.save();h&&(h.style&&(a.strokeStyle=h.style,a.fillStyle=h.style),void 0!==h.lineWidth&&(a.lineWidth=h.lineWidth),void 0!==h.alpha&&(a.globalAlpha=h.alpha));a.beginPath();f/=2;a.moveTo(b,d+f);for(h=0;h<e;h++){var g=b+(c-b)*(.5+h)/e;a.lineTo(g,d+f);f=-f;a.lineTo(g,d+f)}a.lineTo(c,d+f);a.stroke();a.restore()}
function le(a,b,c,d,f,e,h,g,k,m){var q=(d+f)/2,n=(f-d)/2;a.save();a.beginPath();a.arc(b,c,d,-h,-e);a.arc(b+q*Math.cos(e),c-q*Math.sin(e),n,-e-Math.PI,-e,!0);a.arc(b,c,f,-e,-h,!0);a.arc(b+q*Math.cos(h),c-q*Math.sin(h),n,-h,-h+Math.PI,!0);a.fillStyle=g;a.strokeStyle=k;a.lineWidth=m;a.fill();a.stroke();a.restore()}function me(a,b,c,d){var f=a.w;le(a.I,f.j/2,f.j/2,.3*f.j,.45*f.j,b,c,0>d?"white":2===d?"red":0<d?"#f70":"#ddd",0===d?"#bbb":"black",f.ja)}
function ne(a,b){var c=a.I;c.save();me(a,.65*Math.PI,.85*Math.PI,b[0]);me(a,.15*Math.PI,.35*Math.PI,b[1]);me(a,1.15*Math.PI,1.35*Math.PI,b[2]);me(a,1.65*Math.PI,1.85*Math.PI,b[3]);c.restore()}function oe(a,b){var c=a.I;c.save();for(var d=0;8>d;d++)me(a,Math.PI*(.46-.25*d),Math.PI*(.54-.25*d),d===b?1:-1);c.restore()}function pe(a,b,c,d,f,e){b=(e.x-d)/b-.5;c=.5-(e.y-f)/c;for(f=0;f<a.length;f++)if(Math.max(Math.abs(b-a[f].x),Math.abs(c-a[f].y))<.11*(a[f].size||1))return f;return null}
function H(a,b,c,d,f,e){function h(a,b){g.beginPath();g.moveTo(k.j*(.1+.8*a),k.j*(.46-c));g.lineTo(k.j*(.1+.8*b),k.j*(.46-c));g.arc(k.j*(.1+.8*b),k.j*(.5-c),.04*k.j,-Math.PI/2,Math.PI/2);g.lineTo(k.j*(.1+.8*b),k.j*(.54-c));g.lineTo(k.j*(.1+.8*a),k.j*(.54-c));g.arc(k.j*(.1+.8*a),k.j*(.5-c),.04*k.j,Math.PI/2,-Math.PI/2)}var g=a.I,k=a.w;g.save();d&&(g.translate(.5*k.j,.5*k.j),g.rotate(-Math.PI/2),g.scale(1,-1),g.translate(-.5*k.j,-.5*k.j));g.lineWidth=k.ja;g.fillStyle="white";g.strokeStyle="black";h(0,
1);g.fill();g.stroke();g.fillStyle=f;switch(e||0){case 1:h(0,b);g.fill();g.stroke();break;case 2:h(b,1),g.fill(),g.stroke()}g.fillStyle=f;g.strokeStyle="black";g.lineWidth=k.ja;g.beginPath();g.arc(k.j*(.1+.8*b),k.j*(.5-c),.1*k.j,0,2*Math.PI);g.fill();g.stroke();g.restore()}function J(a,b,c,d,f,e,h){c=(h.x-f)/c-.5;d=.5-(h.y-e)/d;return.1>Math.abs((b?c:d)-a)}function qe(a,b,c,d,f,e){b=(e.x-d)/b-.5;c=.5-(e.y-f)/c;return.5+(a?c:b)/.8}
function re(a,b,c,d,f,e,h,g,k,m,q){a=Math.floor(((q.x-k)/h-a)/((b-a)/f));c=Math.floor((c-(q.y-m)/g)/((c-d)/e));return 0<=a&&a<f&&0<=c&&c<e?{index:a,tone:c}:null}function se(a,b,c,d,f){var e=.4*a;a=f.x-c-.55*a;b=d+.53*b-f.y;return a*a+b*b<=e*e}function te(a,b,c,d,f,e){a=(Math.PI-Math.atan2(e.x-c-.55*a,-(d+.53*b-e.y)))/(2*Math.PI);return f?Math.exp(a*Math.log(100))/10:4*a}function ue(a,b,c,d,f){c=f.x-c-a/2;b=b/2-(f.y-d);return Math.abs(Math.sqrt(c*c+b*b)-.375*a)<=.15*a?0<=b?0>c?0:1:0>c?2:3:null}
function ve(a,b,c,d,f){c=f.x-c-a/2;b=b/2-(f.y-d);return Math.abs(Math.sqrt(c*c+b*b)-.375*a)<=.15*a?(a=Math.atan2(c,b)+Math.PI/8,Math.floor((0>a?a+2*Math.PI:a)/(Math.PI/4))):null}function Gc(a,b,c,d){if(0<d){a.beginPath();a.moveTo(b+d*Math.cos(.1),c+d*Math.sin(.2));for(var f=1;6>f;f++)a.lineTo(b+d*Math.cos(f*Math.PI/3+.2),c+d*Math.sin(f*Math.PI/3+.2));a.closePath();a.arc(b,c,.5*d,0,2*Math.PI,!0);a.fill()}};function ua(a){for(var b=0;b<Za.length;b++)if(Za[b].name===a)return Za[b];return null}function Wa(a){var b=[];(Za||[]).forEach(function(c){"h"!==c.type&&0<=c.la.indexOf(a)&&b.push(c)});return b};var Za=[new y({name:"!stop",type:"h"}),new y({name:"!stop and blink",type:"h"}),new y(function(){var a=[{D:"c",x:0,y:0,r:0},{D:"t",x:0,y:.3,r:0},{D:"t",x:0,y:-.3,r:Math.PI},{D:"t",x:.3,y:0,r:Math.PI/2},{D:"t",x:-.3,y:0,r:-Math.PI/2}];return{name:"button 1",type:"e",ga:function(){return[0]},H:function(b,c){G(b);c=c.g[0];b.buttons(a,[0==c,1==c,2==c,3==c,4==c])},$:function(b,c,d,f,e,h,g){b=pe(a,d,f,e,h,g);null!==b&&(A(c),c.g[0]=b);return b}}}()),new y(function(){var a=[{D:"c",x:0,y:0,r:0},{D:"t",x:0,
y:.3,r:0},{D:"t",x:0,y:-.3,r:Math.PI},{D:"t",x:.3,y:0,r:Math.PI/2},{D:"t",x:-.3,y:0,r:-Math.PI/2}];return{name:"button",la:["c"],type:"e",ga:function(){return[!1,!1,!1,!1,!1]},hb:function(){return[!1,!1,!0,!1,!0]},H:function(b,c){G(b);b.buttons(a,c.g)},$:function(b,c,d,f,e,h,g){b=pe(a,d,f,e,h,g);null!==b&&(A(c),c.g[b]=!c.g[b]);return b},Ac:function(a){for(var b=0;5>b;b++)if(a.g[b])return null;return new Da("No button specified",!0)}}}()),new y(function(){var a=[{D:"r",x:0,y:.4,r:0,A:"2"},{D:"r",x:-.22,
y:.35,r:-.45,A:"1"},{D:"r",x:.22,y:.35,r:.45,A:"3"},{D:"r",x:-.4,y:.22,r:-.8,A:"0"},{D:"r",x:.4,y:.22,r:.8,A:"4"},{D:"r",x:-.2,y:-.4,A:"5"},{D:"r",x:.2,y:-.4,A:"6"}];return{name:"horiz prox",la:["b"],type:"e",ga:function(){return[0,0,0,0,0,0,0]},hb:function(){return[0,1,-1,1,-1,0,0]},H:function(b,c){G(b);b.buttons(a,c.g,{Md:-1})},$:function(b,c,d,f,e,h,g){b=pe(a,d,f,e,h,g);null!==b&&(A(c),c.g[b]=(c.g[b]+2)%3-1);return b},Ac:function(a){for(var b=0;7>b;b++)if(a.g[b])return null;return new Da("No proximity sensor specified",
!0)},Lc:function(a,c){switch(c){case "a":return c=new z(ua("horiz prox adv"),null,null),c.g=a.g.concat(c.g.slice(7)),c;default:return a}}}}()),new y(function(){var a=[{D:"r",x:0,y:.4,r:0,A:"2"},{D:"r",x:-.22,y:.35,r:-.45,A:"1"},{D:"r",x:.22,y:.35,r:.45,A:"3"},{D:"r",x:-.4,y:.22,r:-.8,A:"0"},{D:"r",x:.4,y:.22,r:.8,A:"4"},{D:"r",x:-.2,y:-.4,A:"5"},{D:"r",x:.2,y:-.4,A:"6"}];return{name:"horiz prox adv",la:["c"],type:"e",ga:function(){return[0,0,0,0,0,0,0,.1,.4]},hb:function(){return[0,1,2,1,2,3,3,.1,
.4]},H:function(b,c){G(b);b.buttons(a,c.g,{Hf:["white","red","#333","#888"],$f:["#aaa","black","black","black"],Md:2});H(b,c.g[8],.02,!1,"red",2);H(b,c.g[7],-.2,!1,"black",1)},$:function(b,c,d,f,e,h,g){b=pe(a,d,f,e,h,g);return null!==b?(A(c),c.g[b]=(c.g[b]+1)%4,b):J(.02,!1,d,f,e,h,g)?(A(c),8):J(-.2,!1,d,f,e,h,g)?(A(c),7):null},Sa:function(a,c,d,f,e,h,g,k){7<=d&&(c.g[d]=Math.max(0,Math.min(1,qe(!1,f,e,h,g,k))))},Ac:function(a){for(var b=0;7>b;b++)if(a.g[b])return null;return new Da("No sensor specified",
!0)},Lc:function(a,c){switch(c){case "b":if(c=a.V.ga(),a.g[7]===c[7]&&a.g[8]===c[8])return c=new z(ua("horiz prox"),null,null),c.g=a.g.slice(0,7),c;default:return a}}}}()),new y(function(){var a=[{D:"r",x:0,y:.4,r:0,A:"2"},{D:"r",x:-.22,y:.35,r:-.45,A:"1"},{D:"r",x:.22,y:.35,r:.45,A:"3"},{D:"r",x:-.4,y:.22,r:-.8,A:"0"},{D:"r",x:.4,y:.22,r:.8,A:"4"},{D:"r",x:-.2,y:-.4,A:"5"},{D:"r",x:.2,y:-.4,A:"6"}];return{name:"horiz prox 1",la:["a"],type:"e",ga:function(){return[0,0,0,0,0,0,0,.25]},hb:function(){return[0,
1,-1,1,-1,0,0,.25]},H:function(b,c){G(b);b.buttons(a,c.g,{Md:-1});H(b,c.g[7],-.1,!1,"black",1)},$:function(b,c,d,f,e,h,g){b=pe(a,d,f,e,h,g);return null!==b?(A(c),c.g[b]=(c.g[b]+2)%3-1,b):J(-.1,!1,d,f,e,h,g)?(A(c),7):null},Sa:function(a,c,d,f,e,h,g,k){7<=d&&(c.g[d]=Math.max(.25,Math.min(.75,Math.round(4*qe(!1,f,e,h,g,k))/4)))},Ac:function(a){for(var b=0;7>b;b++)if(a.g[b])return null;return new Da("No sensor specified",!0)},Lc:function(a,c){switch(c){case "b":if(c=a.V.ga(),a.g[7]===c[7])return c=new z(ua("horiz prox"),
null,null),c.g=a.g.slice(0,7),c;default:return a}}}}()),new y(function(){var a=[{D:"r",x:-.15,y:.35,A:"0"},{D:"r",x:.15,y:.35,A:"1"}];return{name:"ground",la:["b"],type:"e",ga:function(){return[0,0]},hb:function(){return[1,-1]},H:function(b,c){G(b,{nc:!0});b.buttons(a,c.g,{Md:-1})},$:function(b,c,d,f,e,h,g){b=pe(a,d,f,e,h,g);null!==b&&(A(c),c.g[b]=(c.g[b]+2)%3-1);return b},Ac:function(a){return a.g[0]||a.g[1]?null:new Da("No ground sensor specified",!0)},Lc:function(a,c){switch(c){case "a":return c=
new z(ua("ground adv"),null,null),c.g=a.g.concat(c.g.slice(2)),c;default:return a}}}}()),new y(function(){var a=[{D:"r",x:-.15,y:.35,A:"0"},{D:"r",x:.15,y:.35,A:"1"}];return{name:"ground adv",la:["c"],type:"e",ga:function(){return[0,0,.4,.6]},hb:function(){return[1,2,.4,.6]},H:function(b,c){G(b,{nc:!0});b.buttons(a,c.g,{Hf:["white","red","#333","#888"],$f:["#aaa","black","black","black"],Md:2});H(b,c.g[3],.02,!1,"red",2);H(b,c.g[2],-.2,!1,"black",1)},$:function(b,c,d,f,e,h,g){b=pe(a,d,f,e,h,g);return null!==
b?(A(c),c.g[b]=(c.g[b]+1)%4,b):J(.02,!1,d,f,e,h,g)?(A(c),3):J(-.2,!1,d,f,e,h,g)?(A(c),2):null},Sa:function(a,c,d,f,e,h,g,k){2<=d&&(c.g[d]=Math.max(0,Math.min(1,qe(!1,f,e,h,g,k))))},Ac:function(a){return a.g[0]||a.g[1]?null:new Da("No ground sensor specified",!0)},Lc:function(a,c){switch(c){case "b":if(c=a.V.ga(),a.g[2]===c[2]&&a.g[3]===c[3])return c=new z(ua("ground"),null,null),c.g=a.g.slice(0,2),c;default:return a}}}}()),new y(function(){var a=[{D:"r",x:-.15,y:.35,A:"0"},{D:"r",x:.15,y:.35,A:"1"}];
return{name:"ground 1",la:["a"],type:"e",ga:function(){return[0,0,.5]},hb:function(){return[1,-1,.5]},H:function(b,c){G(b,{nc:!0});b.buttons(a,c.g,{Md:-1});H(b,c.g[2],0,!1,"black",1)},$:function(b,c,d,f,e,h,g){b=pe(a,d,f,e,h,g);return null!==b?(A(c),c.g[b]=(c.g[b]+2)%3-1,b):J(0,!1,d,f,e,h,g)?(A(c),2):null},Sa:function(a,c,d,f,e,h,g,k){2<=d&&(c.g[d]=Math.max(.25,Math.min(.75,Math.round(4*qe(!1,f,e,h,g,k))/4)))},Ac:function(a){return a.g[0]||a.g[1]?null:new Da("No ground sensor specified",!0)},Lc:function(a,
c){switch(c){case "b":if(c=a.V.ga(),a.g[2]===c[2])return c=new z(ua("ground"),null,null),c.g=a.g.slice(0,2),c;default:return a}}}}()),new y({name:"tap",la:["b","a"],type:"e",H:function(a){a.I.translate(.05*a.w.j,0);ae(a);be(a)},Lc:function(a,b){switch(b){case "a":return new z(ua("accelerometer"),null,null);default:return a}}}),new y(function(){var a=[{D:"c",x:-.33,y:-.3,r:0},{D:"c",x:0,y:-.3,r:0},{D:"c",x:.33,y:-.3,r:0}];return{name:"accelerometer",la:["c"],type:"e",ga:function(){return[0,0]},H:function(b,
c){var d=c.g[0];c=c.g[1];0===d?(b.I.save(),b.I.translate(.08*b.w.j,-.2*b.w.j),ae(b),be(b),b.I.restore()):fe(b,2===d,2===d?-c:c);b.buttons(a,[0===d,1===d,2===d])},$:function(b,c,d,f,e,h,g){if(0!==c.g[0]&&ge(d,e,h,g))return A(c),1;b=pe(a,d,f,e,h,g);return null!==b?(A(c),c.g[0]=b,2):null},Sa:function(a,c,d,f,e,h,g,k){1===d&&(a=he(f,h,g,k),c.g[1]=2===c.g[0]?-a:a)},Lc:function(a,c){switch(c){case "b":if(0===a.g[0])return new z(ua("tap"),null,null);default:return a}}}}()),new y({name:"roll",la:["a"],type:"e",
ga:function(){return[0]},hb:function(){return[2]},H:function(a,b){fe(a,!1,b.g[0])},$:function(a,b,c,d,f,e,h){return ge(c,f,e,h,!0)?(A(b),1):null},Sa:function(a,b,c,d,f,e,h,g){b.g[0]=he(d,e,h,g,!0)}}),new y({name:"pitch",la:["a"],type:"e",ga:function(){return[0]},hb:function(){return[2]},H:function(a,b){fe(a,!0,b.g[0])},$:function(a,b,c,d,f,e,h){return ge(c,f,e,h,!0)?(A(b),1):null},Sa:function(a,b,c,d,f,e,h,g){b.g[0]=he(d,e,h,g,!0)}}),new y({name:"yaw",la:["a"],type:"e",ga:function(){return[0]},hb:function(){return[2]},
H:function(a,b){var c=a.I,d=a.w;b=b.g[0]*Math.PI/12;c.save();c.translate(.5*d.j,.5*d.j);c.rotate(b);ee(a);c.translate(-d.j/2,-d.j/2);G(a,{nc:!0,scale:.45});c.restore()},$:function(a,b,c,d,f,e,h){return ge(c,f,e,h,!0)?(A(b),1):null},Sa:function(a,b,c,d,f,e,h,g){b.g[0]=he(d,e,h,g,!0)}}),new y({name:"clap",type:"e",H:function(a){var b=a.I;a=a.w;b.save();b.beginPath();b.arc(.7*a.j,.6*a.j,.15*a.j,0,2*Math.PI);b.fillStyle="white";b.fill();b.beginPath();b.moveTo(.7*a.j,.6*a.j);b.lineTo(.8*a.j,.95*a.j);b.strokeStyle=
"white";b.lineWidth=.13*a.j;b.stroke();b.lineWidth=1.5*a.ja;b.translate(.3*a.j,.3*a.j);b.rotate(.1);for(var c=0;9>c;c++)b.beginPath(),b.moveTo(.07*a.j,0),b.lineTo(.14*a.j,0),b.moveTo(.17*a.j,0),b.lineTo(.22*a.j,0),b.stroke(),b.rotate(Math.PI/4.5);b.restore()}}),new y({name:"init",la:["b","a"],type:"e",H:function(a){var b=a.I;a=a.w;var c=.4*a.j;b.save();b.fillStyle="black";b.strokeStyle="black";b.lineWidth=a.ja;b.beginPath();b.arc(.3*a.j,.5*a.j,.08*a.j,0,2*Math.PI);b.fill();b.beginPath();b.moveTo(.42*
a.j,.5*a.j);b.lineTo(.7*a.j,.5*a.j);b.stroke();c*=.4;b.beginPath();b.moveTo(.8*a.j,.5*a.j);b.lineTo(.8*a.j-c*Math.sqrt(3)/2,.5*a.j+c/2);b.lineTo(.8*a.j-c*Math.sqrt(3)/2,.5*a.j-c/2);b.fill();b.restore()},Fg:!0}),new y({name:"timer",la:["a"],type:"e",H:function(a){je(a,0,!0,!1)}}),new y(function(){var a=[{D:"c",x:.3,y:.2},{D:"c",x:.3,y:-.2}];return{name:"clock",la:[],type:"e",ga:function(){return[10]},H:function(b,c){G(b);var d=b.w.j;ke(b.I,.1*d,.6*d,.3*d,.15*d,4,{style:10===c.g[0]?"black":"#222",lineWidth:b.w.ja});
ke(b.I,.1*d,.6*d,.7*d,.15*d,8,{style:20===c.g[0]?"black":"#222",lineWidth:b.w.ja});b.buttons(a,[10===c.g[0],20===c.g[0]])},$:function(b,c,d,f,e,h,g){b=pe(a,d,f,e,h,g);null!==b&&(A(c),c.g[0]=0===b?10:20);return b}}}()),new y(function(){var a=[{D:"t",x:-.25,y:0,r:-Math.PI/2},{D:"t",x:0,y:.25,r:0},{D:"t",x:0,y:-.25,r:Math.PI},{D:"t",x:.25,y:0,r:Math.PI/2},{D:"c",x:0,y:0,r:0}];return{name:"remote control arrows",la:[],type:"e",ga:function(){return[0]},H:function(b,c){var d=b.I,f=b.w;d.save();d.fillStyle=
"#eee";d.fillRect(.1*f.j,f.ja,.8*f.j,f.j-2*f.ja);d.restore();c=c.g[0];b.buttons(a,[0==c,1==c,2==c,3==c,4==c])},$:function(b,c,d,f,e,h,g){b=pe(a,d,f,e,h,g);null!==b&&(A(c),c.g[0]=b);return b}}}()),new y({name:"state",la:["a"],type:"s",ga:function(){return[0,0,0,0]},hb:function(){return[1,0,0,-1]},H:function(a,b){G(a);ne(a,b.g)},$:function(a,b,c,d,f,e,h){a=ue(c,d,f,e,h);null!==a&&(A(b),b.g[a]=(b.g[a]+2)%3-1);return a},Lc:function(a,b){return"b"===b&&0===a.g[0]&&0===a.g[1]&&0===a.g[2]&&0===a.g[3]?null:
a}}),new y({name:"state 8",la:["c"],type:"s",ga:function(){return[0]},H:function(a,b){G(a);oe(a,b.g[0])},$:function(a,b,c,d,f,e,h){a=ve(c,d,f,e,h);null!==a&&(A(b),b.g[0]=a);return a}}),new y(function(){var a=[{D:"t",x:-.3,y:.3,r:0},{D:"t",x:-.3,y:-.3,r:Math.PI},{D:"t",x:.1,y:.3,r:0},{D:"t",x:.1,y:-.3,r:Math.PI},{D:"c",x:.35,y:-.3,r:0}];return{name:"counter comparison",la:["a"],type:"s",ga:function(){return[0,0]},H:function(b,c){b.text(0===c.g[0]?"=":0<c.g[0]?"\u2265":"\u2264",{x:-.3*b.w.j,fillStyle:"black"});
b.text(c.g[1].toString(10),{x:.1*b.w.j,fillStyle:"black"});b.buttons(a,[1>c.g[0]?-2:0,-1<c.g[0]?-2:0,255>c.g[1]?-2:0,0<c.g[1]?-2:0,0!==c.g[1]?-2:0])},$:function(b,c,d,f,e,h,g){b=pe(a,d,f,e,h,g);if(null!==b)switch(A(c),b){case 0:c.g[0]=Math.min(1,c.g[0]+1);break;case 1:c.g[0]=Math.max(-1,c.g[0]-1);break;case 2:c.g[1]=Math.min(255,c.g[1]+1);break;case 3:c.g[1]=Math.max(0,c.g[1]-1);break;case 4:c.g[1]=0}return b}}}()),new y({name:"color state",la:["c"],type:"s",ga:function(){return[0,0,0]},H:function(a,
b){G(a,{Xb:b.g});H(a,b.g[0],.3,!1,"red");H(a,b.g[1],0,!1,"#0c0");H(a,b.g[2],-.3,!1,"#08f")},$:function(a,b,c,d,f,e,h){return J(.3,!1,c,d,f,e,h)?(A(b),0):J(0,!1,c,d,f,e,h)?(A(b),1):J(-.3,!1,c,d,f,e,h)?(A(b),2):null},Sa:function(a,b,c,d,f,e,h,g){b.g[c]=Math.max(0,Math.min(1,Math.round(qe(!1,d,f,e,h,g))))}}),new y(function(){var a=[{D:"r",x:-.15,y:.3,size:1.4,A:"black",fillStyle:"#666",strokeStyle:"white"},{D:"r",x:-.3,y:0,size:1.4,A:"red",fillStyle:"red",strokeStyle:"white"},{D:"r",x:0,y:0,size:1.4,
A:"green",fillStyle:"#0c0",strokeStyle:"white"},{D:"r",x:.3,y:0,size:1.4,A:"yellow",fillStyle:"yellow",strokeStyle:"silver"},{D:"r",x:-.3,y:-.3,size:1.4,A:"blue",fillStyle:"blue",strokeStyle:"white"},{D:"r",x:0,y:-.3,size:1.4,A:"magenta",fillStyle:"magenta",strokeStyle:"white"},{D:"r",x:.3,y:-.3,size:1.4,A:"cyan",fillStyle:"cyan",strokeStyle:"white"},{D:"r",x:.15,y:.3,size:1.4,A:"white",fillStyle:"white",strokeStyle:"silver"}];return{name:"color 8 state",la:["a"],type:"s",ga:function(){return[0]},
H:function(b,c){G(b,{Xb:[c.g&1,(c.g&2)/2,(c.g&4)/4]});b.buttons(a,[1>c.g[0]?-2:0,-1<c.g[0]?-2:0])},$:function(b,c,d,f,e,h,g){b=pe(a,d,f,e,h,g);null!==b&&(A(c),c.g=[b]);return b}}}()),new y({name:"motor state",la:["c"],type:"s",ga:function(){return[0,0]},H:function(a,b){var c=Zd(a,2.4*b.g[0],2.4*b.g[1],.19);G(a,{nc:!0,scale:.45,rotation:c.eb,wf:[.19*c.x*a.w.j+.13*a.w.j*Math.sin(c.eb),.19*c.y*a.w.j+.13*a.w.j*Math.cos(c.eb)]});a.I.save();a.I.globalAlpha=.2;Zd(a,2.4*b.g[0],2.4*b.g[1],.19);a.I.restore();
H(a,.5+.5*b.g[0],-.4,!0,0===b.g[0]?"white":b.g[0]===b.g[1]?"#0c0":b.g[0]===-b.g[1]?"#f70":"#fd0");H(a,.5+.5*b.g[1],.4,!0,0===b.g[1]?"white":b.g[0]===b.g[1]?"#0c0":b.g[0]===-b.g[1]?"#f70":"#fd0")},$:function(a,b,c,d,f,e,h){return J(-.4,!0,c,d,f,e,h)?(A(b),0):J(.4,!0,c,d,f,e,h)?(A(b),1):$d(a,c,f,e,.5*b.g[0],.5*b.g[1],h)?(A(b),2):null},Sa:function(a,b,c,d,f,e,h,g){2>c?(a=qe(!0,d,f,e,h,g),b.g[c]=.25>a?-1:.75<a?1:0):(a=qe(!0,d,f,e,h,g),a=.25>a?-1:.75<a?1:0,b.g[0]=a,b.g[1]=a)}}),new y({name:"motor",type:"a",
ga:function(){return[0,0]},hb:function(){return[.5,.2]},H:function(a,b){var c=Zd(a,2.4*b.g[0],2.4*b.g[1],.19);G(a,{nc:!0,scale:.45,rotation:c.eb,wf:[.19*c.x*a.w.j+.13*a.w.j*Math.sin(c.eb),.19*c.y*a.w.j+.13*a.w.j*Math.cos(c.eb)]});a.I.save();a.I.globalAlpha=.2;Zd(a,2.4*b.g[0],2.4*b.g[1],.19);a.I.restore();H(a,.5+.5*b.g[0],-.4,!0,0===b.g[0]?"white":b.g[0]===b.g[1]?"#0c0":b.g[0]===-b.g[1]?"#f70":"#fd0");H(a,.5+.5*b.g[1],.4,!0,0===b.g[1]?"white":b.g[0]===b.g[1]?"#0c0":b.g[0]===-b.g[1]?"#f70":"#fd0")},
$:function(a,b,c,d,f,e,h){return J(-.4,!0,c,d,f,e,h)?(A(b),0):J(.4,!0,c,d,f,e,h)?(A(b),1):$d(a,c,f,e,.5*b.g[0],.5*b.g[1],h)?(A(b),2):null},Sa:function(a,b,c,d,f,e,h,g){2>c?(a=2*qe(!0,d,f,e,h,g)-1,d=b.g[1-c],.1>Math.abs(a)?a=0:.1>Math.abs(a-d)?a=d:.1>Math.abs(a+d)&&(a=-d),b.g[c]=Math.max(-1,Math.min(1,a))):(a=2*qe(!0,d,f,e,h,g)-1,a=.1>Math.abs(a)?0:Math.max(-1,Math.min(1,a)),.05>Math.abs(b.g[0]-b.g[1])?(b.g[0]=a,b.g[1]=a):Math.abs(b.g[0])>Math.abs(b.g[1])?(b.g[1]*=a/b.g[0],b.g[0]=a):(b.g[0]*=a/b.g[1],
b.g[1]=a))}}),new y(function(){var a=[{D:"c",x:0,y:0,r:0},{D:"t",x:0,y:.35,r:0},{D:"t",x:0,y:-.35,r:Math.PI},{D:"t",x:-.3,y:.32,r:-.4},{D:"t",x:.3,y:.32,r:.4},{D:"t",x:-.35,y:.05,r:-Math.PI/2},{D:"t",x:.35,y:.05,r:Math.PI/2}];return{name:"move",la:["c"],type:"a",ga:function(){return[0]},H:function(b,c){G(b,{nc:!0,scale:.45});b.buttons(a,[0===c.g[0]?1:-2,1===c.g[0]?1:-2,2===c.g[0]?1:-2,3===c.g[0]?1:-2,4===c.g[0]?1:-2,5===c.g[0]?1:-2,6===c.g[0]?1:-2])},$:function(b,c,d,f,e,h,g){b=pe(a,d,f,e,h,g);null!==
b&&(A(c),c.g[0]=b);return b}}}()),new y({name:"nn obstacles",la:[],type:"a",ga:function(){return[0,0,0,0]},hb:function(){return[.3,.2,.1,.3]},H:function(a,b,c,d){c=d?.5:1;var f=a.I,e=a.w;f.save();d&&f.scale(c,c);f.fillStyle="white";f.font=e.Bf;f.textAlign="center";f.textBaseline="middle";f.translate(.5*e.j,.5*e.j);f.translate(-.5*e.j,-.5*e.j);d?(f.fillText("\u21d1",.25*e.j,.35*e.j),f.fillText(b.g[0].toFixed(1),.6*e.j,.35*e.j),f.fillText("\u21a7",.25*e.j,.81*e.j),f.fillText(b.g[1].toFixed(1),.6*e.j,
.81*e.j),f.fillText("+",.25*e.j,1.27*e.j),f.fillText(b.g[2].toFixed(1),.6*e.j,1.27*e.j),f.fillText("\u2212",.25*e.j,1.69*e.j),f.fillText(b.g[3].toFixed(1),.6*e.j,1.69*e.j),f.translate(e.j,0),H(a,b.g[0],.15,!1),H(a,b.g[1],-.3,!1),H(a,b.g[2],-.75,!1),H(a,b.g[3],-1.2,!1)):(f.fillText("\u21d1",.25*e.j,.17*e.j),f.fillText(b.g[0].toFixed(1),.6*e.j,.17*e.j),f.fillText("\u21a7",.25*e.j,.4*e.j),f.fillText(b.g[1].toFixed(1),.6*e.j,.4*e.j),f.fillText("+",.25*e.j,.63*e.j),f.fillText(b.g[2].toFixed(1),.6*e.j,
.63*e.j),f.fillText("\u2212",.25*e.j,.87*e.j),f.fillText(b.g[3].toFixed(1),.6*e.j,.87*e.j));f.restore()},ae:!0,$:function(a,b,c,d,f,e,h){return J(.35,!1,c/2,d,f+c/2,e,h)?(A(b),0):J(.12,!1,c/2,d,f+c/2,e,h)?(A(b),1):J(-.12,!1,c/2,d,f+c/2,e,h)?(A(b),2):J(-.35,!1,c/2,d,f+c/2,e,h)?(A(b),3):null},Sa:function(a,b,c,d,f,e,h,g){b.g[c]=Math.max(0,Math.min(1,Math.round(20*qe(!1,d/2,f,e+d/2,h,g))/20))}}),new y({name:"top color",la:["a"],type:"a",ga:function(){return[0,0,0]},H:function(a,b){G(a,{Xb:b.g});H(a,
b.g[0],.3,!1,"red");H(a,b.g[1],0,!1,"#0c0");H(a,b.g[2],-.3,!1,"#08f")},$:function(a,b,c,d,f,e,h){return J(.3,!1,c,d,f,e,h)?(A(b),0):J(0,!1,c,d,f,e,h)?(A(b),1):J(-.3,!1,c,d,f,e,h)?(A(b),2):null},Sa:function(a,b,c,d,f,e,h,g){b.g[c]=Math.max(0,Math.min(1,qe(!1,d,f,e,h,g)))}}),new y(function(){var a=[{D:"r",x:-.15,y:.3,size:1.4,A:"black",fillStyle:"#666",strokeStyle:"white"},{D:"r",x:-.3,y:0,size:1.4,A:"red",fillStyle:"red",strokeStyle:"white"},{D:"r",x:0,y:0,size:1.4,A:"green",fillStyle:"#0c0",strokeStyle:"white"},
{D:"r",x:.3,y:0,size:1.4,A:"yellow",fillStyle:"yellow",strokeStyle:"silver"},{D:"r",x:-.3,y:-.3,size:1.4,A:"blue",fillStyle:"blue",strokeStyle:"white"},{D:"r",x:0,y:-.3,size:1.4,A:"magenta",fillStyle:"magenta",strokeStyle:"white"},{D:"r",x:.3,y:-.3,size:1.4,A:"cyan",fillStyle:"cyan",strokeStyle:"white"},{D:"r",x:.15,y:.3,size:1.4,A:"white",fillStyle:"white",strokeStyle:"silver"}];return{name:"top color 8",la:["b"],type:"a",ga:function(){return[0]},H:function(b,c){G(b,{Xb:[c.g&1,(c.g&2)/2,(c.g&4)/
4]});b.buttons(a,[1>c.g[0]?-2:0,-1<c.g[0]?-2:0])},$:function(b,c,d,f,e,h,g){b=pe(a,d,f,e,h,g);null!==b&&(A(c),c.g=[b]);return b}}}()),new y({name:"bottom color",la:["a"],type:"a",ga:function(){return[0,0,0]},H:function(a,b){G(a,{nc:!0,Xb:b.g});H(a,b.g[0],.3,!1,"red");H(a,b.g[1],0,!1,"#0c0");H(a,b.g[2],-.3,!1,"#08f")},$:function(a,b,c,d,f,e,h){return J(.3,!1,c,d,f,e,h)?(A(b),0):J(0,!1,c,d,f,e,h)?(A(b),1):J(-.3,!1,c,d,f,e,h)?(A(b),2):null},Sa:function(a,b,c,d,f,e,h,g){b.g[c]=Math.max(0,Math.min(1,qe(!1,
d,f,e,h,g)))}}),new y({name:"bottom-left color",la:["c"],type:"a",ga:function(){return[0,0,0]},H:function(a,b){G(a,{nc:!0,Xb:b.g,Pe:"left"});H(a,b.g[0],.3,!1,"red");H(a,b.g[1],0,!1,"#0c0");H(a,b.g[2],-.3,!1,"#08f")},$:function(a,b,c,d,f,e,h){return J(.3,!1,c,d,f,e,h)?(A(b),0):J(0,!1,c,d,f,e,h)?(A(b),1):J(-.3,!1,c,d,f,e,h)?(A(b),2):null},Sa:function(a,b,c,d,f,e,h,g){b.g[c]=Math.max(0,Math.min(1,qe(!1,d,f,e,h,g)))}}),new y({name:"bottom-right color",la:["c"],type:"a",ga:function(){return[0,0,0]},H:function(a,
b){G(a,{nc:!0,Xb:b.g,Pe:"right"});H(a,b.g[0],.3,!1,"red");H(a,b.g[1],0,!1,"#0c0");H(a,b.g[2],-.3,!1,"#08f")},$:function(a,b,c,d,f,e,h){return J(.3,!1,c,d,f,e,h)?(A(b),0):J(0,!1,c,d,f,e,h)?(A(b),1):J(-.3,!1,c,d,f,e,h)?(A(b),2):null},Sa:function(a,b,c,d,f,e,h,g){b.g[c]=Math.max(0,Math.min(1,qe(!1,d,f,e,h,g)))}}),new y(function(){var a=[{D:"r",x:-.15,y:.3,size:1.4,A:"black",fillStyle:"#666",strokeStyle:"white"},{D:"r",x:-.3,y:0,size:1.4,A:"red",fillStyle:"red",strokeStyle:"white"},{D:"r",x:0,y:0,size:1.4,
A:"green",fillStyle:"#0c0",strokeStyle:"white"},{D:"r",x:.3,y:0,size:1.4,A:"yellow",fillStyle:"yellow",strokeStyle:"silver"},{D:"r",x:-.3,y:-.3,size:1.4,A:"blue",fillStyle:"blue",strokeStyle:"white"},{D:"r",x:0,y:-.3,size:1.4,A:"magenta",fillStyle:"magenta",strokeStyle:"white"},{D:"r",x:.3,y:-.3,size:1.4,A:"cyan",fillStyle:"cyan",strokeStyle:"white"},{D:"r",x:.15,y:.3,size:1.4,A:"white",fillStyle:"white",strokeStyle:"silver"}];return{name:"bottom color 8",la:["b"],type:"a",ga:function(){return[0]},
H:function(b,c){G(b,{nc:!0,Xb:[c.g&1,(c.g&2)/2,(c.g&4)/4]});b.buttons(a,[1>c.g[0]?-2:0,-1<c.g[0]?-2:0])},$:function(b,c,d,f,e,h,g){b=pe(a,d,f,e,h,g);null!==b&&(A(c),c.g=[b]);return b}}}()),new y(function(){var a=[{D:"r",x:-.15,y:.3,size:1.4,A:"black",fillStyle:"#666",strokeStyle:"white"},{D:"r",x:-.3,y:0,size:1.4,A:"red",fillStyle:"red",strokeStyle:"white"},{D:"r",x:0,y:0,size:1.4,A:"green",fillStyle:"#0c0",strokeStyle:"white"},{D:"r",x:.3,y:0,size:1.4,A:"yellow",fillStyle:"yellow",strokeStyle:"silver"},
{D:"r",x:-.3,y:-.3,size:1.4,A:"blue",fillStyle:"blue",strokeStyle:"white"},{D:"r",x:0,y:-.3,size:1.4,A:"magenta",fillStyle:"magenta",strokeStyle:"white"},{D:"r",x:.3,y:-.3,size:1.4,A:"cyan",fillStyle:"cyan",strokeStyle:"white"},{D:"r",x:.15,y:.3,size:1.4,A:"white",fillStyle:"white",strokeStyle:"silver"}];return{name:"bottom-left color 8",la:["c"],type:"a",ga:function(){return[0]},H:function(b,c){G(b,{nc:!0,Xb:[c.g&1,(c.g&2)/2,(c.g&4)/4],Pe:"left"});b.buttons(a,[1>c.g[0]?-2:0,-1<c.g[0]?-2:0])},$:function(b,
c,d,f,e,h,g){b=pe(a,d,f,e,h,g);null!==b&&(A(c),c.g=[b]);return b}}}()),new y(function(){var a=[{D:"r",x:-.15,y:.3,size:1.4,A:"black",fillStyle:"#666",strokeStyle:"white"},{D:"r",x:-.3,y:0,size:1.4,A:"red",fillStyle:"red",strokeStyle:"white"},{D:"r",x:0,y:0,size:1.4,A:"green",fillStyle:"#0c0",strokeStyle:"white"},{D:"r",x:.3,y:0,size:1.4,A:"yellow",fillStyle:"yellow",strokeStyle:"silver"},{D:"r",x:-.3,y:-.3,size:1.4,A:"blue",fillStyle:"blue",strokeStyle:"white"},{D:"r",x:0,y:-.3,size:1.4,A:"magenta",
fillStyle:"magenta",strokeStyle:"white"},{D:"r",x:.3,y:-.3,size:1.4,A:"cyan",fillStyle:"cyan",strokeStyle:"white"},{D:"r",x:.15,y:.3,size:1.4,A:"white",fillStyle:"white",strokeStyle:"silver"}];return{name:"bottom-right color 8",la:["c"],type:"a",ga:function(){return[0]},H:function(b,c){G(b,{nc:!0,Xb:[c.g&1,(c.g&2)/2,(c.g&4)/4],Pe:"right"});b.buttons(a,[1>c.g[0]?-2:0,-1<c.g[0]?-2:0])},$:function(b,c,d,f,e,h,g){b=pe(a,d,f,e,h,g);null!==b&&(A(c),c.g=[b]);return b}}}()),new y({name:"notes",type:"a",ga:function(){return[0,
1,1,1,2,1,0,1,2,1,4,2]},H:function(a,b){b=b.g;var c=a.I,d=a.w;c.save();c.fillStyle="#eee";for(var f=0;5>f;f++)c.fillRect(.1*d.j,d.j*(.1+.16*f),.8*d.j,.16*d.j-d.ja);ce(a,b,.1,.9,.9,.1,5,.14,1);c.restore()},$:function(a,b,c,d,f,e,h){return(a=re(.1,.9,.9,.1,6,5,c,d,f,e,h))?(A(b),b.g[2*a.index]===a.tone?b.g[2*a.index+1]=(b.g[2*a.index+1]+1)%3:(b.g[2*a.index]=a.tone,b.g[2*a.index+1]=1),0):null}}),new y(function(){var a=[{D:"t",x:-.3,y:.3,r:0},{D:"t",x:-.3,y:-.3,r:Math.PI}];return{name:"play",la:["c"],
type:"a",ga:function(){return[0]},H:function(b,c){de(b,c.g[0]);b.buttons(a,[-2,-2])},$:function(b,c,d,f,e,h,g){b=pe(a,d,f,e,h,g);if(null!==b)switch(A(c),b){case 0:c.g[0]=(c.g[0]+1)%100;break;case 1:c.g[0]=(c.g[0]+99)%100}return b}}}()),new y({name:"play stop",la:["c"],type:"a",H:function(a){de(a,null)}}),new y({name:"set state",la:["a"],type:"a",ga:function(){return[0,0,0,0]},hb:function(){return[0,1,-1,0]},H:function(a,b){G(a);ne(a,b.g)},$:function(a,b,c,d,f,e,h){a=ue(c,d,f,e,h);null!==a&&(A(b),
b.g[a]=(b.g[a]+2)%3-1);return a}}),new y({name:"toggle state",la:["c"],type:"a",ga:function(){return[!1,!1,!1,!1]},hb:function(){return[!0,!1,!1,!1]},H:function(a,b){G(a);ne(a,b.g.map(function(a){return a?2:0}));Hc(a.I,a.w.j/2,a.w.j/2,.2*a.w.j,-1.4,1.4,{style:"black",lineWidth:a.w.ja,Yc:5*a.w.ja});Hc(a.I,a.w.j/2,a.w.j/2,.2*a.w.j,Math.PI-1.4,Math.PI+1.4,{style:"black",lineWidth:a.w.ja,Yc:5*a.w.ja})},$:function(a,b,c,d,f,e,h){a=ue(c,d,f,e,h);null!==a&&(A(b),b.g[a]=!b.g[a]);return a}}),new y({name:"set state 8",
la:["c"],type:"a",ga:function(){return[0]},H:function(a,b){G(a);oe(a,b.g[0])},$:function(a,b,c,d,f,e,h){a=ve(c,d,f,e,h);null!==a&&(A(b),b.g[0]=a);return a}}),new y(function(){var a=[{D:"c",x:-.2,y:0},{D:"c",x:.2,y:0}];return{name:"change state 8",la:["c"],type:"a",ga:function(){return[1]},H:function(b,c){G(b);var d=b.I;d.save();for(var f=0;8>f;f++)me(b,Math.PI*(.46-.25*f),Math.PI*(.54-.25*f),0);d.restore();Hc(b.I,b.w.j/2,b.w.j/2,.375*b.w.j,-.8,.8,{style:"black",lineWidth:b.w.ja,Yc:5*b.w.ja});Hc(b.I,
b.w.j/2,b.w.j/2,.375*b.w.j,Math.PI-.8,Math.PI+.8,{Jd:!0,style:"black",lineWidth:b.w.ja,Yc:5*b.w.ja});b.buttons(a,[0>c.g[0],0<c.g[0]])},$:function(b,c,d,f,e,h,g){b=pe(a,d,f,e,h,g);null!==b&&(A(c),c.g[0]=0===b?-1:1);return b}}}()),new y(function(){var a=[{D:"t",x:0,y:.3,r:0},{D:"t",x:0,y:-.3,r:Math.PI}];return{name:"set counter",la:["a"],type:"a",ga:function(){return[0]},H:function(b,c){b.text(0===c.g[0]?"= 0":0<c.g[0]?"+1":"\u22121");b.buttons(a,[1>c.g[0]?-2:0,-1<c.g[0]?-2:0])},$:function(b,c,d,f,
e,h,g){b=pe(a,d,f,e,h,g);if(null!==b)switch(A(c),b){case 0:c.g[0]=Math.min(1,c.g[0]+1);break;case 1:c.g[0]=Math.max(-1,c.g[0]-1)}return b}}}()),new y({name:"set timer",la:["a"],type:"a",ga:function(){return[1]},H:function(a,b){je(a,b.g[0],!1,!1)},$:function(a,b,c,d,f,e,h){return se(c,d,f,e,h)?(A(b),1):null},Sa:function(a,b,c,d,f,e,h,g){b.g[0]=te(d,f,e,h,!1,g)}}),new y({name:"set timer log",la:["c"],type:"a",ga:function(){return[1]},H:function(a,b){je(a,b.g[0],!1,!0)},$:function(a,b,c,d,f,e,h){return se(c,
d,f,e,h)?(A(b),1):null},Sa:function(a,b,c,d,f,e,h,g){b.g[0]=te(d,f,e,h,!0,g)}}),new y(function(){function a(a,b){if(a.g[1]){var c=new Image;c.src=a.g[1];c.addEventListener("load",function(){a.g[2]=c;b&&b()},!1)}}var b=[{D:"c",x:-.33,y:-.3,r:0}];return{name:"picture comment",la:["a"],type:"c",ga:function(){return[!1,"",null]},gf:function(a){return 2<=a.g.length?[!1,a.g[1]]:[!1,""]},ke:function(b,d,f){b.g=2<=d.length?[!1,d[1]]:[!1,""];a(b,f)},H:function(a,d){d.g[2]&&a.I.drawImage(d.g[2],0,0,240,240,
0,0,a.w.j,a.w.j);a.buttons(b,[d.g[0]])},$:function(c,d,f,e,h,g,k){f=pe(b,f,e,h,g,k);0===f&&(d.g[0]?aa&&(aa.pause&&aa.pause(),ca.getTracks().forEach(function(a){a.stop()}),aa=null):(A(d),navigator.mediaDevices.getUserMedia({audio:!1,video:{width:320,height:240}}).then(function(b){ca=b;aa=document.createElement("video");aa.srcObject=b;aa.addEventListener("loadedmetadata",function(){aa.play();var b=setInterval(function(){aa?(da||(da=document.createElement("canvas"),da.width=240,da.height=240),da.getContext("2d").drawImage(aa,
0,0,240,240,0,0,240,240),d.g[1]=da.toDataURL("image/png"),a(d,function(){c.ra&&c.ra();C(c)})):clearInterval(b)},100)},!1)})),d.g[0]=!d.g[0]);return f}}}())];function we(a,b){function c(a){return a instanceof Array?a.join(""):a}function d(a,b){return a.map(function(a){return oa(a,b)})}var f=b||{};["aseba","l2","js","python"].forEach(function(b){a[b]&&(f[b]=function(e){var f=e?e.g:[];e={};a[b].initVarDecl&&(e.Wb=d(a[b].initVarDecl.map(c),f));a[b].initCodeDecl&&(e.Vb=d(a[b].initCodeDecl.map(c),f));a[b].initCodeExec&&(e.hc=d(a[b].initCodeExec.map(c),f));a[b].sectionBegin&&(e.R=oa(c(a[b].sectionBegin),f));a[b].sectionEnd&&(e.ib=oa(c(a[b].sectionEnd),f));a[b].sectionPreamble&&
(e.Xa=oa(c(a[b].sectionPreamble),f));a[b].clauseInit&&(e.ba=oa(c(a[b].clauseInit),f));if(a[b].clauseAnd){var h="";f.forEach(function(d,e){(d=oa(c(a[b].clauseAnd),f,e))&&(h+=(0<h.length?" "+pa[b].m+" ":"")+d)});e.Va=h||pa[b].o}else a[b].clause&&(e.Va=oa(c(a[b].clause),f));a[b].clauseAsCondition&&(e.tg=oa(c(a[b].clauseAsCondition),f));e.wh=a[b].clauseOptional||!1;a[b].statement1?e.ka=f.map(function(d,e){return oa(c(a[b].statement1),f,e)}).join(""):a[b].statement&&(e.ka=oa(c(a[b].statement),f));a[b].error&&
(e.Va=oa(c(a.error.error),f));return e})});return f};function xe(a){this.P=new DOMParser;this.b=this.P.parseFromString(a,"text/xml");this.h=this.b.documentElement;this.Ca=(this.h.getAttribute("viewBox")||"0 0 1 1").split(" ").map(function(a){return parseFloat(a)});this.u={}}
var ye={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgreen:"#006400",
darkgrey:"#A9A9A9",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",
ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",green:"#008000",greenyellow:"#ADFF2F",grey:"#808080",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgreen:"#90EE90",lightgrey:"#D3D3D3",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",
lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",
moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",
seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"};function ze(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}function Ae(a){var b={};ze(b,a);return b}
function Be(a,b){b.split(";").forEach(function(b){b=b.trim().split(":").map(function(a){return a.trim()});2===b.length&&(a[b[0]]=b[1])})}
function Ce(a,b,c,d,f){a&&(a=a.replace(/\s*\(\s*/g,"(").replace(/\s*\)\s*/g,")").replace(/ +,/g,",").replace(/, +/g,",").replace(/ +/g,","),a.split(")").slice(0,-1).forEach(function(a){var e=a.split("(")[0];a=a.split("(")[1].split(",").map(function(a){return parseFloat(a)});switch(e){case "translate":b(a[0]||0,a[1]||0);break;case "rotate":e=(a[0]||0)*Math.PI/180;var g=a[1]||0;a=a[2]||0;0!==g||0!==a?(b(-g,-a),c(e),b(g,a)):c(e);break;case "scale":e=a[0]||1;d(e,a[1]||e);break;case "matrix":f(a[0],a[1],
a[2],a[3],a[4],a[5]);break;default:throw"transform not implemented: "+e;}}))}function De(a,b){Ce(a,function(a,d){b.translate(a,d)},function(a){b.rotate(a)},function(a,d){b.scale(a,d)},function(a,d,f,e,h,g){b.Me(a,d,f,e,h,g)})}
xe.prototype.H=function(a,b){function c(f,l,m){function v(){for(var a=0;a<f.childElementCount;a++)c(f.children[a],l,m)}function p(a,b){a=f.getAttribute(a);return null===a?b||0:parseFloat(a)}function t(a,b){a=n.apply(new Ee(a,b));r.push(a.x);u.push(a.y)}function x(a,b,c){if(null==a||""==a)return b;a=/^\s*(-?[0-9.]+)\s*([a-z%]*)\s*$/i.exec(a);b=parseFloat(a[1]);switch(a[2]||"px"){case "pt":return 25.4*b/72*3;case "pc":return 25.4*b/6*3;case "in":return 25.4*b*3;case "mm":return 3*b;case "cm":return 30*
b;case "em":return 18*b;case "ex":return 9*b;case "%":return b*c/100;default:return b}}function F(c){c=c.replace(/\.([0-9]+)(?=\.)/g,".$1 ").replace(/([.0-9])-/g,"$1 -").replace(/\s*([a-z])\s*/gi,";$1").replace(/\s*,\s*/g,",").replace(/\s+/g,",");var f=0,e=0,g=0,h=0,k=0,l=0,m=[],n=[],v=!0;a&&a.beginPath();c.slice(1).split(";").forEach(function(c){var p=c[0];c=1<c.length?c.slice(1).split(",").map(function(a){return parseFloat(a)}):[];switch(p){case "M":if(2<=c.length){f=c[0];e=c[1];k=f;l=e;a&&a.moveTo(f,
e);t(f,e);v&&1<m.length&&b&&b.za&&b.za.line&&b.za.line(m,n,!1);v=!0;m=r.slice(-1);n=u.slice(-1);for(p=2;p+1<c.length;p+=2)f=c[p],e=c[p+1],a&&a.lineTo(f,e),t(f,e),m.push(r[r.length-1]),n.push(u[u.length-1]);g=f;h=e}break;case "m":if(2<=c.length)for(f+=c[0],e+=c[1],k=f,l=e,a&&a.moveTo(f,e),t(f,e),v&&1<m.length&&b&&b.za&&b.za.line&&b.za.line(m,n,!1),v=!0,m=r.slice(-1),n=u.slice(-1),p=2;p+1<c.length;p+=2)f+=c[p],e+=c[p+1],a&&a.lineTo(f,e),t(f,e),m.push(r[r.length-1]),n.push(u[u.length-1]);g=f;h=e;break;
case "L":for(p=0;p+1<c.length;p+=2)f=c[p],e=c[p+1],a&&a.lineTo(f,e),t(f,e),m.push(r[r.length-1]),n.push(u[u.length-1]);g=f;h=e;break;case "l":for(p=0;p+1<c.length;p+=2)f+=c[p],e+=c[p+1],a&&a.lineTo(f,e),t(f,e),m.push(r[r.length-1]),n.push(u[u.length-1]);g=f;h=e;break;case "H":for(p=0;p<c.length;p++)f=c[p],a&&a.lineTo(f,e),t(f,e),m.push(r[r.length-1]),n.push(u[u.length-1]);g=f;h=e;break;case "h":for(p=0;p<c.length;p++)f+=c[p],a&&a.lineTo(f,e),t(f,e),m.push(r[r.length-1]),n.push(u[u.length-1]);g=f;
h=e;break;case "V":for(p=0;p<c.length;p++)e=c[p],a&&a.lineTo(f,e),t(f,e),m.push(r[r.length-1]),n.push(u[u.length-1]);g=f;h=e;break;case "v":for(p=0;p<c.length;p++)e+=c[p],a&&a.lineTo(f,e),t(f,e),m.push(r[r.length-1]),n.push(u[u.length-1]);g=f;h=e;break;case "A":for(p=0;p+6<c.length;p+=7){var q=c[p+5],Ca=c[p+6],O=d(c[p],c[p+1],c[p+2]*Math.PI/180,0!=c[p+3],0==c[p+4],f,e,q,Ca);f=q;e=Ca;t(O.x,O.y);t(f,e);v=!1}g=f;h=e;break;case "a":for(p=0;p+6<c.length;p+=7)q=f+c[p+5],Ca=e+c[p+6],O=d(c[p],c[p+1],c[p+
2]*Math.PI/180,0!=c[p+3],0==c[p+4],f,e,q,Ca),f=q,e=Ca,t(O.x,O.y),t(f,e),v=!1;g=f;h=e;break;case "C":for(p=0;p+5<c.length;p+=6)a&&a.bezierCurveTo(c[p],c[p+1],c[p+2],c[p+3],c[p+4],c[p+5]),f=c[p+4],e=c[p+5],g=2*f-c[p+2],h=2*e-c[p+3],t(f,e),v=!1;break;case "c":for(p=0;p+5<c.length;p+=6)a&&a.bezierCurveTo(f+c[p],e+c[p+1],f+c[p+2],e+c[p+3],f+c[p+4],e+c[p+5]),g=f+2*c[p+4]-c[p+2],h=e+2*c[p+5]-c[p+3],f+=c[p+4],e+=c[p+5],t(f,e),v=!1;break;case "S":for(p=0;p+3<c.length;p+=4)a&&a.bezierCurveTo(g,h,c[p],c[p+1],
c[p+2],c[p+3]),f=c[p+2],e=c[p+3],g=2*f-c[p],h=2*e-c[p+1],t(f,e),v=!1;break;case "s":for(p=0;p+3<c.length;p+=4)a&&a.bezierCurveTo(g,h,f+c[p],e+c[p+1],f+c[p+2],e+c[p+3]),g=f-c[p],h=e-c[p+1],f+=c[p+2],e+=c[p+3],t(f,e),v=!1;break;case "Q":for(p=0;p+3<c.length;p+=4)a&&a.quadraticCurveTo(c[p],c[p+1],c[p+2],c[p+3]),f=c[p+2],e=c[p+3],g=2*f-c[p],h=2*e-c[p+1],t(f,e),v=!1;break;case "q":for(p=0;p+3<c.length;p+=4)a&&a.quadraticCurveTo(f+c[p],e+c[p+1],f+c[p+2],e+c[p+3]),g=f+2*c[p+2]-c[p],h=e+2*c[p+3]-c[p+1],f+=
c[p+2],e+=c[p+3],t(f,e),v=!1;break;case "T":for(p=0;p+1<c.length;p+=2)a&&a.quadraticCurveTo(g,h,c[p],c[p+1]),f=c[p],e=c[p+1],g=2*f-g,h=2*e-h,t(f,e),v=!1;break;case "t":for(p=0;p+1<c.length;p+=2)a&&a.quadraticCurveTo(g,h,f+c[p],e+c[p+1]),f+=c[p],e+=c[p+1],g=2*f-g,h=2*e-h,t(f,e),v=!1;break;case "Z":case "z":f=k;e=l;a&&a.closePath();v&&1<m.length&&b&&b.za&&b.za.line&&b.za.line(m,n,!0);v=!0;m=[];n=[];break;default:throw"unimplemented path command: "+p;}});v&&1<m.length&&b&&b.za&&b.za.line&&b.za.line(m,
n,!1)}function L(b){function c(a,b){if(0<b.length){a.splice(0,a.length);for(var c=0;c<b.length&&1>c;c++){var d=(b[c].getAttribute("offset")||"0").trim(),e=/%$/.test(d)?parseFloat(d.slice(0,-1))/100:parseFloat(d),f=b[c].getAttribute("style");d={};f&&Be(d,f);isNaN(e)||(f=b[c].getAttribute("stop-color")||d["stop-color"]||"#000",ye.hasOwnProperty(f)&&(f=ye[f]),d=(b[c].getAttribute("stop-opacity")||d["stop-opacity"]||"1").trim(),d=/%$/.test(d)?parseFloat(d.slice(0,-1))/100:parseFloat(d),1!==d&&(/^#[0-9a-f]{3}$/i.test(f)?
f="rgba("+f.slice(1).split("").map(function(a){return 17*parseInt(a,16)}).map(function(a){return a.toString(10)}).join(",")+","+d.toFixed(2)+")":/^#[0-9a-f]{6}$/i.test(f)?f="rgba("+[f.slice(1,3),f.slice(3,5),f.slice(5)].map(function(a){return parseInt(a,16)}).map(function(a){return a.toString(10)}).join(",")+","+d.toFixed(2)+")":/^rgb(\d+%?(,|\s+)\d+%?(,|\s+)\d+%?)$/i.test(f)?f=f.slice(0,-1).replace(/\s+/g,",")+","+d.toFixed(2)+")":/^hsl(\d+%?(,|\s+)\d+%?(,|\s+)\d+%?)$/i.test(f)&&(f=f.slice(0,-1).replace(/\s+/g,
",")+","+d.toFixed(2)+")")),a.push({offset:e,color:f}))}}}function d(a,b){if(a.attributes["xlink:href"]){var f=a.getAttribute("xlink:href");"#"===f[0]&&(f=k.b.getElementById(f.slice(1)))&&(b=d(f,b))}b.nd=a.attributes.x1?parseFloat(a.getAttribute("x1")):b.nd||0;b.pd=a.attributes.y1?parseFloat(a.getAttribute("y1")):b.pd||0;b.od=a.attributes.x2?parseFloat(a.getAttribute("x2")):b.od||0;b.qd=a.attributes.y2?parseFloat(a.getAttribute("y2")):b.qd||0;b.Fc=a.attributes.gradientUnits?a.getAttribute("gradientUnits"):
b.Fc||"objectBoundingBox";b.Ub=a.attributes.gradientTransform?a.getAttribute("gradientTransform"):b.Ub||"";b.jb=b.jb||[];c(b.jb,a.getElementsByTagName("stop"));return b}function f(a,b){if(a.attributes["xlink:href"]){var d=a.getAttribute("xlink:href");"#"===d[0]&&(d=k.b.getElementById(d.slice(1)))&&(b=f(d,b))}b.Cc=a.attributes.cx?parseFloat(a.getAttribute("cx")):b.Cc||0;b.Dc=a.attributes.cy?parseFloat(a.getAttribute("cy")):b.Dc||0;b.r=a.attributes.r?parseFloat(a.getAttribute("r")):b.r||0;b.Fc=a.attributes.gradientUnits?
a.getAttribute("gradientUnits"):b.Fc||"objectBoundingBox";b.Ub=a.attributes.gradientTransform?a.getAttribute("gradientTransform"):b.Ub||"";b.jb=b.jb||[];c(b.jb,a.getElementsByTagName("stop"));return b}var e=/^url\(#(.+)\)$/.exec(b);if(e&&e[1]&&(e=k.b.getElementById(e[1])))switch(e.tagName){case "linearGradient":b=d(e,{});if("objectBoundingBox"===b.Fc)throw"objectBoundingBox not supported";if(b.Ub)throw e=new Fe,De(b.Ub,e),"gradientTransform not supported";var g=a.createLinearGradient(b.nd,b.pd,b.od,
b.qd);for(e=0;e<b.jb.length;e++)g.addColorStop(b.jb[e].offset,b.jb[e].color);return g;case "radialGradient":b=f(e,{});if("objectBoundingBox"===b.Fc)throw"objectBoundingBox not supported";b.Ub&&(e=new Fe,De(b.Ub,e),g=Ge(e,{x:b.Cc,y:b.Dc}),e=b.r/Math.sqrt(Math.abs(e.b[0]*e.b[4])),b.Cc=g.x,b.Dc=g.y,b.r=e);g=a.createRadialGradient(b.Cc,b.Dc,0,b.Cc,b.Dc,b.r);for(e=0;e<b.jb.length;e++)g.addColorStop(b.jb[e].offset,b.jb[e].color);return g}return b}function P(b,c,d,f,e,g){0>=e||0>=g?a.rect(b,c,d,f):(e=Math.min((e+
g)/2,Math.min(d,f)/2),a.moveTo(b+d-e,c),a.arc(b+d-e,c+e,e,1.5*Math.PI,2*Math.PI),a.lineTo(b+d,c+f-e),a.arc(b+d-e,c+f-e,e,0,.5*Math.PI),a.lineTo(b+e,c+f),a.arc(b+e,c+f-e,e,.5*Math.PI,Math.PI),a.lineTo(b,c+e),a.arc(b+e,c+e,e,Math.PI,1.5*Math.PI),a.closePath())}function K(){if(a){var b=(l||"")+";"+(m||""),c={};b&&Be(c,b);"hidden"!==c.visibility&&(c.opacity&&(a.globalAlpha*=parseFloat(c.opacity)),c.fill&&"none"===c.fill||(a.fillStyle="white"===c.fill||"#fff"===c.fill||"#ffffff"===c.fill?"white":L(c.fill)||
"none",a.fill()),c.stroke&&"none"!==c.stroke&&(a.lineWidth=x(c["stroke-width"]||"1px",1,100),a.strokeStyle=c.stroke||"none",a.miterLimit=c["stroke-miterlimit"]||4,a.lineJoin=c["stroke-linejoin"]||"miter",a.lineCap=c["stroke-linecap"]||"butt",c["stroke-dasharray"]&&(a.setLineDash(c["stroke-dasharray"].split(" ").map(function(a){return parseFloat(a)})),a.lineDashOffset=c["stroke-dashoffset"]?parseFloat(c["stroke-dashoffset"]):0),a.stroke()))}}function ta(c,d,e){if(a){var f=(l||"")+";"+(m||""),g={};
f&&Be(g,f);"hidden"!==g.visibility&&(a.font=(g["font-size"]||"12px")+" "+(g["font-family"]||"helvetica"),g.fill&&"none"!==g.fill&&(a.fillStyle="white"===g.fill||"#fff"===g.fill||"#ffffff"===g.fill?"white":b&&b.fill||"silver",a.fillText(c,d,e)),g.stroke&&"none"!==g.stroke&&(a.strokeStyle=b&&b.stroke||"black",a.strokeText(c,d,e)))}}function nb(b,c){b=He({x:b,y:c});a.save();a.strokeStyle="black";a.lineWidth=1;a.strokeRect(b.W,b.X,b.pa-b.W,b.ma-b.X);a.restore()}var B=f.getAttribute("id"),la=B&&b&&b.vd&&
b.vd[B];B=B&&b&&b.$e&&b.$e[B];a&&a.save();n.save();la&&a&&e(f,la);B&&a&&h(f,B);(function(){var a=(b&&b.wg||"")+";"+(f.getAttribute("style")||""),c=f.getAttribute("class");c&&q.hasOwnProperty(c)&&(a=q[c]+";"+a);l=(l||"")+";"+a;(a=f.getAttribute("fill"))&&(l+=";fill:"+a);(a=f.getAttribute("stroke"))&&(l+=";stroke:"+a);(a=f.getAttribute("stroke-width"))&&(l+="stroke-width:"+a);(a=f.getAttribute("stroke-dasharray"))&&(l+=";stroke-dasharray:"+a.split(",").join(" "));(a=f.getAttribute("stroke-dashoffset"))&&
(l+=";stroke-dashoffset:"+a);if(b&&b.style)if((a=f.getAttribute("id"))&&b.style.hasOwnProperty(a))m=(m||"")+";"+b.style[a];else for(var d in b.style)b.style.hasOwnProperty(d)&&"!"===d[0]&&d.slice(1)!==a&&(m=(m||"")+";"+b.style[d])})();la=r.length;switch(f.tagName){case "svg":n.save();g(f.getAttribute("transform"));v();n.restore();break;case "g":n.save();g(f.getAttribute("transform"));v();n.restore();break;case "path":a&&a.save();n.save();g(f.getAttribute("transform"));F(f.getAttribute("d")||"");K();
a&&a.restore();n.restore();break;case "line":B=p("x1");var M=p("y1"),I=p("x2"),Ia=p("y2");a&&a.save();n.save();g(f.getAttribute("transform"));a&&a.beginPath();a&&a.moveTo(B,M);a&&a.lineTo(I,Ia);K();t(B,M);t(I,Ia);b&&b.za&&b.za.line&&b.za.line([B,I],[M,Ia],!1);a&&a.restore();n.restore();break;case "polygon":case "polyline":B=f.getAttribute("points").trim().replace(/\s+/g," ").split(" ").map(function(a){return parseFloat(a)});if(4<=B.length){a&&a.save();n.save();g(f.getAttribute("transform"));a&&a.beginPath();
a&&a.moveTo(B[0],B[1]);t(B[0],B[1]);for(M=2;M+1<B.length;M+=2)a&&a.lineTo(B[M],B[M+1]),t(B[M],B[M+1]);"polygon"===f.tagName&&a.closePath();K();b&&b.za&&b.za.line&&b.za.line(r.slice(-B.length/2),u.slice(-B.length/2),"polygon"===f.tagName);a&&a.restore();n.restore()}break;case "circle":B=p("cx");M=p("cy");I=p("r");a&&a.save();n.save();g(f.getAttribute("transform"));a&&a.beginPath();a&&a.arc(B,M,I,0,2*Math.PI);K();t(B-I,M-I);t(B-I,M+I);t(B+I,M-I);t(B+I,M+I);b&&b.za&&b.za.Ze&&(B=r.slice(-4),M=u.slice(-4),
I=(B[3]-B[0])*(B[3]-B[0])+(M[3]-M[0])*(M[3]-M[0]),Ia=(B[2]-B[1])*(B[2]-B[1])+(M[2]-M[1])*(M[2]-M[1]),.001>Math.abs(I-Ia)/(I+Ia)&&.001>((B[3]-B[0])*(B[2]-B[1])+(M[3]-M[0])*(M[2]-M[1]))/I&&b.za.Ze((B[0]+B[2])/2,(M[0]+M[2])/2,Math.sqrt(I/8)));a&&a.restore();n.restore();break;case "rect":B=p("x");M=p("y");I=p("width");Ia=p("height");var Ca=p("rx"),Ya=p("ry",Ca);Ca=p("rx",Ya);a&&a.save();n.save();g(f.getAttribute("transform"));a&&(a.beginPath(),0<Ca||0<Ya?P(B,M,I,Ia,Ca,Ya):a.rect(B,M,I,Ia));K();t(B,M);
t(B,M+Ia);t(B+I,M);t(B+I,M+Ia);a&&a.restore();n.restore();break;case "text":B=p("x"),M=p("y"),a&&a.save(),n.save(),g(f.getAttribute("transform")),ta(f.textContent,B,M),t(B,M),a&&a.restore(),n.restore()}a&&a.restore();n.restore();a&&b&&b.vg&&nb(r.slice(la),u.slice(la))}function d(b,c,d,e,f,g,h,k,l){if(0===b||0===c)return a&&a.lineTo(k,l),new Ee(k,l);var m=Math.cos(d),n=Math.sin(d),p=(m*g+n*h)/b;h=(-n*g+m*h)/c;g=(m*k+n*l)/b;k=(-n*k+m*l)/c;l=(g-p)/2;m=(k-h)/2;n=l*l+m*m;n=Math.sqrt((1-n)/n);isNaN(n)?
n=0:e===f&&(n=-n);e=(p+g)/2+n*m;l=(h+k)/2-n*l;p=Math.atan2((h-l)/b,(p-e)/c);h=Math.atan2((k-l)/b,(g-e)/c);a&&(a.rotate(d),a.scale(b,c),f?a.arc(e,l,1,p,h,!0):a.arc(e,l,1,p,h),a.scale(1/b,1/c),a.rotate(-d));g=new Fe;g.rotate(d);g.scale(b,c);b=f?p<h?(p+h)/2+Math.PI:(p+h)/2:p<h?(p+h)/2:(p+h)/2+Math.PI;return g.apply(new Ee(e+Math.cos(b),l+Math.sin(b)))}function f(a){switch(a.tagName){case "svg":case "defs":for(var b=0;b<a.childElementCount;b++)f(a.children[b]);break;case "style":m+=a.textContent}}function e(b,
c){if(c.eb&&0!=c.eb){var d=c.Yd,e=c.Zd;if(void 0==d||void 0==e)d=k.H(null,{element:b}),b=He(d),d=(b.W+b.pa)/2,e=(b.X+b.ma)/2;a.translate(d+(c.Lb||0),e+(c.Mb||0));a.rotate(c.eb);a.translate(-d,-e)}else(c.Lb||c.Mb)&&a.translate(c.Lb,c.Mb)}function h(b,c){a.beginPath();a.rect(c.x,c.y,c.Xc,c.Nc);a.clip()}function g(b){Ce(b,function(b,c){a&&a.translate(b,c);n.translate(b,c)},function(b){a&&a.rotate(b);n.rotate(b)},function(b,c){a&&a.scale(b,c);n.scale(b,c)},function(b,c,d,e,f,g){a&&a.transform(b,c,d,e,
f,g);n.Me(b,c,d,e,f,g)})}var k=this,m="",q={},n=new Ie,r=[],u=[];f(this.h);(function(){m.split("}").forEach(function(a){var b=a.split("{");b[0].split(",").forEach(function(a){a=a.trim();/^\.[-a-z0-9]+/i.test(a)&&(a=a.slice(1),q[a]=q[a]?q[a]+";"+b[1]:b[1])})})})();var l=this.h;b&&b.Nd?l=this.b.getElementById(b.Nd):b&&b.element&&(l=b.element);if(l){b&&b.lf&&b.lf(a,this.Ca);if(a){for(var p=[],v=l.parentElement;null!=v;v=v.parentElement)p.push(v);for(v=p.length-1;0<=v;v--){var F=p[v].getAttribute("id");
(F=F&&b&&b.vd&&b.vd[F])&&e(p[v],F);F=p[v].getAttribute("transform");g(F)}}c(l)}return{x:r,y:u}};function He(a){if(0===a.x.length)return{W:0,pa:0,X:0,ma:0};for(var b=a.x[0],c=a.x[0],d=a.y[0],f=a.y[0],e=1;e<a.x.length;e++)b=Math.min(b,a.x[e]),c=Math.max(c,a.x[e]),d=Math.min(d,a.y[e]),f=Math.max(f,a.y[e]);return{W:b,pa:c,X:d,ma:f}}function Je(a,b){if(a.u[b])return a.u[b];var c=a.H(null,{Nd:b});c=He(c);return a.u[b]=c}xe.prototype.xd=function(a,b,c){a=Je(this,a);return b>=a.W&&b<=a.pa&&c>=a.X&&c<=a.ma};
xe.prototype.vc=function(a){return null!=this.b.getElementById(a)};xe.prototype.Mf=function(a,b){a=this.b.getElementById(a);b=this.b.getElementById(b);return null!=b&&null!=a&&b.contains(a)};function Ke(a){xe.call(this,a);this.m={};this.K={};this.o={};Le(this)}Ke.prototype=Object.create(xe.prototype);Ke.prototype.constructor=Ke;
function Le(a){function b(a){switch(a.tagName){case "svg":case "defs":for(var c=0;c<a.childElementCount;c++)b(a.children[c]);break;case "style":e+=a.textContent}}function c(a){return a?(a=a.replace(/\s*\(\s*/g,"(").replace(/\s*\)\s*/g,")").replace(/ +,/g,",").replace(/, +/g,",").replace(/ +/g,","),a.split(")").slice(0,-1).map(function(a){var b=a.split("(")[0];a=a.split("(")[1].split(",").map(function(a){return parseFloat(a)});switch(b){case "translate":return{cb:b,B:[a[0]||0,a[1]||0]};case "rotate":return{cb:b,
B:[(a[0]||0)*Math.PI/180,a[1]||0,a[2]||0]};case "scale":var c=a[0]||1;return{cb:b,B:[c,a[1]||c]};case "matrix":return{cb:b,B:a};default:throw"transform not implemented: "+b;}})):null}function d(a,b){function e(b){for(var c=[],e=0;e<a.childElementCount;e++){var f=d(a.children[e],b);f&&c.push(f)}return c}function g(b,c){b=a.getAttribute(b);return null===b?c||0:parseFloat(b)}function h(a){a=a.replace(/\.([0-9]+)(?=\.)/g,".$1 ").replace(/([.0-9])-/g,"$1 -").replace(/\s*([a-z])\s*/gi,";$1").replace(/\s*,\s*/g,
",").replace(/\s+/g,",");var b=[],c=0,d=0,e=0,f=0,g=0,h=0;a.slice(1).split(";").forEach(function(a){var k=a[0];a=1<a.length?a.slice(1).split(",").map(function(a){return parseFloat(a)}):[];switch(k){case "M":if(2<=a.length){c=a[0];d=a[1];g=c;h=d;b.push({cb:"M",B:[c,d]});for(k=2;k+1<a.length;k+=2)c=a[k],d=a[k+1],b.push({cb:"L",B:[c,d]});e=c;f=d}break;case "m":if(2<=a.length)for(c+=a[0],d+=a[1],g=c,h=d,b.push({cb:"M",B:[c,d]}),k=2;k+1<a.length;k+=2)c+=a[k],d+=a[k+1],b.push({cb:"L",B:[c,d]});e=c;f=d;
break;case "L":for(k=0;k+1<a.length;k+=2)c=a[k],d=a[k+1],b.push({cb:"L",B:[c,d]});e=c;f=d;break;case "l":for(k=0;k+1<a.length;k+=2)c+=a[k],d+=a[k+1],b.push({cb:"L",B:[c,d]});e=c;f=d;break;case "H":for(k=0;k<a.length;k++)c=a[k],b.push({cb:"L",B:[c,d]});e=c;f=d;break;case "h":for(k=0;k<a.length;k++)c+=a[k],b.push({cb:"L",B:[c,d]});e=c;f=d;break;case "V":for(k=0;k<a.length;k++)d=a[k],b.push({cb:"L",B:[c,d]});e=c;f=d;break;case "v":for(k=0;k<a.length;k++)d+=a[k],b.push({cb:"L",B:[c,d]});e=c;f=d;break;
case "A":for(k=0;k+6<a.length;k+=7){var l=a[k+5],m=a[k+6];b.push({cb:"A",B:[a[k],a[k+1],a[k+2]*Math.PI/180,0!=a[k+3]?1:0,0==a[k+4]?1:0,c,d,l,m]});c=l;d=m}e=c;f=d;break;case "a":for(k=0;k+6<a.length;k+=7)l=c+a[k+5],m=d+a[k+6],b.push({cb:"A",B:[a[k],a[k+1],a[k+2]*Math.PI/180,0!=a[k+3],0==a[k+4],c,d,l,m]}),c=l,d=m;e=c;f=d;break;case "C":for(k=0;k+5<a.length;k+=6)b.push({cb:"C",B:a.slice(k,k+6)}),c=a[k+4],d=a[k+5],e=2*c-a[k+2],f=2*d-a[k+3];break;case "c":for(k=0;k+5<a.length;k+=6)b.push({cb:"C",B:[c+
a[k],d+a[k+1],c+a[k+2],d+a[k+3],c+a[k+4],d+a[k+5]]}),e=c+2*a[k+4]-a[k+2],f=d+2*a[k+5]-a[k+3],c+=a[k+4],d+=a[k+5];break;case "S":for(k=0;k+3<a.length;k+=4)b.push({cb:"S",B:[e,f,a[k],a[k+1],a[k+2],a[k+3]]}),c=a[k+2],d=a[k+3],e=2*c-a[k],f=2*d-a[k+1];break;case "s":for(k=0;k+3<a.length;k+=4)b.push({cb:"S",B:[e,f,c+a[k],d+a[k+1],c+a[k+2],d+a[k+3]]}),e=c-a[k],f=d-a[k+1],c+=a[k+2],d+=a[k+3];break;case "Q":for(k=0;k+3<a.length;k+=4)b.push({cb:"Q",B:[a[k],a[k+1],a[k+2],a[k+3]]}),c=a[k+2],d=a[k+3],e=2*c-a[k],
f=2*d-a[k+1];break;case "q":for(k=0;k+3<a.length;k+=4)b.push({cb:"Q",B:[c+a[k],d+a[k+1],c+a[k+2],d+a[k+3]]}),e=c+2*a[k+2]-a[k],f=d+2*a[k+3]-a[k+1],c+=a[k+2],d+=a[k+3];break;case "T":for(k=0;k+1<a.length;k+=2)b.push({cb:"Q",B:[e,f,a[k],a[k+1]]}),c=a[k],d=a[k+1],e=2*c-e,f=2*d-f;break;case "t":for(k=0;k+1<a.length;k+=2)b.push({cb:"Q",B:[e,f,c+a[k],d+a[k+1]]}),c+=a[k],d+=a[k+1],e=2*c-e,f=2*d-f;break;case "Z":case "z":c=g;d=h;b.push({cb:"Z",B:[]});break;default:throw"unimplemented path command: "+k;}});
return b}var n=a.getAttribute("id"),r=function(){var b=a.getAttribute("style")||"",c=a.getAttribute("class");c&&f.o.hasOwnProperty(c)&&(b=f.o[c]+";"+b);c={};Be(c,b);(b=a.getAttribute("fill"))&&(c.fill=b);(b=a.getAttribute("stroke"))&&(c.stroke=b);(b=a.getAttribute("stroke-width"))&&(c["stroke-width"]=b);(b=a.getAttribute("stroke-dasharray"))&&(c["stroke-dasharray"]=b.split(","));(b=a.getAttribute("stroke-dashoffset"))&&(c["stroke-dashoffset"]=b);(b=a.getAttribute("id"))&&(c.id=b);return c}();b={name:a.tagName,
id:n,style:r,parent:b};switch(a.tagName){case "svg":b.children=e(b);break;case "g":b.children=e(b);b.transform=c(a.getAttribute("transform"));break;case "path":b.path=h(a.getAttribute("d")||"");b.transform=c(a.getAttribute("transform"));break;case "line":b.nd=g("x1");b.pd=g("y1");b.od=g("x2");b.qd=g("y2");b.transform=c(a.getAttribute("transform"));break;case "polygon":case "polyline":b.wc=a.getAttribute("points").trim().replace(/\s+/g," ").split(" ").map(function(a){return parseFloat(a)});b.transform=
c(a.getAttribute("transform"));break;case "circle":b.x=g("cx");b.y=g("cy");b.r=g("r");b.transform=c(a.getAttribute("transform"));break;case "rect":b.x=g("x");b.y=g("y");b.width=g("width");b.height=g("height");n=g("rx");r=g("ry",n);n=g("rx",r);b.Qg=n;b.Rg=r;b.transform=c(a.getAttribute("transform"));break;case "text":b.x=g("x");b.y=g("y");b.text=a.textContent;b.transform=c(a.getAttribute("transform"));break;default:return null}return b}var f=a,e="";b(a.h);a.o=function(){var a={};e.split("}").forEach(function(b){var c=
b.split("{");c[0].split(",").forEach(function(b){b=b.trim();/^\.[-a-z0-9]+/i.test(b)&&(b=b.slice(1),a[b]=a[b]?a[b]+";"+c[1]:c[1])})});return a}();a.h&&(a.m=d(a.h,null))}function Me(a,b){function c(a,b){if(a.id===b)return a;if(a.children)for(var d=0;d<a.children.length;d++){var e=c(a.children[d],b);if(e)return e}return null}if(a.K[b])return a.K[b];var d=c(a.m,b);d&&(a.K[b]=d);return d}
function Ne(a,b,c,d,f){a&&a.forEach(function(a){switch(a.cb){case "translate":b(a.B[0],a.B[1]);break;case "rotate":0!==a.B[1]||0!==a.B[2]?(b(-a.B[1],-a.B[2]),c(a.B[0]),b(a.B[1],a.B[2])):c(a.B[0]);break;case "scale":d(a.B[0],a.B[1]);break;case "matrix":f(a.B[0],a.B[1],a.B[2],a.B[3],a.B[4],a.B[5])}})}
Ke.prototype.H=function(a,b){function c(l,n,q){function p(){for(var a=0;a<l.children.length;a++)c(l.children[a],n,q)}function r(a,b){a=g.apply(new Ee(a,b));k.push(a.x);m.push(a.y)}function u(a,b,c){if(null==a||""==a)return b;a=/^\s*(-?[0-9.]+)\s*([a-z%]*)\s*$/i.exec(a);b=parseFloat(a[1]);switch(a[2]||"px"){case "pt":return 25.4*b/72*3;case "pc":return 25.4*b/6*3;case "in":return 25.4*b*3;case "mm":return 3*b;case "cm":return 30*b;case "em":return 18*b;case "ex":return 9*b;case "%":return b*c/100;
default:return b}}function v(c){var d=0,e=0,f=[],g=[],h=!0;a&&a.beginPath();c.forEach(function(c){switch(c.cb){case "M":2<=c.B.length&&(d=c.B[0],e=c.B[1],a&&a.moveTo(d,e),r(d,e),h&&1<f.length&&b&&b.za&&b.za.line&&b.za.line(f,g,!1),h=!0,f=k.slice(-1),g=m.slice(-1));break;case "L":d=c.B[0];e=c.B[1];a&&a.lineTo(d,e);r(d,e);f.push(k[k.length-1]);g.push(m[m.length-1]);break;case "A":var l=c.B[5],n=c.B[6];var p=c.B[0];var q=c.B[1],Ca=c.B[2],u=0!=c.B[3],v=0!=c.B[4],t=c.B[5],B=c.B[6],F=c.B[7],L=c.B[8];if(0===
p||0===q)a&&a.lineTo(F,L),p=new Ee(F,L);else{var Ya=Math.cos(Ca),x=Math.sin(Ca);c=(Ya*t+x*B)/p;B=(-x*t+Ya*B)/q;t=(Ya*F+x*L)/p;F=(-x*F+Ya*L)/q;L=(t-c)/2;Ya=(F-B)/2;x=L*L+Ya*Ya;x=Math.sqrt((1-x)/x);isNaN(x)?x=0:u===v&&(x=-x);u=(c+t)/2+x*Ya;L=(B+F)/2-x*L;c=Math.atan2((B-L)/p,(c-u)/q);B=Math.atan2((F-L)/p,(t-u)/q);a&&(a.rotate(Ca),a.scale(p,q),v?a.arc(u,L,1,c,B,!0):a.arc(u,L,1,c,B),a.scale(1/p,1/q),a.rotate(-Ca));t=new Fe;t.rotate(Ca);t.scale(p,q);p=v?c<B?(c+B)/2+Math.PI:(c+B)/2:c<B?(c+B)/2:(c+B)/2+Math.PI;
p=t.apply(new Ee(u+Math.cos(p),L+Math.sin(p)))}d=l;e=n;r(p.x,p.y);r(d,e);h=!1;break;case "C":a&&a.bezierCurveTo(c.B[0],c.B[1],c.B[2],c.B[3],c.B[4],c.B[5]);d=c.B[4];e=c.B[5];r(d,e);h=!1;break;case "S":a&&a.bezierCurveTo(c.B[0],c.B[1],c.B[2],c.B[3],c.B[4],c.B[5]);d=c.B[4];e=c.B[5];r(d,e);h=!1;break;case "Q":a&&a.quadraticCurveTo(c.B[0],c.B[1],c.B[2],c.B[3]);d=c.B[2];e=c.B[3];r(d,e);h=!1;break;case "Z":a&&a.closePath(),h&&1<f.length&&b&&b.za&&b.za.line&&b.za.line(f,g,!0),h=!0,f=[],g=[]}});h&&1<f.length&&
b&&b.za&&b.za.line&&b.za.line(f,g,!1)}function Y(b){function c(a,b){if(0<b.length){a.splice(0,a.length);for(var c=0;c<b.length&&1>c;c++){var d=(b[c].getAttribute("offset")||"0").trim(),f=/%$/.test(d)?parseFloat(d.slice(0,-1))/100:parseFloat(d),e=b[c].getAttribute("style");d={};e&&Be(d,e);isNaN(f)||(e=b[c].getAttribute("stop-color")||d["stop-color"]||"#000",ye.hasOwnProperty(e)&&(e=ye[e]),d=(b[c].getAttribute("stop-opacity")||d["stop-opacity"]||"1").trim(),d=/%$/.test(d)?parseFloat(d.slice(0,-1))/
100:parseFloat(d),1!==d&&(/^#[0-9a-f]{3}$/i.test(e)?e="rgba("+e.slice(1).split("").map(function(a){return 17*parseInt(a,16)}).map(function(a){return a.toString(10)}).join(",")+","+d.toFixed(2)+")":/^#[0-9a-f]{6}$/i.test(e)?e="rgba("+[e.slice(1,3),e.slice(3,5),e.slice(5)].map(function(a){return parseInt(a,16)}).map(function(a){return a.toString(10)}).join(",")+","+d.toFixed(2)+")":/^rgb(\d+%?(,|\s+)\d+%?(,|\s+)\d+%?)$/i.test(e)?e=e.slice(0,-1).replace(/\s+/g,",")+","+d.toFixed(2)+")":/^hsl(\d+%?(,|\s+)\d+%?(,|\s+)\d+%?)$/i.test(e)&&
(e=e.slice(0,-1).replace(/\s+/g,",")+","+d.toFixed(2)+")")),a.push({offset:f,color:e}))}}}function d(a,b){if(a.attributes["xlink:href"]){var e=a.getAttribute("xlink:href");"#"===e[0]&&(e=h.b.getElementById(e.slice(1)))&&(b=d(e,b))}b.nd=a.attributes.x1?parseFloat(a.getAttribute("x1")):b.nd||0;b.pd=a.attributes.y1?parseFloat(a.getAttribute("y1")):b.pd||0;b.od=a.attributes.x2?parseFloat(a.getAttribute("x2")):b.od||0;b.qd=a.attributes.y2?parseFloat(a.getAttribute("y2")):b.qd||0;b.Fc=a.attributes.gradientUnits?
a.getAttribute("gradientUnits"):b.Fc||"objectBoundingBox";b.Ub=a.attributes.gradientTransform?a.getAttribute("gradientTransform"):b.Ub||"";b.jb=b.jb||[];c(b.jb,a.getElementsByTagName("stop"));return b}function e(a,b){if(a.attributes["xlink:href"]){var d=a.getAttribute("xlink:href");"#"===d[0]&&(d=h.b.getElementById(d.slice(1)))&&(b=e(d,b))}b.Cc=a.attributes.cx?parseFloat(a.getAttribute("cx")):b.Cc||0;b.Dc=a.attributes.cy?parseFloat(a.getAttribute("cy")):b.Dc||0;b.r=a.attributes.r?parseFloat(a.getAttribute("r")):
b.r||0;b.Fc=a.attributes.gradientUnits?a.getAttribute("gradientUnits"):b.Fc||"objectBoundingBox";b.Ub=a.attributes.gradientTransform?a.getAttribute("gradientTransform"):b.Ub||"";b.jb=b.jb||[];c(b.jb,a.getElementsByTagName("stop"));return b}var f=/^url\(#(.+)\)$/.exec(b);if(f&&f[1]&&(f=h.b.getElementById(f[1])))switch(f.tagName){case "linearGradient":b=d(f,{});if("objectBoundingBox"===b.Fc)throw"objectBoundingBox not supported";if(b.Ub)throw f=new Fe,De(b.Ub,f),"gradientTransform not supported";var g=
a.createLinearGradient(b.nd,b.pd,b.od,b.qd);for(f=0;f<b.jb.length;f++)g.addColorStop(b.jb[f].offset,b.jb[f].color);return g;case "radialGradient":b=e(f,{});if("objectBoundingBox"===b.Fc)throw"objectBoundingBox not supported";b.Ub&&(f=new Fe,De(b.Ub,f),g=Ge(f,{x:b.Cc,y:b.Dc}),f=b.r/Math.sqrt(Math.abs(f.b[0]*f.b[4])),b.Cc=g.x,b.Dc=g.y,b.r=f);g=a.createRadialGradient(b.Cc,b.Dc,0,b.Cc,b.Dc,b.r);for(f=0;f<b.jb.length;f++)g.addColorStop(b.jb[f].offset,b.jb[f].color);return g}return b}function O(b,c,d,e,
f,g){0>=f||0>=g?a.rect(b,c,d,e):(f=Math.min((f+g)/2,Math.min(d,e)/2),a.moveTo(b+d-f,c),a.arc(b+d-f,c+f,f,1.5*Math.PI,2*Math.PI),a.lineTo(b+d,c+e-f),a.arc(b+d-f,c+e-f,f,0,.5*Math.PI),a.lineTo(b+f,c+e),a.arc(b+f,c+e-f,f,.5*Math.PI,Math.PI),a.lineTo(b,c+f),a.arc(b+f,c+f,f,Math.PI,1.5*Math.PI),a.closePath())}function va(){if(a){var b={};n&&ze(b,n);q&&ze(b,q);"hidden"!==b.visibility&&(b.opacity&&(a.globalAlpha*=parseFloat(b.opacity)),b.fill&&"none"===b.fill||(a.fillStyle="white"===b.fill||"#fff"===b.fill||
"#ffffff"===b.fill?"white":Y(b.fill)||"none",a.fill()),b.stroke&&"none"!==b.stroke&&(a.lineWidth=u(b["stroke-width"]||"1px",1,100),a.strokeStyle=b.stroke||"none",a.miterLimit=b["stroke-miterlimit"]||4,a.lineJoin=b["stroke-linejoin"]||"miter",a.lineCap=b["stroke-linecap"]||"butt",b["stroke-dasharray"]&&(a.setLineDash(b["stroke-dasharray"].split(" ").map(function(a){return parseFloat(a)})),a.lineDashOffset=b["stroke-dashoffset"]?parseFloat(b["stroke-dashoffset"]):0),a.stroke()))}}function La(c,d,f){if(a){var e=
{};n&&ze(e,n);q&&ze(e,q);"hidden"!==e.visibility&&(a.font=(e["font-size"]||"12px")+" "+(e["font-family"]||"helvetica"),e.fill&&"none"!==e.fill&&(a.fillStyle="white"===e.fill||"#fff"===e.fill||"#ffffff"===e.fill?"white":b&&b.fill||"silver",a.fillText(c,d,f)),e.stroke&&"none"!==e.stroke&&(a.strokeStyle=b&&b.stroke||"black",a.strokeText(c,d,f)))}}function sa(b,c){b=He({x:b,y:c});a.save();a.strokeStyle="black";a.lineWidth=1;a.strokeRect(b.W,b.X,b.pa-b.W,b.ma-b.X);a.restore()}var L=l.id&&b&&b.vd&&b.vd[l.id],
P=l.id&&b&&b.$e&&b.$e[l.id];a&&a.save();g.save();L&&a&&d(l,L);P&&a&&f(P);n=Ae(n);q=Ae(q);(function(){l.style&&ze(n,l.style);b&&b.wg&&Be(n,b.wg);l.id&&b&&b.style&&b.style.hasOwnProperty(l.id)&&Be(q,b.style[l.id]);for(var a in b.style)b.style.hasOwnProperty(a)&&"!"===a[0]&&a.slice(1)!==l.id&&Be(q,b.style[a])})();L=k.length;switch(l.name){case "svg":g.save();e(l.transform);p();g.restore();break;case "g":g.save();e(l.transform);p();g.restore();break;case "path":a&&a.save();g.save();e(l.transform);v(l.path);
va();a&&a.restore();g.restore();break;case "line":a&&a.save();g.save();e(l.transform);a&&a.beginPath();a&&a.moveTo(l.nd,l.pd);a&&a.lineTo(l.od,l.qd);va();r(l.nd,l.pd);r(l.od,l.qd);b&&b.za&&b.za.line&&b.za.line([l.nd,l.od],[l.pd,l.qd],!1);a&&a.restore();g.restore();break;case "polygon":case "polyline":if(4<=l.wc.length){a&&a.save();g.save();e(l.transform);a&&a.beginPath();a&&a.moveTo(l.wc[0],l.wc[1]);r(l.wc[0],l.wc[1]);for(P=2;P+1<l.wc.length;P+=2)a&&a.lineTo(l.wc[P],l.wc[P+1]),r(l.wc[P],l.wc[P+1]);
"polygon"===l.name&&a&&a.closePath();va();b&&b.za&&b.za.line&&b.za.line(k.slice(-l.wc.length/2),m.slice(-l.wc.length/2),"polygon"===l.name);a&&a.restore();g.restore()}break;case "circle":a&&a.save();g.save();e(l.transform);a&&a.beginPath();a&&a.arc(l.x,l.y,l.r,0,2*Math.PI);va();r(l.x-l.r,l.y-l.r);r(l.x-l.r,l.y+l.r);r(l.x+l.r,l.y-l.r);r(l.x+l.r,l.y+l.r);if(b&&b.za&&b.za.Ze){P=k.slice(-4);var ba=m.slice(-4),ta=(P[3]-P[0])*(P[3]-P[0])+(ba[3]-ba[0])*(ba[3]-ba[0]),nb=(P[2]-P[1])*(P[2]-P[1])+(ba[2]-ba[1])*
(ba[2]-ba[1]);.001>Math.abs(ta-nb)/(ta+nb)&&.001>((P[3]-P[0])*(P[2]-P[1])+(ba[3]-ba[0])*(ba[2]-ba[1]))/ta&&b.za.Ze((P[0]+P[2])/2,(ba[0]+ba[2])/2,Math.sqrt(ta/8))}a&&a.restore();g.restore();break;case "rect":a&&a.save();g.save();e(l.transform);a&&(a.beginPath(),0<l.Qg||0<l.Rg?O(l.x,l.y,l.width,l.height,l.Qg,l.Rg):a.rect(l.x,l.y,l.width,l.height));va();r(l.x,l.y);r(l.x,l.y+l.height);r(l.x+l.width,l.y);r(l.x+l.width,l.y+l.height);a&&a.restore();g.restore();break;case "text":a&&a.save(),g.save(),e(l.transform),
La(l.text,l.x,l.y),r(l.x,l.y),a&&a.restore(),g.restore()}a&&a.restore();g.restore();a&&b&&b.vg&&sa(k.slice(L),m.slice(L))}function d(b,c){if(c.eb&&0!=c.eb){var d=c.Yd,e=c.Zd;if(void 0==d||void 0==e)d=h.H(null,{Hc:b}),b=He(d),d=(b.W+b.pa)/2,e=(b.X+b.ma)/2;a.translate(d+(c.Lb||0),e+(c.Mb||0));a.rotate(c.eb);a.translate(-d,-e)}else(c.Lb||c.Mb)&&a.translate(c.Lb,c.Mb)}function f(b){a.beginPath();a.rect(b.x,b.y,b.Xc,b.Nc);a.clip()}function e(b){Ne(b,function(b,c){a&&a.translate(b,c);g.translate(b,c)},
function(b){a&&a.rotate(b);g.rotate(b)},function(b,c){a&&a.scale(b,c);g.scale(b,c)},function(b,c,d,e,f,h){a&&a.transform(b,c,d,e,f,h);g.Me(b,c,d,e,f,h)})}var h=this,g=new Ie,k=[],m=[],q=this.m;b&&b.Nd?q=Me(this,b.Nd):b&&b.Hc&&(q=b.Hc);if(q){b&&b.lf&&b.lf(a,this.Ca);if(a){for(var n=[],r=q.parentElement;null!=r;r=r.parentElement)n.push(r);for(r=n.length-1;0<=r;r--){var u=n[r].id;(u=u&&b&&b.vd&&b.vd[u])&&d(n[r],u);e(n[r].transform)}}c(q,{},{})}return{x:k,y:m}};
function Oe(a,b){if(a.id===b)return a;if(a.children)for(var c=0;c<a.children.length;c++){var d=Oe(a.children[c],b);if(d)return d}return null}Ke.prototype.vc=function(a){return null!=Oe(this.m,a)};Ke.prototype.Mf=function(a,b){var c=Oe(this.m,b);if(null==c)throw"Undefined SVG element id "+b;return null!=Oe(c,a)};function Fe(a){this.b=a||[1,0,0,0,1,0]}w=Fe.prototype;w.lb=function(){return new Fe(this.b)};w.apply=function(a){return new Ee(this.b[0]*a.x+this.b[1]*a.y+this.b[2],this.b[3]*a.x+this.b[4]*a.y+this.b[5])};function Ge(a,b){var c=a.b[0]*a.b[4]-a.b[3]*a.b[1];return new Ee((a.b[4]*b.x-a.b[1]*b.y+a.b[1]*a.b[5]-a.b[4]*a.b[2])/c,(-a.b[3]*b.x+a.b[0]*b.y+a.b[3]*a.b[2]-a.b[0]*a.b[5])/c)}
w.translate=function(a,b){this.b=[this.b[0],this.b[1],this.b[0]*a+this.b[1]*b+this.b[2],this.b[3],this.b[4],this.b[3]*a+this.b[4]*b+this.b[5]]};w.scale=function(a,b){this.b=[this.b[0]*a,this.b[1]*b,this.b[2],this.b[3]*a,this.b[4]*b,this.b[5]]};w.rotate=function(a){var b=Math.cos(a);a=Math.sin(a);this.b=[b*this.b[0]+a*this.b[1],-a*this.b[0]+b*this.b[1],this.b[2],b*this.b[3]+a*this.b[4],-a*this.b[3]+b*this.b[4],this.b[5]]};
w.Me=function(a,b,c,d,f,e){this.b=[a*this.b[0]+c*this.b[1],b*this.b[0]+d*this.b[1],a*this.b[2]+c*this.b[3],b*this.b[2]+d*this.b[3],a*this.b[4]+c*this.b[5]+f,b*this.b[4]+d*this.b[5]+e]};function Ee(a,b){this.x=a||0;this.y=b||0}function Ie(){this.stack=[new Fe]}w=Ie.prototype;w.apply=function(a){return this.stack[this.stack.length-1].apply(a)};w.save=function(){this.stack.push(this.stack[this.stack.length-1].lb())};w.restore=function(){if(2>this.stack.length)throw"restore doesn't match save";this.stack.pop()};
w.translate=function(a,b){this.stack[this.stack.length-1].translate(a,b)};w.scale=function(a,b){this.stack[this.stack.length-1].scale(a,b)};w.rotate=function(a){this.stack[this.stack.length-1].rotate(a)};w.Me=function(a,b,c,d,f,e){this.stack[this.stack.length-1].Me(a,b,c,d,f,e)};function Pe(a){for(var b=0;b<a.draw.length;b++)if(a.draw[b].uri)return a.draw[b].uri;throw"URI not found";}function pc(a){a=a.split("#");return{Mc:a[0],id:a[1]}}function Qe(a,b,c){a.I.save();c.lf=function(a,b){this.clientData.ce=b;a.translate(-b[0],-b[1]);a.scale(this.w.j/(b[2]-b[0]),this.w.j/(b[3]-b[1]))}.bind(a);b.H(a.I,c);a.I.restore()}
function Re(a,b,c,d,f){return{x:(a.clientData.ce[2]-a.clientData.ce[0])/d*(b+a.clientData.ce[0]),y:(a.clientData.ce[3]-a.clientData.ce[1])/f*(c+a.clientData.ce[1])}}
function Se(a,b,c){var d={},f=(a.buttons?a.buttons.length:0)+(a.radiobuttons?1:0);if(void 0!=a.sliders){for(var e=0;e<a.sliders.length;e++){var h=a.sliders[e],g=Je(b,h.id),k=Je(b,h.thumbId),m=(k.W+k.pa)/2,q=(k.X+k.ma)/2;g.pa-g.W<g.ma-g.X?(g.W=g.pa=(g.W+g.pa)/2,m=g.W):(g.X=g.ma=(g.X+g.ma)/2,q=g.X);k=(c[f+e]-h.min)/(h.max-h.min);d[h.thumbId]={Lb:k*(g.pa-g.W)-(m-g.W),Mb:k*(g.X-g.ma)-(q-g.ma)}}f+=a.sliders.length}if(void 0!=a.rotating)for(e=0;e<a.rotating.length;e++)h=a.rotating[e],k=h.numSteps?2*Math.PI/
h.numSteps:1,g=Je(b,h.centerId),d[h.id]={eb:c[f+e]*k,Yd:(g.W+g.pa)/2,Zd:(g.X+g.ma)/2};return d}function Te(a,b,c){return Math.min(Math.max((c-a)/(b-a),0),1)}
function Ue(a,b,c,d,f,e,h,g,k){f=Re(a,k.x-h,k.y-g,f,e);var m=a.clientData.gd.min+(a.clientData.gd.max-a.clientData.gd.min)*Te(a.clientData.min,a.clientData.max,a.clientData.we?f.y:f.x),q=a.clientData.gd.min,n=a.clientData.gd.max;(f=a.clientData.gd.discrete)&&0<f.length?m=f.reduce(function(a,b){return Math.abs(m-b)<Math.abs(m-a)?b:a},f[0]):(a=a.clientData.gd.snap)&&a.forEach(function(a,c){"string"===typeof a&&/^`.+`$/.test(a)&&(a=oa(a,b.g,c,!0));Math.abs(m-a)<Math.abs(n-q)/10&&(m=a)});b.g[(d.buttons?
d.buttons.length:0)+(d.radiobuttons?1:0)+c]=Math.max(Math.min(q,n),Math.min(Math.max(q,n),m))}
function Ve(a,b,c,d){if(0!==c.draw.length){var f=pc(Pe(c)).Mc,e=f?Se(c,b.vb[f],d.g):{},h=null;if(c.diffwheelmotion&&c.diffwheelmotion.id){h=c.diffwheelmotion;var g=h.id,k=h.dx||0,m=h.dy||0,q=h.adjscale||1,n=h.color||"black",r=void 0===h.linewidth?1:h.linewidth;h=Je(b.vb[f],g);var u=(c.buttons?c.buttons.length:0)+(c.radiobuttons?1:0),l=2.4*d.g[u];u=2.4*d.g[u+1];var p=a.w.j;h=(.5+k)*(h.pa-h.W)*q/p;k=Zd(a,l,u,h,{color:n,Ke:r});e[g]={Lb:-(k.x*h*p+m*p*Math.sin(k.eb)),Mb:-(k.y*h*p+m*p*Math.cos(k.eb)),eb:-k.eb};
h={jh:l,kh:u,ph:h,color:n,Ke:r}}c.draw.forEach(function(a){if(a.uri){var g=pc(a.uri),h=b.vb[g.Mc];g=g.id;for(var k={},l=c.buttons?c.buttons.length:0,m=c.radiobuttons?c.radiobuttons.length:0,n=c.styles?c.styles.length:0,p=0;p<l;p++){var q=c.buttons[p].val,r=c.buttons[p].st;q=q.indexOf(d.g[p]);0<=q&&(k[c.buttons[p].id]=r[q])}for(p=0;p<m;p++)q=c.radiobuttons[p].val,r=c.radiobuttons[p].st,k[c.radiobuttons[p].id]=r[d.g[l]===q?1:0];for(p=0;p<n;p++)k[(c.styles[p].complement?"!":"")+c.styles[p].id]=oa(c.styles[p].st,
d.g);l=b.vb[f];m=d.g;n={};if(void 0!=c.sliders)for(p=0;p<c.sliders.length;p++){r=c.sliders[p];q=Je(l,r.id);var u=r.lowerPartId&&Je(l,r.lowerPartId);if(u){var v=(m[p]-r.min)/(r.max-r.min),ba=u.pa-u.W,ta=u.ma-u.X;n[r.lowerPartId]=q.pa-q.W<q.ma-q.X?{x:u.W-ta,y:u.X,Xc:ba+2*ta,Nc:ta*v}:{x:u.W,y:u.X-ta,Xc:ba*v,Nc:ta+2*ba}}}Qe(this,h,{Nd:g,style:k,vd:e,$e:n,vg:!1})}a.js&&(a=new Function("ctx","$",a.js),this.I.save(),this.I.scale(this.w.j/1E3,this.w.j/1E3),this.I.beginPath(),a(this.I,d.g),this.I.restore())},
a);h&&Zd(a,h.jh,h.kh,h.ph,{color:h.color,Ke:h.Ke});c.score&&c.score.id&&(g=(c.buttons?c.buttons.length:0)+(c.radiobuttons?1:0)+(c.sliders?c.sliders.length:0),m=c.score,n=m.numHeights||5,h=Je(b.vb[f],m.id),r=b.vb[f].Ca,ce(a,d.g.slice(g),(h.W-r[0])/(r[2]-r[0]),(h.pa-r[0])/(r[2]-r[0]),(h.ma-r[1])/(r[3]-r[1]),(h.X-r[1])/(r[3]-r[1]),n,(h.ma-h.X)/(r[3]-r[1])/n*(m.noteSize||1),void 0===m.linewidth?1:m.linewidth))}}
function We(a,b,c){function d(a){for(var b=0;b<c.length;b++)if(c[b].name===a)return b;return-1}b.forEach(function(b){var e=b.name;if(!e)throw"Missing block name";var f=d(e),g=0<=f?c[f]:null,k=g?g.type:"?";if(b.type||!g)switch(b.type){case "event":k="e";break;case "action":k="a";break;case "state":k="s";break;case "comment":k="c";break;case "hidden":k="h";break;default:throw"Unknown block type "+b.type+" for block "+e;}var m=g?g.la:[];b.modes&&!g&&b.modes.forEach(function(a){switch(a){case "basic":m.push("b");
break;case "advanced":m.push("a");break;default:throw"Unknown block mode "+a;}});var q=g?g.Ac:null,n=b.validation;n&&(q=function(a){for(var b=0;b<n.length;b++){var c=n[b].assert;if("string"===typeof c&&/^`.+`$/.test(c)?!oa(c,a.g,void 0,!0):!c)return(a=n[b].warning)?new Da(a,!0):new Da(n[b].error||"Error")}});var r=g?g.H:function(c,d){Ve(c,a,b,d)},u=g?g.$:function(c,d,e,f,g,h,k){a:{var l=pc(Pe(b)).Mc,m=0,n=b.buttons;if(n){var p;b:{var q=a.vb[l],r=Re(c,k.x-g,k.y-h,e,f);for(p=0;p<n.length;p++)if(q.xd(n[p].id,
r.x,r.y)){q=n[p].val.indexOf(d.g[p]);0<=q&&(A(d),d.g[p]=n[p].val[(q+1)%n[p].val.length]);break b}p=null}if(null!==p){d=m+p;break a}m+=n.length}if(p=b.radiobuttons){b:{q=a.vb[l];n=n||0;r=Re(c,k.x-g,k.y-h,e,f);for(var u=0;u<p.length;u++)if(q.xd(p[u].id,r.x,r.y)){A(d);d.g[n]=p[u].val;p=0;break b}p=null}if(null!==p){d=m+p;break a}m++}if(p=n=b.pushbuttons){b:{p=a.vb[l];q=Re(c,k.x-g,k.y-h,e,f);for(r=0;r<n.length;r++)if(p.xd(n[r].id,q.x,q.y)){A(d);n=n[r].newParameters;"string"===typeof n&&/^`.+`$/.test(n)&&
(n=oa(n,d.g,void 0,!0));d.g=n;n=!0;break b}n=null}p=null!==n}if(p)d=-1;else{if(n=b.sliders){b:{p=a.vb[l];q=Re(c,k.x-g,k.y-h,e,f);for(r=0;r<n.length;r++){c.clientData.gd=n[r];var t=Je(p,c.clientData.gd.id);c.clientData.we=t.pa-t.W<t.ma-t.X;c.clientData.min=c.clientData.we?t.ma:t.W;c.clientData.max=c.clientData.we?t.X:t.pa;u=(t.W+t.pa)/2;t=(t.X+t.ma)/2;var v=Je(p,c.clientData.gd.thumbId);if(Math.abs((c.clientData.we?q.x:q.y)-(c.clientData.we?u:t))<(c.clientData.we?v.pa-v.W:v.ma-v.X)){A(d);p=r;break b}}p=
null}if(null!==p){d=m+p;break a}m+=n.length}if(n=b.rotating){b:{p=a.vb[l];q=d.g.slice(m,m+n.length);r=Re(c,k.x-g,k.y-h,e,f);for(u=0;u<n.length;u++){t=Je(p,n[u].centerId);t={x:(t.W+t.pa)/2,y:(t.X+t.ma)/2};var x=n[u].numSteps?2*Math.PI/n[u].numSteps:1;v=t.x+(r.x-t.x)*Math.cos(q[u]*x)+(r.y-t.y)*Math.sin(q[u]*x);x=t.y-(r.x-t.x)*Math.sin(q[u]*x)+(r.y-t.y)*Math.cos(q[u]*x);if(p.xd(n[u].thumbId,v,x)){c.clientData.Fh=n[u];c.clientData.qg=t;c.clientData.nh=Math.atan2(x-t.y,v-t.x);A(d);p=u;break b}}p=null}if(null!==
p){d=m+p;break a}m+=n.length}if(b.score&&(q=a.vb[l],c=(b.buttons?b.buttons.length:0)+(b.radiobuttons?1:0)+(b.sliders?b.sliders.length:0),l=d.g.slice(c).length/2,n=b.score.numHeights||5,p=Je(q,b.score.id),q=q.Ca,(e=re((p.W-q[0])/(q[2]-q[0]),(p.pa-q[0])/(q[2]-q[0]),(p.ma-q[1])/(q[3]-q[1]),(p.X-q[1])/(q[3]-q[1]),l,n,e,f,g,h,k))?(A(d),d.g[c+2*e.index]===e.tone?d.g[c+2*e.index+1]=(d.g[c+2*e.index+1]+1)%3:(d.g[c+2*e.index]=e.tone,d.g[c+2*e.index+1]=1),p=0):p=null,null!==p)){d=m+p;break a}d=null}}return d},
l=g?g.Sa:function(a,c,d,e,f,g,h,k){var l=(b.buttons?b.buttons.length:0)+(b.radiobuttons?1:0),n=b.sliders?b.sliders.length:0;d>=l&&d<l+n?Ue(a,c,d-l,b,e,f,g,h,k):(l+=n,n=b.rotating?b.rotating.length:0,d>=l&&d<l+n&&(d-=l,e=Re(a,k.x-g,k.y-h,e,f),c.g[(b.buttons?b.buttons.length:0)+(b.radiobuttons?1:0)+(b.sliders?b.sliders.length:0)+d]=Math.round(((Math.atan2(e.y-a.clientData.qg.y,e.x-a.clientData.qg.x)-a.clientData.nh+Math.PI)%(2*Math.PI)-Math.PI)/(b.rotating[d].numSteps?2*Math.PI/b.rotating[d].numSteps:
1))))},p=we(b,g&&g.Nb);e={name:e,type:k,la:m,ga:g?g.ga:function(){return b.defaultParameters||[]},hb:g?g.hb:function(){return b.typicalParameters||b.defaultParameters||[]},ve:g?g.ve||null:b.typicalParamSet||null,H:r,ae:g?g.ae||!1:b.alwaysZoom||!1,$:u,Sa:l,Nb:p,Ac:q};0<=f?c[f]=new y(e):c.push(new y(e))})}
function Xe(a){Tb=function(b,d){return{j:b,Cg:void 0===a.styles.minInteractiveBlockSize?60:a.styles.minInteractiveBlockSize,Dg:void 0===a.styles.minTouchInteractiveBlockSize?120:a.styles.minTouchInteractiveBlockSize,xg:void 0===a.styles.eventRightAlign?!1:a.styles.eventRightAlign,ja:void 0===a.styles.blockLineWidth?Math.max(1,Math.min(3,b/40)):a.styles.blockLineWidth,Bf:Math.round(b/4).toString(10)+"px sans-serif",c:d,va:void 0===a.styles.controlLineWidth?Math.max(1,Math.min(3,b/40)):a.styles.controlLineWidth,
gh:"bold 15px sans-serif",Ef:a.styles.errorColor||"#f88",ig:a.styles.warningColor||"#f88",background:a.styles.background||"white",Wf:a.styles.ruleMarks||"#bbb",Yf:a.styles.scrollbarThumbColor||"navy",Xf:a.styles.scrollbarBackgroundColor||"#ccc",Uc:a.styles.scrollbarWidth||5}};var b=[];We(a,a.blocks||[],b);Za=b};function Da(a,b){this.u=a;this.Db=b||!1;this.h=!1;this.m=[];this.b=[];this.o=null}function rb(a,b){a.h=!0;a.m=b}function Ea(a,b){a.h=!0;a.o=b};function Pa(){this.mc=[];this.ed=[]}function Ye(a,b){this.state=a;this.b=b||{}}function Ze(a,b){function c(a){if(b){if(a.b)for(var c in a.b)a.b.hasOwnProperty(c)&&b[c]&&(a.b[c]=!1)}else a.b={}}a.mc.forEach(c);a.ed.forEach(c)}Pa.prototype.Cb=function(a,b){b&&Ze(this,b);this.mc.push(new Ye(a,b));20<this.mc.length&&(this.mc=this.mc.slice(-20));this.ed=[]};Pa.prototype.eg=function(a,b){b&&Ze(this,b);return 0<this.mc.length?(this.ed.push(new Ye(a,b)),this.mc.pop()):new Ye(a,b)};
Pa.prototype.Vf=function(a,b){b&&Ze(this,b);return 0<this.ed.length?(this.mc.push(new Ye(a,b)),this.ed.pop()):new Ye(a,b)};z.prototype.toDataURL=function(a,b,c){function d(a){a&&(a[0]*=h,a[1]*=g)}var f=this;switch(this.V.type){case "e":var e=E(a,{tag:"block",Y:["event","html"]});break;case "a":e=E(a,{tag:"block",Y:["action","html"]});break;case "s":e=E(a,{tag:"block",Y:["state","html"]});break;case "c":e=E(a,{tag:"block",Y:["comment","html"]});break;default:throw"internal";}var h=b.j/e.width,g=b.j/e.height;e.width=b.j;e.height=b.j;d(e.borderBottomLeftRadius);d(e.borderBottomRightRadius);d(e.borderTopLeftRadius);d(e.borderTopRightRadius);
return(new Sc(this,D(e),e.sa(),0,0,function(a,b,c,d,g){c=b.x+e.offsetLeft()+c;d=b.y+e.offsetTop()+d;Bc(e,a.I,c,d);var h=f.V;b=b.data;var k=e;a.I.save();a.I.translate(c,d);h.H(a,b,k,g);a.I.restore()})).toDataURL(b,c||1)};function $e(a,b,c,d,f){a=a.toDataURL(b,c,d);c="<img width='"+c.j.toString(10)+"' height='"+c.j.toString(10)+"' src='"+a+"'>";return f?"<a href='"+a+"' download='"+f+"'>"+c+"</a>":c}
function af(a,b,c,d,f){var e=E(c,{tag:"widget",id:"widget-"+b.replace(/^.*:/g,"")}),h=D(e),g=e.sa();return{url:(new Sc(null,h,g,0,0,function(c,d,f,n){c.ha=a.ha;cd(c,b,h/2+f,g/2+n,e)})).toDataURL(d,f||1),width:h,height:g}}function bf(a,b,c,d,f,e){a=af(a,b,c,d,f);b="<img width='"+a.width.toString(10)+"' height='"+a.height.toString(10)+"' src='"+a.url+"'>";return e?"<a href='"+a.url+"' download='"+e+"'>"+b+"</a>":b}
function Ub(a,b,c,d,f,e){return{url:(new Sc(null,b,c,0,0,function(b){a(b.I,d,!1)})).toDataURL(f,e||1),width:b,height:c}}function ac(a,b,c,d,f){for(var e=0;e<a.controls.length;e++){var h=a.controls[e];if(h.id===b)return Ub(function(a,b,c){h.H(a,b,c)},h.Kc.pa-h.Kc.W,h.Kc.ma-h.Kc.X,c,d,f)}return null}
function sc(a,b){var c=Tb(100,100),d=bf(a.da,"vpl:then",b,c,5);return"<!DOCTYPE html>\n<html>\n"+(a.ha?"<head>\n<style>\n"+a.ha+"</style>\n</head>\n":"")+"<body>\n<table class='program'>\n"+a.i.i.map(function(a){return a.Ob()?"":"<tr class='rule'>\n<td class='events'>\n<table class='events'>\n<tr class='events'>\n"+a.U.map(function(a,d){var e="block";switch(a.V.type){case "e":e=e+" event"+(0===d?" event-main":" event-aux");break;case "s":e+=" state";break;case "c":e+=" comment"}return"<td class='"+
e+"'>"+$e(a,b,c,5)+"</td>\n"}).join("")+"</tr>\n</table>\n</td>\n<td class='then'>"+d+"</td>\n<td class='actions'>\n<table class='actions'>\n<tr class='actions'>\n"+a.actions.map(function(a){var d="block";switch(a.V.type){case "a":d+=" action";break;case "c":d+=" comment"}return"<td class='"+d+"'>"+$e(a,b,c,5)+"</td>\n"}).join("")+"</tr>\n</table>\n</td>\n</tr>\n"}).join("")+"</table>\n</body>\n</html>\n"}
function uc(a,b){function c(a,b){return b.controls.map(function(c){return(a.M.find(c.id).fb||[{}]).map(function(e){a.Tb.Ka=!0===e.selected;a.Tb.state=e.state||null;var g=!0===e.selected?"selected":!1===e.selected?"unselected":"";e.state&&(g+=(0<g.length?" ":"")+"="+e.state);e=c.id+(g?"-"+g.replace(/\s+/g,"-").replace("=",""):"")+".png";var k=ac(b,c.id,h[c.id],d,f),l="<img width='"+k.width.toString(10)+"' height='"+k.height.toString(10)+"' src='"+k.url+"'>";return"<tr><td>"+(e?"<a href='"+k.url+"' download='"+
e+"'>"+l+"</a>":l)+"</td><td>"+c.id+"</td><td>"+g+"</td></tr>\n"}).join("")}).join("")}var d=Tb(100,100),f=5,e=Yb(a,b);a.Tb={disabled:!1,S:!0,Ag:!1,isEnabled:!0,Ka:!1,state:null};var h=Zb(a,a.o,["vpl","top"]),g=$b(a,a.o,["vpl","top"],e.lc,e.cg,h);h=Object.assign(h,Zb(a,a.m,["vpl","bottom"]));e=$b(a,a.m,["vpl","bottom"],e.ld,e.bg,h);a.bb.forEach(function(a){h[a]=E(b,{tag:"button",id:a.replace(/:/g,"-"),Y:["src","top"]})},a);var k=cf(a,a.bb,E(b,{tag:"toolbar",Y:["src","top"]}),E(b,{tag:"separator",
Y:["src","top"]}),h);a.Na.forEach(function(a){h[a]=E(b,{tag:"button",id:a.replace(/:/g,"-"),Y:["sim","top"]})},a);var m=df(a,a.Na,E(b,{tag:"toolbar",Y:["sim","top"]}),E(b,{tag:"separator",Y:["sim","top"]}),h),q="sim-event:forward sim-event:backward sim-event:left sim-event:right sim-event:center sim-event:clap sim-event:tap".split(" "),n=a.G,r=E(b,{tag:"button",Y:["sim","event"]}),u=q.map(function(a){return Ub(function(c,e,f){(n.Gd||Vb)(a,c,d,b,["sim","event"],null,!0,!1,f)},r.width,r.height,r,d,
f)});g="<!DOCTYPE html>\n<html>\n"+(a.ha?"<head>\n<style>\n"+a.ha+"</style>\n</head>\n":"")+"<body>\n<table>\n"+Za.map(function(a){var c=null;switch(a.type){case "e":c="event";break;case "s":c="state";break;case "a":c="action";break;case "c":c="comment";break;default:return""}var e=new z(a,null,null),g="<tr class='"+c+"'>\n<td>\n";a.ve?a.ve.forEach(function(c,h){e.g=c;g+=$e(e,b,d,f,a.name.replace(/ /g,"_")+"-"+h.toString(10)+".png")}):(e.g=a.hb?a.hb():e.g,g+=$e(e,b,d,f,a.name.replace(/ /g,"_")+".png"));
return g+="</td>\n<td>"+a.name+"</td>\n</tr>\n"}).join("")+"</table>\n<table>\n"+Object.keys(a.da.ha).map(function(a){return"<tr><td>"+bf(this.da,a,b,d,f,a+".png")+"</td><td>"+a+"</td></tr>\n"},a).join("")+"</table>\n<table>\n"+c(a,g)+c(a,e)+c(a,k)+c(a,m)+u.map(function(a,b){b=q[b];var c="<img width='"+a.width.toString(10)+"' height='"+a.height.toString(10)+"' src='"+a.url+"'>",d=b.replace(/ /g,"_")+".png";return"<tr><td>"+("<a href='"+a.url+"' download='"+d+"'>"+c+"</a>")+"</td><td>"+b+"</td></tr>\n"})+
"</table>\n</body>\n</html>\n";a.Tb=null;return g};function ef(a,b){b=(new DOMParser).parseFromString(b,"text/xml").getElementsByTagName("node");if(1>b.length)throw"empty";b=b[0].getElementsByTagName("program");if(1!==b.length)throw"program";var c="0"!==b[0].getAttribute("advanced_mode");b=b[0].getElementsByTagName("set");$a(a);a.mode=c?"a":"b";for(c=0;c<b.length;c++){var d=ff(b[c],function(){a.Cb()});a.i.push(d)}}
function ff(a,b){a=a.getElementsByTagName("block");for(var c=new wa,d=0;d<a.length;d++){a:{var f=a[d];f.getAttribute("type");var e=f.getAttribute("name");var h=[];for(var g=[],k=0;1E3>k;k++){var m=f.getAttribute("value"+k);if(null===m)break;h.push(m);g.push(parseFloat(m))}for(k=0;k<na.length;k++)if(e===na[k].$g&&(!na[k].Ha||oa(na[k].Ha,na[k].Vg?h:g,void 0,!0))){f=na[k].dh;if(void 0==f){h=null;break a}h=na[k].parameters?oa(na[k].parameters,na[k].Vg?h:g,void 0,!0):null;g=ua(f);k=new z(g,null,null);
g.ke?g.ke(k,h):k.g=h;h=k;break a}throw"unknown AESL block "+e;}h&&xa(c,h,null,b,!0)}return c}
var Wb=function(){var a=null;return function(b,c,d){null===a&&(a=document.createElement("a"),document.body.appendChild(a),a.style.display="none");d=d||"application/xml";if("function"===typeof window.Blob&&window.URL){var f=new window.Blob([b],{type:d});f=window.URL.createObjectURL(f)}else f="data:"+d+";base64,"+window.btoa(b);var e=a;d=d||"application/xml";"function"===typeof window.Blob&&window.URL?(b=new window.Blob([b],{type:d}),b=window.URL.createObjectURL(b)):b="data:"+d+";base64,"+window.btoa(b);
e.href=b;e.download=c||"untitled.xml";a.click();"string"!==typeof f&&window.URL.revokeObjectURL(f)}}();function gf(){this.wb=document.getElementById("editor");this.wb.value="";this.b=this.wb.parentElement;var a=window.innerWidth,b=window.getComputedStyle(this.wb);this.wb.style.width=a-10-parseInt(b.paddingLeft,10)-parseInt(b.paddingRight,10)+"px";this.wb.style.border="0px";this.wb.style.outline="none";this.wb.style.resize="none";this.wb.style.whiteSpace="pre";this.wb.setAttribute("wrap","off");this.h=null}gf.prototype.uf=function(a,b){this.wb.setSelectionRange(a,b)};
gf.prototype.resize=function(){var a=this.b.getBoundingClientRect().width,b=window.getComputedStyle(this.wb);this.wb.style.width=a-10-parseInt(b.paddingLeft,10)-parseInt(b.paddingRight,10)+"px"};function hf(a,b){a.wb.value=b;window.getComputedStyle(a.wb)};function jf(a,b,c){this.fa=b;this.language=c||"aseba";this.b="";this.Qc=!0;this.jd=this.he=this.gg=null;this.Fb=!1;this.ia=a.ia||new Fa;this.kc=new gf;this.kc.wb.readOnly=this.Qc;this.kc.h=function(a){window.vplBreakpointsFunction&&window.vplBreakpointsFunction(a)};var d=this;this.Ia=new Mb(a.qb,{ca:a.ca});document.getElementById("editor").addEventListener("input",function(){hc(a);kf(d)===a.i.fa&&(a.i.fa=!a.i.fa,Ob(a))},!1);var f=document.getElementById("editor");f&&document.getElementById("editor").addEventListener("keydown",
function(a){if(9===a.keyCode){a.preventDefault();a.b=!0;a=f.value;var b=this.selectionStart;a=a.slice(0,b)+"\t"+a.slice(this.selectionEnd);hf(d.kc,a);this.selectionStart=this.selectionEnd=b+1;return!1}return!0},!1)}function lf(a,b){a.gg=b}w=jf.prototype;w.pe=function(){this.ia.b=[]};function ec(a,b,c){null===b?hf(a.kc,a.b):(a.b=b,hf(a.kc,b));c||(a.jd=null)}w.ac=function(){return document.getElementById("editor").value.replace(/\s+$/,"")};function kf(a){return a.ac()===a.b.trim()}
w.uf=function(a,b){this.kc.uf(a,b)};function mf(a){var b=E(a.Ia.ca,{tag:"button",Y:["src","top"]});b.height=a.Ia.w.c;a=E(a.Ia.ca,{tag:"toolbar",Y:["src","top"]});a.height=b.sa();return{height:a.height,sa:a.sa()}}function cf(a,b,c,d,f){var e=new wc(a.J.Ia);Kc(e,a,b,["src","top"],a.J.Gd||Vb,a.J.ue||Ic);yc(e,c,f,d);return e}
function hc(a){var b=a.J;b.Ia.ab=[];var c=b.ag||a.bb,d=Zb(a,c,["src","top"]),f=mf(b).height,e=gd(b.Ia);fd(b.Ia);var h=E(b.Ia.ca,{tag:"view",Y:["src"]});E(b.Ia.ca,{tag:"button",Y:["src","top"]});var g=E(b.Ia.ca,{tag:"separator",Y:["src","top"]}),k=E(b.Ia.ca,{tag:"toolbar",Y:["src","top"]});h.yc(e.width);h.jc(e.height);h.setPosition(0,0);k.yc(h.width);k.height=f;k.setPosition(h.x,h.y);Ac(b.Ia,function(a){h.H(a)});zc(cf(a,c,k,g,d),k,d);C(b.Ia)}
function cc(a,b){(a.Qc=b)&&hf(a.kc,a.b);a.kc.wb.readOnly=b;hc(window.vplApp)}
w.resize=function(a,b){this.Ia.resize(a,b);a=this.Ia.b.getBoundingClientRect();b=document.getElementById("src-editor");var c=gd(this.Ia);var d=E(this.Ia.ca,{tag:"view",Y:["src"]});d.yc(c.width);d.jc(c.height);d.setPosition(0,0);var f=mf(this);c=d.x;var e=d.y+f.sa;var h=d.width;d=d.height-f.sa;b.style.left=a.left+a.width*this.Ia.ya.W+c+"px";b.style.width=h+"px";b.style.top=a.top+a.height*this.Ia.ya.X+e+"px";b.style.height=d+"px";this.kc.resize();hc(window.vplApp)};
w.focus=function(){document.getElementById("editor").focus();C(this.Ia)};function nf(a){a.M.add("src:close",{action:function(a){a.gb(["src"],{af:!0})},object:a,S:function(a){return 1<a.Ba.length&&0<=a.Ba.indexOf("src")}});a.M.add("src:new",{action:function(a){hf(a.J.kc,"");C(a.J.Ia)},isEnabled:function(a){return!a.J.Qc&&0<a.J.ac().length},object:a});a.M.add("src:save",{action:function(a){var b=fb(a.i,{ad:!1,dd:!0});Wb(b,a.i.filename||"program.vpl3","application/x-vpl3")},isEnabled:function(a){return 0<a.J.ac().length},object:a});a.M.add("src:vpl",{action:function(a){a.Rd?
a.gb(["vpl"],{Td:!0}):a.gb(["vpl"],{Qd:"src"})},isEnabled:function(a){return kf(a.J)},object:a,S:function(a){return!a.J.fa&&0>a.Ba.indexOf("vpl")}});a.M.add("src:locked",{action:function(a){cc(a.J,!a.J.Qc);C(a.J.Ia);a.J.Qc&&(a.i.fa=!1,Ob(a))},isEnabled:function(a){return null===a.J.jd},Ka:function(a){return a.J.Qc},object:a,S:function(a){return!a.J.fa},fb:[{selected:!1},{selected:!0}]});a.M.add("src:language",{action:function(a){var b=a.J.gg();a.J.language=b.language;a.J.Qc&&ec(a.J,b.code)},isEnabled:function(a){return null===
a.J.jd},getState:function(a){return a.J.language},object:a,S:function(a){return null!=a.J.gg},fb:[{state:"aseba"},{state:"l2"},{state:"asm"},{state:"js"},{state:"python"}]});a.M.add("src:disass",{action:function(a){if(null!==a.J.jd)ec(a.J,a.J.jd),a.J.kc.wb.readOnly=a.J.Qc;else{var b=a.J.ac(),d=a.J.he(a.J.language,b);null!==d&&(ec(a.J,d,!0),a.J.kc.wb.readOnly=!0,a.J.jd=b)}hc(a)},isEnabled:function(a){return null!=a.J.he&&null!==a.J.he(a.J.language,"")},Ka:function(a){return null!==a.J.jd},object:a,
S:function(a){return null!==a.J.he},fb:[{selected:!1},{selected:!0}]});a.M.add("src:run",{action:function(a){var b=a.J.ac();a.Ea[a.na].Wa.ec(b,a.J.language)},isEnabled:function(a){return a.Ea[a.na].Wa.isEnabled(a.J.language)},getState:function(a){return 0===a.J.ac().length?"empty":"canLoad"},object:a,S:function(a){return 0<=a.na},fb:[{selected:!1},{selected:!0},{state:"empty"},{state:"running"},{state:"error"},{state:"canLoad"},{state:"canReload"}]});a.M.add("src:stop",{action:function(a){kc(a)},
isEnabled:function(a){return lc(a)},object:a,S:function(a){return 0<=a.na}});a.M.add("src:connected",{isEnabled:function(a){return!a.i.fa&&0<=a.na&&a.Ea[a.na].Wa.isConnected()},object:a,S:function(a){return 0<a.Ea.length},fb:[{selected:!1},{selected:!0},{selected:!1,state:"monitored"},{selected:!0,state:"monitored"},{selected:!1,state:"nonmonitored"},{selected:!0,state:"nonmonitored"}]});a.M.add("src:sim",{action:function(a){a.Rd?a.gb(["sim"],{Td:!0}):a.gb(["sim"],{Qd:"src"})},object:a,S:function(a){return null!=
a.Ea.find(function(a){return"sim"===a.name})&&null!=a.G&&0>a.Ba.indexOf("sim")}});a.M.add("src:teacher-reset",{action:function(a){a.J.pe();hc(a)},object:a,Sc:!0,S:function(a){return a.J.Fb&&a.J.ia.Zb}});a.M.add("src:teacher",{action:function(a){a.J.ia.Zb=!a.J.ia.Zb;hc(a)},Ka:function(a){return a.J.ia.Zb},object:a,Sc:!0,S:function(a){return a.J.Fb},fb:[{selected:!1},{selected:!0}]})};function of(a){var b=["vpl:message-error","vpl:message-warning","vpl:filename"];return function(c,d,f,e,h,g,k,m,q,n,r){function u(a){if(void 0==a)return!0;for(var b=0;b<a.length;b++)switch(a[b]){case "pressed":if(!n||!m)return!1;break;case "unpressed":if(n&&m)return!1;break;case "selected":if(!q)return!1;break;case "unselected":if(q)return!1;break;case "disabled":if(m)return!1;break;case "enabled":if(!m)return!1;break;default:if("="===a[b][0]&&(r||"").toString()!==a[b].slice(1))return!1}return!0}
if(a.buttons)for(var l=0;l<a.buttons.length;l++)if(a.buttons[l].name===c&&u(a.buttons[l].state)){var p=a.buttons[l];p.draw.forEach(function(b){if(b.uri){var c=pc(b.uri);d.save();b.alpha&&(d.globalAlpha=b.alpha);var e={};p.styles&&p.styles.forEach(function(a){e[(a.complement?"!":"")+a.id]=a.st});a.vb[c.Mc].H(d,{Nd:c.id,style:e});b.debug&&(d.fillStyle="black",d.textAlign="center",d.textBaseline="middle",d.fillText(b.debug,g.width/2,g.height/2));d.restore()}b.js&&(c={pressed:n&&m,unpressed:!(n&&m),selected:q,
unselected:!q,disabled:!m,enabled:m,state:r},b=new Function("ctx","$",b.js),d.save(),d.scale(g.width/1E3,g.height/1E3),d.beginPath(),b(d,c),d.restore())});return}0<=b.indexOf(c)?Vb(c,d,f,e,h,g,k,m,q,n,r):(d.fillStyle="brown",d.fillRect(0,0,g.width,g.height),d.fillStyle="white",d.textAlign="left",d.textBaseline="top",d.font=Math.round(g.height/6).toString(10)+"px sans-serif",d.fillText(c,.02*g.width,.02*g.height),d.fillText((n?"pr ":"")+(q?"sel ":"")+(m?"":"dis"),.02*g.width,.22*g.height),r&&d.fillText("="+
r,.02*g.width,.42*g.height))}}function pf(a){return function(b,c){if(a.buttons)for(var d=0;d<a.buttons.length;d++){var f=a.buttons[d];if(f.name===b&&(void 0==f.state||0>f.state.indexOf("pressed")&&0>f.state.indexOf("selected")&&0>f.state.indexOf("disabled")))return b=pc(f.draw[0].uri),Je(a.vb[b.Mc],b.id)}return{W:0,pa:c.c,X:0,ma:c.c}}}
function qf(a){function b(b){for(var c=0;c<a.widgets.length;c++)if(a.widgets[c].name===b)return a.widgets[c];return null}if(void 0==a.widgets)return{};var c={};["vpl:then","vpl:error","vpl:warning","vpl:moreHigh","vpl:moreLow"].forEach(function(d){var f=b(d);if(f){var e=pc(f.draw[0].uri),h=Je(a.vb[e.Mc],e.id);c[d]=function(b,c,d,e){f.draw.forEach(function(c){if(c.uri){var d=pc(c.uri);c.alpha&&(b.globalAlpha=c.alpha);b.save();var f=Math.min(e.width/(h.pa-h.W),e.height/(h.ma-h.X));b.scale(f,f);b.translate(-(h.W+
h.pa)/2,-(h.X+h.ma)/2);a.vb[d.Mc].H(b,{Nd:d.id});b.restore();c.debug&&(b.fillStyle="black",b.textAlign="center",b.textBaseline="middle",b.fillText(c.debug,0,0))}c.js&&(c=new Function("ctx",c.js),b.save(),b.scale(e.width,e.height),b.beginPath(),c(b),b.restore())})}}});return c};function rf(a){this.K=a&&a.ec?a.ec:null;this.o=a&&a.Oc?a.Oc:null;this.u=a&&a.isConnected?a.isConnected:null;this.b=a&&a.isEnabled?a.isEnabled:null;this.If=a&&a.hf?a.hf:null;this.h=a&&a.Ge?a.Ge:null;this.m=a&&a.getName?a.getName:null;this.Cd=a&&a.Cd?a.Cd:"aseba";this.languages=a&&a.languages?a.languages:[this.Cd];this.state=a&&a.state?a.state:null}w=rf.prototype;w.isConnected=function(){return null==this.u||this.u()};
w.isEnabled=function(a){return null!=this.K&&0<=this.languages.indexOf(a)&&(null==this.b||this.b(a))};w.getName=function(){return null!=this.m?this.m():null};w.Oc=function(a){this.o&&this.o(a)};w.ec=function(a,b){this.isEnabled(b)&&this.K(b,a)};w.Ge=function(a){return null!=this.If&&0<=this.languages.indexOf(a)&&(null==this.h||this.h(a))};w.hf=function(a,b){this.Ge(b)&&this.If(b,a)};function Qb(a,b,c,d){function f(a,b,c,d){var f=document.createElement("div");null!=b?f.innerHTML=b:(f.textContent=a,f.style.font="bold 30px sans-serif",f.style.textAlign="left",f.style.padding="5px",f.style.paddingLeft="10px");f.style.position="absolute";f.style.width="32px";f.style.height="32px";f.style.top="0";c?(f.style.right=g.toString(10)+"px",g+=40):(f.style.left=h.toString(10)+"px",h+=40);f.addEventListener("click",function(){d()},!1);e.o.push(f)}this.u=a;this.b=document.createElement("div");
this.b.style.width="100%";this.b.style.height="100%";this.b.style.position="fixed";this.b.style.top="0";this.b.style.left="0";this.b.style.zIndex="1000";this.b.style.backgroundColor="rgba(1,1,1,0.5)";this.b.style.display="none";this.h=document.createElement("div");this.h.style.width="80%";this.h.style.height="80%";this.h.style.position="fixed";this.h.style.top="50%";this.h.style.left="50%";this.h.style.backgroundColor="white";this.b.appendChild(this.h);document.body.appendChild(this.b);a=document.createElement("div");
a.style.width="100%";a.style.height="100%";d&&(a.style.overflowY="scroll");this.h.appendChild(a);this.m=document.createElement("div");this.m.style.backgroundColor="white";this.m.style.width="100%";this.m.style.height="100%";a.appendChild(this.m);this.o=[];var e=this,h=0,g=30;b||f("\u00d7",null,!1,function(){e.Gc()});c&&c.forEach(function(a){f(a.title,a.lh,!0,a.Aa)})}
Qb.prototype.show=function(){this.o.forEach(function(a){this.h.appendChild(a)},this);this.m.innerHTML=this.u;this.b.style.display="block";jc(this)};Qb.prototype.Gc=function(){this.b.style.display="none"};function jc(a){var b=a.h.getBoundingClientRect();a.h.style.marginLeft=-b.width/2+"px";a.h.style.marginTop=-b.height/2+"px"};function rc(a,b,c){try{gb(a.i,b,function(a){if(0>this.Ba.indexOf(a))if(1===this.Ba.length)this.gb([a]);else{var b=this.Ba.slice();b[0<=b.indexOf("vpl")?b.indexOf("vpl"):0<=b.indexOf("src")?b.indexOf("src"):0]=a;this.gb(b)}this.Uf=!0;Xb(this);0<=this.Ba.indexOf("vpl")&&this.da.ra()},c)}catch(d){}}function sf(a){return(a=/^[^.]+\.(.*)$/.exec(a))?a[1].toLowerCase():""}
function tc(a,b){var c=sf(b.name),d=new window.FileReader;switch(c){case "aesl":case "vpl3":case "vpl3ui":case "json":return d.onload=function(d){d=d.target.result;var e=b.name;"<"===d.trim()[0]?ef(a.i,d):rc(a,d,{ug:"vpl3ui"===c});a.i.filename=e;a.da.ra()},d.readAsText(b),!0}return!1}
function tf(a,b){var c=/^[^.]+\.(.*)$/.exec(b.name);c=c?c[1]:"";var d=new window.FileReader;switch(c.toLowerCase()){case "svg":case "png":case "jpg":case "gif":return a.G&&("obstacle"===a.G.sc?(d.onload=function(b){uf(a,b.target.result)},d.readAsText(b)):(d.onload=function(b){b=b.target.result;var c=new Image;c.addEventListener("load",function(){vf(a,c)});c.src=b},d.readAsDataURL(b))),!0}return!1}
function wf(a,b){var c=/^[^.]+\.(.*)$/.exec(b.name);c=c?c[1]:"";var d=new window.FileReader;switch(c.toLowerCase()){case "wav":a.G&&(d.onload=function(c){a.G.Z.setFile(b.name,c.target.result)},d.readAsArrayBuffer(b))}};function xf(a){var b=this;this.b=document.createElement("div");this.b.style.width="100%";this.b.style.height="100%";this.b.style.position="fixed";this.b.style.top="0";this.b.style.left="0";this.b.style.zIndex="1000";this.b.style.backgroundColor="rgba(1,1,1,0.5)";this.b.style.display="none";this.h=document.createElement("div");this.h.style.width="40em";this.h.style.position="fixed";this.h.style.top="50%";this.h.style.left="50%";this.h.style.backgroundColor="white";this.h.style.padding="2em";this.b.appendChild(this.h);
document.body.appendChild(this.b);var c=document.createElement("p");this.u=c;this.h.appendChild(c);c=document.createElement("table");c.style.width="100%";this.h.appendChild(c);var d=document.createElement("tr");c.appendChild(d);var f=document.createElement("td");d.appendChild(f);this.input=document.createElement("input");this.input.setAttribute("type","file");this.input.style.width="35em";f.appendChild(this.input);f=document.createElement("td");f.align="right";d.appendChild(f);d=document.createElement("input");
d.setAttribute("type","button");d.setAttribute("value",a.h.translate("OK"));d.addEventListener("click",function(){var a=b.input.files[0];a&&b.m(a);b.Gc()},!1);f.appendChild(d);f.appendChild(document.createTextNode("\u00a0\u00a0"));d=document.createElement("input");d.setAttribute("type","button");d.setAttribute("value",a.h.translate("Cancel"));d.addEventListener("click",function(){b.Gc()},!1);f.appendChild(d);f=document.createElement("div");f.style.position="absolute";f.style.width="32px";f.style.height=
"32px";f.style.top="0";f.style.left="0";f.textContent="\u00d7";f.style.font="bold 30px sans-serif";f.style.textAlign="left";f.style.padding="5px";f.style.paddingLeft="10px";f.addEventListener("click",function(){b.Gc()},!1);c.appendChild(f);this.o=a.h;this.m=null}
xf.prototype.show=function(a,b,c){this.u.textContent=this.o.translate(a);this.input.setAttribute("accept",b);this.m=c;this.b.style.display="block";a=this.h.getBoundingClientRect();this.h.style.marginLeft=-a.width/2+"px";this.h.style.marginTop=-a.height/2+"px"};xf.prototype.Gc=function(){this.b.style.display="none"};function yf(a,b,c){this.b=a;this.u=b;this.h=null;this.o=!1;this.m=c;var d=this;setInterval(function(){null!=d.h&&2<=d.h.readyState&&(!1!==d.b.Qe&&(d.b.Qe=!1,Ob(d.b)),d.connect())},5E3)}function zf(a,b,c,d){a=a.b.M;if(a.S(b)&&Fb(a,b)&&a.isEnabled(b))if(void 0!==c){d=a.find(b);var f;if(f=d)d.h?c===d.Ka()?f=!0:(Hb(d,void 0),f=c===d.Ka()):f=!1;f&&Gb(a,b)}else if(void 0!==d)(c=a.find(b))&&Ib(c,d)&&Gb(a,b);else if(c=a.find(b))Hb(c,void 0),Gb(a,b)}
yf.prototype.connect=function(){var a=this;this.h=new WebSocket(this.u);this.h.addEventListener("open",function(){a.b.Qe=!0;a.h.send(JSON.stringify({sender:{type:"vpl",sessionid:a.m,role:a.b.i.Fb?"teacher":"student"},type:"hello"}));window.addEventListener("unload",function(){a.h.send(JSON.stringify({sender:{type:"vpl",sessionid:a.m,role:a.b.i.Fb?"teacher":"student"},type:"bye"}))});Ob(a.b)});this.h.addEventListener("message",function(b){function c(a,b,c){function d(c){return"<div style='display: table; height: 100%; width: 100%; overflow: hidden;'><div style='display: table-cell; vertical-align: middle; text-align: center;'>"+
("<img src='data:"+c+";base64,"+(b?a:btoa(a))+"' style='max-width:100%;max-height:100%;'>")+"</div></div>"}switch(c.toLowerCase()){case "html":case "htm":return b?atob(a):a;case "txt":return b&&(a=atob(a)),"<pre style='width: 100%; height: 100%;'>"+a.replace(/&/g,"&amp;").replace(/</g,"&lt;")+"</pre>";case "gif":return d("image/gif");case "jpg":case "jpeg":return d("image/jpeg");case "png":return d("image/png");case "svg":return d("image/svg+xml");default:return""}}try{var d=JSON.parse(b.data);switch(d.type){case "cmd":zf(a,
d.data.cmd,d.data.selected,d.data.state);Wd(a.b.da);break;case "file":var f=d.data.content,e=d.data.base64||!1,h=sf(d.data.name||"");switch(d.data.kind){case "vpl":e&&(f=btoa(f));/^[\s]*{/.test(f)?rc(a.b,f,{ug:"vpl3ui"===h}):(ef(a.b.i,f),a.b.da.ra());"vpl3ui"!==h&&(a.b.i.filename=d.data.name||null);Wd(a.b.da);break;case "about":Pb(a.b,c(f,e,h));break;case "help":Rb(a.b,c(f,e,h));break;case "suspend":bc(a.b,c(f,e,h))}}}catch(g){console.info(g)}});this.o||(mc(this.b,function(b){a.log(b)}),this.o=!0)};
yf.prototype.log=function(a){try{if("cmd"===a.type&&a.data&&0<=["vpl:run","vpl:save","vpl:upload"].indexOf(a.data.cmd)){var b=fb(this.b.i,{ad:!1,dd:!0});this.h.send(JSON.stringify({sender:{type:"vpl",sessionid:this.m},type:"file",data:{name:this.b.i.filename,content:b},reason:a.data.cmd}))}this.h.send(JSON.stringify({sender:{type:"vpl",sessionid:this.m},type:"log",data:a||null}))}catch(c){}};var Nd=null;document.addEventListener("mousemove",function(a){null!==Nd&&(Nd(a,!1,!1),a.preventDefault())},!1);document.addEventListener("mouseup",function(a){null!==Nd&&(Nd(a,!0,!1),Nd=null,a.preventDefault())},!1);var Td=null;document.addEventListener("touchmove",function(a){null!==Nd&&(Td=a.targetTouches[0],Nd(Td,!1,!0),a.preventDefault());return!1},{capture:!1,passive:!1});document.addEventListener("touchend",function(a){null!==Nd&&(Nd(Td,!0,!0),Nd=null,a.preventDefault());return!1},!1);
function Af(a,b,c,d,f){var e=0<=a.indexOf("/")?a.replace(/\/[^/]*$/,"/"):"",h={},g=new XMLHttpRequest;g.addEventListener("load",function(){if(200===g.status){h[a]=g.responseText;var b=JSON.parse(g.responseText),m=c(b),q=m.length,n=!1;m.forEach(function(c){var g=new XMLHttpRequest;g.addEventListener("load",function(){200===g.status?(h[c]=g.responseText,q--,n||0!==q||d(b,h)):n||(n=!0,f("HTTP error "+g.status))});g.addEventListener("error",function(){n||(n=!0,f("XMLHttpRequest error for "+a))});g.open("GET",
e+c);g.send()})}else f("HTTP error "+g.status)});g.addEventListener("error",f);g.open("GET",a);g.send()}
function Bf(a,b,c,d,f){try{var e=document.getElementById(a).textContent,h=JSON.parse(e),g={};h.svgFilenames&&h.svgFilenames.forEach(function(a){e=document.getElementById(a).textContent;g[a]=e});h.overlays&&h.overlays.forEach(function(a){e=document.getElementById(a).textContent;g[a]=e});h.css&&h.css.forEach(function(a){e=document.getElementById(a).textContent.trim();g[a]=e});if(h.doc)for(var k in h.doc)if(h.doc.hasOwnProperty(k))for(var m in h.doc[k])h.doc[k].hasOwnProperty(m)&&(e=document.getElementById(h.doc[k][m]).textContent.trim(),
g[h.doc[k][m]]=e);d(h,g)}catch(q){f(q)}}function Cf(a){var b=/^[^?]*\?([^#]*)/.exec(document.location.href);if(b=b&&b[1]){b=b.split("&").map(function(a){return a.split("=").map(function(a){return decodeURIComponent(a)})});for(var c=0;c<b.length;c++)if(b[c][0]===a)return b[c][1]}return""}function Df(a){return(document.location.hash||"#").slice(1).split("&").map(function(a){return a.split("=").map(decodeURIComponent)}).reduce(function(a,c){a[c[0]]=c[1];return a},{})[a]||null}
function Ef(a,b){var c=[];a&&a.overlays&&a.overlays.forEach(function(b){try{var d=JSON.parse(a.Dd[b])}catch(B){console.error(B.message)}for(var e in d)if(d.hasOwnProperty(e))switch(e){case "blocks":case "blockList":case "aeslImportRules":case "buttons":case "widgets":a[e]=a[e]?a[e].concat(d[e]):d[e];break;case "toolbars":for(var f in d[e])d[e].hasOwnProperty(f)&&(a[e]=a[e]||{},a[e][f]=d[e][f]);break;case "i18n":for(f in d[e])if(d[e].hasOwnProperty(f)){a[e]=a[e]||{};a[e][f]=a[e][f]||{};for(var g in d[e][f])d[e][f].hasOwnProperty(g)&&
(a[e][f][g]=d[e][f][g])}break;case "help":c.push(d[e])}});var d=document.getElementById("programCanvas"),f=Cf("role"),e=new Jb(d);e.Vc=void 0==window.vplSimMaps?"ground,height,obstacles":"merged"===window.vplSimMaps?null:window.vplSimMaps.split(",");window.vplApp=e;e.username=Cf("user")||window.vplUsername||e.username;a&&oc&&(e.i.message=oc(a),e.i.message&&window.console.info(e.i.message));a&&a.css&&(e.ca.K(),a.css.forEach(function(b){md(e.ca,b,a.Dd[b])}),e.ca.defineProperties());if(a&&a.i18n)for(var h in a.i18n)a.i18n.hasOwnProperty(h)&&
Ja(e.h,h,a.i18n[h]);d=Cf("uilanguage")||"en";e.h.language=d;e.Le=new xf(e);var g=void 0==a||a["hardcoded-gui"]||"classic"===Cf("appearance");e.hg="local"===Cf("storage");e.Rd="false"!==Cf("multiview");var k=Cf("language");Kd="true"===Cf("cssdebug");var m=Vb,q=Ic,n=Nc;if(a){if(g)null!==a.blocks&&0<a.blocks.length&&(a.blocks||[]).forEach(function(a){var b=ua(a.name);we(a,b.Nb);a.typicalParamSet&&(b.ve=a.typicalParamSet)});else if(null!==a.buttons&&0<a.buttons.length&&(m=of(a),q=pf(a)),null!==a.widgets&&
0<a.widgets.length&&(n=qf(a)),null!==a.blocks&&0<a.blocks.length)try{Xe(a)}catch(L){window.console&&window.console.error(L)}if(a.blockList){var r=[];Za.forEach(function(a){"h"===a.type&&r.push(a)});a.blockList.forEach(function(a){r.push(ua(a))});Za=r}a.aeslImportRules&&0<a.aeslImportRules.length&&(na=a.aeslImportRules.map(function(a){return{$g:a.aeslName,Ha:a.condition||null,dh:a.blockName,parameters:a.parameters||null,Vg:a.stringParam||!1}}));a.miscSettings&&void 0!=a.miscSettings.advancedModeEnabled&&
(Ua=1==a.miscSettings.advancedModeEnabled);a.miscSettings&&void 0!=a.miscSettings.basicMultiEvent&&(Ra=1==a.miscSettings.basicMultiEvent);a.miscSettings&&void 0!=a.miscSettings.advancedMultiEvent&&(Ta=1==a.miscSettings.advancedMultiEvent);a.miscSettings&&a.miscSettings.viewRelativeSizes&&(d=a.miscSettings.viewRelativeSizes,e.qc={vpl:d.vpl||1,src:d.src||1,sim:d.sim||1})}d=Cf("server");h=Cf("session");var u="true"===Cf("adv"),l="true"===Cf("exp");Ua="true"===Cf("advmode");var p=0,v=0,F="",x=Cf("blur").trim()||
"";/^\d+$/.test(x)&&(p=parseInt(x,10)/10);x=Cf("grayscale")||"";/^\d+$/.test(x)&&(v=parseInt(x,10)/100);if(0<p||0<v)F="blur("+p.toFixed(1)+"px) grayscale("+v.toFixed(2)+")";p=1;v=0;x=!1;var t=null;x=Cf("scale").trim()||"";/^\d+(\.\d*)?$/.test(x)&&(p=parseFloat(x));x=Cf("rotation").trim()||"";/^-?\d+(\.\d*)?$/.test(x)&&(v=parseFloat(x)*Math.PI/180);x=Cf("mirror").trim()||"";x="true"===x;if(1!==p||0!==v||x)t=[p*Math.cos(v)*(x?-1:1),p*Math.sin(v)*(x?-1:1),-p*Math.sin(v),p*Math.cos(v),0,0];k||(k=0<=e.na?
e.Ea[e.na].Wa.Cd:"aseba");Va();$a(e.i,!0);e.i.pe();p=Cf("view");x=0===p.length?["vpl"]:p.split("+");v=Cf("robot");if(0<=x.indexOf("sim")||"sim"===v)v="sim";v.replace(/[+;]/g,",").split(",").forEach(function(a){var b=null;switch(a){case "thymio":b=Ff(e);b.Oc(k);break;case "thymio-tdm":b=Gf(e);b.Oc(k);break;case "thymio-jws":b=Hf(e);b.Oc(k);break;case "sim":b=If(e,{rg:F,sg:t}),b.Oc(k)}b&&e.Ea.push({name:a,Wa:b})});e.na=0<e.Ea.length?0:-1;if(!pa[k])throw"Unsupported language "+k;Ga(e.ia,u?[]:["src:language"]);
e.i.rb=k;e.da.ha=n;e.i.i.push(new wa);null!=e.b&&(e.b.ha=n);qc(e);!g&&a&&a.toolbars&&(a.toolbars.vpl&&(e.o=a.toolbars.vpl),a.toolbars.vpl2&&(e.m=a.toolbars.vpl2));e.i.Gd=m;e.i.ue=q;jf&&document.getElementById("editor")&&(e.J=new jf(e,e.i.fa,k),Ud(e.J.Ia,F),e.i.o=function(){return kf(e.J)?null:e.J.ac()},e.i.u=function(a){ec(e.J,a)},e.J.Ia.ha=n,nf(e),!g&&a&&a.toolbars&&a.toolbars.editor&&(e.J.ag=a.toolbars.editor),e.J.Gd=m,e.J.ue=q,e.J.Fb="teacher"===f);null!=e.G&&(Jf(e),!g&&a&&a.toolbars&&a.toolbars.simulator&&
(e.G.ag=a.toolbars.simulator),e.G.Gd=m,e.G.ue=q);F&&Ud(e.da,F);Vd(e.da,t);document.getElementsByTagName("body")[0].addEventListener("dragover",function(a){a.stopPropagation();a.preventDefault();a.dataTransfer.dropEffect="copy"},!1);document.getElementsByTagName("body")[0].addEventListener("drop",function(a){a.stopPropagation();a.preventDefault();a=a.dataTransfer.files;1===a.length&&(a=a[0],tc(e,a)||tf(e,a)||wf(e,a))},!1);if(e.G){e.G.ia=e.ia;var K=new Image;K.addEventListener("load",function(){e.G.bf=
K});K.src="data:image/svg+xml;base64,"+btoa('<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="297mm" height="210mm" viewBox="0 0 1052 744" version="1.1"><defs><linearGradient id="gradient" x1="-1000" y1="0" x2="-800" y2="0" gradientUnits="userSpaceOnUse"><stop style="stop-color:#000;stop-opacity:1;" offset="0" /><stop style="stop-color:#000;stop-opacity:0;" offset="1" /></linearGradient></defs><g transform="translate(0,-308)"><rect style="fill:url(#gradient);stroke:none" width="319" height="687" x="-1027" y="336" transform="scale(-1,1)" /><path style="fill:none;stroke:#000;stroke-width:30;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none" d="M 114,592 C 102,417 750,306 778,532 806,757 674,675 559,622 444,568 259,567 278,664 296,762 726,730 778,808 829,887 725,955 616,936 507,917 144,1083 129,837 Z" /></g></svg>');
var Y=new Image;Y.addEventListener("load",function(){e.G.cf=Y});Y.src="data:image/svg+xml;base64,"+btoa('<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" width="297mm" height="210mm" viewBox="0 0 1052 744" version="1.1"><defs><radialGradient id="gradient" cx="400" cy="650" fx="400" fy="650" r="230" gradientTransform="matrix(1.6,0,0,1.16,-113,-75)" gradientUnits="userSpaceOnUse"><stop style="stop-color:#000;stop-opacity:1;" offset="0" /><stop style="stop-color:#000;stop-opacity:0;" offset="1" /></radialGradient></defs><g transform="translate(0,-308)"><rect style="fill:url(#gradient);fill-opacity:1;stroke:none" width="939" height="650" x="54" y="357" /></g></svg>');
e.G.df='<?xml version="1.0" encoding="UTF-8"?><svg xmlns="http://www.w3.org/2000/svg" width="297mm" height="210mm" viewBox="0 0 1052 744" version="1.1"><g transform="translate(0,-308)"><path style="fill:none;stroke:#000;stroke-width:6;stroke-linecap:butt;stroke-linejoin:miter" d="M 172,928 137,420 763,371 905,688 708,981 Z" /><path style="fill:none;stroke:#949494;stroke-width:6;stroke-linecap:butt;stroke-linejoin:miter" d="m 402,754 168,91 101,-142" /><circle style="fill:none;stroke:#000;stroke-width:6" cx="531" cy="550" r="59" /></g></svg>'}if(window.vplStorageGetFunction)window.vplStorageGetFunction("program.vpl3",
function(a,b){try{a&&(e.i.filename=b&&b.filename||"program.vpl3",e.i.readOnly=void 0!=b&&1==b.readOnly,void 0!=b&&1==b.customizationMode&&(e.ia.yb=!0,e.ia.Zb="teacher"===f),gb(e.i,a,function(){Xb(e);Ob(e)}))}catch(ba){}});else if(e.hg)try{var O=window.localStorage.getItem("program.vpl3");O&&gb(e.i,O,function(){Xb(e);Ob(e)})}catch(L){}"text"===Cf("view")?e.gb(["src"],{fa:!0}):(e.gb(["vpl"]),e.i.yg=l,e.i.Fb="teacher"===f?"t":"teacher1"===f?"custb":Oa,Ob(e),e.J&&(document.getElementById("editor").textContent=
e.i.ac(e.i.rb)));var va=["aseba","l2","asm","js","python"];e.J&&0<=va.indexOf(k)&&lf(e.J,function(){k=va[(va.indexOf(k)+1)%va.length];e.i.rb=k;var a=e.i.ac(k);return{language:k,code:a}});if(u&&e.J){var La=new xb(yb);e.J.he=function(a,b){try{switch(a){case "aseba":var c=new zb(La,b);c.ha=Ab;var d=Bb(c);return Kf(b,d,c.Yb);case "l2":return c=new Lf(La,b),c.ha=Mf,d=Bb(c),Kf(b,d,c.Yb);case "asm":return d=Nf(new Of(La,b)),Cb(d);default:return null}}catch(nb){return"; "+nb}}}a&&a.fragments&&a.fragments["about.html"]&&
Pb(e,a.fragments["about.html"].replace(/UIROOT/g,b));a&&a.fragments&&a.fragments["help.html"]&&Rb(e,a.fragments["help.html"].replace(/UIROOT/g,b));if(a&&a.help||0<c.length){e.u=new Ka;a&&a.help&&e.u.add(a.help);e.ua={};if(a&&a.doc)for(var sa in a.doc)a.doc.hasOwnProperty(sa)&&a.Dd[a.doc[sa]["doctemplate.html"]]&&(e.ua[sa]=a.Dd[a.doc[sa]["doctemplate.html"]]);c.forEach(function(a){e.u.add(a)});Xb(e)}a&&a.fragments&&a.fragments["vpl-export-html.css"]&&(e.ha=a.fragments["vpl-export-html.css"]);gc(e);
Wd(e.da);window.addEventListener("resize",function(){gc(e)},!1);e.G&&(e.G.Fb="teacher"===f);if("text"===p)e.gb(["src"],{fa:!0});else{b=["vpl","src","sim"];if(1>x.length||3<x.length||""===p)p="vpl";else for(O=0;O<x.length;O++){if(0>!b.indexOf(x[O])){p="vpl";break}for(sa=0;sa<O;sa++)if(x[O]===x[sa]){p="vpl";break}}e.gb(x)}gc(e);d&&(window.vplCommandServer=new yf(e,d,h),window.vplCommandServer.connect())}
window.addEventListener("load",function(){var a=Cf("ui")||"ui.json",b=null!=document.getElementById(a),c=window.vplUIRoot?window.vplUIRoot:b?".":0<=a.indexOf("/")?a.replace(/\/[^/]*$/,""):".";(b?Bf:Af)(a,c,function(a){var b=(a.svgFilenames||[]).concat(a.overlays||[]).concat(a.css||[]);if(a.doc)for(var c in a.doc)if(a.doc.hasOwnProperty(c))for(var d in a.doc[c])a.doc[c].hasOwnProperty(d)&&b.push(a.doc[c][d]);return b},function(a,b){a.Dd={};a.vb={};a.svgFilenames&&a.svgFilenames.forEach(function(c){a.Dd[c]=
b[c];a.vb[c]=new Ke(b[c])});a.overlays&&a.overlays.forEach(function(c){a.Dd[c]=b[c]});a.css&&a.css.forEach(function(c){a.Dd[c]=b[c]});if(a.doc)for(var d in a.doc)if(a.doc.hasOwnProperty(d))for(var f in a.doc[d])a.doc[d].hasOwnProperty(f)&&(a.Dd[a.doc[d][f]]=b[a.doc[d][f]]);Ef(a,c)},function(a){window.console&&window.console.error(a);Ef()})},!1);window.vplIsProgramChanged=function(){return 0<window.vplApp.i.Wc.mc.length};
window.vplGetProgramAsJSON=function(a){return fb(window.vplApp.i,a?{ad:!0,dd:!1}:void 0)};window.vplGetUIAsJSON=function(){return fb(window.vplApp.i,{ad:!0,dd:!1})};window.addEventListener("unload",function(){var a=fb(window.vplApp.i);try{window.vplStorageSetFunction?window.vplStorageSetFunction("program.vpl3",a):window.vplApp.hg&&window.localStorage.setItem("program.vpl3",a)}catch(b){}},!1);function Pf(){this.Ed=1}Pf.prototype.reset=function(){};Pf.prototype.resetEventListeners=function(){};Pf.prototype.set=function(){};Pf.prototype.get=function(){return null};Pf.prototype.setClientState=function(){};Pf.prototype.getClientState=function(){return null};Pf.prototype.addEventListener=function(){};Pf.prototype.sendEvent=function(){};Pf.prototype.start=function(){this.sendEvent("init",null)};Pf.prototype.setTimer=function(){};Pf.prototype.getTimer=function(){return-1};
Pf.prototype.loadCode=function(){};Pf.prototype.shouldRunContinuously=function(){return!1};Pf.prototype.run=function(){};Pf.prototype.suspend=function(){};Pf.prototype.resume=function(){};function N(){this.Ed=1;this.Na={W:-Infinity,pa:Infinity,X:-Infinity,ma:Infinity};this.u=this.P=0;this.r=70;this.b=[0,0];this.h=0;this.mf=!1;this.files={};this.qb=120;this.oc=80;this.$d=20;this.state={};this.ha={};this.bb=null;this.Id={};this.o=[];this.ua={};this.qc=!1;this.K=null;N.prototype.reset.call(this,0);N.prototype.resetEventListeners.call(this)}N.prototype=Object.create(Pf.prototype);N.prototype.constructor=N;N.prototype.setPositionLimits=function(a,b,c,d){this.Na={W:a,pa:b,X:c,ma:d}};
N.prototype.setFile=function(a,b){this.files[a]=b};
N.prototype.reset=function(a){this.u=this.P=a;this.b=[0,0];this.h=0;this.state={"button.center":!1,"button.left":!1,"button.right":!1,"button.forward":!1,"button.backward":!1,"prox.ground.delta":[1,1],"prox.horizontal":[0,0,0,0,0,0,0],acc:[0,0,1],"motor.left":0,"motor.right":0,"leds.top":[0,0,0],"leds.bottom.left":[0,0,0],"leds.bottom.right":[0,0,0],"leds.circle":[0,0,0,0,0,0,0,0],sound:{}};this.qc=!1;var b=this;this.ha={"leds.circle":function(){b.qc=!0},sound:function(a,d){function c(){if(!(h>=d.f.length)){b.K||
(b.K=new (window.AudioContext||window.webkitAudioContext));var a=b.K.createOscillator();a.type="sawtooth";a.frequency.value=d.f[h];var e=b.K.createGain();e.connect(b.K.destination);a.connect(e);a.start(0);var f=d.d[h]/50;e.gain.exponentialRampToValueAtTime(.01,b.K.currentTime+f);a.stop(b.K.currentTime+f);a.addEventListener("ended",c);h++}}if(d.hasOwnProperty("pcm")){if(a=b.files["P"+d.pcm+".wav"]){b.K||(b.K=new (window.AudioContext||window.webkitAudioContext));var e=b.K;e.decodeAudioData(a.slice(),
function(a){var b=e.createBufferSource();b.buffer=a;b.connect(e.destination);b.start(0)})}}else if(d.f){var h=0;c()}}};this.o=[];this.zc=!1};N.prototype.resetEventListeners=function(){this.ua={}};N.prototype.enforcePositionLimits=function(){this.b=[Math.max(this.Na.W,Math.min(this.Na.pa,this.b[0])),Math.max(this.Na.X,Math.min(this.Na.ma,this.b[1]))]};N.prototype.setPosition=function(a,b){this.b=a;this.h=b;this.enforcePositionLimits();this.bb&&this.bb.call(this)};
N.prototype.set=function(a,b){this.state[a]=b;this.ha[a]&&this.ha[a](a,b)};N.prototype.get=function(a){return this.state[a]};N.prototype.setClientState=function(a,b){this.Id[a]=b};N.prototype.getClientState=function(a){a=this.Id[a];a instanceof Array&&(a=a.slice());return a};N.prototype.addEventListener=function(a,b){this.ua[a]=b};N.prototype.sendEvent=function(a,b){this.ua[a]&&this.ua[a].call(this,a,b);for(var c in this.ua)if(0===c.indexOf(a+"."))this.ua[c](a,b)};
N.prototype.setTimer=function(a,b,c){this.o[a]={next:this.u-this.P+b,Hg:c?b:-1}};N.prototype.getTimer=function(a){return void 0===this.o[a]||0>this.o[a].next?-1:this.P+this.o[a]-this.u};N.prototype.loadCode=function(a,b){if("js"!==a)throw"unsupported language "+a;(new Function(b)).call(this)};N.prototype.shouldRunContinuously=function(){if(this.zc)return!1;if(0!==this.get("motor.left")||0!==this.get("motor.right"))return!0;for(var a=0;a<this.o.length;a++)if(this.o[a]&&0<this.o[a].next)return!0;return!1};
function Qf(a,b){return a.mf?b*Math.sqrt(-2*Math.log(Math.random()))*Math.sin(2*Math.PI*Math.random()):0}
N.prototype.run=function(a,b){0===this.P&&this.reset(a);1!==this.Ed&&(this.P-=(this.Ed-1)*(a-this.u),this.u=this.Ed*(this.u-a)+a);for(var c=Math.max(.01,(a-this.u)/10),d=this.b;!this.zc&&this.u<a;){c=Math.min(c,a-this.u);var f=(100*this.get("motor.left")+Qf(this,1))*c,e=(100*this.get("motor.right")+Qf(this,1))*c;if(0!==f||0!=e){if(1E-6>Math.abs(f-e)||Math.abs(f-e)<1E-4*(Math.abs(f)+Math.abs(e)))this.b=[this.b[0]+.5*(f+e)*Math.cos(this.h),this.b[1]+.5*(f+e)*Math.sin(this.h)];else{var h=(f+e)*this.r/
(f-e);f=(e-f)/(2*this.r);this.b=[this.b[0]+h*(Math.sin(this.h)-Math.sin(this.h+f)),this.b[1]-h*(Math.cos(this.h)-Math.cos(this.h+f))];this.h+=f}this.enforcePositionLimits();this.bb&&this.bb.call(this)}this.u+=c;this.sendEvent("prox",null);for(h=0;h<this.o.length;h++)this.o[h]&&0<this.o[h].next&&this.u>=this.P+this.o[h].next+Qf(this,.01)&&(this.o[h].next=0<=this.o[h].Hg?this.o[h].next+this.o[h].Hg:-1,this.sendEvent("timer"+h.toString(10),null))}b&&b("l",d.concat(this.b))};
N.prototype.suspend=function(){this.zc=!0};N.prototype.resume=function(a){this.zc&&(this.P+=a-this.u,this.u=a,this.zc=!1)};var Rf="shift left;shift right;add;sub;mult;div;mod;bitor;bitxor;bitand;eq;ne;gt;ge;lt;le;or;and".split(";");function Sf(a,b){function c(a){return 32784<=a?a-65536:a}function d(a){return 2048<=a?a-4096:a}var f=[],e=a[0];if(0<a.length){if(1!==e%2||e>a.length)throw"Bad event table";f.push({Sb:0,Bd:a.slice(0,1),nf:-1,A:"dc "+a[0]})}for(var h=[],g=1;g<e;g+=2)h.push({id:a[g],Sb:a[g+1]}),f.push({Sb:g,Bd:a.slice(g,g+2),nf:-1,A:"dc 0x"+a[g].toString(16)+", "+a[g+1]});for(g=e;g<a.length;g++){e={Sb:g,Bd:a.slice(g,g+1),nf:a[g]>>>12};if(!b)for(var k=0;k<h.length;k++)if(h[k].Sb===g){e.id="onevent_"+h[k].id.toString(16);
break}k=a[g];switch(k>>>12){case 0:e.A="stop";break;case 1:e.A="push.s "+((k&4095)-(k&2048?4096:0));break;case 2:e.Bd=a.slice(g,g+2);e.A="push "+c(a[++g]);break;case 3:e.A="load "+(k&4095);break;case 4:e.A="store "+(k&4095);break;case 5:e.Bd=a.slice(g,g+2);e.A="load.ind "+(k&4095)+" size="+a[++g];break;case 6:e.Bd=a.slice(g,g+2);e.A="store.ind "+(k&4095)+" size="+a[++g];break;case 7:case 8:switch(k){case 28672:e.A="neg";break;case 28673:e.A="abs";break;case 28674:e.A="bitnot";break;case 28675:e.A=
"not ; not implemented";break;case 32768:e.A="sl";break;case 32769:e.A="asr";break;case 32770:e.A="add";break;case 32771:e.A="sub";break;case 32772:e.A="mult";break;case 32773:e.A="div";break;case 32774:e.A="mod";break;case 32775:e.A="bitor";break;case 32776:e.A="bitxor";break;case 32777:e.A="bitand";break;case 32778:e.A="eq";break;case 32779:e.A="ne";break;case 32780:e.A="gt";break;case 32781:e.A="ge";break;case 32782:e.A="lt";break;case 32783:e.A="le";break;case 32784:e.A="or";break;case 32785:e.A=
"and";break;default:throw"Unknown instruction "+k.toString(16);}break;case 9:e.A="jump "+(g+d(k&4095));break;case 10:e.Bd=a.slice(g,g+2);e.A=(k&256?k&512?"dont.":"do.":"")+"jump."+(k&256?"when":"if")+".not "+Rf[k&31]+" "+(g+c(a[g+1]));g++;break;case 11:e.A="emit id="+(k&4095)+" data="+c(a[g+1])+" count="+c(a[g+2]);g+=2;break;case 12:e.A="callnat "+(k&4095);break;case 13:e.A="callsub "+(k&4095);break;case 14:e.A="ret";break;default:throw"Unknown instruction "+k.toString(16);}f.push(e)}return f}
function Cb(a,b){var c=Sf(a).map(function(c){var d=c.Sb.toString(10);d="    ".slice(d.length-1)+d;var e=c.Bd.map(function(a){a=a.toString(16);return"000".slice(a.length-1)+a}).join(" ");e+="     ".slice(e.length-4);return(c.id?c.id+":\n":"")+(b?"    ":d+"  "+e+"  ")+c.A+(c.Sb===a[0]-2||0===c.nf||14===c.nf?"\n":"")}).join("\n");0===c.length&&(c="; empty");return c};function Kf(a,b,c){function d(a){var b=f[a].Sb.toString(10);b="    ".slice(b.length-1)+b;var c=f[a].Bd.map(function(a){a=a.toString(16);return"000".slice(a.length-1)+a}).join(" ");c+="     ".slice(c.length-4);e+=(f[a].id?f[a].id+":\n":"")+b+"  "+c+"  "+f[a].A+"\n";f.splice(a,1)}var f=Sf(b,!0);a=a.split("\n");c=c.slice().sort(function(a,b){return a.Sb-b.Sb});c=[new Tf(-1,-1,-1,0)].concat(c).concat(new Tf(Infinity,Infinity,Infinity,b.length));var e="";for(b=0;b<a.length;b++){for(var h=!1,g=0;g<c.length-
1;)if(c[g].line<=b){for(var k=c[g].Sb;k<c[g+1].Sb;k++)for(var m=0;m<f.length;)f[m].Sb===k?(!h&&0<b&&(e+="\n"),h=!0,d(m)):m++;c.splice(g,1)}else g++;h&&(e+="\n");e+=a[b]+"\n"}for(m=0;m<f.length;)d(m);return e};function xb(a){this.name=a.name;this.b=a.maxVarSize;this.Ya=[];for(var b=this.Pa=0;b<a.variables.length;b++)this.Ya.push(new Uf(a.variables[b].name,a.variables[b].size,[1],this.Pa,Vf)),this.Pa+=a.variables[b].size;this.Pb=a.nativeFunctions.map(function(a,b){return{id:b,name:a.name,B:a.args}});this.zd=a.localEvents.map(function(a){return{name:a.name}})}function Wf(a,b){for(var c=0;c<a.Pb.length;c++)if(a.Pb[c].name===b)return a.Pb[c];return null}
function Xf(a,b){for(var c=0;c<a.Ya.length;c++)if(a.Ya[c].name===b)return a.Ya[c];return null}function Yf(a,b){if("init"===b)return 65535;for(var c=0;c<a.zd.length;c++)if(a.zd[c].name===b)return 65534-c;throw"unknown local event "+b;}function zb(a,b){this.Jb=Zf;this.lg=!1;this.qa=a;this.m=b;this.K=b.length;this.b=0;this.line=1;this.Ga=0;this.C=[];this.l=0;this.h=[];this.og=[];this.ha=[];this.P={};this.$a=[];this.bb=[];this.oc=this.qc=this.qa.b;this.Of=!1;this.Oa=0;this.Yb=[]}
function Uf(a,b,c,d,f){this.name=a;this.size=b;this.w=c;this.offset=d;this.resultType=f}Uf.prototype.wd=function(a,b){return[12288|this.offset+(b||0)]};Uf.prototype.kf=function(a,b){return[16384|this.offset+(b||0)]};Uf.prototype.Ie=function(){return[20480|this.offset,this.size]};Uf.prototype.Kf=function(){return[24576|this.offset,this.size]};
zb.prototype.Tg=function(){for(;this.b<this.K;)if(" "===this.m[this.b]||"\t"===this.m[this.b])this.b++,this.Ga++;else if("\n"===this.m[this.b])this.b++,this.Ga=0,this.line++;else if("\r"===this.m[this.b])this.b++;else if("#*"===this.m.slice(this.b,this.b+2))for(this.b+=2,this.Ga+=2;this.b<this.K&&"*#"!==this.m.slice(this.b-2,this.b);)"\n"===this.m[this.b]?(this.Ga=0,this.line++):"\r"!==this.m[this.b]&&this.Ga++,this.b++;else if("#"===this.m[this.b])for(;this.b<this.K&&"\n"!==this.m[this.b];)this.b++,
this.Ga++;else break};function $f(a,b){a.bb.push(b.length-1)}function ag(a,b,c){if(0===a.bb.length)throw"internal";void 0===c&&(c=b.length);a=a.bb.pop();b[a]=36864===b[a]?b[a]+(c-a&4095):c-a+1&65535}zb.prototype.Id=function(a,b,c,d,f){var e;a:{for(e=0;e<this.$a.length;e++)if(this.$a[e].name===a){e=!0;break a}for(e=0;e<this.qa.Ya.length;e++)if(this.qa.Ya[e].name===a){e=!0;break a}e=!1}if(e)throw'duplicate variable declaration "'+a+'"';this.$a.push(new Uf(a,b,c,d,f))};
function bg(a,b){for(var c=a.$a.length-1;0<=c;c--)if(a.$a[c].name===b.name)return a.$a[c];for(c=0;c<a.qa.Ya.length;c++)if(a.qa.Ya[c].name===b.name)return a.qa.Ya[c];throw"unknown variable "+b.name+" "+Q(b.head);}function cg(a,b){for(var c=0;c<a.ha.length;c++)if(a.ha[c].name===b)return a.ha[c];return null}function dg(a,b){a.oc-=b;return a.oc}zb.prototype.qb=function(){return[]};var eg="== != <= >= |= ^= &= *= /= %= += -= <<= >>= ++ -- ( ) [ ] - ~ * / % + << >> & ^ | > < = , : abs and callsub call const do elseif else emit end for if in not onevent or return step sub then var when while".split(" ");
function fg(a,b,c){this.Fd=a;this.kd=b;this.hd=c}function Q(a){return"line "+a.kd.toString()+" col "+a.hd.toString()}function gg(a,b,c,d){fg.call(this,a,b,c);this.n=d}gg.prototype=Object.create(fg.prototype);gg.prototype.constructor=gg;function hg(a,b,c,d){fg.call(this,a,b,c);this.n=d}hg.prototype=Object.create(gg.prototype);hg.prototype.constructor=hg;function ig(a,b,c,d){fg.call(this,a,b,c);this.name=d}ig.prototype=Object.create(fg.prototype);ig.prototype.constructor=ig;
function jg(a,b,c,d){fg.call(this,a,b,c);this.name=d}jg.prototype=Object.create(fg.prototype);jg.prototype.constructor=jg;
zb.prototype.Cf=function(a){for(;;){a:{var b=(b=a)||eg;this.Tg();if(this.b>=this.K)var c=null;else{for(var d=0;d<b.length;d++)if(c=b[d].length,this.m.slice(this.b,this.b+c)===b[d]&&!/[a-zA-Z0-9_.]{2}/.test(this.m.slice(this.b+c-1,this.b+c+1))){b=new jg(this.b,this.line,this.Ga,b[d]);this.b+=c;this.Ga+=c;c=b;break a}c=0;if("0x"===this.m.slice(this.b,this.b+2)){for(this.b+=2;this.b+c<this.K&&/[0-9a-fA-F]/.test(this.m[this.b+c]);)c++;if(0===c)throw"hexadecimal number syntax error";b=parseInt(this.m.slice(this.b,
this.b+c),16);b=new gg(this.b,this.line,this.Ga,b);this.b+=c;this.Ga+=2+c}else if("0b"===this.m.slice(this.b,this.b+2)){for(this.b+=2;this.b+c<this.K&&/[01]/.test(this.m[this.b+c]);)c++;if(0===c)throw"binary number syntax error";b=parseInt(this.m.slice(this.b,this.b+c),2);b=new gg(this.b,this.line,this.Ga,b);this.b+=c;this.Ga+=2+c}else if(/[0-9]/.test(this.m[this.b])){for(;this.b+c<this.K&&/[0-9]/.test(this.m[this.b+c]);)c++;if(this.lg&&this.b+c<this.K&&"."===this.m[this.b+c]){for(c++;this.b+c<this.K&&
/[0-9]/.test(this.m[this.b+c]);c++);b=parseFloat(this.m.slice(this.b,this.b+c));b=new hg(this.b,this.line,this.Ga,b)}else b=parseInt(this.m.slice(this.b,this.b+c),10),b=new gg(this.b,this.line,this.Ga,b);this.b+=c;this.Ga+=c}else if(/[a-zA-Z_]/.test(this.m[this.b])){for(;this.b+c<this.K&&/[a-zA-Z0-9_.]/.test(this.m[this.b+c]);)c++;if(0===c)throw"name syntax error";b=new ig(this.b,this.line,this.Ga,this.m.slice(this.b,this.b+c));this.b+=c;this.Ga+=c}else throw"syntax error line "+this.line.toString()+
" col "+this.Ga.toString();c=b}}if(null===c)break;this.C.push(c)}};function Tf(a,b,c,d){this.Ug=a;this.line=b;this.Ga=c;this.Sb=d}function kg(a,b,c){(b=b.head||b.children[0]&&b.children[0].head)&&a.Yb.push(new Tf(b.Fd,b.kd,b.hd,void 0===c?a.Oa:c))}function R(a){this.head=a;this.children=[];this.ob=0;this.resultType=lg;this.ub=!0}function mg(a,b){for(var c=0;c<a.length;c++)a[c]=a[c].F(b)}R.prototype.F=function(){return this};R.prototype.Ta=function(a){this.children.forEach(function(b){b.Ta(a)})};
R.prototype.u=function(a){this.Ta(a);for(var b=0;b<this.children.length;b++)this.children[b]=this.children[b].u(a);return this};function S(a,b){R.call(this,a);this.n=void 0===b?this.head.n:b;this.resultType=Vf}S.prototype=Object.create(R.prototype);S.prototype.constructor=S;S.prototype.Ta=function(){this.ob=1};function ng(a){a&=65535;return 32768<=a?a-65536:a}function og(a,b){S.call(this,a,b);this.resultType=T}og.prototype=Object.create(S.prototype);og.prototype.constructor=og;
function pg(a){R.call(this,a);this.name=a.name;this.b=!1}pg.prototype=Object.create(R.prototype);pg.prototype.constructor=pg;pg.prototype.Ta=function(a){a.P.hasOwnProperty(this.name)?(this.ob=1,this.resultType=a.P[this.name].resultType):(a=bg(a,this),this.ob=a.size,this.resultType=a.resultType)};pg.prototype.F=function(a){return a.P.hasOwnProperty(this.name)?a.P[this.name].resultType===T?new og(this.head,a.P[this.name].T):new S(this.head,a.P[this.name].T):this};
function qg(a){var b=new pg(a.head);b.resultType=a.resultType;b.b=!0;return b}var lg="?",Vf="n",T="fx";function U(a,b,c,d){R.call(this,a);this.type=b;this.resultType=c?c.resultType:lg;this.Da=c;this.children=d||[]}U.prototype=Object.create(R.prototype);U.prototype.constructor=U;
U.prototype.Ta=function(a){R.prototype.Ta.call(this,a);for(var b=1,c=0;c<this.children.length;c++)if(1===b)b=this.children[c].ob;else if(1!==this.children[c].ob&&this.children[c].ob!==b)throw"incompatible sizes "+Q(this.head);this.ob=b;this.Da&&this.Da.oa&&(this.resultType=this.Da.oa(a,this,this.children.map(function(a){return a.resultType})))};U.prototype.F=function(a){this.children=this.children.map(function(b){return b.F(a)});return this.Da&&this.Da.F?this.Da.F(this,a):this};
U.prototype.u=function(a){var b=R.prototype.u.call(this,a);if(b.type===V&&b.Da.priority===rg&&(b.children[1]instanceof sg||b.children[1]instanceof pg&&1!==b.children[1].ob)){var c=b.children[0];if(!(c instanceof pg)||b.ub)throw"bad array assignment "+Q(b.head);for(var d=b.children[1],f=new tg(b.head),e=0;e<d.ob;e++){var h=c;1<d.ob&&(h=new ug(c.head,[new S(c.head,e)]),h.resultType=c.resultType);if(d instanceof sg)var g=d.children[e];else g=new ug(d.head,[new S(c.head,e)]),g.resultType=d.resultType;
h=new U(b.head,b.type,b.Da,[h,g]);h.resultType=c.resultType;h.ub=!1;h=h.F(a);f.children.push(h)}return f}return b};function ug(a,b){pg.call(this,a);this.children=b}ug.prototype=Object.create(pg.prototype);ug.prototype.constructor=ug;ug.prototype.Ta=function(a){R.prototype.Ta.call(this,a);a=bg(a,this);this.ob=1;this.resultType=a.resultType};function vg(a){for(var b=0;b<a.children.length;b++)if(!(a.children[b]instanceof S))return!1;return!0}
function wg(a,b){for(var c=0,d=1,f=0;f<a.children.length;f++){if(!(a.children[f]instanceof S))throw"internal";c+=d*a.children[f].n;d*=b.w[f]}return c}function sg(a){R.call(this,a);this.w=[]}sg.prototype=Object.create(R.prototype);sg.prototype.constructor=sg;sg.prototype.Ta=function(a){this.ob=this.children.length;this.children[0]&&(this.children.forEach(function(b){b.Ta(a)}),this.resultType=this.children[0].resultType)};function W(a,b){R.call(this,a);this.type=b||xg;this.ua=!1;this.Ra=[null]}
W.prototype=Object.create(R.prototype);w=W.prototype;w.constructor=W;w.Pf=function(){throw"internal";};w.Jg=function(){};w.Lg=function(){throw"internal";};w.Kg=function(){};w.Ud=function(){};function yg(a,b){b.oc=b.qc;kg(b,a)}var xg=1;function zg(a,b){this.b=a;this.ka=b}zg.prototype.v=function(){return"internal"};function Ag(a,b){W.call(this,a,2);this.ff=b}Ag.prototype=Object.create(W.prototype);Ag.prototype.constructor=Ag;Ag.prototype.F=function(a){mg(this.children,a);return this};
Ag.prototype.Pf=function(){return this};function Bg(a,b){W.call(this,a,2);this.Wg=b}Bg.prototype=Object.create(W.prototype);Bg.prototype.constructor=Bg;Bg.prototype.F=function(a){mg(this.children,a);return this};Bg.prototype.Pf=function(){return this};function Cg(a){W.call(this,a)}Cg.prototype=Object.create(W.prototype);Cg.prototype.constructor=Cg;function Dg(a,b,c){W.call(this,a);this.b=b;this.T=c;this.resultType=c.resultType}Dg.prototype=Object.create(W.prototype);Dg.prototype.constructor=Dg;
function Eg(a,b,c,d,f){W.call(this,a);this.P=b.name;this.resultType=c;this.b=d||null;this.size=-1;this.w=[];this.offset=-1;f&&this.children.push(f)}Eg.prototype=Object.create(W.prototype);Eg.prototype.constructor=Eg;Eg.prototype.Ta=function(a){this.children[0]&&(R.prototype.Ta.call(this,a),this.resultType=this.children[0].children[1].resultType)};Eg.prototype.F=function(a){mg(this.children,a);return this};function Fg(a){W.call(this,a.head);this.children.push(a)}Fg.prototype=Object.create(W.prototype);
Fg.prototype.constructor=Fg;Fg.prototype.F=function(a){mg(this.children,a);return this};function tg(a){W.call(this,a)}tg.prototype=Object.create(W.prototype);tg.prototype.constructor=tg;tg.prototype.F=function(a){mg(this.children,a);return this};function Gg(a,b){W.call(this,a,3);this.b=[b];this.h=[];this.m=[]}Gg.prototype=Object.create(W.prototype);w=Gg.prototype;w.constructor=Gg;w.Ta=function(a){this.b.forEach(function(b){b.Ta(a)});this.h.forEach(function(b){b.forEach(function(b){b.Ta(a)})})};
w.F=function(a){mg(this.b,a);this.h.forEach(function(b){mg(b,a)});return this};w.Lg=function(a){if(this.h.length>=this.b.length)throw"multiple else "+Q(a.head);a instanceof Hg&&this.b.push(a.Ha);this.h.push(this.children);this.m.push(a);this.children=[];this.Ra.push(a.Ra[0])};
w.Ud=function(a,b){this.h.push(this.children);this.children=[];this.m.push(b);for(a=0;a<this.b.length;)if(this.b[a]instanceof S)if(0===this.b[a].n)this.b.splice(a,1),this.h.splice(a,1);else{this.b.splice(a);this.h.splice(a+1);break}else a++};function Hg(a,b){W.call(this,a,4);this.Ha=b}Hg.prototype=Object.create(W.prototype);Hg.prototype.constructor=Hg;Hg.prototype.F=function(a){this.Ha=this.Ha.F(a);mg(this.children,a);return this};function Ig(a){W.call(this,a,4)}Ig.prototype=Object.create(W.prototype);
Ig.prototype.constructor=Ig;function Jg(a,b){W.call(this,a,3);this.Ha=b}Jg.prototype=Object.create(W.prototype);Jg.prototype.constructor=Jg;Jg.prototype.Ta=function(a){R.prototype.Ta.call(this,a);this.Ha.Ta(a)};Jg.prototype.F=function(a){this.Ha=this.Ha.F(a);mg(this.children,a);return this};function Kg(a,b){W.call(this,a,3);this.Ha=b;this.b=[]}Kg.prototype=Object.create(W.prototype);Kg.prototype.constructor=Kg;Kg.prototype.Ta=function(a){R.prototype.Ta.call(this,a);this.Ha.Ta(a)};
Kg.prototype.F=function(a){this.Ha=this.Ha.F(a);mg(this.children,a);return this};Kg.prototype.Ud=function(a,b){this.Ha instanceof S&&(0===this.Ha.n&&(this.children=[]),this.Ha=null);this.b.push(b)};function Lg(a,b,c,d,f){W.call(this,a,3);this.m=new pg(b);this.children.push(c);this.children.push(d);this.b=f||null;this.h=[]}Lg.prototype=Object.create(W.prototype);Lg.prototype.constructor=Lg;Lg.prototype.Ta=function(a){R.prototype.Ta.call(this,a);this.b&&this.b.Ta(a)};
Lg.prototype.F=function(a){this.b&&(this.b=this.b.F(a));mg(this.children,a);return this};Lg.prototype.Ud=function(a,b){this.h.push(b)};function Mg(a,b,c){W.call(this,a);this.name=b;this.children=c}Mg.prototype=Object.create(W.prototype);Mg.prototype.constructor=Mg;Mg.prototype.F=function(a){mg(this.children,a);return this};function Ng(a,b){W.call(this,a);this.name=b}Ng.prototype=Object.create(W.prototype);Ng.prototype.constructor=Ng;function Og(a){W.call(this,a,5)}Og.prototype=Object.create(W.prototype);
Og.prototype.constructor=Og;var rg=30,V=1;function X(a,b,c){this.name=a;this.type=b;this.priority=c&&c.priority||0;this.resultType=c&&c.resultType||(c&&c.oa?lg:Vf);this.oa=c&&c.oa||null;this.F=c&&c.F||null;this.L=c&&c.L||[];this.v=c&&c.v||null}function Pg(a,b){for(var c=[],d=0;d<a.children.length;d++){if(!(a.children[d]instanceof S))return a;c.push(a.children[d].n)}return new S(a.head,ng(b(c)))}
var Zf=[new X("--",0,{priority:150}),new X("++",0,{priority:150}),new X("-",0,{priority:150,F:function(a){return Pg(a,function(a){return-a[0]})},L:[28672]}),new X("~",0,{priority:150,F:function(a){return Pg(a,function(a){return~a[0]})},L:[28674]}),new X("abs",0,{priority:150,F:function(a){return Pg(a,function(a){return Math.abs(a[0])})},L:[28673]}),new X("not",0,{priority:150,resultType:"b",F:function(a){return Pg(a,function(a){return 0==a[0]?1:0})},L:[4096,32778]}),new X("size",0,{priority:150,F:function(a,
b){var c=0<a.children[0].ob?a.children[0].ob:a.children[0]instanceof sg?a.children[0].children.length:-1;if(0>c&&a.children[0]instanceof pg)for(var d=b.$a.length-1;0<=d;d--)if(b.$a[d].name===a.children[0].name){c=b.$a[d].size;break}return 0<c?new S(a.head,c):a}}),new X("--",2,{priority:150}),new X("++",2,{priority:150}),new X("+=",V,{priority:rg}),new X("-=",V,{priority:rg}),new X("*=",V,{priority:rg}),new X("/=",V,{priority:rg}),new X("%=",V,{priority:rg}),new X("<<=",V,{priority:rg}),new X(">>=",
V,{priority:rg}),new X("&=",V,{priority:rg}),new X("|=",V,{priority:rg}),new X("^=",V,{priority:rg}),new X("*",V,{priority:140,F:function(a){return Pg(a,function(a){return a[0]*a[1]})},L:[32772]}),new X("/",V,{priority:140,F:function(a){return Pg(a,function(a){return Math.trunc(a[0]/a[1])})},L:[32773]}),new X("%",V,{priority:140,F:function(a){return Pg(a,function(a){return a[0]%a[1]})},L:[32774]}),new X("+",V,{priority:130,F:function(a){return Pg(a,function(a){return a[0]+a[1]})},L:[32770]}),new X("-",
V,{priority:130,F:function(a){return Pg(a,function(a){return a[0]-a[1]})},L:[32771]}),new X("<<",V,{priority:120,F:function(a){return Pg(a,function(a){return a[0]<<a[1]})},L:[32768]}),new X(">>",V,{priority:120,F:function(a){return Pg(a,function(a){return a[0]>>a[1]})},L:[32769]}),new X("==",V,{priority:80,resultType:"b",F:function(a){return Pg(a,function(a){return a[0]===a[1]?1:0})},L:[32778]}),new X("!=",V,{priority:80,resultType:"b",F:function(a){return Pg(a,function(a){return a[0]!==a[1]?1:0})},
L:[32779]}),new X("<",V,{priority:80,resultType:"b",F:function(a){return Pg(a,function(a){return a[0]<a[1]?1:0})},L:[32782]}),new X("<=",V,{priority:80,resultType:"b",F:function(a){return Pg(a,function(a){return a[0]<=a[1]?1:0})},L:[32783]}),new X(">",V,{priority:80,resultType:"b",F:function(a){return Pg(a,function(a){return a[0]>a[1]?1:0})},L:[32780]}),new X(">=",V,{priority:80,resultType:"b",F:function(a){return Pg(a,function(a){return a[0]>=a[1]?1:0})},L:[32781]}),new X("&",V,{priority:110,F:function(a){return Pg(a,
function(a){return a[0]&a[1]})},L:[32777]}),new X("|",V,{priority:90,F:function(a){return Pg(a,function(a){return a[0]|a[1]})},L:[32775]}),new X("^",V,{priority:100,F:function(a){return Pg(a,function(a){return a[0]^a[1]})},L:[32776]}),new X("and",V,{priority:60,resultType:"b",F:function(a){return Pg(a,function(a){return a[0]&&a[1]?1:0})},L:[32785]}),new X("or",V,{priority:50,resultType:"b",F:function(a){return Pg(a,function(a){return a[0]||a[1]?1:0})},L:[32784]}),new X("=",V,{priority:rg})];
function Qg(a,b,c){for(var d=0;d<a.Jb.length;d++)if(a.Jb[d].type===c&&a.Jb[d].name===b)return a.Jb[d];return null}function Rg(a,b,c){return a.C[a.l+b]instanceof c}function Z(a,b,c){return a.C[a.l+b]instanceof jg&&a.C[a.l+b].name===c}w=zb.prototype;w.Bg=function(a){return new U(a,4,null)};
function Sg(a,b){b=b||10;if(Rg(a,0,hg)){var c=new og(a.C[a.l]);a.l++}else if(Rg(a,0,gg))c=new S(a.C[a.l]),a.l++;else if(Rg(a,0,ig))Z(a,1,"(")?(c=a.Bg(a.C[a.l]),a.l++,Z(a,1,")")?a.l+=2:c.children=Tg(a)):(c=new pg(a.C[a.l]),a.l++);else if(Z(a,0,"(")){a.l++;c=Sg(a,20);if(!Z(a,0,")"))throw"subexpression in expression "+Q(a.C[a.l]);a.l++}else if(Z(a,0,"[")){c=new sg(a.C[a.l]);a.l++;var d=[];for(var f=0,e=0,h=0;;){d.push(Sg(a,25));0===h&&e++;h++;if(1<e&&h>f)throw"non-rectangular array "+Q(a.C[a.l]);h>f&&
(f=h);if(Rg(a,0,jg))if(a.l++,"]"===a.C[a.l-1].name)break;else if(","===a.C[a.l-1].name)continue;else if(";"===a.C[a.l-1].name){f=h;h=0;continue}throw"array "+Q(a.C[a.l-1]);}for(h=0;h<f;h++)for(var g=0;g<e;g++)c.children.push(d[g*f+h])}else if(Rg(a,0,jg)&&(d=Qg(a,a.C[a.l].name,0)))c=new U(a.C[a.l],0,d),a.l++,c.children.push(Sg(a,150)),d.oa&&(c.resultType=d.oa(a,c,[c.children[0].resultType]));else if(Rg(a,0,jg)&&(d=Qg(a,a.C[a.l].name,3)))c=new U(a.C[a.l],3,d),a.l++;else{if(a.l<a.C.length)throw"unexpected token in expression "+
Q(a.C[a.l]);throw"unexpected end of file";}for(;Rg(a,0,jg);)if((d=Qg(a,a.C[a.l].name,2))&&d.priority>=b)c=new U(a.C[a.l],2,d,[c]),a.l++;else if((d=Qg(a,a.C[a.l].name,V))&&(b===rg?d.priority>=b:d.priority>b))c=new U(a.C[a.l],V,d,[c]),a.l++,c.children.push(Sg(a,d.priority)),d.oa&&(c.resultType=d.oa(a,c,c.children.map(function(a){return a.resultType})));else if("["===a.C[a.l].name){if(!(c instanceof pg))throw"unexpected indexing";d=c.resultType;f=Tg(a,!0);c=new ug(c.head,f);c.resultType=d}else break;
return c}function Tg(a,b){var c=[];if(!Z(a,0,b?"[":"("))throw"left "+(b?"bracket":"parenthesis")+" expected";for(a.l++;;){var d=Sg(a,25);c.push(d);if(!Rg(a,0,jg))throw"syntax error in arguments";if(Z(a,0,b?"]":")")){a.l++;break}else if(Z(a,0,","))a.l++;else throw"syntax error in arguments "+Q(a.C[a.l]);}return c}
w.Gg=function(){if(this.l>=this.C.length)throw"no more tokens";if(this.C[this.l]instanceof jg){var a=this.C[this.l];switch(a.name){case "const":if(!Rg(this,1,ig)||!Z(this,2,"="))throw'syntax error for "const" '+Q(a);var b=this.C[this.l+1];this.l+=3;var c=Sg(this);c=c.F(this);if(!(c instanceof S))throw"non-constant expression in constant definition "+Q(this.C[this.l]);return[new Dg(a,b.name,c)];case "var":if(!Rg(this,1,ig))throw'unexpected token after "var" '+Q(a);b=this.C[this.l+1];this.l+=2;if(Rg(this,
0,jg))switch(this.C[this.l].name){case "[":if(Z(this,1,"]")){this.l+=2;if(!Z(this,0,"="))throw"missing size or initial value in array declaration"+Q(this.C[this.l-2]);c=new U(this.C[this.l],V,Qg(this,"=",V),[new pg(b)]);this.l++;c.children.push(Sg(this));c.resultType=c.children[1].resultType;c.ub=!1;var d=new U(new jg(c.head.Fd,c.head.kd,c.head.hd,"size"),0,Qg(this,"size",0),[c.children[1]]);return[new Eg(a,b,c.resultType,[d],c)]}this.l++;d=Sg(this);if(!Z(this,0,"]"))throw"array size syntax error"+
Q(this.C[this.l]);this.l++;return Z(this,0,"=")?(c=new U(this.C[this.l],V,Qg(this,"=",V),[new pg(b)]),this.l++,c.children.push(Sg(this)),c.resultType=c.children[1].resultType,c.ub=!1,c=c.F(this),[new Eg(a,b,c.resultType,[d],c)]):[new Eg(a,b,lg,[d])];case "=":return c=new U(this.C[this.l],V,Qg(this,"=",V),[new pg(b)]),this.l++,c.children.push(Sg(this)),c.resultType=c.children[1].resultType,c.ub=!1,c=c.F(this),[new Eg(a,b,c.resultType,null,c)]}return[new Eg(a,b,lg)];case "if":case "elseif":this.l++;
c=Sg(this);if(!Z(this,0,"then"))throw'"then" expected after "if" statement '+Q(this.C[this.l]);this.l++;return["if"===a.name?new Gg(a,c):new Hg(a,c)];case "when":this.l++;c=Sg(this);if(!Z(this,0,"do"))throw'"do" expected after "when" statement '+Q(this.C[this.l]);this.l++;return[new Jg(a,c)];case "while":this.l++;c=Sg(this);if(!Z(this,0,"do"))throw'"do" expected after "while" statement '+Q(this.C[this.l]);this.l++;return[new Kg(a,c)];case "for":if(!Rg(this,1,ig)||!Z(this,2,"in"))throw'"for" syntax error '+
Q(a);b=this.C[this.l+1];this.l+=3;c=Sg(this);if(!Z(this,0,":"))throw'range expected in "for" statement '+Q(this.C[this.l]);this.l++;d=Sg(this);var f=null;Z(this,0,"step")&&(this.l++,f=Sg(this));if(!Z(this,0,"do"))throw'"do" expected after "for" statement '+Q(this.C[this.l]);this.l++;return[new Lg(a,b,c,d,f)];case "end":return this.l++,[new Og(a)];case "call":if(!Rg(this,1,ig))throw'"call" syntax error '+Q(a);b=this.C[this.l+1];this.l+=2;return Z(this,0,"(")?[new Mg(a,b.name,Tg(this))]:[new Mg(a,b.name,
[])];case "callsub":if(!Rg(this,1,ig))throw'"callsub" syntax error '+Q(a);b=this.C[this.l+1];this.l+=2;return[new Ng(a,b.name)];case "else":return this.l++,[new Ig(a)];case "onevent":if(!Rg(this,1,ig))throw'unexpected token after "onevent" '+Q(a);b=this.C[this.l+1];this.l+=2;return[new Ag(a,b.name)];case "return":return this.l++,[new Cg(a)];case "sub":if(!Rg(this,1,ig))throw'unexpected token after "sub" '+Q(a);b=this.C[this.l+1];this.l+=2;return[new Bg(a,b.name)]}}c=Sg(this);c instanceof U&&(c.ub=
!1);c=c.F(this);return[new Fg(c)]};w.Ng=function(){};w.Mg=function(){};
w.Re=function(a){if(a instanceof Dg){a.T=a.T.F(this);if(!(a.T instanceof S))throw"constant definition "+Q(a.head);this.P[a.b]={T:a.T.n,resultType:a.T.resultType}}else a instanceof Eg&&(a.size=1,a.w=[],a.b&&(a.b=a.b.map(function(b){b=b.F(this);if(!(b instanceof S)||0>=b.n)throw"array variable size "+Q(a.head);a.size*=b.n;a.w.push(b.n);return b},this)),a.offset=this.Pa,a.children[0]&&(a.resultType=a.children[0].resultType),this.Pa+=a.size,this.Id(a.P,a.size,a.w,a.offset,a.resultType))};w.Vd=function(){};
w.wa=function(){};w.getContext=function(){return null};w.pg=function(){this.Pa=this.qa.Pa;for(var a=0;a<this.h.length;a++)this.Re(this.h[a])};function Ug(a,b,c){switch(b.type){case 3:c.push(a.getContext());a.wa(b.Ra[0]);break;case 4:a.wa(b.Ra[0]);break;case 5:a.wa(c.pop())}}
function Vg(a){function b(){if(1<e.length){var a=e[e.length-1].head;throw"unterminated "+a.name+" "+Q(a);}c.o.push(e[0])}var c=a,d=[];a.pg();a.Vd();d=[];a.h.forEach(function(a){Ug(this,a,d);a.Ta(this)},a);a.Vd();d=[];for(var f=0;f<a.h.length;f++)Ug(a,a.h[f],d),a.h[f]=a.h[f].F(a);a.Vd();d=[];for(f=0;f<a.h.length;f++)Ug(a,a.h[f],d),a.h[f]=a.h[f].u(a);a.o=[];var e=[new Ag(null,"init")];a.Vd();for(f=0;f<a.h.length;f++)switch(a.h[f].type){case xg:a.h[f].Ud(a,a.h[f]);e[e.length-1].children.push(a.h[f]);
break;case 2:a.wa(a.h[f].Ra[0]);b();e=[a.h[f].Pf()];break;case 3:a.wa(a.h[f].Ra[0]);a.h[f].Jg(a);e.push(a.h[f]);break;case 4:a.wa(a.h[f].Ra[0]);e[e.length-1].Lg(a.h[f]);break;case 5:if(2>e.length)throw"unexpected end "+Q(a.h[f].head);a.wa(a.h[f].Ra[0]);e[e.length-1].Kg(a.h[f]);var h=e.pop();a.wa(a.h[f].Ra[a.h[f].Ra.length-1]);h.Ud(a,a.h[f]);e[e.length-1].children.push(h);break;default:throw"not implemented "+a.h[f].type;}b()}w.Og=function(){};w.zg=function(){return null};
R.prototype.v=function(a){for(var b=[],c=a.Oa,d=0;d<this.children.length;d++)b=b.concat(this.children[d].v(a)),a.Oa=c+b.length;return b};function Wg(a){return-2048<=a&&2048>a?[4096|a&4095]:[8192,a&65535]}S.prototype.v=function(){return this.ub?Wg(this.n):[]};pg.prototype.v=function(a){return this.b?[]:a.P.hasOwnProperty(this.name)?Wg(a.P[this.name].T):bg(a,this).wd(a)};
U.prototype.v=function(a){function b(b,d,e,f){function g(b,g){f===c.Tf&&(h=h.concat(b.wd(a,g)));e&&(h=h.concat(b.wd(a,g)));h=h.concat(d.v(a)).concat(a.qb(d.resultType,b.resultType)).concat(b.kf(a,g));f===c.Oe&&(h=h.concat(b.wd(a,g)))}var h=[];if(b instanceof ug){var k=bg(a,b);if(vg(b)){b=wg(b,k);if(b>=k.size)throw"index out of range";g(k,b)}else if(f!==c.xf||e){var l=dg(a,1);h=h.concat(Xg(b,a)).concat(16384|l);f===c.Tf&&(h=h.concat(12288|l).concat(k.Ie(a)));e&&(h=h.concat(12288|l).concat(k.Ie(a)));
h=h.concat(d.v(a)).concat(a.qb(d.resultType,k.resultType)).concat(12288|l).concat(k.Kf(a));f===c.Oe&&(h=h.concat(12288|l).concat(k.Ie(a)))}else h=h.concat(d.v(a)).concat(a.qb(d.resultType,k.resultType)).concat(Xg(b,a)).concat(k.Kf(a))}else if(b instanceof pg)k=bg(a,b),g(k);else throw"bad assignment";return h}var c={xf:0,Oe:1,Tf:2},d=this.head.name;switch(d){case "=":return b(this.children[0],this.children[1],!1,this.ub?c.Oe:c.xf);case "++":case "--":if(!(this.children[0]instanceof pg))throw"invalid operand "+
Q(this.head);var f=d[0],e=Qg(a,f,V);f=new U(new jg(this.head.Fd,this.head.kd,this.head.hd,f),V,e,[qg(this.children[0]),new S(new gg(this.head.Fd,this.head.kd,this.head.hd,1))]);e.oa&&(d=bg(a,this.children[0]),f.resultType=e.oa(a,f,[d.resultType,Vf]));return b(this.children[0],f,!0,this.ub?0===this.type?c.Oe:c.Tf:c.xf);default:if(this.type===V&&this.Da.priority===rg){if(!(this.children[0]instanceof pg))throw"invalid operand "+Q(this.head);f=d.slice(0,-1);e=Qg(a,f,V);f=new U(new jg(this.head.Fd,this.head.kd,
this.head.hd,f),V,e,[qg(this.children[0]),this.children[1]]);e.oa&&(d=bg(a,this.children[0]),f.resultType=e.oa(a,f,[d.resultType,this.children[1].resultType]));return b(this.children[0],f,!0,this.ub?c.Oe:c.xf)}if(this.Da&&this.Da.v)return this.Da.v(this,a);switch(this.type){case 0:return R.prototype.v.call(this,a).concat(this.Da.L);case V:return R.prototype.v.call(this,a).concat(this.Da.L);case 3:return this.Da.L;case 4:e=a.zg(this);if(null!==e)return e;f=cg(a,d);if(null!=f){if(f.bd!==this.children.length)throw"wrong number of arguments";
e=[];d=dg(a,f.bd+(f.me||0));for(var h=0;h<this.children.length;h++)e=e.concat(this.children[h].v(a)),e=e.concat(16384|d+h);return e=e.concat(f.Nb(a,a.qa,this.children.map(function(a){return a.resultType}),d))}throw"unknown function "+d+" "+Q(this.head);default:throw"internal";}}};function Yg(a,b,c){return a instanceof U&&2===a.children.length?a.children[0].v(b).concat(a.children[1].v(b)).concat([40960|(c?256:0)|a.Da.L[0]&255,0]):a.v(b).concat(4096,40960|(c?256:0)|Rf.indexOf("ne"),0)}
function Xg(a,b){var c=bg(b,a);if(a.children.length>c.w.length)throw"too many indices"+Q(a.head);for(var d=[],f=1,e=0;e<a.children.length;e++)d=d.concat(a.children[e].v(b)),0<e&&(d=d.concat(4096|f,32772,32770)),f*=c.w[e];return d}ug.prototype.v=function(a){if(this.b)return[];var b=bg(a,this);if(vg(this)){var c=wg(this,b);if(c>=b.size)throw"index out of range "+Q(this.head);return b.wd(a,c)}return Xg(this,a).concat(b.Ie(a))};sg.prototype.v=function(){throw"internal";};
W.prototype.v=function(){throw"internal";};Ag.prototype.v=function(a){var b=a.getContext();yg(this,a);a.wa(this.Ra[0]);var c="init"===this.ff?a.og:[];a.Oa+=c.length;c=c.concat(R.prototype.v.call(this,a)).concat(0);a.wa(b);return c};Bg.prototype.v=function(a){var b=a.getContext();yg(this,a);a.wa(this.Ra[0]);var c=R.prototype.v.call(this,a).concat(57344);a.wa(b);return c};Dg.prototype.v=function(a){yg(this,a);return[]};
Eg.prototype.v=function(a){yg(this,a);return 0===this.children.length?[]:R.prototype.v.call(this,a)};Fg.prototype.v=function(a){yg(this,a);return this.children[0].v(a)};tg.prototype.v=function(a,b){yg(this,a);var c=[];this.children.forEach(function(d){c=c.concat(d.v(a,b))});return c};
Gg.prototype.v=function(a){var b=a.getContext();yg(this,a);for(var c=a.Oa,d=[],f=0,e=0;e<this.b.length;e++)a.Oa=c+d.length,0<e&&kg(a,this.m[e-1]),d=d.concat(Yg(this.b[e],a)),a.Oa=c+d.length,$f(a,d),a.wa(this.Ra[e]),this.h[e].forEach(function(b){d=d.concat(b.v(a));a.Oa=c+d.length}),a.wa(b),e+1<this.h.length?(d=d.concat(36864),ag(a,d),$f(a,d),f++):ag(a,d);a.Oa=c+d.length;this.h.length>this.b.length&&(kg(a,this.m[this.b.length-1],a.Oa+d.length),a.wa(this.Ra[this.b.length]),this.h[this.b.length].forEach(function(b){d=
d.concat(b.v(a));a.Oa=c+d.length}));for(;0<f--;)ag(a,d);a.wa(b);return d};Jg.prototype.v=function(a){var b=a.getContext();yg(this,a);var c=a.Oa,d=Yg(this.Ha,a,!0);$f(a,d);a.wa(this.Ra[0]);this.children.forEach(function(b){a.Oa=c+d.length;d=d.concat(b.v(a))});ag(a,d);a.wa(b);return d};
Kg.prototype.v=function(a){if(null==this.Ha&&0===this.children.length)return[];var b=a.getContext();yg(this,a);var c=a.Oa,d=[];null!=this.Ha&&(d=Yg(this.Ha,a));$f(a,d);a.wa(this.Ra[0]);this.children.forEach(function(b){a.Oa=c+d.length;d=d.concat(b.v(a))});a.Oa=c+d.length;kg(a,this.b[0]);d=d.concat(36864|-d.length&4095);ag(a,d);a.wa(b);return d};
Lg.prototype.v=function(a){var b=a.getContext();yg(this,a);var c=a.Oa,d=this.children[0].v(a),f=bg(a,this.m);d=d.concat(f.kf(a));var e=d.length;d=d.concat(f.wd(a)).concat(this.children[1].v(a)).concat(40975,0);$f(a,d);a.wa(this.Ra[0]);for(var h=2;h<this.children.length;h++)a.Oa=c+d.length,d=d.concat(this.children[h].v(a));a.Oa=c+d.length;kg(a,this.h[0]);d=d.concat(f.wd(a));d=this.b?d.concat(this.b.v(a)):d.concat(Wg(1));d=d.concat(32770,f.kf(a),36864|e-d.length-2&4095);ag(a,d);a.wa(b);return d};
Mg.prototype.v=function(a){yg(this,a);var b=Wf(a.qa,this.name);if(!b)throw'native function "'+this.name+'" not found';if(this.children.length!==b.B.length)throw'wrong number of arguments for native function "'+this.name+'"';for(var c=[],d=[],f=[],e=this.children.length-1;0<=e;e--){var h=this.children[e];if(0>b.B[e])if(void 0==d[-b.B[e]-1])d[-b.B[e]-1]=h.ob;else{if(d[-b.B[e]-1]!==h.ob)throw'argument size mismatch in native function "'+this.name+'"';}else 0===b.B[e]&&f.push(h.ob);if(h instanceof ug)c=
c.concat(Wg(bg(a,h).offset)).concat(Xg(h,a)).concat(32770);else if(h instanceof pg)c=c.concat(Wg(bg(a,h).offset));else{for(var g=dg(a,h.ob),k=0;k<h.ob;k++)c=c.concat((h instanceof sg?h.children[k]:h).v(a)),c=c.concat(16384|g+k);c=c.concat(Wg(g))}}for(e=f.length-1;0<=e;e--)c=Wg(f[e]).concat(c);for(e=d.length-1;0<=e;e--)void 0!==d[e]&&(c=Wg(d[e]).concat(c));return c=c.concat(49152|b.id)};Cg.prototype.v=function(a){yg(this,a);return[(a.Of?14:0)<<12]};function Zg(a,b){zg.call(this,a,b)}Zg.prototype=Object.create(zg.prototype);
Zg.prototype.constructor=Zg;Zg.prototype.v=function(){var a=this.ka.name;if(void 0===this.b.$d[a])throw'unknown function "'+a+'" '+Q(this.ka.head);return 53248|this.b.$d[a]};Ng.prototype.v=function(a){yg(this,a);return[new Zg(a,this)]};function $g(a,b){b=b||0;for(var c=0;c<a.length;c++)a[c]instanceof zg&&(a[c]=a[c].v(b+c))}
zb.prototype.v=function(){this.bb=[];this.Vd();this.Yb=[];var a=this.o.map(function(a){this.Oa=0;this.wa(a.Ra[0]);this.Of=a instanceof Bg;this.Yb=[];return{Kd:a.v(this,!0),mapping:this.Yb}},this);if(0<this.bb.length)throw"internal";for(var b=0,c=0;c<this.o.length;c++)this.o[c]instanceof Ag&&b++;this.$d={};var d=[],f=[1+2*b];this.Yb=[];for(c=0;c<this.o.length;c++)this.Yb=this.Yb.concat(a[c].mapping.map(function(a){return new Tf(a.Ug,a.line,a.Ga,a.Sb+1+2*b+d.length)})),this.o[c]instanceof Ag?(f=f.concat(Yf(this.qa,
this.o[c].ff),1+2*b+d.length),d=d.concat(a[c].Kd)):this.o[c]instanceof Bg&&(this.$d[this.o[c].Wg]=1+2*b+d.length,d=d.concat(a[c].Kd));$g(d,1+2*b);return f.concat(d)};function Bb(a){a.Cf();a.Ng();a.l=0;for(a.h=[];a.l<a.C.length;)a.h=a.h.concat(a.Gg());a.Mg();Vg(a);a.Og();return a.v()};function ah(a,b,c){void 0===c&&(c=1);return{name:a,bd:c,me:1,He:function(a){return null!=Wf(a,b)},Nb:function(a,f,e,h){a=Wf(f,b);f=[4097];for(e=0;e<c;e++)f=f.concat([4096|h+c-1-e]);return f=f.concat([4096|h+c,49152|a.id,12288|h+c])}}}var Ab=[ah("min","math.min",2),ah("max","math.max",2),ah("clamp","math.clamp",3),ah("muldiv","math.muldiv",3),ah("atan2","math.atan2",2),ah("sin","math.sin"),ah("cos","math.cos"),ah("sqrt","math.sqrt"),ah("rand","math.rand",0)];function Lf(a,b){zb.call(this,a,b);this.lg=!0;this.Jb=bh;this.sb=100;this.Yg=[];this.jf=[];this.ng=[];this.labels=[[]];this.mg=[];this.Ab=!1;this.label=null;this.ua=lg;this.Na=[]}Lf.prototype=Object.create(zb.prototype);Lf.prototype.constructor=Lf;var ch="== != <= >= |= ^= &= *= /= %= += -= <<= >>= ++ -- ( ) [ ] - ~ ! * / % + << >> && || & ^ | > < = , ? : { } ; bool break case const continue default do else emit false fixed for goto if int onevent return size switch true void when while".split(" ");
function dh(a,b,c){return c[0]}function eh(a,b,c){for(a=0;a<c.length;a++)switch(c[a]){case lg:case T:return c[a];case "v":throw"cannot use void result in expression";}return Vf}function fh(a,b,c){if(!(a instanceof sg)&&a.resultType!==b&&a.resultType!==lg){if("v"===a.resultType)throw"cannot use void result "+Q(a.head);if(b=gh(b))a=new U(new jg(a.head.Fd,a.head.kd,a.head.hd,b),0,Qg(c,b,0),[a]),a=a.F(c)}return a}function hh(a,b){a.children[1]=fh(a.children[1],a.resultType,b);return a}
Lf.prototype.qb=function(a,b){if(a===lg||b===lg)throw"internal";if("v"===a)throw"bad conversion from void";switch(a){case Vf:case "b":switch(b){case T:return[4196,32772]}break;case T:switch(b){case Vf:case "b":return[4196,32773]}}return[]};function ih(a,b,c){var d=[];a.forEach(function(a){d=a instanceof og&&b===Vf?d.concat(Wg(Math.trunc(a.n))):a instanceof S&&a.resultType===Vf&&b===T?d.concat(Wg(a.n*c.sb)):d.concat(a.v(c)).concat(c.qb(a.resultType,b))});return d}
function jh(a,b,c,d){var f=dg(a,4);return(b instanceof R?b.v(a):Wg(b)).concat(16384|f).concat(c instanceof R?c.v(a):Wg(c)).concat(16384|f+1).concat(d instanceof R?d.v(a):Wg(d)).concat([16384|f+2,4097,4096|f+2,4096|f+1,4096|f,4096|f+3,49152|Wf(a.qa,"math.muldiv").id,12288|f+3])}
function kh(a,b,c,d){for(var f=!1,e=[],h=0;h<a.children.length;h++){if(a.children[h]instanceof og)f=!0;else if(!(a.children[h]instanceof S))return a;e.push(a.children[h].n)}c=(f&&d?d:c)(e);d=a.Da.resultType;a.Da.oa&&(d=a.Da.oa(b,a,a.children.map(function(a){return a.resultType})));switch(d){case Vf:case "b":return new S(a.head,ng(c));case T:return new og(a.head,c);default:throw"internal";}}
var bh=[new X("--",0,{priority:150,oa:dh}),new X("++",0,{priority:150,oa:dh}),new X("-",0,{priority:150,oa:dh,F:function(a,b){return kh(a,b,function(a){return-a[0]})},L:[28672]}),new X("~",0,{priority:150,F:function(a,b){return kh(a,b,function(a){return~a[0]})},L:[28674]}),new X("!",0,{priority:150,resultType:"b",F:function(a,b){return kh(a,b,function(a){return 0==a[0]?1:0})},L:[4096,32778]}),new X("bool",0,{priority:150,resultType:"b",F:function(a,b){return kh(a,b,function(a){return 0!=a[0]?1:0})},
L:[],v:function(a,b){b=a.children[0].v(b);"b"!==a.children[0].resultType&&(b=b.concat(4096,32779));return b}}),new X("fixed",0,{priority:150,resultType:T,F:function(a,b){return kh(a,b,function(a){return a[0]})},L:[],v:function(a,b){var c=a.children[0].v(b);a.children[0].resultType!==T&&(c=c.concat(4096|b.sb,32772));return c}}),new X("int",0,{priority:150,F:function(a,b){return kh(a,b,function(a){return a[0]})},L:[],v:function(a,b){var c=a.children[0].v(b);a.children[0].resultType===T&&(c=c.concat(4096|
b.sb,32773));return c}}),new X("size",0,{priority:150,F:function(a,b){var c=0<a.children[0].ob?a.children[0].ob:a.children[0]instanceof sg?a.children[0].children.length:-1;if(0>c&&a.children[0]instanceof pg)for(var d=b.$a.length-1;0<=d;d--)if(b.$a[d].name===a.children[0].name){c=b.$a[d].size;break}return 0<c?new S(a.head,c):a}}),new X("--",2,{priority:150,oa:dh}),new X("++",2,{priority:150,oa:dh}),new X("+=",V,{priority:rg,oa:dh,F:hh}),new X("-=",V,{priority:rg,oa:dh}),new X("*=",V,{priority:rg,oa:dh}),
new X("/=",V,{priority:rg,oa:dh}),new X("%=",V,{priority:rg,oa:dh}),new X("<<=",V,{priority:rg}),new X(">>=",V,{priority:rg}),new X("&=",V,{priority:rg}),new X("|=",V,{priority:rg}),new X("^=",V,{priority:rg}),new X("*",V,{priority:140,oa:eh,L:[32772],F:function(a,b){return kh(a,b,function(a){return a[0]*a[1]})},v:function(a,b){var c=a.children[1].resultType===T,d=[];a.children[0].resultType===T&&c?d=d.concat(jh(b,a.children[0],a.children[1],b.sb)):(a.children.forEach(function(a){d=d.concat(a.v(b))}),
d=d.concat(a.Da.L));return d}}),new X("/",V,{priority:140,oa:eh,L:[32773],F:function(a,b){return kh(a,b,function(b){if(0===b[1])throw"division by 0 "+Q(a.head);return Math.trunc(b[0]/b[1])},function(b){if(0===b[1])throw"division by 0 "+Q(a.head);return b[0]/b[1]})},v:function(a,b){var c=a.children[1].resultType===T,d=[];a.children[0].resultType===T?c?d=d.concat(jh(b,a.children[0],b.sb,a.children[1])):(a.children.forEach(function(a){d=d.concat(a.v(b))}),d=d.concat(a.Da.L)):c?d=d.concat(jh(b,a.children[0],
b.sb*b.sb,a.children[1])):(a.children.forEach(function(a){d=d.concat(a.v(b))}),d=d.concat(a.Da.L));return d}}),new X("%",V,{priority:140,oa:eh,F:function(a,b){return kh(a,b,function(b){if(0===b[1])throw"division by 0 "+Q(a.head);return b[0]%b[1]})},L:[32774],v:function(a,b){return ih(a.children,a.resultType,b).concat(a.Da.L)}}),new X("+",V,{priority:130,oa:eh,F:function(a,b){return kh(a,b,function(a){return a[0]+a[1]})},L:[32770],v:function(a,b){return ih(a.children,a.resultType,b).concat(a.Da.L)}}),
new X("-",V,{priority:130,oa:eh,F:function(a,b){return kh(a,b,function(a){return a[0]-a[1]})},L:[32771],v:function(a,b){return ih(a.children,a.resultType,b).concat(a.Da.L)}}),new X("<<",V,{priority:120,F:function(a,b){return kh(a,b,function(a){return a[0]<<a[1]})},L:[32768],v:function(a,b){return a.children[0].v(b).concat(ih(a.children.slice(1),Vf,b)).concat(a.Da.L)}}),new X(">>",V,{priority:120,F:function(a,b){return kh(a,b,function(a){return a[0]>>a[1]})},L:[32769],v:function(a,b){return a.children[0].v(b).concat(ih(a.children.slice(1),
Vf,b)).concat(a.Da.L)}}),new X("==",V,{priority:80,resultType:"b",F:function(a,b){return kh(a,b,function(a){return a[0]===a[1]?1:0})},L:[32778],v:function(a,b){var c=a.children.map(function(a){return a.resultType});return ih(a.children,eh(b,a,c),b).concat(a.Da.L)}}),new X("!=",V,{priority:80,resultType:"b",F:function(a,b){return kh(a,b,function(a){return a[0]!==a[1]?1:0})},L:[32779],v:function(a,b){var c=a.children.map(function(a){return a.resultType});return ih(a.children,eh(b,a,c),b).concat(a.Da.L)}}),
new X("<",V,{priority:80,resultType:"b",F:function(a,b){return kh(a,b,function(a){return a[0]<a[1]?1:0})},L:[32782],v:function(a,b){var c=a.children.map(function(a){return a.resultType});return ih(a.children,eh(b,a,c),b).concat(a.Da.L)}}),new X("<=",V,{priority:80,resultType:"b",F:function(a,b){return kh(a,b,function(a){return a[0]<=a[1]?1:0})},L:[32783],v:function(a,b){var c=a.children.map(function(a){return a.resultType});return ih(a.children,eh(b,a,c),b).concat(a.Da.L)}}),new X(">",V,{priority:80,
resultType:"b",F:function(a,b){return kh(a,b,function(a){return a[0]>a[1]?1:0})},L:[32780],v:function(a,b){var c=a.children.map(function(a){return a.resultType});return ih(a.children,eh(b,a,c),b).concat(a.Da.L)}}),new X(">=",V,{priority:80,resultType:"b",F:function(a,b){return kh(a,b,function(a){return a[0]>=a[1]?1:0})},L:[32781],v:function(a,b){var c=a.children.map(function(a){return a.resultType});return ih(a.children,eh(b,a,c),b).concat(a.Da.L)}}),new X("&",V,{priority:110,F:function(a,b){return kh(a,
b,function(a){return a[0]&a[1]})},L:[32777]}),new X("|",V,{priority:90,F:function(a,b){return kh(a,b,function(a){return a[0]|a[1]})},L:[32775]}),new X("^",V,{priority:100,F:function(a,b){return kh(a,b,function(a){return a[0]^a[1]})},L:[32776]}),new X("&&",V,{priority:60,oa:dh,F:function(a,b){return kh(a,b,function(a){return a[0]&&a[1]?1:0})},L:[32785],v:function(a,b){var c=a.children[0].v(b).concat([16384|b.xc,12288|b.xc,4096,40960|Rf.indexOf("eq"),4,12288|b.xc,36864]);$f(b,c);a=fh(a.children[1],
a.children[0].resultType,b).F(b);c=c.concat(a.v(b));ag(b,c);return c}}),new X("||",V,{priority:50,oa:dh,F:function(a,b){return kh(a,b,function(a){return a[0]||a[1]?1:0})},L:[32784],v:function(a,b){var c=a.children[0].v(b).concat([16384|b.xc,12288|b.xc,4096,40960|Rf.indexOf("ne"),4,12288|b.xc,36864]);$f(b,c);a=fh(a.children[1],a.children[0].resultType,b).F(b);c=c.concat(a.v(b));ag(b,c);return c}}),new X("?",V,{priority:40,oa:function(a,b,c){return c[1]},F:function(a){if(!(a.children[1]instanceof U)||
0==a.children[1].Da||":"!==a.children[1].Da.name)throw"missing else part in conditional expression "+Q(a.head);return a.children[0]instanceof S?a.children[1].children[a.children[0].n?0:1]:a},v:function(a,b){var c=Yg(a.children[0],b);$f(b,c);c=c.concat(a.children[1].children[0].v(b)).concat(36864);ag(b,c);$f(b,c);c=c.concat(a.children[1].children[1].v(b));ag(b,c);return c}}),new X(":",V,{priority:41,oa:dh,F:function(a,b){a.children[1]=fh(a.children[1],a.children[0].resultType,b);return a},v:function(a){throw"unexpected colon outside conditional expression "+
Q(a.head);}}),new X("=",V,{priority:rg,oa:dh,F:hh}),new X(",",V,{priority:25,oa:function(a,b){return b[1]},F:function(a){a.children[0].ub=!1;return a}}),new X("false",3,{resultType:"b",F:function(a,b){return kh(a,b,function(){return 0})},L:[4096]}),new X("true",3,{resultType:"b",F:function(a,b){return kh(a,b,function(){return 1})},L:[4097]})];w=Lf.prototype;
w.Tg=function(){for(;this.b<this.K;)if(" "===this.m[this.b]||"\t"===this.m[this.b])this.b++,this.Ga++;else if("\n"===this.m[this.b])this.b++,this.Ga=0,this.line++;else if("\r"===this.m[this.b])this.b++;else if("/*"===this.m.slice(this.b,this.b+2))for(this.b+=2,this.Ga+=2;this.b<this.K&&"*/"!==this.m.slice(this.b-2,this.b);)"\n"===this.m[this.b]?(this.Ga=0,this.line++):"\r"!==this.m[this.b]&&this.Ga++,this.b++;else if("//"===this.m.slice(this.b,this.b+2))for(;this.b<this.K&&"\n"!==this.m[this.b];)this.b++,
this.Ga++;else break};w.Cf=function(a){return zb.prototype.Cf.call(this,a||ch)};w.Ng=function(){this.C.forEach(function(a,b){a instanceof jg&&("def"===a.name||0<=["int","bool","fixed","void"].indexOf(a.name))&&this.C[b+1]instanceof ig&&this.C[b+2]instanceof jg&&"("===this.C[b+2].name&&this.Yg.push(this.C[b+1].name)},this)};
function lh(a,b){switch(a.name){case "var":case "def":return b||Vf;case "void":return"v";case "int":return Vf;case "bool":return"b";case "fixed":return T;default:throw"internal";}}function gh(a){switch(a){case Vf:return"int";case T:return"fixed";case "b":return"bool";default:return""}}function mh(a){return Z(a,0,"int")||Z(a,0,"bool")||Z(a,0,"fixed")}
w.Gg=function(){function a(){var a=[];for(this.l++;;){d=this.C[this.l];this.l++;if(!Rg(this,0,jg))throw"syntax error "+Q(c);switch(this.C[this.l].name){case "[":if(Z(this,1,"]")){this.l+=2;if(!Z(this,0,"="))throw"missing size or initial value in array declaration"+Q(this.C[this.l-2]);f=new U(this.C[this.l],V,Qg(this,"=",V),[new pg(d)]);this.l++;f.children.push(Sg(this,25));f.resultType=lh(c,f.children[1].resultType);f.children[1].Ta(this);f.ub=!1;var b=new U(new jg(this.C[this.l].Fd,this.C[this.l].kd,
this.C[this.l].hd,"size"),0,Qg(this,"size",0),[f.children[1]]);a.push(new Eg(c,d,f.resultType,[b],f))}else b=Tg(this,!0),Z(this,0,"=")?(f=new U(this.C[this.l],V,Qg(this,"=",V),[new pg(d)]),this.l++,f.children.push(Sg(this,25)),f.resultType=lh(c,f.children[1].resultType),f.ub=!1,a.push(new Eg(c,d,f.resultType,b,f))):a.push(new Eg(c,d,lh(c),b));break;case "=":f=new U(this.C[this.l],V,Qg(this,"=",V),[new pg(d)]);this.l++;f.children.push(Sg(this,25));f.resultType=lh(c,f.children[1].resultType);f.ub=!1;
f=f.F(this);a.push(new Eg(c,d,f.resultType,null,f));break;default:a.push(new Eg(c,d,lh(c)))}if(Z(this,0,","))this.l++;else{if(Z(this,0,";"))return this.l++,a;throw"missing semicolon "+Q(this.C[this.l]);}}}function b(){var a=lh(c);d=this.C[this.l+1];this.l+=3;var b=[];if(!Z(this,0,")"))for(;;){var e=Vf;mh(this)&&(e=lh(this.C[this.l]),this.l++);if(!Rg(this,0,ig))throw"bad function definition argument "+Q(this.C[this.l]);var f=this.C[this.l].name,g=[],h=!1;this.l++;Z(this,0,"[")&&(h=!0,g=Tg(this,!0));
b.push({name:f,type:e,ih:g,size:1,w:[],Rc:h});if(Z(this,0,","))this.l++;else if(Z(this,0,")"))break;else throw"syntax error in function definition "+Q(this.C[this.l]);}this.l++;if(!Z(this,0,"{"))throw"block expected after function header "+Q(this.C[this.l]);this.l++;return new nh(c,d.name,a,b)}if(this.l>=this.C.length)throw"no more tokens";var c=this.C[this.l];if(this.C[this.l]instanceof jg)switch(c.name){case "const":if(!Rg(this,1,ig)||!Z(this,2,"="))throw'syntax error for "const" '+Q(c);var d=this.C[this.l+
1];this.l+=3;var f=Sg(this,25);f=f.F(this);if(!(f instanceof S))throw"non-constant expression in constant definition "+Q(this.C[this.l]);if(!Z(this,0,";"))throw"missing semicolon "+Q(c);this.l++;return[new Dg(c,d.name,f)];case "int":case "bool":case "fixed":if(!Rg(this,1,ig))throw'unexpected token after "'+c.name+'" '+Q(c);return Z(this,2,"(")?[b.call(this)]:a.call(this);case "void":return[b.call(this)];case "if":this.l++;var e=Tg(this);if(1!==e.length)throw'bad condition in "if" statement '+Q(this.C[this.l]);
var h=new Gg(c,e[0]);Z(this,0,"{")?this.l++:h.ua=!0;return[h];case "when":this.l++;e=Tg(this);if(1!==e.length)throw'bad condition in "when" statement '+Q(this.C[this.l]);if(!Z(this,0,"{"))throw'block expected after "when" statement '+Q(this.C[this.l]);this.l++;return[new Jg(c,e[0])];case "switch":this.l++;e=Tg(this);if(1!==e.length)throw'bad expression in "switch" statement '+Q(this.C[this.l]);if(!Z(this,0,"{"))throw'block expected after "switch" statement '+Q(this.C[this.l]);this.l++;return[new oh(c,
e[0])];case "case":this.l++;f=Sg(this);if(!Z(this,0,":"))throw'missing colon after "case" '+Q(this.C[this.l]);this.l++;return[new ph(c,f)];case "default":if(!Z(this,1,":"))throw'missing colon after "default" '+Q(this.C[this.l]);this.l+=2;return[new ph(c,null)];case "goto":if(!Rg(this,1,ig))throw'missing label after "goto" '+Q(this.C[this.l]);d=this.C[this.l+1];this.l+=2;return[new qh(c,d.name)];case "while":this.l++;e=Tg(this);if(1!==e.length)throw'bad condition in "while" statement '+Q(this.C[this.l]);
if(Z(this,0,";"))return this.l++,[new rh(c,e[0])];if(!Z(this,0,"{"))throw'block expected after "while" statement '+Q(this.C[this.l]);this.l++;return[new sh(c,e[0])];case "do":if(!Z(this,1,"{"))throw'block expected after "do" statement '+Q(this.C[this.l]);this.l+=2;return[new th(c)];case "for":if(!Z(this,1,"("))throw'"for" syntax error '+Q(c);this.l+=2;d=null;var g=Vf;if(Z(this,0,";"))f=null;else{if(Z(this,0,"var")||mh(this)){if(!Rg(this,1,ig))throw'bad variable declaration in "for" statement '+Q(this.C[this.l]);
g=lh(this.C[this.l]);this.l++;d=this.C[this.l]}f=Sg(this);if(!Z(this,0,";"))throw'semicolon expected in "for" statement '+Q(this.C[this.l]);}this.l++;if(Z(this,0,";"))h=null;else if(h=Sg(this),!Z(this,0,";"))throw'semicolon expected in "for" statement '+Q(this.C[this.l]);this.l++;if(Z(this,0,")"))e=null;else if(e=Sg(this),!Z(this,0,")"))throw'semicolon expected in "for" statement '+Q(this.C[this.l]);this.l++;if(!Z(this,0,"{"))throw'block expected after "for" statement '+Q(this.C[this.l]);this.l++;
return[new uh(c,d,g,f,h,e)];case ";":return this.l++,[new vh(c)];case "{":return this.l++,[new wh(c)];case "}":this.l++;if(Z(this,0,"else")){this.l++;if(Z(this,0,"if")){this.l++;e=Tg(this);if(1>e.length)throw'empty condition in "if" statement '+Q(this.C[this.l]);1<e.length&&(h=new tg(c),h.children=e.slice(0,-1).map(function(a){a instanceof U&&(a.ub=!1);return a}),e=e.slice(-1));if(!Z(this,0,"{"))throw'block expected after "if" statement '+Q(this.C[this.l]);this.l++;return[new Hg(c,e[0])]}if(!Z(this,
0,"{"))throw'block expected after "else" statement '+Q(this.C[this.l]);this.l++;return[new Ig(c)]}return[new Og(c)];case "else":throw'unexpected "else" '+Q(this.C[this.l]);case "onevent":if(!Rg(this,1,ig))throw'unexpected token after "onevent" '+Q(c);if(!Z(this,2,"{"))throw'block expected after "onevent" statement '+Q(this.C[this.l]);d=this.C[this.l+1];this.l+=3;return[new xh(c,d.name)];case "return":this.l++;Z(this,0,";")?f=null:f=Sg(this);if(!Z(this,0,";"))throw"missing semicolon "+Q(c);this.l++;
return[new yh(c,f)];case "break":d=null;Rg(this,1,ig)&&(d=this.C[this.l+1],this.l++);if(!Z(this,1,";"))throw"missing semicolon "+Q(c);this.l+=2;return[new zh(c,!1,d?d.name:null)];case "continue":d=null;Rg(this,1,ig)&&(d=this.C[this.l+1],this.l++);if(!Z(this,1,";"))throw"missing semicolon "+Q(c);this.l+=2;return[new zh(c,!0,d?d.name:null)]}if(Rg(this,0,ig)&&Z(this,1,"(")&&(d=this.C[this.l],Wf(this.qa,d.name)))return this.l++,[new Mg(c,d.name,Tg(this))];if(Rg(this,0,ig)&&Z(this,1,":"))return d=this.C[this.l],
this.l+=2,[new Ah(c,d.name)];f=Sg(this);f.ub=!1;if(!Z(this,0,";"))throw"missing semicolon "+(this.l<this.C.length?Q(this.C[this.l]):"eof");this.l++;f=f.F(this);return[new Fg(f)]};
w.Re=function(a){if(a instanceof nh){for(var b=0;b<a.B.length;b++)a.B[b].size=1,a.B[b].w=a.B[b].ih.map(function(c){c=c.F(this);if(!(c instanceof S))throw"non-constant expression in argument dimension "+Q(c.head);if(0>=c.n||Math.round(c.n)!==c.n)throw"bad value for argument dimension "+Q(c.head);a.B[b].size*=c.n;return c.n},this),this.Id(a.B[b].name,a.B[b].size,a.B[b].w,this.Pa,a.B[b].type,a.B[b].Rc),this.Pa+=a.B[b].Rc?1:a.B[b].size;a.Ra[1]={$a:this.$a.slice(),labels:this.labels.slice()}}else a instanceof
uh?a.ha&&(this.Id(a.ha.name,1,[1],this.Pa,a.Na),this.Pa+=1,a.Ra[1]={$a:this.$a.slice(),labels:this.labels.slice()}):zb.prototype.Re.call(this,a)};w.Vd=function(){this.$a=this.ng;this.labels=this.mg};w.wa=function(a){a&&(this.$a=a.$a,this.labels=a.labels)};w.getContext=function(){return{$a:this.$a,labels:this.labels.slice()}};function Bh(a,b,c,d,f,e,h){Uf.call(this,a,b,c,d,f);this.Ab=e;this.Rc=h||!1}Bh.prototype=Object.create(Uf.prototype);w=Bh.prototype;w.constructor=Bh;
w.wd=function(a,b){return this.Ab?this.Rc?[12288|a.u,20480|this.offset,a.qa.b,20480|(b||0),a.qa.b]:[12288|a.u,20480|this.offset+(b||0),a.qa.b]:[12288|this.offset+(b||0)]};w.kf=function(a,b){return this.Ab?this.Rc?[12288|a.u,20480|this.offset,a.qa.b,24576|(b||0),a.qa.b]:[12288|a.u,24576|this.offset+(b||0),a.qa.b]:[16384|this.offset+(b||0)]};w.Ie=function(a){return this.Ab?this.Rc?[12288|a.u,20480|this.offset,a.qa.b,32770,20480,a.qa.b]:[12288|a.u,32770,20480|this.offset,a.qa.b]:[20480|this.offset,this.size]};
w.Kf=function(a){return this.Ab?this.Rc?[12288|a.u,20480|this.offset,a.qa.b,32770,24576,a.qa.b]:[12288|a.u,32770,24576|this.offset,a.qa.b]:[24576|this.offset,this.size]};Lf.prototype.Id=function(a,b,c,d,f,e){this.$a.push(new Bh(a,b,c,d,f,this.Ab,e))};function Ch(a){U.call(this,a,4,null)}Ch.prototype=Object.create(U.prototype);Ch.prototype.constructor=Ch;w=Lf.prototype;
w.Bg=function(a){var b=new Ch(a,this.Ab,this.Pa);b.Da={oa:function(b,d){var c;a:{for(c=0;c<b.jf.length;c++)if(b.jf[c].Jf===a.name){c=b.jf[c];break a}c=null}return c?c.resultType:(c=cg(b,a.name))&&c.oa?c.oa(b,c,d):Vf}};return b};
w.pg=function(){this.Pa=this.qa.Pa;this.Ab=!1;for(var a=[],b=0;b<this.h.length;b++){if(0<=[Og,Hg,Ig].indexOf(this.h[b].constructor)){if(0===a.length)throw"unexpected end of block "+Q(this.h[b].head);var c=a.pop();this.Pa=c.Pa;this.Ab=c.Ab;c.qh.Ra[0]={$a:this.$a.slice(),labels:this.labels.slice()};this.$a.splice(c.th);this.labels.pop();0===a.length&&(this.ua=lg)}0<=[Gg,Jg,oh,sh,wh,uh,xh,nh,Hg,Ig].indexOf(this.h[b].constructor)&&(a.push({Pa:this.Pa,Ab:this.Ab,th:this.$a.length,qh:this.h[b]}),this.labels.push([]),
this.h[b]instanceof nh&&(this.Ab=!0,this.ua=this.h[b].resultType,this.Pa=0));this.Re(this.h[b]);if(this.h[b]instanceof Ah){c=this.h[b].label;for(var d=this.labels.length-1,f=0;f<this.labels[d].length;f++)if(this.labels[d][f].label===c)throw'duplicate label "'+c+'"';this.labels[d].push({label:c})}}this.ng=this.$a.slice();this.mg=this.labels};
w.Mg=function(){for(var a=1;a<this.h.length;)this.h[a]instanceof rh&&this.h[a-1]instanceof Og?this.h.splice(a-1,1):a++;this.h.forEach(function(a){a instanceof nh&&(this.jf.push(a),this.ua=a.resultType)},this);for(a=0;a<this.h.length-1;a++)this.h[a]instanceof Ah&&(this.h[a+1]instanceof sh?this.h[a+1].label=this.h[a].label:this.h[a+1]instanceof th?this.h[a+1].label=this.h[a].label:this.h[a+1]instanceof uh?this.h[a+1].label=this.h[a].label:this.h[a+1]instanceof oh&&(this.h[a+1].label=this.h[a].label))};
w.Og=function(){for(var a=0;a<this.h.length;a++)(this.h[a]instanceof xh||this.h[a]instanceof nh)&&this.o.push(this.h[a])};function Dh(a,b){for(var c=a.length-1;0<=c;c--)for(var d=a[c].length-1;0<=d;d--)if(a[c][d].label===b)return a[c][d];return null}
w.v=function(){this.bb=[];this.Vd();this.Yb=[];this.xc=this.oc=this.qc=this.qa.b-2;this.u=this.xc+1;this.og=[];var a=this.o.map(function(a){this.Oa=0;this.wa(a.Ra[0]);this.Of=a instanceof Bg||a instanceof nh;this.Ab=a instanceof nh;this.Yb=[];a=a.v(this,!0);$g(a);return{Kd:a,mapping:this.Yb}},this);if(0<this.bb.length)throw"internal";for(var b=0,c=0;c<this.o.length;c++)this.o[c]instanceof Ag&&b++;var d=[],f={},e=[];this.Yb=[];for(c=0;c<this.o.length;c++){var h=1+2*b+e.length;this.o[c]instanceof xh||
this.o[c]instanceof Ag?(d.push({id:Yf(this.qa,this.o[c].ff),offset:e.length}),e=e.concat(a[c].Kd)):this.o[c]instanceof Bg?(f[this.o[c].Wg]=e.length,e=e.concat(a[c].Kd)):this.o[c]instanceof nh&&(f[this.o[c].Jf]=e.length,e=e.concat(a[c].Kd));this.Yb=this.Yb.concat(a[c].mapping.map(function(a){return new Tf(a.Ug,a.line,a.Ga,a.Sb+h)}))}a=[1+2*d.length];for(c=0;c<d.length;c++)a=a.concat(d[c].id,1+2*d.length+d[c].offset);for(c=0;c<e.length;c++)if("string"===typeof e[c]){if(void 0===f[e[c]])throw Eh(e[c]),
'unknown function "'+e[c]+'"';e[c]=53248|f[e[c]]+a.length}return a.concat(e)};
w.zg=function(a){for(var b=a.head.name,c=0;c<this.o.length;c++)if(this.o[c]instanceof nh&&this.o[c].Jf===b){if(a.children.length!==this.o[c].B.length)throw"wrong number of arguments "+Q(a.head);b=a.ub?[b,12288|this.xc]:[b];this.Ab?0<this.Pa&&(b=[12288|this.u,4096|this.Pa,32770,16384|this.u].concat(b).concat(12288|this.u,4096|this.Pa,32771,16384|this.u)):b=[4096|this.Pa,16384|this.u].concat(b);for(var d=[],f=0;f<a.children.length;f++){if(this.o[c].B[f].size!==a.children[f].ob)throw"incompatible size "+
Q(a.children[f].head);if(this.o[c].B[f].Rc){if(!(a.children[f]instanceof pg))throw"variable reference expected "+Q(a.children[f].head);if(this.o[c].B[f].type!==a.children[f].resultType)throw"variable reference type mismatch "+Q(a.children[f].head);}if(this.o[c].B[f].Rc){var e=bg(this,a.children[f]);d=d.concat(e.Ab?e.Rc?[12288|this.u,20480|e.offset,this.qa.b]:[12288|this.u,4096|e.offset,32770]:[4096|e.offset]).concat(this.Ab?[12288|this.u,24576|f+this.Pa,this.qa.b]:16384|f+this.Pa)}else a.children[f]=
fh(a.children[f],this.o[c].B[f].type,this).F(this),d=d.concat(a.children[f].v(this)).concat(this.qb(a.children[f].resultType,this.o[c].B[f].type)).concat(this.Ab?[12288|this.u,24576|f+this.Pa,this.qa.b]:16384|f+this.Pa)}return d.concat(b)}return null};function Fh(a){a=a.trim();if(""===a)return!1;var b=["#","//","/*"].map(function(b){b=a.indexOf(b);return 0>b?a.length:b}).sort(function(a,b){return a-b})[0];return b<a.length?"#"!==a[b]:/[;{]/.test(a)}
og.prototype.v=function(a){return Wg(Math.round(this.n*a.sb))};function wh(a){W.call(this,a,3)}wh.prototype=Object.create(W.prototype);wh.prototype.constructor=wh;wh.prototype.F=function(a){mg(this.children,a);return this};wh.prototype.v=function(a){var b=a.getContext();yg(this,a);a.wa(this.Ra[0]);var c=R.prototype.v.call(this,a);a.wa(b);return c};function vh(a){W.call(this,a)}vh.prototype=Object.create(W.prototype);vh.prototype.constructor=vh;vh.prototype.v=function(){return[]};
function sh(a,b){Kg.call(this,a,b);this.label=null}sh.prototype=Object.create(Kg.prototype);sh.prototype.constructor=sh;sh.prototype.v=function(a){if(null==this.Ha&&0===this.children.length)return[];var b=a.getContext();yg(this,a);var c=[],d=a.Oa;a.Na.push({});null!=this.Ha&&(c=Yg(this.Ha,a));$f(a,c);a.wa(this.Ra[0]);this.children.forEach(function(b){a.Oa=d+c.length;c=c.concat(b.v(a))});c=c.concat(36864|-c.length&4095);ag(a,c);Gh(c,0,c.length,this.label);a.Na.pop();a.wa(b);return c};
function th(a){W.call(this,a,3);this.label=this.Ha=null}th.prototype=Object.create(W.prototype);th.prototype.constructor=th;th.prototype.Kg=function(a){if(!(a instanceof rh))throw'unexpected closing statement for "do"';this.Ha=a.Ha};
th.prototype.v=function(a){if(null==this.Ha&&0===this.children.length)return[];var b=a.getContext();yg(this,a);var c=[],d=a.Oa;a.Na.push({});a.wa(this.Ra[0]);this.children.forEach(function(b){a.Oa=d+c.length;c=c.concat(b.v(a))});null!=this.Ha&&(c=c.concat(Yg(new U(new jg(this.Ha.head.Fd,this.Ha.head.kd,this.Ha.head.hd,"not"),0,Qg(a,"!",0),[this.Ha]),a)),$f(a,c),ag(a,c,0));Gh(c,0,c.length,this.label);a.Na.pop();a.wa(b);return c};function rh(a,b){W.call(this,a,5);this.Ha=b}rh.prototype=Object.create(W.prototype);
rh.prototype.constructor=rh;function uh(a,b,c,d,f,e){W.call(this,a,3);d&&(d.ub=!1);e&&(e.ub=!1);this.ha=b;this.Na=c;this.h=d;this.b=f;this.m=e;this.label=null;this.P=[]}uh.prototype=Object.create(W.prototype);w=uh.prototype;w.constructor=uh;w.Ta=function(a){R.prototype.Ta.call(this,a);this.h&&this.h.Ta(a);this.b&&this.b.Ta(a);this.m&&this.m.Ta(a)};w.F=function(a){this.h&&(this.h=this.h.F(a));this.b&&(this.b=this.b.F(a));this.m&&(this.m=this.m.F(a));mg(this.children,a);return this};
w.Ud=function(a,b){this.P.push(b)};
w.v=function(a){var b=a.getContext();yg(this,a);a.wa(this.Ra[1]);var c=a.Oa,d=this.h?this.h.v(a):[];a.Na.push({});var f=d.length;this.b&&(d=d.concat(Yg(this.b,a)),$f(a,d));a.wa(this.Ra[0]);for(var e=0;e<this.children.length;e++)a.Oa=c+d.length,d=d.concat(this.children[e].v(a));a.wa(this.Ra[1]);e=d.length;a.Oa=c+d.length;kg(a,this.P[0]);this.m&&(d=d.concat(this.m.v(a)));d=d.concat(36864|f-d.length&4095);this.b&&ag(a,d);Gh(d,e,d.length,this.label);a.Na.pop();a.wa(b);return d};
function zh(a,b,c){W.call(this,a);this.K=b;this.label=c}zh.prototype=Object.create(W.prototype);zh.prototype.constructor=zh;function Hh(a,b){zg.call(this,a,b)}Hh.prototype=Object.create(zg.prototype);Hh.prototype.constructor=Hh;function Gh(a,b,c,d){for(var f=0;f<a.length;f++)if(a[f]instanceof Hh){var e=a[f].ka.label;if(null==e||e===d)a[f]=a[f].ka.K?36864|b-f&4095:36864|c-f&4095}}
function Eh(a){if(a instanceof Hh){var b=a.ka.label;if(null!=b)throw"unknown "+(a.ka.K?"continue":"break")+' label "'+b+'"'+Q(a.ka.head);throw'unexpected "'+(a.ka.K?"continue":"break")+'" '+Q(a.ka.head);}}zh.prototype.v=function(a){if(0===a.Na.length)throw(this.K?'"continue"':'"break"')+" outside loop "+Q(this.head);yg(this,a);return[new Hh(a,this)]};function oh(a,b){W.call(this,a,3);this.o=b;this.label=null}oh.prototype=Object.create(W.prototype);oh.prototype.constructor=oh;
oh.prototype.v=function(a){var b=a.Oa,c=this.o.v(a).concat(16384|a.xc),d=a.getContext();a.wa(this.Ra[0]);var f=!(this.children[0]instanceof ph);f&&(c=c.concat(36864),$f(a,c));a.Na.push({});for(var e=!1,h=0;h<this.children.length;)if(a.Oa=b+c.length,this.children[h]instanceof ph){for(var g=[],k=!1;h<this.children.length&&this.children[h]instanceof ph;){if(null!=this.children[h].o){var m=this.children[h].o.F(a);if(!(m instanceof S))throw'non-constant expression in "case" '+Q(this.children[h].head);
g.push(m.n)}else k=!0;h++}k?f&&(ag(a,c),f=!1):(1===g.length?(e&&(c=c.concat(36869)),f&&ag(a,c),c=c.concat(12288|a.xc).concat(Wg(g[0])).concat(40960|Rf.indexOf("eq"),0)):(e&&(c=c.concat(36864|4*g.length+1)),f&&ag(a,c),g.forEach(function(b,d){c=c.concat(12288|a.xc).concat(Wg(b)).concat(40960|Rf.indexOf("ne"),4*(g.length-d)-1)}),c=c.concat(36864)),$f(a,c),f=!0);e=!0}else c=c.concat(this.children[h].v(a)),e=!(this.children[h]instanceof zh)&&!(this.children[h]instanceof yh),h++;Gh(c,-1,c.length,this.label);
a.Na.pop();a.wa(d);return c};function ph(a,b){W.call(this,a);this.o=b}ph.prototype=Object.create(W.prototype);ph.prototype.constructor=ph;ph.prototype.v=function(){throw(this.o?'"case"':'"default"')+" outside switch "+Q(this.head);};function Ah(a,b){W.call(this,a);this.label=b}Ah.prototype=Object.create(W.prototype);Ah.prototype.constructor=Ah;Ah.prototype.v=function(a){a.label=this.label;Dh(a.labels,this.label).Zg=a.Oa;return[]};function qh(a,b){W.call(this,a);this.label=b}qh.prototype=Object.create(W.prototype);
qh.prototype.constructor=qh;function Ih(a,b,c){zg.call(this,a,b);this.labels=c}Ih.prototype=Object.create(zg.prototype);Ih.prototype.constructor=Ih;Ih.prototype.v=function(a){var b=Dh(this.labels,this.ka.label);if(null===b)throw'unknown label "'+this.ka.label+'" '+Q(this.ka.head);return 36864|b.Zg-a&4095};qh.prototype.v=function(a){return[new Ih(a,this,a.labels.slice())]};function xh(a,b){W.call(this,a,3);this.ff=b}xh.prototype=Object.create(W.prototype);xh.prototype.constructor=xh;
xh.prototype.F=function(a){mg(this.children,a);return this};xh.prototype.v=function(a,b){if(b){b=a.getContext();yg(this,a);a.wa(this.Ra[0]);var c=R.prototype.v.call(this,a).concat(0);a.wa(b);return c}return[]};function nh(a,b,c,d){W.call(this,a,3);this.Jf=b;this.resultType=c;this.B=d}nh.prototype=Object.create(W.prototype);nh.prototype.constructor=nh;nh.prototype.Jg=function(a){a.ua=this.resultType};nh.prototype.F=function(a){mg(this.children,a);return this};
nh.prototype.v=function(a,b){if(b){b=a.getContext();yg(this,a);a.wa(this.Ra[0]);var c=R.prototype.v.call(this,a).concat(57344);a.wa(b);return c}return[]};function yh(a,b){W.call(this,a);b&&this.children.push(b)}yh.prototype=Object.create(W.prototype);yh.prototype.constructor=yh;
yh.prototype.Ud=function(a){if(a.ua===lg)throw'"return" outside function definition '+Q(this.head);if("v"===a.ua&&0<this.children.length)throw"unexpected return value in void function "+Q(this.head);if("v"!==a.ua&&0===this.children.length)throw"missing return value in non-void function "+Q(this.head);0<this.children.length&&(this.children[0]=fh(this.children[0],a.ua,a).F(a))};
yh.prototype.v=function(a){yg(this,a);var b=[];0<this.children.length&&(b=this.children[0].v(a).concat(a.qb(this.children[0].resultType,a.ua)).concat(16384|a.xc));return b.concat(57344)};var Mf=[{name:"abs",bd:1,oa:function(a,b){return b[0]},He:function(){return!0},Nb:function(a,b,c,d){return[12288|d,28673]}},{name:"atan2",bd:2,me:1,oa:function(){return T},He:function(a){return null!=Wf(a,"math.atan2")},Nb:function(a,b,c,d){return(c[0]===T&&c[1]!==T?[12288|d+1,4096|a.sb,32772,16384|d+1]:c[0]!==T&&c[1]===T?[12288|d,4096|a.sb,32772,16384|d]:[]).concat([4097,4096|d+1,4096|d,4096|d+2,49152|Wf(b,"math.atan2").id,12288|d+2,4096|Math.floor(32768/(a.sb*Math.PI)),32773])}},{name:"cos",bd:1,
me:1,oa:function(){return T},He:function(a){return null!=Wf(a,"math.cos")},Nb:function(a,b,c,d){return[12288|d,4096|Math.round(32767/((c[0]===T?a.sb:1)*Math.PI)),32772,16384|d,4097,4096|d,4096|d+1,49152|Wf(b,"math.cos").id,12288|d+1,4096|Math.floor(32768/a.sb),32773]}},ah("rand","math.rand",0),{name:"random",bd:0,me:1,oa:function(){return T},He:function(a){return null!=Wf(a,"math.rand")},Nb:function(a,b,c,d){return[4097,4096|d,49152|Wf(b,"math.rand").id,12288|d,28673,4096|Math.floor(32768/a.sb),32773]}},
{name:"stop",bd:0,oa:function(){return"v"},Nb:function(){return[0]}},{name:"sin",bd:1,me:1,oa:function(){return T},He:function(a){return null!=Wf(a,"math.sin")},Nb:function(a,b,c,d){return[12288|d,4096|Math.round(32767/((c[0]===T?a.sb:1)*Math.PI)),32772,16384|d,4097,4096|d,4096|d+1,49152|Wf(b,"math.sin").id,12288|d+1,4096|Math.floor(32768/a.sb),32773]}},{name:"sqrt",bd:1,me:6,oa:function(){return T},Nb:function(a,b,c,d){b=Wg(c[0]===T?a.sb:a.sb*a.sb);return[4096|a.sb,16384|d+1,4106,16384|d+2,12288|
d,16384|d+4].concat(b).concat([16384|d+5,12288|d+1,16384|d+6,4097,4096|d+6,4096|d+5,4096|d+4,4096|d+3,49152|Wf(a.qa,"math.muldiv").id,12288|d+3,12288|d+1,32770,4098,32773,16384|d+1,12288|d+2,4097,32771,16384|d+2,12288|d+2,4096,40960|Rf.indexOf("le"),-(23+b.length)&65535,12288|d+1])}}];var yb={name:"thymio-II",maxVarSize:620,variables:[{name:"_id",size:1},{name:"event.source",size:1},{name:"event.args",size:32},{name:"_fwversion",size:2},{name:"_productId",size:1},{name:"buttons._raw",size:5},{name:"button.backward",size:1},{name:"button.left",size:1},{name:"button.center",size:1},{name:"button.forward",size:1},{name:"button.right",size:1},{name:"buttons._mean",size:5},{name:"buttons._noise",size:5},{name:"prox.horizontal",size:7},{name:"prox.comm.rx._payloads",size:7},{name:"prox.comm.rx._intensities",
size:7},{name:"prox.comm.rx",size:1},{name:"prox.comm.tx",size:1},{name:"prox.ground.ambiant",size:2},{name:"prox.ground.reflected",size:2},{name:"prox.ground.delta",size:2},{name:"motor.left.target",size:1},{name:"motor.right.target",size:1},{name:"_vbat",size:2},{name:"_imot",size:2},{name:"motor.left.speed",size:1},{name:"motor.right.speed",size:1},{name:"motor.left.pwm",size:1},{name:"motor.right.pwm",size:1},{name:"acc",size:3},{name:"temperature",size:1},{name:"rc5.address",size:1},{name:"rc5.command",
size:1},{name:"mic.intensity",size:1},{name:"mic.threshold",size:1},{name:"mic._mean",size:1},{name:"timer.period",size:2},{name:"acc._tap",size:1}],localEvents:[{name:"button.backward"},{name:"button.left"},{name:"button.center"},{name:"button.forward"},{name:"button.right"},{name:"buttons"},{name:"prox"},{name:"prox.comm"},{name:"tap"},{name:"acc"},{name:"mic"},{name:"sound.finished"},{name:"temperature"},{name:"rc5"},{name:"motor"},{name:"timer0"},{name:"timer1"}],nativeFunctions:[{name:"_system_reboot",
args:[]},{name:"_system_settings_read",args:[1,1]},{name:"_system_settings_write",args:[1,1]},{name:"_system_settings_flash",args:[]},{name:"math.copy",args:[-1,-1]},{name:"math.fill",args:[-1,1]},{name:"math.addscalar",args:[-1,-1,1]},{name:"math.add",args:[-1,-1,-1]},{name:"math.sub",args:[-1,-1,-1]},{name:"math.mul",args:[-1,-1,-1]},{name:"math.div",args:[-1,-1,-1]},{name:"math.min",args:[-1,-1,-1]},{name:"math.max",args:[-1,-1,-1]},{name:"math.clamp",args:[-1,-1,-1,-1]},{name:"math.dot",args:[1,
-1,-1,1]},{name:"math.stat",args:[-1,1,1,1]},{name:"math.argbounds",args:[-1,1,1]},{name:"math.sort",args:[-1]},{name:"math.muldiv",args:[-1,-1,-1,-1]},{name:"math.atan2",args:[-1,-1,-1]},{name:"math.sin",args:[-1,-1]},{name:"math.cos",args:[-1,-1]},{name:"math.rot2",args:[2,2,1]},{name:"math.sqrt",args:[-1,-1]},{name:"math.rand",args:[-1]},{name:"_leds.set",args:[1,1]},{name:"sound.record",args:[1]},{name:"sound.play",args:[1]},{name:"sound.replay",args:[1]},{name:"sound.system",args:[1]},{name:"leds.circle",
args:[1,1,1,1,1,1,1,1]},{name:"leds.top",args:[1,1,1]},{name:"leds.bottom.left",args:[1,1,1]},{name:"leds.bottom.right",args:[1,1,1]},{name:"sound.freq",args:[1,1]},{name:"leds.buttons",args:[1,1,1,1]},{name:"leds.prox.h",args:[1,1,1,1,1,1,1,1]},{name:"leds.prox.v",args:[1,1]},{name:"leds.rc",args:[1]},{name:"leds.sound",args:[1]},{name:"leds.temperature",args:[1,1]},{name:"sound.wave",args:[142]},{name:"prox.comm.enable",args:[1]},{name:"sd.open",args:[1,1]},{name:"sd.write",args:[-1,1]},{name:"sd.read",
args:[-1,1]},{name:"sd.seek",args:[1,1]},{name:"_rf.nodeid",args:[1]},{name:"_poweroff",args:[]}]};function Of(a,b){this.qa=a;this.b=b}function Jh(a){var b={};a.qa.Ya.forEach(function(a){b[a.name]=a.offset});b._userdata=a.qa.Pa;b._topdata=a.qa.b;b["_ev.init"]=65535;a.qa.zd.forEach(function(a,d){b["_ev."+a.name]=65534-d});a.qa.Pb.forEach(function(a){b["_nf."+a.name]=a.id});return b}
function Nf(a){for(var b=a.b.split("\n"),c=[],d=Jh(a),f=0;2>f;f++){c=[];var e=null;b.forEach(function(a,b){var g=/^\s*(;.*)?$/.exec(a);if(!g)if(g=/^\s*([\w_.]+:)\s*(;.*)?$/i.exec(a))e=g[1].slice(0,-1),d[e]=c.length;else if(g=/^\s*([\w_.]+:)?\s*([a-z0-9.]+)([-+a-z0-9\s._,=]*)(;.*)?$/i.exec(a)){if(g[1]&&(e=g[1].slice(0,-1),d[e]=c.length),a=g[2],g=g[3].trim(),a){var h=0<g.length?g.split(",").map(function(a){return a.trim().split(/\s+/)}):[];h=[].concat.apply([],h);g=Kh[a];if(void 0==g)throw'Unknown instruction "'+
a+'" (line '+(b+1).toString(10)+")";if(-1!==g.Qb&&(g.Qb||0)!=h.length)throw"Wrong number of arguments (line "+(b+1).toString(10)+")";void 0!==g.code?c=c.concat(g.code):g.Gb&&(a=h.map(function(a){/^[a-z]+=/.test(a)&&(a=a.replace(/^[a-z]+=/,""));return/^(0x[0-9a-f]+|[0-9]+)$/i.test(a)?parseInt(a,0):a}),c=c.concat(g.Gb(c.length,a,e,d,f,b+1)));e&&d[e]!==c.length&&(e=null)}}else throw"Syntax error (line "+(b+1).toString(10)+")";},a)}return c}
function Lh(a,b,c,d){function f(e){if(!c)return 0;if(/^(0x[0-9a-f]+|[0-9]+)$/i.test(e))return parseInt(e,0);if(!b.hasOwnProperty(e))throw'Unknown symbol "'+a+'" (line '+d.toString(10)+")";return b[e]}if("string"===typeof a){for(var e=0,h=!1,g=0;g<a.length;){var k=/^(\+|-|[._a-z0-9]+)/i.exec(a.slice(g));if(null==k)throw"Syntax error (line "+d.toString(10)+")";switch(k[0]){case "+":h=!1;break;case "-":h=!0;break;default:e+=h?-f(k[0]):f(k[0])}g+=k[0].length}return e}return a}
var Kh={dc:{Qb:-1,Gb:function(a,b,c,d,f,e){return b.map(function(a){a=Lh(a,d,1===f,e);return a&65535})}},equ:{Qb:1,Gb:function(a,b,c,d,f,e){if(!c)throw'No label for pseudo-instruction "equ" (line '+e.toString(10)+")";d&&(d[c]=Lh(b[0],d,1===f,e));return[]}},stop:{code:[0]},"push.s":{Qb:1,Gb:function(a,b,c,d,f,e){a=Lh(b[0],d,1===f,e);if(4096<=a||4096<-a)throw"Small integer overflow (line "+e.toString(10)+")";return[4096|a&4095]}},push:{Qb:1,Gb:function(a,b,c,d,f,e){return[8192,Lh(b[0],d,1===f,e)&65535]}},
load:{Qb:1,Gb:function(a,b,c,d,f,e){a=Lh(b[0],d,1===f,e);if(0>a||4096<=a)throw"Data address out of range (line "+e.toString(10)+")";return[12288|a&4095]}},store:{Qb:1,Gb:function(a,b,c,d,f,e){a=Lh(b[0],d,1===f,e);if(0>a||4096<=a)throw"Data address out of range (line "+e.toString(10)+")";return[16384|a&4095]}},"load.ind":{Qb:2,Gb:function(a,b,c,d,f,e){a=Lh(b[0],d,1===f,e);if(0>a||4096<=a)throw"Data address out of range (line "+e.toString(10)+")";b=Lh(b[1],d,1===f,e);return[20480|a&4095,b&65535]}},
"store.ind":{Qb:2,Gb:function(a,b,c,d,f,e){a=Lh(b[0],d,1===f,e);if(0>a||4096<=a)throw"Data address out of range (line "+e.toString(10)+")";b=Lh(b[1],d,1===f,e);return[24576|a&4095,b&65535]}},neg:{code:[28672]},abs:{code:[28673]},bitnot:{code:[28674]},not:{Gb:function(a,b,c,d,f,e){throw"Unary not not implemented in the VM (line "+e.toString(10)+")";}},sl:{code:[32768]},asr:{code:[32769]},add:{code:[32770]},sub:{code:[32771]},mult:{code:[32772]},div:{code:[32773]},mod:{code:[32774]},bitor:{code:[32775]},
bitxor:{code:[32776]},bitand:{code:[32777]},eq:{code:[32778]},ne:{code:[32779]},gt:{code:[32780]},ge:{code:[32781]},lt:{code:[32782]},le:{code:[32783]},or:{code:[32784]},and:{code:[32785]},jump:{Qb:1,Gb:function(a,b,c,d,f,e){return[36864|Lh(b[0],d,1===f,e)-a&4095]}},"jump.if.not":{Qb:2,Gb:function(a,b,c,d,f,e){c=Kh[b[0]];if(void 0==c||void 0==c.code||1!==c.code.length||32768!==(c.code[0]&61440))throw'Unknown op "'+b[0]+'" for jump.if.not (line '+e.toString(10)+")";b=Lh(b[1],d,1===f,e);return[40960|
c.code[0]&255,b-a&65535]}},"do.jump.when.not":{Qb:2,Gb:function(a,b,c,d,f,e){c=Kh[b[0]];if(void 0==c||void 0==c.code||1!==c.code.length||32768!==(c.code[0]&61440))throw'Unknown op "'+b[0]+'" for do.jump.when.not (line '+e.toString(10)+")";b=Lh(b[1],d,1===f,e);return[41216|c.code[0]&255,b-a&65535]}},"do.jump.always":{Qb:2,Gb:function(a,b,c,d,f,e){c=Kh[b[0]];if(void 0==c||void 0==c.code||1!==c.code.length||32768!==(c.code[0]&61440))throw'Unknown op "'+b[0]+'" for do.jump.always (line '+e.toString(10)+
")";b=Lh(b[1],d,1===f,e);return[41728|c.code[0]&255,b-a&65535]}},emit:{Qb:3,Gb:function(a,b,c,d,f,e){a=Lh(b[0],d,1===f,e);if(0>a||4096<=a)throw"Event id out of range (line "+e.toString(10)+")";c=Lh(b[1],d,1===f,e);b=Lh(b[2],d,1===f,e);return[45056|a&4095,c&65535,b&65535]}},callnat:{Qb:1,Gb:function(a,b,c,d,f,e){a=Lh(b[0],d,1===f,e);if(0>a||4096<=a)throw"Native call id out of range (line "+e.toString(10)+")";return[49152|a&4095]}},callsub:{Qb:1,Gb:function(a,b,c,d,f,e){a=Lh(b[0],d,1===f,e);if(0>a||
4096<=a)throw"Subroutine address out of range (line "+e.toString(10)+")";return[53248|a&4095]}},ret:{code:[57344]}};function Mh(a,b,c){this.id=a;this.o=b;if(c instanceof ArrayBuffer)this.h=c;else if(c){for(a=b=0;a<c.length;a++)b="string"===typeof c[a]?b+(1+c[a].length):b+2;b=new ArrayBuffer(b);for(var d=new DataView(b),f=a=0;a<c.length;a++)if("string"===typeof c[a]){d.setUint8(f++,c[a].length);for(var e=0;e<c[a].length;e++)d.setUint8(f++,c[a].charCodeAt(e))}else 32768>c[a]?d.setInt16(f,c[a],!0):d.setUint16(f,c[a],!0),f+=2;this.h=b}else this.h=new ArrayBuffer(0)}
function Nh(a){function b(a){for(var b=[],d=0,e=0;e<a.length;e++)if(a[e]){for(var f=c.getUint8(d),h="",r=0;r<f;r++)h+=String.fromCharCode(c.getUint8(d+1+r));b.push(h);d+=1+f}else b.push(c.getUint16(d,!0)),d+=2;return b}var c=new DataView(a.h);switch(a.id){case Oh:var d=b([!0,!1,!1,!1,!1,!1,!1,!1]);a.nodeName=d[0];a.ee=d[2];a.re=d[3];a.Hd=d[4];break;case Ph:d=b([!1,!0]);a.Pa=d[0];a.P=d[1];break;case Qh:d=b([!0,!0]);break;case Rh:var f=[!0,!0,!1];d=b(f);a.functionName=d[0];a.u=d[2];for(var e=0;e<a.u;e++)f.push(!1),
f.push(!0);d=b(f);a.ea=[];for(e=0;e<a.u;e++)a.ea.push({size:d[3+2*e]-(d[3+2*e]&32768?65536:0),name:d[4+2*e]});break;case Sh:c.getUint16(0,!0);a.Ic=[];for(e=2;e<c.byteLength;e+=2)a.Ic.push(c.getUint16(e,!0));break;case Th:a.b=c.getUint16(0,!0);e=c.getUint16(2,!0);a.flags={flags:e,Ch:0!==(e&1),Hh:0!==(e&2),Dh:0!==(e&4)};break;case Uh:a.b=c.getUint16(2,!0);a.result=c.getUint16(4,!0);break;case Vh:a.m=c.getUint16(0,!0);c.getUint16(2,!0);d=[];for(e=4;e<c.byteLength;e+=2)d.push(c.getUint16(e,!0));a.Kd=
d;break;case Wh:case Xh:case Yh:case Zh:case $h:case ai:case bi:a.m=c.getUint16(0,!0);break;case ci:case di:a.m=c.getUint16(0,!0);a.b=c.getUint16(2,!0);break;case ei:a.m=c.getUint16(0,!0);c.getUint16(2,!0);c.getUint16(4,!0);break;case fi:a.m=c.getUint16(0,!0);c.getUint16(2,!0);d=[];for(e=4;e<c.byteLength;e+=2)d.push(c.getUint16(e,!0));break;case gi:a.version=c.getUint16(0,!0)}}
function hi(a){var b=new ArrayBuffer(6+a.h.byteLength),c=new DataView(b);c.setUint16(0,a.h.byteLength,!0);c.setUint16(2,a.o,!0);c.setUint16(4,a.id,!0);(new Uint8Array(b)).set(new Uint8Array(a.h),6);return b}Mh.prototype.lb=function(){var a=new Mh(this.id,this.o,this.h);Nh(a);return a};Mh.prototype.toString=function(){var a=ii[this.id]||"0x"+this.id.toString(16);a+=" from "+this.o.toString(10);0<=this.m&&(a+=" to "+this.m.toString());return a};
var Oh=36864,Ph=36865,Qh=36866,Rh=36867,Sh=36869,Th=36874,Uh=36875,Vh=40961,Xh=40962,Yh=40963,Zh=40964,$h=40965,ai=40966,bi=40967,ci=40968,di=40969,Wh=40970,ei=40971,fi=40972,gi=40977,ii={36864:"description",36865:"namedVariableDescription",36866:"localEventDescription",36867:"nativeFunctionDescription",36869:"variables",36874:"executionStateChanged",36876:"nodePresent",40960:"getDescription",40961:"setBytecode",40962:"reset",40963:"run",40964:"pause",40965:"step",40966:"stop",40967:"getExecutionState",
40968:"breakpointSet",40969:"breakpointClear",40970:"breakpointClearAll",40971:"getVariables",40972:"setVariables",40976:"getNodeDescription",40977:"listNodes"};function ji(a){this.Sd=a&&a.Sd||54321;this.Ya=a&&a.Ya||[];this.zd=a&&a.zd||[];this.Pb=a&&a.Pb||[];this.ee=a&&a.ee||500;this.re=a&&a.re||200;this.Hd=a&&a.Hd||200;a=[];for(var b=0,c=0;c<this.Ya.length;c++)this.Ya[c].offset=b,a=a.concat(this.Ya[c].T),b+=this.Ya[c].T.length;for(;a.length<this.Hd;)a.push(0);this.Ic=a;this.L=[];this.b=0;this.h=!1;this.m=!0;this.o=!1;this.stack=[];this.P=[];this.write=this.u=this.K=null}
ji.prototype.lb=function(){var a=new ji({Sd:this.Sd,Ya:this.Ya,zd:this.zd,Pb:this.Pb,ee:this.ee,re:this.re,Hd:this.Hd});a.ee=this.ee;a.re=this.re;a.Hd=this.Hd;a.L=this.L.slice();a.b=this.b;a.h=this.h;a.m=this.m;a.o=this.o;a.stack=this.stack.slice();a.P=this.P.slice();return a};
function ki(a,b,c){if(a.K)for(var d=0;d<a.Ya.length;d++)if(a.Ya[d].offset+a.Ya[d].T.length>b&&a.Ya[d].offset<b+c.length)for(var f=0;f<a.Ya[d].T.length;f++)0<=a.Ya[d].offset+f-b&&a.Ya[d].offset+f-b<c.length&&a.K(a.Ya[d].name,f,c[a.Ya[d].offset+f-b],a.Ic[a.Ya[d].offset+f]);c.forEach(function(a,c){this.Ic[b+c]=a},a)}function li(a,b){a:{if(0<a.L.length)for(var c=1;c<a.L[0];c+=2)if(a.L[c]==b){b=a.L[c+1];break a}b=null}null!==b&&(a.h&&(c=new Mh(36872,a.Sd,[a.b]),a.write&&a.write(hi(c))),a.b=b,a.h=!0)}
function mi(a){a.h=!1;a.m=!0;a.o=!1;if(0<a.L.length)for(var b=a.L[0];b<a.L.length;){var c=a.L[b];10==c>>>12&&(a.L[b]&=-513);b+=[1,1,2,1,1,2,2,1,1,1,2,3,1,1,1,1][c>>>12]}a.stack=[];for(b=0;b<a.Ic.length;b++)a.Ic[b]=0;a.ha&&a.ha();li(a,65535)}
function ni(a){function b(a){return 32768<=a?a-65536:a}function c(a){switch(a){case 28672:d.stack.push(-d.stack.pop());break;case 28673:d.stack.push(Math.abs(d.stack.pop()));break;case 28674:d.stack.push(~d.stack.pop());break;case 32768:a=d.stack.pop();d.stack.push(b(d.stack.pop()<<a&65535));break;case 32769:a=d.stack.pop();d.stack.push(d.stack.pop()>>a);break;case 32770:d.stack.push(b(d.stack.pop()+d.stack.pop()&65535));break;case 32771:a=d.stack.pop();d.stack.push(b(d.stack.pop()-a&65535));break;
case 32772:d.stack.push(b(d.stack.pop()*d.stack.pop()&65535));break;case 32773:a=d.stack.pop();d.stack.push(b(Math.trunc(d.stack.pop()/a)&65535));break;case 32774:a=d.stack.pop();d.stack.push(b(d.stack.pop()%a&65535));break;case 32775:d.stack.push(b((d.stack.pop()|d.stack.pop())&65535));break;case 32776:d.stack.push(b((d.stack.pop()^d.stack.pop())&65535));break;case 32777:d.stack.push(b(d.stack.pop()&d.stack.pop()&65535));break;case 32778:d.stack.push(d.stack.pop()===d.stack.pop()?1:0);break;case 32779:d.stack.push(d.stack.pop()!==
d.stack.pop()?1:0);break;case 32780:a=d.stack.pop();d.stack.push(d.stack.pop()>a?1:0);break;case 32781:a=d.stack.pop();d.stack.push(d.stack.pop()>=a?1:0);break;case 32782:a=d.stack.pop();d.stack.push(d.stack.pop()<a?1:0);break;case 32783:a=d.stack.pop();d.stack.push(d.stack.pop()<=a?1:0);break;case 32784:a=d.stack.pop();d.stack.push(d.stack.pop()||a?1:0);break;case 32785:a=d.stack.pop();d.stack.push(d.stack.pop()&&a?1:0);break;default:throw"unknown op 0x"+a.toString(16);}}var d=a,f=a.L[a.b],e=f&4095;
switch(f>>>12){case 0:a.h=!1;break;case 1:a.stack.push(2048<=e?e-4096:e);break;case 2:a.b++;a.stack.push(b(a.L[a.b]));break;case 3:a.stack.push(a.Ic[e]);break;case 4:ki(a,e,[a.stack.pop()]);break;case 5:a.b++;f=a.L[a.b];var h=a.stack.pop();if(h>=f)throw"out of bounds";a.stack.push(a.Ic[e+h]);break;case 6:a.b++;f=a.L[a.b];h=a.stack.pop();if(h>=f)throw"Index out of bounds";ki(a,e+h,[a.stack.pop()]);break;case 9:a.b+=(2048<=e?e-4096:e)-1;break;case 10:var g=f&256;c(32768|f&255);e=0!=a.stack.pop();a.b++;
h=b(a.L[a.b]);if(g){g=a.b-1;if(f&512||!e)a.b+=h-2;a.L[g]=e?a.L[g]|512:a.L[g]&-513}else e||(a.b+=h-2);break;case 11:null(e);break;case 12:if(0>e||e>=a.Pb.length)throw"Native call index out of bounds";var k=a.Pb[e].ea.map(function(){return{p:this.stack.pop()}},a),m=[];a.Pb[e].ea.forEach(function(a,b){k[b].Sg=0===a.size?this.stack.pop():a.size},a);a.Pb[e].ea.forEach(function(a){0>a.size&&void 0===m[-a.size]&&(m[-a.size]=0)},a);m=m.map(function(a){return void 0!==a?this.stack.pop():a},a);a.Pb[e].ea.forEach(function(a,
b){0>a.size&&(k[b].Sg=m[-a.size])},a);var q=k.map(function(a){return this.Ic.slice(a.p,a.p+a.Sg)},a);f=!1;a.u&&(f=a.u(a.Pb[e].name,a,q));f||a.Pb[e].Aa(a,q);k.forEach(function(a,b){ki(this,a.p,q[b])},a);break;case 13:a.stack.push(a.b+1);a.b=e-1;break;case 14:a.b=a.stack.pop()-1;break;case 15:throw"op 0x"+f.toString(16)+" (reserved) not implemented";default:c(f)}a.b++}ji.prototype.ec=function(){for(;this.h&&(ni(this),!this.m););};function oi(a){function b(a){a&=65535;return 32768<=a?a-65536:a}ji.call(this,{Sd:a,Ya:[{name:"_id",T:[0]},{name:"event.source",T:[0]},{name:"event.args",T:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{name:"_fwversion",T:[0,0]},{name:"_productId",T:[0]},{name:"buttons._raw",T:[0,0,0,0,0]},{name:"button.backward",T:[0]},{name:"button.left",T:[0]},{name:"button.center",T:[0]},{name:"button.forward",T:[0]},{name:"button.right",T:[0]},{name:"buttons._mean",T:[0,0,0,0,0]},{name:"buttons._noise",
T:[0,0,0,0,0]},{name:"prox.horizontal",T:[0,0,0,0,0,0,0]},{name:"prox.comm.rx._payloads",T:[0,0,0,0,0,0,0]},{name:"prox.comm.rx._intensities",T:[0,0,0,0,0,0,0]},{name:"prox.comm.rx",T:[0]},{name:"prox.comm.tx",T:[0]},{name:"prox.ground.ambiant",T:[0,0]},{name:"prox.ground.reflected",T:[0,0]},{name:"prox.ground.delta",T:[0,0]},{name:"motor.left.target",T:[0]},{name:"motor.right.target",T:[0]},{name:"_vbat",T:[0,0]},{name:"_imot",T:[0,0]},{name:"motor.left.speed",T:[0]},{name:"motor.right.speed",T:[0]},
{name:"motor.left.pwm",T:[0]},{name:"motor.right.pwm",T:[0]},{name:"acc",T:[0,0,0]},{name:"temperature",T:[0]},{name:"rc5.address",T:[0]},{name:"rc5.command",T:[0]},{name:"mic.intensity",T:[0]},{name:"mic.threshold",T:[0]},{name:"mic._mean",T:[0]},{name:"timer.period",T:[0,0]},{name:"acc._tap",T:[0]},{name:"sd.present",T:[0]}],zd:[{name:"button.backward",description:"Backward button state changed"},{name:"button.left",description:"Left button state changed"},{name:"button.center",description:"Center button state changed"},
{name:"button.forward",description:"Forward button state changed"},{name:"button.right",description:"Right button state changed"},{name:"buttons",description:"Buttons values updated"},{name:"prox",description:"Proximity values updated"},{name:"prox.comm",description:"Data received on the proximity communication"},{name:"tap",description:"Tap detected"},{name:"acc",description:"Accelerometer values updated"},{name:"mic",description:"Microphone above threshold"},{name:"sound.finished",description:"Sound playback finished"},
{name:"temperature",description:"Temperature value updated"},{name:"rc5",description:"RC5 message received"},{name:"motor",description:"Motor timer"},{name:"timer0",description:"Timer 0"},{name:"timer1",description:"Timer 1"}],Pb:[{name:"_system_reboot",ea:[],Aa:function(){}},{name:"_system_settings_read",ea:[],Aa:function(){}},{name:"_system_settings_write",ea:[],Aa:function(){}},{name:"_system_settings_flash",ea:[],Aa:function(){}},{name:"math.copy",ea:[],Aa:function(a,b){for(a=0;a<b[0].length;a++)b[0][a]=
b[1][a]}},{name:"math.fill",ea:[],Aa:function(a,b){for(a=0;a<b[0].length;a++)b[0][a]=b[1][0]}},{name:"math.addscalar",ea:[{name:"r",size:-1},{name:"a",size:-1},{name:"b",size:1}],Aa:function(a,d){for(a=0;a<d[0].length;a++)d[0][a]=b(d[1][a]+d[2][0])}},{name:"math.add",ea:[{name:"r",size:-1},{name:"a",size:-1},{name:"b",size:-1}],Aa:function(a,d){for(a=0;a<d[0].length;a++)d[0][a]=b(d[1][a]+d[2][a])}},{name:"math.sub",ea:[{name:"r",size:-1},{name:"a",size:-1},{name:"b",size:-1}],Aa:function(a,d){for(a=
0;a<d[0].length;a++)d[0][a]=b(d[1][a]-d[2][a])}},{name:"math.mul",ea:[{name:"r",size:-1},{name:"a",size:-1},{name:"b",size:-1}],Aa:function(a,d){for(a=0;a<d[0].length;a++)d[0][a]=b(d[1][a]*d[2][a])}},{name:"math.div",ea:[{name:"r",size:-1},{name:"a",size:-1},{name:"b",size:-1}],Aa:function(a,d){for(a=0;a<d[0].length;a++)d[0][a]=b(Math.trunc(d[1][a]/d[2][a]))}},{name:"math.min",ea:[{name:"r",size:-1},{name:"a",size:-1},{name:"b",size:-1}],Aa:function(a,b){for(a=0;a<b[0].length;a++)b[0][a]=Math.min(b[1][a],
b[2][a])}},{name:"math.max",ea:[{name:"r",size:-1},{name:"a",size:-1},{name:"b",size:-1}],Aa:function(a,b){for(a=0;a<b[0].length;a++)b[0][a]=Math.max(b[1][a],b[2][a])}},{name:"math.clamp",ea:[{name:"r",size:-1},{name:"x",size:-1},{name:"low",size:-1},{name:"high",size:-1}],Aa:function(a,b){for(a=0;a<b[0].length;a++)b[0][a]=Math.min(Math.max(b[1][a],b[2][a]),b[3][a])}},{name:"math.dot",ea:[{name:"r",size:-1},{name:"a",size:-1},{name:"b",size:-1},{name:"shift",size:1}],Aa:function(a,b){for(var c=a=
0;c<b[0].length;c++)a+=b[1][c]*b[2][c];b[0][0]=a/Math.pow(2,b[3][0])}},{name:"math.stat",ea:[{name:"x",size:-1},{name:"min",size:1},{name:"max",size:1},{name:"mean",size:1}],Aa:function(a,b){a=0;b[1][0]=32767;b[2][0]=-32768;for(var c=0;c<b[0].length;c++)b[1][0]=Math.min(b[1][0],b[0][c]),b[2][0]=Math.max(b[2][0],b[0][c]),a+=b[0][c];b[3][0]=a/b[0].length}},{name:"math.argbounds",ea:[{name:"x",size:-1},{name:"argmin",size:1},{name:"argmax",size:1}],Aa:function(a,b){a=-Infinity;for(var c=Infinity,d=0;d<
b[0].length;d++)b[0][d]<c&&(c=b[0][d],b[1][0]=d),b[0][d]>a&&(a=b[0][d],b[2][0]=d)}},{name:"math.sort",ea:[{name:"x",size:-1}],Aa:function(a,b){b[0].sort(function(a,b){return a-b})}},{name:"math.muldiv",ea:[{name:"r",size:-1},{name:"a",size:-1},{name:"b",size:-1},{name:"c",size:-1}],Aa:function(a,d){for(a=0;a<d[0].length;a++)d[0][a]=b(d[1][a]*d[2][a]/d[3][a])}},{name:"math.atan2",description:"Atan2",ea:[{name:"r",size:-1},{name:"y",size:-1},{name:"x",size:-1}],Aa:function(a,b){b[2].forEach(function(a,
c){b[0][c]=Math.round(32767*Math.atan2(b[1][c],a)/Math.PI)})}},{name:"math.sin",description:"Sine",ea:[{name:"r",size:-1},{name:"theta",size:-1}],Aa:function(a,b){b[1].forEach(function(a,c){b[0][c]=Math.round(32767*Math.sin(a*Math.PI/32768))})}},{name:"math.cos",description:"Cosine",ea:[{name:"r",size:-1},{name:"theta",size:-1}],Aa:function(a,b){b[1].forEach(function(a,c){b[0][c]=Math.round(32767*Math.cos(a*Math.PI/32768))})}},{name:"math.rot2",ea:[{name:"r",size:2},{name:"v",size:2},{name:"theta",
size:1}]},{name:"math.sqrt",description:"Square root",ea:[{name:"r",size:-1},{name:"x",size:-1}],Aa:function(a,b){b[1].forEach(function(a,c){b[0][c]=0<a?Math.floor(Math.sqrt(a)):0})}},{name:"math.rand",description:"Pseudo-random number",ea:[{name:"r",size:-1}],Aa:function(a,b){for(a=0;a<b[0].length;a++)b[0][a]=Math.floor(65535.9999*Math.random())-32768}},{name:"_leds.set",ea:[{name:"led",size:1},{name:"br",size:1}],Aa:function(){}},{name:"sound.record",ea:[{name:"n",size:1}],Aa:function(){}},{name:"sound.play",
ea:[{name:"n",size:1}],Aa:function(){}},{name:"sound.replay",ea:[{name:"n",size:1}],Aa:function(){}},{name:"sound.system",description:"Start playing system sound",ea:[{name:"n",size:1}],Aa:function(){}},{name:"leds.circle",description:"Set circular leds",ea:[{name:"l0",size:1},{name:"l1",size:1},{name:"l2",size:1},{name:"l3",size:1},{name:"l4",size:1},{name:"l5",size:1},{name:"l6",size:1},{name:"l7",size:1}],Aa:function(a,b){a.state["leds.circle"]=b.map(function(a){return a[0]});a.cd&&a.cd("leds.circle")}},
{name:"leds.top",description:"Set top RGB led",ea:[{name:"r",size:1},{name:"g",size:1},{name:"b",size:1}],Aa:function(a,b){a.state["leds.top"]=b.map(function(a){return a[0]});a.cd&&a.cd("leds.top")}},{name:"leds.bottom.left",description:"Set bottom-left RGB led",ea:[{name:"r",size:1},{name:"g",size:1},{name:"b",size:1}],Aa:function(a,b){a.state["leds.bottom.left"]=b.map(function(a){return a[0]});a.cd&&a.cd("leds.bottom.left")}},{name:"leds.bottom.right",description:"Set bottom-right RGB led",ea:[{name:"r",
size:1},{name:"g",size:1},{name:"b",size:1}],Aa:function(a,b){a.state["leds.bottom.right"]=b.map(function(a){return a[0]});a.cd&&a.cd("leds.bottom.right")}},{name:"sound.freq",description:"Play frequency",ea:[{name:"Hz",size:1},{name:"ds",size:1}],Aa:function(a,b){console.info(b)}},{name:"leds.buttons",description:"Set buttons leds",ea:[{name:"led 0",size:1},{name:"led 1",size:1},{name:"led 2",size:1},{name:"led 3",size:1}]},{name:"leds.prox.h",description:"Set horizontal proximity leds",ea:[{name:"led 0",
size:1},{name:"led 1",size:1},{name:"led 2",size:1},{name:"led 3",size:1},{name:"led 4",size:1},{name:"led 5",size:1},{name:"led 6",size:1},{name:"led 7",size:1}]},{name:"leds.prox.v",description:"Set vertical proximity leds",ea:[{name:"led 0",size:1},{name:"led 1",size:1}]},{name:"leds.rc",description:"Set rc led",ea:[{name:"led",size:1}]},{name:"leds.sound",description:"Set sound led",ea:[{name:"led",size:1}]},{name:"leds.temperature",description:"Set ntc led",ea:[{name:"red",size:1},{name:"blue",
size:1}]},{name:"sound.wave",description:"Set the primary wave of the tone generator",ea:[{name:"wave",size:142}],Aa:function(){}},{name:"prox.comm.enable",description:"Enable or disable the proximity communication",ea:[{name:"state",size:1}]},{name:"sd.open",description:"Open a file on the SD card",ea:[{name:"number",size:1},{name:"status",size:1}]},{name:"sd.write",description:"Write data to the opened file",ea:[{name:"data",size:-1},{name:"written",size:1}]},{name:"sd.read",description:"Read data from the opened file",
ea:[{name:"data",size:-1},{name:"read",size:1}]},{name:"sd.seek",description:"Seek the opened file",ea:[{name:"position",size:1},{name:"status",size:1}]},{name:"_rf.nodeid"},{name:"_poweroff"}],Hd:620});this.state={};this.cd=null}oi.prototype=Object.create(ji.prototype);oi.prototype.constructor=oi;function pi(){N.call(this);this.Jb=!0;this.m=new oi(9999);var a=this;this.m.cd=function(b){a.ha[b]&&a.ha[b](b,a.m.state[b])};this.m.K=function(b,c,d){switch(b){case "timer.period":a.setTimer(c,.001*d,!0)}};this.m.u=function(b,c,d){switch(b){case "sound.play":return a.ha.sound("sound",{pcm:d[0][0]}),!0}return!1};this.qa=new xb(yb)}pi.prototype=Object.create(N.prototype);pi.prototype.constructor=pi;pi.prototype.reset=function(a){N.prototype.reset.call(this,a);mi(this.m)};
function qi(a,b){b=Xf(a.qa,b);return null==b?null:a.m.Ic.slice(b.offset,b.offset+b.size)}function ri(a,b,c){var d=Xf(a.qa,b);if(null==d)throw"Unknown VM variable "+b;if(c.length!==d.size)throw"Bad size for variable "+b;Array.prototype.splice.apply(a.m.Ic,[d.offset,d.size].concat(c))}
pi.prototype.set=function(a,b){if(this.Jb){N.prototype.set.call(this,a,b);switch(a){case "button.backward":case "button.left":case "button.center":case "button.forward":case "button.right":ri(this,a,[b?1:0]);break;case "prox.ground.delta":ri(this,"prox.ground.delta",b.map(function(a){return 2E3*a}));break;case "prox.horizontal":ri(this,"prox.horizontal",b.map(function(a){return 4E3*a}));break;case "acc":ri(this,"acc",b.map(function(a){return 22*a}));break;default:throw"Unknown variable "+a;}this.ha[a]&&
this.ha[a](a,b)}else N.prototype.set.call(this,a,b)};
pi.prototype.get=function(a){if(this.Jb)switch(a){case "leds.top":return(this.m.state&&this.m.state["leds.top"]||[0,0,0]).map(function(a){return 32<=a?1:0>=a?0:a/32});case "leds.bottom.left":return(this.m.state&&this.m.state["leds.bottom.left"]||[0,0,0]).map(function(a){return 32<=a?1:0>=a?0:a/32});case "leds.bottom.right":return(this.m.state&&this.m.state["leds.bottom.right"]||[0,0,0]).map(function(a){return 32<=a?1:0>=a?0:a/32});case "leds.circle":return(this.m.state&&this.m.state["leds.circle"]||
[0,0,0,0,0,0,0,0]).map(function(a){return 16<=a?1:0});case "motor.left":return qi(this,"motor.left.target")[0]/200;case "motor.right":return qi(this,"motor.right.target")[0]/200;default:return N.prototype.get.call(this,a)}else return N.prototype.get.call(this,a)};pi.prototype.sendEvent=function(a,b){if(this.Jb){if(null!=b)throw"Event arguments not implemented";a=Yf(this.qa,a);li(this.m,a);si(this)}else N.prototype.sendEvent.call(this,a,b)};
pi.prototype.loadCode=function(a,b){"js"===a?(N.prototype.loadCode.call(this,a,b),this.Jb=!1):("asm"===a?(b=new Of(this.qa,b),b=Nf(b)):(b=(a=Fh(b))?new Lf(this.qa,b):new zb(this.qa,b),b.ha=a?Mf:Ab,b=Bb(b)),a=this.m,a.L.splice.apply(a.L,[0,b.length].concat(b)),mi(this.m),si(this),this.Jb=!0)};function si(a){for(var b=0;2E3>b&&a.m.h;b++)ni(a.m)};function If(a,b){a.b=new Mb(a.qb,{ca:a.ca});a.b.Na=function(){null!==a.K&&(a.K=null,ti(a))};var c=null;return new rf({ec:function(b,f){var d=a.G;d.Z.loadCode(b,f);null!==c&&clearInterval(c);d.Z.start(ui());c=setInterval(function(){d.Z.run(ui(),function(a,b){vi(d,a,b)})},10);d.Z.zc=d.paused;ti(a)},Oc:function(){var c=new pi;c=new wi(a.b,c);b&&b.rg&&Ud(a.b,b.rg);b&&b.sg&&(a.b.transform=b.sg);a.G=c},getName:function(){return"Simulator"},Cd:"js",languages:["js","aseba","l2","asm"]})};function xi(){this.b=[]}xi.prototype.add=function(a){this.b.push(a)};xi.prototype.H=function(a){this.b.forEach(function(b){b.H(a)})};function yi(){}yi.prototype.b=function(){throw"internal";};yi.prototype.H=function(){};function zi(a,b,c){this.x=a;this.y=b;this.h=c}zi.prototype=Object.create(yi.prototype);zi.prototype.constructor=zi;
zi.prototype.b=function(a,b,c){for(var d=Infinity,f=this.x.length,e=0;e<(this.h?this.x.length:this.x.length-1);e++){var h=this.x[(e+1)%f],g=this.y[(e+1)%f],k=[Math.cos(c),h-this.x[e],Math.sin(c),g-this.y[e]];h=[h-a,g-b];g=k[0]*k[3]-k[1]*k[2];k=[(k[3]*h[0]-k[1]*h[1])/g,(k[0]*h[1]-k[2]*h[0])/g];d=Math.min(d,0<=k[1]&&1>=k[1]&&0<k[0]?k[0]:Infinity)}return d};
zi.prototype.H=function(a){a.save();a.beginPath();a.moveTo(this.x[0],this.y[0]);for(var b=1;b<this.x.length;b++)a.lineTo(this.x[b],this.y[b]);this.h&&a.closePath();a.stroke();a.restore()};function Ai(a,b,c){this.x=a;this.y=b;this.r=c}Ai.prototype=Object.create(yi.prototype);Ai.prototype.constructor=Ai;
Ai.prototype.b=function(a,b,c){var d=(this.x-a)*Math.cos(c)+(this.y-b)*Math.sin(c);a=(a-this.x)*Math.sin(c)+(this.y-b)*Math.cos(c);a=this.r*this.r-a*a;if(0>a)return Infinity;a=Math.sqrt(a);return 0>d+a?Infinity:0>d-a?d+a:d-a};Ai.prototype.H=function(a){a.save();a.beginPath();a.arc(this.x,this.y,this.r,0,2*Math.PI);a.stroke();a.restore()};function Bi(a,b){this.width=a;this.height=b}
function wi(a,b){var c=this;this.ia=new Fa;this.Z=b;this.P=this.tf=this.paused=this.qe=!1;this.sc=Ci;this.b=new Bi(10*this.Z.qb,7.07*this.Z.qb);b=this.Z.qb;this.Z.setPositionLimits(-this.b.width/2+b,this.b.width/2-b,-this.b.height/2+b,this.b.height/2-b);this.bf=this.cc=null;this.h=document.createElement("canvas");this.o=document.createElement("canvas");this.Lf=!1;this.cf=this.zb=null;this.m=document.createElement("canvas");this.u=new xi;this.je=!1;this.df=this.ha=null;Di(this);this.Z.bb=function(){Ei(c);
Fi(c);Gi(c)};this.K=a;this.K.state={};this.ua=!1}var Ci="ground";wi.prototype.pe=function(){this.ia.b=[]};function Hi(a){var b=a.o.getContext("2d");b.filter="blur("+(a.o.width/300).toFixed(1)+"px)";b.fillStyle="white";b.fillRect(0,0,a.o.width,a.o.height);b.drawImage(a.h,0,0)}
function Ii(a){var b=a.G;if(b.cc){b.h.width=b.cc.width;b.h.height=b.cc.height;var c=b.h.getContext("2d");c.fillStyle="white";c.fillRect(0,0,b.cc.width,b.cc.height);c.drawImage(b.cc,0,0,b.cc.width,b.cc.height)}else b.h.width=b.K?b.K.width:800,b.h.height=b.h.width*b.b.height/b.b.width,c=b.h.getContext("2d"),c.fillStyle="white",c.fillRect(0,0,b.h.width,b.h.height);b.o.width=b.h.width;b.o.height=b.h.height;b.Lf=!1;Hi(b);fc(a)}
function vi(a,b,c){if(a.tf){var d=a.h.getContext("2d");d.save();d.translate(a.h.width/2,a.h.height/2);d.scale(a.h.width/a.b.width,-a.h.height/a.b.height);d.beginPath();switch(b){case "l":d.moveTo(c[0],c[1]);d.lineTo(c[2],c[3]);break;case "a":d.arc(c[0],c[1],Math.abs(c[2]),c[3],c[4],0>c[2])}d.strokeStyle="#060";d.lineCap="round";d.lineWidth=.1*a.Z.qb;d.stroke();d.restore();a.Lf=!0;Hi(a)}}
function Di(a){a.u.b=[];a.u.add(new zi([-a.b.width/2,a.b.width/2,a.b.width/2,-a.b.width/2],[-a.b.height/2,-a.b.height/2,a.b.height/2,a.b.height/2],!0))}
function Ji(a,b){var c=a.G;Di(c);if(c.ha=b){var d=new xe(b),f=c.b.width/d.Ca[2],e=-c.b.width*(.5+d.Ca[0]/d.Ca[2]),h=-c.b.height/d.Ca[3],g=c.b.height*(.5+d.Ca[1]/d.Ca[3]);d.H(null,{za:{line:function(a,b,d){c.u.add(new zi(a.map(function(a){return e+f*a}),b.map(function(a){return g+h*a}),d))},Ze:function(a,b,d){c.u.add(new Ai(e+f*a,g+h*b,(f-h)/2*d))}}})}c.je=null!=b;Fi(c);fc(a)}
function Ki(a,b,c){b=Math.round(a.o.width*(b+a.b.width/2)/a.b.width);c=Math.round(a.o.height*(a.b.height/2-c)/a.b.height);return a.o.getContext("2d").getImageData(b,c,1,1).data[0]/255}function Li(a,b,c){if(null==a.zb)return 0;b=Math.round(a.m.width*(b+a.b.width/2)/a.b.width);c=Math.round(a.m.height*(a.b.height/2-c)/a.b.height);a=a.m.getContext("2d").getImageData(b,c,1,1).data;return-(a[0]+a[1]+a[2])/765}
function Ei(a){for(var b=[],c=0;2>c;c++)b.push(Ki(a,a.Z.b[0]+a.Z.oc*Math.cos(a.Z.h)+(0===c?-1:1)*a.Z.$d*Math.sin(a.Z.h),a.Z.b[1]+a.Z.oc*Math.sin(a.Z.h)-(0===c?-1:1)*a.Z.$d*Math.cos(a.Z.h))+Qf(a.Z,.05));a.Z.set("prox.ground.delta",b)}
function Fi(a){var b=Math.cos(a.Z.h),c=Math.sin(a.Z.h),d=[{Ad:70,yd:60,eb:.7},{Ad:85,yd:30,eb:.35},{Ad:95,yd:0,eb:0},{Ad:85,yd:-30,eb:-.35},{Ad:70,yd:-60,eb:-.7},{Ad:-25,yd:35,eb:2.8},{Ad:-25,yd:-35,eb:-2.8}].map(function(a){var d=this.u,f=this.Z.b[0]+a.Ad*b-a.yd*c,g=this.Z.b[1]+a.Ad*c+a.yd*b;a=this.Z.h+a.eb;for(var k=Infinity,m=0;m<d.b.length;m++)k=Math.min(k,d.b[m].b(f,g,a));d=k+Qf(this.Z,.01*this.Z.r);return 100>d?1:300<d?0:(d-300)*(d-300)/4E4},a);a.Z.set("prox.horizontal",d)}
function Gi(a){for(var b=[0,0,a.Z.r],c=[-a.Z.r,a.Z.r,0],d=[],f=0;3>f;f++)d.push(Li(a,a.Z.b[0]+b[f]*Math.cos(a.Z.h)+c[f]*Math.sin(a.Z.h),a.Z.b[1]+b[f]*Math.sin(a.Z.h)-c[f]*Math.cos(a.Z.h)));b=200*(d[1]-d[0])/(2*a.Z.r);d=200*(d[2]-(d[0]+d[1])/2)/a.Z.oc;a.Z.set("acc",[b+Qf(a.Z,.02),d+Qf(a.Z,.02),Math.sqrt(1-b*b-d*d)+Qf(a.Z,.02)])}
function vf(a,b,c){switch(c||a.G.sc){case Ci:a.G.bf=null==b?a.G.cc:null;a.G.cc=b;Ii(a);Ei(a.G);fc(a);break;case "height":a.G.cf=null==b?a.G.zb:null,c=a.G,c.zb=b,c.zb?(c.m.width=c.zb.width,c.m.height=c.zb.height,b=c.m.getContext("2d"),b.fillStyle="white",b.fillRect(0,0,c.zb.width,c.zb.height),b.drawImage(c.zb,0,0,c.zb.width,c.zb.height)):(c.m.width=1,c.m.height=1),Gi(c),fc(a)}}function uf(a,b,c){switch(c||a.G.sc){case "obstacle":a.G.df=null==b?a.G.ha:null,Ji(a,b)}}
Jb.prototype.start=function(a){this.G.paused=a;this.G.qe=!a;fc(this)};function Mi(a){a=[a[0],Math.max(.2+.8*a[1],a[2]/2),a[2]];var b=Math.max(a[0],Math.max(a[1],a[2]));return"rgb("+a.map(function(a){return Math.round(225*(1-b)+(30+225*b)*a)}).join(",")+")"}function Ni(a){return function(b){a.K!==b&&(a.K=b,ti(a))}}function df(a,b,c,d,f){var e=new wc(a.b);Kc(e,a,b,["sim","top"],a.G.Gd||Vb,a.G.ue||Ic);yc(e,c,f,d);return e}
function fc(a){function b(a){return function(){d.K!==a&&(d.K=a,ti(d))}}function c(a,b,c,d){var e=(f.ue||Ic)(a,h.w);c=Math.min(c.width/(e.pa-e.W),c.height/(e.ma-e.X));b.save();b.translate(-e.W,-e.X);b.scale(c,c);(f.Gd||Vb)(a,b,h.w,h.ca,["sim","event"],null,!0,!1,d);b.restore()}var d=a,f=a.G,e=f.Z,h=a.b;if(h.P){f.ua||(f.ua=!0,f.resize(a),Ii(a));h.ab=[];var g=f.ag||a.Na,k=Zb(a,g,["sim","top"]),m=Mc(k),q=gd(h);fd(h);var n=E(h.ca,{tag:"view",Y:["sim"]}),r=E(h.ca,{tag:"button",Y:["sim","event"]}),u=E(h.ca,
{tag:"sim-controller"}),l=E(h.ca,{tag:"separator",id:"sim-controller-separator"}),p=E(h.ca,{tag:"separator",Y:["sim","top"]}),v=E(h.ca,{tag:"toolbar",Y:["sim","top"]}),F=E(h.ca,{tag:"sim-playground-area"}),x=E(h.ca,{tag:"sim-playground"});n.yc(q.width);n.jc(q.height);n.setPosition(0,0);var t=Math.max(r.width,r.height);u.width=3*D(r);u.jc(n.height);u.setPosition(n.x+n.width-D(u),n.y);v.yc(n.width-D(u));v.height=m;v.setPosition(n.x,n.y);F.yc(n.width-D(u));F.jc(n.height-v.sa());F.setPosition(n.x,n.y+
v.sa());Ac(h,function(a){n.H(a)});zc(df(a,g,v,p,k),v,k,Ni(a));Ac(h,function(a){u.H(a)});g=[];k=u.y+r.offsetTop();g.push(Cc(h,u.x+D(r)+r.offsetLeft(),k,r,function(a,b,d){c("sim-event:forward",a,b,d)},function(){e.set("button.forward",!0);e.sendEvent("buttons",null);e.set("button.forward",!1);e.sendEvent("buttons",null)},null,null,b("sim:btn-button.forward"),"button.forward"));k+=r.sa();g.push(Cc(h,u.x+r.offsetLeft(),k,r,function(a,b,d){c("sim-event:left",a,b,d)},function(){e.set("button.left",!0);
e.sendEvent("buttons",null);e.set("button.left",!1);e.sendEvent("buttons",null)},null,null,b("sim:btn-button.left"),"button.left"));g.push(Cc(h,u.x+D(r)+r.offsetLeft(),k,r,function(a,b,d){c("sim-event:center",a,b,d)},function(){e.set("button.center",!0);e.sendEvent("buttons",null);e.set("button.center",!1);e.sendEvent("buttons",null)},null,null,b("sim:btn-button.center"),"button.center"));g.push(Cc(h,u.x+2*D(r)+r.offsetLeft(),k,r,function(a,b,d){c("sim-event:right",a,b,d)},function(){e.set("button.right",
!0);e.sendEvent("buttons",null);e.set("button.right",!1);e.sendEvent("buttons",null)},null,null,b("sim:btn-button.right"),"button.right"));k+=r.sa();g.push(Cc(h,u.x+D(r)+r.offsetLeft(),k,r,function(a,b,d){c("sim-event:backward",a,b,d)},function(){e.set("button.backward",!0);e.sendEvent("buttons",null);e.set("button.backward",!1);e.sendEvent("buttons",null)},null,null,b("sim:btn-button.backward"),"button.backward"));k+=r.sa()+l.sa();g.push(Cc(h,u.x+.5*D(r)+r.offsetLeft(),k,r,function(a,b,d){c("sim-event:tap",
a,b,d)},function(){e.sendEvent("tap",null)},null,null,b("sim:btn-tap"),"tap"));g.push(Cc(h,u.x+1.5*D(r)+r.offsetLeft(),k,r,function(a,b,d){c("sim-event:clap",a,b,d)},function(){e.sendEvent("mic",null)},null,null,b("sim:btn-clap"),"clap"));k+=2*t;var K=u.x+1.5*D(r),Y=k+3.5*t;g.push(Ac(h,function(a){function b(b,c,d,e,f,g){function h(b,c){a.beginPath();a.arc(0,0,b,0,2*Math.PI);a.fillStyle=c;a.fill()}a.save();a.translate(b,c);h(d,g||"#222");h(.95*d,f||"#bbb");h(.95*d*e,g||"#222");a.restore()}a.save();
a.beginPath();a.moveTo(K-1.2*t,Y);a.lineTo(K-1.2*t,Y-1.8*t);a.bezierCurveTo(K-.72*t,Y-2.4*t,K-.05*t,Y-2.4*t,K,Y-2.4*t);a.bezierCurveTo(K+.05*t,Y-2.4*t,K+.72*t,Y-2.4*t,K+1.2*t,Y-1.8*t);a.lineTo(K+1.2*t,Y);a.closePath();a.lineWidth=2;a.strokeStyle="black";a.stroke();var c=e.get("prox.ground.delta");b(K-.45*t,Y-1.8*t,.4*t,c[0],"#afa","#060");b(K+.45*t,Y-1.8*t,.4*t,c[1],"#9f9","#060");c=e.get("prox.horizontal");b(K-1.45*t,Y-2.3*t,.4*t,c[0],"#fcc","#d00");b(K-.8*t,Y-2.8*t,.4*t,c[1],"#fcc","#d00");b(K,
Y-3*t,.4*t,c[2],"#fcc","#d00");b(K+.8*t,Y-2.8*t,.4*t,c[3],"#fcc","#d00");b(K+1.45*t,Y-2.3*t,.4*t,c[4],"#fcc","#d00");b(K-.8*t,Y+.5*t,.4*t,c[5],"#fcc","#d00");b(K+.8*t,Y+.5*t,.4*t,c[6],"#fcc","#d00");a.restore()}));var O=k+=5*t;g.push(Ac(h,function(a){function b(b,c,d,e){e=Math.max(-1,Math.min(1,e));a.save();a.translate(b,c);a.beginPath();a.arc(0,0,d,0,2*Math.PI);a.fillStyle="#ccc";a.fill();a.beginPath();a.moveTo(0,0);a.lineTo(d*Math.sin(3*e),-d*Math.cos(3*e));a.lineWidth=Math.max(d/6,1);a.strokeStyle=
"black";a.stroke();a.restore()}a.save();a.fillStyle="black";a.fillRect(K-1.15*t,O+.5*t,.3*t,.6*t);a.fillRect(K+.85*t,O+.5*t,.3*t,.6*t);a.fillStyle=Mi(e.get("leds.top"));a.fillRect(K-1.2*t,O,2.4*t,.5*t);a.fillStyle=Mi(e.get("leds.bottom.left"));a.fillRect(K-1.2*t,O+.5*t,1.2*t,.5*t);a.fillStyle=Mi(e.get("leds.bottom.right"));a.fillRect(K,O+.5*t,1.2*t,.5*t);a.lineWidth=1;a.beginPath();a.moveTo(K-1.2*t,O+.5*t);a.lineTo(K+1.2*t,O+.5*t);a.moveTo(K,O+.5*t);a.lineTo(K,O+t);a.strokeStyle="white";a.stroke();
a.lineJoin="round";a.strokeStyle="black";a.strokeRect(K-1.2*t,O,2.4*t,t);b(K-1.7*t,O+t,.4*t,e.get("motor.left")/2);b(K+1.7*t,O+t,.4*t,e.get("motor.right")/2);a.restore()}));k+=1.5*t;if(null!=f.zb){var va=k+1.5*t;g.push(Ac(h,function(a){var b=e.get("acc");b=[Math.atan2(b[0],b[1]),Math.atan2(b[1],b[2]),Math.atan2(b[0],b[2])];a.save();a.strokeStyle="black";a.lineWidth=.7*h.w.ja;for(var c=0;3>c;c++){a.save();a.translate(K+(c-1)*t,va);a.save();a.strokeStyle="silver";a.beginPath();a.moveTo(-.4*t,0);a.lineTo(.4*
t,0);a.moveTo(0,-.4*t);a.lineTo(0,.4*t);a.stroke();a.restore();a.rotate(-b[c]);switch(c){case 0:var d=.25*t;a.translate(0,1.2*d);a.beginPath();a.moveTo(-1.2*d,0);a.lineTo(-1.2*d,-1.8*d);a.bezierCurveTo(-.72*d,-2.4*d,-.05*d,-2.4*d,0,-2.4*d);a.bezierCurveTo(.05*d,-2.4*d,.72*d,-2.4*d,1.2*d,-1.8*d);a.lineTo(1.2*d,0);a.closePath();a.lineWidth=2;a.strokeStyle="black";a.stroke();break;case 1:a.strokeRect(-.4*t,-.15*t,.8*t,.3*t);a.beginPath();a.arc(-.2*t,.05*t,.15*t,0,2*Math.PI);a.fillStyle="white";a.fill();
a.lineWidth=.07*t;a.stroke();break;case 2:a.strokeRect(-.4*t,-.15*t,.8*t,.3*t),a.fillStyle="black",a.fillRect(-.35*t,.15*t,.15*t,.08*t),a.fillRect(.2*t,.15*t,.15*t,.08*t)}a.restore()}a.restore()}));k+=2.5*t}if(e.qc){var La=k+2*t;g.push(Ac(h,function(a){for(var b=e.get("leds.circle"),c=0;8>c;c++)le(a,K,La,.9*t,1.2*t,Math.PI*(.44-.25*c),Math.PI*(.56-.25*c),b[c]?"#fa0":"white","black",h.w.ja)}));k+=3.5*t}var sa=k+1.5*t,L=e.getTimer(0);0<=L?(g.push(Ac(h,function(a){h.state.se?"lin"===h.state.se&&4<L&&
(h.state.se="log"):h.state.se=4<L?"log":"lin";ie(a,K,sa,t,h.w.ja,function(b){a.textAlign="start";a.textBaseline="top";a.font=(t/2).toFixed(1)+"px sans-serif";a.fillStyle="black";a.fillText(b.toFixed(1),u.x,sa-t)},Math.min(L,"log"===h.state.se?9.9:3.95),!1,"log"===h.state.se)})),k+=2.5*t):h.state.se=!1;var P=Math.min((F.y-u.y+u.y+u.height-k)/2,u.y+u.height-k);0<P&&g.forEach(function(a){a.y+=P});var ba=F.x,ta=F.y,nb=F.width,B=F.height;var la=Math.min(nb/f.b.width,B/f.b.height);r=(nb-f.b.width*la)/2;
l=(B-f.b.height*la)/2;x.width=f.b.width*la;x.height=f.b.height*la;x.x=ba+r;x.y=ta+l;if(a.ia.Zb){var M=E(h.ca,{tag:"widget",id:"vpl-customize"});Ac(h,function(){cd(h,"vpl:customize",ba+nb/2,ta+B/2,M)})}else{var I=e.qb,Ia=!1;r=new Sc(null,f.b.width*la,f.b.height*la,ba+r,ta+l,function(a,b,c,g){a=a.I;a.save();F.H(a);x.H(a);if(null===d.Vc)switch(f.sc){case Ci:a.drawImage(f.h,b.x+c,b.y+g,b.width,b.height);break;case "height":null!=f.zb&&a.drawImage(f.m,b.x+c,b.y+g,b.width,b.height);break;case "obstacle":a.save(),
a.translate(b.x+c+b.width/2,b.y+g+b.height/2),a.scale(la,-la),f.u.H(a),a.restore()}else a.drawImage(f.h,b.x+c,b.y+g,b.width,b.height),null!=f.zb&&(a.save(),a.globalAlpha=.5,a.drawImage(f.m,b.x+c,b.y+g,b.width,b.height),a.restore()),f.je&&(a.save(),a.translate(b.x+c+b.width/2,b.y+g+b.height/2),a.scale(la,-la),f.u.H(a),a.restore());a.translate(b.x+c+b.width/2,b.y+g+b.height/2);a.scale(la,la);a.translate(e.b[0],-e.b[1]);a.rotate(.5*Math.PI-e.h);a.beginPath();a.moveTo(0,.2*I);a.lineTo(.5*I,.2*I);a.lineTo(.5*
I,-.55*I);a.bezierCurveTo(.3*I,-.8*I,.02*I,-.8*I,0,-.8*I);a.bezierCurveTo(-.02*I,-.8*I,-.3*I,-.8*I,-.5*I,-.55*I);a.lineTo(-.5*I,.2*I);a.closePath();a.fillStyle=Mi(e.get("leds.top"));a.strokeStyle="black";a.lineJoin="round";a.lineWidth=2;a.moveTo(.05*I,0);a.arc(0,0,.05*I,0,2*Math.PI);a.fill();a.stroke();if(!f.qe||f.paused)a.beginPath(),a.arc(0,0,I,0,2*Math.PI),a.strokeStyle=h.state.Eg?"navy":"#3cf",a.lineWidth=.1*I,a.stroke(),a.beginPath(),a.arc(0,-I,.15*I,0,2*Math.PI),a.fillStyle=h.state.Rf?"navy":
"white",a.strokeStyle=h.state.Rf?"navy":"#3cf",a.lineWidth=.06*I,a.fill(),a.stroke();a.restore()},{$:function(a,b,c,d,g,k,l){a=(l.x-g-c/2)/la;d=(d/2-(l.y-k))/la;k=a-e.b[0];l=d-e.b[1];b=I*Math.cos(e.h);c=I*Math.sin(e.h);return(!f.qe||f.paused)&&(k-b)*(k-b)+(l-c)*(l-c)<.1*I*I?(h.state.x=a,h.state.y=d,h.state.Rf=!0,1):k*k+l*l<I*I?(f.paused?Ia=!1:(e.suspend(),Ia=!0),h.state.x=a,h.state.y=d,h.state.Eg=!0,0):null},Sa:function(a,b,c,d,g,k,l,m){a=(m.x-k-d/2)/la;g=(g/2-(m.y-l))/la;switch(c){case 0:c=e.b;e.setPosition([e.b[0]+
a-h.state.x,e.b[1]+g-h.state.y],e.h);vi(f,"l",[c[0],c[1],e.b[0],e.b[1]]);break;case 1:e.setPosition(e.b,e.h+(Math.atan2(g-e.b[1],a-e.b[0])-Math.atan2(h.state.y-e.b[1],h.state.x-e.b[0])))}h.state.x=a;h.state.y=g},pf:function(){h.state.Eg=!1;h.state.Rf=!1;Ia&&e.resume(ui())}});r.m=!1;Uc(h,r)}a.K&&Ac(h,function(a){var b=E(h.ca,{tag:"hint"});a.fillStyle=b.color;a.font=Ec(b);a.textAlign="start";a.textBaseline="middle";var c=d.h.translate(d.K);b.width=a.measureText(c).width;b.height=1.2*b.fontSize;Bc(b,
a,b.marginLeft,q.height-b.sa()+b.marginTop,!0);a.fillText(c,b.offsetLeft(),q.height-b.sa()+b.offsetTop()+b.height/2)});C(h);!f.paused&&e.shouldRunContinuously()&&ti(a)}}function ti(a){a.G.P||(a.G.P=!0,window.requestAnimationFrame(function(){a.G.P=!1;fc(a)}))}function ui(){return.001*(new Date).getTime()}
wi.prototype.resize=function(a){var b=window.innerWidth,c=window.innerHeight;window.vplDisableResize&&(c=this.K.b.getBoundingClientRect(),b=c.width,c=c.height);this.K.w=this.K.w;this.K.resize(b,c);fc(a)};function Jf(a){a.M.add("sim:close",{action:function(a){a.gb(["sim"],{af:!0})},object:a,S:function(a){return 1<a.Ba.length&&0<=a.Ba.indexOf("sim")}});a.M.add("sim:restart",{action:function(a){Ii(a);a.G.Z.reset(ui());a.G.Z.start();a.G.qe=!0;a.G.paused=!1;fc(a)},object:a});a.M.add("sim:pause",{action:function(a){a.G.qe&&(a.G.paused=!a.G.paused,a.G.paused?a.G.Z.suspend():(a.G.Z.resume(ui()),fc(a)))},isEnabled:function(a){return a.G.qe},Ka:function(a){return a.G.paused},object:a,fb:[{selected:!1},{selected:!0}]});
a.M.add("sim:speedup",{action:function(a){var b=[.5,1,2,5,10];a.G.Z.Ed=b[(b.indexOf(a.G.Z.Ed)+1)%b.length]},Ka:function(a){return 1!==a.G.Z.Ed},getState:function(a){return a.G.Z.Ed},object:a,fb:[{selected:!1,state:1},{selected:!0,state:.5},{selected:!0,state:2},{selected:!0,state:5},{selected:!0,state:10}]});a.M.add("sim:noise",{action:function(a){a.G.Z.mf=!a.G.Z.mf},Ka:function(a){return a.G.Z.mf},object:a,fb:[{selected:!1},{selected:!0}]});a.M.add("sim:pen",{action:function(a){a.G.tf=!a.G.tf},Ka:function(a){return a.G.tf},
object:a,fb:[{selected:!1},{selected:!0}]});a.M.add("sim:clear",{action:function(a){Ii(a)},isEnabled:function(a){return a.G.Lf},object:a});a.M.add("sim:map-kind",{action:function(a){switch(a.G.sc){case Ci:a.G.sc="height";break;case "height":a.G.sc="obstacle";break;case "obstacle":a.G.sc=Ci}},getState:function(a){switch(a.G.sc){case Ci:return"ground";case "height":return"height";case "obstacle":return"obstacles";default:return"ground"}},object:a,fb:[{state:"ground"},{state:"height"},{state:"obstacles"}],
S:function(a){return null===a.Vc}});a.M.add("sim:map",{action:function(a){switch(a.G.sc){case Ci:vf(a,null==a.G.cc?a.G.bf:null);break;case "height":vf(a,null==a.G.zb?a.G.cf:null);break;case "obstacle":uf(a,a.G.je?null:a.G.df)}},Ka:function(a){switch(a.G.sc){case Ci:return null!=a.G.cc;case "height":return null!=a.G.zb;case "obstacle":return a.G.je}throw"internal";},getState:function(a){switch(a.G.sc){case Ci:return"ground";case "height":return"height";case "obstacle":return"obstacles";default:return"ground"}},
object:a,fb:[{selected:!1,state:"ground"},{selected:!1,state:"height"},{selected:!1,state:"obstacles"},{selected:!0,state:"ground"},{selected:!0,state:"height"},{selected:!0,state:"obstacles"}],S:function(a){return null===a.Vc}});a.M.add("sim:map-ground",{action:function(a,c){c?a.Le.show("Open ground image file",".gif,.png,.jpg,.svg",function(b){var c=new window.FileReader;c.onload=function(b){b=b.target.result;var c=new Image;c.addEventListener("load",function(){vf(a,c,Ci)});c.src=b};c.readAsDataURL(b)}):
vf(a,null==a.G.cc?a.G.bf:null,Ci)},Ka:function(a){return null!=a.G.cc},object:a,fb:[{selected:!1},{selected:!0}],S:function(a){return a.Vc&&0<=a.Vc.indexOf("ground")}});a.M.add("sim:map-height",{action:function(a,c){c?a.Le.show("Open height image file",".gif,.png,.jpg,.svg",function(b){var c=new window.FileReader;c.onload=function(b){b=b.target.result;var c=new Image;c.addEventListener("load",function(){vf(a,c,"height")});c.src=b};c.readAsDataURL(b)}):vf(a,null==a.G.zb?a.G.cf:null,"height")},Ka:function(a){return null!=
a.G.zb},object:a,fb:[{selected:!1},{selected:!0}],S:function(a){return a.Vc&&0<=a.Vc.indexOf("height")}});a.M.add("sim:map-obstacles",{action:function(a,c){c?a.Le.show("Open obstacle SVG file",".svg",function(b){var c=new window.FileReader;c.onload=function(b){uf(a,b.target.result,"obstacle")};c.readAsText(b)}):uf(a,a.G.je?null:a.G.df,"obstacle")},Ka:function(a){return a.G.je},object:a,fb:[{selected:!1},{selected:!0}],S:function(a){return a.Vc&&0<=a.Vc.indexOf("obstacles")}});a.M.add("sim:vpl",{action:function(a){a.Rd?
a.gb(["vpl"],{Td:!0}):a.gb(["vpl"],{Qd:"sim"})},isEnabled:function(a){return null==a.J||kf(a.J)},object:a,S:function(a){return(null==a.J||!a.J.fa)&&0>a.Ba.indexOf("vpl")}});a.M.add("sim:text",{action:function(a){a.Rd?a.gb(["src"],{Td:!0,fg:!a.J.Qc}):a.gb(["src"],{Qd:"sim",fg:!a.J.Qc})},object:a,S:function(a){return 0>a.Ba.indexOf("src")}});a.M.add("sim:teacher-reset",{action:function(a){a.G.pe();fc(a)},object:a,Sc:!0,S:function(a){return a.G.Fb&&a.G.ia.Zb}});a.M.add("sim:teacher",{action:function(a){a.G.ia.Zb=
!a.G.ia.Zb;fc(a)},Ka:function(a){return a.G.ia.Zb},object:a,Sc:!0,S:function(a){return a.G.Fb},fb:[{selected:!1},{selected:!0}]})};function Ff(a){return new rf({ec:function(b,c){a.Ea[a.na].Wa.state.b(c)},Oc:function(){try{var b=Df("asebahttp")||("http:"!==document.location.origin.slice(0,5)?"http://127.0.0.1:3000":document.location.origin);ka(b,function(){a.Ea[a.na].Wa.state=fa[0];Wd(a.da)})}catch(c){console.info(c),Wd(a.da)}},isConnected:function(){return null!=a.Ea[a.na].Wa.state},isEnabled:function(b){return"aseba"===b&&null!=a.Ea[a.na].Wa.state},getName:function(){return"Thymio (HTTP)"},Cd:"aseba",languages:["aseba","l2"],
state:null})};function Gf(a){var b=null;return new rf({ec:function(a,d){b.run(d)},Oc:function(){try{b=new window.TDM(Df("w"),{uuid:Df("uuid")||"auto",change:function(b){a.Ea[a.na].Wa.state=b?{}:null;Wd(a.da)}})}catch(c){console.info(c),Wd(a.da)}},isConnected:function(){return null!=a.Ea[a.na].Wa.state&&b.isConnected()},isEnabled:function(c){return"aseba"===c&&null!=a.Ea[a.na].Wa.state&&b.canRun()},getName:function(){return"Thymio (TDM)"},hf:function(a,d){b.flash(d)},Ge:function(c){return"aseba"===c&&null!=a.Ea[a.na].Wa.state&&
b.canRun()},Cd:"aseba",languages:["aseba"],state:null})};function Oi(a){this.u=a||"ws://127.0.0.1:8002/";this.o={};this.m=this.b=null}Oi.prototype.connect=function(){this.h=new WebSocket(this.u);var a=this;this.h.addEventListener("open",function(){a.h.send(JSON.stringify({type:"nodes"}))});this.h.addEventListener("message",function(b){try{var c=JSON.parse(b.data);switch(c.type){case "connect":if(c.id){var d=c.id;a.o[d]=c;a.b&&a.b(d,c.descr)}break;case "disconnect":d=c.id,delete a.o[d],a.m&&a.m(d)}}catch(f){}})};
Oi.prototype.ec=function(a,b){this.h.send(JSON.stringify({type:"run",id:a,bc:b}))};function Hf(a){var b=null,c=Df("uuid")||null;c&&(c=c.replace(/^\{(.*)\}$/,"$1"));var d=null;return new rf({ec:function(a,e){switch(a){case "aseba":a=new zb(d,e);a.ha=Ab;var f=Bb(a);break;case "l2":a=new zb(d,e);a.ha=Mf;f=Bb(a);break;case "asm":a=new Of(d,e),f=Nf(a)}b.ec(c,f)},Oc:function(){try{var f=Df("w")||("http:"!==document.location.origin.slice(0,5)?"ws://127.0.0.1:8002":document.location.origin.replace(/^http/,"ws"));b=new Oi(f);b.b=function(b,f){if(null==c||b===c)d=new xb(f),a.Ea[a.na].Wa.state=
{},Wd(a.da)};b.m=function(b){if(null==c||b===c)a.Ea[a.na].Wa.state=null,Wd(a.da)};b.connect()}catch(e){console.info(e),Wd(a.da)}},isConnected:function(){return null!=a.Ea[a.na].Wa.state},isEnabled:function(b){return("aseba"===b||"l2"===b||"asm"===b)&&null!=a.Ea[a.na].Wa.state},getName:function(){return"Thymio (JWS)"},Cd:"aseba",languages:["aseba","l2","asm"],state:null})};
}).call(this);
