/* Copyright 2018-2020 ECOLE POLYTECHNIQUE FEDERALE DE LAUSANNE - author Yves Piguet */
(function(){
var w,aa,ba,ca;function da(a,b){this.name=a;this.Md=b}var ea=[];function ha(){var a=ia;if(a)for(var b=ea.length-1;0<=b;b--)ea[b]instanceof a&&ea.splice(b,1);else ea=[]}da.prototype.b=function(){throw"not implemented";};da.prototype.addEventListener=function(){throw"not implemented";};function ia(a,b,c){da.call(this,a,b);this.url=c}ia.prototype=Object.create(da.prototype);ia.prototype.constructor=ia;function ja(a,b,c,d){var e=new XMLHttpRequest;e.timeout=200;e.onerror=function(){c(null)};c&&(e.onreadystatechange=function(){if(4===e.readyState)switch(e.status){case 200:c(e.responseText);break;default:c(null)}});e.open(a,b,!0);e.send(d)}
function ka(a,b){a=a||"";ja("GET",a+"/nodes",function(c){null!==c&&(c=JSON.parse(c),0===c.length?ka(a,b):(ha(),c.forEach(function(b){var c=new ia(b.name,b.aeslId,a+"/nodes/"+b.name,b.protocolVersion);ja("GET",a+"/nodes/"+b.name,function(a){c.description=a?JSON.parse(a):""});ea.push(c)}),b&&b()))})}
function ma(a,b){return"<!DOCTYPE aesl-source>\n<network>\n"+[].map(function(a){return"<event size='"+(a.size||0).toString(10)+"' name='"+a.name+"'/>\n"}).join("")+"<keywords flag='true'/>\n<node nodeId='"+(a.Md||1).toString(10)+"' name='"+a.name+"'><![CDATA["+b+"]]\x3e</node>\n</network>\n"}ia.prototype.b=function(a){a=ma(this,a);ja("PUT",this.url,void 0,a)};
ia.prototype.addEventListener=function(a,b){a=a.toString();var c=this.url+"/events";a&&(c+="/"+a);c=new EventSource(c);c.onmessage=function(c){b(c.data.split(" ").slice(1).map(function(a){return parseInt(a,10)}),a)};return c};function y(a){this.name=a.name;this.type=a.type;this.ma=a.ma||["b","a"];this.wg=a.wg||!1;this.ha=a.ha||null;this.gb=a.gb||null;this.se=a.se||null;this.cf=a.cf||null;this.he=a.he||null;this.vc=a.vc||null;this.Jb=a.Jb||{aseba:"e"===this.type?function(a){return{Gd:"# onevent "+a.V.name+"\n"}}:function(a){return{ka:"# "+a.V.name+"\n"}}};this.H=a.H||function(a,c){a.text(c.V.name)};this.Xd=a.Xd||!1;this.$=a.$||null;this.Ra=a.Ra||null;this.Hc=a.Hc||null}var na=[];
function oa(a,b,c,d){for(var e=null;;){var f=/`([^`]*)`/.exec(a);if(null==f)break;e=(new Function("$","i","rgb","toFixed","return "+f[1]+";"))(b,c,function(a){a=[a[0],Math.max(.2+.8*a[1],a[2]/2),a[2]];var b=Math.max(a[0],Math.max(a[1],a[2]));return a.map(function(a){return.88*(1-b)+(.12+.88*b)*a})},function(a,b){return parseFloat(a.toFixed(void 0===b?2:b)).toString()});a=a.slice(0,f.index)+e+a.slice(f.index+f[0].length)}return d?e:a};function z(a,b,c){this.V=a;this.Ab=b;this.je=c;this.locked=this.disabled=!1;this.g=a.ha?a.ha():null;this.de=this.b=null}z.prototype.ob=function(a,b,c){a=new z(this.V,a,b);a.disabled=this.disabled;a.b=c;this.g&&(a.g=this.g.slice());return a};function A(a){a.b&&a.b()}z.prototype.h=function(a){return this.disabled?{}:this.V.Jb[a]?this.V.Jb[a](this):qa[a].h(this)};function ra(a,b,c){z.call(this,sa[a],b,c)}ra.prototype=Object.create(z.prototype);ra.prototype.constructor=ra;var sa={e:new y({name:"empty e",type:"e",H:function(a,b,c,d){var e=ta("!empty event");e&&e.H(a,b,c,d)}}),a:new y({name:"empty a",type:"a",H:function(a,b,c,d){var e=ta("!empty action");e&&e.H(a,b,c,d)}}),s:new y({name:"empty s",type:"s",H:function(a,b,c,d){var e=ta("!empty state")||ta("!empty event");e&&e.H(a,b,c,d)}})};ra.prototype.h=function(){return{}};function va(){this.U=[];this.actions=[];this.error=null;this.locked=this.disabled=!1}va.prototype.ob=function(){for(var a=new va,b=0;b<this.U.length;b++)xa(a,this.U[b],null,null);for(b=0;b<this.actions.length;b++)xa(a,this.actions[b],null,null);return a};va.prototype.Tb=function(){return 0===this.U.length&&0===this.actions.length};function ya(a){for(var b=0;b<a.U.length;b++)if("init"===a.U[b].V.name)return a.U[b];return null}
function xa(a,b,c,d,e){if(b){switch(b.V.type){case "e":case "s":if(b.Ab===a)c&&(a.U.splice(b.je.index,1),e?b.b=d:b=b.ob(a,c,d),a.U.splice(c.index,0,b));else if(c){if(a.U[c.index]===b)return;e?b.b=d:b=b.ob(a,c,d);a.U[c.index]=b}else e?b.b=d:b=b.ob(a,{Yc:!0,index:a.U.length},d),a.U.push(b);break;case "a":case "c":if(b.Ab===a)c&&(Aa(a,b.je),e?b.b=d:b=b.ob(a,c,d),(c.Yc?a.U:a.actions).splice(c.index,0,b));else if(c){if((c.Yc?a.U:a.actions)[c.index]===b)return;e?b.b=d:b=b.ob(a,c,d);(c.Yc?a.U:a.actions)[c.index]=
b}else e?b.b=d:b=b.ob(a,{Yc:!1,index:a.actions.length},d),a.actions.push(b)}Ba(a)}}function Aa(a,b){b.Yc?a.U[b.index]&&a.U.splice(b.index,1):a.actions[b.index]&&a.actions.splice(b.index,1)}function Ba(a){a.U.forEach(function(a,c){a.Ab=this;a.je={Yc:!0,index:c}},a);a.actions.forEach(function(a,c){a.Ab=this;a.je={Yc:!1,index:c}},a)}
function Ca(a,b){function c(a,b){if(a.disabled)return b.disabled?0:1;if(b.disabled)return-1;a=a.V.name;b=b.V.name;return a>b?1:a<b?-1:0}function d(a,b){if(null===a.g&&null===b.g)return!0;if(null===a.g||null===b.g||a.g.length!==b.g.length)return!1;for(var c=0;c<a.g.length;c++)if(a.g[c]!==b.g[c])return!1;return!0}function e(a){for(var b=0;b<a.U.length;b++)if(!a.U[b].disabled)return!1;return!0}if(!(a.disabled||b.disabled||e(a)||e(b)||0===a.U.length||b.U.length!==a.U.length)){for(var f=a.U.slice(0,1).concat(a.U.slice(1).sort(c)),
g=b.U.slice(0,1).concat(b.U.slice(1).sort(c)),h=0;h<f.length&&!f[h].disabled&&!g[h].disabled;h++)if(f[h].V!==g[h].V||!d(f[h],g[h]))return;if(null==a.error||a.error.Kb)f=new Da("Rules with same events"),Ea(f,b),a.error=f;if(null==b.error||b.error.Kb)f=new Da("Rules with same events"),Ea(f,a),b.error=f}};function Fa(){this.b=[];this.xb=this.qe=this.Wb=!1}function Ga(a,b){a.b=b.slice()}Fa.prototype.toggle=function(a){var b=this.b.indexOf(a);0<=b?this.b.splice(b,1):this.b.push(a)};function Ha(){this.b={};this.language="en"}function Ja(a,b,c){a.b[b]||(a.b[b]={});a=a.b[b];for(var d in c)c.hasOwnProperty(d)&&(a[d]=c[d])}Ha.prototype.translate=function(a,b){return(b=this.b[b||this.language])&&b[a]||a};function Ka(){this.b={};this.tf={}}Ka.prototype.add=function(a){for(var b in a)if(a.hasOwnProperty(b)){this.b[b]||(this.b[b]={});for(var c in a[b])if(a[b].hasOwnProperty(c)){this.b[b][c]||(this.b[b][c]={});for(var d in a[b][c])a[b][c].hasOwnProperty(d)&&(this.b[b][c][d]=a[b][c][d].slice())}}};Ka.prototype.get=function(a,b,c){return this.b[a]&&this.b[a][b]&&this.b[a][b][c]?this.b[a][b][c]:null};
function La(a,b){var c="";b.forEach(function(a){function b(b,c){b=a.split(b);if(1<b.length){a=b[0];for(var d=1;d<b.length;d++)a+=(1==d%2?"<":"</")+c+">"+b[d];0==b.length%2&&(a+="</"+c+">")}}a=a.replace(/&\s/g,"&amp; ");var d="p";/^##/.test(a)?(a=a.slice(2),d="h3"):/^#/.test(a)&&(a=a.slice(1),d="h2");b(/\*\*|__/,"strong");for(b(/\*|_/,"em");;){var g=/!\[([^\]]*)\]\(([^)]*)\)/.exec(a);if(!g)break;a=a.slice(0,g.index)+'<img src="'+(this.tf[g[2]]||g[2])+'" alt="'+g[1]+'">'+a.slice(g.index+g[0].length)}a=
a.replace(/\[([^\]]*)\]\(([^)]*)\)/g,'<a href="$2">$1</a>');c+="<"+d+">"+a+"</"+d+">\n"},a);return c}Ka.prototype.zc=function(a,b){var c=c||"<html>\n<style>\nimg {float: left; margin-right: 10px; margin-bottom: 20px;}\nh1, h2 {clear: left;}\n</style>\n<div style='height: 100%; overflow-y: scroll;'>BLOCKS</div></html>\n";var d="";b.forEach(function(b){(b=this.get(a,"blocks",b))&&(d+=La(this,b))},this);return c.replace("BLOCKS",d||"<p>Empty</p>\n")};function Ma(a){this.filename=null;this.readOnly=!1;this.mode="b";this.fa=!1;this.Eb=Na;this.qg=!1;this.i=[];this.Dc=!1;this.Lf=!0;this.v=this.o=this.qa=null;this.Tc=new Oa;this.code={};this.Cb="aseba";this.message=null;this.$b=Pa;this.b=Qa;this.nc=Ra;this.h=Sa;this.ia=a||new Fa;this.m=null}var qa={},Ta=!0,Pa=[],Qa=!1,Sa=!0,Ra=[];function Ua(){Pa=Va("b").map(function(a){return a.name});Ra=Va("a").map(function(a){return a.name})}
function Xa(a){var b=Ya.map(function(a){return a.name});switch(a){case "b":Pa=b;break;case "a":Ra=b}}w=Ma.prototype;w.ke=function(){this.ia.b=[]};function Za(a,b){b?(b=a.Tc,b.hc=[],b.cd=[]):a.Bb();a.mode="b";a.$b=Pa;a.b=Qa;a.nc=Ra;a.h=Sa;a.i=[];a.code={};a.Lf=!0}w.Tb=function(){for(var a=0;a<this.i.length;a++)if(!this.i[a].Tb())return!1;return!0};w.getError=function(){for(var a=0;a<this.i.length;a++)if(null!==this.i[a].error)return this.i[a].error;return null};
function $a(a){if("b"===a.mode?a.b:a.h)return!1;for(var b=0;b<a.i.length;b++)if(1<a.i[b].U.length||0<a.i[b].U.length&&"s"===a.i[b].U[0].V.type)return!1;return!0}w.Bb=function(){this.Tc.Bb(ab(this),this.Dc);this.code={};this.Dc=!1};w.Xf=function(a){if(0<this.Tc.hc.length){var b=this.Tc.Xf(ab(this),this.Dc);bb(this,b.state,a);this.Dc=b.b;this.code={}}};w.Pf=function(a){if(0<this.Tc.cd.length){var b=this.Tc.Pf(ab(this),this.Dc);bb(this,b.state,a);this.Dc=b.b;this.code={}}};
function cb(a,b){b!==a.mode&&(a.Bb(),a.mode=b,a.i.forEach(function(a){a.U.forEach(function(b,c){a.U[c]=b});a.actions.forEach(function(b,c){a.actions[c]=b})}))}var Na="s";
function ab(a,b){var c={};b&&!1===b.Zc||(c.basicBlocks=a.$b,c.basicMultiEvent=a.b,Ta&&(c.advanced="a"===a.mode,c.advancedBlocks=a.nc,c.advancedMultiEvent=a.h),c.disabledUI=a.ia.b);if(b&&!1===b.bd)return c;b=a.o?a.o():null;var d=null;null==b&&(d=a.i.map(function(a){function b(a){a&&c.push({name:a.V.name,disabled:a.disabled,locked:a.locked,param:a.V.cf?a.V.cf(a):a.g?a.g.slice():null})}var c=[];a.U.forEach(function(a){b(a)});a.actions.forEach(function(a){b(a)});return{blocks:c,disabled:a.disabled,locked:a.locked}}));
c.program=d;c.code=b;return c}function db(a,b){return JSON.stringify(ab(a,b),null,"\t")}
function bb(a,b,c,d){var e=!1,f="vpl";try{if(b){!b.disabledUI||d&&d.uh||Ga(a.ia,b.disabledUI);if(!d||!d.th){var g=1==b.advanced;Ta?(a.mode=g?"a":"b",a.$b=b.basicBlocks||Pa,a.b=void 0!==b.basicMultiEvent?b.basicMultiEvent:Qa,a.nc=b.advancedBlocks||Ra,a.h=void 0!==b.advancedMultiEvent?b.advancedMultiEvent:Sa):(a.mode="b",a.$b=g?b.advancedBlocks||Ra:b.basicBlocks||Pa,a.b=g?void 0!==b.advancedMultiEvent?b.advancedMultiEvent:Sa:void 0!==b.basicMultiEvent?b.basicMultiEvent:Qa)}if(!d||!d.mg)if(b.program?
a.i=b.program.map(function(b){var d=new va;b.blocks.forEach(function(b){var f=ta(b.name);if(f){var g=new z(f,null,null);g.disabled=b.disabled||!1;g.locked=b.locked||!1;f.he?f.he(g,b.param,function(){e&&c&&c("vpl")}):g.g=b.param;xa(d,g,null,function(){a.Bb()},!0)}},this);d.disabled=b.disabled||!1;d.locked=b.locked||!1;return d},a):a.i=[],a.v){var h=b.code;a.v(void 0==b.code?null:h);null!=h&&(f="src")}}}catch(k){}a.fa="src"===f;c&&c(f);e=!0}
function eb(a,b,c,d){try{var e=JSON.parse(b);bb(a,e,c,d);var f=a.Tc;f.hc=[];f.cd=[]}catch(g){}}Ma.prototype.ac=function(a){"string"!==typeof this.code[a]&&(this.code[a]=qa[a].zc(this));return this.code[a]};function fb(a,b){var c=qa[a];a=gb(c,b,!0);b=gb(c,b,!1);return 0<=a&&0<=b?{Gd:a,end:b}:null}function hb(a,b){a.m=b}Ma.prototype.log=function(a){this.m&&this.m(a)};function ib(a,b,c){this.language=a;this.m=b;this.o=c;this.b=[]}function jb(a,b,c){this.id=a;this.m=b;this.h=c;if(0>a||6399<a)throw"internal";this.A=String.fromCharCode(57344+a);this.b=-1}
function kb(a,b){a.forEach(function(a){a.b=b.indexOf(a.A)});a.sort(function(a,b){return a.b-b.b});for(var c=0;c<a.length;c++)a[c].b-=c,b=b.replace(a[c].A,"");a.forEach(function(a){var c;if(a.h){for(;;){for(c=a.b;" "===b[c]||"\t"===b[c];c++);if("\n"===b[c])a.b=c+1;else break}if(" "===b[a.b-1]||"\t"===b[a.b-1]){for(c=a.b-1;" "===b[c]||"\t"===b[c];c--);"\n"===b[c]&&(a.b=c+1)}}else if(" "===b[a.b-1]||"\t"===b[a.b-1]){for(c=a.b-1;" "===b[c]||"\t"===b[c];c--);"\n"===b[c]&&(a.b=c+1)}});return b}
function lb(a){return a.replace(/[\ue000-\uf8ff]/g,"")}function mb(a,b,c){var d=a.b.length,e=new jb(d,c,!0);a.b.push(e);c=new jb(d+1,c,!1);a.b.push(c);return e.A+b+c.A}function gb(a,b,c){for(var d=0;d<a.b.length;d++)if(a.b[d].m===b&&a.b[d].h===c)return a.b[d].b;return-1}
function nb(a,b){if(b.disabled||b.Tb())return{};b.error=null;for(var c=!1,d=!1,e=0;e<b.U.length;e++)if(!b.U[e].disabled)if("e"===b.U[e].V.type){if(c=!0,b.U[e].V.vc){var f=b.U[e].V.vc(b.U[e]);if(f&&(ob(f,[e]),!f.Kb||!b.error)&&(b.error=f,!f.Kb))return{error:f}}}else"s"===b.U[e].V.type&&(d=!0);f=!1;for(e=0;e<b.actions.length;e++)if(!b.actions[e].disabled&&"a"===b.actions[e].V.type){f=!0;break}if(!c&&!f)return b.error?{error:b.error}:{};if(!c&&!d)return f=new Da("Missing event block"),ob(f,[]),b.error=
f,{error:f};if(!f)return f=new Da("Missing action block"),f.b.push(0),b.error=f,{error:f};if(!b.error)for(e=0;e<b.actions.length;e++)for(c=e+1;c<b.actions.length;c++)"a"===b.actions[c].V.type&&b.actions[c].V===b.actions[e].V&&(f=new Da("Duplicate action blocks",!0),f.b.push(e),f.b.push(c),b.error=f);var g=[],h=[],k=[],m="",q=[],n="",t=[],l="";b.U.forEach(function(a,b){var c=a.h(this.language);if(0===b&&c.P)c.Va&&(m=mb(this,c.Va,a),c.aa&&(n+=c.aa));else if(c.lg||c.Va)q.push(mb(this,c.lg||c.Va,a)),
c.aa&&(t=t.concat(c.aa));c.Sb&&(g=g.concat(c.Sb));c.cc&&(h=h.concat(c.cc));c.Rb&&(k=k.concat(c.Rb));c.ka&&(l+=mb(this,c.ka,a))},a);for(e=0;e<b.actions.length;e++)c=b.actions[e].h(a.language),l+=c.ka?mb(a,c.ka,b.actions[e]):"",c.Sb&&c.Sb.forEach(function(a){0>g.indexOf(a)&&g.push(a)}),c.cc&&c.cc.forEach(function(a){0>h.indexOf(a)&&h.push(a)}),c.Rb&&c.Rb.forEach(function(a){0>k.indexOf(a)&&k.push(a)});return 0<l.length?(e="e"===b.U[0].V.type?b.U[0].h(a.language):null,c=b.U.slice(1).filter(function(a){return"e"===
a.V.type}).map(function(a){return a.h(this.language)},a),{xh:b.U[0]?b.U[0].V.name:"",Sb:g,cc:h,Rb:k,P:e?e.P:"",ib:e?e.ib:"",Wa:e?e.Wa:"",od:c.map(function(a){return a.P||""}),Oe:c.map(function(a){return a.ib||""}),Pe:c.map(function(a){return a.Wa||""}),aa:n,nd:t,Va:m,Gb:q.join(" "+a.m+" "),ka:(e&&e.ka||"")+l}):{}}ib.prototype.zc=function(){throw"internal";};ib.prototype.h=function(){throw"internal";};function pb(){ib.call(this,"aseba","and","1 == 1")}pb.prototype=Object.create(ib.prototype);pb.prototype.constructor=pb;
pb.prototype.zc=function(a,b){this.b=[];var c=a.i.map(function(a){return nb(this,a)},this),d={},e=[];c.forEach(function(a){a.P&&(d[a.P]={P:a.P,ib:a.ib,Wa:a.Wa,aa:"",Ia:""},0>e.indexOf(a.P)&&e.push(a.P));a.od&&a.od.forEach(function(b,c){d[b]={P:b,ib:a.Oe[c],Wa:a.Pe[c],aa:"",Ia:""};0>e.indexOf(b)&&e.push(b)})});var f=[],g=[],h=[],k=[];c.forEach(function(b,c){b.Sb&&b.Sb.forEach(function(a){0>f.indexOf(a)&&f.push(a)});b.cc&&b.cc.forEach(function(a){0>g.indexOf(a)&&g.push(a)});b.Rb&&b.Rb.forEach(function(a){0>
h.indexOf(a)&&h.push(a)});if(b.P&&(b.Ya=k.indexOf(lb(b.Va||b.P)),0>b.Ya)){b.Ya=k.length;k.push(lb(b.Va||b.P));var e=d[b.P];b.aa&&0>e.aa.indexOf(b.aa)&&(e.aa+=b.aa);e.Ia+=b.Va?"when "+b.Va+" do\neventCache["+b.Ya+"] = 1\nend\n":"eventCache["+b.Ya+"] = 1\n"}b.P||(b.ka=mb(this,b.ka||"",a.i[c]))},this);var m="";if(b){var q=new va,n=new z(ta("init"),null,null);xa(q,n,null,null);b.forEach(function(a){xa(q,a,null,null)});n=nb(this,q);var t=!0;n.Sb.forEach(function(a){0>f.indexOf(a)&&(t=!1)});n.Rb.forEach(function(a){0>
h.indexOf(a)&&(t=!1)});t?m=n.ka:n.kh&&(m=n.kh)}var l=[],u="",p="",v=0;for(n=0;n<a.i.length;n++)0<=c[n].Ya?(c[n].nd&&c[n].nd.forEach(function(a){0>l.indexOf(a)&&l.push(a)}),u+="if eventCache["+c[n].Ya+"] != 0"+(c[n].Gb?" and "+c[n].Gb:"")+" then\ntodo["+v+"] = 1\nend\n",p+="if todo["+v+"] != 0 then\n"+c[n].ka+"end\n",v++):c[n].Gb&&(u+="when "+c[n].Gb+" do\ntodo["+v+"] = 1\nend\n",p+="if todo["+v+"] != 0 then\n"+c[n].ka+"end\n",v++);c=0<f.length?"\n"+f.join("\n"):"";0<k.length&&(c+="var eventCache[] = ["+
k.map(function(){return"0"}).join(", ")+"]\n");if(0<v){c+="var todo[] = [";for(n=0;n<v;n++)c+=0<n?", 0":"0";c+="]\n"}b?c+="\n"+m:(0<g.length&&(c+="\n"+g.join("\n")),u&&(c+=(0<c.length?"\n":"")+"timer.period[1] = 50\n"));for(n=0;n<e.length;n++)!/onevent/.test(d[e[n]].P)&&(d[e[n]].Wa||d[e[n]].aa||d[e[n]].Ia)&&(c+="\n"+(d[e[n]].P||"")+(d[e[n]].Wa||"")+(d[e[n]].aa||"")+(d[e[n]].Ia||"")+(d[e[n]].ib||""));0<h.length&&(c+="\n"+h.join("\n"));for(n=0;n<e.length;n++)/onevent/.test(d[e[n]].P)&&(d[e[n]].Wa||
d[e[n]].aa||d[e[n]].Ia)&&(c+="\n"+(d[e[n]].P||"")+(d[e[n]].Wa||"")+(d[e[n]].aa||"")+(d[e[n]].Ia||"")+(d[e[n]].ib||""));if(u){c+="\nonevent timer1\n"+l.join("")+u+p;for(n=0;n<k.length;n++)c+="eventCache["+n+"] = 0\n";for(n=0;n<v;n++)c+="todo["+n+"] = 0\n"}"\n"===c[0]&&(c=c.slice(1));var x=0;b=c.split("\n").map(function(a){return a.trim()}).map(function(a){function b(b){for(var c=lb(a),d=0;d<b.length;d++)if(c.slice(0,b[d].length)===b[d]&&!/^\w/.test(c.slice(b[d].length)))return!0;return!1}if(0<a.length){var c=
b("if else elseif for onevent sub when while".split(" "));b(["else","elseif","end","onevent","sub"])&&(x=Math.max(x-1,0));a="\t\t\t\t\t".slice(0,x)+a;c&&x++}return a});for(n=b.length-2;0<=n;n--)/^\s*#/.test(b[n])&&(m=b[n+1].replace(/^(\s*).*$/,"$1"),b[n]=m+b[n].replace(/^\s*/,""));c=b.join("\n");for(n=0;n<a.i.length;n++)for(b=n+1;b<a.i.length;b++)Ca(a.i[n],a.i[b]);return c=kb(this.b,c)};
pb.prototype.h=function(a){var b="# missing Aseba implementation for block "+a.V.name+"\n";switch(a.V.type){case "e":case "s":return{aa:b,Va:"1 == 1"};case "a":return{ka:b};default:return{}}};qa.aseba=new pb;function qb(){ib.call(this,"l2","&&","true")}qb.prototype=Object.create(ib.prototype);qb.prototype.constructor=qb;
qb.prototype.zc=function(a,b){this.b=[];var c=a.i.map(function(a){return nb(this,a)},this),d={},e=[];c.forEach(function(a){a.P&&(d[a.P]={P:a.P,ib:a.ib,Wa:a.Wa,aa:"",Ia:""},0>e.indexOf(a.P)&&e.push(a.P));a.od&&a.od.forEach(function(b,c){d[b]={P:b,ib:a.Oe[c],Wa:a.Pe[c],aa:"",Ia:""};0>e.indexOf(b)&&e.push(b)})});var f=[],g=[],h=[],k=[];c.forEach(function(b,c){b.Sb&&b.Sb.forEach(function(a){0>f.indexOf(a)&&f.push(a)});b.cc&&b.cc.forEach(function(a){0>g.indexOf(a)&&g.push(a)});b.Rb&&b.Rb.forEach(function(a){0>
h.indexOf(a)&&h.push(a)});if(b.P&&(b.Ya=k.indexOf(lb(b.Va||b.P)),0>b.Ya)){b.Ya=k.length;k.push(lb(b.Va||b.P));var e=d[b.P];b.aa&&0>e.aa.indexOf(b.aa)&&(e.aa+=b.aa);e.Ia+=b.Va?"when ("+b.Va+") {\neventCache["+b.Ya+"] = true;\n}\n":"eventCache["+b.Ya+"] = true;\n"}b.P||(b.ka=mb(this,b.ka||"",a.i[c]))},this);var m="";if(b){var q=new va,n=new z(ta("init"),null,null);xa(q,n,null,null);b.forEach(function(a){xa(q,a,null,null)});m=nb(this,q).ka}var t=[],l="",u="",p=0;for(n=0;n<a.i.length;n++)0<=c[n].Ya?(c[n].nd&&
c[n].nd.forEach(function(a){0>t.indexOf(a)&&t.push(a)}),l+="if (eventCache["+c[n].Ya+"]"+(c[n].Gb?" && "+c[n].Gb:"")+") {\ntodo["+p+"] = true;\n}\n",u+="if (todo["+p+"]) {\n"+c[n].ka+"}\n",p++):c[n].Gb&&(l+="when ("+c[n].Gb+") {\ntodo["+p+"] = true;\n}\n",u+="if (todo["+p+"]) {\n"+c[n].ka+"}\n",p++);c=0<f.length?"\n"+f.join("\n"):"";0<k.length&&(c+="bool eventCache["+k.length+"] = false;\n");b?c+="\n"+m:(n="",0<g.length&&(n+="\n"+g.join("\n")),n&&(c+=(0<c.length?"\n":"")+n.slice(1)),l&&(c+=(0<c.length?
"\n":"")+"timer.period[1] = 50;\n"));for(n=0;n<e.length;n++)!/onevent/.test(d[e[n]].P)&&(d[e[n]].Wa||d[e[n]].aa||d[e[n]].Ia)&&(c+="\n"+(d[e[n]].P||"")+(d[e[n]].Wa||"")+(d[e[n]].aa||"")+(d[e[n]].Ia||"")+(d[e[n]].ib||""));0<h.length&&(c+="\n"+h.join("\n"));for(n=0;n<e.length;n++)/onevent/.test(d[e[n]].P)&&(d[e[n]].Wa||d[e[n]].aa||d[e[n]].Ia)&&(c+="\n"+(d[e[n]].P||"")+(d[e[n]].Wa||"")+(d[e[n]].aa||"")+(d[e[n]].Ia||"")+(d[e[n]].ib||""));l&&(c+="\nonevent timer1 {\n",0<p&&(c+="bool todo["+p+"] = false;\n"),
c+=t.join("")+l+u+"eventCache = false;\n}\n");"\n"===c[0]&&(c=c.slice(1));var v=0;b=c.split("\n").map(function(a){return a.trim()}).map(function(a){var b=lb(a);if(0<b.length){var c="{"===b.slice(-1);"}"===b[0]&&(v=Math.max(v-1,0));a="\t\t\t\t\t".slice(0,v)+a;c&&v++}return a});for(n=b.length-2;0<=n;n--)/^\s*#/.test(b[n])&&(l=b[n+1].replace(/^(\s*).*$/,"$1"),b[n]=l+b[n].replace(/^\s*/,""));c=b.join("\n");for(n=0;n<a.i.length;n++)for(b=n+1;b<a.i.length;b++)Ca(a.i[n],a.i[b]);return c=kb(this.b,c)};
qb.prototype.h=function(a){var b="// missing L2 implementation for block "+a.V.name+"\n";switch(a.V.type){case "e":case "s":return{aa:b,Va:"true"};case "a":return{ka:b};default:return{}}};qa.l2=new qb;function rb(){ib.call(this,"js","&&","true")}rb.prototype=Object.create(ib.prototype);rb.prototype.constructor=rb;
rb.prototype.zc=function(a,b){this.b=[];var c=a.i.map(function(a){return nb(this,a)},this),d={},e=[];c.forEach(function(a){a.P&&(d[a.P]={P:a.P,ib:a.ib,Wa:a.Wa,aa:"",Ia:""},0>e.indexOf(a.P)&&e.push(a.P));a.od&&a.od.forEach(function(b,c){d[b]={P:b,ib:a.Oe[c],Wa:a.Pe[c],aa:"",Ia:""};0>e.indexOf(b)&&e.push(b)})});var f=[],g=[],h=[],k=[],m=[],q=0;c.forEach(function(b,c){b.Sb&&b.Sb.forEach(function(a){0>f.indexOf(a)&&f.push(a)});b.cc&&b.cc.forEach(function(a){0>g.indexOf(a)&&g.push(a)});b.Rb&&b.Rb.forEach(function(a){0>
h.indexOf(a)&&h.push(a)});var e=b.ka||"";b.Va&&(e="cond = "+b.Va+";\nif (cond && !cond0["+q+"]) {\n"+e+"}\ncond0["+q+"] = cond;\n",q++);if(b.P&&(b.Ya=k.indexOf(lb(b.Va||b.P)),0>b.Ya)){b.Ya=k.length;k.push(lb(b.Va||b.P));var l=d[b.P];b.aa&&0>l.aa.indexOf(b.aa)&&(l.aa+=b.aa);b.Va?(l.Ia+="cond = "+b.Va+";\nif (cond && !cond0["+q+"]) {\neventCache["+b.Ya+"] = true;\n}\ncond0["+q+"] = cond;\n",q++):l.Ia+="eventCache["+b.Ya+"] = true;\n"}b.P||(b.ka=mb(this,e,a.i[c]));ya(a.i[c])&&m.push(c)},this);var n=
"";if(b){var t=new va,l=new z(ta("init"),null,null);xa(t,l,null,null);b.forEach(function(a){xa(t,a,null,null)});n=nb(this,t).ka}var u=[],p="",v="",x=0;for(l=0;l<a.i.length;l++)0<=c[l].Ya?(c[l].nd&&c[l].nd.forEach(function(a){0>u.indexOf(a)&&u.push(a)}),p+="if (eventCache["+c[l].Ya+"]"+(c[l].Gb?" && "+c[l].Gb:"")+") {\ntodo["+x+"] = true;\n}\n",v+="if (todo["+x+"]) {\n"+c[l].ka+"}\n",x++):c[l].Gb&&(p+="cond = "+c[l].Gb+";\nif (cond && !cond0["+q+"]) {\ntodo["+x+"] = true;\n}\ncond0["+q+"] = cond;\n",
q++,v+="if (todo["+x+"]) {\n"+c[l].ka+"}\n",x++);0<q&&(f.unshift("var cond0;\nvar cond;\n"),g.unshift("cond0 = [];\n"));var K=0<f.length?"\n"+f.join("\n"):"";0<k.length&&(K+="var eventCache = [];\n");0<x&&(K+="var todo = [];\n");if(b)K+="\n"+n;else{b="";0<g.length&&(b+="\n"+g.join("\n"));p&&(b+="this.setTimer(1, 0.1, true);\n");for(l=0;l<a.i.length;l++)0<=m.indexOf(l)&&c[l].ka&&(b+=(0<b.length?"\n":"")+(c[l].P||"")+(c[l].ka||"")+(c[l].ib||""));b&&(K+=(0<K.length?"\n":"")+'this.addEventListener("init", function (name, param) {\n'+
b.slice(1)+"});\n")}if(0<h.length)throw"internal error, unsupported sub/onevent in js";for(l=0;l<e.length;l++)if(d[e[l]].Wa||d[e[l]].aa||d[e[l]].Ia)K+="\n"+(d[e[l]].P||"")+(d[e[l]].Wa||"")+(d[e[l]].aa||"")+(d[e[l]].Ia||"")+(d[e[l]].ib||"");if(p){K+='\nthis.addEventListener("timer1", function (name, param) {\n'+u.join("")+p+v;for(l=0;l<k.length;l++)K+="eventCache["+l+"] = false;\n";for(l=0;l<x;l++)K+="todo["+l+"] = false;\n"}0<K.trim().length&&(K+="});");"\n"===K[0]&&(K=K.slice(1));var r=0;c=K.split("\n").map(function(a){return a.trim()}).map(function(a){var b=
lb(a);if(0<b.length){var c="{"===b.slice(-1);"}"===b[0]&&(r=Math.max(r-1,0));a="\t\t\t\t\t".slice(0,r)+a;c&&r++}return a});for(l=c.length-2;0<=l;l--)/^\s*#/.test(c[l])&&(K=c[l+1].replace(/^(\s*).*$/,"$1"),c[l]=K+c[l].replace(/^\s*/,""));K=c.join("\n");for(l=0;l<a.i.length;l++)for(c=l+1;c<a.i.length;c++)Ca(a.i[l],a.i[c]);return K=kb(this.b,K)};
rb.prototype.h=function(a){var b="// missing JavaScript implementation for block "+a.V.name+"\n";switch(a.V.type){case "e":case "s":return{aa:b,Va:"true"};case "a":return{ka:b};default:return{}}};qa.js=new rb;function sb(){ib.call(this,"python","and","True")}sb.prototype=Object.create(ib.prototype);sb.prototype.constructor=sb;
sb.prototype.zc=function(a,b){this.b=[];var c=a.i.map(function(a){return nb(this,a)},this),d={},e=[];c.forEach(function(a){a.P&&(d[a.P]={P:a.P,ib:a.ib,Wa:a.Wa,aa:"",Ia:""},0>e.indexOf(a.P)&&e.push(a.P));a.od&&a.od.forEach(function(b,c){d[b]={P:b,ib:a.Oe[c],Wa:a.Pe[c],aa:"",Ia:""};0>e.indexOf(b)&&e.push(b)})});var f=[],g=[],h=[],k=[],m=0;c.forEach(function(b,c){b.Sb&&b.Sb.forEach(function(a){0>f.indexOf(a)&&f.push(a)});b.cc&&b.cc.forEach(function(a){0>g.indexOf(a)&&g.push(a)});b.Rb&&b.Rb.forEach(function(a){0>
h.indexOf(a)&&h.push(a)});if(b.P&&(b.Ya=k.indexOf(lb(b.Va||b.P)),0>b.Ya)){b.Ya=k.length;k.push(lb(b.Va||b.P));var e=d[b.P];b.aa&&0>e.aa.indexOf(b.aa)&&(e.aa+=b.aa);b.Va?(e.Ia+="cond = "+b.Va+"\nif cond and not cond0["+m+"]:\neventCache["+b.Ya+"] = True\n<\ncond0["+m+"] = cond\n",m++):e.Ia+="eventCache["+b.Ya+"] = True\n"}b.P||(b.ka=mb(this,b.ka||"",a.i[c]))},this);if(b){var q=new va,n=new z(ta("init"),null,null);xa(q,n,null,null);b.forEach(function(a){xa(q,a,null,null)});var t=nb(this,q);t.Sb.forEach(function(){});
t.Rb.forEach(function(){})}0<m&&g.unshift("cond0 = [False for i in range("+m+")]\n");var l=[],u="",p="",v=0;for(n=0;n<a.i.length;n++)0<=c[n].Ya?(c[n].nd&&c[n].nd.forEach(function(a){0>l.indexOf(a)&&l.push(a)}),u+="if eventCache["+c[n].Ya+"]"+(c[n].Gb?" and "+c[n].Gb:"")+":\ntodo["+v+"] = True\n<\n",p+="if todo["+v+"]:\n"+c[n].ka+"<\n",v++):c[n].Gb&&(u+="cond = "+c[n].Gb+"\nif cond and not cond0["+n+"]:\ntodo["+v+"] = 1\n<\ncond0["+n+"] = cond\n",p+="if todo["+v+"]:\n"+c[n].ka+"<\n",v++);c=0<f.length?
f.join("\n"):"";0<k.length&&(c+="eventCache = ["+k.map(function(){return"0"}).join(", ")+"]\n");if(0<v){c+="todo = [";for(n=0;n<v;n++)c+=0<n?", 0":"0";c+="]\n"}b?c+="\n"+t:(0<g.length&&(c+="\n"+g.join("\n")),u&&(c+=(0<c.length?"\n":"")+"thymio.timer.period[1] = 50\n"));for(n=0;n<e.length;n++)!/onevent/.test(d[e[n]].P)&&(d[e[n]].Wa||d[e[n]].aa||d[e[n]].Ia)&&(c+="\n"+(d[e[n]].P||"")+(d[e[n]].Wa||"")+(d[e[n]].aa||"")+(d[e[n]].Ia||"")+(d[e[n]].ib||""));0<h.length&&(c+="\n"+h.join("\n"));for(n=0;n<e.length;n++)/onevent/.test(d[e[n]].P)&&
(d[e[n]].Wa||d[e[n]].aa||d[e[n]].Ia)&&(c+="\n"+(d[e[n]].P||"")+(d[e[n]].Wa||"")+(d[e[n]].aa||"")+(d[e[n]].Ia||"")+(d[e[n]].ib||""));if(u){c+="\n@thymio.onevent(thymio.TIMER1)\ndef onevent_timer1():\n"+l.join("")+u+p;for(n=0;n<k.length;n++)c+="eventCache["+n+"] = False\n";for(n=0;n<v;n++)c+="todo["+n+"] = False\n";c+="<\n"}"\n"===c[0]&&(c=c.slice(1));c&&(c="import thymio\n\n"+c);c=lb(c);c=c.replace(/\n[ \t]+/g,"\n").replace(/\n<\n\n<\n/g,"\n<\n<\n");var x=0,K="";c.split("\n").map(function(a){return a.trim()}).forEach(function(a){var b=
lb(a);if(0<b.length){var c=":"===b.slice(-1);"<"===b&&(x=Math.max(x-1,0));"<"!==b&&(a="\t\t\t\t\t".slice(0,x)+a,c&&x++)}"<"!==b&&(K+=a+"\n")});c=K;for(n=0;n<a.i.length;n++)for(b=n+1;b<a.i.length;b++)Ca(a.i[n],a.i[b]);return c=kb(this.b,c)};sb.prototype.h=function(a){var b="# missing Python implementation for block "+a.V.name+"\n";switch(a.V.type){case "e":case "s":return{aa:b,Va:"True"};case "a":return{ka:b};default:return{}}};qa.python=new sb;function tb(){pb.call(this)}tb.prototype=Object.create(ib.prototype);tb.prototype.constructor=tb;tb.prototype.zc=function(a,b){a=pb.prototype.zc.call(this,a,b);b=new ub(vb);a=new wb(b,a);a.ga=xb;a=yb(a);return zb(a,!0)};qa.asm=new tb;function Ab(a){this.L=[];this.b=a||null}w=Ab.prototype;w.add=function(a,b){this.L.push(new Bb(a,b))};w.find=function(a){for(var b=0;b<this.L.length;b++)if(this.L[b].name===a)return this.L[b];return null};function Cb(a,b){a=a.find(b);return null!=a&&null!=a.m}function Db(a,b){if(a.b){var c=a.find(b);b={cmd:b};c.h&&(b.selected=c.Ua());c.b&&(b.state=c.getState());a.b({type:"cmd",data:b})}}w.lb=function(a,b){this.b&&this.b({type:"drop",data:{cmd:a}});(a=this.find(a))&&a.lb(b)};
w.kb=function(a,b){a=this.find(a);return null!=a&&a.kb(b)};w.T=function(a){a=this.find(a);return null!=a&&a.T()};w.isEnabled=function(a){a=this.find(a);return null!=a&&a.isEnabled()};w.Ua=function(a){a=this.find(a);return null!=a&&a.Ua()};w.getState=function(a){a=this.find(a);return null!=a?a.getState():null};
function Bb(a,b){this.name=a;this.o=b.isEnabled||null;this.h=b.Ua||null;this.b=b.getState||null;this.m=b.action||null;this.M=b.lb||null;this.v=b.kb||null;this.Cc=b.object||null;this.Pc=b.Pc||!1;this.R=b.T||null;this.cb=b.cb||null}function Eb(a,b){a.isEnabled()&&a.m&&a.m(a.Cc,b)}function Fb(a,b){if(!a.b)return!1;var c=a.getState();if(b===c)return!0;for(var d=0;100>d;d++){Eb(a,void 0);var e=a.getState();if(e===b)return!0;if(e===c)break}return!1}w=Bb.prototype;
w.lb=function(a){this.kb(a)&&this.M&&this.M(this.Cc,a)};w.kb=function(a){return null!=this.v&&this.v(this.Cc,a)};w.isEnabled=function(){return null==this.o||this.o(this.Cc)};w.Ua=function(){return null!=this.h&&this.h(this.Cc)};w.getState=function(){return null!=this.b?this.b(this.Cc):null};w.T=function(){return null==this.R||this.R(this.Cc)};function Hb(a){Ib||(Ua(),Ib=!0);this.hb=a;this.da=new Jb;this.h=new Ha;this.ia=new Fa;var b=this;this.L=new Ab(function(a){b.log(a)});this.Pb=null;this.ga="vpl:close !space vpl:about vpl:help !space vpl:new vpl:save vpl:load vpl:upload vpl:filename vpl:exportToHTML !space vpl:advanced !stretch vpl:readonly !stretch vpl:undo vpl:redo !stretch vpl:connected !stretch vpl:run vpl:stop vpl:debug vpl:robot !stretch vpl:sim vpl:text !stretch vpl:teacher-reset vpl:teacher-save vpl:teacher-setasnew vpl:teacher".split(" ");
this.M="!!stretch vpl:message-error vpl:message-warning !!stretch vpl:duplicate vpl:disable vpl:lock vpl:trashcan".split(" ");this.Oa="src:close !space src:new src:save !space src:language src:disass !stretch src:run src:stop !stretch src:sim src:vpl !space src:locked !stretch src:teacher-reset src:teacher".split(" ");this.Aa="sim:close !stretch sim:restart sim:pause !space sim:speedup sim:noise !stretch sim:pen sim:clear !space sim:map-kind sim:map sim:map-ground sim:map-obstacles sim:map-height !stretch sim:vpl sim:text !stretch sim:teacher-reset sim:teacher".split(" ");
this.Ba=["vpl"];this.kc={vpl:1,src:1,sim:1};this.Sc=["ground","height","obstacles"];this.Rd=this.If=this.Ge=this.ue=this.Ee=null;this.tc=!1;this.username=null;this.i=new Ma(this.ia);hb(this.i,function(a){b.log(a)});this.ic="";this.Td=!1;this.ca=new Kb(a,{da:this.da});this.ca.state={nh:new Lb};this.R="";this.G=this.b=null;this.Ma=[];this.ya=-1;this.$f=this.Ld=!1;this.o=null;this.ca.Oa=function(){null!==b.o&&(b.o=null,Mb(b))};this.m=null;this.Xb=[];this.Me=this.qb=null}var Ib=!1;
Hb.prototype.translate=function(a,b){return this.h.translate(a,b)};function Nb(a,b){a.ue=b?new Ob(b):null}function Pb(a,b){a.If=b?new Ob(b,!1,[{title:"\u21d3",za:function(){Qb(b,"doc.html","text/html")}}]):null}
function Rb(a){if(a.v){var b="b"===a.i.mode?a.i.$b:a.i.nc;a.v.tf={};var c=Sb(100,100);Ya.forEach(function(a){try{var b=new z(a,null,null);b.g=a.gb?a.gb():b.g;var d="vpl:block:"+a.name.replace(/ /g,"-"),g=b.toDataURL(this.da,c,1);this.v.tf[d]=g}catch(h){}},a);b=a.v.zc(a.h.language,b);Pb(a,b)}}
Hb.prototype.fb=function(a,b){function c(){0<=a.indexOf("vpl")&&B(d.ca);0<=a.indexOf("src")&&B(d.I.Ha);0<=a.indexOf("sim")&&B(d.b)}var d=this;b&&(b.fa||b.Yf)&&(this.i.fa=!0,this.I.fa=!0,Tb(this.I,!1));if(1===a.length&&b&&b.Kd&&1<this.Ba.length){if(0<=this.Ba.indexOf(a[0]))return;var e=this.Ba.slice();e[this.Ba[0]===b.Kd?1:0]=a[0];a=e}else b&&b.Nd?0>this.Ba.indexOf(a[0])&&(a=this.Ba.concat(a)):1===a.length&&b&&b.Xe&&1<this.Ba.length&&0<=this.Ba.indexOf(a[0])?(this.Ba.splice(this.Ba.indexOf(a[0]),1),
a=this.Ba):1===a.length&&b&&b.toggle&&(0<=this.Ba.indexOf(a[0])?(this.Ba.splice(this.Ba.indexOf(a[0]),1),a=this.Ba):a=this.Ba.concat(a));this.Ba=a;null!=this.G&&this.b.Bc();this.ca.Bc();null!=this.I&&(document.getElementById("src-editor").style.display=0<=a.indexOf("src")?"block":"none",this.I.Ha.Bc());0<=a.indexOf("vpl")&&this.ca.show();0<=a.indexOf("src")&&this.I.Ha.show();null!=this.G&&0<=a.indexOf("sim")&&this.b.show();Ub(this,window.innerWidth<window.innerHeight);for(e=0;e<a.length;e++)switch(a[e]){case "vpl":this.ca.qa=
function(){if(!d.i.fa){d.i.code={};var a=d.i;if(0!==a.i.length&&a.i[a.i.length-1].Tb())for(;1<a.i.length&&a.i[a.i.length-2].Tb();)a.i.splice(-2,1);else a.i.push(new va);if(d.I){a=d.I;var b=d.i.ac(d.i.Cb);if(a.gd){var c=a.ce(a.language,b);null!==c&&(Vb(a,c,!0),a.gc.vb.readOnly=!0,a.gd=b)}else Vb(a,b)}d.log()}Mb(d)};break;case "src":Tb(this.I,!(b&&(b.fa||b.Yf)));this.I.focus();this.I.resize(window.innerWidth,window.innerHeight);break;case "sim":this.b.qa=function(){Wb(d)}}b&&(b.Xe||b.Nd)&&Xb(d);this.ca&&
(this.ca.pb=c);this.I&&this.I.Ha&&(this.I.Ha.pb=c);this.b&&(this.b.pb=c);0<=a.indexOf("vpl")&&(this.ca.qa(),this.ca.pb?this.ca.pb():B(this.ca));0<=a.indexOf("src")&&(Yb(this),this.I.Ha.pb?this.I.Ha.pb():B(this.I.Ha));0<=a.indexOf("sim")&&(this.start(!1),this.b.qa(),this.b.pb?this.b.pb():B(this.b))};Hb.prototype.setView=Hb.prototype.fb;
function Ub(a,b){for(var c=a.Ba.map(function(a){return this.kc[a]},a),d=c.reduce(function(a,b){return a+b},0),e=0,f=0;f<a.Ba.length;f++){var g=b?{X:0,oa:1,Y:e,la:e+c[f]/d}:{X:e,oa:e+c[f]/d,Y:0,la:1};e+=c[f]/d;switch(a.Ba[f]){case "vpl":Zb(a.ca,g);break;case "src":Zb(a.I.Ha,g);break;case "sim":Zb(a.b,g)}}}
function Xb(a){var b=a.ca.b.parentElement.getBoundingClientRect(),c=b.width;b=window.innerHeight-b.top;Ub(a,c<b);window.vplDisableResize&&(b=a.ca.b.getBoundingClientRect(),c=b.width,b=b.height);a.ca.resize(c,b);a.I&&a.I.resize(c,b);a.G&&a.b.resize(c,b);a.Ba.forEach(function(a){switch(a){case "vpl":Mb(this);break;case "src":B(this.I.Ha);break;case "sim":this.G&&Wb(this)}},a);a.ue&&$b(a.ue)}function ac(a){if(0<=a.ya){var b=ta("!stop"),c=a.i.Cb;(b=b&&b.Jb[c])&&a.Ma[a.ya].eb.Zb(b(null).ka,c)}}
function bc(a){return!a.i.fa&&a.Ma[a.ya].eb.isEnabled(a.i.Cb)}function cc(a,b){a.Xb.push(b)}
Hb.prototype.log=function(a){if(null==a){dc(this);a={type:"vpl-changed",data:{filename:this.i.filename,nrules:this.i.i.reduce(function(a,b){return 0<b.U.length+b.actions.length?a+1:a},0),nblocks:this.i.i.reduce(function(a,b){return a+b.U.length+b.actions.length},0),error:this.ic&&!this.Td?this.ic:null,warning:this.ic&&this.Td?this.ic:null,robot:0<=this.ya?this.Ma[this.ya].eb.isConnected()&&this.Ma[this.ya].eb.getName():null}};var b=JSON.stringify(a);if(b===this.qb)return;this.qb=b}this.Xb.forEach(function(b){try{b(a)}catch(d){}})};function ec(a){function b(b){function d(b){for(var c=0;c<x.length;c++)if(x[c].uri){var d=fc(x[c].uri);if(a.ub[d.Ic].Hf(b,d.id))return!0}return!1}var e=b.name;if("!"===e[0])return 0;var h=0;/^\w/.test(e)||(c+='Bad block name "'+e+'"\n',h++);var k=b.defaultParameters,m=b.typicalParameters,q=b.buttons,n=b.radiobuttons,t=b.sliders,l=b.rotating,u=b.diffwheelmotion,p=b.score,v=b.otherParameters?parseInt(b.otherParameters,10):0,x=b.draw;if(x){b=null;for(var K=0;K<x.length;K++)if(x[K].uri)if(null==b){b=fc(x[K].uri).Ic;
var r=a.ub[b]}else{var J=fc(x[K].uri);J.Ic!==b?(c+='In block "'+e+'", multiple svg\n',h++):r.oc(J.id)||(c+='In block "'+e+'", uri "'+x[K].uri+'" not found\n',h++)}}q&&q.forEach(function(a){r.oc(a.id)?d(a.id)||(c+='In block "'+e+'", button id "'+a.id+'" not displayed\n',h++):(c+='In block "'+e+'", button id "'+a.id+'" not found\n',h++);void 0==a.val?(c+='In block "'+e+'", missing property "val"\n',h++):void 0==a.st?(c+='In block "'+e+'", missing property "st"\n',h++):a.val.length!==a.st.length&&(c+=
'In block "'+e+'", properties "val" and "st" have different lengths\n',h++)});n&&n.forEach(function(a){r.oc(a.id)?d(a.id)?void 0==a.val?(c+='In block "'+e+'", missing property "val"\n',h++):a.val instanceof Array?(c+='In block "'+e+'", illegal array in property "val"\n',h++):void 0==a.st?(c+='In block "'+e+'", missing property "st"\n',h++):2!==a.st.length&&(c+='In block "'+e+'", property "st" must have length 2\n',h++):(c+='In block "'+e+'", radiobutton id "'+a.id+'" not displayed\n',h++):(c+='In block "'+
e+'", radiobutton id "'+a.id+'" not found\n',h++)});t&&t.forEach(function(a){r.oc(a.id)?d(a.id)||(c+='In block "'+e+'", slider id "'+a.id+'" not displayed\n',h++):(c+='In block "'+e+'", slider id "'+a.id+'" not found\n',h++);r.oc(a.thumbId)?d(a.thumbId)||(c+='In block "'+e+'", slider thumbId "'+a.thumbId+'" not displayed\n',h++):(c+='In block "'+e+'", slider thumbId "'+a.thumbId+'" not found\n',h++);void 0==a.min&&(c+='In block "'+e+'", slider min undefined\n',h++);void 0==a.max&&(c+='In block "'+
e+'", slider max undefined\n',h++);a.lowerPartId&&!r.oc(a.lowerPartId)&&(c+='In block "'+e+'", slider lowerPartId "'+a.lowerPartId+'" not found\n',h++);if(a.snap&&(a=a.snap,a instanceof Array))for(var b=0;b<a.length;b++)"string"===typeof a[b]?/^`.+`$/.test(a[b])||(c+='In block "'+e+'", invalid slider snap expression\n',h++):"number"!==typeof a[b]&&(c+='In block "'+e+'", slider snap must be a number or a string\n',h++)});l&&l.forEach(function(a){var b=a.id,f=a.centerId;a=a.thumbId;r.oc(b)?d(b)||(c+=
'In block "'+e+'", rotating id "'+b+'" not displayed\n',h++):(c+='In block "'+e+'", rotating id "'+b+'" not found\n',h++);r.oc(f)||(c+='In block "'+e+'", rotating centerId "'+f+'" not found\n',h++);r.oc(a)?d(a)||(c+='In block "'+e+'", rotating thumbId "'+a+'" not displayed\n',h++):(c+='In block "'+e+'", rotating thumbId "'+a+'" not found\n',h++);r.Hf(a,b)||(c+='In block "'+e+'", rotating thumbId "'+a+'" not a descendent of id "'+b+'"\n',h++)});u&&(r.oc(u.id)?d(u.id)||(c+='In block "'+e+'", diffwheelmotion id "'+
u.id+'" not displayed\n',h++):(c+='In block "'+e+'", diffwheelmotion id "'+u.id+'" not found\n',h++));p&&(r.oc(p.id)?d(p.id)||(c+='In block "'+e+'", score id "'+p.id+'" not displayed\n',h++):(c+='In block "'+e+'", score id "'+p.id+'" not found\n',h++),"number"!==typeof p.numHeights||p.numHeights!==Math.round(p.numHeights)||0>=p.numHeights)&&(c+='In block "'+e+'", score numHeights must be a strictly positive integer\n',h++);(q||n||t||l||p||0<v)&&!k&&(c+='In block "'+e+'", missing defaultParameters\n',
h++);k&&(u=0,q&&(u+=q.length),n&&(u+=1),t&&(u+=t.length),l&&(u+=l.length),p&&(u+=2*Math.floor((k.length-u)/2)),u+=v,u!==k.length?(c+='In block "'+e+'", defaultParameters.length='+k.length+", needs "+u+" parameters\n",h++):m&&m.length!=u&&(c+='In block "'+e+'", typicalParameters.length='+m.length+", needs "+u+" parameters\n",h++));return h}var c="",d=0;a.blocks&&a.blocks.forEach(function(a){d+=b(a)});0<d&&(c+=d+" error"+(1<d?"s":"")+"\n");return c||null};function gc(a){a.L.add("vpl:close",{action:function(a){a.fb(["vpl"],{Xe:!0})},object:a,T:function(a){return 1<a.Ba.length&&0<=a.Ba.indexOf("vpl")}});a.L.add("vpl:about",{action:function(a){a.ue.show()},object:a,T:function(a){return null!=a.ue}});a.L.add("vpl:help",{action:function(a){a.If.show()},object:a,T:function(a){return null!=a.If}});a.L.add("vpl:readonly",{isEnabled:function(){return!1},object:a,T:function(a){return a.i.readOnly||a.i.fa}});a.L.add("vpl:suspend",{action:function(a){a.tc=!a.tc;
a.tc?(bc(a)&&(ac(a),a.i.Dc=!1),a.Rd.show()):a.Rd.Bc()},Ua:function(a){return a.tc},object:a,T:function(a){return a.i.Eb===Na&&null!=a.Rd}});a.L.add("vpl:new",{action:function(a){Za(a.i);a.Ee&&hc(a,a.Ee)},isEnabled:function(a){return!a.i.fa&&!a.i.readOnly&&!a.i.Tb()},object:a,T:function(a){return!a.i.readOnly}});a.L.add("vpl:save",{action:function(a,c){c?(a=ic(a,a.da),Qb(a,"vpl-program.html","text/html")):(c=db(a.i,{Zc:!0,bd:!0}),Qb(c,a.i.filename||"program.vpl3","application/x-vpl3"))},isEnabled:function(a){return!a.i.fa&&
!a.i.Tb()},object:a,T:function(a){return!a.i.readOnly}});a.L.add("vpl:load",{action:function(a){a.Ge.show("Open program file",".aesl,.json,.vpl3,.vpl3ui",function(b){jc(a,b)})},isEnabled:function(a){return!a.i.fa&&!a.i.readOnly},object:a,T:function(a){return!a.i.readOnly}});a.L.add("vpl:upload",{action:function(a){var b=db(a.i,{Zc:!1,bd:!0});window.vplUpload(a.i.filename,b)},isEnabled:function(a){return!a.i.fa&&!a.i.readOnly&&!a.i.Tb()},object:a,T:function(a){return null!=window.vplUpload&&!a.i.readOnly}});
a.L.add("vpl:exportToHTML",{action:function(a,c){c?(a=kc(a,a.da),Qb(a,"vpl-ui.html","text/html")):(a=ic(a,a.da),Qb(a,"vpl-program.html","text/html"))},isEnabled:function(a){return!a.i.fa&&!a.i.Tb()},object:a});a.L.add("vpl:text",{action:function(a){a.Ld?a.fb(["src"],{Nd:!0}):a.fb(["src"],{Kd:"vpl"})},isEnabled:function(a){return!a.i.fa},lb:function(a,c){if(c.data instanceof z&&c.data.Ab){if(c=fb(a.i.Cb,c.data))a.fb(["src"]),a.I.pf(c.Gd,c.end)}else c.data instanceof va&&(c=fb(a.i.Cb,c.data))&&(a.fb(["src"]),
a.I.pf(c.Gd,c.end))},kb:function(a,c){return c.data instanceof z&&null!=c.data.Ab||c.data instanceof va},object:a,T:function(a){return a.I&&0>a.Ba.indexOf("src")}});a.L.add("vpl:text-toggle",{action:function(a){a.fb(["src"],{toggle:!0})},isEnabled:function(a){return!a.i.fa},Ua:function(a){return 0<=a.Ba.indexOf("src")},object:a,cb:[{selected:!1},{selected:!0}]});a.L.add("vpl:advanced",{action:function(a){cb(a.i,"b"===a.i.mode?"a":"b");Rb(a)},isEnabled:function(a){return!a.i.fa&&!a.i.readOnly},Ua:function(a){return"a"===
a.i.mode},object:a,T:function(a){return Ta&&!a.i.readOnly},cb:[{selected:!1},{selected:!0}]});a.L.add("vpl:undo",{action:function(a){a.i.Xf(function(){Mb(a)})},isEnabled:function(a){return!a.i.fa&&0<a.i.Tc.hc.length},object:a,T:function(a){return!a.i.readOnly}});a.L.add("vpl:redo",{action:function(a){a.i.Pf(function(){Mb(a)})},isEnabled:function(a){return!a.i.fa&&0<a.i.Tc.cd.length},object:a,T:function(a){return!a.i.readOnly}});a.L.add("vpl:run",{action:function(a){var b=a.i.ac(a.i.Cb);a.Ma[a.ya].eb.Zb(b,
a.i.Cb);a.i.Dc=!0;a.i.Lf=!1},isEnabled:function(a){if(a.i.fa||!a.Ma[a.ya].eb.isEnabled(a.i.Cb))return!1;a=a.i.getError();return null==a||a.Kb},Ua:function(a){return a.i.Dc},getState:function(a){if(a.i.Tb())return"empty";if(a.i.Dc)return"running";var b=a.i.getError();return b&&!b.Kb?"error":a.i.Lf?"canLoad":"canReload"},lb:function(a,c){c.data instanceof z?c.data.Ab?(c=qa[a.i.Cb].zc(a.i,[c.data]),a.Ma[a.ya].eb.Zb(c,a.i.Cb)):a.ca.wb=lc(a.ca,c):c.data instanceof va&&(c=qa[a.i.Cb].zc(a.i,c.data.actions),
a.Ma[a.ya].eb.Zb(c,a.i.Cb))},kb:function(a,c){if(a=a.Ma[a.ya].eb.isEnabled(a.i.Cb)&&c.data instanceof va)a:{a=c.data;for(var b=0;b<a.U.length;b++)if("a"===a.U[b].V.type){a=!0;break a}for(b=0;b<a.actions.length;b++)if("a"===a.actions[b].V.type){a=!0;break a}a=!1}return a||c.data instanceof z&&null!=c.data.Ab&&"a"===c.data.V.type},object:a,T:function(a){return 0<=a.ya},cb:[{selected:!1},{selected:!0},{state:"empty"},{state:"running"},{state:"error"},{state:"canLoad"},{state:"canReload"}]});a.L.add("vpl:stop",
{action:function(a){ac(a);a.i.Dc=!1},isEnabled:function(a){return bc(a)},object:a,T:function(a){return 0<=a.ya}});a.L.add("vpl:debug",{action:function(){},Ua:function(){return!1},object:a,T:function(){return!1},cb:[{selected:!1},{selected:!0}]});a.L.add("vpl:connected",{Ua:function(a){return!a.i.fa&&a.Ma[a.ya].eb.isConnected()},getState:function(a){return a.Me?"monitored":!1===a.Me?"nonmonitored":""},object:a,T:function(a){return 0<=a.ya},cb:[{selected:!1},{selected:!0},{selected:!1,state:"monitored"},
{selected:!0,state:"monitored"},{selected:!1,state:"nonmonitored"},{selected:!0,state:"nonmonitored"}]});a.L.add("vpl:robot",{action:function(a){a.ya=(a.ya+1)%a.Ma.length},getState:function(a){return a.Ma[a.ya].name},object:a,T:function(a){return 1<a.Ma.length}});a.L.add("vpl:sim",{action:function(a){a.Ld?a.fb(["sim"],{Nd:!0}):a.fb(["sim"],{Kd:"vpl"})},isEnabled:function(a){return!a.i.fa},object:a,T:function(a){return 0<=a.ya&&null!=a.G&&0>a.Ba.indexOf("sim")}});a.L.add("vpl:duplicate",{isEnabled:function(a){return!a.i.fa},
lb:function(a,c){var b=a.i.i.indexOf(c.data);0<=b&&(a.i.Bb(),a.i.i.splice(b+1,0,c.data.ob()),a.ca.qa&&a.ca.qa(),a.log())},kb:function(a,c){return c.data instanceof va&&!c.data.Tb()},object:a,T:function(a){return!a.i.readOnly}});a.L.add("vpl:disable",{isEnabled:function(a){return!a.i.fa},lb:function(a,c){c.data instanceof z?(a.i.Bb(),c.data.disabled=!c.data.disabled,a.ca.qa&&a.ca.qa(),a.log()):c.data instanceof va&&(a.i.Bb(),c=c.data,c.disabled=!c.disabled,c.disabled&&(c.error=null),a.ca.qa&&a.ca.qa(),
a.log())},kb:function(a,c){return c.data instanceof va?!c.data.Tb():c.data instanceof z&&null!==c.data.Ab},object:a,T:function(a){return!a.i.readOnly}});a.L.add("vpl:lock",{isEnabled:function(a){return!a.i.fa},lb:function(a,c){c.data instanceof z?(a.i.Bb(),c.data.locked=!c.data.locked,a.ca.qa&&a.ca.qa(),a.log()):c.data instanceof va&&(a.i.Bb(),c.data.locked=!c.data.locked,a.ca.qa&&a.ca.qa(),a.log())},kb:function(a,c){return c.data instanceof va?!c.data.Tb():c.data instanceof z&&null!==c.data.Ab},
object:a,T:function(a){return a.i.qg&&"t"===a.i.Eb&&!a.i.readOnly}});a.L.add("vpl:trashcan",{isEnabled:function(a){return!a.i.fa},lb:function(a,c){c.data instanceof z?null!==c.data.Ab&&(a.i.Bb(),Aa(c.data.Ab,c.data.je),a.ca.qa&&a.ca.qa(),a.log()):c.data instanceof va&&(c=a.i.i.indexOf(c.data),0<=c&&(a.i.Bb(),a.i.i.splice(c,1),a.ca.qa&&a.ca.qa(),a.log()))},kb:function(a,c){return c.data instanceof z?null!==c.data.Ab&&!c.data.locked:c.data instanceof va&&(!c.data.Tb()||a.i.i.indexOf(c.data)+1<a.i.i.length)&&
!c.data.locked},object:a,T:function(a){return!a.i.readOnly}});a.L.add("vpl:message-error",{isEnabled:function(){return!1},getState:function(a){return a.ic},object:a,T:function(a){return a.ic&&!a.Td}});a.L.add("vpl:message-warning",{isEnabled:function(){return!1},getState:function(a){return a.ic},object:a,T:function(a){return a.ic&&a.Td}});a.L.add("vpl:message-empty",{isEnabled:function(){return!1},object:a,T:function(a){return!a.ic}});a.L.add("vpl:filename",{isEnabled:function(){return!1},getState:function(a){return(a.i.filename||
"")+(a.username?"\n"+a.username:"")},object:a,T:function(a){return a.i.filename||a.username?!0:!1}});a.L.add("vpl:teacher",{action:function(a){a.i.ia.xb=!a.i.ia.xb;"t"===a.i.Eb?a.i.ia.Wb=a.i.ia.xb:a.i.ia.qe=a.i.ia.xb;a.i.ia.xb||Rb(a)},isEnabled:function(a){return!a.i.fa&&!a.i.readOnly},Ua:function(a){return a.i.ia.xb},object:a,Pc:!0,T:function(a){return a.i.Eb!==Na&&!a.i.readOnly},cb:[{selected:!1},{selected:!0}]});a.L.add("vpl:teacher-reset",{action:function(a,c){c?(Xa(a.i.mode),a.i.$b=Pa,a.i.nc=
Ra):(Ua(),Za(a.i),a.i.ke())},isEnabled:function(a){return!a.i.fa},object:a,Pc:!0,T:function(a){return a.i.Eb!==Na&&a.i.ia.xb&&!a.i.readOnly}});a.L.add("vpl:teacher-save",{action:function(a){a=db(a.i,{Zc:!0,bd:!1});Qb(a,"ui.vpl3ui","application/x-vpl3-ui")},isEnabled:function(a){return!a.i.fa},object:a,Pc:!0,T:function(a){return a.i.Eb!==Na&&a.i.ia.xb&&!a.i.readOnly}});a.L.add("vpl:teacher-setasnew",{action:function(a){var b=db(a.i,{Zc:!0,bd:!1});a.Ee=a.Ee===b?null:b},Ua:function(a){return a.Ee===
db(a.i,{Zc:!0,bd:!1})},object:a,Pc:!0,T:function(a){return a.i.Eb!==Na&&a.i.ia.xb&&!a.i.readOnly},cb:[{selected:!1},{selected:!0}]})};function mc(a){this.h=a;this.controls=[];this.b="";this.y=this.x=0}function nc(a,b,c,d,e,f,g){a.controls.push({H:b,action:d||null,lb:e||null,kb:f||null,id:g||"",Gc:c,x:0,y:0});a.b+="X"}
function oc(a,b,c,d){a.x=b.x;a.y=b.y;for(var e=a.b.replace(/^[s ]+/,"").replace(/[s ]+$/,"").replace(/ +/g," ").replace(/s +/g,"s").replace(/ +s/g,"s").replace(/s+/g,"s"),f=0,g=0,h=0,k=0,m=0;m<e.length;m++)switch(e[m]){case "X":f+=C(c[a.controls[k].id]);k++;break;case " ":case "_":g++;break;case "s":case "S":h++}d=d?C(d):0;var q=0;if(f>=b.width)d=0;else for(;;){q=(b.width-(f+d*g))/h;if(q>=d||!(0<d))break;d/=2}k=0;f=b.x;for(m=0;m<e.length;m++)switch(e[m]){case "X":g=a.controls[k];g.x=f+c[g.id].offsetLeft();
f+=C(c[g.id]);g.y=b.y+c[g.id].offsetTop();k++;break;case " ":case "_":f+=d;break;case "s":case "S":f+=q}}function pc(a,b,c,d){D(a.h,function(c){qc(b,c,a.x,a.y)});a.controls.forEach(function(a){rc(this.h,a.x,a.y,c[a.id],function(b,c,d){var e=Math.min(c.width/(a.Gc.oa-a.Gc.X),c.height/(a.Gc.la-a.Gc.Y));b.save();b.translate(-a.Gc.X,-a.Gc.Y);b.scale(e,e);a.H(b,c,d);b.restore()},a.action,a.lb,a.kb,d?function(){d(a.id)}:null,a.id)},a)};function sc(a,b,c,d,e,f,g,h,k,m){function q(a,d,e){b.save();e&&(b.scale(-1,1),b.translate(-2*a-c.c,0));b.fillStyle=k&&g?l.wa:l.sa;b.fillRect(a,d,c.c,c.c);b.fillStyle=g?l.O:l.ba;b.beginPath();b.moveTo(a+.1*c.c,d+.6*c.c);b.lineTo(a+.4*c.c,d+.6*c.c);b.lineTo(a+.25*c.c,d+.34*c.c);b.closePath();b.fill();b.beginPath();b.arc(a+.5*c.c,d+.83*c.c,.4*c.c,4.2,5.6);b.strokeStyle=b.fillStyle;b.lineWidth=.08*c.c;b.stroke();b.restore()}function n(a,d,e){var f=c.c;b.save();b.fillStyle=k?l.wa:l.sa;b.fillRect(a,d,f,
f);b.translate(a+f/2,d+f/2);b.rotate(-e*Math.PI/2);b.translate(-a-f/2,-d-f/2);b.beginPath();b.moveTo(a+.3557*f,d+.25*f);b.lineTo(a+.3557*f,d+.75*f);b.lineTo(a+.7887*f,d+.5*f);b.closePath();b.strokeStyle=l.O;b.lineWidth=2*c.ta;b.stroke();b.restore()}function t(){b.beginPath();b.moveTo(0,.5*c.c);b.lineTo(.5*c.c,.5*c.c);b.lineTo(.5*c.c,-.25*c.c);b.bezierCurveTo(.3*c.c,-.5*c.c,.02*c.c,-.5*c.c,0,-.5*c.c);b.lineTo(0,-.5*c.c);b.bezierCurveTo(-.02*c.c,-.5*c.c,-.3*c.c,-.5*c.c,-.5*c.c,-.25*c.c);b.lineTo(-.5*
c.c,.5*c.c);b.closePath();b.fillStyle=g?l.O:l.ba;b.fill()}var l={sa:"navy",wa:"#37f",Xc:"#06f",O:"white",ba:"#777",Jc:"#44a",Bf:"#ddf",ee:"#99a",we:"#a00",vf:"#d10",xe:"#d00",wf:"#f50",Jd:"#c66",Cf:"#800"};l={sa:"white",wa:"#ddd",Xc:"white",O:"#333",ba:"#999",Jc:"#ddd",Bf:"#555",ee:"#666",we:"#fcc",vf:"#fcc",xe:"#faa",wf:"#faa",Jd:"#866",Cf:"#faa"};var u=F(d,{tag:"button",W:e,id:a.replace(/:/g,"-")}),p={"vpl:close":function(){b.fillStyle=k&&g?l.wa:l.sa;b.fillRect(0,0,.5*c.c,c.c);b.beginPath();b.moveTo(.1*
c.c,.1*c.c);b.lineTo(.4*c.c,.4*c.c);b.moveTo(.1*c.c,.4*c.c);b.lineTo(.4*c.c,.1*c.c);b.strokeStyle=g?l.O:l.ba;b.lineWidth=c.ta;b.stroke()},"vpl:about":function(){b.fillStyle=k&&g?l.wa:l.sa;b.fillRect(0,0,c.c,c.c);b.textAlign="center";b.textBaseline="middle";b.font="bold "+Math.round(.7*c.c).toString(10)+"px times";b.fillStyle=g?l.O:l.ba;b.fillText("i",.5*c.c,.5*c.c)},"vpl:help":function(){b.fillStyle=k&&g?l.wa:l.sa;b.fillRect(0,0,c.c,c.c);b.textAlign="center";b.textBaseline="middle";b.font="bold "+
Math.round(.7*c.c).toString(10)+"px times";b.fillStyle=g?l.O:l.ba;b.fillText("?",.5*c.c,.5*c.c)},"vpl:readonly":function(){var a=c.c;b.save();b.fillStyle=l.ee;b.strokeStyle=l.ee;b.lineWidth=c.ta;b.translate(.5*a,.7*a);b.save();b.rotate(.6);b.beginPath();b.moveTo(-.015/.22*a,.07*a);b.lineTo(0,.22*a);b.lineTo(.015/.22*a,.07*a);b.fill();b.beginPath();b.moveTo(-.1*a,-.4*a);b.lineTo(-.1*a,0);b.lineTo(0,.22*a);b.lineTo(.1*a,0);b.lineTo(.1*a,-.4*a);b.restore();b.moveTo(-.2*a,-.4*a);b.lineTo(.4*a,.2*a);b.stroke();
b.restore()},"vpl:new":function(){b.fillStyle=k&&g?l.wa:l.sa;b.fillRect(0,0,c.c,c.c);b.beginPath();b.moveTo(.25*c.c,.2*c.c);b.lineTo(.25*c.c,.8*c.c);b.lineTo(.75*c.c,.8*c.c);b.lineTo(.75*c.c,.3*c.c);b.lineTo(.65*c.c,.2*c.c);b.closePath();b.moveTo(.65*c.c,.2*c.c);b.lineTo(.65*c.c,.3*c.c);b.lineTo(.75*c.c,.3*c.c);b.strokeStyle=g?l.O:l.ba;b.lineWidth=c.ta;b.stroke()},"vpl:save":function(){b.fillStyle=k&&g?l.wa:l.sa;b.fillRect(0,0,c.c,c.c);b.beginPath();b.moveTo(.25*c.c,.2*c.c);b.lineTo(.25*c.c,.7*c.c);
b.lineTo(.67*c.c,.7*c.c);b.lineTo(.67*c.c,.27*c.c);b.lineTo(.6*c.c,.2*c.c);b.closePath();b.moveTo(.6*c.c,.2*c.c);b.lineTo(.6*c.c,.27*c.c);b.lineTo(.67*c.c,.27*c.c);b.strokeStyle=g?l.O:l.ba;b.lineWidth=c.ta;b.stroke();b.lineWidth=2*c.ta;b.beginPath();b.moveTo(.8*c.c,.5*c.c);b.lineTo(.8*c.c,.8*c.c);b.moveTo(.7*c.c,.7*c.c);b.lineTo(.8*c.c,.8*c.c);b.lineTo(.9*c.c,.7*c.c);b.stroke()},"vpl:exportToHTML":function(){b.fillStyle=k&&g?l.wa:l.sa;b.fillRect(0,0,c.c,c.c);b.strokeStyle=g?l.O:l.ba;b.lineWidth=2*
c.ta;b.beginPath();b.moveTo(.8*c.c,.2*c.c);b.lineTo(.8*c.c,.5*c.c);b.moveTo(.7*c.c,.4*c.c);b.lineTo(.8*c.c,.5*c.c);b.lineTo(.9*c.c,.4*c.c);b.textAlign="center";b.textBaseline="middle";b.font="bold "+Math.round(.3*c.c).toString(10)+"px sans-serif";b.fillStyle=g?l.O:l.ba;b.fillText("HTML",.5*c.c,.7*c.c);b.stroke()},"vpl:load":function(){b.fillStyle=k&&g?l.wa:l.sa;b.fillRect(0,0,c.c,c.c);b.beginPath();b.moveTo(.25*c.c,.2*c.c);b.lineTo(.25*c.c,.7*c.c);b.lineTo(.67*c.c,.7*c.c);b.lineTo(.67*c.c,.27*c.c);
b.lineTo(.6*c.c,.2*c.c);b.closePath();b.moveTo(.6*c.c,.2*c.c);b.lineTo(.6*c.c,.27*c.c);b.lineTo(.67*c.c,.27*c.c);b.strokeStyle=g?l.O:l.ba;b.lineWidth=c.ta;b.stroke();b.lineWidth=2*c.ta;b.beginPath();b.moveTo(.8*c.c,.55*c.c);b.lineTo(.8*c.c,.85*c.c);b.moveTo(.7*c.c,.65*c.c);b.lineTo(.8*c.c,.55*c.c);b.lineTo(.9*c.c,.65*c.c);b.stroke()},"vpl:upload":function(){b.fillStyle=k&&g?l.wa:l.sa;b.fillRect(0,0,c.c,c.c);b.beginPath();b.moveTo(.25*c.c,.3*c.c);b.lineTo(.25*c.c,.8*c.c);b.lineTo(.67*c.c,.8*c.c);b.lineTo(.67*
c.c,.37*c.c);b.lineTo(.6*c.c,.3*c.c);b.closePath();b.moveTo(.6*c.c,.3*c.c);b.lineTo(.6*c.c,.37*c.c);b.lineTo(.67*c.c,.37*c.c);b.strokeStyle=g?l.O:l.ba;b.lineWidth=c.ta;b.stroke();b.lineWidth=2*c.ta;b.beginPath();b.moveTo(.8*c.c,.5*c.c);b.lineTo(.8*c.c,.2*c.c);b.moveTo(.7*c.c,.3*c.c);b.lineTo(.8*c.c,.2*c.c);b.lineTo(.9*c.c,.3*c.c);b.stroke()},"vpl:text":function(){b.fillStyle=k&&g?l.wa:l.sa;b.fillRect(0,0,c.c,c.c);b.beginPath();b.moveTo(.25*c.c,.2*c.c);b.lineTo(.25*c.c,.8*c.c);b.lineTo(.75*c.c,.8*
c.c);b.lineTo(.75*c.c,.3*c.c);b.lineTo(.65*c.c,.2*c.c);b.closePath();b.moveTo(.65*c.c,.2*c.c);b.lineTo(.65*c.c,.3*c.c);b.lineTo(.75*c.c,.3*c.c);for(var a=.2;.6>a;a+=.1)b.moveTo(.3*c.c,c.c*(.2+a)),b.lineTo(.7*c.c,c.c*(.2+a));b.strokeStyle=g?l.O:l.ba;b.lineWidth=c.ta;b.stroke()},"vpl:text-toggle":function(){b.fillStyle=k&&g?l.wa:l.sa;b.fillRect(0,0,c.c,c.c);b.beginPath();b.moveTo(.28*c.c,.2*c.c);b.lineTo(.28*c.c,.7*c.c);b.lineTo(.7*c.c,.7*c.c);b.lineTo(.7*c.c,.27*c.c);b.lineTo(.63*c.c,.2*c.c);b.closePath();
b.moveTo(.63*c.c,.2*c.c);b.lineTo(.63*c.c,.27*c.c);b.lineTo(.7*c.c,.27*c.c);for(var a=.1;.5>a;a+=.1)b.moveTo(.33*c.c,c.c*(.2+a)),b.lineTo(.63*c.c,c.c*(.2+a));b.strokeStyle=g?l.O:l.ba;b.lineWidth=c.ta;b.stroke();b.fillStyle=g?h||k?l.O:l.Jc:l.ba;b.fillRect(.1*c.c,.8*c.c,.8*c.c,.1*c.c)},"vpl:advanced":function(){b.fillStyle=k&&g?l.wa:h?l.Xc:l.sa;b.fillRect(0,0,c.c,c.c);b.fillStyle=g?l.O:l.ba;for(var a=0;4>a;a++)for(var d=0;5>d;d++)b.fillRect(.1*c.c*(1+a)+(2>a?0:.43*c.c),.1*c.c*(2+d),.07*c.c,.07*c.c);
b.fillStyle=g?h||k?l.O:l.Jc:l.ba;b.fillRect(.1*c.c,.8*c.c,.8*c.c,.1*c.c)},"vpl:undo":function(){q(0,0,!1)},"vpl:redo":function(){q(0,0,!0)},"vpl:run":function(){b.fillStyle=k&&g?l.wa:l.sa;b.fillRect(0,0,c.c,c.c);b.beginPath();b.moveTo(.3*c.c,.25*c.c);b.lineTo(.3*c.c,.75*c.c);b.lineTo(.8*c.c,.5*c.c);b.closePath();b.fillStyle=g?l.O:l.ba;b.fill();b.fillStyle=g?h||k?l.O:l.Jc:l.ba;b.fillRect(.1*c.c,.8*c.c,.8*c.c,.1*c.c)},"vpl:stop":function(){b.fillStyle=k&&g?l.wa:l.sa;b.fillRect(0,0,c.c,c.c);b.fillStyle=
g?l.O:l.ba;b.fillRect(.28*c.c,.28*c.c,.44*c.c,.44*c.c)},"vpl:debug":function(){b.fillStyle=k&&g?l.wa:l.sa;b.fillRect(0,0,c.c,c.c);b.strokeStyle=g?l.O:l.ba;b.lineWidth=c.ta;b.save();b.translate(.5*c.c,.42*c.c);b.scale(.0085*c.c,.012*c.c);b.beginPath();b.arc(0,0,20,0,2*Math.PI);b.moveTo(-13,-10);b.bezierCurveTo(0,-5,0,-5,13,-10);b.moveTo(0,-5);b.lineTo(0,20);b.moveTo(-18,-5);b.lineTo(-30,-10);b.moveTo(-18,2);b.lineTo(-32,6);b.moveTo(-15,10);b.lineTo(-26,18);b.moveTo(18,-5);b.lineTo(30,-10);b.moveTo(18,
2);b.lineTo(32,6);b.moveTo(15,10);b.lineTo(26,18);b.restore();b.stroke();b.fillStyle=g?h||k?l.O:l.Jc:l.ba;b.fillRect(.1*c.c,.8*c.c,.8*c.c,.1*c.c)},"vpl:connected":function(){function a(a,d){var e=.08*c.c;b.save();b.fillStyle=g?l.wa:l.sa;b.fillRect(a-e,d-e,2*e,2*e);b.beginPath();b.moveTo(a-e,d-e);b.lineTo(a+e,d+e);b.moveTo(a+e,d-e);b.lineTo(a-e,d+e);b.stroke();b.restore()}g=!1;b.translate(0,.1*c.c);b.save();b.translate(.8*c.c,.2*c.c);b.scale(.35,.35);t();b.restore();b.fillStyle=g?l.O:l.ba;b.strokeStyle=
g?l.O:l.ba;b.lineWidth=1.5*c.ta;m&&b.strokeRect(0,.05*c.c,.3*c.c,.3*c.c);b.strokeRect(.3*c.c,.55*c.c,.4*c.c,.3*c.c);b.lineWidth=c.ta;b.beginPath();b.moveTo(.7*c.c,.7*c.c);b.bezierCurveTo(.9*c.c,.7*c.c,.9*c.c,.7*c.c,.85*c.c,.35*c.c);m&&(b.moveTo(.3*c.c,.7*c.c),b.bezierCurveTo(.1*c.c,.7*c.c,.1*c.c,.7*c.c,.15*c.c,.35*c.c));b.stroke();h||a(.86*c.c,.55*c.c);"nonmonitored"===m&&a(.14*c.c,.55*c.c)},"vpl:robot":function(){b.fillStyle=k?l.wa:l.sa;b.fillRect(0,0,c.c,c.c);switch(m){case "thymio":b.save();b.translate(c.c/
2,.35*c.c);b.scale(.3,.3);b.rotate(.2);t();b.restore();break;case "thymio-tdm":b.save();b.translate(c.c/2,.35*c.c);b.scale(.3,.3);b.rotate(.2);t();b.restore();b.fillStyle=l.O;b.fillRect(.4*c.c,.65*c.c,.2*c.c,.2*c.c);break;case "sim":b.save(),b.translate(c.c/2,.35*c.c),b.scale(.3,.3),b.rotate(.2),t(),b.beginPath(),b.strokeStyle=l.O,b.lineWidth=c.ta/.3,b.strokeRect(-c.c,-.8*c.c,2*c.c,1.6*c.c),b.restore()}b.beginPath();b.moveTo(.2*c.c,.75*c.c);b.lineTo(.5*c.c,.75*c.c);b.lineTo(.5*c.c,c.c*("sim"===m?
.6:.3));b.strokeStyle=l.O;b.lineWidth=c.ta;b.stroke()},"vpl:sim":function(){b.fillStyle=k&&g?l.wa:l.sa;b.fillRect(0,0,c.c,c.c);b.save();b.translate(c.c/2,.35*c.c);b.scale(.4,.4);b.rotate(.2);t();b.beginPath();b.arc(c.c,.5*c.c,1.4*c.c,-3.2,-3.8,!0);b.strokeStyle=k&&g?l.Bf:l.ee;b.lineWidth=.2*c.c;b.stroke();b.beginPath();b.arc(c.c,.5*c.c,.6*c.c,-3.3,-3.8,!0);b.stroke();b.restore()},"vpl:message-empty":function(){},"vpl:message-error":function(){if(m){b.fillStyle=u.color;b.font=tc(u);b.textAlign="center";
b.textBaseline="middle";var a=f.translate(m);b.fillText(a,u.width/2,u.height/2)}},"vpl:filename":function(){if(m){b.beginPath();var a=3*c.c;b.rect(0,0,a,c.c);b.clip();b.fillStyle=u.color;b.font=tc(u);b.textAlign="center";b.textBaseline="middle";var d=m.trim().split("\n").slice(0,2).map(function(c){c=c.slice(0,80);if(1<c.length&&b.measureText(c).width>a){for(;1<c.length&&b.measureText(c+"\u2026").width>a;)c=c.slice(0,-1);c+="\u2026"}return c});1<d.length?(b.fillText(d[0],u.width/2,.25*u.height),b.fillText(d[1],
u.width/2,.75*u.height)):b.fillText(d[0],u.width/2,u.height/2)}},"vpl:duplicate":function(){b.fillStyle=k&&g?l.wa:l.sa;b.fillRect(0,0,c.c,c.c);b.strokeStyle=g?l.O:l.ba;b.lineWidth=c.ta;b.strokeRect(.3*c.c,.3*c.c,.4*c.c,.15*c.c);b.strokeRect(.3*c.c,.55*c.c,.4*c.c,.15*c.c)},"vpl:disable":function(){b.fillStyle=k&&g?l.wa:l.sa;b.fillRect(0,0,c.c,c.c);b.strokeStyle=g?l.O:l.ba;b.lineWidth=c.ta;b.strokeRect(.3*c.c,.3*c.c,.4*c.c,.4*c.c);b.beginPath();b.moveTo(.2*c.c,.6*c.c);b.lineTo(.8*c.c,.4*c.c);b.stroke()},
"vpl:lock":function(){b.fillStyle=k&&g?l.wa:l.sa;b.fillRect(0,0,c.c,c.c);b.strokeStyle=g?l.O:l.ba;b.fillStyle=g?l.O:l.ba;b.lineWidth=c.ta;b.strokeRect(.3*c.c,.3*c.c,.4*c.c,.4*c.c);uc(b,.5*c.c,.52*c.c,.04*c.c,l.O)},"vpl:trashcan":function(){b.fillStyle=k&&g?l.wa:l.sa;b.fillRect(0,0,c.c,c.c);b.beginPath();b.moveTo(.25*c.c,.2*c.c);b.lineTo(.32*c.c,.8*c.c);b.lineTo(.68*c.c,.8*c.c);b.lineTo(.75*c.c,.2*c.c);b.closePath();b.strokeStyle=g?l.O:l.ba;b.lineWidth=c.ta;b.stroke()},"vpl:teacher-reset":function(){b.fillStyle=
k&&g?l.xe:l.we;b.fillRect(0,0,c.c,c.c);b.beginPath();b.moveTo(.25*c.c,.2*c.c);b.lineTo(.25*c.c,.8*c.c);b.lineTo(.75*c.c,.8*c.c);b.lineTo(.75*c.c,.3*c.c);b.lineTo(.65*c.c,.2*c.c);b.closePath();b.moveTo(.65*c.c,.2*c.c);b.lineTo(.65*c.c,.3*c.c);b.lineTo(.75*c.c,.3*c.c);b.strokeStyle=g?l.O:l.Jd;b.lineWidth=c.ta;b.stroke();b.fillStyle=g?l.O:l.Jd;vc(b,.63*c.c,.7*c.c,.2*c.c)},"vpl:teacher-save":function(){b.fillStyle=k&&g?l.xe:l.we;b.fillRect(0,0,c.c,c.c);b.strokeStyle=g?l.O:l.Jd;b.beginPath();b.moveTo(.25*
c.c,.2*c.c);b.lineTo(.25*c.c,.7*c.c);b.lineTo(.67*c.c,.7*c.c);b.lineTo(.67*c.c,.27*c.c);b.lineTo(.6*c.c,.2*c.c);b.closePath();b.moveTo(.6*c.c,.2*c.c);b.lineTo(.6*c.c,.27*c.c);b.lineTo(.67*c.c,.27*c.c);b.lineWidth=c.ta;b.stroke();b.lineWidth=2*c.ta;b.beginPath();b.moveTo(.8*c.c,.5*c.c);b.lineTo(.8*c.c,.8*c.c);b.moveTo(.7*c.c,.7*c.c);b.lineTo(.8*c.c,.8*c.c);b.lineTo(.9*c.c,.7*c.c);b.stroke();b.fillStyle=g?l.O:l.Jd;vc(b,.46*c.c,.45*c.c,.2*c.c)},"vpl:teacher-setasnew":function(){b.fillStyle=k&&g?h?l.wf:
l.xe:h&&g?l.vf:l.we;b.fillRect(0,0,c.c,c.c);b.strokeStyle=g?l.O:l.Jd;b.beginPath();b.moveTo(.25*c.c,.2*c.c);b.lineTo(.25*c.c,.7*c.c);b.lineTo(.67*c.c,.7*c.c);b.lineTo(.67*c.c,.27*c.c);b.lineTo(.6*c.c,.2*c.c);b.closePath();b.moveTo(.6*c.c,.2*c.c);b.lineTo(.6*c.c,.27*c.c);b.lineTo(.67*c.c,.27*c.c);b.lineWidth=c.ta;b.stroke();b.lineWidth=2*c.ta;b.beginPath();b.moveTo(.8*c.c,.5*c.c);b.lineTo(.5*c.c,.5*c.c);b.moveTo(.6*c.c,.4*c.c);b.lineTo(.5*c.c,.5*c.c);b.lineTo(.6*c.c,.6*c.c);b.stroke();b.fillStyle=
g?h||k?l.O:l.Cf:l.ba;b.fillRect(.1*c.c,.8*c.c,.8*c.c,.1*c.c)},"vpl:teacher":function(){b.fillStyle=k&&g?h?l.wf:l.xe:h&&g?l.vf:l.we;b.fillRect(0,0,c.c,c.c);b.fillStyle=g?l.O:l.Jd;vc(b,.5*c.c,.4*c.c,.27*c.c);b.fillStyle=g?h||k?l.O:l.Cf:l.ba;b.fillRect(.1*c.c,.8*c.c,.8*c.c,.1*c.c)},"src:vpl":function(){b.save();b.fillStyle=k&&g?l.wa:l.sa;b.fillRect(0,0,c.c,c.c);b.beginPath();b.moveTo(.25*c.c,.2*c.c);b.lineTo(.25*c.c,.8*c.c);b.lineTo(.75*c.c,.8*c.c);b.lineTo(.75*c.c,.3*c.c);b.lineTo(.65*c.c,.2*c.c);b.closePath();
b.moveTo(.65*c.c,.2*c.c);b.lineTo(.65*c.c,.3*c.c);b.lineTo(.75*c.c,.3*c.c);b.strokeStyle=g?l.O:l.ba;b.lineWidth=c.ta;b.stroke();b.fillStyle=k&&g?l.O:l.ee;for(var a=.15;.6>a;a+=.15)b.fillRect(.3*c.c,c.c*(.2+a),.4*c.c,.1*c.c);b.restore()},"src:locked":function(){b.save();b.fillStyle=g?k?l.wa:h?l.Xc:l.sa:l.sa;b.fillRect(0,0,c.c,c.c);b.strokeStyle=g?l.O:l.ba;b.lineWidth=c.ta;b.fillStyle=g?h?l.Bf:l.ee:l.ba;for(var a=.15;.6>a;a+=.15)b.fillRect(.15*c.c,c.c*a,.4*c.c,.1*c.c);uc(b,.77*c.c,.36*c.c,.06*c.c,g?
l.O:l.ba,!h);b.fillStyle=g?h||k?l.O:l.Jc:l.ba;b.fillRect(.1*c.c,.8*c.c,.8*c.c,.1*c.c);b.restore()},"src:language":function(){var a=c.c;b.save();b.fillStyle=g?k?l.wa:l.sa:l.sa;b.fillRect(0,0,a,a);b.beginPath();for(var d=0;3>d;d++)b.moveTo(.2*a,a*(.2+.1*d)),b.lineTo(.5*a,a*(.2+.1*d));b.strokeStyle=g?l.O:l.ba;b.lineWidth=c.ta;b.stroke();for(d=0;3>d;d++){var e=2*(d+.25)/3*Math.PI;wc(b,.75*a,.3*a,.15*a,e-.3*Math.PI,e+.3*Math.PI,{Ed:!1,Wc:3*c.ta,style:g?l.O:l.ba})}b.textAlign="center";b.textBaseline="middle";
b.font="bold "+Math.round(a/3).toString(10)+"px sans-serif";b.fillStyle=g?l.O:l.ba;b.fillText({aseba:"Aa",l2:"l2",asm:"asm",js:"js",python:"Py"}[m],.5*a,.7*a);b.restore()},"src:disass":function(){var a=c.c;b.save();b.fillStyle=g&&k?l.wa:h?l.Xc:l.sa;b.fillRect(0,0,a,a);b.beginPath();b.moveTo(.2*a,.2*a);b.lineTo(.3*a,.2*a);for(var d=0;5>d;d++)b.moveTo(.4*a,a*(.2+.1*d)),b.lineTo(.45*a,a*(.2+.1*d)),b.moveTo(.55*a,a*(.2+.1*d)),b.lineTo(.65*a,a*(.2+.1*d));b.strokeStyle=g?l.O:l.ba;b.lineWidth=c.ta;b.stroke();
b.fillStyle=g&&(h||k)?l.O:l.Jc;b.fillRect(.1*c.c,.8*c.c,.8*c.c,.1*c.c);b.restore()},"sim:restart":function(){b.save();b.fillStyle=k?l.wa:l.sa;b.fillRect(0,0,u.width,u.height);var a=c.c;b.lineWidth=.05*a;wc(b,.5*a,.5*a,.25*a,1.56,0,{Ed:!1,Wc:.2*a,style:l.O});b.restore()},"sim:pause":function(){b.save();b.fillStyle=k?l.wa:h?l.Xc:l.sa;b.fillRect(0,0,c.c,c.c);b.fillStyle=g?l.O:l.ba;b.fillRect(.28*c.c,.28*c.c,.15*c.c,.44*c.c);h?(b.beginPath(),b.moveTo(.54*c.c,.28*c.c),b.lineTo(.62*c.c,.28*c.c),b.lineTo(.75*
c.c,.5*c.c),b.lineTo(.62*c.c,.72*c.c),b.lineTo(.54*c.c,.72*c.c),b.fill()):b.fillRect(.57*c.c,.28*c.c,.15*c.c,.44*c.c);b.restore()},"sim:speedup":function(){b.save();b.fillStyle=k&&g?l.wa:h?l.Xc:l.sa;b.fillRect(0,0,c.c,c.c);b.fillStyle=g?l.O:l.ba;b.beginPath();for(var a=0;2>a;a++)b.moveTo(c.c*(.3+.22*a),.25*c.c/2),b.lineTo(c.c*(.3+.22*a),.75*c.c/2),b.lineTo(c.c*(.5+.22*a),.5*c.c/2),b.closePath();b.fill();b.textAlign="center";b.textBaseline="middle";b.font="bold "+Math.round(c.c/3).toString(10)+"px sans-serif";
b.fillText(1<=m?"\u00d7"+m.toString(10):"\u00f7"+Math.round(1/m).toString(10),.5*c.c,.7*c.c);b.restore()},"sim:noise":function(){b.save();b.fillStyle=k&&g?l.wa:h?l.Xc:l.sa;b.fillRect(0,0,c.c,c.c);b.beginPath();var a=[.58,1.48,.96,.39,1.36,.09,-.75,-1.58,-.32,-1.36,-1.39,-.94,-1.1,-1.04,-.1,.93,1.22,.6,.89,.61];b.moveTo(.1*c.c,(.4+.1*a[0])*c.c);for(var d=1;d<a.length;d++)b.lineTo((.1+.8/(a.length-1)*d)*c.c,(.4+.1*a[d])*c.c);b.strokeStyle=g?l.O:l.ba;b.lineWidth=c.ta;b.stroke();b.fillStyle=g?h||k?l.O:
l.Jc:l.ba;b.fillRect(.1*c.c,.8*c.c,.8*c.c,.1*c.c);b.restore()},"sim:pen":function(){var a=c.c;b.save();b.fillStyle=k&&g?l.wa:h?l.Xc:l.sa;b.fillRect(0,0,a,a);b.fillStyle=g?h||k?l.O:l.Jc:l.ba;b.fillRect(.1*a,.8*a,.8*a,.1*a);b.translate(.5*a,a*(.4+(h?.13:0)));b.beginPath();b.moveTo(-.015/.22*a,.07*a);b.lineTo(0,.22*a);b.lineTo(.015/.22*a,.07*a);b.fillStyle=g?l.O:l.ba;b.fill();b.beginPath();b.moveTo(-.1*a,-.22*a);b.lineTo(-.1*a,0);b.lineTo(0,.22*a);b.lineTo(.1*a,0);b.lineTo(.1*a,-.22*a);b.strokeStyle=
g?l.O:l.ba;b.lineWidth=c.ta;b.stroke();b.restore()},"sim:clear":function(){var a=c.c;b.save();b.fillStyle=k&&g?l.wa:l.sa;b.fillRect(0,0,a,a);b.strokeStyle=g?l.O:l.ba;b.lineWidth=c.ta;b.strokeRect(.15*a,.25*a,.7*a,.5*a);b.translate(.5*a,.4*a);b.rotate(.4);b.fillStyle=g?l.O:l.ba;b.fillRect(0,0,.3*a,.2*a);b.restore()},"sim:map-kind":function(){var a=c.c,d=c.ta;b.save();b.fillStyle=k&&g?l.wa:l.sa;b.fillRect(0,0,c.c,c.c);b.lineWidth=d;b.strokeStyle=g?l.O:l.ba;b.fillStyle=g?l.O:l.ba;for(var e=["ground",
"height","obstacles"].indexOf(m),f=0;3>f;f++){var h=2*(f+.25)/3*Math.PI;f===e?b.fillRect(a*(.35+.25*Math.cos(h)),a*(.39+.25*Math.sin(h)),.3*a,.22*a):b.strokeRect(a*(.35+.25*Math.cos(h)),a*(.39+.25*Math.sin(h)),.3*a,.22*a);wc(b,.5*a,.5*a,.36*a,h-.42*Math.PI,h-.22*Math.PI,{Ed:!1,Wc:3*d,style:l.O})}b.restore()},"sim:map":function(){var a=c.c;b.save();b.fillStyle=k&&g?l.wa:h?l.Xc:l.sa;b.fillRect(0,0,c.c,c.c);b.fillStyle=g?h||k?l.O:l.Jc:l.ba;b.fillRect(.1*a,.8*a,.8*a,.1*a);b.lineWidth=c.ta;b.strokeStyle=
g?l.O:l.ba;b.strokeRect(.15*a,.15*a,.7*a,.5*a);switch(m){case "ground":b.lineWidth=.08*a;b.beginPath();b.arc(.6*a,.4*a,.15*a,-.5*Math.PI,.5*Math.PI);b.lineTo(.4*a,.55*a);b.arc(.4*a,.4*a,.15*a,.5*Math.PI,1.5*Math.PI);b.closePath();b.stroke();break;case "height":b.beginPath();for(var d=0;.75>=d;d+=.25)for(var e=0;1>=e;e+=.1){var f=a*(.2+.5*e+.15*d),n=a*(.5-.3*d-.2*(.2*Math.cos(5*e+2*d-3)-(d-.9)*(d-.9)/3));0===e?b.moveTo(f,n):b.lineTo(f,n)}b.stroke();break;case "obstacles":b.strokeRect(.2*a,.2*a,.6*
a,.4*a),b.beginPath(),b.moveTo(.4*a,.2*a),b.lineTo(.4*a,.43*a),b.moveTo(.6*a,.6*a),b.lineTo(.6*a,.37*a),b.stroke()}b.restore()},"sim:map-ground":function(){m="ground";p["sim:map"]()},"sim:map-height":function(){m="height";p["sim:map"]()},"sim:map-obstacles":function(){m="obstacles";p["sim:map"]()},"sim-event:forward":function(){n(0,0,1)},"sim-event:backward":function(){n(0,0,3)},"sim-event:left":function(){n(0,0,2)},"sim-event:right":function(){n(0,0,0)},"sim-event:center":function(){var a=c.c;b.save();
b.fillStyle=k?l.wa:l.sa;b.fillRect(0,0,a,a);b.beginPath();b.arc(.5*a,.5*a,.25*a,0,2*Math.PI);b.strokeStyle=l.O;b.lineWidth=2*c.ta;b.stroke();b.restore()},"sim-event:clap":function(){var a=c.c;b.save();b.fillStyle=k?l.wa:l.sa;b.fillRect(0,0,a,a);b.beginPath();b.strokeStyle=l.O;b.lineWidth=2*c.ta;b.translate(.5*a,.5*a);b.rotate(.1);for(var d=0;9>d;d++)b.beginPath(),b.moveTo(.12*a,0),b.lineTo(.24*a,0),b.moveTo(.28*a,0),b.lineTo(.36*a,0),b.stroke(),b.rotate(Math.PI/4.5);b.restore()},"sim-event:tap":function(){var a=
c.c;b.save();b.fillStyle=k?l.wa:l.sa;b.fillRect(0,0,a,a);b.beginPath();b.strokeStyle=l.O;b.lineWidth=2*c.ta;b.translate(.6*a,.6*a);for(var d=1;3>=d;d++)b.beginPath(),b.arc(0,0,.15*a*d,.9*Math.PI,1.7*Math.PI),b.stroke();b.moveTo(.3*a,0);b.lineTo(0,0);b.lineTo(0,.3*a);b.stroke();b.restore()}};p["vpl:message-warning"]=p["vpl:message-error"];p["src:close"]=p["vpl:close"];p["src:new"]=p["vpl:new"];p["src:save"]=p["vpl:save"];p["src:load"]=p["vpl:load"];p["src:run"]=p["vpl:run"];p["src:stop"]=p["vpl:stop"];
p["src:connected"]=p["vpl:connected"];p["src:sim"]=p["vpl:sim"];p["src:teacher"]=p["vpl:teacher"];p["src:teacher-reset"]=p["vpl:teacher-reset"];p["sim:close"]=p["vpl:close"];p["sim:vpl"]=p["src:vpl"];p["sim:text"]=p["vpl:text"];p["sim:teacher"]=p["vpl:teacher"];p["sim:teacher-reset"]=p["vpl:teacher-reset"];(a=p[a])&&a()}
function xc(a,b){switch(a){case "vpl:close":case "src:close":case "sim:close":return{X:0,oa:b.c/2,Y:0,la:b.c};case "vpl:message-error":case "vpl:message-warning":case "vpl:message-empty":return{X:0,oa:5*b.c,Y:0,la:b.c};case "vpl:filename":return{X:0,oa:3*b.c,Y:0,la:b.c}}return{X:0,oa:b.c,Y:0,la:b.c}};function yc(a,b,c,d,e,f){var g=0<=b.ia.b.indexOf(c);if((b.Pb?b.Pb.T:b.L.T(c))&&(b.ia.Wb||!g)){var h=a.h,k=b.L.find(c).Pc;nc(a,function(a,f,n){b.Pb?e(c,a,h.w,h.da,d,b.h,b.Pb.isEnabled&&(k||!b.ia.qe),b.Pb.Ua,b.Pb.eh,b.Pb.state):e(c,a,h.w,h.da,d,b.h,b.L.isEnabled(c)&&(k||!b.ia.qe),b.L.Ua(c),n,b.L.getState(c));(b.Pb?b.Pb.disabled:g)&&zc(h,0,0,f.width,f.height,["button"],["button"])},f,b.ia.Wb&&!k?function(){b.ia.toggle(c);return 1}:!Cb(b.L,c)||!k&&b.ia.qe?null:function(a){var d=b.L;a=a.fh;var e=d.find(c);
e&&(Eb(e,a),Db(d,c))},b.ia.Wb&&!k&&b.ia.qe?null:function(a,d){b.L.lb(c,d)},b.ia.Wb&&!k&&b.ia.qe?null:function(a,d){return b.L.kb(c,d)},c)}}function Ac(a,b,c,d,e,f){a.controls=[];a.b="";for(var g=0;g<c.length;g++)switch(c[g]){case "!space":a.b+=" ";break;case "!!space":a.b+="_";break;case "!stretch":a.b+="s";break;case "!!stretch":a.b+="S";break;default:yc(a,b,c[g],d,e,f(c[g],a.h.w,b.L.find(c[g]).Cc))}}function Bc(a,b){for(var c=0;c<b.length;c++)if("!"!==b[c][0]&&a.L.T(b[c]))return!0;return!1}
function Cc(a,b,c){for(var d={},e=0;e<b.length;e++)if("!"!==b[e][0]&&(a.Pb?a.Pb.T:a.L.find(b[e]).T())){var f=F(a.da,{tag:"button",id:b[e].replace(/:/g,"-"),W:c});d[b[e]]=f}return d}function Dc(a){var b=0,c;for(c in a)a.hasOwnProperty(c)&&(b=Math.max(b,a[c].ra()));return b};var Ec={"vpl:then":function(a,b,c,d){b=Math.min(d.width,d.height);a.strokeStyle=c.Qf;a.lineWidth=.2*b;a.beginPath();a.moveTo(-.25*b,-.5*b);a.lineTo(.25*b,0);a.lineTo(-.25*b,.5*b);a.stroke()},"vpl:error":function(a,b,c,d){b=Math.min(d.width,d.height);a.fillStyle="white";a.strokeStyle=c.Af;a.lineWidth=.07*b;a.beginPath();a.arc(0,0,.5*b,0,2*Math.PI);a.fill();a.stroke();a.fillStyle=c.Af;a.font="bold "+Math.round(.75*b).toString()+"px sans-serif";a.textAlign="center";a.textBaseline="middle";a.fillText("?",
0,.05*b)},"vpl:warning":function(a,b,c,d){b=Math.min(d.width,d.height);a.fillStyle="white";a.strokeStyle=c.ag;a.lineWidth=.07*b;a.beginPath();a.arc(0,0,.5*b,0,2*Math.PI);a.fill();a.stroke();a.fillStyle=c.ag;a.font="bold "+Math.round(.75*b).toString()+"px sans-serif";a.textAlign="center";a.textBaseline="middle";a.fillText("!",0,.05*b)},"vpl:moreHigh":function(a,b,c,d){b=Math.min(d.width,d.height);a.beginPath();a.moveTo(-.2*b,.1*b);a.lineTo(0,-.1*b);a.lineTo(.2*b,.1*b);a.lineWidth=.1*b;a.strokeStyle=
"black";a.shadowColor="white";a.shadowBlur=.2*b;a.stroke()},"vpl:moreLow":function(a,b,c,d){b=Math.min(d.width,d.height);a.beginPath();a.moveTo(-.2*b,-.1*b);a.lineTo(0,.1*b);a.lineTo(.2*b,-.1*b);a.lineWidth=.1*b;a.strokeStyle="black";a.shadowColor="white";a.shadowBlur=.2*b;a.stroke()},"vpl:customize":function(a,b,c,d){b=Math.min(d.width,d.height)/2;a.fillStyle=c.Qf;vc(a,0,0,b)}};function Lb(){this.m=new Fc;this.b=new Fc;this.b.R=!0;this.h=new Fc}function Gc(a,b){return function(){a.o!==b&&(a.o=b,Mb(a))}}function Hc(a){return function(b){a.o!==b&&(a.o=b,Mb(a))}}
function Ic(a,b,c,d,e,f,g,h){function k(a){return"a"===a||"c"===a}var m=a.i,q=Math.min(d.width,d.height),n=q/b.w.j;f=new Jc(c,d.width,d.height,f,g,function(a,b,f,g,k){var l=a.J;l.save();var m=a.w;a.w=Sb(q,a.w.c*n);qc(d,l,b.x+f,b.y+g);var u=c.V,v=b.data,t=b.x+f,p=b.y+g;a.J.save();a.J.translate(t,p);u.H(a,v,d,k);a.J.restore();c.locked&&Kc(a,b.x+f,b.y+g,q,q,!0);(c.disabled||h.disabled)&&zc(a,b.x+f,b.y+g,q,q,e,e,!c.disabled&&!h.$g);a.w=m;l.restore()},h&&h.mf||c.disabled||c.locked||c.Ab&&c.Ab.locked||
!c.V.$?h&&h.$?{$:h.$}:null:{$:c.V.$,Ra:c.V.Ra},h&&h.lf?null:function(a,c){a.data.Ab&&(m.Bb(),xa(a.data.Ab,c.data,a.data.je,function(){m.Bb()}));b.qa&&b.qa()},h&&h.lf?null:function(a,b){return b.data instanceof z&&(k(a.data.V.type)===k(b.data.V.type)||"c"===b.data.V.type)&&a.data!==b.data});if(!(h&&h.mf||!c.V.$)){if(m.R||c.V.Xd)f.v=function(a){return lc(b,a)};if(m.M||c.V.Xd)f.M=function(a){return lc(b,a)}}f.Oa=!(h&&h.kf);f.m=!(h&&h.Ie);f.R=Gc(a,c.V.name);Lc(b,f,Mc(b,c));return f}
function Nc(a,b,c,d,e,f){var g=new z(c,null,null);c.gb&&(g.g=c.gb());var h=a.i,k=0>("b"===h.mode?h.$b:h.nc).indexOf(c.name);a=Ic(a,b,g,d,["block","library"],e,f,{mf:!0,lf:!0,Ie:a.fa||a.readOnly,disabled:k||a.readOnly,$g:k,$:!a.ia.xb||a.fa||h.readOnly?null:function(){var a="b"===h.mode?h.$b:h.nc;0<=a.indexOf(c.name)?a.splice(a.indexOf(c.name),1):a.push(c.name);return 1}});c.gb&&(a.Aa=function(a){a=a.clone();a.data=new z(c,null,null);return a})}
function Oc(a,b,c){var d=[],e=0;d=a.U.map(function(b,f){var g=a.error&&a.error.h&&(0===a.error.m.length||0<=a.error.m.indexOf(f))?a.error.Kb?c.qd:c.pd:c.Ea;g.width=null==b?C(1===d.length?c.Te:c.Se):C(Pc(b,0===f,c));e+=C(g);return c.Ea.width});if(0===a.U.length||!b&&null!==a.U[a.U.length-1])c.Ea.width=C(0===a.U.length?c.Te:c.Se),d.push(c.Ea.width),e+=C(c.Ea);b=C(c.Db);var f=[],g=0;f=a.actions.map(function(b,d){var e=a.error&&!a.error.h&&(0===a.error.b.length||0<=a.error.b.indexOf(d))?a.error.Kb?c.qd:
c.pd:c.Ea;e.width=null==b?C(1===f.length?c.Re:c.Qe):C(Pc(b,0===d,c));g+=C(e);return C(e)});if(0===a.actions.length||null!==a.actions[a.actions.length-1])c.Ea.width=C(0===a.actions.length?c.Re:c.Qe),f.push(c.Ea.width),g+=C(c.Ea);return{total:e+b+g,U:d,Wf:e,zh:b,actions:f,lh:g}}function Pc(a,b,c){switch(a.V.type){case "e":return b?c.wc:c.lc;case "a":return c.Fc;case "s":return c.Xg;case "c":return c.Ug;default:throw"internal";}}
function Qc(a,b){switch(a.verticalAlign){case "middle":return(b.height-a.ra())/2;case "bottom":return b.height-a.ra();case "top":return 0;default:return b.height-a.ra()-a.verticalAlign}}
function Rc(a,b,c,d,e,f,g,h,k){var m=f,q=Oc(c,d,k),n=a.i,t=0<c.U.length&&"e"===c.U[0].V.type?k.wc:k.lc,l=new Jc(c,Sc(k.Ja),Tc(k.Ja),m-k.Ja.paddingLeft-k.Ea.offsetLeft()-t.offsetLeft(),h-k.Ja.paddingTop-k.Ea.offsetTop()-t.offsetTop(),function(a,b,d,h){var l=a.J;qc(k.Ja,l,b.x+d,b.y+h,!0);qc(k.Db,l,g-k.Db.width-k.Db.marginRight-k.Db.paddingRight-k.Ea.offsetLeft()-k.Fc.offsetLeft()+d,b.y+(Tc(k.Ja)-k.Db.height)/2+h);Uc(a,"vpl:then",g-C(k.Db)/2-k.Ea.offsetLeft()-k.Fc.offsetLeft()+d,b.y+Tc(k.Ja)/2+h,k.Db);
c.locked&&Kc(a,b.x,b.y,b.width,b.height,!1,c.disabled?"#ddd":"");var m=b.x+d+k.Ja.paddingLeft;0<e&&(m+=e-q.Wf);p.forEach(function(a,d){var e=c.error&&c.error.h&&(0===c.error.m.length||0<=c.error.m.indexOf(d))?c.error.Kb?k.qd:k.pd:k.Ea;e.width=null==a?C(1===p.length?k.Te:k.Se):C(Pc(a,0===d,k));qc(e,l,m+e.marginLeft,b.y+h+k.Ja.paddingTop+k.Ea.marginTop,!0);m+=C(e)});m=b.x+d+k.Ja.paddingLeft+g-f;v.forEach(function(a,d){var e=c.error&&!c.error.h&&(0===c.error.b.length||0<=c.error.b.indexOf(d))?c.error.Kb?
k.qd:k.pd:k.Ea;e.width=null==a?C(1===v.length?k.Re:k.Qe):C(Pc(a,0===d,k));qc(e,l,m+e.marginLeft,b.y+h+k.Ja.paddingTop+k.Ea.marginTop,!0);m+=C(e)})},null,function(a,c){if(c.data instanceof va){a=n.i.indexOf(a.data);var d=n.i.indexOf(c.data);0<=a&&0<=d&&(n.Bb(),n.i.splice(d,1),n.i.splice(a,0,c.data))}else c.data instanceof z&&(n.Bb(),xa(a.data,c.data,null,function(){n.Bb()}));b.qa&&b.qa()},function(a,b){return b.data instanceof va?b.data!==a.data:b.data.Ab!==a.data&&("a"===n.mode||0===a.data.U.length||
b.data instanceof z&&"a"===b.data.V.type)});c.disabled&&(l.h=function(a,c,d,e){zc(b,c.x+d,c.y+e,c.width,c.height,["rule"],["rule"])});if(a.i.fa||a.i.readOnly)l.m=!1;Lc(b,l);var u,p=c.U;if(0===p.length||!d&&null!==p[p.length-1])p=p.concat(null);m=f;0<e&&(m+=e-q.Wf);p.forEach(function(a,d){var e=a?Pc(a,0===d,k):1===p.length?k.Te:k.Se,f=c.error&&c.error.h&&(0===c.error.m.length||0<=c.error.m.indexOf(d))?c.error.Kb?k.qd:k.pd:k.Ea,g=Qc(e,f);a?(f.width=C(e),u=Ic(this,b,a,e,["block"],m,h+g,{mf:c.disabled||
this.i.fa||this.i.readOnly,kf:c.disabled||this.i.fa||this.i.readOnly,Ie:this.i.fa||this.i.readOnly})):(f.width=C(e),u=Ic(this,b,new ra("e",c,{Yc:!0,index:d}),e,["block"],m,h+g,{lf:c.disabled||this.readOnly,kf:!0,Ie:!0}));l.ga.push(u);m+=C(f)},a);var v=c.actions;if(0===v.length||null!==v[v.length-1])v=v.concat(null);m=g;v.forEach(function(a,d){var e=a?Pc(a,0==d,k):1===v.length?k.Re:k.Qe,f=c.error&&!c.error.h&&(0===c.error.b.length||0<=c.error.b.indexOf(d))?c.error.Kb?k.qd:k.pd:k.Ea,g=Qc(e,f);a?(f.width=
C(e),u=Ic(this,b,a,Pc(a,0===d,k),["block"],m,h+g,{mf:c.disabled||this.i.fa||this.i.readOnly,kf:c.disabled||this.i.fa||this.i.readOnly,Ie:this.i.fa||this.i.readOnly})):(f.width=C(e),u=Ic(this,b,new ra("a",c,{Yc:!1,index:d}),e,["block"],m,h,{lf:n.readOnly,kf:!0,Ie:!0}));l.ga.push(u);m+=C(f)},a);D(b,function(){if(null!==c.error){var a=c.error.Kb?k.Qg:k.af;Uc(b,c.error.Kb?"vpl:warning":"vpl:error",f-k.Ja.paddingLeft-k.Ja.marginLeft-k.Ea.offsetLeft()-t.offsetLeft()-a.width/2-a.marginRight-a.paddingRight,
h+.5*t.height,a)}})}function Vc(a,b,c,d,e,f){var g=f?e.Qg:e.af;D(a,function(h){var k=Wc(a.da,{tag:"conflict-line",W:[f?"warning":"error"]}),m=b-e.Ja.paddingLeft-e.Ja.marginLeft-e.Ea.offsetLeft()-e.wc.offsetLeft()-g.width/2-g.marginRight-g.paddingRight,q=c+(e.Ea.height+g.height)/2,n=d+(e.Ea.height-g.height)/2;h.beginPath();h.moveTo(m,q);h.lineTo(m,n);k.stroke(h);h.beginPath();h.arc(m,q,k.lineWidth,0,Math.PI);k.stroke(h);h.beginPath();h.arc(m,n,k.lineWidth,-Math.PI,0);k.stroke(h)})}
function Xc(a,b){var c={};a=window.matchMedia&&window.matchMedia("(pointer: coarse)").matches?a.i.M:a.i.R;c.Ca=F(b,{tag:"view",W:["vpl"]});c.Pg=F(b,{tag:"separator",W:["vpl","top"]});c.Og=F(b,{tag:"separator",W:["vpl","bottom"]});c.uc=F(b,{tag:"toolbar",W:["vpl","top"]});c.Bd=F(b,{tag:"toolbar",W:["vpl","bottom"]});c.Ka=F(b,{tag:"vpl",id:"scrolling-vpl"});c.wc=F(b,{tag:"block",W:["event","event-main"],mb:a?["small"]:[]});c.lc=F(b,{tag:"block",W:["event","event-aux"],mb:a?["small"]:[]});c.Fc=F(b,{tag:"block",
W:["action"],mb:a?["small"]:[]});c.Xg=F(b,{tag:"block",W:["state"],mb:a?["small"]:[]});c.Ug=F(b,{tag:"block",W:["comment"],mb:a?["small"]:[]});c.oh=F(b,{tag:"block",W:["event","empty"],mb:a?["small"]:[]});c.Qe=F(b,{tag:"block",W:["action","empty"],mb:a?["small"]:[]});c.Te=F(b,{tag:"block",W:["event","empty"],mb:a?["only-child","small"]:["only-child"]});c.Se=F(b,{tag:"block",W:["event","event-aux","empty"],mb:a?["small"]:[]});c.Re=F(b,{tag:"block",W:["action","empty"],mb:a?["only-child","small"]:["only-child"]});
c.Ea=F(b,{tag:"block-container"});c.pd=F(b,{tag:"block-container",W:["error"]});c.qd=F(b,{tag:"block-container",W:["warning"]});c.Ja=F(b,{tag:"rule",mb:a?["small"]:[]});c.Db=F(b,{tag:"widget",id:"widget-then",mb:a?["small"]:[]});c.ye=F(b,{tag:"block",W:["library","event"]});c.Yd=F(b,{tag:"block",W:["library","action"]});c.Yg=F(b,{tag:"block",W:["library","state"]});c.Vg=F(b,{tag:"block",W:["library","comment"]});c.Pa=F(b,{tag:"block-library",W:["event"]});c.Ta=F(b,{tag:"block-library",W:["action"]});
c.af=F(b,{tag:"widget",id:"widget-error",mb:a?["small"]:[]});c.Qg=F(b,{tag:"widget",id:"widget-warning",mb:a?["small"]:[]});return c}function dc(a){var b=a.ia,c=a.i;c.ac(c.Cb);a.ic="";a.Td=!1;if(!b.xb)for(b=0;b<c.i.length;b++)if(c.i[b].error)if(c.i[b].error.Kb)a.ic||(a.ic=c.i[b].error.v,a.Td=!0);else{a.ic=c.i[b].error.v;a.Td=!1;break}}function Yc(a,b,c,d,e,f){var g=new mc(a.ca);Ac(g,a,b,c,a.i.Sd||sc,a.i.re||xc);oc(g,d,f,e);return g}
function Mb(a){function b(a,b){switch(b.type){case "e":return a.ye;case "a":return a.Yd;case "s":return a.Yg;case "c":return a.Vg;default:throw"internal";}}var c=a.ia,d=a.ca,e=a.i,f=Xc(a,d.da);Zc(d);dc(a);e.R=d.w.j<d.w.tg;e.M=d.w.j<d.w.ug;var g=$c(d),h=d.state.nh,k=Bc(a,a.M),m=$a(e),q=0,n=0;e.i.forEach(function(a){a=Oc(a,m,f);q=Math.max(q,a.Wf);n=Math.max(n,a.lh)});var t=0,l=0;Ya.forEach(function(a){if(c.xb||0<=("b"===e.mode?e.$b:e.nc).indexOf(a.name))switch(a.type){case "e":case "s":t++;break;case "a":case "c":l++}},
a);ad(d,function(b,c,d){if(a.L.kb("vpl:trashcan",c)){b=J-f.Ja.offsetLeft()-f.Ea.offsetLeft()-f.wc.offsetLeft();var e=C(f.Ja);if(d<b||d>b+e)return a.L.lb("vpl:trashcan",c),!0}return!1});var u=Cc(a,a.ga,["vpl","top"]),p=Dc(u),v=Cc(a,a.M,["vpl","bottom"]),x=Dc(u);f.Ca.sc(g.width);f.Ca.fc(g.height);f.Ca.setPosition(0,0);f.uc.sc(f.Ca.width);f.uc.height=p;f.uc.setPosition(f.Ca.x,f.Ca.y);f.Pa.fc(f.Ca.height-f.uc.ra());var K=Math.max(Math.floor(f.Pa.height/f.ye.ra()),1);p=f.Pa.scroll?1:Math.ceil(t/K);f.Pa.width=
p*C(f.ye);f.Pa.setPosition(f.Ca.x,f.Ca.y+f.uc.ra());f.Ta.fc(f.Ca.height-f.uc.ra());var r=f.Ta.scroll?1:Math.ceil(l/K);f.Ta.width=r*C(f.Yd);f.Ta.setPosition(f.Ca.x+f.Ca.width-C(f.Ta),f.Ca.y+f.uc.ra());f.Bd.sc(f.Ca.width-C(f.Pa)-C(f.Ta));f.Bd.height=x;f.Bd.setPosition(f.Ca.x+C(f.Pa),f.Ca.y+f.Ca.height-f.Bd.ra());f.Ka.sc(f.Ca.width-C(f.Pa)-C(f.Ta));f.Ka.fc(f.Ca.height-f.uc.ra()-(k?f.Bd.ra():0));f.Ka.setPosition(f.Ca.x+C(f.Pa),f.Ca.y+f.uc.ra());f.Ea.width=f.pd.width=f.qd.width=C(f.wc);f.Ea.height=f.pd.height=
f.qd.height=f.wc.ra();x=C(f.Db);K=q+n+x;var J=f.Ca.x+(f.Ca.width-K+C(f.af))/2,P=J+q+x;f.Ja.width=K;f.Ja.height=f.Ea.ra();d.$a=[];D(d,function(a){f.Ca.H(a)});pc(Yc(a,a.ga,["vpl","top"],f.uc,f.Pg,u),f.uc,u,Hc(a));0<k&&pc(Yc(a,a.M,["vpl","bottom"],f.Bd,f.Og,v),f.Bd,v,Hc(a));var T=f.ye.ra(),za=f.Yd.ra(),Wa=0,fa=0;if(f.Pa.scroll){Wa=C(f.ye);h.b.fc(t*T);f.Pa.width=Wa;f.Pa.height=f.Pa.height;h.b.resize(f.Pa.x,f.Pa.y,f.Pa.width,f.Pa.height);D(d,function(a){f.Pa.H(a)});h.b.Gd(d);var N=0;Ya.forEach(function(a){if(("e"===
a.type||"s"===a.type)&&(c.xb||0<=("b"===e.mode?e.$b:e.nc).indexOf(a.name))){var g=b(f,a);Nc(this,d,a,g,f.Pa.x+g.offsetLeft(),f.Pa.y+g.offsetTop()+N*T);N++}},a);h.b.end();D(d,function(){var a=F(d.da,{tag:"widget",id:"widget-moreHigh"}),b=F(d.da,{tag:"widget",id:"widget-moreLow"});bd(h.b)||Uc(d,"vpl:moreHigh",f.Pa.x+f.Pa.width/2,f.Pa.y+a.ra()/2,a);cd(h.b)||Uc(d,"vpl:moreLow",f.Pa.x+f.Pa.width/2,f.Pa.y+f.Pa.height-b.ra()/2,b)})}else{D(d,function(a){f.Pa.H(a)});Wa=p*T+dd(f.Pa);var Q=Math.ceil(t/p);N=
0;Ya.forEach(function(g){if(("e"===g.type||"s"===g.type)&&(c.xb||0<=("b"===e.mode?e.$b:e.nc).indexOf(g.name))){var h=b(f,g),k=f.Pa.x+h.offsetLeft()+Math.floor(N/Q)*T,l=f.Pa.y+h.offsetTop()+N%Q*T;Nc(a,d,g,h,k,l);N++}},a)}f.Ta.scroll?(fa=C(f.Yd),h.h.fc(l*za),f.Ta.width=fa,f.Ta.height=f.Ta.height,h.h.resize(f.Ta.x,f.Ta.y,f.Ta.width,f.Ta.height),D(d,function(a){f.Ta.H(a)}),h.h.Gd(d),N=0,Ya.forEach(function(a){if(("a"===a.type||"c"===a.type)&&(c.xb||0<=("b"===e.mode?e.$b:e.nc).indexOf(a.name))){var g=
b(f,a);Nc(this,d,a,g,f.Ta.x+f.Yd.offsetLeft(),f.Ta.y+f.Yd.offsetTop()+N*za);N++}},a),h.h.end(),D(d,function(){var a=F(d.da,{tag:"widget",id:"widget-moreHigh"}),b=F(d.da,{tag:"widget",id:"widget-moreLow"});bd(h.h)||Uc(d,"vpl:moreHigh",f.Ta.x+f.Ta.width/2,f.Ta.y+a.ra()/2,a);cd(h.h)||Uc(d,"vpl:moreLow",f.Ta.x+f.Ta.width/2,f.Ta.y+f.Ta.height-b.ra()/2,b)})):(D(d,function(a){f.Ta.H(a)}),fa=r*za+dd(f.Ta),Q=Math.ceil(l/r),N=0,Ya.forEach(function(g){if(("a"===g.type||"c"===g.type)&&(c.xb||0<=("b"===e.mode?
e.$b:e.nc).indexOf(g.name))){var h=b(f,g),k=f.Ta.x+h.offsetLeft()+f.Ta.width-(r-Math.floor(N/Q))*za,l=f.Ta.y+h.offsetTop()+N%Q*za;Nc(a,d,g,h,k,l);N++}},a));if(c.xb){(function(){var b=f.Ea.ob();b.width=C(f.wc);var c=f.Ea.ob();c.width=C(f.lc);var e=f.Ea.ob();e.width=C(f.Fc);var g=C(b)+C(c)+C(f.Db)+C(e),h=f.Ja.ob();h.width=g;var k=f.Ca.x+(f.Ca.width-g)/2+(Wa-fa)/2-d.w.Rc/2,l=k+g-C(e);g=f.Ka.y+h.offsetTop()+b.offsetTop();var m=!1;g=new Jc(a,Sc(h),Tc(h),k-h.paddingLeft-b.offsetLeft(),g-h.paddingTop-b.offsetTop(),
function(d,g,n,u){var v=d.J;qc(h,v,g.x+n,g.y+u,!0);qc(f.Db,v,l-f.Db.width-f.Db.marginRight-f.Db.paddingRight-f.Ea.offsetLeft()-f.Fc.offsetLeft()+n,g.y+(Tc(f.Ja)-f.Db.height)/2+u);Uc(d,"vpl:then",l-C(f.Db)/2-f.Ea.offsetLeft()-f.Fc.offsetLeft()+n,g.y+Tc(f.Ja)/2+u,f.Db);var p=g.x+n+h.paddingLeft;qc(b,v,p+b.marginLeft,g.y+u+h.paddingTop+b.marginTop,!0);qc(f.wc,v,p+b.offsetLeft()+f.wc.marginLeft,g.y+u+h.paddingTop+b.offsetTop()+f.wc.marginTop+Qc(f.wc,b),!0);p+=C(b);qc(c,v,p+c.marginLeft,g.y+u+h.paddingTop+
c.marginTop,!0);qc(f.lc,v,p+b.offsetLeft()+f.lc.marginLeft,g.y+u+h.paddingTop+c.offsetTop()+f.lc.marginTop+Qc(f.lc,c),!0);!("a"===a.i.mode?a.i.h:a.i.b)^m&&zc(d,p+b.offsetLeft()+f.lc.marginLeft,g.y+u+h.paddingTop+c.offsetTop()+f.lc.marginTop+Qc(f.lc,c),f.lc.width,f.lc.height,["block"],["block"],!1);p=g.x+n+f.Ja.paddingLeft+l-k;qc(e,v,p+e.marginLeft,g.y+u+h.paddingTop+e.marginTop,!0);qc(f.Fc,v,p+e.offsetLeft()+f.Fc.marginLeft,g.y+u+h.paddingTop+e.offsetTop()+f.Fc.marginTop+Qc(f.Fc,e),!0)},{$:function(a){m=
!0;B(a);return 0},Ra:function(a,b,c,d,e,f,g,h){c=a.b.getBoundingClientRect();b=h.x-c.left;h=h.y-c.top;m=b>=f&&b<f+d&&h>=g&&h<g+e;B(a)},jf:function(b){m&&("a"===a.i.mode?a.i.h=!a.i.h:a.i.b=!a.i.b);B(b)}},null,null);g.m=!1;Lc(d,g)})();var O=F(d.da,{tag:"widget",id:"vpl-customize"});O.width=f.Ka.width/2;O.height=(f.Ka.height-f.Ja.ra())/2;D(d,function(){Uc(d,"vpl:customize",f.Ka.x+f.Ka.width/2,f.Ka.y+(f.Ka.height+f.Ja.ra())/2,O)})}else if(e.message)D(d,function(a){var b=e.message.split("\n"),c=Math.min(14,
g.height/b.length);a.font=c+"px sans-serif";a.textAlign="start";a.textBaseline="top";var d=f.Ka.x+c,h=f.Ka.y+c;b.forEach(function(b,e){a.fillText(b,d,h+1.2*c*e)})});else{k=C(f.Ja)+f.Ka.paddingLeft+f.Ka.paddingRight+C(f.af);h.m.sc(k);h.m.fc(e.i.length*f.Ja.ra());h.m.resize(f.Ka.x,f.Ka.y,f.Ka.width,f.Ka.height);D(d,function(a){f.Ka.H(a)});h.m.Gd(d);J+=(Wa-fa)/2-d.w.Rc/2;P+=(Wa-fa)/2-d.w.Rc/2;k>f.Ka.width&&(J+=(k-f.Ka.width)/2+f.Ka.paddingLeft+f.Ka.marginLeft,P+=(k-f.Ka.width)/2+f.Ka.paddingLeft+f.Ka.marginLeft);
var pa="";e.i.forEach(function(a,b){Rc(this,d,a,m,d.w.pg?q:0,J,P,f.Ka.y+f.Ja.ra()*b+f.Ja.offsetTop()+f.Ea.offsetTop(),f);if(null!==a.error&&""===pa&&(pa=a.error.v,null!==a.error.o))for(var c=b+1;c<e.i.length;c++)if(e.i[c]===a.error.o){Vc(d,J,f.Ka.y+f.Ja.ra()*b+f.Ja.offsetTop()+f.Ea.offsetTop(),f.Ka.y+f.Ja.ra()*c+f.Ja.offsetTop()+f.Ea.offsetTop(),f,a.error.Kb);break}},a);h.m.end();e.fa&&D(d,function(){zc(d,f.Ka.x,f.Ka.y,f.Ka.width,f.Ka.height,["vpl"],["vpl"])})}a.o&&D(d,function(b){var c=F(d.da,{tag:"hint"});
b.fillStyle=c.color;b.font=tc(c);b.textAlign="start";b.textBaseline="middle";var e=a.h.translate(a.o);c.width=b.measureText(e).width;c.height=1.2*c.fontSize;qc(c,b,c.marginLeft,g.height-c.ra()+c.marginTop,!0);b.fillText(e,c.offsetLeft(),g.height-c.ra()+c.offsetTop()+c.height/2)});D(d,function(a){a.font="9px sans-serif";a.textAlign="start";a.textBaseline="bottom";a.rotate(-Math.PI/2);a.fillText("EPFL 2018-2020",-g.height+d.w.ja,g.width-d.w.ja)});e.qa&&e.qa();B(d)};function ed(){this.Oa={};this.m=[];this.ga={px:1,cm:96/2.54,mm:96/25.4,"in":96,pc:16,pt:96/72};this.M={rad:1,deg:Math.PI/180,grad:Math.PI/200,turn:2*Math.PI};this.b=null}
function fd(a,b,c){function d(){return b+" line "+q+" col "+n}function e(){for(;m<c.length;)if(" "===c[m]||"\t"===c[m])m++,n++;else if("\n"===c[m])m++,n=1,q++;else if("\r"===c[m])m++;else if("/*"===c.slice(m,m+2))for(m+=2,n+=2;m<c.length;)if("*/"===c.slice(m,m+2)){m+=2;n+=2;break}else m++,n++;else break}function f(){"\n"===c[m]?(n=1,q++):"\r"!==c[m]&&n++;m++}function g(){for(var a=0;m+a<c.length&&/[-_a-z0-9]/i.test(c[m+a]);)a++;m+=a;n+=a;return c.slice(m-a,m)}function h(){var a=new gd;if(!/[a-z_.#*:]/i.test(c[m]))throw"Syntax error "+
d();for(/[a-z_]/i.test(c[m])?a.tag=g():"*"===c[m]&&f();;)if("#"===c[m]){if(a.id)throw"Multiple ids in selector "+d();f();a.id=g()}else if("."===c[m])f(),a.W.push(g());else if(":"===c[m])f(),a.mb.push(g());else break;return a}function k(){for(var a=0;m+a<c.length&&";"!==c[m+a]&&"}"!==c[m+a];)"\n"===c[m]?(q++,n=1):"\r"!==c[m]&&n++,a++;m+=a;return c.slice(m-a,m).trim()}a.Oa[b]=c;for(var m=0,q=1,n=1;m<c.length;){e();if(m>=c.length)break;for(var t=[];;){t.push(h());e();if(","!==c[m])break;m++;n++;e()}if("{"!==
c[m])throw"Syntax error "+d();m++;n++;for(var l={};;){for(;;){e();if(";"!==c[m])break;m++}if(m>=c.length)throw"Unclosed block "+d();if("}"===c[m]){m++;n++;break}else if(!/[a-z_]/i.test(c[m]))throw"Syntax error "+d();var u=g();e();if(":"!==c[m])throw"Missing colon "+d();m++;n++;var p=k();l[u]=a.Aa(u,p)}for(u=0;u<t.length;u++)a.m.push({Tf:t[u],Qc:l})}}ed.prototype.Aa=function(a,b){return b};
function hd(a,b){if(/^(max|min)\(.*\)$/.test(b))return a=b.slice(4,-1).split(",").map(function(a){return hd(this,a)},a),new id(b.slice(0,3),a);b=/^(-?([0-9]+\.?|[0-9]*\.[0-9]+))([a-z]*|%)$/.exec(b);var c=1,d=jd;if(null==b)throw"Illegal length";if("%"===b[3])d=kd;else if(a.ga.hasOwnProperty(b[3]))c=a.ga[b[3]];else if("vw"===b[3])d=ld;else if("vh"===b[3])d=md;else if("vmin"===b[3])d=nd;else if("vmax"===b[3])d=od;else if("ww"===b[3])d=pd;else if("wh"===b[3])d=qd;else if("wmin"===b[3])d=rd;else if("wmax"===
b[3])d=sd;else if(0==parseFloat(b[1]))c=0;else throw"Unknown length unit";return new td(parseFloat(b[1])*c,d)}
var ud={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgreen:"#006400",
darkgrey:"#A9A9A9",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",
ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",green:"#008000",greenyellow:"#ADFF2F",grey:"#808080",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgreen:"#90EE90",lightgrey:"#D3D3D3",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",
lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",
moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",
seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32",transparent:"rgba(0,0,0,0)"};function td(a,b){this.S=a;this.type=b?b:jd}
var jd="abs",kd="%",ld="vw",md="vh",nd="vmin",od="vmax",pd="ww",qd="wh",rd="wmin",sd="wmax";
td.prototype.N=function(a){switch(this.type){case jd:return this.S;case kd:return this.S*(a?a.v/100:1);case ld:return this.S*(a?a.h:1);case md:return this.S*(a?a.b:1);case nd:return this.S*(a?Math.min(a.h,a.b):1);case od:return this.S*(a?Math.max(a.h,a.b):1);case pd:return this.S*(a?a.o:1);case qd:return this.S*(a?a.m:1);case rd:return this.S*(a?Math.min(a.o,a.m):1);case sd:return this.S*(a?Math.max(a.o,a.m):1);default:throw"internal";}};function id(a,b){td.call(this,0);this.za=a;this.values=b}
id.prototype=Object.create(td.prototype);id.prototype.constructor=id;id.prototype.N=function(a){switch(this.za){case "max":return this.values.reduce(function(b,c){return Math.max(b,c.N(a))},-Infinity);case "min":return this.values.reduce(function(b,c){return Math.min(b,c.N(a))},Infinity);default:throw"internal";}};function vd(a,b,c,d,e){this.v=a;this.h=b;this.b=c;this.o=d;this.m=e}function gd(){this.id=this.tag=null;this.W=[];this.mb=[]}
function wd(a,b){a=a.id?"#"+a.id:(a.tag||"")+(a.W&&0<a.W.length?"."+a.W.join("."):"")+(a.mb&&0<a.mb.length?":"+a.mb.join("."):"")||"*";b&&(a+="/"+Math.round(b.v).toString(10)+","+Math.round(b.h).toString(10)+","+Math.round(b.b).toString(10)+","+Math.round(b.o).toString(10)+","+Math.round(b.m).toString(10));return a}
gd.prototype.match=function(a){if(a.tag&&this.tag&&a.tag!==this.tag||this.id&&this.id!==a.id)return!1;for(var b=0;b<this.W.length;b++)if(void 0==a.W||0>a.W.indexOf(this.W[b]))return!1;for(b=0;b<this.mb.length;b++)if(void 0==a.mb||0>a.mb.indexOf(this.mb[b]))return!1;return!0};function Jb(){ed.call(this);this.h=[];this.o={};this.v={};this.R="none hidden dotted dashed solid double".split(" ");this.hb=["normal","italic","oblique"];this.qb=["normal","bold"]}Jb.prototype=Object.create(ed.prototype);Jb.prototype.constructor=Jb;Jb.prototype.defineProperties=function(){for(var a=0;a<this.m.length;a++){var b=new xd;yd(b,this.m[a].Qc);this.h.push({Tf:this.m[a].Tf,Gg:b})}};
Jb.prototype.Aa=function(a,b){function c(a){try{hd(e,a)}catch(l){return!1}return!0}function d(a){return ud.hasOwnProperty(a)||/^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(a)||/^rgba\([^()]*\)$/.test(a)}var e=this;b=b.replace(/\s+(?=[^()]*\))/g,"");switch(a){case "margin-left":case "margin-right":case "margin-top":case "margin-bottom":case "padding-left":case "padding-right":case "padding-top":case "padding-bottom":case "border-left-width":case "border-right-width":case "border-top-width":case "border-bottom-width":case "line-width":case "width":case "height":case "min-width":case "min-height":case "max-width":case "max-height":case "font-size":return hd(this,
b);case "margin":case "padding":case "border-width":switch(a=b.replace(/ +/g," ").split(" ").map(function(a){return hd(e,a)}),a.length){case 1:return[a[0],a[0],a[0],a[0]];case 2:return[a[0],a[1],a[0],a[1]];case 3:return[a[0],a[1],a[2],a[1]];case 4:return a;default:throw"Wrong number of lengths";}case "border-style":case "border-left-style":case "border-right-style":case "border-top-style":case "border-bottom-style":case "line-style":if(!(0<=e.R.indexOf(b)))throw"Unknown border style";return b;case "line-cap":if(!(0<=
["butt","round","square"].indexOf(b)))throw"Unknown line cap";return b;case "border-color":case "border-left-color":case "border-right-color":case "border-top-color":case "border-bottom-color":case "color":case "background-color":case "background":case "border-cut-background":if(!d(b))throw"Unknown border color";return b;case "border-left":case "border-right":case "border-top":case "border-bottom":case "border":case "line":var f=null,g=null,h=null;b.replace(/ +/g," ").split(" ").forEach(function(a){if(d(a))f=
a;else if(0<=e.R.indexOf(a))g=a;else if(c(a))h=hd(e,a);else throw"Illegal border property";});return{color:f,style:null===g&&(f||h)?"solid":g,width:null===h&&(f||g)?new td(1):h};case "border-top-left-radius":case "border-top-right-radius":case "border-bottom-right-radius":case "border-bottom-left-radius":case "border-top-left-cut":case "border-top-right-cut":case "border-bottom-left-cut":case "border-bottom-right-cut":switch(a=b.replace(/ +/g," ").split(" ").map(function(a){return hd(e,a)}),a.length){case 1:return[a[0],
a[0]];case 2:return a;default:throw"Wrong number of radii";}case "border-radius":case "border-cut":switch(a=b.split("/").map(function(a){a=a.replace(/ +/g," ").split(" ").map(function(a){return"/"===a?"/":hd(e,a)});switch(a.length){case 1:return[a[0],a[0],a[0],a[0]];case 2:return[a[0],a[1],a[0],a[1]];case 3:return[a[0],a[1],a[2],a[1]];case 4:return a;default:throw"Wrong number of radii";}}),a.length){case 1:return a[0].concat(a[0]);case 2:return a[0].concat(a[1]);default:throw"Wrong number of radius dimensions";
}case "font":var k="",m="",q=null,n="";b.replace(/ +/g," ").split(" ").forEach(function(a){if(null===q)if(c(a))q=hd(e,a);else if(0<=e.hb.indexOf(a))k=a;else if(0<=e.qb.indexOf(a))m=a;else throw"Unknown font style "+a;else{if(""!==n)throw"Unexpected font style after font-family";n=a}});return{fontFamily:n,fontSize:q,fontStyle:k,fontWeight:m};case "box-shadow":case "line-shadow":return b=b.split(",")[0],a=b.replace(/ +/g," ").split(" "),"inset"===a[0]&&(a=a.slice(1)),3<=a.length&&5>=a.length?{offset:[hd(this,
a[0]),hd(this,a[1])],color:a[a.length-1],Ue:4<=a.length?hd(this,a[2]):null,qf:5<=a.length?hd(this,a[3]):null}:{};case "overflow":if(0>["wrap","scroll"].indexOf(b))throw"Unknown overflow mode";return b;case "vertical-align":return 0<=["top","middle","bottom"].indexOf(b)?b:hd(this,b);default:return b}};
function zd(a,b){for(var c=null,d=0;d<a.h.length;d++)if(a.h[d].Tf.match(b)){if(c){var e=void 0;var f=a.h[d].Gg;c=c.ob();for(e in f.Qc)f.Qc.hasOwnProperty(e)&&(c.Qc[e]=f.Qc[e]);e=c}else e=a.h[d].Gg.ob();c=e}for(var g in c)c.hasOwnProperty(g)&&c[g]instanceof td&&(c[g]=c[g].N(a.b));return c}function F(a,b){var c=wd(b,a.b);if(a.o[c])return a.o[c];b=zd(a,b);b=new Ad(b,a.b);return a.o[c]=b}function Wc(a,b){var c=wd(b,a.b);if(a.v[c])return a.v[c];b=zd(a,b);b=new Bd(b,a.b);return a.v[c]=b}
function xd(){this.Qc={}}function yd(a,b){for(var c in b)b.hasOwnProperty(c)&&(a.Qc[c]=b[c])}xd.prototype.ob=function(){var a=new xd;yd(a,this.Qc);return a};
function Ad(a,b){this.marginBottom=this.marginTop=this.marginRight=this.marginLeft=this.y=this.x=this.height=this.width=0;this.sb=!0;this.ec=!1;this.borderBottomWidth=this.borderTopWidth=this.borderRightWidth=this.borderLeftWidth=0;this.borderBottomStyle=this.borderTopStyle=this.borderRightStyle=this.borderLeftStyle="none";this.borderBottomColor=this.borderTopColor=this.borderRightColor=this.borderLeftColor="black";this.borderTopLeftRadius=[0,0];this.borderTopRightRadius=[0,0];this.borderBottomRightRadius=
[0,0];this.borderBottomLeftRadius=[0,0];this.ze=this.$d=this.Be=this.Ae=!1;this.paddingBottom=this.paddingTop=this.paddingRight=this.paddingLeft=0;this.backgroundColor=this.ve="transparent";this.color="black";this.fontFamily="sans-serif";this.fontSize=10;this.fontWeight=this.fontStyle="";this.scroll=!1;this.verticalAlign="middle";this.Nb=null;this.Qd=this.dd=0;this.shadowColor=null;a&&Cd(this,a.Qc,b)}Ad.prototype=Object.create(xd.prototype);w=Ad.prototype;w.constructor=Ad;
function Cd(a,b,c){var d=-1,e=-1,f=-1,g=-1,h=1E9,k=1E9,m;for(m in b)switch(m){case "margin-left":a.marginLeft=b[m].N(c);break;case "margin-right":a.marginRight=b[m].N(c);break;case "margin-top":a.marginTop=b[m].N(c);break;case "margin-bottom":a.marginBottom=b[m].N(c);break;case "border-left-width":a.borderLeftWidth=b[m].N(c);a.sb=!1;break;case "border-right-width":a.borderRightWidth=b[m].N(c);a.sb=!1;break;case "border-top-width":a.borderTopWidth=b[m].N(c);a.sb=!1;break;case "border-bottom-width":a.borderBottomWidth=
b[m].N(c);a.sb=!1;break;case "padding-left":a.paddingLeft=b[m].N(c);break;case "padding-right":a.paddingRight=b[m].N(c);break;case "padding-top":a.paddingTop=b[m].N(c);break;case "padding-bottom":a.paddingBottom=b[m].N(c);break;case "margin":a.marginTop=b[m][0].N(c);a.marginRight=b[m][1].N(c);a.marginBottom=b[m][2].N(c);a.marginLeft=b[m][3].N(c);break;case "border-width":a.borderTopWidth=b[m][0].N(c);"none"===a.borderTopStyle&&0<a.borderTopWidth&&(a.borderTopStyle=null);a.borderRightWidth=b[m][1].N(c);
"none"===a.borderRightStyle&&0<a.borderRightWidth&&(a.borderRightStyle=null);a.borderBottomWidth=b[m][2].N(c);"none"===a.borderBottomStyle&&0<a.borderBottomWidth&&(a.borderBottomStyle=null);a.borderLeftWidth=b[m][3].N(c);"none"===a.borderLeftStyle&&0<a.borderLeftWidth&&(a.borderLeftStyle=null);break;case "padding":a.paddingTop=b[m][0].N(c);a.paddingRight=b[m][1].N(c);a.paddingBottom=b[m][2].N(c);a.paddingLeft=b[m][3].N(c);break;case "border-style":a.borderLeftStyle=b[m];a.borderRightStyle=b[m];a.borderTopStyle=
b[m];a.borderBottomStyle=b[m];break;case "border-left-style":a.borderLeftStyle=b[m];a.sb=!1;break;case "border-right-style":a.borderRightStyle=b[m];a.sb=!1;break;case "border-top-style":a.borderTopStyle=b[m];a.sb=!1;break;case "border-bottom-style":a.borderBottomStyle=b[m];a.sb=!1;break;case "border-color":a.borderLeftColor=b[m];a.borderRightColor=b[m];a.borderTopColor=b[m];a.borderBottomColor=b[m];break;case "border-left-color":a.borderLeftColor=b[m];a.sb=!1;break;case "border-right-color":a.borderRightColor=
b[m];a.sb=!1;break;case "border-top-color":a.borderTopColor=b[m];a.sb=!1;break;case "border-bottom-color":a.borderBottomColor=b[m];a.sb=!1;break;case "border-left":null!==b[m].color&&(a.borderLeftColor=b[m].color);null!==b[m].style&&(a.borderLeftStyle=b[m].style);null!==b[m].width&&(a.borderLeftWidth=b[m].width.N(c));a.sb=!1;break;case "border-right":null!==b[m].color&&(a.borderRightColor=b[m].color);null!==b[m].style&&(a.borderRightStyle=b[m].style);null!==b[m].width&&(a.borderRightWidth=b[m].width.N(c));
a.sb=!1;break;case "border-top":null!==b[m].color&&(a.borderTopColor=b[m].color);null!==b[m].style&&(a.borderTopStyle=b[m].style);null!==b[m].width&&(a.borderTopWidth=b[m].width.N(c));a.sb=!1;break;case "border-bottom":null!==b[m].color&&(a.borderBottomColor=b[m].color);null!==b[m].style&&(a.borderBottomStyle=b[m].style);null!==b[m].width&&(a.borderBottomWidth=b[m].width.N(c));a.sb=!1;break;case "border":null!==b[m].color&&(a.borderLeftColor=a.borderRightColor=a.borderTopColor=a.borderBottomColor=
b[m].color);null!==b[m].style&&(a.borderLeftStyle=a.borderRightStyle=a.borderTopStyle=a.borderBottomStyle=b[m].style);null!==b[m].width&&(a.borderLeftWidth=a.borderRightWidth=a.borderTopWidth=a.borderBottomWidth=b[m].width.N(c));a.sb=!0;break;case "border-top-left-radius":a.borderTopLeftRadius=b[m].map(function(a){return a.N(c)});a.ec=!0;break;case "border-top-right-radius":a.borderTopRightRadius=b[m].map(function(a){return a.N(c)});a.ec=!0;break;case "border-bottom-right-radius":a.borderBottomRightRadius=
b[m].map(function(a){return a.N(c)});a.ec=!0;break;case "border-bottom-left-radius":a.borderBottomLeftRadius=b[m].map(function(a){return a.N(c)});a.ec=!0;break;case "border-radius":a.borderTopLeftRadius=[b[m][0].N(c),b[m][4].N(c)];a.borderTopRightRadius=[b[m][1].N(c),b[m][5].N(c)];a.borderBottomRightRadius=[b[m][2].N(c),b[m][6].N(c)];a.borderBottomLeftRadius=[b[m][3].N(c),b[m][7].N(c)];a.ec=!0;break;case "border-top-left-cut":a.borderTopLeftRadius=b[m].map(function(a){return a.N(c)});a.Ae=!0;a.ec=
!0;break;case "border-top-right-cut":a.borderTopRightRadius=b[m].map(function(a){return a.N(c)});a.Be=!0;a.ec=!0;break;case "border-bottom-left-cut":a.$d=b[m].map(function(a){return a.N(c)});a.$d=!0;a.ec=!0;break;case "border-bottom-right-cut":a.borderBottomRightRadius=b[m].map(function(a){return a.N(c)});a.ze=!0;a.ec=!0;break;case "border-cut":a.borderTopLeftRadius=[b[m][0].N(c),b[m][4].N(c)];a.borderTopRightRadius=[b[m][1].N(c),b[m][5].N(c)];a.borderBottomRightRadius=[b[m][2].N(c),b[m][6].N(c)];
a.borderBottomLeftRadius=[b[m][3].N(c),b[m][7].N(c)];a.Ae=!0;a.Be=!0;a.$d=!0;a.ze=!0;a.ec=!0;break;case "backdrop-color":a.ve=b[m];break;case "background-color":case "background":a.backgroundColor=b[m];break;case "color":a.color=b[m];break;case "font":a.fontFamily=b[m].fontFamily;a.fontSize=b[m].fontSize.N(c);a.fontStyle=b[m].fontStyle;a.fontWeight=b[m].fontWeight;break;case "font-family":a.fontFamily=b[m];break;case "font-size":a.fontSize=b[m].N(c);break;case "font-style":a.fontStyle=b[m];break;
case "font-weight":a.fontWeight=b[m];break;case "overflow":a.scroll="scroll"===b[m];break;case "vertical-align":a.verticalAlign=b[m]instanceof td?b[m].N(c):b[m];break;case "box-shadow":null!==b[m].Nb&&(a.Nb=b[m].offset.map(function(a){return a?a.N(c):0}),a.dd=b[m].Ue?b[m].Ue.N(c):0,a.Qd=b[m].qf?b[m].qf.N(c):0,a.shadowColor=b[m].color);break;case "width":d=b[m].N(c);break;case "min-width":f=b[m].N(c);break;case "max-width":h=b[m].N(c);break;case "height":e=b[m].N(c);break;case "min-height":g=b[m].N(c);
break;case "max-height":k=b[m].N(c)}d=Math.max(Math.min(d,h),f);e=Math.max(Math.min(e,k),g);0<=d&&(a.width=d);0<=e&&(a.height=e)}w.setPosition=function(a,b){this.x=a+this.offsetLeft();this.y=b+this.offsetTop()};function C(a){return a.width+dd(a)}w.ra=function(){return this.height+(this.marginTop+this.borderTopWidth+this.paddingTop+this.paddingBottom+this.borderBottomWidth+this.marginBottom)};
w.sc=function(a){this.width=a-(this.marginLeft+this.borderLeftWidth+this.paddingLeft+this.paddingRight+this.borderRightWidth+this.marginRight)};w.fc=function(a){this.height=a-(this.marginTop+this.borderTopWidth+this.paddingTop+this.paddingBottom+this.borderBottomWidth+this.marginBottom)};
w.ob=function(){var a=new Ad;a.width=this.width;a.height=this.height;a.x=this.x;a.y=this.y;a.marginLeft=this.marginLeft;a.marginRight=this.marginRight;a.marginTop=this.marginTop;a.marginBottom=this.marginBottom;a.sb=this.sb;a.ec=this.ec;a.borderLeftWidth=this.borderLeftWidth;a.borderRightWidth=this.borderRightWidth;a.borderTopWidth=this.borderTopWidth;a.borderBottomWidth=this.borderBottomWidth;a.borderLeftStyle=this.borderLeftStyle;a.borderRightStyle=this.borderRightStyle;a.borderTopStyle=this.borderTopStyle;
a.borderBottomStyle=this.borderBottomStyle;a.borderLeftColor=this.borderLeftColor;a.borderRightColor=this.borderRightColor;a.borderTopColor=this.borderTopColor;a.borderBottomColor=this.borderBottomColor;a.borderTopLeftRadius=this.borderTopLeftRadius;a.borderTopRightRadius=this.borderTopRightRadius;a.borderBottomRightRadius=this.borderBottomRightRadius;a.borderBottomLeftRadius=this.borderBottomLeftRadius;a.Ae=this.Ae;a.Be=this.Be;a.$d=this.$d;a.ze=this.ze;a.paddingLeft=this.paddingLeft;a.paddingRight=
this.paddingRight;a.paddingTop=this.paddingTop;a.paddingBottom=this.paddingBottom;a.ve=this.ve;a.backgroundColor=this.backgroundColor;a.color=this.color;a.fontFamily=this.fontFamily;a.fontSize=this.fontSize;a.fontStyle=this.fontStyle;a.fontWeight=this.fontWeight;a.scroll=this.scroll;a.verticalAlign=this.verticalAlign;a.Nb=this.Nb;a.dd=this.dd;a.Qd=this.Qd;a.shadowColor=this.shadowColor;return a};w.offsetLeft=function(){return this.marginLeft+this.borderLeftWidth+this.paddingLeft};
function dd(a){return a.marginLeft+a.borderLeftWidth+a.paddingLeft+a.paddingRight+a.borderRightWidth+a.marginRight}w.offsetTop=function(){return this.marginTop+this.borderTopWidth+this.paddingTop};function Sc(a){return a.width+a.paddingLeft+a.paddingRight}function Tc(a){return a.height+a.paddingTop+a.paddingBottom}function tc(a){return(a.fontStyle?a.fontStyle+" ":"")+(a.fontWeight?a.fontWeight+" ":"")+a.fontSize.toFixed(1)+"px "+a.fontFamily}
function Bd(a,b){this.margin=0;this.be=this.style=this.width=null;this.color="black";this.Nb=null;this.Qd=this.dd=0;this.shadowColor=null;this.Nf={};a&&Dd(this,a.Qc,b);null===this.width&&(this.width=null!==this.style&&"none"!==this.style?1:0);null===this.style&&(this.style=0<this.width?"solid":"none");null===this.be&&(this.be="butt")}Bd.prototype=Object.create(xd.prototype);Bd.prototype.constructor=Bd;
function Dd(a,b,c){for(var d in b)switch(d){case "margin":a.margin=b[d].N(c);break;case "line-width":a.width=b[d].N(c);break;case "line-style":a.style=b[d];break;case "line-cap":a.be=b[d];break;case "color":a.color=b[d];break;case "line":null!==b[d].color&&(a.color=b[d].color);null!==b[d].style&&(a.style=b[d].style);null!==b[d].width&&(a.width=b[d].width.N(c));break;case "line-shadow":null!==b[d].Nb&&(a.Nb=b[d].offset.map(function(a){return a?a.N(c):0}),a.dd=b[d].Ue?b[d].Ue.N(c):0,a.Qd=b[d].qf?b[d].qf.N(c):
0,a.shadowColor=b[d].color);break;default:b.hasOwnProperty(d)&&(a.Nf[d]=b[d])}}Bd.prototype.ob=function(){var a=new Bd;a.margin=this.margin;a.width=this.width;a.style=this.style;a.be=this.be;a.color=this.color;a.Nb=this.Nb;a.dd=this.dd;a.Qd=this.Qd;a.shadowColor=this.shadowColor;return a};var Ed=!1;function Fd(a,b,c,d){a.strokeStyle=c||"black";switch(d){case "dotted":a.setLineDash([2*b,3*b]);a.lineDashOffset=0;break;case "dashed":a.setLineDash([3*b,3*b]),a.lineDashOffset=0}a.lineWidth=b||0}
function qc(a,b,c,d,e){function f(){var a=Math.min(g.borderTopLeftRadius[0],h/2),e=Math.min(g.borderTopLeftRadius[1],k/2);b.moveTo(c,d+e);g.Ae?b.lineTo(c+a,d):b.bezierCurveTo(c,d+e/2,c+a/2,d,c+a,d);a=Math.min(g.borderTopRightRadius[0],h/2);e=Math.min(g.borderTopRightRadius[1],k/2);b.lineTo(c+h-a,d);g.Be?b.lineTo(c+h,d+e):b.bezierCurveTo(c+h-a/2,d,c+h,d+e/2,c+h,d+e);a=Math.min(g.borderBottomRightRadius[0],h/2);e=Math.min(g.borderBottomRightRadius[1],k/2);b.lineTo(c+h,d+k-e);g.ze?b.lineTo(c+h-a,d+k):
b.bezierCurveTo(c+h,d+k-e/2,c+h-a/2,d+k,c+h-a,d+k);a=Math.min(g.borderBottomLeftRadius[0],h/2);e=Math.min(g.borderBottomLeftRadius[1],k/2);b.lineTo(c+a,d+k);g.$d?b.lineTo(c,d+k-e):b.bezierCurveTo(c+a/2,d+k,c,d+k-e/2,c,d+k-e);b.closePath()}e||(c-=a.paddingLeft,d-=a.paddingTop);var g=a,h=a.width+a.paddingLeft+a.paddingRight,k=a.height+a.paddingTop+a.paddingBottom;Ed&&(b.save(),b.strokeStyle="black",b.lineWidth=1,b.strokeRect(c,d,h,k),b.strokeRect(c+a.paddingLeft,d+a.paddingTop,a.width,a.height),b.strokeRect(c-
a.marginLeft,d-a.marginTop,h+a.marginLeft+a.marginRight,k+a.marginTop+a.marginBottom),b.restore());b.save();"transparent"!==a.ve&&(b.fillStyle=a.ve,b.fillRect(c,d,h,k));b.beginPath();a.ec?(b.beginPath(),f()):b.rect(c,d,h,k);b.save();a.Nb&&(b.shadowOffsetX=a.Nb[0],b.shadowOffsetY=a.Nb[1],b.shadowColor=a.shadowColor,b.shadowBlur=a.dd);a.backgroundColor?b.fillStyle=a.backgroundColor:a.Nb&&(b.fillStyle="transparent");b.fill();b.restore();a.sb?0<a.borderLeftWidth&&a.borderLeftColor&&"none"!==a.borderLeftStyle&&
"hidden"!==a.borderLeftStyle&&(Fd(b,a.borderLeftWidth,a.borderLeftColor,a.borderLeftStyle),"double"===a.borderLeftStyle&&(b.save(),b.translate(c+h/2,d+k/2),b.scale((h-3*a.borderLeftWidth)/h,(k-3*a.borderLeftWidth)/k),b.translate(-c-h/2,-d-k/2),f(),b.restore()),b.stroke()):(0<a.borderLeftWidth&&a.borderLeftColor&&"none"!==a.borderLeftStyle&&"hidden"!==a.borderLeftStyle&&(Fd(b,a.borderLeftWidth,a.borderLeftColor,a.borderLeftStyle),b.beginPath(),b.moveTo(c,d),b.lineTo(c,d+k),b.stroke()),0<a.borderRightWidth&&
a.borderRightColor&&"none"!==a.borderRightStyle&&"hidden"!==a.borderRightStyle&&(Fd(b,a.borderRightWidth,a.borderRightColor,a.borderRightStyle),b.beginPath(),b.moveTo(c+h,d),b.lineTo(c+h,d+k),b.stroke()),0<a.borderTopWidth&&a.borderTopColor&&"none"!==a.borderTopStyle&&"hidden"!==a.borderTopStyle&&(Fd(b,a.borderTopWidth,a.borderTopColor,a.borderTopStyle),b.beginPath(),b.moveTo(c,d),b.lineTo(c+h,d),b.stroke()),0<a.borderBottomWidth&&a.borderBottomColor&&"none"!==a.borderBottomStyle&&"hidden"!==a.borderBottomStyle&&
(Fd(b,a.borderBottomWidth,a.borderBottomColor,a.borderBottomStyle),b.beginPath(),b.moveTo(c,d+k),b.lineTo(c+h,d+k),b.stroke()));b.restore()}Ad.prototype.H=function(a){qc(this,a,this.x,this.y)};Bd.prototype.stroke=function(a){a.save();this.Nb&&(a.shadowOffsetX=this.Nb[0],a.shadowOffsetY=this.Nb[1],a.shadowColor=this.shadowColor,a.shadowBlur=this.dd);0<this.width&&this.color&&"none"!==this.style&&"hidden"!==this.style&&(Fd(a,this.width,this.color,this.style),a.lineCap=this.be,a.stroke());a.restore()};function Jc(a,b,c,d,e,f,g,h,k,m){this.data=a;this.width=b;this.height=c;this.x=d;this.y=e;this.b=null;this.ga=[];this.o=f;this.h=null;this.m=this.Oa=!0;this.Aa=null;this.Mc=g||null;this.lb=h||null;this.kb=k||null;this.zf=this.hb=!1;this.R=this.doScroll=null;this.id=m||"";this.de=this.qa=this.M=this.v=null}Jc.prototype.clone=function(){var a=new Jc(this.data,this.width,this.height,this.x,this.y,this.o,this.Mc,this.lb,this.kb,this.id);a.h=this.h;return a};
Jc.prototype.H=function(a,b,c,d,e){var f=a.J,g=this.b&&void 0===b;g&&(f.save(),f.beginPath(),f.rect(this.b.x,this.b.y,this.b.Uc,this.b.Kc),f.clip(),b=this.b.bg,c=this.b.cg);d?this.h&&this.h(a,this,b||0,c||0,e):this.o&&this.o(a,this,b||0,c||0,e);g&&f.restore()};Jc.prototype.toDataURL=function(a,b,c){var d=document.createElement("canvas");b=b||1;d.width=b*this.width;d.height=b*this.height;b=new Kb(d,{zg:b});b.w=a;this.H(b);this.H(b,0,0,!0);return d.toDataURL(c||"image/png")};
function Gd(a){return a.b?{Hb:a.b.bg,Ib:a.b.cg}:{Hb:0,Ib:0}}
function Kb(a,b){function c(a){function b(a){var b=e.b.getBoundingClientRect(),f=Gd(a);a.de=a.Mc.$(e,a.data,a.width,a.height,b.left+a.x+f.Hb,b.top+a.y+f.Ib,c);return null!==a.de?(a.Mc.Ra&&a.Mc.Ra(e,a.data,a.de,a.width,a.height,b.left+a.x+f.Hb,b.top+a.y+f.Ib,c),e.qa&&e.qa(),e.pb?e.pb():B(e),Hd=a.Mc.Ra?function(c,g){g?a.Mc.jf&&(a.Mc.jf(e,a.data,a.de),e.qa&&e.qa(),e.pb?e.pb():B(e)):(a.Mc.Ra(e,a.data,a.de,a.width,a.height,b.left+a.x+f.Hb,b.top+a.y+f.Ib,Id(e,c,d)),e.qa&&e.qa(),e.pb?e.pb():B(e))}:null,
e.qa&&e.qa(),e.pb?e.pb():B(e),!0):!1}if(e.R){var c=Id(e,a,d);if(Jd(e,c)){var f=e.wb;f.Mc&&b(f)}else if(e.wb)e.v=-1,e.wb=null,e.qa&&e.qa(),e.pb?e.pb():B(e);else{var m=Kd(e,c,!0);if(0<m.length){if(f=e.$a[m[0]],0<=e.v&&e.v!==m[0]&&(e.v=-1,e.wb=null),e.qb=Date.now(),(!f.Mc||(a instanceof MouseEvent?f.v:f.M)&&e.v!==m[0]||!b(f))&&f.m){var q=f.Aa?f.Aa(f):f,n=null;a=Gd(q);var t=c.x-a.Hb,l=c.y-a.Ib;Hd=function(a,b,c){var g=Id(e,a,d);if(b){if((c?f.M:f.v)&&f===e.$a[Kd(e,g,!1)[0]])e.v=m[0],e.wb=(c?f.M:f.v)(f,
c);else if(n&&n.lb&&(!n.kb||n.kb(n,q)))n.lb(n,q);else if(null==n||null==n.lb||n.kb&&!n.kb(n,q))for(b=0;b<e.Aa.length&&!e.Aa[b].lb(n,q,g.x,g.y);b++);B(e);e.b.style.cursor="default"}else{c=Kd(e,g,!1);n=null;a=!1;for(b=0;!a&&b<c.length;b++)n=e.$a[c[b]],a=n.lb&&(!n.kb||n.kb(n,q));a&&null!=n?(n.zf=!0,B(e),n.zf=!1):B(e);b=e.J;a&&!n.hb&&(c=Gd(n),Ld(e,n.x+c.Hb,n.y+c.Ib,n.width,n.height,["drop-target"]));b.save();Md(e);e.transform&&(b.translate(e.width/2,e.height/2),CanvasRenderingContext2D.prototype.transform.apply(b,
e.transform),b.translate(-e.width/2,-e.height/2));b.translate(e.m*e.va.X,e.h*e.va.Y);b.globalAlpha=.5;q.H(e,g.x-t,g.y-l);q.ga.forEach(function(a){a.H(e,g.x-t,g.y-l);a.H(e,g.x-t,g.y-l,!0)});q.H(e,g.x-t,g.y-l,!0);b.restore();e.b.style.cursor=a?"copy":"default"}}}}else 0<=e.v&&(e.v=-1,e.wb=null,B(e))}}}var d=b&&b.zg||("devicePixelRatio"in window?window.devicePixelRatio:1);this.b=a;this.m=a.width/d;this.h=a.height/d;this.va=b&&b.va||{X:0,oa:1,Y:0,la:1};this.width=this.m*(this.va.oa-this.va.X);this.height=
this.h*(this.va.la-this.va.Y);this.R=!0;this.transform=this.hb=null;this.J=this.b.getContext("2d");this.Oa=this.state=null;this.Aa=[];this.qb=0;this.v=-1;this.wb=null;this.o={};this.clientData={};this.da=b&&b.da||new Jb;this.w=null;this.resize(this.width,this.height,b&&b.zg);this.ga={};var e=this;a.addEventListener("mousedown",c,!1);a.addEventListener("touchstart",function(a){var b=a.targetTouches;1===b.length&&(a.preventDefault(),c(b[0]),Nd=b[0])},!1);a.addEventListener("wheel",function(a){function b(b){b.doScroll&&
(a.preventDefault(),b.doScroll(0===a.deltaMode?a.deltaX:1===a.deltaMode?10*a.deltaX:30*a.deltaX,0===a.deltaMode?a.deltaY:1===a.deltaMode?10*a.deltaY:30*a.deltaY))}if(e.R){var c=Id(e,a,d);if(Jd(e,c))e.wb&&b(e.wb);else if(0>e.v){c=Kd(e,c,!0);for(var f=0;f<c.length;f++)if(null!=e.$a[c[f]].doScroll){b(e.$a[c[f]]);break}}}},!1);a.addEventListener("mousemove",function(a){if(e.R){var b=Id(e,a,d);b=Kd(e,b,!0);for(var c=0;c<b.length;c++)if(null!=e.$a[b[c]].R){a.preventDefault();e.$a[b[c]].R();return}e.Oa&&
e.Oa()}},!1);this.$a=[];this.M=[];this.pb=this.qa=null}function Zb(a,b){a.va=b||{X:0,oa:1,Y:0,la:1};a.width=a.m*(a.va.oa-a.va.X);a.height=a.h*(a.va.la-a.va.Y)}function ad(a,b){for(var c=0;c<a.Aa.length;c++)if("delete"===a.Aa[c].tag){a.Aa[c].lb=b;return}a.Aa.push({tag:"delete",lb:b})}Kb.prototype.show=function(){this.R=!0};Kb.prototype.Bc=function(){this.R=!1};function Od(a,b){a.b.style.filter=b}function Pd(a,b){a.hb=b&&b.slice();a.transform=a.hb}
function Id(a,b,c){var d=a.b.getBoundingClientRect();b={x:b.clientX*a.b.width/c/d.width,y:b.clientY*a.b.height/c/d.height,fh:b.altKey};c=[b.x,b.y];c=[c[0]-a.m*a.va.X,c[1]-a.h*a.va.Y];if(d=a.transform){var e=a.width/2;a=a.height/2;d=d.slice(0,4).concat(d[4]-e*d[0]-a*d[2]+e,d[5]-e*d[1]-a*d[3]+a);a=d[0]*d[3]-d[1]*d[2];a=[(d[3]*c[0]-d[2]*c[1]+d[2]*d[5]-d[3]*d[4])/a,(-d[1]*c[0]+d[0]*c[1]+d[1]*d[4]-d[0]*d[5])/a]}else a=c;b.x=a[0];b.y=a[1];return b}function Qd(a){a.qa&&a.qa();a.pb?a.pb():B(a)}
function Sb(a,b){return{j:a,tg:60,ug:120,pg:!1,ja:Math.max(1,Math.min(3,Math.round(a/40))),xf:Math.round(a/4).toString(10)+"px sans-serif",rh:"navy",sh:"#37f",qh:"#06f",c:b,ta:Math.max(1,Math.min(3,b/30)),Zg:"bold 15px sans-serif",Sf:"navy",Rf:"#ccc",Rc:5,Af:"#e44",ag:"#f88",Qf:"#bbb"}}
function Zc(a,b){a.width=a.m*(a.va.oa-a.va.X);a.height=a.h*(a.va.la-a.va.Y);a.J=a.b.getContext("2d");b=b||("devicePixelRatio"in window?window.devicePixelRatio:1);1!=b&&(a.J.resetTransform(),a.J.scale(b,b));a.da.b=new vd(a.width,a.width/100,a.height/100,a.m/100,a.h/100);b=F(a.da,{tag:"block"}).width;var c=F(a.da,{tag:"button"}).width;a.w=Sb(b,c)}
Kb.prototype.resize=function(a,b,c){var d=c||("devicePixelRatio"in window?window.devicePixelRatio:1);this.b.width=a*d;this.b.height=b*d;this.m=a;this.h=b;Zc(this,c)};function Mc(a,b){for(var c=0;c<a.$a.length;c++)if(a.$a[c].data===b)return c;return-1}
function Kd(a,b,c){var d=a.b.getBoundingClientRect(),e=b.x-d.left;b=b.y-d.top;d=[];for(var f=a.$a.length-1;0<=f;f--){var g=Gd(a.$a[f]);if(g=(!c||a.$a[f].Oa)&&e>=a.$a[f].x+g.Hb&&e<=a.$a[f].x+g.Hb+a.$a[f].width&&b>=a.$a[f].y+g.Ib&&b<=a.$a[f].y+g.Ib+a.$a[f].height)g=a.$a[f],g=!g.b||e>=g.b.x&&e<g.b.x+g.b.Uc&&b>=g.b.y&&b<g.b.y+g.b.Kc;g&&d.push(f)}return d}
function lc(a,b){var c=b.clone();a=$c(a);var d=Math.min(a.width,a.height)/1.5/c.width;c.width*=d;c.height*=d;c.x=(a.width-c.width)/2;c.y=(a.height-c.height)/2;c.v=null;c.M=null;c.o=function(a,f){var e=a.J;e.save();e.translate(f.x,f.y);e.scale(d,d);e.translate(-f.x,-f.y);b.o(a,c,f.x-c.x,f.y-c.y,!0);e.restore()};b.h&&(c.h=function(a,f){var e=a.J;e.save();e.translate(f.x,f.y);e.scale(d,d);e.translate(-f.x,-f.y);b.h(a,c,f.x-c.x,f.y-c.y,!0);e.restore()});return c}
function Jd(a,b){if(null==a.wb)return!1;var c=a.b.getBoundingClientRect(),d=b.x-c.left;b=b.y-c.top;return d>=a.wb.x&&d<=a.wb.x+a.wb.width&&b>=a.wb.y&&b<=a.wb.y+a.wb.height}function $c(a){return{width:a.width,height:a.height}}function Md(a){a.J.beginPath();a.J.rect(a.m*a.va.X,a.h*a.va.Y,a.m*(a.va.oa-a.va.X),a.h*(a.va.la-a.va.Y));a.J.clip()}
function Rd(a,b,c,d,e,f,g){f=f||0;g=g||0;if(0<a.M.length){var h=a.M[a.M.length-1];h.x>b&&(d-=h.x-b,b=h.x);h.x+h.Uc<b+d&&(d=h.x+h.Uc-b);h.y>c&&(e-=h.y-c,c=h.y);h.y+h.Kc<c+e&&(e=h.y+h.Kc-c);f+=h.bg;g+=h.cg}a.M.push({x:b,y:c,Uc:d,Kc:e,bg:f,cg:g})}function Lc(a,b,c){0<a.M.length&&(b.b=a.M[a.M.length-1]);0<=c?a.$a[c]=b:a.$a.push(b)}function D(a,b){var c=new Jc(null,-1,-1,0,0,function(a,c,f,g){a=a.J;a.save();a.translate(c.x+f,c.y+g);b(a);a.restore()});Lc(a,c);return c}
function rc(a,b,c,d,e,f,g,h,k,m){var q,n=new Jc(null,d.width,d.height,b,c,function(b,c,f,g){b=b.J;b.save();qc(d,b,c.x+f,c.y+g);b.translate(c.x+f,c.y+g);e(b,d,a.o.id===m&&a.o.td||c.zf);b.restore()},f?{$:function(b,c,d,e,f,g,h){a.o={id:m,rect:{x:n.x,y:n.y,Uc:d,Kc:e},td:!0};q=h;B(a);return 0},Ra:function(b,c,d,e,f,g,h,k){d=b.b.getBoundingClientRect();c=k.x-d.left;k=k.y-d.top;a.o.td=c>=a.o.rect.x&&c<a.o.rect.x+a.o.rect.Uc&&k>=a.o.rect.y&&k<a.o.rect.y+a.o.rect.Kc;B(b)},jf:function(){a.o.td&&f(q);a.o={};
B(a)}}:null,g,h,m);n.R=k||null;n.m=!1;n.hb=!0;Lc(a,n);return n}function Uc(a,b,c,d,e){qc(e,a.J,c-e.width/2,d-e.height/2);var f=a.ga[b];void 0!=f&&(a.J.save(),a.J.translate(c,d),f(a.J,b,a.w,e),a.J.restore())}
function B(a){a.R&&(a.J.clearRect(a.m*a.va.X,a.h*a.va.Y,a.m*(a.va.oa-a.va.X),a.h*(a.va.la-a.va.Y)),a.J.save(),a.transform&&(a.J.translate(a.width/2,a.height/2),CanvasRenderingContext2D.prototype.transform.apply(a.J,a.transform),a.J.translate(-a.width/2,-a.height/2)),a.J.translate(a.m*a.va.X,a.h*a.va.Y),a.$a.forEach(function(a){a.H(this)},a),a.$a.forEach(function(a){a.H(this,void 0,void 0,!0)},a),a.wb&&(a.J.save(),a.J.globalAlpha=.5,a.J.fillStyle="black",a.J.fillRect(a.m*a.va.X,a.h*a.va.Y,a.m*(a.va.oa-
a.va.X),a.h*(a.va.la-a.va.Y)),a.J.restore(),a.wb.H(a),a.wb.H(a,0,0,!0)),a.J.restore())};function Fc(){this.v=this.M=1;this.b=this.h=this.y=this.x=0;this.R=!1;this.Aa="";this.Vd=this.m=this.Ud=this.o=0;this.ga=null}w=Fc.prototype;w.sc=function(a){this.M=a;this.o=Math.max(0,Math.min(this.o,this.M-this.h))};w.fc=function(a){this.v=a;this.m=Math.max(0,Math.min(this.m,this.v-this.b))};w.resize=function(a,b,c,d){this.x=a;this.y=b;this.h=c;this.b=d;this.o=Math.max(0,Math.min(this.o,this.M-this.h));this.m=Math.max(0,Math.min(this.m,this.v-this.b))};
w.Gd=function(a){this.ga=a;var b=this,c=new Jc(null,this.h,this.b,this.x,this.y,null,this.M>this.h||this.v>this.b?{$:function(a,c,f,g,h,k,m){b.Ud=m.x;b.Vd=m.y;return 0},Ra:function(a,c,f,g,h,k,m,q){a=Math.max(Math.min(q.x-b.Ud,b.o),b.o-b.M+b.h);b.o-=a;b.Ud+=a;q=Math.max(Math.min(q.y-b.Vd,b.m),b.m-b.v+b.b);b.m-=q;b.Vd+=q}}:null,null,null);c.m=!1;c.doScroll=function(c,e){b.o+=c;b.m+=e;a.qa()};Lc(a,c);this.Aa&&D(a,function(a){a.save();a.fillStyle=b.Aa;a.fillRect(b.x,b.y,b.h,b.b);a.restore()});(this.M>
this.h||this.v>this.b)&&D(a,function(c){c.save();if(b.M>b.h){var d=b.h/b.M;d=Math.max(d*b.h,Math.min(20,b.h));var f=b.h-d,g=b.o/(b.M-b.h);f*=g;c.fillStyle=a.w.Rf;c.fillRect(b.x,b.y+b.b+2,b.h,a.w.Rc);c.fillStyle=a.w.Sf;c.fillRect(b.x+f,b.y+b.b+2,d,a.w.Rc)}b.v>b.b&&(d=b.b/b.v,d=Math.max(d*b.b,Math.min(20,b.b)),f=b.b-d,g=b.m/(b.v-b.b),f*=g,c.save(),c.fillStyle=a.w.Rf,c.fillRect(b.R?b.x-2-a.w.Rc:b.x+b.h+2,b.y,a.w.Rc,b.b),c.fillStyle=a.w.Sf,c.fillRect(b.R?b.x-2-a.w.Rc:b.x+b.h+2,b.y+f,a.w.Rc,d));c.restore()});
Rd(a,this.x,this.y,this.h,this.b,-this.o,-this.m)};w.end=function(){this.ga.M.pop()};function bd(a){return a.m<=.001*a.b}function cd(a){return a.m>=a.v-1.001*a.b};function Ld(a,b,c,d,e,f){f=F(a.da,{tag:"overlay-rectangle",W:f||[]});f.x=b;f.y=c;f.width=d;f.height=e;f.H(a.J)}
function zc(a,b,c,d,e,f,g,h){Ld(a,b,c,d,e,(f||[]).concat("disabled"));F(a.da,{tag:"overlay-rectangle",W:f||[]});if(!h){a.J.save();f=Wc(a.da,{tag:"crossout-line",W:g||[]});a.J.beginPath();h=a.da;g=/^(-?([0-9]+\.?|[0-9]*\.[0-9]+))([a-z]*)$/.exec(f.Nf["line-angle"]||"0");if(null==g)throw"Illegal angle";if(h.M.hasOwnProperty(g[3]))h=h.M[g[3]];else if(0==parseFloat(g[1]))h=0;else throw"Unknown angle unit";g=parseFloat(g[1])*h;h=hd(a.da,f.Nf["line-overflow"]||"0").N(a.da.b);if(Math.abs(g%Math.PI)<.25*Math.PI||
Math.abs((Math.PI-g)%Math.PI)<.25*Math.PI){h=(d/2+h)*Math.sign(Math.cos(g));var k=e/2*Math.sin(g)*Math.sqrt(2)}else k=(e/2+h)*Math.sign(Math.sin(g)),h=d/2*Math.cos(g)*Math.sqrt(2);a.J.moveTo(b+d/2-h,c+e/2-k);a.J.lineTo(b+d/2+h,c+e/2+k);f.stroke(a.J);a.J.restore()}}
function uc(a,b,c,d,e,f){a.save();a.strokeStyle=e;a.fillStyle=e;a.lineWidth=d;a.fillRect(b-2.5*d,c-d,5*d,4*d);a.beginPath();a.moveTo(b-1.7*d,c);a.lineTo(b-1.7*d,c);f?(a.arc(b-3.4*d,c-2*d,1.7*d,0,Math.PI,!0),a.lineTo(b-5.1*d,c)):(a.arc(b,c-2*d,1.7*d,-Math.PI,0),a.lineTo(b+1.7*d,c));a.stroke();a.restore()}function Kc(a,b,c,d,e,f,g){var h=.03*a.w.j;uc(a.J,b+d+(f?-5:5)*h,c+.15*e,h,g||"#333")}
function wc(a,b,c,d,e,f,g){a.save();g&&(g.style&&(a.strokeStyle=g.style,a.fillStyle=g.style),void 0!==g.lineWidth&&(a.lineWidth=g.lineWidth),void 0!==g.alpha&&(a.globalAlpha=g.alpha));var h=g&&void 0!==g.Wc?g.Wc:5*a.lineWidth;a.beginPath();var k=e+(g&&g.Ed?h/d:0),m=f-(g&&g.Ed?0:h/d);a.arc(b,c,d,k,m);a.stroke();g&&g.Ed?(a.translate(b+d*Math.cos(e),c+d*Math.sin(e)),a.rotate((e+k)/2+Math.PI)):(a.translate(b+d*Math.cos(f),c+d*Math.sin(f)),a.rotate((f+m)/2));a.beginPath();a.moveTo(0,0);a.lineTo(h/2,1.2*
-h);a.lineTo(-h/2,1.2*-h);a.fill();a.restore()}Kb.prototype.text=function(a,b){var c=this.J,d=this.w;c.save();c.fillStyle=b&&b.fillStyle||"white";c.font=d.xf;c.textAlign="center";c.textBaseline="middle";c.translate(.5*d.j+(b&&b.x||0),.5*d.j-(b&&b.y||0));b&&b.hh&&c.rotate(-b.hh);c.translate(-.5*d.j,-.5*d.j);c.fillText(a,.5*d.j,.5*d.j);c.restore()};
function Sd(a,b){var c=a.J,d=a.w;c.save();c.beginPath();c.rect(0,0,a.w.j,a.w.j);c.clip();b&&(b.scale||b.rotation)&&(b.rf&&c.translate(-b.rf[0],-b.rf[1]),c.translate(.5*d.j,.5*d.j),b.scale&&c.scale(b.scale,b.scale),b.rotation&&c.rotate(-b.rotation),c.translate(-.5*d.j,-.5*d.j));c.beginPath();c.moveTo(.5*d.j,d.j-d.ja);b&&"left"===b.Le||(c.lineTo(d.j-d.ja,d.j-d.ja),c.lineTo(d.j-d.ja,.25*d.j),c.bezierCurveTo(.8*d.j,d.ja,.52*d.j,d.ja,.5*d.j,d.ja));b&&"right"===b.Le||(c.lineTo(.5*d.j,d.ja),c.bezierCurveTo(.48*
d.j,d.ja,.2*d.j,d.ja,d.ja,.25*d.j),c.lineTo(d.ja,d.j-d.ja));c.closePath();if(b&&b.Ub){a=[b.Ub[0],Math.max(.2+.8*b.Ub[1],b.Ub[2]/2),b.Ub[2]];var e=Math.max(a[0],Math.max(a[1],a[2]));c.fillStyle="rgb("+a.map(function(a){return Math.round(225*(1-e)+(30+225*e)*a)}).join(",")+")"}else c.fillStyle="white";c.fill();b&&b.Ub&&(c.strokeStyle="white",c.lineWidth=d.ja,c.stroke());b&&b.jc&&(c.fillStyle="black",c.fillRect(0,.6*d.j,.1*d.j,.35*d.j),c.fillRect(.9*d.j,.6*d.j,.1*d.j,.35*d.j));c.restore()}
function Td(a,b){var c=(b-a)/2,d=b===a?Infinity:(b+a)/(2*c);return{bb:c,uf:d,x:Math.abs(d)>1E3*Math.abs(a+b)?0:d*(.01>c?c*c/2:1-Math.cos(c)),y:Math.abs(d)>1E3*Math.abs(a+b)?(a+b)/2:d*Math.sin(c)}}
function Ud(a,b,c,d,e){var f=a.J;a=a.w;d*=a.j;var g=e&&e.r||[-1,0,1],h=e&&e.color||"black";e=e&&void 0!==e.Fe?e.Fe:1;var k=Td(b,c);f.save();f.translate(.5*a.j,.5*a.j);f.strokeStyle=h;f.lineWidth=a.ja*e;20<Math.abs(k.uf)?(f.beginPath(),g.forEach(function(a){f.moveTo(a*d,0);f.lineTo((k.x+a)*d,-k.y*d)}),f.stroke()):g.forEach(function(a){f.beginPath();var b=-k.uf*d;a=(k.uf+a)*d;var c=k.bb;0<a?f.arc(b,0,a,0,-c,0<c):0>a&&f.arc(b,0,-a,Math.PI,Math.PI-c,0<c);f.stroke()});f.restore();return k}
function Vd(a,b,c,d,e,f,g){a=a.w;e*=a.j;f*=a.j;a=.21*a.j;c=g.x-c-b/2;b=d+b/2-g.y;e=Td(e,f);return(c-e.x)*(c-e.x)+(b-e.y)*(b-e.y)<a*a}
function Wd(a){var b=a.J;a=a.w;b.save();b.translate(.5*a.j,.5*a.j);b.scale(.7,.7);b.translate(-.5*a.j,-.5*a.j);b.fillStyle="white";b.fillRect(a.ja,.45*a.j,a.j-2*a.ja,.35*a.j);b.fillStyle="black";b.beginPath();b.arc(.27*a.j,.72*a.j,.2*a.j,0,2*Math.PI);b.fill();b.fillStyle="white";b.beginPath();b.arc(.27*a.j,.72*a.j,.12*a.j,0,2*Math.PI);b.fill();b.beginPath();b.arc(.8*a.j,.8*a.j-a.ja,.1*a.j,0,2*Math.PI);b.fill();b.restore()}
function Xd(a){var b=a.J;a=a.w;b.save();b.lineWidth=a.ja;b.strokeStyle="white";for(var c=1;3>=c;c++)b.beginPath(),b.arc(.185*a.j,.48*a.j,.05*a.j*c,.9*Math.PI,1.7*Math.PI),b.stroke();b.restore()}
Kb.prototype.buttons=function(a,b,c){var d=this.J,e=this.w;a.forEach(function(a,g){d.save();d.translate(e.j*(.5+a.x),e.j*(.5-a.y));d.rotate(a.r||0);d.fillStyle=a.fillStyle?a.fillStyle:c&&c.Df&&b?c.Df[b[g]]:b&&!0===b[g]?"red":b&&1===b[g]?"#f66":b&&-1===b[g]?"#333":"white";d.strokeStyle=a.strokeStyle?a.strokeStyle:c&&c.Uf&&b?c.Uf[b[g]]:!b||1!==b[g]&&!0!==b[g]?b&&0>b[g]?"black":"#aaa":"#700";d.lineWidth=e.ja;d.lineJoin="round";var f=a.size||1;switch(a.D){case "r":d.fillRect(.08*-e.j*f,.08*-e.j*f,.16*
e.j*f,.16*e.j*f);d.strokeRect(.08*-e.j*f,.08*-e.j*f,.16*e.j*f,.16*e.j*f);break;case "t":d.beginPath();d.moveTo(0,-.122*e.j*f);d.lineTo(.106*e.j*f,.062*e.j*f);d.lineTo(-.106*e.j*f,.062*e.j*f);d.closePath();d.fill();d.stroke();break;case "c":d.beginPath(),d.arc(0,0,.112*e.j*f,0,2*Math.PI),d.fill(),d.stroke()}b&&c&&void 0!==c.Hd&&c.Hd===b[g]&&(d.strokeStyle="white",d.beginPath(),d.moveTo(.06*-e.j*f,.06*-e.j*f),d.lineTo(.06*e.j*f,.06*e.j*f),d.moveTo(.06*-e.j*f,.06*e.j*f),d.lineTo(.06*e.j*f,.06*-e.j*f),
d.stroke());d.restore()})};function Yd(a,b,c,d,e,f,g,h,k){var m=a.J;a=a.w;m.save();m.strokeStyle="black";m.lineWidth=a.ja*k;k=b.length/2;for(var q=0;q<k;q++)0<b[2*q+1]&&(m.fillStyle=2===b[2*q+1]?"white":"black",m.beginPath(),m.arc(a.j*(c+(d-c)/k*(q+.5)),a.j*(e+(f-e)/g*(b[2*q]+.5)),a.j*h/2,0,2*Math.PI),m.fill(),m.stroke());m.restore()}
function Zd(a,b){var c=a.J,d=a.w,e=null===b?-.15*d.j:0;c.save();c.beginPath();c.moveTo(.4*d.j+e,.3*d.j);c.lineTo(.4*d.j+e,.7*d.j);c.lineTo(.7*d.j+e,.7*d.j);c.lineTo(.7*d.j+e,.37*d.j);c.lineTo(.63*d.j+e,.3*d.j);c.closePath();c.lineWidth=d.ja;c.strokeStyle="white";c.lineJoin="round";c.stroke();for(var f=.15;.31>f;f+=.06)c.beginPath(),c.arc(.65*d.j+e,.5*d.j,d.j*f,-.6,.6),c.stroke();null===b?(c.beginPath(),c.moveTo(.12*d.j,.6*d.j),c.lineTo(.88*d.j,.4*d.j),c.lineWidth=1.5*d.ja,c.stroke()):a.text(b.toString(10),
{x:-.3*d.j});c.restore()}function $d(a){var b=a.J;a=a.w;b.beginPath();b.arc(0,0,.4*a.j,0,2*Math.PI,!0);b.moveTo(0,0);b.lineTo(0,.4*-a.j);b.strokeStyle="#666";b.lineWidth=a.ja;b.stroke();b.beginPath();b.arc(0,.4*-a.j,.1*a.j,0,2*Math.PI);b.fillStyle="white";b.fill();b.strokeStyle="black";b.stroke()}
function ae(a,b,c){var d=a.J,e=a.w;c=c*Math.PI/12;d.save();d.translate(.5*e.j,.5*e.j);d.rotate(c);$d(a);d.fillRect(-.28*e.j,-.1*e.j,.56*e.j,.2*e.j);d.fillStyle="black";b?(d.beginPath(),d.arc(-.15*e.j,.03*e.j,.11*e.j,0,2*Math.PI),d.fill(),d.fillStyle="white",d.beginPath(),d.arc(-.15*e.j,.03*e.j,.07*e.j,0,2*Math.PI),d.fill(),d.beginPath(),d.arc(.15*e.j,.07*e.j,.06*e.j,0,2*Math.PI)):(d.fillRect(-.28*e.j,.1*e.j,.08*e.j,.04*e.j),d.fillRect(.2*e.j,.1*e.j,.08*e.j,.04*e.j),d.fillStyle="white",d.beginPath(),
d.arc(0,.06*e.j,.06*e.j,0,2*Math.PI));d.fill();d.restore()}function be(a,b,c,d,e){b=d.x-b-a/2;c=c+a/2-d.y;a=(b*b+c*c)/(a*a/4);return 1>a&&.4<a&&(e||0<=c)}function ce(a,b,c,d,e){a=Math.round(12*Math.atan2(d.x-b-a/2,c+a/2-d.y)/Math.PI);return e?12===a?-12:a:Math.max(-6,Math.min(6,a))}
function de(a,b,c,d,e,f,g,h,k){var m=k?0>=g?0:Math.max(Math.log(10*g)/Math.log(100),0):g/4;a.save();!h&&f&&f(g);a.beginPath();a.arc(b,c,d,0,2*Math.PI);a.fillStyle="white";a.fill();f=.9*d;g=k?.8*d:.6*d;var q=2*Math.PI*(h?.2:m),n=h?"#ddd":"red";k=(g-(k?.5*d:.6*d))/4;a.save();a.beginPath();a.arc(b,c,f,-Math.PI/2,3*Math.PI/2-.05);a.arc(b,c,g-4*k,3*Math.PI/2-.05,Math.PI,!0);a.arc(b+k,c,g-3*k,Math.PI,Math.PI/2,!0);a.arc(b+k,c-k,g-2*k,Math.PI/2,0,!0);a.arc(b,c-k,g-k,0,-Math.PI/2,!0);a.clip();a.fillStyle=
n;a.beginPath();a.arc(b,c,f,-Math.PI/2,-Math.PI/2+q);a.lineTo(b,c);a.fill();a.restore();a.beginPath();a.arc(b,c,d/2,0,2*Math.PI);a.fill();a.beginPath();a.arc(b,c,d,0,2*Math.PI);a.strokeStyle="black";a.lineWidth=e;a.stroke();a.beginPath();a.moveTo(b-.1*d*Math.sin(2*m*Math.PI),c+.1*d*Math.cos(2*m*Math.PI));a.lineTo(b+.9*d*Math.sin(2*m*Math.PI),c-.9*d*Math.cos(2*m*Math.PI));a.lineWidth=2*e;a.stroke();h&&wc(a,b,c,1.25*d,.5*-Math.PI,.1*-Math.PI,{Ed:!0,Wc:5*e,style:"black"});a.restore()}
function ee(a,b,c,d){var e=a.J,f=a.w.j;de(e,f/2+(c?-.05*f:.05*f),f/2+(c?.07*f:.03*f),.4*f,a.w.ja,function(a){e.textAlign="start";e.textBaseline="top";e.font=Math.round(f/6).toString(10)+"px sans-serif";e.fillStyle="white";e.fillText(a.toFixed(1>a?2:1),f/20,f/40)},b,c,d)}
function fe(a,b,c,d,e,f,g,h,k,m){var q=(d+e)/2,n=(e-d)/2;a.save();a.beginPath();a.arc(b,c,d,-g,-f);a.arc(b+q*Math.cos(f),c-q*Math.sin(f),n,-f-Math.PI,-f,!0);a.arc(b,c,e,-f,-g,!0);a.arc(b+q*Math.cos(g),c-q*Math.sin(g),n,-g,-g+Math.PI,!0);a.fillStyle=h;a.strokeStyle=k;a.lineWidth=m;a.fill();a.stroke();a.restore()}function ge(a,b,c,d){var e=a.w;fe(a.J,e.j/2,e.j/2,.3*e.j,.45*e.j,b,c,0>d?"white":2===d?"red":0<d?"#f70":"#ddd",0===d?"#bbb":"black",e.ja)}
function he(a,b){var c=a.J;c.save();ge(a,.65*Math.PI,.85*Math.PI,b[0]);ge(a,.15*Math.PI,.35*Math.PI,b[1]);ge(a,1.15*Math.PI,1.35*Math.PI,b[2]);ge(a,1.65*Math.PI,1.85*Math.PI,b[3]);c.restore()}function ie(a,b){var c=a.J;c.save();for(var d=0;8>d;d++)ge(a,Math.PI*(.46-.25*d),Math.PI*(.54-.25*d),d===b?1:-1);c.restore()}function je(a,b,c,d,e,f){b=(f.x-d)/b-.5;c=.5-(f.y-e)/c;for(e=0;e<a.length;e++)if(Math.max(Math.abs(b-a[e].x),Math.abs(c-a[e].y))<.11*(a[e].size||1))return e;return null}
function G(a,b,c,d,e,f){function g(a,b){h.beginPath();h.moveTo(k.j*(.1+.8*a),k.j*(.46-c));h.lineTo(k.j*(.1+.8*b),k.j*(.46-c));h.arc(k.j*(.1+.8*b),k.j*(.5-c),.04*k.j,-Math.PI/2,Math.PI/2);h.lineTo(k.j*(.1+.8*b),k.j*(.54-c));h.lineTo(k.j*(.1+.8*a),k.j*(.54-c));h.arc(k.j*(.1+.8*a),k.j*(.5-c),.04*k.j,Math.PI/2,-Math.PI/2)}var h=a.J,k=a.w;h.save();d&&(h.translate(.5*k.j,.5*k.j),h.rotate(-Math.PI/2),h.scale(1,-1),h.translate(-.5*k.j,-.5*k.j));h.lineWidth=k.ja;h.fillStyle="white";h.strokeStyle="black";g(0,
1);h.fill();h.stroke();h.fillStyle=e;switch(f||0){case 1:g(0,b);h.fill();h.stroke();break;case 2:g(b,1),h.fill(),h.stroke()}h.fillStyle=e;h.strokeStyle="black";h.lineWidth=k.ja;h.beginPath();h.arc(k.j*(.1+.8*b),k.j*(.5-c),.1*k.j,0,2*Math.PI);h.fill();h.stroke();h.restore()}function I(a,b,c,d,e,f,g){c=(g.x-e)/c-.5;d=.5-(g.y-f)/d;return.1>Math.abs((b?c:d)-a)}function ke(a,b,c,d,e,f){b=(f.x-d)/b-.5;c=.5-(f.y-e)/c;return.5+(a?c:b)/.8}
function le(a,b,c,d,e,f,g,h,k,m,q){a=Math.floor(((q.x-k)/g-a)/((b-a)/e));c=Math.floor((c-(q.y-m)/h)/((c-d)/f));return 0<=a&&a<e&&0<=c&&c<f?{index:a,tone:c}:null}function me(a,b,c,d,e){var f=.4*a;a=e.x-c-.55*a;b=d+.53*b-e.y;return a*a+b*b<=f*f}function ne(a,b,c,d,e,f){a=(Math.PI-Math.atan2(f.x-c-.55*a,-(d+.53*b-f.y)))/(2*Math.PI);return e?Math.exp(a*Math.log(100))/10:4*a}function oe(a,b,c,d,e){c=e.x-c-a/2;b=b/2-(e.y-d);return Math.abs(Math.sqrt(c*c+b*b)-.375*a)<=.15*a?0<=b?0>c?0:1:0>c?2:3:null}
function pe(a,b,c,d,e){c=e.x-c-a/2;b=b/2-(e.y-d);return Math.abs(Math.sqrt(c*c+b*b)-.375*a)<=.15*a?(a=Math.atan2(c,b)+Math.PI/8,Math.floor((0>a?a+2*Math.PI:a)/(Math.PI/4))):null}function vc(a,b,c,d){if(0<d){a.beginPath();a.moveTo(b+d*Math.cos(.1),c+d*Math.sin(.2));for(var e=1;6>e;e++)a.lineTo(b+d*Math.cos(e*Math.PI/3+.2),c+d*Math.sin(e*Math.PI/3+.2));a.closePath();a.arc(b,c,.5*d,0,2*Math.PI,!0);a.fill()}};function ta(a){for(var b=0;b<Ya.length;b++)if(Ya[b].name===a)return Ya[b];return null}function Va(a){var b=[];(Ya||[]).forEach(function(c){"h"!==c.type&&0<=c.ma.indexOf(a)&&b.push(c)});return b};var Ya=[new y({name:"!stop",type:"h"}),new y(function(){var a=[{D:"c",x:0,y:0,r:0},{D:"t",x:0,y:.3,r:0},{D:"t",x:0,y:-.3,r:Math.PI},{D:"t",x:.3,y:0,r:Math.PI/2},{D:"t",x:-.3,y:0,r:-Math.PI/2}];return{name:"button 1",type:"e",ha:function(){return[0]},H:function(b,c){Sd(b);c=c.g[0];b.buttons(a,[0==c,1==c,2==c,3==c,4==c])},$:function(b,c,d,e,f,g,h){b=je(a,d,e,f,g,h);null!==b&&(A(c),c.g[0]=b);return b}}}()),new y(function(){var a=[{D:"c",x:0,y:0,r:0},{D:"t",x:0,y:.3,r:0},{D:"t",x:0,y:-.3,r:Math.PI},{D:"t",
x:.3,y:0,r:Math.PI/2},{D:"t",x:-.3,y:0,r:-Math.PI/2}];return{name:"button",ma:["c"],type:"e",ha:function(){return[!1,!1,!1,!1,!1]},gb:function(){return[!1,!1,!0,!1,!0]},H:function(b,c){Sd(b);b.buttons(a,c.g)},$:function(b,c,d,e,f,g,h){b=je(a,d,e,f,g,h);null!==b&&(A(c),c.g[b]=!c.g[b]);return b},vc:function(a){for(var b=0;5>b;b++)if(a.g[b])return null;return new Da("No button specified",!0)}}}()),new y(function(){var a=[{D:"r",x:0,y:.4,r:0,A:"2"},{D:"r",x:-.22,y:.35,r:-.45,A:"1"},{D:"r",x:.22,y:.35,
r:.45,A:"3"},{D:"r",x:-.4,y:.22,r:-.8,A:"0"},{D:"r",x:.4,y:.22,r:.8,A:"4"},{D:"r",x:-.2,y:-.4,A:"5"},{D:"r",x:.2,y:-.4,A:"6"}];return{name:"horiz prox",ma:["b"],type:"e",ha:function(){return[0,0,0,0,0,0,0]},gb:function(){return[0,1,-1,1,-1,0,0]},H:function(b,c){Sd(b);b.buttons(a,c.g,{Hd:-1})},$:function(b,c,d,e,f,g,h){b=je(a,d,e,f,g,h);null!==b&&(A(c),c.g[b]=(c.g[b]+2)%3-1);return b},vc:function(a){for(var b=0;7>b;b++)if(a.g[b])return null;return new Da("No proximity sensor specified",!0)},Hc:function(a,
c){switch(c){case "a":return c=new z(ta("horiz prox adv"),null,null),c.g=a.g.concat(c.g.slice(7)),c;default:return a}}}}()),new y(function(){var a=[{D:"r",x:0,y:.4,r:0,A:"2"},{D:"r",x:-.22,y:.35,r:-.45,A:"1"},{D:"r",x:.22,y:.35,r:.45,A:"3"},{D:"r",x:-.4,y:.22,r:-.8,A:"0"},{D:"r",x:.4,y:.22,r:.8,A:"4"},{D:"r",x:-.2,y:-.4,A:"5"},{D:"r",x:.2,y:-.4,A:"6"}];return{name:"horiz prox adv",ma:["c"],type:"e",ha:function(){return[0,0,0,0,0,0,0,.1,.4]},gb:function(){return[0,1,2,1,2,3,3,.1,.4]},H:function(b,
c){Sd(b);b.buttons(a,c.g,{Df:["white","red","#333","#888"],Uf:["#aaa","black","black","black"],Hd:2});G(b,c.g[8],.02,!1,"red",2);G(b,c.g[7],-.2,!1,"black",1)},$:function(b,c,d,e,f,g,h){b=je(a,d,e,f,g,h);return null!==b?(A(c),c.g[b]=(c.g[b]+1)%4,b):I(.02,!1,d,e,f,g,h)?(A(c),8):I(-.2,!1,d,e,f,g,h)?(A(c),7):null},Ra:function(a,c,d,e,f,g,h,k){7<=d&&(c.g[d]=Math.max(0,Math.min(1,ke(!1,e,f,g,h,k))))},vc:function(a){for(var b=0;7>b;b++)if(a.g[b])return null;return new Da("No sensor specified",!0)},Hc:function(a,
c){switch(c){case "b":if(c=a.V.ha(),a.g[7]===c[7]&&a.g[8]===c[8])return c=new z(ta("horiz prox"),null,null),c.g=a.g.slice(0,7),c;default:return a}}}}()),new y(function(){var a=[{D:"r",x:0,y:.4,r:0,A:"2"},{D:"r",x:-.22,y:.35,r:-.45,A:"1"},{D:"r",x:.22,y:.35,r:.45,A:"3"},{D:"r",x:-.4,y:.22,r:-.8,A:"0"},{D:"r",x:.4,y:.22,r:.8,A:"4"},{D:"r",x:-.2,y:-.4,A:"5"},{D:"r",x:.2,y:-.4,A:"6"}];return{name:"horiz prox 1",ma:["a"],type:"e",ha:function(){return[0,0,0,0,0,0,0,.25]},gb:function(){return[0,1,-1,1,-1,
0,0,.25]},H:function(b,c){Sd(b);b.buttons(a,c.g,{Hd:-1});G(b,c.g[7],-.1,!1,"black",1)},$:function(b,c,d,e,f,g,h){b=je(a,d,e,f,g,h);return null!==b?(A(c),c.g[b]=(c.g[b]+2)%3-1,b):I(-.1,!1,d,e,f,g,h)?(A(c),7):null},Ra:function(a,c,d,e,f,g,h,k){7<=d&&(c.g[d]=Math.max(.25,Math.min(.75,Math.round(4*ke(!1,e,f,g,h,k))/4)))},vc:function(a){for(var b=0;7>b;b++)if(a.g[b])return null;return new Da("No sensor specified",!0)},Hc:function(a,c){switch(c){case "b":if(c=a.V.ha(),a.g[7]===c[7])return c=new z(ta("horiz prox"),
null,null),c.g=a.g.slice(0,7),c;default:return a}}}}()),new y(function(){var a=[{D:"r",x:-.15,y:.35,A:"0"},{D:"r",x:.15,y:.35,A:"1"}];return{name:"ground",ma:["b"],type:"e",ha:function(){return[0,0]},gb:function(){return[1,-1]},H:function(b,c){Sd(b,{jc:!0});b.buttons(a,c.g,{Hd:-1})},$:function(b,c,d,e,f,g,h){b=je(a,d,e,f,g,h);null!==b&&(A(c),c.g[b]=(c.g[b]+2)%3-1);return b},vc:function(a){return a.g[0]||a.g[1]?null:new Da("No ground sensor specified",!0)},Hc:function(a,c){switch(c){case "a":return c=
new z(ta("ground adv"),null,null),c.g=a.g.concat(c.g.slice(2)),c;default:return a}}}}()),new y(function(){var a=[{D:"r",x:-.15,y:.35,A:"0"},{D:"r",x:.15,y:.35,A:"1"}];return{name:"ground adv",ma:["c"],type:"e",ha:function(){return[0,0,.4,.6]},gb:function(){return[1,2,.4,.6]},H:function(b,c){Sd(b,{jc:!0});b.buttons(a,c.g,{Df:["white","red","#333","#888"],Uf:["#aaa","black","black","black"],Hd:2});G(b,c.g[3],.02,!1,"red",2);G(b,c.g[2],-.2,!1,"black",1)},$:function(b,c,d,e,f,g,h){b=je(a,d,e,f,g,h);return null!==
b?(A(c),c.g[b]=(c.g[b]+1)%4,b):I(.02,!1,d,e,f,g,h)?(A(c),3):I(-.2,!1,d,e,f,g,h)?(A(c),2):null},Ra:function(a,c,d,e,f,g,h,k){2<=d&&(c.g[d]=Math.max(0,Math.min(1,ke(!1,e,f,g,h,k))))},vc:function(a){return a.g[0]||a.g[1]?null:new Da("No ground sensor specified",!0)},Hc:function(a,c){switch(c){case "b":if(c=a.V.ha(),a.g[2]===c[2]&&a.g[3]===c[3])return c=new z(ta("ground"),null,null),c.g=a.g.slice(0,2),c;default:return a}}}}()),new y(function(){var a=[{D:"r",x:-.15,y:.35,A:"0"},{D:"r",x:.15,y:.35,A:"1"}];
return{name:"ground 1",ma:["a"],type:"e",ha:function(){return[0,0,.5]},gb:function(){return[1,-1,.5]},H:function(b,c){Sd(b,{jc:!0});b.buttons(a,c.g,{Hd:-1});G(b,c.g[2],0,!1,"black",1)},$:function(b,c,d,e,f,g,h){b=je(a,d,e,f,g,h);return null!==b?(A(c),c.g[b]=(c.g[b]+2)%3-1,b):I(0,!1,d,e,f,g,h)?(A(c),2):null},Ra:function(a,c,d,e,f,g,h,k){2<=d&&(c.g[d]=Math.max(.25,Math.min(.75,Math.round(4*ke(!1,e,f,g,h,k))/4)))},vc:function(a){return a.g[0]||a.g[1]?null:new Da("No ground sensor specified",!0)},Hc:function(a,
c){switch(c){case "b":if(c=a.V.ha(),a.g[2]===c[2])return c=new z(ta("ground"),null,null),c.g=a.g.slice(0,2),c;default:return a}}}}()),new y({name:"tap",ma:["b","a"],type:"e",H:function(a){a.J.translate(.05*a.w.j,0);Wd(a);Xd(a)},Hc:function(a,b){switch(b){case "a":return new z(ta("accelerometer"),null,null);default:return a}}}),new y(function(){var a=[{D:"c",x:-.33,y:-.3,r:0},{D:"c",x:0,y:-.3,r:0},{D:"c",x:.33,y:-.3,r:0}];return{name:"accelerometer",ma:["c"],type:"e",ha:function(){return[0,0]},H:function(b,
c){var d=c.g[0];c=c.g[1];0===d?(b.J.save(),b.J.translate(.08*b.w.j,-.2*b.w.j),Wd(b),Xd(b),b.J.restore()):ae(b,2===d,2===d?-c:c);b.buttons(a,[0===d,1===d,2===d])},$:function(b,c,d,e,f,g,h){if(0!==c.g[0]&&be(d,f,g,h))return A(c),1;b=je(a,d,e,f,g,h);return null!==b?(A(c),c.g[0]=b,2):null},Ra:function(a,c,d,e,f,g,h,k){1===d&&(a=ce(e,g,h,k),c.g[1]=2===c.g[0]?-a:a)},Hc:function(a,c){switch(c){case "b":if(0===a.g[0])return new z(ta("tap"),null,null);default:return a}}}}()),new y({name:"roll",ma:["a"],type:"e",
ha:function(){return[0]},gb:function(){return[2]},H:function(a,b){ae(a,!1,b.g[0])},$:function(a,b,c,d,e,f,g){return be(c,e,f,g,!0)?(A(b),1):null},Ra:function(a,b,c,d,e,f,g,h){b.g[0]=ce(d,f,g,h,!0)}}),new y({name:"pitch",ma:["a"],type:"e",ha:function(){return[0]},gb:function(){return[2]},H:function(a,b){ae(a,!0,b.g[0])},$:function(a,b,c,d,e,f,g){return be(c,e,f,g,!0)?(A(b),1):null},Ra:function(a,b,c,d,e,f,g,h){b.g[0]=ce(d,f,g,h,!0)}}),new y({name:"yaw",ma:["a"],type:"e",ha:function(){return[0]},gb:function(){return[2]},
H:function(a,b){var c=a.J,d=a.w;b=b.g[0]*Math.PI/12;c.save();c.translate(.5*d.j,.5*d.j);c.rotate(b);$d(a);c.translate(-d.j/2,-d.j/2);Sd(a,{jc:!0,scale:.45});c.restore()},$:function(a,b,c,d,e,f,g){return be(c,e,f,g,!0)?(A(b),1):null},Ra:function(a,b,c,d,e,f,g,h){b.g[0]=ce(d,f,g,h,!0)}}),new y({name:"clap",type:"e",H:function(a){var b=a.J;a=a.w;b.save();b.beginPath();b.arc(.7*a.j,.6*a.j,.15*a.j,0,2*Math.PI);b.fillStyle="white";b.fill();b.beginPath();b.moveTo(.7*a.j,.6*a.j);b.lineTo(.8*a.j,.95*a.j);
b.strokeStyle="white";b.lineWidth=.13*a.j;b.stroke();b.lineWidth=1.5*a.ja;b.translate(.3*a.j,.3*a.j);b.rotate(.1);for(var c=0;9>c;c++)b.beginPath(),b.moveTo(.07*a.j,0),b.lineTo(.14*a.j,0),b.moveTo(.17*a.j,0),b.lineTo(.22*a.j,0),b.stroke(),b.rotate(Math.PI/4.5);b.restore()}}),new y({name:"init",ma:["b","a"],type:"e",H:function(a){var b=a.J;a=a.w;var c=.4*a.j;b.save();b.fillStyle="black";b.strokeStyle="black";b.lineWidth=a.ja;b.beginPath();b.arc(.3*a.j,.5*a.j,.08*a.j,0,2*Math.PI);b.fill();b.beginPath();
b.moveTo(.42*a.j,.5*a.j);b.lineTo(.7*a.j,.5*a.j);b.stroke();c*=.4;b.beginPath();b.moveTo(.8*a.j,.5*a.j);b.lineTo(.8*a.j-c*Math.sqrt(3)/2,.5*a.j+c/2);b.lineTo(.8*a.j-c*Math.sqrt(3)/2,.5*a.j-c/2);b.fill();b.restore()},wg:!0}),new y({name:"timer",ma:["a"],type:"e",H:function(a){ee(a,0,!0,!1)}}),new y(function(){var a=[{D:"t",x:-.25,y:0,r:-Math.PI/2},{D:"t",x:0,y:.25,r:0},{D:"t",x:0,y:-.25,r:Math.PI},{D:"t",x:.25,y:0,r:Math.PI/2},{D:"c",x:0,y:0,r:0}];return{name:"remote control arrows",ma:[],type:"e",
ha:function(){return[0]},H:function(b,c){var d=b.J,e=b.w;d.save();d.fillStyle="#eee";d.fillRect(.1*e.j,e.ja,.8*e.j,e.j-2*e.ja);d.restore();c=c.g[0];b.buttons(a,[0==c,1==c,2==c,3==c,4==c])},$:function(b,c,d,e,f,g,h){b=je(a,d,e,f,g,h);null!==b&&(A(c),c.g[0]=b);return b}}}()),new y({name:"state",ma:["a"],type:"s",ha:function(){return[0,0,0,0]},gb:function(){return[1,0,0,-1]},H:function(a,b){Sd(a);he(a,b.g)},$:function(a,b,c,d,e,f,g){a=oe(c,d,e,f,g);null!==a&&(A(b),b.g[a]=(b.g[a]+2)%3-1);return a},Hc:function(a,
b){return"b"===b&&0===a.g[0]&&0===a.g[1]&&0===a.g[2]&&0===a.g[3]?null:a}}),new y({name:"state 8",ma:["c"],type:"s",ha:function(){return[0]},H:function(a,b){Sd(a);ie(a,b.g[0])},$:function(a,b,c,d,e,f,g){a=pe(c,d,e,f,g);null!==a&&(A(b),b.g[0]=a);return a}}),new y(function(){var a=[{D:"t",x:-.3,y:.3,r:0},{D:"t",x:-.3,y:-.3,r:Math.PI},{D:"t",x:.1,y:.3,r:0},{D:"t",x:.1,y:-.3,r:Math.PI},{D:"c",x:.35,y:-.3,r:0}];return{name:"counter comparison",ma:["a"],type:"s",ha:function(){return[0,0]},H:function(b,c){b.text(0===
c.g[0]?"=":0<c.g[0]?"\u2265":"\u2264",{x:-.3*b.w.j,fillStyle:"black"});b.text(c.g[1].toString(10),{x:.1*b.w.j,fillStyle:"black"});b.buttons(a,[1>c.g[0]?-2:0,-1<c.g[0]?-2:0,255>c.g[1]?-2:0,0<c.g[1]?-2:0,0!==c.g[1]?-2:0])},$:function(b,c,d,e,f,g,h){b=je(a,d,e,f,g,h);if(null!==b)switch(A(c),b){case 0:c.g[0]=Math.min(1,c.g[0]+1);break;case 1:c.g[0]=Math.max(-1,c.g[0]-1);break;case 2:c.g[1]=Math.min(255,c.g[1]+1);break;case 3:c.g[1]=Math.max(0,c.g[1]-1);break;case 4:c.g[1]=0}return b}}}()),new y({name:"color state",
ma:["c"],type:"s",ha:function(){return[0,0,0]},H:function(a,b){Sd(a,{Ub:b.g});G(a,b.g[0],.3,!1,"red");G(a,b.g[1],0,!1,"#0c0");G(a,b.g[2],-.3,!1,"#08f")},$:function(a,b,c,d,e,f,g){return I(.3,!1,c,d,e,f,g)?(A(b),0):I(0,!1,c,d,e,f,g)?(A(b),1):I(-.3,!1,c,d,e,f,g)?(A(b),2):null},Ra:function(a,b,c,d,e,f,g,h){b.g[c]=Math.max(0,Math.min(1,Math.round(ke(!1,d,e,f,g,h))))}}),new y(function(){var a=[{D:"r",x:-.15,y:.3,size:1.4,A:"black",fillStyle:"#666",strokeStyle:"white"},{D:"r",x:-.3,y:0,size:1.4,A:"red",
fillStyle:"red",strokeStyle:"white"},{D:"r",x:0,y:0,size:1.4,A:"green",fillStyle:"#0c0",strokeStyle:"white"},{D:"r",x:.3,y:0,size:1.4,A:"yellow",fillStyle:"yellow",strokeStyle:"silver"},{D:"r",x:-.3,y:-.3,size:1.4,A:"blue",fillStyle:"blue",strokeStyle:"white"},{D:"r",x:0,y:-.3,size:1.4,A:"magenta",fillStyle:"magenta",strokeStyle:"white"},{D:"r",x:.3,y:-.3,size:1.4,A:"cyan",fillStyle:"cyan",strokeStyle:"white"},{D:"r",x:.15,y:.3,size:1.4,A:"white",fillStyle:"white",strokeStyle:"silver"}];return{name:"color 8 state",
ma:["a"],type:"s",ha:function(){return[0]},H:function(b,c){Sd(b,{Ub:[c.g&1,(c.g&2)/2,(c.g&4)/4]});b.buttons(a,[1>c.g[0]?-2:0,-1<c.g[0]?-2:0])},$:function(b,c,d,e,f,g,h){b=je(a,d,e,f,g,h);null!==b&&(A(c),c.g=[b]);return b}}}()),new y({name:"motor state",ma:["c"],type:"s",ha:function(){return[0,0]},H:function(a,b){var c=Ud(a,2.4*b.g[0],2.4*b.g[1],.19);Sd(a,{jc:!0,scale:.45,rotation:c.bb,rf:[.19*c.x*a.w.j+.13*a.w.j*Math.sin(c.bb),.19*c.y*a.w.j+.13*a.w.j*Math.cos(c.bb)]});a.J.save();a.J.globalAlpha=.2;
Ud(a,2.4*b.g[0],2.4*b.g[1],.19);a.J.restore();G(a,.5+.5*b.g[0],-.4,!0,0===b.g[0]?"white":b.g[0]===b.g[1]?"#0c0":b.g[0]===-b.g[1]?"#f70":"#fd0");G(a,.5+.5*b.g[1],.4,!0,0===b.g[1]?"white":b.g[0]===b.g[1]?"#0c0":b.g[0]===-b.g[1]?"#f70":"#fd0")},$:function(a,b,c,d,e,f,g){return I(-.4,!0,c,d,e,f,g)?(A(b),0):I(.4,!0,c,d,e,f,g)?(A(b),1):Vd(a,c,e,f,.5*b.g[0],.5*b.g[1],g)?(A(b),2):null},Ra:function(a,b,c,d,e,f,g,h){2>c?(a=ke(!0,d,e,f,g,h),b.g[c]=.25>a?-1:.75<a?1:0):(a=ke(!0,d,e,f,g,h),a=.25>a?-1:.75<a?1:0,
b.g[0]=a,b.g[1]=a)}}),new y({name:"motor",type:"a",ha:function(){return[0,0]},gb:function(){return[.5,.2]},H:function(a,b){var c=Ud(a,2.4*b.g[0],2.4*b.g[1],.19);Sd(a,{jc:!0,scale:.45,rotation:c.bb,rf:[.19*c.x*a.w.j+.13*a.w.j*Math.sin(c.bb),.19*c.y*a.w.j+.13*a.w.j*Math.cos(c.bb)]});a.J.save();a.J.globalAlpha=.2;Ud(a,2.4*b.g[0],2.4*b.g[1],.19);a.J.restore();G(a,.5+.5*b.g[0],-.4,!0,0===b.g[0]?"white":b.g[0]===b.g[1]?"#0c0":b.g[0]===-b.g[1]?"#f70":"#fd0");G(a,.5+.5*b.g[1],.4,!0,0===b.g[1]?"white":b.g[0]===
b.g[1]?"#0c0":b.g[0]===-b.g[1]?"#f70":"#fd0")},$:function(a,b,c,d,e,f,g){return I(-.4,!0,c,d,e,f,g)?(A(b),0):I(.4,!0,c,d,e,f,g)?(A(b),1):Vd(a,c,e,f,.5*b.g[0],.5*b.g[1],g)?(A(b),2):null},Ra:function(a,b,c,d,e,f,g,h){2>c?(a=2*ke(!0,d,e,f,g,h)-1,d=b.g[1-c],.1>Math.abs(a)?a=0:.1>Math.abs(a-d)?a=d:.1>Math.abs(a+d)&&(a=-d),b.g[c]=Math.max(-1,Math.min(1,a))):(a=2*ke(!0,d,e,f,g,h)-1,a=.1>Math.abs(a)?0:Math.max(-1,Math.min(1,a)),.05>Math.abs(b.g[0]-b.g[1])?(b.g[0]=a,b.g[1]=a):Math.abs(b.g[0])>Math.abs(b.g[1])?
(b.g[1]*=a/b.g[0],b.g[0]=a):(b.g[0]*=a/b.g[1],b.g[1]=a))}}),new y(function(){var a=[{D:"c",x:0,y:0,r:0},{D:"t",x:0,y:.35,r:0},{D:"t",x:0,y:-.35,r:Math.PI},{D:"t",x:-.3,y:.32,r:-.4},{D:"t",x:.3,y:.32,r:.4},{D:"t",x:-.35,y:.05,r:-Math.PI/2},{D:"t",x:.35,y:.05,r:Math.PI/2}];return{name:"move",ma:["c"],type:"a",ha:function(){return[0]},H:function(b,c){Sd(b,{jc:!0,scale:.45});b.buttons(a,[0===c.g[0]?1:-2,1===c.g[0]?1:-2,2===c.g[0]?1:-2,3===c.g[0]?1:-2,4===c.g[0]?1:-2,5===c.g[0]?1:-2,6===c.g[0]?1:-2])},
$:function(b,c,d,e,f,g,h){b=je(a,d,e,f,g,h);null!==b&&(A(c),c.g[0]=b);return b}}}()),new y({name:"nn obstacles",ma:[],type:"a",ha:function(){return[0,0,0,0]},gb:function(){return[.3,.2,.1,.3]},H:function(a,b,c,d){c=d?.5:1;var e=a.J,f=a.w;e.save();d&&e.scale(c,c);e.fillStyle="white";e.font=f.xf;e.textAlign="center";e.textBaseline="middle";e.translate(.5*f.j,.5*f.j);e.translate(-.5*f.j,-.5*f.j);d?(e.fillText("\u21d1",.25*f.j,.35*f.j),e.fillText(b.g[0].toFixed(1),.6*f.j,.35*f.j),e.fillText("\u21a7",
.25*f.j,.81*f.j),e.fillText(b.g[1].toFixed(1),.6*f.j,.81*f.j),e.fillText("+",.25*f.j,1.27*f.j),e.fillText(b.g[2].toFixed(1),.6*f.j,1.27*f.j),e.fillText("\u2212",.25*f.j,1.69*f.j),e.fillText(b.g[3].toFixed(1),.6*f.j,1.69*f.j),e.translate(f.j,0),G(a,b.g[0],.15,!1),G(a,b.g[1],-.3,!1),G(a,b.g[2],-.75,!1),G(a,b.g[3],-1.2,!1)):(e.fillText("\u21d1",.25*f.j,.17*f.j),e.fillText(b.g[0].toFixed(1),.6*f.j,.17*f.j),e.fillText("\u21a7",.25*f.j,.4*f.j),e.fillText(b.g[1].toFixed(1),.6*f.j,.4*f.j),e.fillText("+",
.25*f.j,.63*f.j),e.fillText(b.g[2].toFixed(1),.6*f.j,.63*f.j),e.fillText("\u2212",.25*f.j,.87*f.j),e.fillText(b.g[3].toFixed(1),.6*f.j,.87*f.j));e.restore()},Xd:!0,$:function(a,b,c,d,e,f,g){return I(.35,!1,c/2,d,e+c/2,f,g)?(A(b),0):I(.12,!1,c/2,d,e+c/2,f,g)?(A(b),1):I(-.12,!1,c/2,d,e+c/2,f,g)?(A(b),2):I(-.35,!1,c/2,d,e+c/2,f,g)?(A(b),3):null},Ra:function(a,b,c,d,e,f,g,h){b.g[c]=Math.max(0,Math.min(1,Math.round(20*ke(!1,d/2,e,f+d/2,g,h))/20))}}),new y({name:"top color",ma:["a"],type:"a",ha:function(){return[0,
0,0]},H:function(a,b){Sd(a,{Ub:b.g});G(a,b.g[0],.3,!1,"red");G(a,b.g[1],0,!1,"#0c0");G(a,b.g[2],-.3,!1,"#08f")},$:function(a,b,c,d,e,f,g){return I(.3,!1,c,d,e,f,g)?(A(b),0):I(0,!1,c,d,e,f,g)?(A(b),1):I(-.3,!1,c,d,e,f,g)?(A(b),2):null},Ra:function(a,b,c,d,e,f,g,h){b.g[c]=Math.max(0,Math.min(1,ke(!1,d,e,f,g,h)))}}),new y(function(){var a=[{D:"r",x:-.15,y:.3,size:1.4,A:"black",fillStyle:"#666",strokeStyle:"white"},{D:"r",x:-.3,y:0,size:1.4,A:"red",fillStyle:"red",strokeStyle:"white"},{D:"r",x:0,y:0,
size:1.4,A:"green",fillStyle:"#0c0",strokeStyle:"white"},{D:"r",x:.3,y:0,size:1.4,A:"yellow",fillStyle:"yellow",strokeStyle:"silver"},{D:"r",x:-.3,y:-.3,size:1.4,A:"blue",fillStyle:"blue",strokeStyle:"white"},{D:"r",x:0,y:-.3,size:1.4,A:"magenta",fillStyle:"magenta",strokeStyle:"white"},{D:"r",x:.3,y:-.3,size:1.4,A:"cyan",fillStyle:"cyan",strokeStyle:"white"},{D:"r",x:.15,y:.3,size:1.4,A:"white",fillStyle:"white",strokeStyle:"silver"}];return{name:"top color 8",ma:["b"],type:"a",ha:function(){return[0]},
H:function(b,c){Sd(b,{Ub:[c.g&1,(c.g&2)/2,(c.g&4)/4]});b.buttons(a,[1>c.g[0]?-2:0,-1<c.g[0]?-2:0])},$:function(b,c,d,e,f,g,h){b=je(a,d,e,f,g,h);null!==b&&(A(c),c.g=[b]);return b}}}()),new y({name:"bottom color",ma:["a"],type:"a",ha:function(){return[0,0,0]},H:function(a,b){Sd(a,{jc:!0,Ub:b.g});G(a,b.g[0],.3,!1,"red");G(a,b.g[1],0,!1,"#0c0");G(a,b.g[2],-.3,!1,"#08f")},$:function(a,b,c,d,e,f,g){return I(.3,!1,c,d,e,f,g)?(A(b),0):I(0,!1,c,d,e,f,g)?(A(b),1):I(-.3,!1,c,d,e,f,g)?(A(b),2):null},Ra:function(a,
b,c,d,e,f,g,h){b.g[c]=Math.max(0,Math.min(1,ke(!1,d,e,f,g,h)))}}),new y({name:"bottom-left color",ma:["c"],type:"a",ha:function(){return[0,0,0]},H:function(a,b){Sd(a,{jc:!0,Ub:b.g,Le:"left"});G(a,b.g[0],.3,!1,"red");G(a,b.g[1],0,!1,"#0c0");G(a,b.g[2],-.3,!1,"#08f")},$:function(a,b,c,d,e,f,g){return I(.3,!1,c,d,e,f,g)?(A(b),0):I(0,!1,c,d,e,f,g)?(A(b),1):I(-.3,!1,c,d,e,f,g)?(A(b),2):null},Ra:function(a,b,c,d,e,f,g,h){b.g[c]=Math.max(0,Math.min(1,ke(!1,d,e,f,g,h)))}}),new y({name:"bottom-right color",
ma:["c"],type:"a",ha:function(){return[0,0,0]},H:function(a,b){Sd(a,{jc:!0,Ub:b.g,Le:"right"});G(a,b.g[0],.3,!1,"red");G(a,b.g[1],0,!1,"#0c0");G(a,b.g[2],-.3,!1,"#08f")},$:function(a,b,c,d,e,f,g){return I(.3,!1,c,d,e,f,g)?(A(b),0):I(0,!1,c,d,e,f,g)?(A(b),1):I(-.3,!1,c,d,e,f,g)?(A(b),2):null},Ra:function(a,b,c,d,e,f,g,h){b.g[c]=Math.max(0,Math.min(1,ke(!1,d,e,f,g,h)))}}),new y(function(){var a=[{D:"r",x:-.15,y:.3,size:1.4,A:"black",fillStyle:"#666",strokeStyle:"white"},{D:"r",x:-.3,y:0,size:1.4,A:"red",
fillStyle:"red",strokeStyle:"white"},{D:"r",x:0,y:0,size:1.4,A:"green",fillStyle:"#0c0",strokeStyle:"white"},{D:"r",x:.3,y:0,size:1.4,A:"yellow",fillStyle:"yellow",strokeStyle:"silver"},{D:"r",x:-.3,y:-.3,size:1.4,A:"blue",fillStyle:"blue",strokeStyle:"white"},{D:"r",x:0,y:-.3,size:1.4,A:"magenta",fillStyle:"magenta",strokeStyle:"white"},{D:"r",x:.3,y:-.3,size:1.4,A:"cyan",fillStyle:"cyan",strokeStyle:"white"},{D:"r",x:.15,y:.3,size:1.4,A:"white",fillStyle:"white",strokeStyle:"silver"}];return{name:"bottom color 8",
ma:["b"],type:"a",ha:function(){return[0]},H:function(b,c){Sd(b,{jc:!0,Ub:[c.g&1,(c.g&2)/2,(c.g&4)/4]});b.buttons(a,[1>c.g[0]?-2:0,-1<c.g[0]?-2:0])},$:function(b,c,d,e,f,g,h){b=je(a,d,e,f,g,h);null!==b&&(A(c),c.g=[b]);return b}}}()),new y(function(){var a=[{D:"r",x:-.15,y:.3,size:1.4,A:"black",fillStyle:"#666",strokeStyle:"white"},{D:"r",x:-.3,y:0,size:1.4,A:"red",fillStyle:"red",strokeStyle:"white"},{D:"r",x:0,y:0,size:1.4,A:"green",fillStyle:"#0c0",strokeStyle:"white"},{D:"r",x:.3,y:0,size:1.4,
A:"yellow",fillStyle:"yellow",strokeStyle:"silver"},{D:"r",x:-.3,y:-.3,size:1.4,A:"blue",fillStyle:"blue",strokeStyle:"white"},{D:"r",x:0,y:-.3,size:1.4,A:"magenta",fillStyle:"magenta",strokeStyle:"white"},{D:"r",x:.3,y:-.3,size:1.4,A:"cyan",fillStyle:"cyan",strokeStyle:"white"},{D:"r",x:.15,y:.3,size:1.4,A:"white",fillStyle:"white",strokeStyle:"silver"}];return{name:"bottom-left color 8",ma:["c"],type:"a",ha:function(){return[0]},H:function(b,c){Sd(b,{jc:!0,Ub:[c.g&1,(c.g&2)/2,(c.g&4)/4],Le:"left"});
b.buttons(a,[1>c.g[0]?-2:0,-1<c.g[0]?-2:0])},$:function(b,c,d,e,f,g,h){b=je(a,d,e,f,g,h);null!==b&&(A(c),c.g=[b]);return b}}}()),new y(function(){var a=[{D:"r",x:-.15,y:.3,size:1.4,A:"black",fillStyle:"#666",strokeStyle:"white"},{D:"r",x:-.3,y:0,size:1.4,A:"red",fillStyle:"red",strokeStyle:"white"},{D:"r",x:0,y:0,size:1.4,A:"green",fillStyle:"#0c0",strokeStyle:"white"},{D:"r",x:.3,y:0,size:1.4,A:"yellow",fillStyle:"yellow",strokeStyle:"silver"},{D:"r",x:-.3,y:-.3,size:1.4,A:"blue",fillStyle:"blue",
strokeStyle:"white"},{D:"r",x:0,y:-.3,size:1.4,A:"magenta",fillStyle:"magenta",strokeStyle:"white"},{D:"r",x:.3,y:-.3,size:1.4,A:"cyan",fillStyle:"cyan",strokeStyle:"white"},{D:"r",x:.15,y:.3,size:1.4,A:"white",fillStyle:"white",strokeStyle:"silver"}];return{name:"bottom-right color 8",ma:["c"],type:"a",ha:function(){return[0]},H:function(b,c){Sd(b,{jc:!0,Ub:[c.g&1,(c.g&2)/2,(c.g&4)/4],Le:"right"});b.buttons(a,[1>c.g[0]?-2:0,-1<c.g[0]?-2:0])},$:function(b,c,d,e,f,g,h){b=je(a,d,e,f,g,h);null!==b&&
(A(c),c.g=[b]);return b}}}()),new y({name:"notes",type:"a",ha:function(){return[0,1,1,1,2,1,0,1,2,1,4,2]},H:function(a,b){b=b.g;var c=a.J,d=a.w;c.save();c.fillStyle="#eee";for(var e=0;5>e;e++)c.fillRect(.1*d.j,d.j*(.1+.16*e),.8*d.j,.16*d.j-d.ja);Yd(a,b,.1,.9,.9,.1,5,.14,1);c.restore()},$:function(a,b,c,d,e,f,g){return(a=le(.1,.9,.9,.1,6,5,c,d,e,f,g))?(A(b),b.g[2*a.index]===a.tone?b.g[2*a.index+1]=(b.g[2*a.index+1]+1)%3:(b.g[2*a.index]=a.tone,b.g[2*a.index+1]=1),0):null}}),new y(function(){var a=[{D:"t",
x:-.3,y:.3,r:0},{D:"t",x:-.3,y:-.3,r:Math.PI}];return{name:"play",ma:["c"],type:"a",ha:function(){return[0]},H:function(b,c){Zd(b,c.g[0]);b.buttons(a,[-2,-2])},$:function(b,c,d,e,f,g,h){b=je(a,d,e,f,g,h);if(null!==b)switch(A(c),b){case 0:c.g[0]=(c.g[0]+1)%100;break;case 1:c.g[0]=(c.g[0]+99)%100}return b}}}()),new y({name:"play stop",ma:["c"],type:"a",H:function(a){Zd(a,null)}}),new y({name:"set state",ma:["a"],type:"a",ha:function(){return[0,0,0,0]},gb:function(){return[0,1,-1,0]},H:function(a,b){Sd(a);
he(a,b.g)},$:function(a,b,c,d,e,f,g){a=oe(c,d,e,f,g);null!==a&&(A(b),b.g[a]=(b.g[a]+2)%3-1);return a}}),new y({name:"toggle state",ma:["c"],type:"a",ha:function(){return[!1,!1,!1,!1]},gb:function(){return[!0,!1,!1,!1]},H:function(a,b){Sd(a);he(a,b.g.map(function(a){return a?2:0}));wc(a.J,a.w.j/2,a.w.j/2,.2*a.w.j,-1.4,1.4,{style:"black",lineWidth:a.w.ja,Wc:5*a.w.ja});wc(a.J,a.w.j/2,a.w.j/2,.2*a.w.j,Math.PI-1.4,Math.PI+1.4,{style:"black",lineWidth:a.w.ja,Wc:5*a.w.ja})},$:function(a,b,c,d,e,f,g){a=oe(c,
d,e,f,g);null!==a&&(A(b),b.g[a]=!b.g[a]);return a}}),new y({name:"set state 8",ma:["c"],type:"a",ha:function(){return[0]},H:function(a,b){Sd(a);ie(a,b.g[0])},$:function(a,b,c,d,e,f,g){a=pe(c,d,e,f,g);null!==a&&(A(b),b.g[0]=a);return a}}),new y(function(){var a=[{D:"c",x:-.2,y:0},{D:"c",x:.2,y:0}];return{name:"change state 8",ma:["c"],type:"a",ha:function(){return[1]},H:function(b,c){Sd(b);var d=b.J;d.save();for(var e=0;8>e;e++)ge(b,Math.PI*(.46-.25*e),Math.PI*(.54-.25*e),0);d.restore();wc(b.J,b.w.j/
2,b.w.j/2,.375*b.w.j,-.8,.8,{style:"black",lineWidth:b.w.ja,Wc:5*b.w.ja});wc(b.J,b.w.j/2,b.w.j/2,.375*b.w.j,Math.PI-.8,Math.PI+.8,{Ed:!0,style:"black",lineWidth:b.w.ja,Wc:5*b.w.ja});b.buttons(a,[0>c.g[0],0<c.g[0]])},$:function(b,c,d,e,f,g,h){b=je(a,d,e,f,g,h);null!==b&&(A(c),c.g[0]=0===b?-1:1);return b}}}()),new y(function(){var a=[{D:"t",x:0,y:.3,r:0},{D:"t",x:0,y:-.3,r:Math.PI}];return{name:"set counter",ma:["a"],type:"a",ha:function(){return[0]},H:function(b,c){b.text(0===c.g[0]?"= 0":0<c.g[0]?
"+1":"\u22121");b.buttons(a,[1>c.g[0]?-2:0,-1<c.g[0]?-2:0])},$:function(b,c,d,e,f,g,h){b=je(a,d,e,f,g,h);if(null!==b)switch(A(c),b){case 0:c.g[0]=Math.min(1,c.g[0]+1);break;case 1:c.g[0]=Math.max(-1,c.g[0]-1)}return b}}}()),new y({name:"set timer",ma:["a"],type:"a",ha:function(){return[1]},H:function(a,b){ee(a,b.g[0],!1,!1)},$:function(a,b,c,d,e,f,g){return me(c,d,e,f,g)?(A(b),1):null},Ra:function(a,b,c,d,e,f,g,h){b.g[0]=ne(d,e,f,g,!1,h)}}),new y({name:"set timer log",ma:["c"],type:"a",ha:function(){return[1]},
H:function(a,b){ee(a,b.g[0],!1,!0)},$:function(a,b,c,d,e,f,g){return me(c,d,e,f,g)?(A(b),1):null},Ra:function(a,b,c,d,e,f,g,h){b.g[0]=ne(d,e,f,g,!0,h)}}),new y(function(){function a(a,b){if(a.g[1]){var c=new Image;c.src=a.g[1];c.addEventListener("load",function(){a.g[2]=c;b&&b()},!1)}}var b=[{D:"c",x:-.33,y:-.3,r:0}];return{name:"picture comment",ma:["a"],type:"c",ha:function(){return[!1,"",null]},cf:function(a){return 2<=a.g.length?[!1,a.g[1]]:[!1,""]},he:function(b,d,e){b.g=2<=d.length?[!1,d[1]]:
[!1,""];a(b,e)},H:function(a,d){d.g[2]&&a.J.drawImage(d.g[2],0,0,240,240,0,0,a.w.j,a.w.j);a.buttons(b,[d.g[0]])},$:function(c,d,e,f,g,h,k){e=je(b,e,f,g,h,k);0===e&&(d.g[0]?aa&&(aa.pause&&aa.pause(),ba.getTracks().forEach(function(a){a.stop()}),aa=null):(A(d),navigator.mediaDevices.getUserMedia({audio:!1,video:{width:320,height:240}}).then(function(b){ba=b;aa=document.createElement("video");aa.srcObject=b;aa.addEventListener("loadedmetadata",function(){aa.play();var b=setInterval(function(){aa?(ca||
(ca=document.createElement("canvas"),ca.width=240,ca.height=240),ca.getContext("2d").drawImage(aa,0,0,240,240,0,0,240,240),d.g[1]=ca.toDataURL("image/png"),a(d,function(){c.qa&&c.qa();B(c)})):clearInterval(b)},100)},!1)})),d.g[0]=!d.g[0]);return e}}}())];function qe(a,b){function c(a){return a instanceof Array?a.join(""):a}function d(a,b){return a.map(function(a){return oa(a,b)})}var e=b||{};["aseba","l2","js","python"].forEach(function(b){a[b]&&(e[b]=function(e){var f=e?e.g:[];e={};a[b].initVarDecl&&(e.Sb=d(a[b].initVarDecl.map(c),f));a[b].initCodeDecl&&(e.Rb=d(a[b].initCodeDecl.map(c),f));a[b].initCodeExec&&(e.cc=d(a[b].initCodeExec.map(c),f));a[b].sectionBegin&&(e.P=oa(c(a[b].sectionBegin),f));a[b].sectionEnd&&(e.ib=oa(c(a[b].sectionEnd),f));a[b].sectionPreamble&&
(e.Wa=oa(c(a[b].sectionPreamble),f));a[b].clauseInit&&(e.aa=oa(c(a[b].clauseInit),f));if(a[b].clauseAnd){var g="";f.forEach(function(d,e){(d=oa(c(a[b].clauseAnd),f,e))&&(g+=(0<g.length?" "+qa[b].m+" ":"")+d)});e.Va=g||qa[b].o}else a[b].clause&&(e.Va=oa(c(a[b].clause),f));a[b].clauseAsCondition&&(e.lg=oa(c(a[b].clauseAsCondition),f));e.ph=a[b].clauseOptional||!1;a[b].statement1?e.ka=f.map(function(d,e){return oa(c(a[b].statement1),f,e)}).join(""):a[b].statement&&(e.ka=oa(c(a[b].statement),f));a[b].error&&
(e.Va=oa(c(a.error.error),f));return e})});return e};function re(a){this.R=new DOMParser;this.b=this.R.parseFromString(a,"text/xml");this.h=this.b.documentElement;this.Ca=(this.h.getAttribute("viewBox")||"0 0 1 1").split(" ").map(function(a){return parseFloat(a)});this.v={}}
var se={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgreen:"#006400",
darkgrey:"#A9A9A9",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",
ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",green:"#008000",greenyellow:"#ADFF2F",grey:"#808080",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgreen:"#90EE90",lightgrey:"#D3D3D3",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",
lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",
moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",
seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"};function te(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}function ue(a){var b={};te(b,a);return b}
function ve(a,b){b.split(";").forEach(function(b){b=b.trim().split(":").map(function(a){return a.trim()});2===b.length&&(a[b[0]]=b[1])})}
function we(a,b,c,d,e){a&&(a=a.replace(/\s*\(\s*/g,"(").replace(/\s*\)\s*/g,")").replace(/ +,/g,",").replace(/, +/g,",").replace(/ +/g,","),a.split(")").slice(0,-1).forEach(function(a){var f=a.split("(")[0];a=a.split("(")[1].split(",").map(function(a){return parseFloat(a)});switch(f){case "translate":b(a[0]||0,a[1]||0);break;case "rotate":f=(a[0]||0)*Math.PI/180;var h=a[1]||0;a=a[2]||0;0!==h||0!==a?(b(-h,-a),c(f),b(h,a)):c(f);break;case "scale":f=a[0]||1;d(f,a[1]||f);break;case "matrix":e(a[0],a[1],
a[2],a[3],a[4],a[5]);break;default:throw"transform not implemented: "+f;}}))}function xe(a,b){we(a,function(a,d){b.translate(a,d)},function(a){b.rotate(a)},function(a,d){b.scale(a,d)},function(a,d,e,f,g,h){b.He(a,d,e,f,g,h)})}
re.prototype.H=function(a,b){function c(e,m,u){function p(){for(var a=0;a<e.childElementCount;a++)c(e.children[a],m,u)}function v(a,b){a=e.getAttribute(a);return null===a?b||0:parseFloat(a)}function r(a,b){a=n.apply(new ye(a,b));t.push(a.x);l.push(a.y)}function x(a,b,c){if(null==a||""==a)return b;a=/^\s*(-?[0-9.]+)\s*([a-z%]*)\s*$/i.exec(a);b=parseFloat(a[1]);switch(a[2]||"px"){case "pt":return 25.4*b/72*3;case "pc":return 25.4*b/6*3;case "in":return 25.4*b*3;case "mm":return 3*b;case "cm":return 30*
b;case "em":return 18*b;case "ex":return 9*b;case "%":return b*c/100;default:return b}}function K(c){c=c.replace(/\.([0-9]+)(?=\.)/g,".$1 ").replace(/([.0-9])-/g,"$1 -").replace(/\s*([a-z])\s*/gi,";$1").replace(/\s*,\s*/g,",").replace(/\s+/g,",");var e=0,f=0,g=0,h=0,k=0,m=0,n=[],u=[],v=!0;a&&a.beginPath();c.slice(1).split(";").forEach(function(c){var p=c[0];c=1<c.length?c.slice(1).split(",").map(function(a){return parseFloat(a)}):[];switch(p){case "M":if(2<=c.length){e=c[0];f=c[1];k=e;m=f;a&&a.moveTo(e,
f);r(e,f);v&&1<n.length&&b&&b.xa&&b.xa.line&&b.xa.line(n,u,!1);v=!0;n=t.slice(-1);u=l.slice(-1);for(p=2;p+1<c.length;p+=2)e=c[p],f=c[p+1],a&&a.lineTo(e,f),r(e,f),n.push(t[t.length-1]),u.push(l[l.length-1]);g=e;h=f}break;case "m":if(2<=c.length)for(e+=c[0],f+=c[1],k=e,m=f,a&&a.moveTo(e,f),r(e,f),v&&1<n.length&&b&&b.xa&&b.xa.line&&b.xa.line(n,u,!1),v=!0,n=t.slice(-1),u=l.slice(-1),p=2;p+1<c.length;p+=2)e+=c[p],f+=c[p+1],a&&a.lineTo(e,f),r(e,f),n.push(t[t.length-1]),u.push(l[l.length-1]);g=e;h=f;break;
case "L":for(p=0;p+1<c.length;p+=2)e=c[p],f=c[p+1],a&&a.lineTo(e,f),r(e,f),n.push(t[t.length-1]),u.push(l[l.length-1]);g=e;h=f;break;case "l":for(p=0;p+1<c.length;p+=2)e+=c[p],f+=c[p+1],a&&a.lineTo(e,f),r(e,f),n.push(t[t.length-1]),u.push(l[l.length-1]);g=e;h=f;break;case "H":for(p=0;p<c.length;p++)e=c[p],a&&a.lineTo(e,f),r(e,f),n.push(t[t.length-1]),u.push(l[l.length-1]);g=e;h=f;break;case "h":for(p=0;p<c.length;p++)e+=c[p],a&&a.lineTo(e,f),r(e,f),n.push(t[t.length-1]),u.push(l[l.length-1]);g=e;
h=f;break;case "V":for(p=0;p<c.length;p++)f=c[p],a&&a.lineTo(e,f),r(e,f),n.push(t[t.length-1]),u.push(l[l.length-1]);g=e;h=f;break;case "v":for(p=0;p<c.length;p++)f+=c[p],a&&a.lineTo(e,f),r(e,f),n.push(t[t.length-1]),u.push(l[l.length-1]);g=e;h=f;break;case "A":for(p=0;p+6<c.length;p+=7){var ua=c[p+5],q=c[p+6],T=d(c[p],c[p+1],c[p+2]*Math.PI/180,0!=c[p+3],0==c[p+4],e,f,ua,q);e=ua;f=q;r(T.x,T.y);r(e,f);v=!1}g=e;h=f;break;case "a":for(p=0;p+6<c.length;p+=7)ua=e+c[p+5],q=f+c[p+6],T=d(c[p],c[p+1],c[p+
2]*Math.PI/180,0!=c[p+3],0==c[p+4],e,f,ua,q),e=ua,f=q,r(T.x,T.y),r(e,f),v=!1;g=e;h=f;break;case "C":for(p=0;p+5<c.length;p+=6)a&&a.bezierCurveTo(c[p],c[p+1],c[p+2],c[p+3],c[p+4],c[p+5]),e=c[p+4],f=c[p+5],g=2*e-c[p+2],h=2*f-c[p+3],r(e,f),v=!1;break;case "c":for(p=0;p+5<c.length;p+=6)a&&a.bezierCurveTo(e+c[p],f+c[p+1],e+c[p+2],f+c[p+3],e+c[p+4],f+c[p+5]),g=e+2*c[p+4]-c[p+2],h=f+2*c[p+5]-c[p+3],e+=c[p+4],f+=c[p+5],r(e,f),v=!1;break;case "S":for(p=0;p+3<c.length;p+=4)a&&a.bezierCurveTo(g,h,c[p],c[p+1],
c[p+2],c[p+3]),e=c[p+2],f=c[p+3],g=2*e-c[p],h=2*f-c[p+1],r(e,f),v=!1;break;case "s":for(p=0;p+3<c.length;p+=4)a&&a.bezierCurveTo(g,h,e+c[p],f+c[p+1],e+c[p+2],f+c[p+3]),g=e-c[p],h=f-c[p+1],e+=c[p+2],f+=c[p+3],r(e,f),v=!1;break;case "Q":for(p=0;p+3<c.length;p+=4)a&&a.quadraticCurveTo(c[p],c[p+1],c[p+2],c[p+3]),e=c[p+2],f=c[p+3],g=2*e-c[p],h=2*f-c[p+1],r(e,f),v=!1;break;case "q":for(p=0;p+3<c.length;p+=4)a&&a.quadraticCurveTo(e+c[p],f+c[p+1],e+c[p+2],f+c[p+3]),g=e+2*c[p+2]-c[p],h=f+2*c[p+3]-c[p+1],e+=
c[p+2],f+=c[p+3],r(e,f),v=!1;break;case "T":for(p=0;p+1<c.length;p+=2)a&&a.quadraticCurveTo(g,h,c[p],c[p+1]),e=c[p],f=c[p+1],g=2*e-g,h=2*f-h,r(e,f),v=!1;break;case "t":for(p=0;p+1<c.length;p+=2)a&&a.quadraticCurveTo(g,h,e+c[p],f+c[p+1]),e+=c[p],f+=c[p+1],g=2*e-g,h=2*f-h,r(e,f),v=!1;break;case "Z":case "z":e=k;f=m;a&&a.closePath();v&&1<n.length&&b&&b.xa&&b.xa.line&&b.xa.line(n,u,!0);v=!0;n=[];u=[];break;default:throw"unimplemented path command: "+p;}});v&&1<n.length&&b&&b.xa&&b.xa.line&&b.xa.line(n,
u,!1)}function N(b){function c(a,b){if(0<b.length){a.splice(0,a.length);for(var c=0;c<b.length&&1>c;c++){var d=(b[c].getAttribute("offset")||"0").trim(),e=/%$/.test(d)?parseFloat(d.slice(0,-1))/100:parseFloat(d),f=b[c].getAttribute("style");d={};f&&ve(d,f);isNaN(e)||(f=b[c].getAttribute("stop-color")||d["stop-color"]||"#000",se.hasOwnProperty(f)&&(f=se[f]),d=(b[c].getAttribute("stop-opacity")||d["stop-opacity"]||"1").trim(),d=/%$/.test(d)?parseFloat(d.slice(0,-1))/100:parseFloat(d),1!==d&&(/^#[0-9a-f]{3}$/i.test(f)?
f="rgba("+f.slice(1).split("").map(function(a){return 17*parseInt(a,16)}).map(function(a){return a.toString(10)}).join(",")+","+d.toFixed(2)+")":/^#[0-9a-f]{6}$/i.test(f)?f="rgba("+[f.slice(1,3),f.slice(3,5),f.slice(5)].map(function(a){return parseInt(a,16)}).map(function(a){return a.toString(10)}).join(",")+","+d.toFixed(2)+")":/^rgb(\d+%?(,|\s+)\d+%?(,|\s+)\d+%?)$/i.test(f)?f=f.slice(0,-1).replace(/\s+/g,",")+","+d.toFixed(2)+")":/^hsl(\d+%?(,|\s+)\d+%?(,|\s+)\d+%?)$/i.test(f)&&(f=f.slice(0,-1).replace(/\s+/g,
",")+","+d.toFixed(2)+")")),a.push({offset:e,color:f}))}}}function d(a,b){if(a.attributes["xlink:href"]){var e=a.getAttribute("xlink:href");"#"===e[0]&&(e=k.b.getElementById(e.slice(1)))&&(b=d(e,b))}b.jd=a.attributes.x1?parseFloat(a.getAttribute("x1")):b.jd||0;b.ld=a.attributes.y1?parseFloat(a.getAttribute("y1")):b.ld||0;b.kd=a.attributes.x2?parseFloat(a.getAttribute("x2")):b.kd||0;b.md=a.attributes.y2?parseFloat(a.getAttribute("y2")):b.md||0;b.Ac=a.attributes.gradientUnits?a.getAttribute("gradientUnits"):
b.Ac||"objectBoundingBox";b.Qb=a.attributes.gradientTransform?a.getAttribute("gradientTransform"):b.Qb||"";b.jb=b.jb||[];c(b.jb,a.getElementsByTagName("stop"));return b}function e(a,b){if(a.attributes["xlink:href"]){var d=a.getAttribute("xlink:href");"#"===d[0]&&(d=k.b.getElementById(d.slice(1)))&&(b=e(d,b))}b.xc=a.attributes.cx?parseFloat(a.getAttribute("cx")):b.xc||0;b.yc=a.attributes.cy?parseFloat(a.getAttribute("cy")):b.yc||0;b.r=a.attributes.r?parseFloat(a.getAttribute("r")):b.r||0;b.Ac=a.attributes.gradientUnits?
a.getAttribute("gradientUnits"):b.Ac||"objectBoundingBox";b.Qb=a.attributes.gradientTransform?a.getAttribute("gradientTransform"):b.Qb||"";b.jb=b.jb||[];c(b.jb,a.getElementsByTagName("stop"));return b}var f=/^url\(#(.+)\)$/.exec(b);if(f&&f[1]&&(f=k.b.getElementById(f[1])))switch(f.tagName){case "linearGradient":b=d(f,{});if("objectBoundingBox"===b.Ac)throw"objectBoundingBox not supported";if(b.Qb)throw f=new ze,xe(b.Qb,f),"gradientTransform not supported";var g=a.createLinearGradient(b.jd,b.ld,b.kd,
b.md);for(f=0;f<b.jb.length;f++)g.addColorStop(b.jb[f].offset,b.jb[f].color);return g;case "radialGradient":b=e(f,{});if("objectBoundingBox"===b.Ac)throw"objectBoundingBox not supported";b.Qb&&(f=new ze,xe(b.Qb,f),g=Ae(f,{x:b.xc,y:b.yc}),f=b.r/Math.sqrt(Math.abs(f.b[0]*f.b[4])),b.xc=g.x,b.yc=g.y,b.r=f);g=a.createRadialGradient(b.xc,b.yc,0,b.xc,b.yc,b.r);for(f=0;f<b.jb.length;f++)g.addColorStop(b.jb[f].offset,b.jb[f].color);return g}return b}function J(b,c,d,e,f,g){0>=f||0>=g?a.rect(b,c,d,e):(f=Math.min((f+
g)/2,Math.min(d,e)/2),a.moveTo(b+d-f,c),a.arc(b+d-f,c+f,f,1.5*Math.PI,2*Math.PI),a.lineTo(b+d,c+e-f),a.arc(b+d-f,c+e-f,f,0,.5*Math.PI),a.lineTo(b+f,c+e),a.arc(b+f,c+e-f,f,.5*Math.PI,Math.PI),a.lineTo(b,c+f),a.arc(b+f,c+f,f,Math.PI,1.5*Math.PI),a.closePath())}function O(){if(a){var b=(m||"")+";"+(u||""),c={};b&&ve(c,b);"hidden"!==c.visibility&&(c.opacity&&(a.globalAlpha*=parseFloat(c.opacity)),c.fill&&"none"===c.fill||(a.fillStyle="white"===c.fill||"#fff"===c.fill||"#ffffff"===c.fill?"white":N(c.fill)||
"none",a.fill()),c.stroke&&"none"!==c.stroke&&(a.lineWidth=x(c["stroke-width"]||"1px",1,100),a.strokeStyle=c.stroke||"none",a.miterLimit=c["stroke-miterlimit"]||4,a.lineJoin=c["stroke-linejoin"]||"miter",a.lineCap=c["stroke-linecap"]||"butt",c["stroke-dasharray"]&&(a.setLineDash(c["stroke-dasharray"].split(" ").map(function(a){return parseFloat(a)})),a.lineDashOffset=c["stroke-dashoffset"]?parseFloat(c["stroke-dashoffset"]):0),a.stroke()))}}function pa(c,d,e){if(a){var f=(m||"")+";"+(u||""),g={};
f&&ve(g,f);"hidden"!==g.visibility&&(a.font=(g["font-size"]||"12px")+" "+(g["font-family"]||"helvetica"),g.fill&&"none"!==g.fill&&(a.fillStyle="white"===g.fill||"#fff"===g.fill||"#ffffff"===g.fill?"white":b&&b.fill||"silver",a.fillText(c,d,e)),g.stroke&&"none"!==g.stroke&&(a.strokeStyle=b&&b.stroke||"black",a.strokeText(c,d,e)))}}function Gb(b,c){b=Be({x:b,y:c});a.save();a.strokeStyle="black";a.lineWidth=1;a.strokeRect(b.X,b.Y,b.oa-b.X,b.la-b.Y);a.restore()}var E=e.getAttribute("id"),la=E&&b&&b.rd&&
b.rd[E];E=E&&b&&b.We&&b.We[E];a&&a.save();n.save();la&&a&&f(e,la);E&&a&&g(e,E);(function(){var a=(b&&b.og||"")+";"+(e.getAttribute("style")||""),c=e.getAttribute("class");c&&q.hasOwnProperty(c)&&(a=q[c]+";"+a);m=(m||"")+";"+a;(a=e.getAttribute("fill"))&&(m+=";fill:"+a);(a=e.getAttribute("stroke"))&&(m+=";stroke:"+a);(a=e.getAttribute("stroke-width"))&&(m+="stroke-width:"+a);(a=e.getAttribute("stroke-dasharray"))&&(m+=";stroke-dasharray:"+a.split(",").join(" "));(a=e.getAttribute("stroke-dashoffset"))&&
(m+=";stroke-dashoffset:"+a);if(b&&b.style)if((a=e.getAttribute("id"))&&b.style.hasOwnProperty(a))u=(u||"")+";"+b.style[a];else for(var d in b.style)b.style.hasOwnProperty(d)&&"!"===d[0]&&d.slice(1)!==a&&(u=(u||"")+";"+b.style[d])})();la=t.length;switch(e.tagName){case "svg":n.save();h(e.getAttribute("transform"));p();n.restore();break;case "g":n.save();h(e.getAttribute("transform"));p();n.restore();break;case "path":a&&a.save();n.save();h(e.getAttribute("transform"));K(e.getAttribute("d")||"");O();
a&&a.restore();n.restore();break;case "line":E=v("x1");var L=v("y1"),H=v("x2"),Ia=v("y2");a&&a.save();n.save();h(e.getAttribute("transform"));a&&a.beginPath();a&&a.moveTo(E,L);a&&a.lineTo(H,Ia);O();r(E,L);r(H,Ia);b&&b.xa&&b.xa.line&&b.xa.line([E,H],[L,Ia],!1);a&&a.restore();n.restore();break;case "polygon":case "polyline":E=e.getAttribute("points").trim().replace(/\s+/g," ").split(" ").map(function(a){return parseFloat(a)});if(4<=E.length){a&&a.save();n.save();h(e.getAttribute("transform"));a&&a.beginPath();
a&&a.moveTo(E[0],E[1]);r(E[0],E[1]);for(L=2;L+1<E.length;L+=2)a&&a.lineTo(E[L],E[L+1]),r(E[L],E[L+1]);"polygon"===e.tagName&&a.closePath();O();b&&b.xa&&b.xa.line&&b.xa.line(t.slice(-E.length/2),l.slice(-E.length/2),"polygon"===e.tagName);a&&a.restore();n.restore()}break;case "circle":E=v("cx");L=v("cy");H=v("r");a&&a.save();n.save();h(e.getAttribute("transform"));a&&a.beginPath();a&&a.arc(E,L,H,0,2*Math.PI);O();r(E-H,L-H);r(E-H,L+H);r(E+H,L-H);r(E+H,L+H);b&&b.xa&&b.xa.Ve&&(E=t.slice(-4),L=l.slice(-4),
H=(E[3]-E[0])*(E[3]-E[0])+(L[3]-L[0])*(L[3]-L[0]),Ia=(E[2]-E[1])*(E[2]-E[1])+(L[2]-L[1])*(L[2]-L[1]),.001>Math.abs(H-Ia)/(H+Ia)&&.001>((E[3]-E[0])*(E[2]-E[1])+(L[3]-L[0])*(L[2]-L[1]))/H&&b.xa.Ve((E[0]+E[2])/2,(L[0]+L[2])/2,Math.sqrt(H/8)));a&&a.restore();n.restore();break;case "rect":E=v("x");L=v("y");H=v("width");Ia=v("height");var ua=v("rx"),wa=v("ry",ua);ua=v("rx",wa);a&&a.save();n.save();h(e.getAttribute("transform"));a&&(a.beginPath(),0<ua||0<wa?J(E,L,H,Ia,ua,wa):a.rect(E,L,H,Ia));O();r(E,L);
r(E,L+Ia);r(E+H,L);r(E+H,L+Ia);a&&a.restore();n.restore();break;case "text":E=v("x"),L=v("y"),a&&a.save(),n.save(),h(e.getAttribute("transform")),pa(e.textContent,E,L),r(E,L),a&&a.restore(),n.restore()}a&&a.restore();n.restore();a&&b&&b.ng&&Gb(t.slice(la),l.slice(la))}function d(b,c,d,e,f,g,h,k,l){if(0===b||0===c)return a&&a.lineTo(k,l),new ye(k,l);var n=Math.cos(d),m=Math.sin(d),p=(n*g+m*h)/b;h=(-m*g+n*h)/c;g=(n*k+m*l)/b;k=(-m*k+n*l)/c;l=(g-p)/2;n=(k-h)/2;m=l*l+n*n;m=Math.sqrt((1-m)/m);isNaN(m)?
m=0:e===f&&(m=-m);e=(p+g)/2+m*n;l=(h+k)/2-m*l;p=Math.atan2((h-l)/b,(p-e)/c);h=Math.atan2((k-l)/b,(g-e)/c);a&&(a.rotate(d),a.scale(b,c),f?a.arc(e,l,1,p,h,!0):a.arc(e,l,1,p,h),a.scale(1/b,1/c),a.rotate(-d));g=new ze;g.rotate(d);g.scale(b,c);b=f?p<h?(p+h)/2+Math.PI:(p+h)/2:p<h?(p+h)/2:(p+h)/2+Math.PI;return g.apply(new ye(e+Math.cos(b),l+Math.sin(b)))}function e(a){switch(a.tagName){case "svg":case "defs":for(var b=0;b<a.childElementCount;b++)e(a.children[b]);break;case "style":m+=a.textContent}}function f(b,
c){if(c.bb&&0!=c.bb){var d=c.Ud,e=c.Vd;if(void 0==d||void 0==e)d=k.H(null,{element:b}),b=Be(d),d=(b.X+b.oa)/2,e=(b.Y+b.la)/2;a.translate(d+(c.Hb||0),e+(c.Ib||0));a.rotate(c.bb);a.translate(-d,-e)}else(c.Hb||c.Ib)&&a.translate(c.Hb,c.Ib)}function g(b,c){a.beginPath();a.rect(c.x,c.y,c.Uc,c.Kc);a.clip()}function h(b){we(b,function(b,c){a&&a.translate(b,c);n.translate(b,c)},function(b){a&&a.rotate(b);n.rotate(b)},function(b,c){a&&a.scale(b,c);n.scale(b,c)},function(b,c,d,e,f,g){a&&a.transform(b,c,d,e,
f,g);n.He(b,c,d,e,f,g)})}var k=this,m="",q={},n=new Ce,t=[],l=[];e(this.h);(function(){m.split("}").forEach(function(a){var b=a.split("{");b[0].split(",").forEach(function(a){a=a.trim();/^\.[-a-z0-9]+/i.test(a)&&(a=a.slice(1),q[a]=q[a]?q[a]+";"+b[1]:b[1])})})})();var u=this.h;b&&b.Id?u=this.b.getElementById(b.Id):b&&b.element&&(u=b.element);if(u){b&&b.ff&&b.ff(a,this.Ca);if(a){for(var p=[],v=u.parentElement;null!=v;v=v.parentElement)p.push(v);for(v=p.length-1;0<=v;v--){var x=p[v].getAttribute("id");
(x=x&&b&&b.rd&&b.rd[x])&&f(p[v],x);x=p[v].getAttribute("transform");h(x)}}c(u)}return{x:t,y:l}};function Be(a){if(0===a.x.length)return{X:0,oa:0,Y:0,la:0};for(var b=a.x[0],c=a.x[0],d=a.y[0],e=a.y[0],f=1;f<a.x.length;f++)b=Math.min(b,a.x[f]),c=Math.max(c,a.x[f]),d=Math.min(d,a.y[f]),e=Math.max(e,a.y[f]);return{X:b,oa:c,Y:d,la:e}}function De(a,b){if(a.v[b])return a.v[b];var c=a.H(null,{Id:b});c=Be(c);return a.v[b]=c}re.prototype.td=function(a,b,c){a=De(this,a);return b>=a.X&&b<=a.oa&&c>=a.Y&&c<=a.la};
re.prototype.oc=function(a){return null!=this.b.getElementById(a)};re.prototype.Hf=function(a,b){a=this.b.getElementById(a);b=this.b.getElementById(b);return null!=b&&null!=a&&b.contains(a)};function Ee(a){re.call(this,a);this.m={};this.M={};this.o={};Fe(this)}Ee.prototype=Object.create(re.prototype);Ee.prototype.constructor=Ee;
function Fe(a){function b(a){switch(a.tagName){case "svg":case "defs":for(var c=0;c<a.childElementCount;c++)b(a.children[c]);break;case "style":f+=a.textContent}}function c(a){return a?(a=a.replace(/\s*\(\s*/g,"(").replace(/\s*\)\s*/g,")").replace(/ +,/g,",").replace(/, +/g,",").replace(/ +/g,","),a.split(")").slice(0,-1).map(function(a){var b=a.split("(")[0];a=a.split("(")[1].split(",").map(function(a){return parseFloat(a)});switch(b){case "translate":return{ab:b,B:[a[0]||0,a[1]||0]};case "rotate":return{ab:b,
B:[(a[0]||0)*Math.PI/180,a[1]||0,a[2]||0]};case "scale":var c=a[0]||1;return{ab:b,B:[c,a[1]||c]};case "matrix":return{ab:b,B:a};default:throw"transform not implemented: "+b;}})):null}function d(a,b){function f(b){for(var c=[],e=0;e<a.childElementCount;e++){var f=d(a.children[e],b);f&&c.push(f)}return c}function g(b,c){b=a.getAttribute(b);return null===b?c||0:parseFloat(b)}function h(a){a=a.replace(/\.([0-9]+)(?=\.)/g,".$1 ").replace(/([.0-9])-/g,"$1 -").replace(/\s*([a-z])\s*/gi,";$1").replace(/\s*,\s*/g,
",").replace(/\s+/g,",");var b=[],c=0,d=0,e=0,f=0,g=0,h=0;a.slice(1).split(";").forEach(function(a){var k=a[0];a=1<a.length?a.slice(1).split(",").map(function(a){return parseFloat(a)}):[];switch(k){case "M":if(2<=a.length){c=a[0];d=a[1];g=c;h=d;b.push({ab:"M",B:[c,d]});for(k=2;k+1<a.length;k+=2)c=a[k],d=a[k+1],b.push({ab:"L",B:[c,d]});e=c;f=d}break;case "m":if(2<=a.length)for(c+=a[0],d+=a[1],g=c,h=d,b.push({ab:"M",B:[c,d]}),k=2;k+1<a.length;k+=2)c+=a[k],d+=a[k+1],b.push({ab:"L",B:[c,d]});e=c;f=d;
break;case "L":for(k=0;k+1<a.length;k+=2)c=a[k],d=a[k+1],b.push({ab:"L",B:[c,d]});e=c;f=d;break;case "l":for(k=0;k+1<a.length;k+=2)c+=a[k],d+=a[k+1],b.push({ab:"L",B:[c,d]});e=c;f=d;break;case "H":for(k=0;k<a.length;k++)c=a[k],b.push({ab:"L",B:[c,d]});e=c;f=d;break;case "h":for(k=0;k<a.length;k++)c+=a[k],b.push({ab:"L",B:[c,d]});e=c;f=d;break;case "V":for(k=0;k<a.length;k++)d=a[k],b.push({ab:"L",B:[c,d]});e=c;f=d;break;case "v":for(k=0;k<a.length;k++)d+=a[k],b.push({ab:"L",B:[c,d]});e=c;f=d;break;
case "A":for(k=0;k+6<a.length;k+=7){var l=a[k+5],n=a[k+6];b.push({ab:"A",B:[a[k],a[k+1],a[k+2]*Math.PI/180,0!=a[k+3]?1:0,0==a[k+4]?1:0,c,d,l,n]});c=l;d=n}e=c;f=d;break;case "a":for(k=0;k+6<a.length;k+=7)l=c+a[k+5],n=d+a[k+6],b.push({ab:"A",B:[a[k],a[k+1],a[k+2]*Math.PI/180,0!=a[k+3],0==a[k+4],c,d,l,n]}),c=l,d=n;e=c;f=d;break;case "C":for(k=0;k+5<a.length;k+=6)b.push({ab:"C",B:a.slice(k,k+6)}),c=a[k+4],d=a[k+5],e=2*c-a[k+2],f=2*d-a[k+3];break;case "c":for(k=0;k+5<a.length;k+=6)b.push({ab:"C",B:[c+
a[k],d+a[k+1],c+a[k+2],d+a[k+3],c+a[k+4],d+a[k+5]]}),e=c+2*a[k+4]-a[k+2],f=d+2*a[k+5]-a[k+3],c+=a[k+4],d+=a[k+5];break;case "S":for(k=0;k+3<a.length;k+=4)b.push({ab:"S",B:[e,f,a[k],a[k+1],a[k+2],a[k+3]]}),c=a[k+2],d=a[k+3],e=2*c-a[k],f=2*d-a[k+1];break;case "s":for(k=0;k+3<a.length;k+=4)b.push({ab:"S",B:[e,f,c+a[k],d+a[k+1],c+a[k+2],d+a[k+3]]}),e=c-a[k],f=d-a[k+1],c+=a[k+2],d+=a[k+3];break;case "Q":for(k=0;k+3<a.length;k+=4)b.push({ab:"Q",B:[a[k],a[k+1],a[k+2],a[k+3]]}),c=a[k+2],d=a[k+3],e=2*c-a[k],
f=2*d-a[k+1];break;case "q":for(k=0;k+3<a.length;k+=4)b.push({ab:"Q",B:[c+a[k],d+a[k+1],c+a[k+2],d+a[k+3]]}),e=c+2*a[k+2]-a[k],f=d+2*a[k+3]-a[k+1],c+=a[k+2],d+=a[k+3];break;case "T":for(k=0;k+1<a.length;k+=2)b.push({ab:"Q",B:[e,f,a[k],a[k+1]]}),c=a[k],d=a[k+1],e=2*c-e,f=2*d-f;break;case "t":for(k=0;k+1<a.length;k+=2)b.push({ab:"Q",B:[e,f,c+a[k],d+a[k+1]]}),c+=a[k],d+=a[k+1],e=2*c-e,f=2*d-f;break;case "Z":case "z":c=g;d=h;b.push({ab:"Z",B:[]});break;default:throw"unimplemented path command: "+k;}});
return b}var n=a.getAttribute("id"),t=function(){var b=a.getAttribute("style")||"",c=a.getAttribute("class");c&&e.o.hasOwnProperty(c)&&(b=e.o[c]+";"+b);c={};ve(c,b);(b=a.getAttribute("fill"))&&(c.fill=b);(b=a.getAttribute("stroke"))&&(c.stroke=b);(b=a.getAttribute("stroke-width"))&&(c["stroke-width"]=b);(b=a.getAttribute("stroke-dasharray"))&&(c["stroke-dasharray"]=b.split(","));(b=a.getAttribute("stroke-dashoffset"))&&(c["stroke-dashoffset"]=b);(b=a.getAttribute("id"))&&(c.id=b);return c}();b={name:a.tagName,
id:n,style:t,parent:b};switch(a.tagName){case "svg":b.children=f(b);break;case "g":b.children=f(b);b.transform=c(a.getAttribute("transform"));break;case "path":b.path=h(a.getAttribute("d")||"");b.transform=c(a.getAttribute("transform"));break;case "line":b.jd=g("x1");b.ld=g("y1");b.kd=g("x2");b.md=g("y2");b.transform=c(a.getAttribute("transform"));break;case "polygon":case "polyline":b.qc=a.getAttribute("points").trim().replace(/\s+/g," ").split(" ").map(function(a){return parseFloat(a)});b.transform=
c(a.getAttribute("transform"));break;case "circle":b.x=g("cx");b.y=g("cy");b.r=g("r");b.transform=c(a.getAttribute("transform"));break;case "rect":b.x=g("x");b.y=g("y");b.width=g("width");b.height=g("height");n=g("rx");t=g("ry",n);n=g("rx",t);b.Hg=n;b.Ig=t;b.transform=c(a.getAttribute("transform"));break;case "text":b.x=g("x");b.y=g("y");b.text=a.textContent;b.transform=c(a.getAttribute("transform"));break;default:return null}return b}var e=a,f="";b(a.h);a.o=function(){var a={};f.split("}").forEach(function(b){var c=
b.split("{");c[0].split(",").forEach(function(b){b=b.trim();/^\.[-a-z0-9]+/i.test(b)&&(b=b.slice(1),a[b]=a[b]?a[b]+";"+c[1]:c[1])})});return a}();a.h&&(a.m=d(a.h,null))}function Ge(a,b){function c(a,b){if(a.id===b)return a;if(a.children)for(var d=0;d<a.children.length;d++){var e=c(a.children[d],b);if(e)return e}return null}if(a.M[b])return a.M[b];var d=c(a.m,b);d&&(a.M[b]=d);return d}
function He(a,b,c,d,e){a&&a.forEach(function(a){switch(a.ab){case "translate":b(a.B[0],a.B[1]);break;case "rotate":0!==a.B[1]||0!==a.B[2]?(b(-a.B[1],-a.B[2]),c(a.B[0]),b(a.B[1],a.B[2])):c(a.B[0]);break;case "scale":d(a.B[0],a.B[1]);break;case "matrix":e(a.B[0],a.B[1],a.B[2],a.B[3],a.B[4],a.B[5])}})}
Ee.prototype.H=function(a,b){function c(l,n,v){function p(){for(var a=0;a<l.children.length;a++)c(l.children[a],n,v)}function q(a,b){a=h.apply(new ye(a,b));k.push(a.x);m.push(a.y)}function t(a,b,c){if(null==a||""==a)return b;a=/^\s*(-?[0-9.]+)\s*([a-z%]*)\s*$/i.exec(a);b=parseFloat(a[1]);switch(a[2]||"px"){case "pt":return 25.4*b/72*3;case "pc":return 25.4*b/6*3;case "in":return 25.4*b*3;case "mm":return 3*b;case "cm":return 30*b;case "em":return 18*b;case "ex":return 9*b;case "%":return b*c/100;
default:return b}}function u(c){var d=0,e=0,f=[],g=[],h=!0;a&&a.beginPath();c.forEach(function(c){switch(c.ab){case "M":2<=c.B.length&&(d=c.B[0],e=c.B[1],a&&a.moveTo(d,e),q(d,e),h&&1<f.length&&b&&b.xa&&b.xa.line&&b.xa.line(f,g,!1),h=!0,f=k.slice(-1),g=m.slice(-1));break;case "L":d=c.B[0];e=c.B[1];a&&a.lineTo(d,e);q(d,e);f.push(k[k.length-1]);g.push(m[m.length-1]);break;case "A":var l=c.B[5],n=c.B[6];var p=c.B[0];var ua=c.B[1],v=c.B[2],t=0!=c.B[3],r=0!=c.B[4],u=c.B[5],x=c.B[6],E=c.B[7],wa=c.B[8];if(0===
p||0===ua)a&&a.lineTo(E,wa),p=new ye(E,wa);else{var N=Math.cos(v),fa=Math.sin(v);c=(N*u+fa*x)/p;x=(-fa*u+N*x)/ua;u=(N*E+fa*wa)/p;E=(-fa*E+N*wa)/ua;wa=(u-c)/2;N=(E-x)/2;fa=wa*wa+N*N;fa=Math.sqrt((1-fa)/fa);isNaN(fa)?fa=0:t===r&&(fa=-fa);t=(c+u)/2+fa*N;wa=(x+E)/2-fa*wa;c=Math.atan2((x-wa)/p,(c-t)/ua);x=Math.atan2((E-wa)/p,(u-t)/ua);a&&(a.rotate(v),a.scale(p,ua),r?a.arc(t,wa,1,c,x,!0):a.arc(t,wa,1,c,x),a.scale(1/p,1/ua),a.rotate(-v));u=new ze;u.rotate(v);u.scale(p,ua);p=r?c<x?(c+x)/2+Math.PI:(c+x)/2:
c<x?(c+x)/2:(c+x)/2+Math.PI;p=u.apply(new ye(t+Math.cos(p),wa+Math.sin(p)))}d=l;e=n;q(p.x,p.y);q(d,e);h=!1;break;case "C":a&&a.bezierCurveTo(c.B[0],c.B[1],c.B[2],c.B[3],c.B[4],c.B[5]);d=c.B[4];e=c.B[5];q(d,e);h=!1;break;case "S":a&&a.bezierCurveTo(c.B[0],c.B[1],c.B[2],c.B[3],c.B[4],c.B[5]);d=c.B[4];e=c.B[5];q(d,e);h=!1;break;case "Q":a&&a.quadraticCurveTo(c.B[0],c.B[1],c.B[2],c.B[3]);d=c.B[2];e=c.B[3];q(d,e);h=!1;break;case "Z":a&&a.closePath(),h&&1<f.length&&b&&b.xa&&b.xa.line&&b.xa.line(f,g,!0),
h=!0,f=[],g=[]}});h&&1<f.length&&b&&b.xa&&b.xa.line&&b.xa.line(f,g,!1)}function P(b){function c(a,b){if(0<b.length){a.splice(0,a.length);for(var c=0;c<b.length&&1>c;c++){var d=(b[c].getAttribute("offset")||"0").trim(),e=/%$/.test(d)?parseFloat(d.slice(0,-1))/100:parseFloat(d),f=b[c].getAttribute("style");d={};f&&ve(d,f);isNaN(e)||(f=b[c].getAttribute("stop-color")||d["stop-color"]||"#000",se.hasOwnProperty(f)&&(f=se[f]),d=(b[c].getAttribute("stop-opacity")||d["stop-opacity"]||"1").trim(),d=/%$/.test(d)?
parseFloat(d.slice(0,-1))/100:parseFloat(d),1!==d&&(/^#[0-9a-f]{3}$/i.test(f)?f="rgba("+f.slice(1).split("").map(function(a){return 17*parseInt(a,16)}).map(function(a){return a.toString(10)}).join(",")+","+d.toFixed(2)+")":/^#[0-9a-f]{6}$/i.test(f)?f="rgba("+[f.slice(1,3),f.slice(3,5),f.slice(5)].map(function(a){return parseInt(a,16)}).map(function(a){return a.toString(10)}).join(",")+","+d.toFixed(2)+")":/^rgb(\d+%?(,|\s+)\d+%?(,|\s+)\d+%?)$/i.test(f)?f=f.slice(0,-1).replace(/\s+/g,",")+","+d.toFixed(2)+
")":/^hsl(\d+%?(,|\s+)\d+%?(,|\s+)\d+%?)$/i.test(f)&&(f=f.slice(0,-1).replace(/\s+/g,",")+","+d.toFixed(2)+")")),a.push({offset:e,color:f}))}}}function d(a,b){if(a.attributes["xlink:href"]){var e=a.getAttribute("xlink:href");"#"===e[0]&&(e=g.b.getElementById(e.slice(1)))&&(b=d(e,b))}b.jd=a.attributes.x1?parseFloat(a.getAttribute("x1")):b.jd||0;b.ld=a.attributes.y1?parseFloat(a.getAttribute("y1")):b.ld||0;b.kd=a.attributes.x2?parseFloat(a.getAttribute("x2")):b.kd||0;b.md=a.attributes.y2?parseFloat(a.getAttribute("y2")):
b.md||0;b.Ac=a.attributes.gradientUnits?a.getAttribute("gradientUnits"):b.Ac||"objectBoundingBox";b.Qb=a.attributes.gradientTransform?a.getAttribute("gradientTransform"):b.Qb||"";b.jb=b.jb||[];c(b.jb,a.getElementsByTagName("stop"));return b}function e(a,b){if(a.attributes["xlink:href"]){var d=a.getAttribute("xlink:href");"#"===d[0]&&(d=g.b.getElementById(d.slice(1)))&&(b=e(d,b))}b.xc=a.attributes.cx?parseFloat(a.getAttribute("cx")):b.xc||0;b.yc=a.attributes.cy?parseFloat(a.getAttribute("cy")):b.yc||
0;b.r=a.attributes.r?parseFloat(a.getAttribute("r")):b.r||0;b.Ac=a.attributes.gradientUnits?a.getAttribute("gradientUnits"):b.Ac||"objectBoundingBox";b.Qb=a.attributes.gradientTransform?a.getAttribute("gradientTransform"):b.Qb||"";b.jb=b.jb||[];c(b.jb,a.getElementsByTagName("stop"));return b}var f=/^url\(#(.+)\)$/.exec(b);if(f&&f[1]&&(f=g.b.getElementById(f[1])))switch(f.tagName){case "linearGradient":b=d(f,{});if("objectBoundingBox"===b.Ac)throw"objectBoundingBox not supported";if(b.Qb)throw f=new ze,
xe(b.Qb,f),"gradientTransform not supported";var h=a.createLinearGradient(b.jd,b.ld,b.kd,b.md);for(f=0;f<b.jb.length;f++)h.addColorStop(b.jb[f].offset,b.jb[f].color);return h;case "radialGradient":b=e(f,{});if("objectBoundingBox"===b.Ac)throw"objectBoundingBox not supported";b.Qb&&(f=new ze,xe(b.Qb,f),h=Ae(f,{x:b.xc,y:b.yc}),f=b.r/Math.sqrt(Math.abs(f.b[0]*f.b[4])),b.xc=h.x,b.yc=h.y,b.r=f);h=a.createRadialGradient(b.xc,b.yc,0,b.xc,b.yc,b.r);for(f=0;f<b.jb.length;f++)h.addColorStop(b.jb[f].offset,
b.jb[f].color);return h}return b}function T(b,c,d,e,f,g){0>=f||0>=g?a.rect(b,c,d,e):(f=Math.min((f+g)/2,Math.min(d,e)/2),a.moveTo(b+d-f,c),a.arc(b+d-f,c+f,f,1.5*Math.PI,2*Math.PI),a.lineTo(b+d,c+e-f),a.arc(b+d-f,c+e-f,f,0,.5*Math.PI),a.lineTo(b+f,c+e),a.arc(b+f,c+e-f,f,.5*Math.PI,Math.PI),a.lineTo(b,c+f),a.arc(b+f,c+f,f,Math.PI,1.5*Math.PI),a.closePath())}function za(){if(a){var b={};n&&te(b,n);v&&te(b,v);"hidden"!==b.visibility&&(b.opacity&&(a.globalAlpha*=parseFloat(b.opacity)),b.fill&&"none"===
b.fill||(a.fillStyle="white"===b.fill||"#fff"===b.fill||"#ffffff"===b.fill?"white":P(b.fill)||"none",a.fill()),b.stroke&&"none"!==b.stroke&&(a.lineWidth=t(b["stroke-width"]||"1px",1,100),a.strokeStyle=b.stroke||"none",a.miterLimit=b["stroke-miterlimit"]||4,a.lineJoin=b["stroke-linejoin"]||"miter",a.lineCap=b["stroke-linecap"]||"butt",b["stroke-dasharray"]&&(a.setLineDash(b["stroke-dasharray"].split(" ").map(function(a){return parseFloat(a)})),a.lineDashOffset=b["stroke-dashoffset"]?parseFloat(b["stroke-dashoffset"]):
0),a.stroke()))}}function Wa(c,d,e){if(a){var f={};n&&te(f,n);v&&te(f,v);"hidden"!==f.visibility&&(a.font=(f["font-size"]||"12px")+" "+(f["font-family"]||"helvetica"),f.fill&&"none"!==f.fill&&(a.fillStyle="white"===f.fill||"#fff"===f.fill||"#ffffff"===f.fill?"white":b&&b.fill||"silver",a.fillText(c,d,e)),f.stroke&&"none"!==f.stroke&&(a.strokeStyle=b&&b.stroke||"black",a.strokeText(c,d,e)))}}function fa(b,c){b=Be({x:b,y:c});a.save();a.strokeStyle="black";a.lineWidth=1;a.strokeRect(b.X,b.Y,b.oa-b.X,
b.la-b.Y);a.restore()}var N=l.id&&b&&b.rd&&b.rd[l.id],Q=l.id&&b&&b.We&&b.We[l.id];a&&a.save();h.save();N&&a&&d(l,N);Q&&a&&e(Q);n=ue(n);v=ue(v);(function(){l.style&&te(n,l.style);b&&b.og&&ve(n,b.og);l.id&&b&&b.style&&b.style.hasOwnProperty(l.id)&&ve(v,b.style[l.id]);for(var a in b.style)b.style.hasOwnProperty(a)&&"!"===a[0]&&a.slice(1)!==l.id&&ve(v,b.style[a])})();N=k.length;switch(l.name){case "svg":h.save();f(l.transform);p();h.restore();break;case "g":h.save();f(l.transform);p();h.restore();break;
case "path":a&&a.save();h.save();f(l.transform);u(l.path);za();a&&a.restore();h.restore();break;case "line":a&&a.save();h.save();f(l.transform);a&&a.beginPath();a&&a.moveTo(l.jd,l.ld);a&&a.lineTo(l.kd,l.md);za();q(l.jd,l.ld);q(l.kd,l.md);b&&b.xa&&b.xa.line&&b.xa.line([l.jd,l.kd],[l.ld,l.md],!1);a&&a.restore();h.restore();break;case "polygon":case "polyline":if(4<=l.qc.length){a&&a.save();h.save();f(l.transform);a&&a.beginPath();a&&a.moveTo(l.qc[0],l.qc[1]);q(l.qc[0],l.qc[1]);for(Q=2;Q+1<l.qc.length;Q+=
2)a&&a.lineTo(l.qc[Q],l.qc[Q+1]),q(l.qc[Q],l.qc[Q+1]);"polygon"===l.name&&a&&a.closePath();za();b&&b.xa&&b.xa.line&&b.xa.line(k.slice(-l.qc.length/2),m.slice(-l.qc.length/2),"polygon"===l.name);a&&a.restore();h.restore()}break;case "circle":a&&a.save();h.save();f(l.transform);a&&a.beginPath();a&&a.arc(l.x,l.y,l.r,0,2*Math.PI);za();q(l.x-l.r,l.y-l.r);q(l.x-l.r,l.y+l.r);q(l.x+l.r,l.y-l.r);q(l.x+l.r,l.y+l.r);if(b&&b.xa&&b.xa.Ve){Q=k.slice(-4);var O=m.slice(-4),pa=(Q[3]-Q[0])*(Q[3]-Q[0])+(O[3]-O[0])*
(O[3]-O[0]),Gb=(Q[2]-Q[1])*(Q[2]-Q[1])+(O[2]-O[1])*(O[2]-O[1]);.001>Math.abs(pa-Gb)/(pa+Gb)&&.001>((Q[3]-Q[0])*(Q[2]-Q[1])+(O[3]-O[0])*(O[2]-O[1]))/pa&&b.xa.Ve((Q[0]+Q[2])/2,(O[0]+O[2])/2,Math.sqrt(pa/8))}a&&a.restore();h.restore();break;case "rect":a&&a.save();h.save();f(l.transform);a&&(a.beginPath(),0<l.Hg||0<l.Ig?T(l.x,l.y,l.width,l.height,l.Hg,l.Ig):a.rect(l.x,l.y,l.width,l.height));za();q(l.x,l.y);q(l.x,l.y+l.height);q(l.x+l.width,l.y);q(l.x+l.width,l.y+l.height);a&&a.restore();h.restore();
break;case "text":a&&a.save(),h.save(),f(l.transform),Wa(l.text,l.x,l.y),q(l.x,l.y),a&&a.restore(),h.restore()}a&&a.restore();h.restore();a&&b&&b.ng&&fa(k.slice(N),m.slice(N))}function d(b,c){if(c.bb&&0!=c.bb){var d=c.Ud,e=c.Vd;if(void 0==d||void 0==e)d=g.H(null,{Cc:b}),b=Be(d),d=(b.X+b.oa)/2,e=(b.Y+b.la)/2;a.translate(d+(c.Hb||0),e+(c.Ib||0));a.rotate(c.bb);a.translate(-d,-e)}else(c.Hb||c.Ib)&&a.translate(c.Hb,c.Ib)}function e(b){a.beginPath();a.rect(b.x,b.y,b.Uc,b.Kc);a.clip()}function f(b){He(b,
function(b,c){a&&a.translate(b,c);h.translate(b,c)},function(b){a&&a.rotate(b);h.rotate(b)},function(b,c){a&&a.scale(b,c);h.scale(b,c)},function(b,c,d,e,f,g){a&&a.transform(b,c,d,e,f,g);h.He(b,c,d,e,f,g)})}var g=this,h=new Ce,k=[],m=[],q=this.m;b&&b.Id?q=Ge(this,b.Id):b&&b.Cc&&(q=b.Cc);if(q){b&&b.ff&&b.ff(a,this.Ca);if(a){for(var n=[],t=q.parentElement;null!=t;t=t.parentElement)n.push(t);for(t=n.length-1;0<=t;t--){var l=n[t].id;(l=l&&b&&b.rd&&b.rd[l])&&d(n[t],l);f(n[t].transform)}}c(q,{},{})}return{x:k,
y:m}};function Ie(a,b){if(a.id===b)return a;if(a.children)for(var c=0;c<a.children.length;c++){var d=Ie(a.children[c],b);if(d)return d}return null}Ee.prototype.oc=function(a){return null!=Ie(this.m,a)};Ee.prototype.Hf=function(a,b){var c=Ie(this.m,b);if(null==c)throw"Undefined SVG element id "+b;return null!=Ie(c,a)};function ze(a){this.b=a||[1,0,0,0,1,0]}w=ze.prototype;w.ob=function(){return new ze(this.b)};w.apply=function(a){return new ye(this.b[0]*a.x+this.b[1]*a.y+this.b[2],this.b[3]*a.x+this.b[4]*a.y+this.b[5])};function Ae(a,b){var c=a.b[0]*a.b[4]-a.b[3]*a.b[1];return new ye((a.b[4]*b.x-a.b[1]*b.y+a.b[1]*a.b[5]-a.b[4]*a.b[2])/c,(-a.b[3]*b.x+a.b[0]*b.y+a.b[3]*a.b[2]-a.b[0]*a.b[5])/c)}
w.translate=function(a,b){this.b=[this.b[0],this.b[1],this.b[0]*a+this.b[1]*b+this.b[2],this.b[3],this.b[4],this.b[3]*a+this.b[4]*b+this.b[5]]};w.scale=function(a,b){this.b=[this.b[0]*a,this.b[1]*b,this.b[2],this.b[3]*a,this.b[4]*b,this.b[5]]};w.rotate=function(a){var b=Math.cos(a);a=Math.sin(a);this.b=[b*this.b[0]+a*this.b[1],-a*this.b[0]+b*this.b[1],this.b[2],b*this.b[3]+a*this.b[4],-a*this.b[3]+b*this.b[4],this.b[5]]};
w.He=function(a,b,c,d,e,f){this.b=[a*this.b[0]+c*this.b[1],b*this.b[0]+d*this.b[1],a*this.b[2]+c*this.b[3],b*this.b[2]+d*this.b[3],a*this.b[4]+c*this.b[5]+e,b*this.b[4]+d*this.b[5]+f]};function ye(a,b){this.x=a||0;this.y=b||0}function Ce(){this.stack=[new ze]}w=Ce.prototype;w.apply=function(a){return this.stack[this.stack.length-1].apply(a)};w.save=function(){this.stack.push(this.stack[this.stack.length-1].ob())};w.restore=function(){if(2>this.stack.length)throw"restore doesn't match save";this.stack.pop()};
w.translate=function(a,b){this.stack[this.stack.length-1].translate(a,b)};w.scale=function(a,b){this.stack[this.stack.length-1].scale(a,b)};w.rotate=function(a){this.stack[this.stack.length-1].rotate(a)};w.He=function(a,b,c,d,e,f){this.stack[this.stack.length-1].He(a,b,c,d,e,f)};function Je(a){for(var b=0;b<a.draw.length;b++)if(a.draw[b].uri)return a.draw[b].uri;throw"URI not found";}function fc(a){a=a.split("#");return{Ic:a[0],id:a[1]}}function Ke(a,b,c){a.J.save();c.ff=function(a,b){this.clientData.Zd=b;a.translate(-b[0],-b[1]);a.scale(this.w.j/(b[2]-b[0]),this.w.j/(b[3]-b[1]))}.bind(a);b.H(a.J,c);a.J.restore()}
function Le(a,b,c,d,e){return{x:(a.clientData.Zd[2]-a.clientData.Zd[0])/d*(b+a.clientData.Zd[0]),y:(a.clientData.Zd[3]-a.clientData.Zd[1])/e*(c+a.clientData.Zd[1])}}
function Me(a,b,c){var d={},e=(a.buttons?a.buttons.length:0)+(a.radiobuttons?1:0);if(void 0!=a.sliders){for(var f=0;f<a.sliders.length;f++){var g=a.sliders[f],h=De(b,g.id),k=De(b,g.thumbId),m=(k.X+k.oa)/2,q=(k.Y+k.la)/2;h.oa-h.X<h.la-h.Y?(h.X=h.oa=(h.X+h.oa)/2,m=h.X):(h.Y=h.la=(h.Y+h.la)/2,q=h.Y);k=(c[e+f]-g.min)/(g.max-g.min);d[g.thumbId]={Hb:k*(h.oa-h.X)-(m-h.X),Ib:k*(h.Y-h.la)-(q-h.la)}}e+=a.sliders.length}if(void 0!=a.rotating)for(f=0;f<a.rotating.length;f++)g=a.rotating[f],k=g.numSteps?2*Math.PI/
g.numSteps:1,h=De(b,g.centerId),d[g.id]={bb:c[e+f]*k,Ud:(h.X+h.oa)/2,Vd:(h.Y+h.la)/2};return d}function Ne(a,b,c){return Math.min(Math.max((c-a)/(b-a),0),1)}
function Oe(a,b,c,d,e,f,g,h,k){e=Le(a,k.x-g,k.y-h,e,f);var m=a.clientData.ed.min+(a.clientData.ed.max-a.clientData.ed.min)*Ne(a.clientData.min,a.clientData.max,a.clientData.te?e.y:e.x),q=a.clientData.ed.min,n=a.clientData.ed.max;(e=a.clientData.ed.discrete)&&0<e.length?m=e.reduce(function(a,b){return Math.abs(m-b)<Math.abs(m-a)?b:a},e[0]):(a=a.clientData.ed.snap)&&a.forEach(function(a,c){"string"===typeof a&&/^`.+`$/.test(a)&&(a=oa(a,b.g,c,!0));Math.abs(m-a)<Math.abs(n-q)/10&&(m=a)});b.g[(d.buttons?
d.buttons.length:0)+(d.radiobuttons?1:0)+c]=Math.max(Math.min(q,n),Math.min(Math.max(q,n),m))}
function Pe(a,b,c,d){if(0!==c.draw.length){var e=fc(Je(c)).Ic,f=e?Me(c,b.ub[e],d.g):{},g=null;if(c.diffwheelmotion&&c.diffwheelmotion.id){g=c.diffwheelmotion;var h=g.id,k=g.dx||0,m=g.dy||0,q=g.adjscale||1,n=g.color||"black",t=void 0===g.linewidth?1:g.linewidth;g=De(b.ub[e],h);var l=(c.buttons?c.buttons.length:0)+(c.radiobuttons?1:0),u=2.4*d.g[l];l=2.4*d.g[l+1];var p=a.w.j;g=(.5+k)*(g.oa-g.X)*q/p;k=Ud(a,u,l,g,{color:n,Fe:t});f[h]={Hb:-(k.x*g*p+m*p*Math.sin(k.bb)),Ib:-(k.y*g*p+m*p*Math.cos(k.bb)),bb:-k.bb};
g={bh:u,dh:l,ih:g,color:n,Fe:t}}c.draw.forEach(function(a){if(a.uri){var g=fc(a.uri),h=b.ub[g.Ic];g=g.id;for(var k={},l=c.buttons?c.buttons.length:0,n=c.radiobuttons?c.radiobuttons.length:0,m=c.styles?c.styles.length:0,p=0;p<l;p++){var q=c.buttons[p].val,t=c.buttons[p].st;q=q.indexOf(d.g[p]);0<=q&&(k[c.buttons[p].id]=t[q])}for(p=0;p<n;p++)q=c.radiobuttons[p].val,t=c.radiobuttons[p].st,k[c.radiobuttons[p].id]=t[d.g[l]===q?1:0];for(p=0;p<m;p++)k[(c.styles[p].complement?"!":"")+c.styles[p].id]=oa(c.styles[p].st,
d.g);l=b.ub[e];n=d.g;m={};if(void 0!=c.sliders)for(p=0;p<c.sliders.length;p++){t=c.sliders[p];q=De(l,t.id);var v=t.lowerPartId&&De(l,t.lowerPartId);if(v){var u=(n[p]-t.min)/(t.max-t.min),O=v.oa-v.X,pa=v.la-v.Y;m[t.lowerPartId]=q.oa-q.X<q.la-q.Y?{x:v.X-pa,y:v.Y,Uc:O+2*pa,Kc:pa*u}:{x:v.X,y:v.Y-pa,Uc:O*u,Kc:pa+2*O}}}Ke(this,h,{Id:g,style:k,rd:f,We:m,ng:!1})}a.js&&(a=new Function("ctx","$",a.js),this.J.save(),this.J.scale(this.w.j/1E3,this.w.j/1E3),this.J.beginPath(),a(this.J,d.g),this.J.restore())},
a);g&&Ud(a,g.bh,g.dh,g.ih,{color:g.color,Fe:g.Fe});c.score&&c.score.id&&(h=(c.buttons?c.buttons.length:0)+(c.radiobuttons?1:0)+(c.sliders?c.sliders.length:0),m=c.score,n=m.numHeights||5,g=De(b.ub[e],m.id),t=b.ub[e].Ca,Yd(a,d.g.slice(h),(g.X-t[0])/(t[2]-t[0]),(g.oa-t[0])/(t[2]-t[0]),(g.la-t[1])/(t[3]-t[1]),(g.Y-t[1])/(t[3]-t[1]),n,(g.la-g.Y)/(t[3]-t[1])/n*(m.noteSize||1),void 0===m.linewidth?1:m.linewidth))}}
function Qe(a,b,c){function d(a){for(var b=0;b<c.length;b++)if(c[b].name===a)return b;return-1}b.forEach(function(b){var e=b.name;if(!e)throw"Missing block name";var g=d(e),h=0<=g?c[g]:null,k=h?h.type:"?";if(b.type||!h)switch(b.type){case "event":k="e";break;case "action":k="a";break;case "state":k="s";break;case "comment":k="c";break;case "hidden":k="h";break;default:throw"Unknown block type "+b.type+" for block "+e;}var m=h?h.ma:[];b.modes&&!h&&b.modes.forEach(function(a){switch(a){case "basic":m.push("b");
break;case "advanced":m.push("a");break;default:throw"Unknown block mode "+a;}});var q=h?h.vc:null,n=b.validation;n&&(q=function(a){for(var b=0;b<n.length;b++){var c=n[b].assert;if("string"===typeof c&&/^`.+`$/.test(c)?!oa(c,a.g,void 0,!0):!c)return(a=n[b].warning)?new Da(a,!0):new Da(n[b].error||"Error")}});var t=h?h.H:function(c,d){Pe(c,a,b,d)},l=h?h.$:function(c,d,e,f,g,h,k){a:{var l=fc(Je(b)).Ic,n=0,m=b.buttons;if(m){var p;b:{var q=a.ub[l],t=Le(c,k.x-g,k.y-h,e,f);for(p=0;p<m.length;p++)if(q.td(m[p].id,
t.x,t.y)){q=m[p].val.indexOf(d.g[p]);0<=q&&(A(d),d.g[p]=m[p].val[(q+1)%m[p].val.length]);break b}p=null}if(null!==p){d=n+p;break a}n+=m.length}if(p=b.radiobuttons){b:{q=a.ub[l];m=m||0;t=Le(c,k.x-g,k.y-h,e,f);for(var u=0;u<p.length;u++)if(q.td(p[u].id,t.x,t.y)){A(d);d.g[m]=p[u].val;p=0;break b}p=null}if(null!==p){d=n+p;break a}n++}if(p=m=b.pushbuttons){b:{p=a.ub[l];q=Le(c,k.x-g,k.y-h,e,f);for(t=0;t<m.length;t++)if(p.td(m[t].id,q.x,q.y)){A(d);m=m[t].newParameters;"string"===typeof m&&/^`.+`$/.test(m)&&
(m=oa(m,d.g,void 0,!0));d.g=m;m=!0;break b}m=null}p=null!==m}if(p)d=-1;else{if(m=b.sliders){b:{p=a.ub[l];q=Le(c,k.x-g,k.y-h,e,f);for(t=0;t<m.length;t++){c.clientData.ed=m[t];var r=De(p,c.clientData.ed.id);c.clientData.te=r.oa-r.X<r.la-r.Y;c.clientData.min=c.clientData.te?r.la:r.X;c.clientData.max=c.clientData.te?r.Y:r.oa;u=(r.X+r.oa)/2;r=(r.Y+r.la)/2;var v=De(p,c.clientData.ed.thumbId);if(Math.abs((c.clientData.te?q.x:q.y)-(c.clientData.te?u:r))<(c.clientData.te?v.oa-v.X:v.la-v.Y)){A(d);p=t;break b}}p=
null}if(null!==p){d=n+p;break a}n+=m.length}if(m=b.rotating){b:{p=a.ub[l];q=d.g.slice(n,n+m.length);t=Le(c,k.x-g,k.y-h,e,f);for(u=0;u<m.length;u++){r=De(p,m[u].centerId);r={x:(r.X+r.oa)/2,y:(r.Y+r.la)/2};var x=m[u].numSteps?2*Math.PI/m[u].numSteps:1;v=r.x+(t.x-r.x)*Math.cos(q[u]*x)+(t.y-r.y)*Math.sin(q[u]*x);x=r.y-(t.x-r.x)*Math.sin(q[u]*x)+(t.y-r.y)*Math.cos(q[u]*x);if(p.td(m[u].thumbId,v,x)){c.clientData.yh=m[u];c.clientData.ig=r;c.clientData.gh=Math.atan2(x-r.y,v-r.x);A(d);p=u;break b}}p=null}if(null!==
p){d=n+p;break a}n+=m.length}if(b.score&&(q=a.ub[l],c=(b.buttons?b.buttons.length:0)+(b.radiobuttons?1:0)+(b.sliders?b.sliders.length:0),l=d.g.slice(c).length/2,m=b.score.numHeights||5,p=De(q,b.score.id),q=q.Ca,(e=le((p.X-q[0])/(q[2]-q[0]),(p.oa-q[0])/(q[2]-q[0]),(p.la-q[1])/(q[3]-q[1]),(p.Y-q[1])/(q[3]-q[1]),l,m,e,f,g,h,k))?(A(d),d.g[c+2*e.index]===e.tone?d.g[c+2*e.index+1]=(d.g[c+2*e.index+1]+1)%3:(d.g[c+2*e.index]=e.tone,d.g[c+2*e.index+1]=1),p=0):p=null,null!==p)){d=n+p;break a}d=null}}return d},
u=h?h.Ra:function(a,c,d,e,f,g,h,k){var l=(b.buttons?b.buttons.length:0)+(b.radiobuttons?1:0),n=b.sliders?b.sliders.length:0;d>=l&&d<l+n?Oe(a,c,d-l,b,e,f,g,h,k):(l+=n,n=b.rotating?b.rotating.length:0,d>=l&&d<l+n&&(d-=l,e=Le(a,k.x-g,k.y-h,e,f),c.g[(b.buttons?b.buttons.length:0)+(b.radiobuttons?1:0)+(b.sliders?b.sliders.length:0)+d]=Math.round(((Math.atan2(e.y-a.clientData.ig.y,e.x-a.clientData.ig.x)-a.clientData.gh+Math.PI)%(2*Math.PI)-Math.PI)/(b.rotating[d].numSteps?2*Math.PI/b.rotating[d].numSteps:
1))))},p=qe(b,h&&h.Jb);e={name:e,type:k,ma:m,ha:h?h.ha:function(){return b.defaultParameters||[]},gb:h?h.gb:function(){return b.typicalParameters||b.defaultParameters||[]},se:h?h.se||null:b.typicalParamSet||null,H:t,Xd:h?h.Xd||!1:b.alwaysZoom||!1,$:l,Ra:u,Jb:p,vc:q};0<=g?c[g]=new y(e):c.push(new y(e))})}
function Re(a){Sb=function(b,d){return{j:b,tg:void 0===a.styles.minInteractiveBlockSize?60:a.styles.minInteractiveBlockSize,ug:void 0===a.styles.minTouchInteractiveBlockSize?120:a.styles.minTouchInteractiveBlockSize,pg:void 0===a.styles.eventRightAlign?!1:a.styles.eventRightAlign,ja:void 0===a.styles.blockLineWidth?Math.max(1,Math.min(3,b/40)):a.styles.blockLineWidth,xf:Math.round(b/4).toString(10)+"px sans-serif",c:d,ta:void 0===a.styles.controlLineWidth?Math.max(1,Math.min(3,b/40)):a.styles.controlLineWidth,
Zg:"bold 15px sans-serif",Af:a.styles.errorColor||"#f88",ag:a.styles.warningColor||"#f88",background:a.styles.background||"white",Qf:a.styles.ruleMarks||"#bbb",Sf:a.styles.scrollbarThumbColor||"navy",Rf:a.styles.scrollbarBackgroundColor||"#ccc",Rc:a.styles.scrollbarWidth||5}};var b=[];Qe(a,a.blocks||[],b);Ya=b};function Da(a,b){this.v=a;this.Kb=b||!1;this.h=!1;this.m=[];this.b=[];this.o=null}function ob(a,b){a.h=!0;a.m=b}function Ea(a,b){a.h=!0;a.o=b};function Oa(){this.hc=[];this.cd=[]}function Se(a,b){this.state=a;this.b=b||!1}function Te(a){a.hc.forEach(function(a){a.b=!1});a.cd.forEach(function(a){a.b=!1})}Oa.prototype.Bb=function(a,b){b&&Te(this);this.hc.push(new Se(a,b));20<this.hc.length&&(this.hc=this.hc.slice(-20));this.cd=[]};Oa.prototype.Xf=function(a,b){b&&Te(this);return 0<this.hc.length?(this.cd.push(new Se(a,b)),this.hc.pop()):new Se(a,b)};
Oa.prototype.Pf=function(a,b){b&&Te(this);return 0<this.cd.length?(this.hc.push(new Se(a,b)),this.cd.pop()):new Se(a,b)};z.prototype.toDataURL=function(a,b,c){function d(a){a&&(a[0]*=g,a[1]*=h)}var e=this;switch(this.V.type){case "e":var f=F(a,{tag:"block",W:["event","html"]});break;case "a":f=F(a,{tag:"block",W:["action","html"]});break;case "s":f=F(a,{tag:"block",W:["state","html"]});break;case "c":f=F(a,{tag:"block",W:["comment","html"]});break;default:throw"internal";}var g=b.j/f.width,h=b.j/f.height;f.width=b.j;f.height=b.j;d(f.borderBottomLeftRadius);d(f.borderBottomRightRadius);d(f.borderTopLeftRadius);d(f.borderTopRightRadius);
return(new Jc(this,C(f),f.ra(),0,0,function(a,b,c,d,g){c=b.x+f.offsetLeft()+c;d=b.y+f.offsetTop()+d;qc(f,a.J,c,d);var h=e.V;b=b.data;var k=f;a.J.save();a.J.translate(c,d);h.H(a,b,k,g);a.J.restore()})).toDataURL(b,c||1)};function Ue(a,b,c,d,e){a=a.toDataURL(b,c,d);c="<img width='"+c.j.toString(10)+"' height='"+c.j.toString(10)+"' src='"+a+"'>";return e?"<a href='"+a+"' download='"+e+"'>"+c+"</a>":c}
function Ve(a,b,c,d,e){var f=F(c,{tag:"widget",id:"widget-"+b.replace(/^.*:/g,"")}),g=C(f),h=f.ra();return{url:(new Jc(null,g,h,0,0,function(c,d,e,n){c.ga=a.ga;Uc(c,b,g/2+e,h/2+n,f)})).toDataURL(d,e||1),width:g,height:h}}function We(a,b,c,d,e,f){a=Ve(a,b,c,d,e);b="<img width='"+a.width.toString(10)+"' height='"+a.height.toString(10)+"' src='"+a.url+"'>";return f?"<a href='"+a.url+"' download='"+f+"'>"+b+"</a>":b}
function Xe(a,b,c,d,e,f){return{url:(new Jc(null,b,c,0,0,function(b){a(b.J,d,!1)})).toDataURL(e,f||1),width:b,height:c}}
function ic(a,b){var c=Sb(100,100),d=We(a.ca,"vpl:then",b,c,5);return"<!DOCTYPE html>\n<html>\n"+(a.R?"<head>\n<style>\n"+a.R+"</style>\n</head>\n":"")+"<body>\n<table class='program'>\n"+a.i.i.map(function(a){return a.Tb()?"":"<tr class='rule'>\n<td class='events'>\n<table class='events'>\n<tr class='events'>\n"+a.U.map(function(a,d){var e="block";switch(a.V.type){case "e":e=e+" event"+(0===d?" event-main":" event-aux");break;case "s":e+=" state";break;case "c":e+=" comment"}return"<td class='"+
e+"'>"+Ue(a,b,c,5)+"</td>\n"}).join("")+"</tr>\n</table>\n</td>\n<td class='then'>"+d+"</td>\n<td class='actions'>\n<table class='actions'>\n<tr class='actions'>\n"+a.actions.map(function(a){var d="block";switch(a.V.type){case "a":d+=" action";break;case "c":d+=" comment"}return"<td class='"+d+"'>"+Ue(a,b,c,5)+"</td>\n"}).join("")+"</tr>\n</table>\n</td>\n</tr>\n"}).join("")+"</table>\n</body>\n</html>\n"}
function kc(a,b){function c(a,b){return b.controls.map(function(c){return(a.L.find(c.id).cb||[{}]).map(function(f){a.Pb.Ua=!0===f.selected;a.Pb.state=f.state||null;var h=!0===f.selected?"selected":!1===f.selected?"unselected":"";f.state&&(h+=(0<h.length?" ":"")+"="+f.state);f=c.id+(h?"-"+h.replace(/\s+/g,"-").replace("=",""):"")+".png";a:{var k=c.id;for(var l=g[c.id],n=d,m=e,p=0;p<b.controls.length;p++){var q=b.controls[p];if(q.id===k){k=Xe(q.H,q.Gc.oa-q.Gc.X,q.Gc.la-q.Gc.Y,l,n,m);break a}}throw"button id not found";
}l="<img width='"+k.width.toString(10)+"' height='"+k.height.toString(10)+"' src='"+k.url+"'>";return"<tr><td>"+(f?"<a href='"+k.url+"' download='"+f+"'>"+l+"</a>":l)+"</td><td>"+c.id+"</td><td>"+h+"</td></tr>\n"}).join("")}).join("")}var d=Sb(100,100),e=5,f=Xc(a,b);a.Pb={disabled:!1,T:!0,eh:!1,isEnabled:!0,Ua:!1,state:null};var g=Cc(a,a.ga,["vpl","top"]),h=Yc(a,a.ga,["vpl","top"],f.uc,f.Pg,g);g=Object.assign(g,Cc(a,a.M,["vpl","bottom"]));f=Yc(a,a.M,["vpl","bottom"],f.Bd,f.Og,g);a.Oa.forEach(function(a){g[a]=
F(b,{tag:"button",id:a.replace(/:/g,"-"),W:["src","top"]})},a);var k=Ye(a,a.Oa,F(b,{tag:"toolbar",W:["src","top"]}),F(b,{tag:"separator",W:["src","top"]}),g);a.Aa.forEach(function(a){g[a]=F(b,{tag:"button",id:a.replace(/:/g,"-"),W:["sim","top"]})},a);var m=Ze(a,a.Aa,F(b,{tag:"toolbar",W:["sim","top"]}),F(b,{tag:"separator",W:["sim","top"]}),g),q="sim-event:forward sim-event:backward sim-event:left sim-event:right sim-event:center sim-event:clap sim-event:tap".split(" "),n=a.G,t=F(b,{tag:"button",
W:["sim","event"]}),l=q.map(function(a){return Xe(function(c,e,f){(n.Sd||sc)(a,c,d,b,["sim","event"],null,!0,!1,f)},t.width,t.height,t,d,e)});h="<!DOCTYPE html>\n<html>\n"+(a.R?"<head>\n<style>\n"+a.R+"</style>\n</head>\n":"")+"<body>\n<table>\n"+Ya.map(function(a){var c=null;switch(a.type){case "e":c="event";break;case "s":c="state";break;case "a":c="action";break;case "c":c="comment";break;default:return""}var f=new z(a,null,null),g="<tr class='"+c+"'>\n<td>\n";a.se?a.se.forEach(function(c,h){f.g=
c;g+=Ue(f,b,d,e,a.name.replace(/ /g,"_")+"-"+h.toString(10)+".png")}):(f.g=a.gb?a.gb():f.g,g+=Ue(f,b,d,e,a.name.replace(/ /g,"_")+".png"));return g+="</td>\n<td>"+a.name+"</td>\n</tr>\n"}).join("")+"</table>\n<table>\n"+Object.keys(a.ca.ga).map(function(a){return"<tr><td>"+We(this.ca,a,b,d,e,a+".png")+"</td><td>"+a+"</td></tr>\n"},a).join("")+"</table>\n<table>\n"+c(a,h)+c(a,f)+c(a,k)+c(a,m)+l.map(function(a,b){b=q[b];var c="<img width='"+a.width.toString(10)+"' height='"+a.height.toString(10)+"' src='"+
a.url+"'>",d=b.replace(/ /g,"_")+".png";return"<tr><td>"+("<a href='"+a.url+"' download='"+d+"'>"+c+"</a>")+"</td><td>"+b+"</td></tr>\n"})+"</table>\n</body>\n</html>\n";a.Pb=null;return h};function $e(a,b){b=(new DOMParser).parseFromString(b,"text/xml").getElementsByTagName("node");if(1>b.length)throw"empty";b=b[0].getElementsByTagName("program");if(1!==b.length)throw"program";var c="0"!==b[0].getAttribute("advanced_mode");b=b[0].getElementsByTagName("set");Za(a);a.mode=c?"a":"b";for(c=0;c<b.length;c++){var d=af(b[c],function(){a.Bb()});a.i.push(d)}}
function af(a,b){a=a.getElementsByTagName("block");for(var c=new va,d=0;d<a.length;d++){a:{var e=a[d];e.getAttribute("type");var f=e.getAttribute("name");var g=[];for(var h=[],k=0;1E3>k;k++){var m=e.getAttribute("value"+k);if(null===m)break;g.push(m);h.push(parseFloat(m))}for(k=0;k<na.length;k++)if(f===na[k].Tg&&(!na[k].Ga||oa(na[k].Ga,na[k].Mg?g:h,void 0,!0))){e=na[k].Wg;if(void 0==e){g=null;break a}g=na[k].parameters?oa(na[k].parameters,na[k].Mg?g:h,void 0,!0):null;h=ta(e);k=new z(h,null,null);
h.he?h.he(k,g):k.g=g;g=k;break a}throw"unknown AESL block "+f;}g&&xa(c,g,null,b,!0)}return c}
var Qb=function(){var a=null;return function(b,c,d){null===a&&(a=document.createElement("a"),document.body.appendChild(a),a.style.display="none");d=d||"application/xml";if("function"===typeof window.Blob&&window.URL){var e=new window.Blob([b],{type:d});e=window.URL.createObjectURL(e)}else e="data:"+d+";base64,"+window.btoa(b);var f=a;d=d||"application/xml";"function"===typeof window.Blob&&window.URL?(b=new window.Blob([b],{type:d}),b=window.URL.createObjectURL(b)):b="data:"+d+";base64,"+window.btoa(b);
f.href=b;f.download=c||"untitled.xml";a.click();"string"!==typeof e&&window.URL.revokeObjectURL(e)}}();function bf(){this.vb=document.getElementById("editor");this.vb.value="";this.b=this.vb.parentElement;var a=window.innerWidth,b=window.getComputedStyle(this.vb);this.vb.style.width=a-10-parseInt(b.paddingLeft,10)-parseInt(b.paddingRight,10)+"px";this.vb.style.border="0px";this.vb.style.outline="none";this.vb.style.resize="none";this.vb.style.whiteSpace="pre";this.vb.setAttribute("wrap","off");this.h=null}bf.prototype.pf=function(a,b){this.vb.setSelectionRange(a,b)};
bf.prototype.resize=function(){var a=this.b.getBoundingClientRect().width,b=window.getComputedStyle(this.vb);this.vb.style.width=a-10-parseInt(b.paddingLeft,10)-parseInt(b.paddingRight,10)+"px"};function cf(a,b){a.vb.value=b;window.getComputedStyle(a.vb)};function df(a,b,c){this.fa=b;this.language=c||"aseba";this.b="";this.Nc=!0;this.gd=this.ce=this.Zf=null;this.Eb=!1;this.ia=a.ia||new Fa;this.gc=new bf;this.gc.vb.readOnly=this.Nc;this.gc.h=function(a){window.vplBreakpointsFunction&&window.vplBreakpointsFunction(a)};var d=this;this.Ha=new Kb(a.hb,{da:a.da});document.getElementById("editor").addEventListener("input",function(){Yb(a);ef(d)===a.i.fa&&(a.i.fa=!a.i.fa,Mb(a))},!1);var e=document.getElementById("editor");e&&document.getElementById("editor").addEventListener("keydown",
function(a){if(9===a.keyCode){a.preventDefault();a.b=!0;a=e.value;var b=this.selectionStart;a=a.slice(0,b)+"\t"+a.slice(this.selectionEnd);cf(d.gc,a);this.selectionStart=this.selectionEnd=b+1;return!1}return!0},!1)}function ff(a,b){a.Zf=b}w=df.prototype;w.ke=function(){this.ia.b=[]};function Vb(a,b,c){null===b?cf(a.gc,a.b):(a.b=b,cf(a.gc,b));c||(a.gd=null)}w.ac=function(){return document.getElementById("editor").value.replace(/\s+$/,"")};function ef(a){return a.ac()===a.b.trim()}
w.pf=function(a,b){this.gc.pf(a,b)};function gf(a){var b=F(a.Ha.da,{tag:"button",W:["src","top"]});b.height=a.Ha.w.c;a=F(a.Ha.da,{tag:"toolbar",W:["src","top"]});a.height=b.ra();return{height:a.height,ra:a.ra()}}function Ye(a,b,c,d,e){var f=new mc(a.I.Ha);Ac(f,a,b,["src","top"],a.I.Sd||sc,a.I.re||xc);oc(f,c,e,d);return f}
function Yb(a){var b=a.I;b.Ha.$a=[];var c=b.Vf||a.Oa,d=Cc(a,c,["src","top"]),e=gf(b).height,f=$c(b.Ha);Zc(b.Ha);var g=F(b.Ha.da,{tag:"view",W:["src"]});F(b.Ha.da,{tag:"button",W:["src","top"]});var h=F(b.Ha.da,{tag:"separator",W:["src","top"]}),k=F(b.Ha.da,{tag:"toolbar",W:["src","top"]});g.sc(f.width);g.fc(f.height);g.setPosition(0,0);k.sc(g.width);k.height=e;k.setPosition(g.x,g.y);D(b.Ha,function(a){g.H(a)});pc(Ye(a,c,k,h,d),k,d);B(b.Ha)}
function Tb(a,b){(a.Nc=b)&&cf(a.gc,a.b);a.gc.vb.readOnly=b;Yb(window.vplApp)}
w.resize=function(a,b){this.Ha.resize(a,b);a=this.Ha.b.getBoundingClientRect();b=document.getElementById("src-editor");var c=$c(this.Ha);var d=F(this.Ha.da,{tag:"view",W:["src"]});d.sc(c.width);d.fc(c.height);d.setPosition(0,0);var e=gf(this);c=d.x;var f=d.y+e.ra;var g=d.width;d=d.height-e.ra;b.style.left=a.left+a.width*this.Ha.va.X+c+"px";b.style.width=g+"px";b.style.top=a.top+a.height*this.Ha.va.Y+f+"px";b.style.height=d+"px";this.gc.resize();Yb(window.vplApp)};
w.focus=function(){document.getElementById("editor").focus();B(this.Ha)};function hf(a){a.L.add("src:close",{action:function(a){a.fb(["src"],{Xe:!0})},object:a,T:function(a){return 1<a.Ba.length&&0<=a.Ba.indexOf("src")}});a.L.add("src:new",{action:function(a){cf(a.I.gc,"");B(a.I.Ha)},isEnabled:function(a){return!a.I.Nc&&0<a.I.ac().length},object:a});a.L.add("src:save",{action:function(a){var b=db(a.i,{Zc:!1,bd:!0});Qb(b,a.i.filename||"program.vpl3","application/x-vpl3")},isEnabled:function(a){return 0<a.I.ac().length},object:a});a.L.add("src:vpl",{action:function(a){a.Ld?
a.fb(["vpl"],{Nd:!0}):a.fb(["vpl"],{Kd:"src"})},isEnabled:function(a){return ef(a.I)},object:a,T:function(a){return!a.I.fa&&0>a.Ba.indexOf("vpl")}});a.L.add("src:locked",{action:function(a){Tb(a.I,!a.I.Nc);B(a.I.Ha);a.I.Nc&&(a.i.fa=!1,Mb(a))},isEnabled:function(a){return null===a.I.gd},Ua:function(a){return a.I.Nc},object:a,T:function(a){return!a.I.fa},cb:[{selected:!1},{selected:!0}]});a.L.add("src:language",{action:function(a){var b=a.I.Zf();a.I.language=b.language;a.I.Nc&&Vb(a.I,b.code)},isEnabled:function(a){return null===
a.I.gd},getState:function(a){return a.I.language},object:a,T:function(a){return null!=a.I.Zf},cb:[{state:"aseba"},{state:"l2"},{state:"asm"},{state:"js"},{state:"python"}]});a.L.add("src:disass",{action:function(a){if(null!==a.I.gd)Vb(a.I,a.I.gd),a.I.gc.vb.readOnly=a.I.Nc;else{var b=a.I.ac(),d=a.I.ce(a.I.language,b);null!==d&&(Vb(a.I,d,!0),a.I.gc.vb.readOnly=!0,a.I.gd=b)}Yb(a)},isEnabled:function(a){return null!=a.I.ce&&null!==a.I.ce(a.I.language,"")},Ua:function(a){return null!==a.I.gd},object:a,
T:function(a){return null!==a.I.ce},cb:[{selected:!1},{selected:!0}]});a.L.add("src:run",{action:function(a){var b=a.I.ac();a.Ma[a.ya].eb.Zb(b,a.I.language)},isEnabled:function(a){return a.Ma[a.ya].eb.isEnabled(a.I.language)},getState:function(a){return 0===a.I.ac().length?"empty":"canLoad"},object:a,T:function(a){return 0<=a.ya},cb:[{selected:!1},{selected:!0},{state:"empty"},{state:"running"},{state:"error"},{state:"canLoad"},{state:"canReload"}]});a.L.add("src:stop",{action:function(a){ac(a)},
isEnabled:function(a){return bc(a)},object:a,T:function(a){return 0<=a.ya}});a.L.add("src:connected",{isEnabled:function(a){return!a.i.fa&&0<=a.ya&&a.Ma[a.ya].eb.isConnected()},object:a,T:function(a){return 0<a.Ma.length},cb:[{selected:!1},{selected:!0},{selected:!1,state:"monitored"},{selected:!0,state:"monitored"},{selected:!1,state:"nonmonitored"},{selected:!0,state:"nonmonitored"}]});a.L.add("src:sim",{action:function(a){a.Ld?a.fb(["sim"],{Nd:!0}):a.fb(["sim"],{Kd:"src"})},object:a,T:function(a){return null!=
a.Ma.find(function(a){return"sim"===a.name})&&null!=a.G&&0>a.Ba.indexOf("sim")}});a.L.add("src:teacher-reset",{action:function(a){a.I.ke();Yb(a)},object:a,Pc:!0,T:function(a){return a.I.Eb&&a.I.ia.Wb}});a.L.add("src:teacher",{action:function(a){a.I.ia.Wb=!a.I.ia.Wb;Yb(a)},Ua:function(a){return a.I.ia.Wb},object:a,Pc:!0,T:function(a){return a.I.Eb},cb:[{selected:!1},{selected:!0}]})};function jf(a){var b=["vpl:message-error","vpl:message-warning","vpl:filename"];return function(c,d,e,f,g,h,k,m,q,n){function t(a){if(void 0==a)return!0;for(var b=0;b<a.length;b++)switch(a[b]){case "pressed":if(!q||!k)return!1;break;case "unpressed":if(q&&k)return!1;break;case "selected":if(!m)return!1;break;case "unselected":if(m)return!1;break;case "disabled":if(k)return!1;break;case "enabled":if(!k)return!1;break;default:if("="===a[b][0]&&(n||"").toString()!==a[b].slice(1))return!1}return!0}var l=
F(f,{tag:"button",W:g,id:c.replace(/:/g,"-")});if(a.buttons)for(var u=0;u<a.buttons.length;u++)if(a.buttons[u].name===c&&t(a.buttons[u].state)){var p=a.buttons[u];p.draw.forEach(function(b){if(b.uri){var c=fc(b.uri);d.save();b.alpha&&(d.globalAlpha=b.alpha);var e={};p.styles&&p.styles.forEach(function(a){e[(a.complement?"!":"")+a.id]=a.st});a.ub[c.Ic].H(d,{Id:c.id,style:e});b.debug&&(d.fillStyle="black",d.textAlign="center",d.textBaseline="middle",d.fillText(b.debug,l.width/2,l.height/2));d.restore()}b.js&&
(c={pressed:q&&k,unpressed:!(q&&k),selected:m,unselected:!m,disabled:!k,enabled:k,state:n},b=new Function("ctx","$",b.js),d.save(),d.scale(l.width/1E3,l.height/1E3),d.beginPath(),b(d,c),d.restore())});return}0<=b.indexOf(c)?sc(c,d,e,f,g,h,k,m,q,n):(d.fillStyle="brown",d.fillRect(0,0,l.width,l.height),d.fillStyle="white",d.textAlign="left",d.textBaseline="top",d.font=Math.round(l.height/6).toString(10)+"px sans-serif",d.fillText(c,.02*l.width,.02*l.height),d.fillText((q?"pr ":"")+(m?"sel ":"")+(k?
"":"dis"),.02*l.width,.22*l.height),n&&d.fillText("="+n,.02*l.width,.42*l.height))}}function kf(a){return function(b,c){if(a.buttons)for(var d=0;d<a.buttons.length;d++){var e=a.buttons[d];if(e.name===b&&(void 0==e.state||0>e.state.indexOf("pressed")&&0>e.state.indexOf("selected")&&0>e.state.indexOf("disabled")))return b=fc(e.draw[0].uri),De(a.ub[b.Ic],b.id)}return{X:0,oa:c.c,Y:0,la:c.c}}}
function lf(a){function b(b){for(var c=0;c<a.widgets.length;c++)if(a.widgets[c].name===b)return a.widgets[c];return null}if(void 0==a.widgets)return{};var c={};["vpl:then","vpl:error","vpl:warning","vpl:moreHigh","vpl:moreLow"].forEach(function(d){var e=b(d);if(e){var f=fc(e.draw[0].uri),g=De(a.ub[f.Ic],f.id);c[d]=function(b,c,d,f){e.draw.forEach(function(c){if(c.uri){var d=fc(c.uri);c.alpha&&(b.globalAlpha=c.alpha);b.save();var e=Math.min(f.width/(g.oa-g.X),f.height/(g.la-g.Y));b.scale(e,e);b.translate(-(g.X+
g.oa)/2,-(g.Y+g.la)/2);a.ub[d.Ic].H(b,{Id:d.id});b.restore();c.debug&&(b.fillStyle="black",b.textAlign="center",b.textBaseline="middle",b.fillText(c.debug,0,0))}c.js&&(c=new Function("ctx",c.js),b.save(),b.scale(f.width,f.height),b.beginPath(),c(b),b.restore())})}}});return c};function mf(a){this.v=a&&a.Zb?a.Zb:null;this.m=a&&a.Lc?a.Lc:null;this.o=a&&a.isConnected?a.isConnected:null;this.b=a&&a.isEnabled?a.isEnabled:null;this.h=a&&a.getName?a.getName:null;this.yd=a&&a.yd?a.yd:"aseba";this.languages=a&&a.languages?a.languages:[this.yd];this.state=a&&a.state?a.state:null}w=mf.prototype;w.isConnected=function(){return null==this.o||this.o()};w.isEnabled=function(a){return null!=this.v&&0<=this.languages.indexOf(a)&&(null==this.b||this.b(a))};
w.getName=function(){return null!=this.h?this.h():null};w.Lc=function(a){this.m&&this.m(a)};w.Zb=function(a,b){this.isEnabled(b)&&this.v(b,a)};function Ob(a,b,c){function d(a,b,c){var d=document.createElement("div");d.style.position="absolute";d.style.width="32px";d.style.height="32px";d.style.top="0";b?(d.style.right=g.toString(10)+"px",g+=40):(d.style.left=f.toString(10)+"px",f+=40);d.textContent=a;d.style.font="bold 30px sans-serif";d.style.textAlign="left";d.style.padding="5px";d.style.paddingLeft="10px";d.addEventListener("click",function(){c()},!1);e.m.push(d)}this.o=a;this.h=document.createElement("div");this.h.style.width="100%";
this.h.style.height="100%";this.h.style.position="fixed";this.h.style.top="0";this.h.style.left="0";this.h.style.zIndex="1000";this.h.style.backgroundColor="rgba(1,1,1,0.5)";this.h.style.display="none";this.b=document.createElement("div");this.b.style.width="80%";this.b.style.height="80%";this.b.style.position="fixed";this.b.style.top="50%";this.b.style.left="50%";this.b.style.backgroundColor="white";this.b.style.padding="2em";this.h.appendChild(this.b);document.body.appendChild(this.h);this.m=[];
var e=this,f=0,g=0;b||d("\u00d7",!1,function(){e.Bc()});c&&c.forEach(function(a){d(a.title,!0,a.za)})}Ob.prototype.show=function(){this.b.innerHTML=this.o;this.m.forEach(function(a){this.b.appendChild(a)},this);this.h.style.display="block";$b(this)};Ob.prototype.Bc=function(){this.h.style.display="none"};function $b(a){var b=a.b.getBoundingClientRect();a.b.style.marginLeft=-b.width/2+"px";a.b.style.marginTop=-b.height/2+"px"};function hc(a,b,c){try{eb(a.i,b,function(a){if(0>this.Ba.indexOf(a))if(1===this.Ba.length)this.fb([a]);else{var b=this.Ba.slice();b[0<=b.indexOf("vpl")?b.indexOf("vpl"):0<=b.indexOf("src")?b.indexOf("src"):0]=a;this.fb(b)}0<=this.Ba.indexOf("vpl")&&this.ca.qa()},c)}catch(d){}}function nf(a){return(a=/^[^.]+\.(.*)$/.exec(a))?a[1].toLowerCase():""}
function jc(a,b){var c=nf(b.name),d=new window.FileReader;switch(c){case "aesl":case "vpl3":case "vpl3ui":case "json":return d.onload=function(d){d=d.target.result;var e=b.name;"<"===d.trim()[0]?$e(a.i,d):hc(a,d,{mg:"vpl3ui"===c});a.i.filename=e;a.ca.qa()},d.readAsText(b),!0}return!1}
function of(a,b){var c=/^[^.]+\.(.*)$/.exec(b.name);c=c?c[1]:"";var d=new window.FileReader;switch(c.toLowerCase()){case "svg":case "png":case "jpg":case "gif":return a.G&&("obstacle"===a.G.mc?(d.onload=function(b){pf(a,b.target.result)},d.readAsText(b)):(d.onload=function(b){b=b.target.result;var c=new Image;c.addEventListener("load",function(){qf(a,c)});c.src=b},d.readAsDataURL(b))),!0}return!1}
function rf(a,b){var c=/^[^.]+\.(.*)$/.exec(b.name);c=c?c[1]:"";var d=new window.FileReader;switch(c.toLowerCase()){case "wav":a.G&&(d.onload=function(c){a.G.Z.setFile(b.name,c.target.result)},d.readAsArrayBuffer(b))}};function sf(a){var b=this;this.b=document.createElement("div");this.b.style.width="100%";this.b.style.height="100%";this.b.style.position="fixed";this.b.style.top="0";this.b.style.left="0";this.b.style.zIndex="1000";this.b.style.backgroundColor="rgba(1,1,1,0.5)";this.b.style.display="none";this.h=document.createElement("div");this.h.style.width="40em";this.h.style.position="fixed";this.h.style.top="50%";this.h.style.left="50%";this.h.style.backgroundColor="white";this.h.style.padding="2em";this.b.appendChild(this.h);
document.body.appendChild(this.b);var c=document.createElement("p");this.v=c;this.h.appendChild(c);c=document.createElement("table");c.style.width="100%";this.h.appendChild(c);var d=document.createElement("tr");c.appendChild(d);var e=document.createElement("td");d.appendChild(e);this.input=document.createElement("input");this.input.setAttribute("type","file");this.input.style.width="35em";e.appendChild(this.input);e=document.createElement("td");e.align="right";d.appendChild(e);d=document.createElement("input");
d.setAttribute("type","button");d.setAttribute("value",a.h.translate("OK"));d.addEventListener("click",function(){var a=b.input.files[0];a&&b.m(a);b.Bc()},!1);e.appendChild(d);e.appendChild(document.createTextNode("\u00a0\u00a0"));d=document.createElement("input");d.setAttribute("type","button");d.setAttribute("value",a.h.translate("Cancel"));d.addEventListener("click",function(){b.Bc()},!1);e.appendChild(d);e=document.createElement("div");e.style.position="absolute";e.style.width="32px";e.style.height=
"32px";e.style.top="0";e.style.left="0";e.textContent="\u00d7";e.style.font="bold 30px sans-serif";e.style.textAlign="left";e.style.padding="5px";e.style.paddingLeft="10px";e.addEventListener("click",function(){b.Bc()},!1);c.appendChild(e);this.o=a.h;this.m=null}
sf.prototype.show=function(a,b,c){this.v.textContent=this.o.translate(a);this.input.setAttribute("accept",b);this.m=c;this.b.style.display="block";a=this.h.getBoundingClientRect();this.h.style.marginLeft=-a.width/2+"px";this.h.style.marginTop=-a.height/2+"px"};sf.prototype.Bc=function(){this.b.style.display="none"};function tf(a,b,c){this.b=a;this.v=b;this.h=null;this.o=!1;this.m=c;var d=this;setInterval(function(){null!=d.h&&2<=d.h.readyState&&(!1!==d.b.Me&&(d.b.Me=!1,Mb(d.b)),d.connect())},5E3)}
tf.prototype.connect=function(){var a=this;this.h=new WebSocket(this.v);this.h.addEventListener("open",function(){a.b.Me=!0;a.h.send(JSON.stringify({sender:{type:"vpl",sessionid:a.m,role:a.b.i.Eb?"teacher":"student"},type:"hello"}));window.addEventListener("unload",function(){a.h.send(JSON.stringify({sender:{type:"vpl",sessionid:a.m,role:a.b.i.Eb?"teacher":"student"},type:"bye"}))});Mb(a.b)});this.h.addEventListener("message",function(b){try{var c=JSON.parse(b.data);switch(c.type){case "cmd":var d=
c.data.cmd,e=c.data.selected,f=c.data.state,g=a.b.L;if(g.T(d)&&Cb(g,d)&&g.isEnabled(d))if(void 0!==e){var h=g.find(d),k;if(k=h)h.h?e===h.Ua()?k=!0:(Eb(h,void 0),k=e===h.Ua()):k=!1;k&&Db(g,d)}else if(void 0!==f){var m=g.find(d);m&&Fb(m,f)&&Db(g,d)}else{var q=g.find(d);q&&(Eb(q,void 0),Db(g,d))}Qd(a.b.ca);break;case "file":var n=c.data.content;switch(c.data.kind){case "vpl":var t=nf(c.data.name||"");/^[\s]*{/.test(n)?hc(a.b,n,{mg:"vpl3ui"===t}):($e(a.b.i,n),a.b.ca.qa());a.b.i.filename=c.data.name||
null;Qd(a.b.ca);break;case "about":Nb(a.b,n);break;case "help":Pb(a.b,n);break;case "suspend":var l=a.b,u=l.tc;u&&l.Rd&&l.Rd.Bc();l.Rd=n?new Ob(n,!0):null;n&&u&&l.Rd.show()}}}catch(p){console.info(p)}});this.o||(cc(this.b,function(b){a.log(b)}),this.o=!0)};
tf.prototype.log=function(a){try{if("cmd"===a.type&&a.data&&0<=["vpl:run"].indexOf(a.data.cmd)){var b=db(this.b.i,{Zc:!1,bd:!0});this.h.send(JSON.stringify({sender:{type:"vpl",sessionid:this.m},type:"file",data:{name:this.b.i.filename,content:b}}))}this.h.send(JSON.stringify({sender:{type:"vpl",sessionid:this.m},type:"log",data:a||null}))}catch(c){}};var Hd=null;document.addEventListener("mousemove",function(a){null!==Hd&&(Hd(a,!1,!1),a.preventDefault())},!1);document.addEventListener("mouseup",function(a){null!==Hd&&(Hd(a,!0,!1),Hd=null,a.preventDefault())},!1);var Nd=null;document.addEventListener("touchmove",function(a){a.preventDefault();null!==Hd&&(Nd=a.targetTouches[0],Hd(Nd,!1,!0));return!1},{capture:!1,passive:!1});document.addEventListener("touchend",function(a){null!==Hd&&(Hd(Nd,!0,!0),Hd=null,a.preventDefault());return!1},!1);
function uf(a,b,c,d,e){var f=0<=a.indexOf("/")?a.replace(/\/[^/]*$/,"/"):"",g={},h=new XMLHttpRequest;h.addEventListener("load",function(){if(200===h.status){g[a]=h.responseText;var b=JSON.parse(h.responseText),m=c(b),q=m.length,n=!1;m.forEach(function(c){var h=new XMLHttpRequest;h.addEventListener("load",function(){200===h.status?(g[c]=h.responseText,q--,n||0!==q||d(b,g)):n||(n=!0,e("HTTP error "+h.status))});h.addEventListener("error",function(){n||(n=!0,e("XMLHttpRequest error for "+a))});h.open("GET",
f+c);h.send()})}else e("HTTP error "+h.status)});h.addEventListener("error",e);h.open("GET",a);h.send()}
function vf(a,b,c,d,e){try{var f=document.getElementById(a).textContent,g=JSON.parse(f),h={};g.svgFilenames&&g.svgFilenames.forEach(function(a){f=document.getElementById(a).textContent;h[a]=f});g.overlays&&g.overlays.forEach(function(a){f=document.getElementById(a).textContent;h[a]=f});g.css&&g.css.forEach(function(a){f=document.getElementById(a).textContent.trim();h[a]=f});d(g,h)}catch(k){e(k)}}
function wf(a){var b=/^[^?]*\?([^#]*)/.exec(document.location.href);if(b=b&&b[1]){b=b.split("&").map(function(a){return a.split("=").map(function(a){return decodeURIComponent(a)})});for(var c=0;c<b.length;c++)if(b[c][0]===a)return b[c][1]}return""}function xf(a){return(document.location.hash||"#").slice(1).split("&").map(function(a){return a.split("=").map(decodeURIComponent)}).reduce(function(a,c){a[c[0]]=c[1];return a},{})[a]||null}
function yf(a,b){var c=[];a&&a.overlays&&a.overlays.forEach(function(b){try{var d=JSON.parse(a.Ke[b])}catch(pa){console.error(pa.message)}for(var e in d)if(d.hasOwnProperty(e))switch(e){case "blocks":case "aeslImportRules":case "buttons":case "widgets":a[e]=a[e]?a[e].concat(d[e]):d[e];break;case "toolbars":for(var f in d[e])d[e].hasOwnProperty(f)&&(a[e]=a[e]||{},a[e][f]=d[e][f]);break;case "i18n":for(f in d[e])if(d[e].hasOwnProperty(f)){a[e]=a[e]||{};a[e][f]=a[e][f]||{};for(var g in d[e][f])d[e][f].hasOwnProperty(g)&&
(a[e][f][g]=d[e][f][g])}break;case "help":c.push(d[e])}});var d=document.getElementById("programCanvas"),e=wf("role"),f=new Hb(d);f.Sc=void 0==window.vplSimMaps?"ground,height,obstacles":"merged"===window.vplSimMaps?null:window.vplSimMaps.split(",");window.vplApp=f;f.username=wf("user")||window.vplUsername||f.username;a&&ec&&(f.i.message=ec(a),f.i.message&&window.console.info(f.i.message));a&&a.css&&(a.css.forEach(function(b){fd(f.da,b,a.Ke[b])}),f.da.defineProperties());if(a&&a.i18n)for(var g in a.i18n)a.i18n.hasOwnProperty(g)&&
Ja(f.h,g,a.i18n[g]);d=wf("uilanguage")||"en";f.h.language=d;f.Ge=new sf(f);var h=void 0==a||a["hardcoded-gui"]||"classic"===wf("appearance");f.$f="local"===wf("storage");f.Ld="false"!==wf("multiview");var k=wf("language");Ed="true"===wf("cssdebug");var m=sc,q=xc,n=Ec;if(a){if(h)null!==a.blocks&&0<a.blocks.length&&(a.blocks||[]).forEach(function(a){var b=ta(a.name);qe(a,b.Jb);a.typicalParamSet&&(b.se=a.typicalParamSet)});else if(null!==a.buttons&&0<a.buttons.length&&(m=jf(a),q=kf(a)),null!==a.widgets&&
0<a.widgets.length&&(n=lf(a)),null!==a.blocks&&0<a.blocks.length)try{Re(a)}catch(Wa){window.console&&window.console.error(Wa)}a.aeslImportRules&&0<a.aeslImportRules.length&&(na=a.aeslImportRules.map(function(a){return{Tg:a.aeslName,Ga:a.condition||null,Wg:a.blockName,parameters:a.parameters||null,Mg:a.stringParam||!1}}));a.miscSettings&&void 0!=a.miscSettings.advancedModeEnabled&&(Ta=1==a.miscSettings.advancedModeEnabled);a.miscSettings&&void 0!=a.miscSettings.basicMultiEvent&&(Qa=1==a.miscSettings.basicMultiEvent);
a.miscSettings&&void 0!=a.miscSettings.advancedMultiEvent&&(Sa=1==a.miscSettings.advancedMultiEvent);a.miscSettings&&a.miscSettings.viewRelativeSizes&&(d=a.miscSettings.viewRelativeSizes,f.kc={vpl:d.vpl||1,src:d.src||1,sim:d.sim||1})}d=wf("server");g=wf("session");var t="true"===wf("adv"),l="true"===wf("exp");Ta="true"===wf("advmode");var u=0,p=0,v="",x=wf("blur").trim()||"";/^\d+$/.test(x)&&(u=parseInt(x,10)/10);x=wf("grayscale")||"";/^\d+$/.test(x)&&(p=parseInt(x,10)/100);if(0<u||0<p)v="blur("+
u.toFixed(1)+"px) grayscale("+p.toFixed(2)+")";u=1;p=0;x=!1;var K=null;x=wf("scale").trim()||"";/^\d+(\.\d*)?$/.test(x)&&(u=parseFloat(x));x=wf("rotation").trim()||"";/^-?\d+(\.\d*)?$/.test(x)&&(p=parseFloat(x)*Math.PI/180);x=wf("mirror").trim()||"";x="true"===x;if(1!==u||0!==p||x)K=[u*Math.cos(p)*(x?-1:1),u*Math.sin(p)*(x?-1:1),-u*Math.sin(p),u*Math.cos(p),0,0];k||(k=0<=f.ya?f.Ma[f.ya].eb.yd:"aseba");Ua();Za(f.i,!0);f.i.ke();u=wf("view");x=0===u.length?["vpl"]:u.split("+");p=wf("robot");if(0<=x.indexOf("sim")||
"sim"===p)p="sim";p.replace(/[+;]/g,",").split(",").forEach(function(a){var b=null;switch(a){case "thymio":b=zf(f);b.Lc(k);break;case "thymio-tdm":b=Af(f);b.Lc(k);break;case "thymio-jws":b=Bf(f);b.Lc(k);break;case "sim":b=Cf(f,{jg:v,kg:K}),b.Lc(k)}b&&f.Ma.push({name:a,eb:b})});f.ya=0<f.Ma.length?0:-1;if(!qa[k])throw"Unsupported language "+k;Ga(f.ia,t?[]:["src:language"]);f.i.Cb=k;f.ca.ga=n;f.i.i.push(new va);null!=f.b&&(f.b.ga=n);gc(f);!h&&a&&a.toolbars&&(a.toolbars.vpl&&(f.ga=a.toolbars.vpl),a.toolbars.vpl2&&
(f.M=a.toolbars.vpl2));f.i.Sd=m;f.i.re=q;df&&document.getElementById("editor")&&(f.I=new df(f,f.i.fa,k),Od(f.I.Ha,v),f.i.o=function(){return ef(f.I)?null:f.I.ac()},f.i.v=function(a){Vb(f.I,a)},f.I.Ha.ga=n,hf(f),!h&&a&&a.toolbars&&a.toolbars.editor&&(f.I.Vf=a.toolbars.editor),f.I.Sd=m,f.I.re=q,f.I.Eb="teacher"===e);null!=f.G&&(Df(f),!h&&a&&a.toolbars&&a.toolbars.simulator&&(f.G.Vf=a.toolbars.simulator),f.G.Sd=m,f.G.re=q);v&&Od(f.ca,v);Pd(f.ca,K);document.getElementsByTagName("body")[0].addEventListener("dragover",
function(a){a.stopPropagation();a.preventDefault();a.dataTransfer.dropEffect="copy"},!1);document.getElementsByTagName("body")[0].addEventListener("drop",function(a){a.stopPropagation();a.preventDefault();a=a.dataTransfer.files;1===a.length&&(a=a[0],jc(f,a)||of(f,a)||rf(f,a))},!1);if(f.G){f.G.ia=f.ia;var r=new Image;r.addEventListener("load",function(){f.G.Ye=r});r.src="data:image/svg+xml;base64,"+btoa('<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="297mm" height="210mm" viewBox="0 0 1052 744" version="1.1"><defs><linearGradient id="gradient" x1="-1000" y1="0" x2="-800" y2="0" gradientUnits="userSpaceOnUse"><stop style="stop-color:#000;stop-opacity:1;" offset="0" /><stop style="stop-color:#000;stop-opacity:0;" offset="1" /></linearGradient></defs><g transform="translate(0,-308)"><rect style="fill:url(#gradient);stroke:none" width="319" height="687" x="-1027" y="336" transform="scale(-1,1)" /><path style="fill:none;stroke:#000;stroke-width:30;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none" d="M 114,592 C 102,417 750,306 778,532 806,757 674,675 559,622 444,568 259,567 278,664 296,762 726,730 778,808 829,887 725,955 616,936 507,917 144,1083 129,837 Z" /></g></svg>');
var J=new Image;J.addEventListener("load",function(){f.G.Ze=J});J.src="data:image/svg+xml;base64,"+btoa('<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" width="297mm" height="210mm" viewBox="0 0 1052 744" version="1.1"><defs><radialGradient id="gradient" cx="400" cy="650" fx="400" fy="650" r="230" gradientTransform="matrix(1.6,0,0,1.16,-113,-75)" gradientUnits="userSpaceOnUse"><stop style="stop-color:#000;stop-opacity:1;" offset="0" /><stop style="stop-color:#000;stop-opacity:0;" offset="1" /></radialGradient></defs><g transform="translate(0,-308)"><rect style="fill:url(#gradient);fill-opacity:1;stroke:none" width="939" height="650" x="54" y="357" /></g></svg>');
f.G.$e='<?xml version="1.0" encoding="UTF-8"?><svg xmlns="http://www.w3.org/2000/svg" width="297mm" height="210mm" viewBox="0 0 1052 744" version="1.1"><g transform="translate(0,-308)"><path style="fill:none;stroke:#000;stroke-width:6;stroke-linecap:butt;stroke-linejoin:miter" d="M 172,928 137,420 763,371 905,688 708,981 Z" /><path style="fill:none;stroke:#949494;stroke-width:6;stroke-linecap:butt;stroke-linejoin:miter" d="m 402,754 168,91 101,-142" /><circle style="fill:none;stroke:#000;stroke-width:6" cx="531" cy="550" r="59" /></g></svg>'}if(window.vplStorageGetFunction)window.vplStorageGetFunction("program.vpl3",
function(a,b){try{a&&(eb(f.i,a,function(){Mb(f)}),f.i.filename=b&&b.filename||"program.vpl3",f.i.readOnly=void 0!=b&&1==b.readOnly,void 0!=b&&1==b.customizationMode&&(f.ia.xb=!0,f.ia.Wb="t"===e))}catch(N){}});else if(f.$f)try{var P=window.localStorage.getItem("program.vpl3");P&&eb(f.i,P,function(){Mb(f)})}catch(Wa){}"text"===wf("view")?f.fb(["src"],{fa:!0}):(f.fb(["vpl"]),f.i.qg=l,f.i.Eb="teacher"===e?"t":"teacher1"===e?"custb":Na,Mb(f),f.I&&(document.getElementById("editor").textContent=f.i.ac(f.i.Cb)));
var T=["aseba","l2","asm","js","python"];f.I&&0<=T.indexOf(k)&&ff(f.I,function(){k=T[(T.indexOf(k)+1)%T.length];f.i.Cb=k;var a=f.i.ac(k);return{language:k,code:a}});if(t&&f.I){var za=new ub(vb);f.I.ce=function(a,b){try{switch(a){case "aseba":var c=new wb(za,b);c.ga=xb;var d=yb(c);return Ef(b,d,c.Vb);case "l2":return c=new Ff(za,b),c.ga=Gf,d=yb(c),Ef(b,d,c.Vb);case "asm":return d=Hf(new If(za,b)),zb(d);default:return null}}catch(O){return"; "+O}}}a&&a.fragments&&a.fragments["about.html"]&&Nb(f,a.fragments["about.html"].replace(/UIROOT/g,
b));a&&a.fragments&&a.fragments["help.html"]&&Pb(f,a.fragments["help.html"].replace(/UIROOT/g,b));if(a&&a.help||0<c.length)f.v=new Ka,a&&a.help&&f.v.add(a.help),c.forEach(function(a){f.v.add(a)}),Rb(f);a&&a.fragments&&a.fragments["vpl-export-html.css"]&&(f.R=a.fragments["vpl-export-html.css"]);Xb(f);Qd(f.ca);window.addEventListener("resize",function(){Xb(f)},!1);f.G&&(f.G.Eb="teacher"===e);if("text"===u)f.fb(["src"],{fa:!0});else{b=["vpl","src","sim"];if(1>x.length||3<x.length||""===u)u="vpl";else for(P=
0;P<x.length;P++){if(0>!b.indexOf(x[P])){u="vpl";break}for(h=0;h<P;h++)if(x[P]===x[h]){u="vpl";break}}f.fb(x)}Xb(f);d&&(window.vplCommandServer=new tf(f,d,g),window.vplCommandServer.connect())}
window.addEventListener("load",function(){var a=wf("ui")||"ui.json",b=null!=document.getElementById(a),c=window.vplUIRoot?window.vplUIRoot:b?".":0<=a.indexOf("/")?a.replace(/\/[^/]*$/,""):".";(b?vf:uf)(a,c,function(a){return(a.svgFilenames||[]).concat(a.overlays||[]).concat(a.css||[])},function(a,b){a.Ke={};a.ub={};a.svgFilenames&&a.svgFilenames.forEach(function(c){a.Ke[c]=b[c];a.ub[c]=new Ee(b[c])});a.overlays&&a.overlays.forEach(function(c){a.Ke[c]=b[c]});a.css&&a.css.forEach(function(c){a.Ke[c]=
b[c]});yf(a,c)},function(a){window.console&&window.console.error(a);yf()})},!1);window.vplIsProgramChanged=function(){return 0<window.vplApp.i.Tc.hc.length};window.vplGetProgramAsJSON=function(a){return db(window.vplApp.i,a?{Zc:!0,bd:!1}:void 0)};window.vplGetUIAsJSON=function(){return db(window.vplApp.i,{Zc:!0,bd:!1})};
window.addEventListener("unload",function(){var a=db(window.vplApp.i);try{window.vplStorageSetFunction?window.vplStorageSetFunction("program.vpl3",a):window.vplApp.$f&&window.localStorage.setItem("program.vpl3",a)}catch(b){}},!1);function Jf(){this.zd=1}Jf.prototype.reset=function(){};Jf.prototype.resetEventListeners=function(){};Jf.prototype.set=function(){};Jf.prototype.get=function(){return null};Jf.prototype.setClientState=function(){};Jf.prototype.getClientState=function(){return null};Jf.prototype.addEventListener=function(){};Jf.prototype.sendEvent=function(){};Jf.prototype.start=function(){this.sendEvent("init",null)};Jf.prototype.setTimer=function(){};Jf.prototype.getTimer=function(){return-1};
Jf.prototype.loadCode=function(){};Jf.prototype.shouldRunContinuously=function(){return!1};Jf.prototype.run=function(){};Jf.prototype.suspend=function(){};Jf.prototype.resume=function(){};function M(){this.zd=1;this.Oa={X:-Infinity,oa:Infinity,Y:-Infinity,la:Infinity};this.v=this.R=0;this.r=70;this.b=[0,0];this.h=0;this.gf=!1;this.files={};this.qb=120;this.kc=80;this.Wd=20;this.state={};this.ga={};this.hb=null;this.Dd={};this.o=[];this.Aa={};this.Vc=!1;this.M=null;M.prototype.reset.call(this,0);M.prototype.resetEventListeners.call(this)}M.prototype=Object.create(Jf.prototype);M.prototype.constructor=M;M.prototype.setPositionLimits=function(a,b,c,d){this.Oa={X:a,oa:b,Y:c,la:d}};
M.prototype.setFile=function(a,b){this.files[a]=b};
M.prototype.reset=function(a){this.v=this.R=a;this.b=[0,0];this.h=0;this.state={"button.center":!1,"button.left":!1,"button.right":!1,"button.forward":!1,"button.backward":!1,"prox.ground.delta":[1,1],"prox.horizontal":[0,0,0,0,0,0,0],acc:[0,0,1],"motor.left":0,"motor.right":0,"leds.top":[0,0,0],"leds.bottom.left":[0,0,0],"leds.bottom.right":[0,0,0],"leds.circle":[0,0,0,0,0,0,0,0],sound:{}};this.Vc=!1;var b=this;this.ga={"leds.circle":function(){b.Vc=!0},sound:function(a,d){function c(){if(!(g>=d.f.length)){b.M||
(b.M=new (window.AudioContext||window.webkitAudioContext));var a=b.M.createOscillator();a.type="sawtooth";a.frequency.value=d.f[g];var e=b.M.createGain();e.connect(b.M.destination);a.connect(e);a.start(0);var f=d.d[g]/50;e.gain.exponentialRampToValueAtTime(.01,b.M.currentTime+f);a.stop(b.M.currentTime+f);a.addEventListener("ended",c);g++}}if(d.hasOwnProperty("pcm")){if(a=b.files["P"+d.pcm+".wav"]){b.M||(b.M=new (window.AudioContext||window.webkitAudioContext));var f=b.M;f.decodeAudioData(a.slice(),
function(a){var b=f.createBufferSource();b.buffer=a;b.connect(f.destination);b.start(0)})}}else if(d.f){var g=0;c()}}};this.o=[];this.tc=!1};M.prototype.resetEventListeners=function(){this.Aa={}};M.prototype.enforcePositionLimits=function(){this.b=[Math.max(this.Oa.X,Math.min(this.Oa.oa,this.b[0])),Math.max(this.Oa.Y,Math.min(this.Oa.la,this.b[1]))]};M.prototype.setPosition=function(a,b){this.b=a;this.h=b;this.enforcePositionLimits();this.hb&&this.hb.call(this)};
M.prototype.set=function(a,b){this.state[a]=b;this.ga[a]&&this.ga[a](a,b)};M.prototype.get=function(a){return this.state[a]};M.prototype.setClientState=function(a,b){this.Dd[a]=b};M.prototype.getClientState=function(a){a=this.Dd[a];a instanceof Array&&(a=a.slice());return a};M.prototype.addEventListener=function(a,b){this.Aa[a]=b};M.prototype.sendEvent=function(a,b){this.Aa[a]&&this.Aa[a].call(this,a,b);for(var c in this.Aa)if(0===c.indexOf(a+"."))this.Aa[c](a,b)};
M.prototype.setTimer=function(a,b,c){this.o[a]={next:this.v-this.R+b,yg:c?b:-1}};M.prototype.getTimer=function(a){return void 0===this.o[a]||0>this.o[a].next?-1:this.R+this.o[a]-this.v};M.prototype.loadCode=function(a,b){if("js"!==a)throw"unsupported language "+a;(new Function(b)).call(this)};M.prototype.shouldRunContinuously=function(){if(this.tc)return!1;if(0!==this.get("motor.left")||0!==this.get("motor.right"))return!0;for(var a=0;a<this.o.length;a++)if(this.o[a]&&0<this.o[a].next)return!0;return!1};
function Kf(a,b){return a.gf?b*Math.sqrt(-2*Math.log(Math.random()))*Math.sin(2*Math.PI*Math.random()):0}
M.prototype.run=function(a,b){0===this.R&&this.reset(a);1!==this.zd&&(this.R-=(this.zd-1)*(a-this.v),this.v=this.zd*(this.v-a)+a);for(var c=Math.max(.01,(a-this.v)/10),d=this.b;!this.tc&&this.v<a;){c=Math.min(c,a-this.v);var e=(100*this.get("motor.left")+Kf(this,1))*c,f=(100*this.get("motor.right")+Kf(this,1))*c;if(0!==e||0!=f){if(1E-6>Math.abs(e-f)||Math.abs(e-f)<1E-4*(Math.abs(e)+Math.abs(f)))this.b=[this.b[0]+.5*(e+f)*Math.cos(this.h),this.b[1]+.5*(e+f)*Math.sin(this.h)];else{var g=(e+f)*this.r/
(e-f);e=(f-e)/(2*this.r);this.b=[this.b[0]+g*(Math.sin(this.h)-Math.sin(this.h+e)),this.b[1]-g*(Math.cos(this.h)-Math.cos(this.h+e))];this.h+=e}this.enforcePositionLimits();this.hb&&this.hb.call(this)}this.v+=c;this.sendEvent("prox",null);for(g=0;g<this.o.length;g++)this.o[g]&&0<this.o[g].next&&this.v>=this.R+this.o[g].next+Kf(this,.01)&&(this.o[g].next=0<=this.o[g].yg?this.o[g].next+this.o[g].yg:-1,this.sendEvent("timer"+g.toString(10),null))}b&&b("l",d.concat(this.b))};
M.prototype.suspend=function(){this.tc=!0};M.prototype.resume=function(a){this.tc&&(this.R+=a-this.v,this.v=a,this.tc=!1)};var Lf="shift left;shift right;add;sub;mult;div;mod;bitor;bitxor;bitand;eq;ne;gt;ge;lt;le;or;and".split(";");function Mf(a,b){function c(a){return 32784<=a?a-65536:a}function d(a){return 2048<=a?a-4096:a}var e=[],f=a[0];if(0<a.length){if(1!==f%2||f>a.length)throw"Bad event table";e.push({Ob:0,xd:a.slice(0,1),hf:-1,A:"dc "+a[0]})}for(var g=[],h=1;h<f;h+=2)g.push({id:a[h],Ob:a[h+1]}),e.push({Ob:h,xd:a.slice(h,h+2),hf:-1,A:"dc 0x"+a[h].toString(16)+", "+a[h+1]});for(h=f;h<a.length;h++){f={Ob:h,xd:a.slice(h,h+1),hf:a[h]>>>12};if(!b)for(var k=0;k<g.length;k++)if(g[k].Ob===h){f.id="onevent_"+g[k].id.toString(16);
break}k=a[h];switch(k>>>12){case 0:f.A="stop";break;case 1:f.A="push.s "+((k&4095)-(k&2048?4096:0));break;case 2:f.xd=a.slice(h,h+2);f.A="push "+c(a[++h]);break;case 3:f.A="load "+(k&4095);break;case 4:f.A="store "+(k&4095);break;case 5:f.xd=a.slice(h,h+2);f.A="load.ind "+(k&4095)+" size="+a[++h];break;case 6:f.xd=a.slice(h,h+2);f.A="store.ind "+(k&4095)+" size="+a[++h];break;case 7:case 8:switch(k){case 28672:f.A="neg";break;case 28673:f.A="abs";break;case 28674:f.A="bitnot";break;case 28675:f.A=
"not ; not implemented";break;case 32768:f.A="sl";break;case 32769:f.A="asr";break;case 32770:f.A="add";break;case 32771:f.A="sub";break;case 32772:f.A="mult";break;case 32773:f.A="div";break;case 32774:f.A="mod";break;case 32775:f.A="bitor";break;case 32776:f.A="bitxor";break;case 32777:f.A="bitand";break;case 32778:f.A="eq";break;case 32779:f.A="ne";break;case 32780:f.A="gt";break;case 32781:f.A="ge";break;case 32782:f.A="lt";break;case 32783:f.A="le";break;case 32784:f.A="or";break;case 32785:f.A=
"and";break;default:throw"Unknown instruction "+k.toString(16);}break;case 9:f.A="jump "+(h+d(k&4095));break;case 10:f.xd=a.slice(h,h+2);f.A=(k&256?k&512?"dont.":"do.":"")+"jump."+(k&256?"when":"if")+".not "+Lf[k&31]+" "+(h+c(a[h+1]));h++;break;case 11:f.A="emit id="+(k&4095)+" data="+c(a[h+1])+" count="+c(a[h+2]);h+=2;break;case 12:f.A="callnat "+(k&4095);break;case 13:f.A="callsub "+(k&4095);break;case 14:f.A="ret";break;default:throw"Unknown instruction "+k.toString(16);}e.push(f)}return e}
function zb(a,b){var c=Mf(a).map(function(c){var d=c.Ob.toString(10);d="    ".slice(d.length-1)+d;var f=c.xd.map(function(a){a=a.toString(16);return"000".slice(a.length-1)+a}).join(" ");f+="     ".slice(f.length-4);return(c.id?c.id+":\n":"")+(b?"    ":d+"  "+f+"  ")+c.A+(c.Ob===a[0]-2||0===c.hf||14===c.hf?"\n":"")}).join("\n");0===c.length&&(c="; empty");return c};function Ef(a,b,c){function d(a){var b=e[a].Ob.toString(10);b="    ".slice(b.length-1)+b;var c=e[a].xd.map(function(a){a=a.toString(16);return"000".slice(a.length-1)+a}).join(" ");c+="     ".slice(c.length-4);f+=(e[a].id?e[a].id+":\n":"")+b+"  "+c+"  "+e[a].A+"\n";e.splice(a,1)}var e=Mf(b,!0);a=a.split("\n");c=c.slice().sort(function(a,b){return a.Ob-b.Ob});c=[new Nf(-1,-1,-1,0)].concat(c).concat(new Nf(Infinity,Infinity,Infinity,b.length));var f="";for(b=0;b<a.length;b++){for(var g=!1,h=0;h<c.length-
1;)if(c[h].line<=b){for(var k=c[h].Ob;k<c[h+1].Ob;k++)for(var m=0;m<e.length;)e[m].Ob===k?(!g&&0<b&&(f+="\n"),g=!0,d(m)):m++;c.splice(h,1)}else h++;g&&(f+="\n");f+=a[b]+"\n"}for(m=0;m<e.length;)d(m);return f};function ub(a){this.name=a.name;this.b=a.maxVarSize;this.Xa=[];for(var b=this.Na=0;b<a.variables.length;b++)this.Xa.push(new Of(a.variables[b].name,a.variables[b].size,[1],this.Na,Pf)),this.Na+=a.variables[b].size;this.Lb=a.nativeFunctions.map(function(a,b){return{id:b,name:a.name,B:a.args}});this.vd=a.localEvents.map(function(a){return{name:a.name}})}function Qf(a,b){for(var c=0;c<a.Lb.length;c++)if(a.Lb[c].name===b)return a.Lb[c];return null}
function Rf(a,b){for(var c=0;c<a.Xa.length;c++)if(a.Xa[c].name===b)return a.Xa[c];return null}function Sf(a,b){if("init"===b)return 65535;for(var c=0;c<a.vd.length;c++)if(a.vd[c].name===b)return 65534-c;throw"unknown local event "+b;}function wb(a,b){this.Xb=Tf;this.dg=!1;this.pa=a;this.m=b;this.M=b.length;this.b=0;this.line=1;this.Fa=0;this.C=[];this.l=0;this.h=[];this.gg=[];this.ga=[];this.R={};this.Za=[];this.hb=[];this.kc=this.Vc=this.pa.b;this.Jf=!1;this.La=0;this.Vb=[]}
function Of(a,b,c,d,e){this.name=a;this.size=b;this.w=c;this.offset=d;this.resultType=e}Of.prototype.sd=function(a,b){return[12288|this.offset+(b||0)]};Of.prototype.ef=function(a,b){return[16384|this.offset+(b||0)]};Of.prototype.De=function(){return[20480|this.offset,this.size]};Of.prototype.Ff=function(){return[24576|this.offset,this.size]};
wb.prototype.Kg=function(){for(;this.b<this.M;)if(" "===this.m[this.b]||"\t"===this.m[this.b])this.b++,this.Fa++;else if("\n"===this.m[this.b])this.b++,this.Fa=0,this.line++;else if("\r"===this.m[this.b])this.b++;else if("#*"===this.m.slice(this.b,this.b+2))for(this.b+=2,this.Fa+=2;this.b<this.M&&"*#"!==this.m.slice(this.b-2,this.b);)"\n"===this.m[this.b]?(this.Fa=0,this.line++):"\r"!==this.m[this.b]&&this.Fa++,this.b++;else if("#"===this.m[this.b])for(;this.b<this.M&&"\n"!==this.m[this.b];)this.b++,
this.Fa++;else break};function Uf(a,b){a.hb.push(b.length-1)}function Vf(a,b,c){if(0===a.hb.length)throw"internal";void 0===c&&(c=b.length);a=a.hb.pop();b[a]=36864===b[a]?b[a]+(c-a&4095):c-a+1&65535}wb.prototype.Dd=function(a,b,c,d,e){var f;a:{for(f=0;f<this.Za.length;f++)if(this.Za[f].name===a){f=!0;break a}for(f=0;f<this.pa.Xa.length;f++)if(this.pa.Xa[f].name===a){f=!0;break a}f=!1}if(f)throw'duplicate variable declaration "'+a+'"';this.Za.push(new Of(a,b,c,d,e))};
function Wf(a,b){for(var c=a.Za.length-1;0<=c;c--)if(a.Za[c].name===b.name)return a.Za[c];for(c=0;c<a.pa.Xa.length;c++)if(a.pa.Xa[c].name===b.name)return a.pa.Xa[c];throw"unknown variable "+b.name+" "+R(b.head);}function Xf(a,b){for(var c=0;c<a.ga.length;c++)if(a.ga[c].name===b)return a.ga[c];return null}function Yf(a,b){a.kc-=b;return a.kc}wb.prototype.qb=function(){return[]};var Zf="== != <= >= |= ^= &= *= /= %= += -= <<= >>= ++ -- ( ) [ ] - ~ * / % + << >> & ^ | > < = , : abs and callsub call const do elseif else emit end for if in not onevent or return step sub then var when while".split(" ");
function $f(a,b,c){this.Ad=a;this.hd=b;this.fd=c}function R(a){return"line "+a.hd.toString()+" col "+a.fd.toString()}function ag(a,b,c,d){$f.call(this,a,b,c);this.n=d}ag.prototype=Object.create($f.prototype);ag.prototype.constructor=ag;function bg(a,b,c,d){$f.call(this,a,b,c);this.n=d}bg.prototype=Object.create(ag.prototype);bg.prototype.constructor=bg;function cg(a,b,c,d){$f.call(this,a,b,c);this.name=d}cg.prototype=Object.create($f.prototype);cg.prototype.constructor=cg;
function dg(a,b,c,d){$f.call(this,a,b,c);this.name=d}dg.prototype=Object.create($f.prototype);dg.prototype.constructor=dg;
wb.prototype.yf=function(a){for(;;){a:{var b=(b=a)||Zf;this.Kg();if(this.b>=this.M)var c=null;else{for(var d=0;d<b.length;d++)if(c=b[d].length,this.m.slice(this.b,this.b+c)===b[d]&&!/[a-zA-Z0-9_.]{2}/.test(this.m.slice(this.b+c-1,this.b+c+1))){b=new dg(this.b,this.line,this.Fa,b[d]);this.b+=c;this.Fa+=c;c=b;break a}c=0;if("0x"===this.m.slice(this.b,this.b+2)){for(this.b+=2;this.b+c<this.M&&/[0-9a-fA-F]/.test(this.m[this.b+c]);)c++;if(0===c)throw"hexadecimal number syntax error";b=parseInt(this.m.slice(this.b,
this.b+c),16);b=new ag(this.b,this.line,this.Fa,b);this.b+=c;this.Fa+=2+c}else if("0b"===this.m.slice(this.b,this.b+2)){for(this.b+=2;this.b+c<this.M&&/[01]/.test(this.m[this.b+c]);)c++;if(0===c)throw"binary number syntax error";b=parseInt(this.m.slice(this.b,this.b+c),2);b=new ag(this.b,this.line,this.Fa,b);this.b+=c;this.Fa+=2+c}else if(/[0-9]/.test(this.m[this.b])){for(;this.b+c<this.M&&/[0-9]/.test(this.m[this.b+c]);)c++;if(this.dg&&this.b+c<this.M&&"."===this.m[this.b+c]){for(c++;this.b+c<this.M&&
/[0-9]/.test(this.m[this.b+c]);c++);b=parseFloat(this.m.slice(this.b,this.b+c));b=new bg(this.b,this.line,this.Fa,b)}else b=parseInt(this.m.slice(this.b,this.b+c),10),b=new ag(this.b,this.line,this.Fa,b);this.b+=c;this.Fa+=c}else if(/[a-zA-Z_]/.test(this.m[this.b])){for(;this.b+c<this.M&&/[a-zA-Z0-9_.]/.test(this.m[this.b+c]);)c++;if(0===c)throw"name syntax error";b=new cg(this.b,this.line,this.Fa,this.m.slice(this.b,this.b+c));this.b+=c;this.Fa+=c}else throw"syntax error line "+this.line.toString()+
" col "+this.Fa.toString();c=b}}if(null===c)break;this.C.push(c)}};function Nf(a,b,c,d){this.Lg=a;this.line=b;this.Fa=c;this.Ob=d}function eg(a,b,c){(b=b.head||b.children[0]&&b.children[0].head)&&a.Vb.push(new Nf(b.Ad,b.hd,b.fd,void 0===c?a.La:c))}function S(a){this.head=a;this.children=[];this.nb=0;this.resultType=fg;this.tb=!0}function gg(a,b){for(var c=0;c<a.length;c++)a[c]=a[c].F(b)}S.prototype.F=function(){return this};S.prototype.Sa=function(a){this.children.forEach(function(b){b.Sa(a)})};
S.prototype.v=function(a){this.Sa(a);for(var b=0;b<this.children.length;b++)this.children[b]=this.children[b].v(a);return this};function U(a,b){S.call(this,a);this.n=void 0===b?this.head.n:b;this.resultType=Pf}U.prototype=Object.create(S.prototype);U.prototype.constructor=U;U.prototype.Sa=function(){this.nb=1};function hg(a){a&=65535;return 32768<=a?a-65536:a}function ig(a,b){U.call(this,a,b);this.resultType=jg}ig.prototype=Object.create(U.prototype);ig.prototype.constructor=ig;
function kg(a){S.call(this,a);this.name=a.name;this.b=!1}kg.prototype=Object.create(S.prototype);kg.prototype.constructor=kg;kg.prototype.Sa=function(a){a.R.hasOwnProperty(this.name)?(this.nb=1,this.resultType=a.R[this.name].resultType):(a=Wf(a,this),this.nb=a.size,this.resultType=a.resultType)};kg.prototype.F=function(a){return a.R.hasOwnProperty(this.name)?a.R[this.name].resultType===jg?new ig(this.head,a.R[this.name].S):new U(this.head,a.R[this.name].S):this};
function lg(a){var b=new kg(a.head);b.resultType=a.resultType;b.b=!0;return b}var fg="?",Pf="n",jg="fx";function V(a,b,c,d){S.call(this,a);this.type=b;this.resultType=c?c.resultType:fg;this.Da=c;this.children=d||[]}V.prototype=Object.create(S.prototype);V.prototype.constructor=V;
V.prototype.Sa=function(a){S.prototype.Sa.call(this,a);for(var b=1,c=0;c<this.children.length;c++)if(1===b)b=this.children[c].nb;else if(1!==this.children[c].nb&&this.children[c].nb!==b)throw"incompatible sizes "+R(this.head);this.nb=b;this.Da&&this.Da.na&&(this.resultType=this.Da.na(a,this,this.children.map(function(a){return a.resultType})))};V.prototype.F=function(a){this.children=this.children.map(function(b){return b.F(a)});return this.Da&&this.Da.F?this.Da.F(this,a):this};
V.prototype.v=function(a){var b=S.prototype.v.call(this,a);if(b.type===W&&b.Da.priority===mg&&(b.children[1]instanceof ng||b.children[1]instanceof kg&&1!==b.children[1].nb)){var c=b.children[0];if(!(c instanceof kg)||b.tb)throw"bad array assignment "+R(b.head);for(var d=b.children[1],e=new og(b.head),f=0;f<d.nb;f++){var g=c;1<d.nb&&(g=new pg(c.head,[new U(c.head,f)]),g.resultType=c.resultType);if(d instanceof ng)var h=d.children[f];else h=new pg(d.head,[new U(c.head,f)]),h.resultType=d.resultType;
g=new V(b.head,b.type,b.Da,[g,h]);g.resultType=c.resultType;g.tb=!1;g=g.F(a);e.children.push(g)}return e}return b};function pg(a,b){kg.call(this,a);this.children=b}pg.prototype=Object.create(kg.prototype);pg.prototype.constructor=pg;pg.prototype.Sa=function(a){S.prototype.Sa.call(this,a);a=Wf(a,this);this.nb=1;this.resultType=a.resultType};function qg(a){for(var b=0;b<a.children.length;b++)if(!(a.children[b]instanceof U))return!1;return!0}
function rg(a,b){for(var c=0,d=1,e=0;e<a.children.length;e++){if(!(a.children[e]instanceof U))throw"internal";c+=d*a.children[e].n;d*=b.w[e]}return c}function ng(a){S.call(this,a);this.w=[]}ng.prototype=Object.create(S.prototype);ng.prototype.constructor=ng;ng.prototype.Sa=function(a){this.nb=this.children.length;this.children[0]&&(this.children.forEach(function(b){b.Sa(a)}),this.resultType=this.children[0].resultType)};function X(a,b){S.call(this,a);this.type=b||sg;this.Aa=!1;this.Qa=[null]}
X.prototype=Object.create(S.prototype);w=X.prototype;w.constructor=X;w.Kf=function(){throw"internal";};w.Ag=function(){};w.Cg=function(){throw"internal";};w.Bg=function(){};w.Od=function(){};function tg(a,b){b.kc=b.Vc;eg(b,a)}var sg=1;function ug(a,b){this.b=a;this.ka=b}ug.prototype.u=function(){return"internal"};function vg(a,b){X.call(this,a,2);this.bf=b}vg.prototype=Object.create(X.prototype);vg.prototype.constructor=vg;vg.prototype.F=function(a){gg(this.children,a);return this};
vg.prototype.Kf=function(){return this};function wg(a,b){X.call(this,a,2);this.Ng=b}wg.prototype=Object.create(X.prototype);wg.prototype.constructor=wg;wg.prototype.F=function(a){gg(this.children,a);return this};wg.prototype.Kf=function(){return this};function xg(a){X.call(this,a)}xg.prototype=Object.create(X.prototype);xg.prototype.constructor=xg;function yg(a,b,c){X.call(this,a);this.b=b;this.S=c;this.resultType=c.resultType}yg.prototype=Object.create(X.prototype);yg.prototype.constructor=yg;
function zg(a,b,c,d,e){X.call(this,a);this.R=b.name;this.resultType=c;this.b=d||null;this.size=-1;this.w=[];this.offset=-1;e&&this.children.push(e)}zg.prototype=Object.create(X.prototype);zg.prototype.constructor=zg;zg.prototype.Sa=function(a){this.children[0]&&(S.prototype.Sa.call(this,a),this.resultType=this.children[0].children[1].resultType)};zg.prototype.F=function(a){gg(this.children,a);return this};function Ag(a){X.call(this,a.head);this.children.push(a)}Ag.prototype=Object.create(X.prototype);
Ag.prototype.constructor=Ag;Ag.prototype.F=function(a){gg(this.children,a);return this};function og(a){X.call(this,a)}og.prototype=Object.create(X.prototype);og.prototype.constructor=og;og.prototype.F=function(a){gg(this.children,a);return this};function Bg(a,b){X.call(this,a,3);this.b=[b];this.h=[];this.m=[]}Bg.prototype=Object.create(X.prototype);w=Bg.prototype;w.constructor=Bg;w.Sa=function(a){this.b.forEach(function(b){b.Sa(a)});this.h.forEach(function(b){b.forEach(function(b){b.Sa(a)})})};
w.F=function(a){gg(this.b,a);this.h.forEach(function(b){gg(b,a)});return this};w.Cg=function(a){if(this.h.length>=this.b.length)throw"multiple else "+R(a.head);a instanceof Cg&&this.b.push(a.Ga);this.h.push(this.children);this.m.push(a);this.children=[];this.Qa.push(a.Qa[0])};
w.Od=function(a,b){this.h.push(this.children);this.children=[];this.m.push(b);for(a=0;a<this.b.length;)if(this.b[a]instanceof U)if(0===this.b[a].n)this.b.splice(a,1),this.h.splice(a,1);else{this.b.splice(a);this.h.splice(a+1);break}else a++};function Cg(a,b){X.call(this,a,4);this.Ga=b}Cg.prototype=Object.create(X.prototype);Cg.prototype.constructor=Cg;Cg.prototype.F=function(a){this.Ga=this.Ga.F(a);gg(this.children,a);return this};function Dg(a){X.call(this,a,4)}Dg.prototype=Object.create(X.prototype);
Dg.prototype.constructor=Dg;function Eg(a,b){X.call(this,a,3);this.Ga=b}Eg.prototype=Object.create(X.prototype);Eg.prototype.constructor=Eg;Eg.prototype.Sa=function(a){S.prototype.Sa.call(this,a);this.Ga.Sa(a)};Eg.prototype.F=function(a){this.Ga=this.Ga.F(a);gg(this.children,a);return this};function Fg(a,b){X.call(this,a,3);this.Ga=b;this.b=[]}Fg.prototype=Object.create(X.prototype);Fg.prototype.constructor=Fg;Fg.prototype.Sa=function(a){S.prototype.Sa.call(this,a);this.Ga.Sa(a)};
Fg.prototype.F=function(a){this.Ga=this.Ga.F(a);gg(this.children,a);return this};Fg.prototype.Od=function(a,b){this.Ga instanceof U&&(0===this.Ga.n&&(this.children=[]),this.Ga=null);this.b.push(b)};function Gg(a,b,c,d,e){X.call(this,a,3);this.m=new kg(b);this.children.push(c);this.children.push(d);this.b=e||null;this.h=[]}Gg.prototype=Object.create(X.prototype);Gg.prototype.constructor=Gg;Gg.prototype.Sa=function(a){S.prototype.Sa.call(this,a);this.b&&this.b.Sa(a)};
Gg.prototype.F=function(a){this.b&&(this.b=this.b.F(a));gg(this.children,a);return this};Gg.prototype.Od=function(a,b){this.h.push(b)};function Hg(a,b,c){X.call(this,a);this.name=b;this.children=c}Hg.prototype=Object.create(X.prototype);Hg.prototype.constructor=Hg;Hg.prototype.F=function(a){gg(this.children,a);return this};function Ig(a,b){X.call(this,a);this.name=b}Ig.prototype=Object.create(X.prototype);Ig.prototype.constructor=Ig;function Jg(a){X.call(this,a,5)}Jg.prototype=Object.create(X.prototype);
Jg.prototype.constructor=Jg;var mg=30,W=1;function Y(a,b,c){this.name=a;this.type=b;this.priority=c&&c.priority||0;this.resultType=c&&c.resultType||(c&&c.na?fg:Pf);this.na=c&&c.na||null;this.F=c&&c.F||null;this.K=c&&c.K||[];this.u=c&&c.u||null}function Kg(a,b){for(var c=[],d=0;d<a.children.length;d++){if(!(a.children[d]instanceof U))return a;c.push(a.children[d].n)}return new U(a.head,hg(b(c)))}
var Tf=[new Y("--",0,{priority:150}),new Y("++",0,{priority:150}),new Y("-",0,{priority:150,F:function(a){return Kg(a,function(a){return-a[0]})},K:[28672]}),new Y("~",0,{priority:150,F:function(a){return Kg(a,function(a){return~a[0]})},K:[28674]}),new Y("abs",0,{priority:150,F:function(a){return Kg(a,function(a){return Math.abs(a[0])})},K:[28673]}),new Y("not",0,{priority:150,resultType:"b",F:function(a){return Kg(a,function(a){return 0==a[0]?1:0})},K:[4096,32778]}),new Y("size",0,{priority:150,F:function(a,
b){var c=0<a.children[0].nb?a.children[0].nb:a.children[0]instanceof ng?a.children[0].children.length:-1;if(0>c&&a.children[0]instanceof kg)for(var d=b.Za.length-1;0<=d;d--)if(b.Za[d].name===a.children[0].name){c=b.Za[d].size;break}return 0<c?new U(a.head,c):a}}),new Y("--",2,{priority:150}),new Y("++",2,{priority:150}),new Y("+=",W,{priority:mg}),new Y("-=",W,{priority:mg}),new Y("*=",W,{priority:mg}),new Y("/=",W,{priority:mg}),new Y("%=",W,{priority:mg}),new Y("<<=",W,{priority:mg}),new Y(">>=",
W,{priority:mg}),new Y("&=",W,{priority:mg}),new Y("|=",W,{priority:mg}),new Y("^=",W,{priority:mg}),new Y("*",W,{priority:140,F:function(a){return Kg(a,function(a){return a[0]*a[1]})},K:[32772]}),new Y("/",W,{priority:140,F:function(a){return Kg(a,function(a){return Math.trunc(a[0]/a[1])})},K:[32773]}),new Y("%",W,{priority:140,F:function(a){return Kg(a,function(a){return a[0]%a[1]})},K:[32774]}),new Y("+",W,{priority:130,F:function(a){return Kg(a,function(a){return a[0]+a[1]})},K:[32770]}),new Y("-",
W,{priority:130,F:function(a){return Kg(a,function(a){return a[0]-a[1]})},K:[32771]}),new Y("<<",W,{priority:120,F:function(a){return Kg(a,function(a){return a[0]<<a[1]})},K:[32768]}),new Y(">>",W,{priority:120,F:function(a){return Kg(a,function(a){return a[0]>>a[1]})},K:[32769]}),new Y("==",W,{priority:80,resultType:"b",F:function(a){return Kg(a,function(a){return a[0]===a[1]?1:0})},K:[32778]}),new Y("!=",W,{priority:80,resultType:"b",F:function(a){return Kg(a,function(a){return a[0]!==a[1]?1:0})},
K:[32779]}),new Y("<",W,{priority:80,resultType:"b",F:function(a){return Kg(a,function(a){return a[0]<a[1]?1:0})},K:[32782]}),new Y("<=",W,{priority:80,resultType:"b",F:function(a){return Kg(a,function(a){return a[0]<=a[1]?1:0})},K:[32783]}),new Y(">",W,{priority:80,resultType:"b",F:function(a){return Kg(a,function(a){return a[0]>a[1]?1:0})},K:[32780]}),new Y(">=",W,{priority:80,resultType:"b",F:function(a){return Kg(a,function(a){return a[0]>=a[1]?1:0})},K:[32781]}),new Y("&",W,{priority:110,F:function(a){return Kg(a,
function(a){return a[0]&a[1]})},K:[32777]}),new Y("|",W,{priority:90,F:function(a){return Kg(a,function(a){return a[0]|a[1]})},K:[32775]}),new Y("^",W,{priority:100,F:function(a){return Kg(a,function(a){return a[0]^a[1]})},K:[32776]}),new Y("and",W,{priority:60,resultType:"b",F:function(a){return Kg(a,function(a){return a[0]&&a[1]?1:0})},K:[32785]}),new Y("or",W,{priority:50,resultType:"b",F:function(a){return Kg(a,function(a){return a[0]||a[1]?1:0})},K:[32784]}),new Y("=",W,{priority:mg})];
function Lg(a,b,c){for(var d=0;d<a.Xb.length;d++)if(a.Xb[d].type===c&&a.Xb[d].name===b)return a.Xb[d];return null}function Mg(a,b,c){return a.C[a.l+b]instanceof c}function Z(a,b,c){return a.C[a.l+b]instanceof dg&&a.C[a.l+b].name===c}w=wb.prototype;w.sg=function(a){return new V(a,4,null)};
function Ng(a,b){b=b||10;if(Mg(a,0,bg)){var c=new ig(a.C[a.l]);a.l++}else if(Mg(a,0,ag))c=new U(a.C[a.l]),a.l++;else if(Mg(a,0,cg))Z(a,1,"(")?(c=a.sg(a.C[a.l]),a.l++,Z(a,1,")")?a.l+=2:c.children=Og(a)):(c=new kg(a.C[a.l]),a.l++);else if(Z(a,0,"(")){a.l++;c=Ng(a,20);if(!Z(a,0,")"))throw"subexpression in expression "+R(a.C[a.l]);a.l++}else if(Z(a,0,"[")){c=new ng(a.C[a.l]);a.l++;var d=[];for(var e=0,f=0,g=0;;){d.push(Ng(a,25));0===g&&f++;g++;if(1<f&&g>e)throw"non-rectangular array "+R(a.C[a.l]);g>e&&
(e=g);if(Mg(a,0,dg))if(a.l++,"]"===a.C[a.l-1].name)break;else if(","===a.C[a.l-1].name)continue;else if(";"===a.C[a.l-1].name){e=g;g=0;continue}throw"array "+R(a.C[a.l-1]);}for(g=0;g<e;g++)for(var h=0;h<f;h++)c.children.push(d[h*e+g])}else if(Mg(a,0,dg)&&(d=Lg(a,a.C[a.l].name,0)))c=new V(a.C[a.l],0,d),a.l++,c.children.push(Ng(a,150)),d.na&&(c.resultType=d.na(a,c,[c.children[0].resultType]));else if(Mg(a,0,dg)&&(d=Lg(a,a.C[a.l].name,3)))c=new V(a.C[a.l],3,d),a.l++;else{if(a.l<a.C.length)throw"unexpected token in expression "+
R(a.C[a.l]);throw"unexpected end of file";}for(;Mg(a,0,dg);)if((d=Lg(a,a.C[a.l].name,2))&&d.priority>=b)c=new V(a.C[a.l],2,d,[c]),a.l++;else if((d=Lg(a,a.C[a.l].name,W))&&(b===mg?d.priority>=b:d.priority>b))c=new V(a.C[a.l],W,d,[c]),a.l++,c.children.push(Ng(a,d.priority)),d.na&&(c.resultType=d.na(a,c,c.children.map(function(a){return a.resultType})));else if("["===a.C[a.l].name){if(!(c instanceof kg))throw"unexpected indexing";d=c.resultType;e=Og(a,!0);c=new pg(c.head,e);c.resultType=d}else break;
return c}function Og(a,b){var c=[];if(!Z(a,0,b?"[":"("))throw"left "+(b?"bracket":"parenthesis")+" expected";for(a.l++;;){var d=Ng(a,25);c.push(d);if(!Mg(a,0,dg))throw"syntax error in arguments";if(Z(a,0,b?"]":")")){a.l++;break}else if(Z(a,0,","))a.l++;else throw"syntax error in arguments "+R(a.C[a.l]);}return c}
w.xg=function(){if(this.l>=this.C.length)throw"no more tokens";if(this.C[this.l]instanceof dg){var a=this.C[this.l];switch(a.name){case "const":if(!Mg(this,1,cg)||!Z(this,2,"="))throw'syntax error for "const" '+R(a);var b=this.C[this.l+1];this.l+=3;var c=Ng(this);c=c.F(this);if(!(c instanceof U))throw"non-constant expression in constant definition "+R(this.C[this.l]);return[new yg(a,b.name,c)];case "var":if(!Mg(this,1,cg))throw'unexpected token after "var" '+R(a);b=this.C[this.l+1];this.l+=2;if(Mg(this,
0,dg))switch(this.C[this.l].name){case "[":if(Z(this,1,"]")){this.l+=2;if(!Z(this,0,"="))throw"missing size or initial value in array declaration"+R(this.C[this.l-2]);c=new V(this.C[this.l],W,Lg(this,"=",W),[new kg(b)]);this.l++;c.children.push(Ng(this));c.resultType=c.children[1].resultType;c.tb=!1;var d=new V(new dg(c.head.Ad,c.head.hd,c.head.fd,"size"),0,Lg(this,"size",0),[c.children[1]]);return[new zg(a,b,c.resultType,[d],c)]}this.l++;d=Ng(this);if(!Z(this,0,"]"))throw"array size syntax error"+
R(this.C[this.l]);this.l++;return Z(this,0,"=")?(c=new V(this.C[this.l],W,Lg(this,"=",W),[new kg(b)]),this.l++,c.children.push(Ng(this)),c.resultType=c.children[1].resultType,c.tb=!1,c=c.F(this),[new zg(a,b,c.resultType,[d],c)]):[new zg(a,b,fg,[d])];case "=":return c=new V(this.C[this.l],W,Lg(this,"=",W),[new kg(b)]),this.l++,c.children.push(Ng(this)),c.resultType=c.children[1].resultType,c.tb=!1,c=c.F(this),[new zg(a,b,c.resultType,null,c)]}return[new zg(a,b,fg)];case "if":case "elseif":this.l++;
c=Ng(this);if(!Z(this,0,"then"))throw'"then" expected after "if" statement '+R(this.C[this.l]);this.l++;return["if"===a.name?new Bg(a,c):new Cg(a,c)];case "when":this.l++;c=Ng(this);if(!Z(this,0,"do"))throw'"do" expected after "when" statement '+R(this.C[this.l]);this.l++;return[new Eg(a,c)];case "while":this.l++;c=Ng(this);if(!Z(this,0,"do"))throw'"do" expected after "while" statement '+R(this.C[this.l]);this.l++;return[new Fg(a,c)];case "for":if(!Mg(this,1,cg)||!Z(this,2,"in"))throw'"for" syntax error '+
R(a);b=this.C[this.l+1];this.l+=3;c=Ng(this);if(!Z(this,0,":"))throw'range expected in "for" statement '+R(this.C[this.l]);this.l++;d=Ng(this);var e=null;Z(this,0,"step")&&(this.l++,e=Ng(this));if(!Z(this,0,"do"))throw'"do" expected after "for" statement '+R(this.C[this.l]);this.l++;return[new Gg(a,b,c,d,e)];case "end":return this.l++,[new Jg(a)];case "call":if(!Mg(this,1,cg))throw'"call" syntax error '+R(a);b=this.C[this.l+1];this.l+=2;return Z(this,0,"(")?[new Hg(a,b.name,Og(this))]:[new Hg(a,b.name,
[])];case "callsub":if(!Mg(this,1,cg))throw'"callsub" syntax error '+R(a);b=this.C[this.l+1];this.l+=2;return[new Ig(a,b.name)];case "else":return this.l++,[new Dg(a)];case "onevent":if(!Mg(this,1,cg))throw'unexpected token after "onevent" '+R(a);b=this.C[this.l+1];this.l+=2;return[new vg(a,b.name)];case "return":return this.l++,[new xg(a)];case "sub":if(!Mg(this,1,cg))throw'unexpected token after "sub" '+R(a);b=this.C[this.l+1];this.l+=2;return[new wg(a,b.name)]}}c=Ng(this);c instanceof V&&(c.tb=
!1);c=c.F(this);return[new Ag(c)]};w.Eg=function(){};w.Dg=function(){};
w.Ne=function(a){if(a instanceof yg){a.S=a.S.F(this);if(!(a.S instanceof U))throw"constant definition "+R(a.head);this.R[a.b]={S:a.S.n,resultType:a.S.resultType}}else a instanceof zg&&(a.size=1,a.w=[],a.b&&(a.b=a.b.map(function(b){b=b.F(this);if(!(b instanceof U)||0>=b.n)throw"array variable size "+R(a.head);a.size*=b.n;a.w.push(b.n);return b},this)),a.offset=this.Na,a.children[0]&&(a.resultType=a.children[0].resultType),this.Na+=a.size,this.Dd(a.R,a.size,a.w,a.offset,a.resultType))};w.Pd=function(){};
w.ua=function(){};w.getContext=function(){return null};w.hg=function(){this.Na=this.pa.Na;for(var a=0;a<this.h.length;a++)this.Ne(this.h[a])};function Pg(a,b,c){switch(b.type){case 3:c.push(a.getContext());a.ua(b.Qa[0]);break;case 4:a.ua(b.Qa[0]);break;case 5:a.ua(c.pop())}}
function Qg(a){function b(){if(1<f.length){var a=f[f.length-1].head;throw"unterminated "+a.name+" "+R(a);}c.o.push(f[0])}var c=a,d=[];a.hg();a.Pd();d=[];a.h.forEach(function(a){Pg(this,a,d);a.Sa(this)},a);a.Pd();d=[];for(var e=0;e<a.h.length;e++)Pg(a,a.h[e],d),a.h[e]=a.h[e].F(a);a.Pd();d=[];for(e=0;e<a.h.length;e++)Pg(a,a.h[e],d),a.h[e]=a.h[e].v(a);a.o=[];var f=[new vg(null,"init")];a.Pd();for(e=0;e<a.h.length;e++)switch(a.h[e].type){case sg:a.h[e].Od(a,a.h[e]);f[f.length-1].children.push(a.h[e]);
break;case 2:a.ua(a.h[e].Qa[0]);b();f=[a.h[e].Kf()];break;case 3:a.ua(a.h[e].Qa[0]);a.h[e].Ag(a);f.push(a.h[e]);break;case 4:a.ua(a.h[e].Qa[0]);f[f.length-1].Cg(a.h[e]);break;case 5:if(2>f.length)throw"unexpected end "+R(a.h[e].head);a.ua(a.h[e].Qa[0]);f[f.length-1].Bg(a.h[e]);var g=f.pop();a.ua(a.h[e].Qa[a.h[e].Qa.length-1]);g.Od(a,a.h[e]);f[f.length-1].children.push(g);break;default:throw"not implemented "+a.h[e].type;}b()}w.Fg=function(){};w.rg=function(){return null};
S.prototype.u=function(a){for(var b=[],c=a.La,d=0;d<this.children.length;d++)b=b.concat(this.children[d].u(a)),a.La=c+b.length;return b};function Rg(a){return-2048<=a&&2048>a?[4096|a&4095]:[8192,a&65535]}U.prototype.u=function(){return this.tb?Rg(this.n):[]};kg.prototype.u=function(a){return this.b?[]:a.R.hasOwnProperty(this.name)?Rg(a.R[this.name].S):Wf(a,this).sd(a)};
V.prototype.u=function(a){function b(b,d,e,f){function g(b,g){f===c.Of&&(h=h.concat(b.sd(a,g)));e&&(h=h.concat(b.sd(a,g)));h=h.concat(d.u(a)).concat(a.qb(d.resultType,b.resultType)).concat(b.ef(a,g));f===c.Je&&(h=h.concat(b.sd(a,g)))}var h=[];if(b instanceof pg){var k=Wf(a,b);if(qg(b)){b=rg(b,k);if(b>=k.size)throw"index out of range";g(k,b)}else if(f!==c.sf||e){var m=Yf(a,1);h=h.concat(Sg(b,a)).concat(16384|m);f===c.Of&&(h=h.concat(12288|m).concat(k.De(a)));e&&(h=h.concat(12288|m).concat(k.De(a)));
h=h.concat(d.u(a)).concat(a.qb(d.resultType,k.resultType)).concat(12288|m).concat(k.Ff(a));f===c.Je&&(h=h.concat(12288|m).concat(k.De(a)))}else h=h.concat(d.u(a)).concat(a.qb(d.resultType,k.resultType)).concat(Sg(b,a)).concat(k.Ff(a))}else if(b instanceof kg)k=Wf(a,b),g(k);else throw"bad assignment";return h}var c={sf:0,Je:1,Of:2},d=this.head.name;switch(d){case "=":return b(this.children[0],this.children[1],!1,this.tb?c.Je:c.sf);case "++":case "--":if(!(this.children[0]instanceof kg))throw"invalid operand "+
R(this.head);var e=d[0],f=Lg(a,e,W);e=new V(new dg(this.head.Ad,this.head.hd,this.head.fd,e),W,f,[lg(this.children[0]),new U(new ag(this.head.Ad,this.head.hd,this.head.fd,1))]);f.na&&(d=Wf(a,this.children[0]),e.resultType=f.na(a,e,[d.resultType,Pf]));return b(this.children[0],e,!0,this.tb?0===this.type?c.Je:c.Of:c.sf);default:if(this.type===W&&this.Da.priority===mg){if(!(this.children[0]instanceof kg))throw"invalid operand "+R(this.head);e=d.slice(0,-1);f=Lg(a,e,W);e=new V(new dg(this.head.Ad,this.head.hd,
this.head.fd,e),W,f,[lg(this.children[0]),this.children[1]]);f.na&&(d=Wf(a,this.children[0]),e.resultType=f.na(a,e,[d.resultType,this.children[1].resultType]));return b(this.children[0],e,!0,this.tb?c.Je:c.sf)}if(this.Da&&this.Da.u)return this.Da.u(this,a);switch(this.type){case 0:return S.prototype.u.call(this,a).concat(this.Da.K);case W:return S.prototype.u.call(this,a).concat(this.Da.K);case 3:return this.Da.K;case 4:f=a.rg(this);if(null!==f)return f;e=Xf(a,d);if(null!=e){if(e.$c!==this.children.length)throw"wrong number of arguments";
f=[];d=Yf(a,e.$c+(e.ie||0));for(var g=0;g<this.children.length;g++)f=f.concat(this.children[g].u(a)),f=f.concat(16384|d+g);return f=f.concat(e.Jb(a,a.pa,this.children.map(function(a){return a.resultType}),d))}throw"unknown function "+d+" "+R(this.head);default:throw"internal";}}};function Tg(a,b,c){return a instanceof V&&2===a.children.length?a.children[0].u(b).concat(a.children[1].u(b)).concat([40960|(c?256:0)|a.Da.K[0]&255,0]):a.u(b).concat(4096,40960|(c?256:0)|Lf.indexOf("ne"),0)}
function Sg(a,b){var c=Wf(b,a);if(a.children.length>c.w.length)throw"too many indices"+R(a.head);for(var d=[],e=1,f=0;f<a.children.length;f++)d=d.concat(a.children[f].u(b)),0<f&&(d=d.concat(4096|e,32772,32770)),e*=c.w[f];return d}pg.prototype.u=function(a){if(this.b)return[];var b=Wf(a,this);if(qg(this)){var c=rg(this,b);if(c>=b.size)throw"index out of range "+R(this.head);return b.sd(a,c)}return Sg(this,a).concat(b.De(a))};ng.prototype.u=function(){throw"internal";};
X.prototype.u=function(){throw"internal";};vg.prototype.u=function(a){var b=a.getContext();tg(this,a);a.ua(this.Qa[0]);var c="init"===this.bf?a.gg:[];a.La+=c.length;c=c.concat(S.prototype.u.call(this,a)).concat(0);a.ua(b);return c};wg.prototype.u=function(a){var b=a.getContext();tg(this,a);a.ua(this.Qa[0]);var c=S.prototype.u.call(this,a).concat(57344);a.ua(b);return c};yg.prototype.u=function(a){tg(this,a);return[]};
zg.prototype.u=function(a){tg(this,a);return 0===this.children.length?[]:S.prototype.u.call(this,a)};Ag.prototype.u=function(a){tg(this,a);return this.children[0].u(a)};og.prototype.u=function(a,b){tg(this,a);var c=[];this.children.forEach(function(d){c=c.concat(d.u(a,b))});return c};
Bg.prototype.u=function(a){var b=a.getContext();tg(this,a);for(var c=a.La,d=[],e=0,f=0;f<this.b.length;f++)a.La=c+d.length,0<f&&eg(a,this.m[f-1]),d=d.concat(Tg(this.b[f],a)),a.La=c+d.length,Uf(a,d),a.ua(this.Qa[f]),this.h[f].forEach(function(b){d=d.concat(b.u(a));a.La=c+d.length}),a.ua(b),f+1<this.h.length?(d=d.concat(36864),Vf(a,d),Uf(a,d),e++):Vf(a,d);a.La=c+d.length;this.h.length>this.b.length&&(eg(a,this.m[this.b.length-1],a.La+d.length),a.ua(this.Qa[this.b.length]),this.h[this.b.length].forEach(function(b){d=
d.concat(b.u(a));a.La=c+d.length}));for(;0<e--;)Vf(a,d);a.ua(b);return d};Eg.prototype.u=function(a){var b=a.getContext();tg(this,a);var c=a.La,d=Tg(this.Ga,a,!0);Uf(a,d);a.ua(this.Qa[0]);this.children.forEach(function(b){a.La=c+d.length;d=d.concat(b.u(a))});Vf(a,d);a.ua(b);return d};
Fg.prototype.u=function(a){if(null==this.Ga&&0===this.children.length)return[];var b=a.getContext();tg(this,a);var c=a.La,d=[];null!=this.Ga&&(d=Tg(this.Ga,a));Uf(a,d);a.ua(this.Qa[0]);this.children.forEach(function(b){a.La=c+d.length;d=d.concat(b.u(a))});a.La=c+d.length;eg(a,this.b[0]);d=d.concat(36864|-d.length&4095);Vf(a,d);a.ua(b);return d};
Gg.prototype.u=function(a){var b=a.getContext();tg(this,a);var c=a.La,d=this.children[0].u(a),e=Wf(a,this.m);d=d.concat(e.ef(a));var f=d.length;d=d.concat(e.sd(a)).concat(this.children[1].u(a)).concat(40975,0);Uf(a,d);a.ua(this.Qa[0]);for(var g=2;g<this.children.length;g++)a.La=c+d.length,d=d.concat(this.children[g].u(a));a.La=c+d.length;eg(a,this.h[0]);d=d.concat(e.sd(a));d=this.b?d.concat(this.b.u(a)):d.concat(Rg(1));d=d.concat(32770,e.ef(a),36864|f-d.length-2&4095);Vf(a,d);a.ua(b);return d};
Hg.prototype.u=function(a){tg(this,a);var b=Qf(a.pa,this.name);if(!b)throw'native function "'+this.name+'" not found';if(this.children.length!==b.B.length)throw'wrong number of arguments for native function "'+this.name+'"';for(var c=[],d=[],e=[],f=this.children.length-1;0<=f;f--){var g=this.children[f];if(0>b.B[f])if(void 0==d[-b.B[f]-1])d[-b.B[f]-1]=g.nb;else{if(d[-b.B[f]-1]!==g.nb)throw'argument size mismatch in native function "'+this.name+'"';}else 0===b.B[f]&&e.push(g.nb);if(g instanceof pg)c=
c.concat(Rg(Wf(a,g).offset)).concat(Sg(g,a)).concat(32770);else if(g instanceof kg)c=c.concat(Rg(Wf(a,g).offset));else{for(var h=Yf(a,g.nb),k=0;k<g.nb;k++)c=c.concat((g instanceof ng?g.children[k]:g).u(a)),c=c.concat(16384|h+k);c=c.concat(Rg(h))}}for(f=e.length-1;0<=f;f--)c=Rg(e[f]).concat(c);for(f=d.length-1;0<=f;f--)void 0!==d[f]&&(c=Rg(d[f]).concat(c));return c=c.concat(49152|b.id)};xg.prototype.u=function(a){tg(this,a);return[(a.Jf?14:0)<<12]};function Ug(a,b){ug.call(this,a,b)}Ug.prototype=Object.create(ug.prototype);
Ug.prototype.constructor=Ug;Ug.prototype.u=function(){var a=this.ka.name;if(void 0===this.b.Wd[a])throw'unknown function "'+a+'" '+R(this.ka.head);return 53248|this.b.Wd[a]};Ig.prototype.u=function(a){tg(this,a);return[new Ug(a,this)]};function Vg(a,b){b=b||0;for(var c=0;c<a.length;c++)a[c]instanceof ug&&(a[c]=a[c].u(b+c))}
wb.prototype.u=function(){this.hb=[];this.Pd();this.Vb=[];var a=this.o.map(function(a){this.La=0;this.ua(a.Qa[0]);this.Jf=a instanceof wg;this.Vb=[];return{Fd:a.u(this,!0),mapping:this.Vb}},this);if(0<this.hb.length)throw"internal";for(var b=0,c=0;c<this.o.length;c++)this.o[c]instanceof vg&&b++;this.Wd={};var d=[],e=[1+2*b];this.Vb=[];for(c=0;c<this.o.length;c++)this.Vb=this.Vb.concat(a[c].mapping.map(function(a){return new Nf(a.Lg,a.line,a.Fa,a.Ob+1+2*b+d.length)})),this.o[c]instanceof vg?(e=e.concat(Sf(this.pa,
this.o[c].bf),1+2*b+d.length),d=d.concat(a[c].Fd)):this.o[c]instanceof wg&&(this.Wd[this.o[c].Ng]=1+2*b+d.length,d=d.concat(a[c].Fd));Vg(d,1+2*b);return e.concat(d)};function yb(a){a.yf();a.Eg();a.l=0;for(a.h=[];a.l<a.C.length;)a.h=a.h.concat(a.xg());a.Dg();Qg(a);a.Fg();return a.u()};function Wg(a,b,c){void 0===c&&(c=1);return{name:a,$c:c,ie:1,Ce:function(a){return null!=Qf(a,b)},Jb:function(a,e,f,g){a=Qf(e,b);e=[4097];for(f=0;f<c;f++)e=e.concat([4096|g+c-1-f]);return e=e.concat([4096|g+c,49152|a.id,12288|g+c])}}}var xb=[Wg("min","math.min",2),Wg("max","math.max",2),Wg("clamp","math.clamp",3),Wg("muldiv","math.muldiv",3),Wg("atan2","math.atan2",2),Wg("sin","math.sin"),Wg("cos","math.cos"),Wg("sqrt","math.sqrt"),Wg("rand","math.rand",0)];function Ff(a,b){wb.call(this,a,b);this.dg=!0;this.Xb=Xg;this.rb=100;this.Rg=[];this.df=[];this.fg=[];this.labels=[[]];this.eg=[];this.zb=!1;this.label=null;this.Aa=fg;this.Oa=[]}Ff.prototype=Object.create(wb.prototype);Ff.prototype.constructor=Ff;var Yg="== != <= >= |= ^= &= *= /= %= += -= <<= >>= ++ -- ( ) [ ] - ~ ! * / % + << >> && || & ^ | > < = , ? : { } ; bool break case const continue default do else emit false fixed for goto if int onevent return size switch true void when while".split(" ");
function Zg(a,b,c){return c[0]}function $g(a,b,c){for(a=0;a<c.length;a++)switch(c[a]){case fg:case jg:return c[a];case "v":throw"cannot use void result in expression";}return Pf}function ah(a,b,c){if(!(a instanceof ng)&&a.resultType!==b&&a.resultType!==fg){if("v"===a.resultType)throw"cannot use void result "+R(a.head);if(b=bh(b))a=new V(new dg(a.head.Ad,a.head.hd,a.head.fd,b),0,Lg(c,b,0),[a]),a=a.F(c)}return a}function ch(a,b){a.children[1]=ah(a.children[1],a.resultType,b);return a}
Ff.prototype.qb=function(a,b){if(a===fg||b===fg)throw"internal";if("v"===a)throw"bad conversion from void";switch(a){case Pf:case "b":switch(b){case jg:return[4196,32772]}break;case jg:switch(b){case Pf:case "b":return[4196,32773]}}return[]};function dh(a,b,c){var d=[];a.forEach(function(a){d=a instanceof ig&&b===Pf?d.concat(Rg(Math.trunc(a.n))):a instanceof U&&a.resultType===Pf&&b===jg?d.concat(Rg(a.n*c.rb)):d.concat(a.u(c)).concat(c.qb(a.resultType,b))});return d}
function eh(a,b,c,d){var e=Yf(a,4);return(b instanceof S?b.u(a):Rg(b)).concat(16384|e).concat(c instanceof S?c.u(a):Rg(c)).concat(16384|e+1).concat(d instanceof S?d.u(a):Rg(d)).concat([16384|e+2,4097,4096|e+2,4096|e+1,4096|e,4096|e+3,49152|Qf(a.pa,"math.muldiv").id,12288|e+3])}
function fh(a,b,c,d){for(var e=!1,f=[],g=0;g<a.children.length;g++){if(a.children[g]instanceof ig)e=!0;else if(!(a.children[g]instanceof U))return a;f.push(a.children[g].n)}c=(e&&d?d:c)(f);d=a.Da.resultType;a.Da.na&&(d=a.Da.na(b,a,a.children.map(function(a){return a.resultType})));switch(d){case Pf:case "b":return new U(a.head,hg(c));case jg:return new ig(a.head,c);default:throw"internal";}}
var Xg=[new Y("--",0,{priority:150,na:Zg}),new Y("++",0,{priority:150,na:Zg}),new Y("-",0,{priority:150,na:Zg,F:function(a,b){return fh(a,b,function(a){return-a[0]})},K:[28672]}),new Y("~",0,{priority:150,F:function(a,b){return fh(a,b,function(a){return~a[0]})},K:[28674]}),new Y("!",0,{priority:150,resultType:"b",F:function(a,b){return fh(a,b,function(a){return 0==a[0]?1:0})},K:[4096,32778]}),new Y("bool",0,{priority:150,resultType:"b",F:function(a,b){return fh(a,b,function(a){return 0!=a[0]?1:0})},
K:[],u:function(a,b){b=a.children[0].u(b);"b"!==a.children[0].resultType&&(b=b.concat(4096,32779));return b}}),new Y("fixed",0,{priority:150,resultType:jg,F:function(a,b){return fh(a,b,function(a){return a[0]})},K:[],u:function(a,b){var c=a.children[0].u(b);a.children[0].resultType!==jg&&(c=c.concat(4096|b.rb,32772));return c}}),new Y("int",0,{priority:150,F:function(a,b){return fh(a,b,function(a){return a[0]})},K:[],u:function(a,b){var c=a.children[0].u(b);a.children[0].resultType===jg&&(c=c.concat(4096|
b.rb,32773));return c}}),new Y("size",0,{priority:150,F:function(a,b){var c=0<a.children[0].nb?a.children[0].nb:a.children[0]instanceof ng?a.children[0].children.length:-1;if(0>c&&a.children[0]instanceof kg)for(var d=b.Za.length-1;0<=d;d--)if(b.Za[d].name===a.children[0].name){c=b.Za[d].size;break}return 0<c?new U(a.head,c):a}}),new Y("--",2,{priority:150,na:Zg}),new Y("++",2,{priority:150,na:Zg}),new Y("+=",W,{priority:mg,na:Zg,F:ch}),new Y("-=",W,{priority:mg,na:Zg}),new Y("*=",W,{priority:mg,na:Zg}),
new Y("/=",W,{priority:mg,na:Zg}),new Y("%=",W,{priority:mg,na:Zg}),new Y("<<=",W,{priority:mg}),new Y(">>=",W,{priority:mg}),new Y("&=",W,{priority:mg}),new Y("|=",W,{priority:mg}),new Y("^=",W,{priority:mg}),new Y("*",W,{priority:140,na:$g,K:[32772],F:function(a,b){return fh(a,b,function(a){return a[0]*a[1]})},u:function(a,b){var c=a.children[1].resultType===jg,d=[];a.children[0].resultType===jg&&c?d=d.concat(eh(b,a.children[0],a.children[1],b.rb)):(a.children.forEach(function(a){d=d.concat(a.u(b))}),
d=d.concat(a.Da.K));return d}}),new Y("/",W,{priority:140,na:$g,K:[32773],F:function(a,b){return fh(a,b,function(b){if(0===b[1])throw"division by 0 "+R(a.head);return Math.trunc(b[0]/b[1])},function(b){if(0===b[1])throw"division by 0 "+R(a.head);return b[0]/b[1]})},u:function(a,b){var c=a.children[1].resultType===jg,d=[];a.children[0].resultType===jg?c?d=d.concat(eh(b,a.children[0],b.rb,a.children[1])):(a.children.forEach(function(a){d=d.concat(a.u(b))}),d=d.concat(a.Da.K)):c?d=d.concat(eh(b,a.children[0],
b.rb*b.rb,a.children[1])):(a.children.forEach(function(a){d=d.concat(a.u(b))}),d=d.concat(a.Da.K));return d}}),new Y("%",W,{priority:140,na:$g,F:function(a,b){return fh(a,b,function(b){if(0===b[1])throw"division by 0 "+R(a.head);return b[0]%b[1]})},K:[32774],u:function(a,b){return dh(a.children,a.resultType,b).concat(a.Da.K)}}),new Y("+",W,{priority:130,na:$g,F:function(a,b){return fh(a,b,function(a){return a[0]+a[1]})},K:[32770],u:function(a,b){return dh(a.children,a.resultType,b).concat(a.Da.K)}}),
new Y("-",W,{priority:130,na:$g,F:function(a,b){return fh(a,b,function(a){return a[0]-a[1]})},K:[32771],u:function(a,b){return dh(a.children,a.resultType,b).concat(a.Da.K)}}),new Y("<<",W,{priority:120,F:function(a,b){return fh(a,b,function(a){return a[0]<<a[1]})},K:[32768],u:function(a,b){return a.children[0].u(b).concat(dh(a.children.slice(1),Pf,b)).concat(a.Da.K)}}),new Y(">>",W,{priority:120,F:function(a,b){return fh(a,b,function(a){return a[0]>>a[1]})},K:[32769],u:function(a,b){return a.children[0].u(b).concat(dh(a.children.slice(1),
Pf,b)).concat(a.Da.K)}}),new Y("==",W,{priority:80,resultType:"b",F:function(a,b){return fh(a,b,function(a){return a[0]===a[1]?1:0})},K:[32778],u:function(a,b){var c=a.children.map(function(a){return a.resultType});return dh(a.children,$g(b,a,c),b).concat(a.Da.K)}}),new Y("!=",W,{priority:80,resultType:"b",F:function(a,b){return fh(a,b,function(a){return a[0]!==a[1]?1:0})},K:[32779],u:function(a,b){var c=a.children.map(function(a){return a.resultType});return dh(a.children,$g(b,a,c),b).concat(a.Da.K)}}),
new Y("<",W,{priority:80,resultType:"b",F:function(a,b){return fh(a,b,function(a){return a[0]<a[1]?1:0})},K:[32782],u:function(a,b){var c=a.children.map(function(a){return a.resultType});return dh(a.children,$g(b,a,c),b).concat(a.Da.K)}}),new Y("<=",W,{priority:80,resultType:"b",F:function(a,b){return fh(a,b,function(a){return a[0]<=a[1]?1:0})},K:[32783],u:function(a,b){var c=a.children.map(function(a){return a.resultType});return dh(a.children,$g(b,a,c),b).concat(a.Da.K)}}),new Y(">",W,{priority:80,
resultType:"b",F:function(a,b){return fh(a,b,function(a){return a[0]>a[1]?1:0})},K:[32780],u:function(a,b){var c=a.children.map(function(a){return a.resultType});return dh(a.children,$g(b,a,c),b).concat(a.Da.K)}}),new Y(">=",W,{priority:80,resultType:"b",F:function(a,b){return fh(a,b,function(a){return a[0]>=a[1]?1:0})},K:[32781],u:function(a,b){var c=a.children.map(function(a){return a.resultType});return dh(a.children,$g(b,a,c),b).concat(a.Da.K)}}),new Y("&",W,{priority:110,F:function(a,b){return fh(a,
b,function(a){return a[0]&a[1]})},K:[32777]}),new Y("|",W,{priority:90,F:function(a,b){return fh(a,b,function(a){return a[0]|a[1]})},K:[32775]}),new Y("^",W,{priority:100,F:function(a,b){return fh(a,b,function(a){return a[0]^a[1]})},K:[32776]}),new Y("&&",W,{priority:60,na:Zg,F:function(a,b){return fh(a,b,function(a){return a[0]&&a[1]?1:0})},K:[32785],u:function(a,b){var c=a.children[0].u(b).concat([16384|b.rc,12288|b.rc,4096,40960|Lf.indexOf("eq"),4,12288|b.rc,36864]);Uf(b,c);a=ah(a.children[1],
a.children[0].resultType,b).F(b);c=c.concat(a.u(b));Vf(b,c);return c}}),new Y("||",W,{priority:50,na:Zg,F:function(a,b){return fh(a,b,function(a){return a[0]||a[1]?1:0})},K:[32784],u:function(a,b){var c=a.children[0].u(b).concat([16384|b.rc,12288|b.rc,4096,40960|Lf.indexOf("ne"),4,12288|b.rc,36864]);Uf(b,c);a=ah(a.children[1],a.children[0].resultType,b).F(b);c=c.concat(a.u(b));Vf(b,c);return c}}),new Y("?",W,{priority:40,na:function(a,b,c){return c[1]},F:function(a){if(!(a.children[1]instanceof V)||
0==a.children[1].Da||":"!==a.children[1].Da.name)throw"missing else part in conditional expression "+R(a.head);return a.children[0]instanceof U?a.children[1].children[a.children[0].n?0:1]:a},u:function(a,b){var c=Tg(a.children[0],b);Uf(b,c);c=c.concat(a.children[1].children[0].u(b)).concat(36864);Vf(b,c);Uf(b,c);c=c.concat(a.children[1].children[1].u(b));Vf(b,c);return c}}),new Y(":",W,{priority:41,na:Zg,F:function(a,b){a.children[1]=ah(a.children[1],a.children[0].resultType,b);return a},u:function(a){throw"unexpected colon outside conditional expression "+
R(a.head);}}),new Y("=",W,{priority:mg,na:Zg,F:ch}),new Y(",",W,{priority:25,na:function(a,b){return b[1]},F:function(a){a.children[0].tb=!1;return a}}),new Y("false",3,{resultType:"b",F:function(a,b){return fh(a,b,function(){return 0})},K:[4096]}),new Y("true",3,{resultType:"b",F:function(a,b){return fh(a,b,function(){return 1})},K:[4097]})];w=Ff.prototype;
w.Kg=function(){for(;this.b<this.M;)if(" "===this.m[this.b]||"\t"===this.m[this.b])this.b++,this.Fa++;else if("\n"===this.m[this.b])this.b++,this.Fa=0,this.line++;else if("\r"===this.m[this.b])this.b++;else if("/*"===this.m.slice(this.b,this.b+2))for(this.b+=2,this.Fa+=2;this.b<this.M&&"*/"!==this.m.slice(this.b-2,this.b);)"\n"===this.m[this.b]?(this.Fa=0,this.line++):"\r"!==this.m[this.b]&&this.Fa++,this.b++;else if("//"===this.m.slice(this.b,this.b+2))for(;this.b<this.M&&"\n"!==this.m[this.b];)this.b++,
this.Fa++;else break};w.yf=function(a){return wb.prototype.yf.call(this,a||Yg)};w.Eg=function(){this.C.forEach(function(a,b){a instanceof dg&&("def"===a.name||0<=["int","bool","fixed","void"].indexOf(a.name))&&this.C[b+1]instanceof cg&&this.C[b+2]instanceof dg&&"("===this.C[b+2].name&&this.Rg.push(this.C[b+1].name)},this)};
function gh(a,b){switch(a.name){case "var":case "def":return b||Pf;case "void":return"v";case "int":return Pf;case "bool":return"b";case "fixed":return jg;default:throw"internal";}}function bh(a){switch(a){case Pf:return"int";case jg:return"fixed";case "b":return"bool";default:return""}}function hh(a){return Z(a,0,"int")||Z(a,0,"bool")||Z(a,0,"fixed")}
w.xg=function(){function a(){var a=[];for(this.l++;;){d=this.C[this.l];this.l++;if(!Mg(this,0,dg))throw"syntax error "+R(c);switch(this.C[this.l].name){case "[":if(Z(this,1,"]")){this.l+=2;if(!Z(this,0,"="))throw"missing size or initial value in array declaration"+R(this.C[this.l-2]);e=new V(this.C[this.l],W,Lg(this,"=",W),[new kg(d)]);this.l++;e.children.push(Ng(this,25));e.resultType=gh(c,e.children[1].resultType);e.children[1].Sa(this);e.tb=!1;var b=new V(new dg(this.C[this.l].Ad,this.C[this.l].hd,
this.C[this.l].fd,"size"),0,Lg(this,"size",0),[e.children[1]]);a.push(new zg(c,d,e.resultType,[b],e))}else b=Og(this,!0),Z(this,0,"=")?(e=new V(this.C[this.l],W,Lg(this,"=",W),[new kg(d)]),this.l++,e.children.push(Ng(this,25)),e.resultType=gh(c,e.children[1].resultType),e.tb=!1,a.push(new zg(c,d,e.resultType,b,e))):a.push(new zg(c,d,gh(c),b));break;case "=":e=new V(this.C[this.l],W,Lg(this,"=",W),[new kg(d)]);this.l++;e.children.push(Ng(this,25));e.resultType=gh(c,e.children[1].resultType);e.tb=!1;
e=e.F(this);a.push(new zg(c,d,e.resultType,null,e));break;default:a.push(new zg(c,d,gh(c)))}if(Z(this,0,","))this.l++;else{if(Z(this,0,";"))return this.l++,a;throw"missing semicolon "+R(this.C[this.l]);}}}function b(){var a=gh(c);d=this.C[this.l+1];this.l+=3;var b=[];if(!Z(this,0,")"))for(;;){var e=Pf;hh(this)&&(e=gh(this.C[this.l]),this.l++);if(!Mg(this,0,cg))throw"bad function definition argument "+R(this.C[this.l]);var f=this.C[this.l].name,g=[],h=!1;this.l++;Z(this,0,"[")&&(h=!0,g=Og(this,!0));
b.push({name:f,type:e,ah:g,size:1,w:[],Oc:h});if(Z(this,0,","))this.l++;else if(Z(this,0,")"))break;else throw"syntax error in function definition "+R(this.C[this.l]);}this.l++;if(!Z(this,0,"{"))throw"block expected after function header "+R(this.C[this.l]);this.l++;return new ih(c,d.name,a,b)}if(this.l>=this.C.length)throw"no more tokens";var c=this.C[this.l];if(this.C[this.l]instanceof dg)switch(c.name){case "const":if(!Mg(this,1,cg)||!Z(this,2,"="))throw'syntax error for "const" '+R(c);var d=this.C[this.l+
1];this.l+=3;var e=Ng(this,25);e=e.F(this);if(!(e instanceof U))throw"non-constant expression in constant definition "+R(this.C[this.l]);if(!Z(this,0,";"))throw"missing semicolon "+R(c);this.l++;return[new yg(c,d.name,e)];case "int":case "bool":case "fixed":if(!Mg(this,1,cg))throw'unexpected token after "'+c.name+'" '+R(c);return Z(this,2,"(")?[b.call(this)]:a.call(this);case "void":return[b.call(this)];case "if":this.l++;var f=Og(this);if(1!==f.length)throw'bad condition in "if" statement '+R(this.C[this.l]);
var g=new Bg(c,f[0]);Z(this,0,"{")?this.l++:g.Aa=!0;return[g];case "when":this.l++;f=Og(this);if(1!==f.length)throw'bad condition in "when" statement '+R(this.C[this.l]);if(!Z(this,0,"{"))throw'block expected after "when" statement '+R(this.C[this.l]);this.l++;return[new Eg(c,f[0])];case "switch":this.l++;f=Og(this);if(1!==f.length)throw'bad expression in "switch" statement '+R(this.C[this.l]);if(!Z(this,0,"{"))throw'block expected after "switch" statement '+R(this.C[this.l]);this.l++;return[new jh(c,
f[0])];case "case":this.l++;e=Ng(this);if(!Z(this,0,":"))throw'missing colon after "case" '+R(this.C[this.l]);this.l++;return[new kh(c,e)];case "default":if(!Z(this,1,":"))throw'missing colon after "default" '+R(this.C[this.l]);this.l+=2;return[new kh(c,null)];case "goto":if(!Mg(this,1,cg))throw'missing label after "goto" '+R(this.C[this.l]);d=this.C[this.l+1];this.l+=2;return[new lh(c,d.name)];case "while":this.l++;f=Og(this);if(1!==f.length)throw'bad condition in "while" statement '+R(this.C[this.l]);
if(Z(this,0,";"))return this.l++,[new mh(c,f[0])];if(!Z(this,0,"{"))throw'block expected after "while" statement '+R(this.C[this.l]);this.l++;return[new nh(c,f[0])];case "do":if(!Z(this,1,"{"))throw'block expected after "do" statement '+R(this.C[this.l]);this.l+=2;return[new oh(c)];case "for":if(!Z(this,1,"("))throw'"for" syntax error '+R(c);this.l+=2;d=null;var h=Pf;if(Z(this,0,";"))e=null;else{if(Z(this,0,"var")||hh(this)){if(!Mg(this,1,cg))throw'bad variable declaration in "for" statement '+R(this.C[this.l]);
h=gh(this.C[this.l]);this.l++;d=this.C[this.l]}e=Ng(this);if(!Z(this,0,";"))throw'semicolon expected in "for" statement '+R(this.C[this.l]);}this.l++;if(Z(this,0,";"))g=null;else if(g=Ng(this),!Z(this,0,";"))throw'semicolon expected in "for" statement '+R(this.C[this.l]);this.l++;if(Z(this,0,")"))f=null;else if(f=Ng(this),!Z(this,0,")"))throw'semicolon expected in "for" statement '+R(this.C[this.l]);this.l++;if(!Z(this,0,"{"))throw'block expected after "for" statement '+R(this.C[this.l]);this.l++;
return[new ph(c,d,h,e,g,f)];case ";":return this.l++,[new qh(c)];case "{":return this.l++,[new rh(c)];case "}":this.l++;if(Z(this,0,"else")){this.l++;if(Z(this,0,"if")){this.l++;f=Og(this);if(1>f.length)throw'empty condition in "if" statement '+R(this.C[this.l]);1<f.length&&(g=new og(c),g.children=f.slice(0,-1).map(function(a){a instanceof V&&(a.tb=!1);return a}),f=f.slice(-1));if(!Z(this,0,"{"))throw'block expected after "if" statement '+R(this.C[this.l]);this.l++;return[new Cg(c,f[0])]}if(!Z(this,
0,"{"))throw'block expected after "else" statement '+R(this.C[this.l]);this.l++;return[new Dg(c)]}return[new Jg(c)];case "else":throw'unexpected "else" '+R(this.C[this.l]);case "onevent":if(!Mg(this,1,cg))throw'unexpected token after "onevent" '+R(c);if(!Z(this,2,"{"))throw'block expected after "onevent" statement '+R(this.C[this.l]);d=this.C[this.l+1];this.l+=3;return[new sh(c,d.name)];case "return":this.l++;Z(this,0,";")?e=null:e=Ng(this);if(!Z(this,0,";"))throw"missing semicolon "+R(c);this.l++;
return[new th(c,e)];case "break":d=null;Mg(this,1,cg)&&(d=this.C[this.l+1],this.l++);if(!Z(this,1,";"))throw"missing semicolon "+R(c);this.l+=2;return[new uh(c,!1,d?d.name:null)];case "continue":d=null;Mg(this,1,cg)&&(d=this.C[this.l+1],this.l++);if(!Z(this,1,";"))throw"missing semicolon "+R(c);this.l+=2;return[new uh(c,!0,d?d.name:null)]}if(Mg(this,0,cg)&&Z(this,1,"(")&&(d=this.C[this.l],Qf(this.pa,d.name)))return this.l++,[new Hg(c,d.name,Og(this))];if(Mg(this,0,cg)&&Z(this,1,":"))return d=this.C[this.l],
this.l+=2,[new vh(c,d.name)];e=Ng(this);e.tb=!1;if(!Z(this,0,";"))throw"missing semicolon "+(this.l<this.C.length?R(this.C[this.l]):"eof");this.l++;e=e.F(this);return[new Ag(e)]};
w.Ne=function(a){if(a instanceof ih){for(var b=0;b<a.B.length;b++)a.B[b].size=1,a.B[b].w=a.B[b].ah.map(function(c){c=c.F(this);if(!(c instanceof U))throw"non-constant expression in argument dimension "+R(c.head);if(0>=c.n||Math.round(c.n)!==c.n)throw"bad value for argument dimension "+R(c.head);a.B[b].size*=c.n;return c.n},this),this.Dd(a.B[b].name,a.B[b].size,a.B[b].w,this.Na,a.B[b].type,a.B[b].Oc),this.Na+=a.B[b].Oc?1:a.B[b].size;a.Qa[1]={Za:this.Za.slice(),labels:this.labels.slice()}}else a instanceof
ph?a.ga&&(this.Dd(a.ga.name,1,[1],this.Na,a.Oa),this.Na+=1,a.Qa[1]={Za:this.Za.slice(),labels:this.labels.slice()}):wb.prototype.Ne.call(this,a)};w.Pd=function(){this.Za=this.fg;this.labels=this.eg};w.ua=function(a){a&&(this.Za=a.Za,this.labels=a.labels)};w.getContext=function(){return{Za:this.Za,labels:this.labels.slice()}};function wh(a,b,c,d,e,f,g){Of.call(this,a,b,c,d,e);this.zb=f;this.Oc=g||!1}wh.prototype=Object.create(Of.prototype);w=wh.prototype;w.constructor=wh;
w.sd=function(a,b){return this.zb?this.Oc?[12288|a.v,20480|this.offset,a.pa.b,20480|(b||0),a.pa.b]:[12288|a.v,20480|this.offset+(b||0),a.pa.b]:[12288|this.offset+(b||0)]};w.ef=function(a,b){return this.zb?this.Oc?[12288|a.v,20480|this.offset,a.pa.b,24576|(b||0),a.pa.b]:[12288|a.v,24576|this.offset+(b||0),a.pa.b]:[16384|this.offset+(b||0)]};w.De=function(a){return this.zb?this.Oc?[12288|a.v,20480|this.offset,a.pa.b,32770,20480,a.pa.b]:[12288|a.v,32770,20480|this.offset,a.pa.b]:[20480|this.offset,this.size]};
w.Ff=function(a){return this.zb?this.Oc?[12288|a.v,20480|this.offset,a.pa.b,32770,24576,a.pa.b]:[12288|a.v,32770,24576|this.offset,a.pa.b]:[24576|this.offset,this.size]};Ff.prototype.Dd=function(a,b,c,d,e,f){this.Za.push(new wh(a,b,c,d,e,this.zb,f))};function xh(a){V.call(this,a,4,null)}xh.prototype=Object.create(V.prototype);xh.prototype.constructor=xh;w=Ff.prototype;
w.sg=function(a){var b=new xh(a,this.zb,this.Na);b.Da={na:function(b,d){var c;a:{for(c=0;c<b.df.length;c++)if(b.df[c].Ef===a.name){c=b.df[c];break a}c=null}return c?c.resultType:(c=Xf(b,a.name))&&c.na?c.na(b,c,d):Pf}};return b};
w.hg=function(){this.Na=this.pa.Na;this.zb=!1;for(var a=[],b=0;b<this.h.length;b++){if(0<=[Jg,Cg,Dg].indexOf(this.h[b].constructor)){if(0===a.length)throw"unexpected end of block "+R(this.h[b].head);var c=a.pop();this.Na=c.Na;this.zb=c.zb;c.jh.Qa[0]={Za:this.Za.slice(),labels:this.labels.slice()};this.Za.splice(c.mh);this.labels.pop();0===a.length&&(this.Aa=fg)}0<=[Bg,Eg,jh,nh,rh,ph,sh,ih,Cg,Dg].indexOf(this.h[b].constructor)&&(a.push({Na:this.Na,zb:this.zb,mh:this.Za.length,jh:this.h[b]}),this.labels.push([]),
this.h[b]instanceof ih&&(this.zb=!0,this.Aa=this.h[b].resultType,this.Na=0));this.Ne(this.h[b]);if(this.h[b]instanceof vh){c=this.h[b].label;for(var d=this.labels.length-1,e=0;e<this.labels[d].length;e++)if(this.labels[d][e].label===c)throw'duplicate label "'+c+'"';this.labels[d].push({label:c})}}this.fg=this.Za.slice();this.eg=this.labels};
w.Dg=function(){for(var a=1;a<this.h.length;)this.h[a]instanceof mh&&this.h[a-1]instanceof Jg?this.h.splice(a-1,1):a++;this.h.forEach(function(a){a instanceof ih&&(this.df.push(a),this.Aa=a.resultType)},this);for(a=0;a<this.h.length-1;a++)this.h[a]instanceof vh&&(this.h[a+1]instanceof nh?this.h[a+1].label=this.h[a].label:this.h[a+1]instanceof oh?this.h[a+1].label=this.h[a].label:this.h[a+1]instanceof ph?this.h[a+1].label=this.h[a].label:this.h[a+1]instanceof jh&&(this.h[a+1].label=this.h[a].label))};
w.Fg=function(){for(var a=0;a<this.h.length;a++)(this.h[a]instanceof sh||this.h[a]instanceof ih)&&this.o.push(this.h[a])};function yh(a,b){for(var c=a.length-1;0<=c;c--)for(var d=a[c].length-1;0<=d;d--)if(a[c][d].label===b)return a[c][d];return null}
w.u=function(){this.hb=[];this.Pd();this.Vb=[];this.rc=this.kc=this.Vc=this.pa.b-2;this.v=this.rc+1;this.gg=[];var a=this.o.map(function(a){this.La=0;this.ua(a.Qa[0]);this.Jf=a instanceof wg||a instanceof ih;this.zb=a instanceof ih;this.Vb=[];a=a.u(this,!0);Vg(a);return{Fd:a,mapping:this.Vb}},this);if(0<this.hb.length)throw"internal";for(var b=0,c=0;c<this.o.length;c++)this.o[c]instanceof vg&&b++;var d=[],e={},f=[];this.Vb=[];for(c=0;c<this.o.length;c++){var g=1+2*b+f.length;this.o[c]instanceof sh||
this.o[c]instanceof vg?(d.push({id:Sf(this.pa,this.o[c].bf),offset:f.length}),f=f.concat(a[c].Fd)):this.o[c]instanceof wg?(e[this.o[c].Ng]=f.length,f=f.concat(a[c].Fd)):this.o[c]instanceof ih&&(e[this.o[c].Ef]=f.length,f=f.concat(a[c].Fd));this.Vb=this.Vb.concat(a[c].mapping.map(function(a){return new Nf(a.Lg,a.line,a.Fa,a.Ob+g)}))}a=[1+2*d.length];for(c=0;c<d.length;c++)a=a.concat(d[c].id,1+2*d.length+d[c].offset);for(c=0;c<f.length;c++)if("string"===typeof f[c]){if(void 0===e[f[c]])throw zh(f[c]),
'unknown function "'+f[c]+'"';f[c]=53248|e[f[c]]+a.length}return a.concat(f)};
w.rg=function(a){for(var b=a.head.name,c=0;c<this.o.length;c++)if(this.o[c]instanceof ih&&this.o[c].Ef===b){if(a.children.length!==this.o[c].B.length)throw"wrong number of arguments "+R(a.head);b=a.tb?[b,12288|this.rc]:[b];this.zb?0<this.Na&&(b=[12288|this.v,4096|this.Na,32770,16384|this.v].concat(b).concat(12288|this.v,4096|this.Na,32771,16384|this.v)):b=[4096|this.Na,16384|this.v].concat(b);for(var d=[],e=0;e<a.children.length;e++){if(this.o[c].B[e].size!==a.children[e].nb)throw"incompatible size "+
R(a.children[e].head);if(this.o[c].B[e].Oc){if(!(a.children[e]instanceof kg))throw"variable reference expected "+R(a.children[e].head);if(this.o[c].B[e].type!==a.children[e].resultType)throw"variable reference type mismatch "+R(a.children[e].head);}if(this.o[c].B[e].Oc){var f=Wf(this,a.children[e]);d=d.concat(f.zb?f.Oc?[12288|this.v,20480|f.offset,this.pa.b]:[12288|this.v,4096|f.offset,32770]:[4096|f.offset]).concat(this.zb?[12288|this.v,24576|e+this.Na,this.pa.b]:16384|e+this.Na)}else a.children[e]=
ah(a.children[e],this.o[c].B[e].type,this).F(this),d=d.concat(a.children[e].u(this)).concat(this.qb(a.children[e].resultType,this.o[c].B[e].type)).concat(this.zb?[12288|this.v,24576|e+this.Na,this.pa.b]:16384|e+this.Na)}return d.concat(b)}return null};function Ah(a){a=a.trim();if(""===a)return!1;var b=["#","//","/*"].map(function(b){b=a.indexOf(b);return 0>b?a.length:b}).sort(function(a,b){return a-b})[0];return b<a.length?"#"!==a[b]:/[;{]/.test(a)}
ig.prototype.u=function(a){return Rg(Math.round(this.n*a.rb))};function rh(a){X.call(this,a,3)}rh.prototype=Object.create(X.prototype);rh.prototype.constructor=rh;rh.prototype.F=function(a){gg(this.children,a);return this};rh.prototype.u=function(a){var b=a.getContext();tg(this,a);a.ua(this.Qa[0]);var c=S.prototype.u.call(this,a);a.ua(b);return c};function qh(a){X.call(this,a)}qh.prototype=Object.create(X.prototype);qh.prototype.constructor=qh;qh.prototype.u=function(){return[]};
function nh(a,b){Fg.call(this,a,b);this.label=null}nh.prototype=Object.create(Fg.prototype);nh.prototype.constructor=nh;nh.prototype.u=function(a){if(null==this.Ga&&0===this.children.length)return[];var b=a.getContext();tg(this,a);var c=[],d=a.La;a.Oa.push({});null!=this.Ga&&(c=Tg(this.Ga,a));Uf(a,c);a.ua(this.Qa[0]);this.children.forEach(function(b){a.La=d+c.length;c=c.concat(b.u(a))});c=c.concat(36864|-c.length&4095);Vf(a,c);Bh(c,0,c.length,this.label);a.Oa.pop();a.ua(b);return c};
function oh(a){X.call(this,a,3);this.label=this.Ga=null}oh.prototype=Object.create(X.prototype);oh.prototype.constructor=oh;oh.prototype.Bg=function(a){if(!(a instanceof mh))throw'unexpected closing statement for "do"';this.Ga=a.Ga};
oh.prototype.u=function(a){if(null==this.Ga&&0===this.children.length)return[];var b=a.getContext();tg(this,a);var c=[],d=a.La;a.Oa.push({});a.ua(this.Qa[0]);this.children.forEach(function(b){a.La=d+c.length;c=c.concat(b.u(a))});null!=this.Ga&&(c=c.concat(Tg(new V(new dg(this.Ga.head.Ad,this.Ga.head.hd,this.Ga.head.fd,"not"),0,Lg(a,"!",0),[this.Ga]),a)),Uf(a,c),Vf(a,c,0));Bh(c,0,c.length,this.label);a.Oa.pop();a.ua(b);return c};function mh(a,b){X.call(this,a,5);this.Ga=b}mh.prototype=Object.create(X.prototype);
mh.prototype.constructor=mh;function ph(a,b,c,d,e,f){X.call(this,a,3);d&&(d.tb=!1);f&&(f.tb=!1);this.ga=b;this.Oa=c;this.h=d;this.b=e;this.m=f;this.label=null;this.R=[]}ph.prototype=Object.create(X.prototype);w=ph.prototype;w.constructor=ph;w.Sa=function(a){S.prototype.Sa.call(this,a);this.h&&this.h.Sa(a);this.b&&this.b.Sa(a);this.m&&this.m.Sa(a)};w.F=function(a){this.h&&(this.h=this.h.F(a));this.b&&(this.b=this.b.F(a));this.m&&(this.m=this.m.F(a));gg(this.children,a);return this};
w.Od=function(a,b){this.R.push(b)};
w.u=function(a){var b=a.getContext();tg(this,a);a.ua(this.Qa[1]);var c=a.La,d=this.h?this.h.u(a):[];a.Oa.push({});var e=d.length;this.b&&(d=d.concat(Tg(this.b,a)),Uf(a,d));a.ua(this.Qa[0]);for(var f=0;f<this.children.length;f++)a.La=c+d.length,d=d.concat(this.children[f].u(a));a.ua(this.Qa[1]);f=d.length;a.La=c+d.length;eg(a,this.R[0]);this.m&&(d=d.concat(this.m.u(a)));d=d.concat(36864|e-d.length&4095);this.b&&Vf(a,d);Bh(d,f,d.length,this.label);a.Oa.pop();a.ua(b);return d};
function uh(a,b,c){X.call(this,a);this.M=b;this.label=c}uh.prototype=Object.create(X.prototype);uh.prototype.constructor=uh;function Ch(a,b){ug.call(this,a,b)}Ch.prototype=Object.create(ug.prototype);Ch.prototype.constructor=Ch;function Bh(a,b,c,d){for(var e=0;e<a.length;e++)if(a[e]instanceof Ch){var f=a[e].ka.label;if(null==f||f===d)a[e]=a[e].ka.M?36864|b-e&4095:36864|c-e&4095}}
function zh(a){if(a instanceof Ch){var b=a.ka.label;if(null!=b)throw"unknown "+(a.ka.M?"continue":"break")+' label "'+b+'"'+R(a.ka.head);throw'unexpected "'+(a.ka.M?"continue":"break")+'" '+R(a.ka.head);}}uh.prototype.u=function(a){if(0===a.Oa.length)throw(this.M?'"continue"':'"break"')+" outside loop "+R(this.head);tg(this,a);return[new Ch(a,this)]};function jh(a,b){X.call(this,a,3);this.o=b;this.label=null}jh.prototype=Object.create(X.prototype);jh.prototype.constructor=jh;
jh.prototype.u=function(a){var b=a.La,c=this.o.u(a).concat(16384|a.rc),d=a.getContext();a.ua(this.Qa[0]);var e=!(this.children[0]instanceof kh);e&&(c=c.concat(36864),Uf(a,c));a.Oa.push({});for(var f=!1,g=0;g<this.children.length;)if(a.La=b+c.length,this.children[g]instanceof kh){for(var h=[],k=!1;g<this.children.length&&this.children[g]instanceof kh;){if(null!=this.children[g].o){var m=this.children[g].o.F(a);if(!(m instanceof U))throw'non-constant expression in "case" '+R(this.children[g].head);
h.push(m.n)}else k=!0;g++}k?e&&(Vf(a,c),e=!1):(1===h.length?(f&&(c=c.concat(36869)),e&&Vf(a,c),c=c.concat(12288|a.rc).concat(Rg(h[0])).concat(40960|Lf.indexOf("eq"),0)):(f&&(c=c.concat(36864|4*h.length+1)),e&&Vf(a,c),h.forEach(function(b,d){c=c.concat(12288|a.rc).concat(Rg(b)).concat(40960|Lf.indexOf("ne"),4*(h.length-d)-1)}),c=c.concat(36864)),Uf(a,c),e=!0);f=!0}else c=c.concat(this.children[g].u(a)),f=!(this.children[g]instanceof uh)&&!(this.children[g]instanceof th),g++;Bh(c,-1,c.length,this.label);
a.Oa.pop();a.ua(d);return c};function kh(a,b){X.call(this,a);this.o=b}kh.prototype=Object.create(X.prototype);kh.prototype.constructor=kh;kh.prototype.u=function(){throw(this.o?'"case"':'"default"')+" outside switch "+R(this.head);};function vh(a,b){X.call(this,a);this.label=b}vh.prototype=Object.create(X.prototype);vh.prototype.constructor=vh;vh.prototype.u=function(a){a.label=this.label;yh(a.labels,this.label).Sg=a.La;return[]};function lh(a,b){X.call(this,a);this.label=b}lh.prototype=Object.create(X.prototype);
lh.prototype.constructor=lh;function Dh(a,b,c){ug.call(this,a,b);this.labels=c}Dh.prototype=Object.create(ug.prototype);Dh.prototype.constructor=Dh;Dh.prototype.u=function(a){var b=yh(this.labels,this.ka.label);if(null===b)throw'unknown label "'+this.ka.label+'" '+R(this.ka.head);return 36864|b.Sg-a&4095};lh.prototype.u=function(a){return[new Dh(a,this,a.labels.slice())]};function sh(a,b){X.call(this,a,3);this.bf=b}sh.prototype=Object.create(X.prototype);sh.prototype.constructor=sh;
sh.prototype.F=function(a){gg(this.children,a);return this};sh.prototype.u=function(a,b){if(b){b=a.getContext();tg(this,a);a.ua(this.Qa[0]);var c=S.prototype.u.call(this,a).concat(0);a.ua(b);return c}return[]};function ih(a,b,c,d){X.call(this,a,3);this.Ef=b;this.resultType=c;this.B=d}ih.prototype=Object.create(X.prototype);ih.prototype.constructor=ih;ih.prototype.Ag=function(a){a.Aa=this.resultType};ih.prototype.F=function(a){gg(this.children,a);return this};
ih.prototype.u=function(a,b){if(b){b=a.getContext();tg(this,a);a.ua(this.Qa[0]);var c=S.prototype.u.call(this,a).concat(57344);a.ua(b);return c}return[]};function th(a,b){X.call(this,a);b&&this.children.push(b)}th.prototype=Object.create(X.prototype);th.prototype.constructor=th;
th.prototype.Od=function(a){if(a.Aa===fg)throw'"return" outside function definition '+R(this.head);if("v"===a.Aa&&0<this.children.length)throw"unexpected return value in void function "+R(this.head);if("v"!==a.Aa&&0===this.children.length)throw"missing return value in non-void function "+R(this.head);0<this.children.length&&(this.children[0]=ah(this.children[0],a.Aa,a).F(a))};
th.prototype.u=function(a){tg(this,a);var b=[];0<this.children.length&&(b=this.children[0].u(a).concat(a.qb(this.children[0].resultType,a.Aa)).concat(16384|a.rc));return b.concat(57344)};var Gf=[{name:"abs",$c:1,na:function(a,b){return b[0]},Ce:function(){return!0},Jb:function(a,b,c,d){return[12288|d,28673]}},{name:"atan2",$c:2,ie:1,na:function(){return jg},Ce:function(a){return null!=Qf(a,"math.atan2")},Jb:function(a,b,c,d){return(c[0]===jg&&c[1]!==jg?[12288|d+1,4096|a.rb,32772,16384|d+1]:c[0]!==jg&&c[1]===jg?[12288|d,4096|a.rb,32772,16384|d]:[]).concat([4097,4096|d+1,4096|d,4096|d+2,49152|Qf(b,"math.atan2").id,12288|d+2,4096|Math.floor(32768/(a.rb*Math.PI)),32773])}},{name:"cos",
$c:1,ie:1,na:function(){return jg},Ce:function(a){return null!=Qf(a,"math.cos")},Jb:function(a,b,c,d){return[12288|d,4096|Math.round(32767/((c[0]===jg?a.rb:1)*Math.PI)),32772,16384|d,4097,4096|d,4096|d+1,49152|Qf(b,"math.cos").id,12288|d+1,4096|Math.floor(32768/a.rb),32773]}},Wg("rand","math.rand",0),{name:"random",$c:0,ie:1,na:function(){return jg},Ce:function(a){return null!=Qf(a,"math.rand")},Jb:function(a,b,c,d){return[4097,4096|d,49152|Qf(b,"math.rand").id,12288|d,28673,4096|Math.floor(32768/
a.rb),32773]}},{name:"stop",$c:0,na:function(){return"v"},Jb:function(){return[0]}},{name:"sin",$c:1,ie:1,na:function(){return jg},Ce:function(a){return null!=Qf(a,"math.sin")},Jb:function(a,b,c,d){return[12288|d,4096|Math.round(32767/((c[0]===jg?a.rb:1)*Math.PI)),32772,16384|d,4097,4096|d,4096|d+1,49152|Qf(b,"math.sin").id,12288|d+1,4096|Math.floor(32768/a.rb),32773]}},{name:"sqrt",$c:1,ie:6,na:function(){return jg},Jb:function(a,b,c,d){b=Rg(c[0]===jg?a.rb:a.rb*a.rb);return[4096|a.rb,16384|d+1,4106,
16384|d+2,12288|d,16384|d+4].concat(b).concat([16384|d+5,12288|d+1,16384|d+6,4097,4096|d+6,4096|d+5,4096|d+4,4096|d+3,49152|Qf(a.pa,"math.muldiv").id,12288|d+3,12288|d+1,32770,4098,32773,16384|d+1,12288|d+2,4097,32771,16384|d+2,12288|d+2,4096,40960|Lf.indexOf("le"),-(23+b.length)&65535,12288|d+1])}}];var vb={name:"thymio-II",maxVarSize:620,variables:[{name:"_id",size:1},{name:"event.source",size:1},{name:"event.args",size:32},{name:"_fwversion",size:2},{name:"_productId",size:1},{name:"buttons._raw",size:5},{name:"button.backward",size:1},{name:"button.left",size:1},{name:"button.center",size:1},{name:"button.forward",size:1},{name:"button.right",size:1},{name:"buttons._mean",size:5},{name:"buttons._noise",size:5},{name:"prox.horizontal",size:7},{name:"prox.comm.rx._payloads",size:7},{name:"prox.comm.rx._intensities",
size:7},{name:"prox.comm.rx",size:1},{name:"prox.comm.tx",size:1},{name:"prox.ground.ambiant",size:2},{name:"prox.ground.reflected",size:2},{name:"prox.ground.delta",size:2},{name:"motor.left.target",size:1},{name:"motor.right.target",size:1},{name:"_vbat",size:2},{name:"_imot",size:2},{name:"motor.left.speed",size:1},{name:"motor.right.speed",size:1},{name:"motor.left.pwm",size:1},{name:"motor.right.pwm",size:1},{name:"acc",size:3},{name:"temperature",size:1},{name:"rc5.address",size:1},{name:"rc5.command",
size:1},{name:"mic.intensity",size:1},{name:"mic.threshold",size:1},{name:"mic._mean",size:1},{name:"timer.period",size:2},{name:"acc._tap",size:1}],localEvents:[{name:"button.backward"},{name:"button.left"},{name:"button.center"},{name:"button.forward"},{name:"button.right"},{name:"buttons"},{name:"prox"},{name:"prox.comm"},{name:"tap"},{name:"acc"},{name:"mic"},{name:"sound.finished"},{name:"temperature"},{name:"rc5"},{name:"motor"},{name:"timer0"},{name:"timer1"}],nativeFunctions:[{name:"_system_reboot",
args:[]},{name:"_system_settings_read",args:[1,1]},{name:"_system_settings_write",args:[1,1]},{name:"_system_settings_flash",args:[]},{name:"math.copy",args:[-1,-1]},{name:"math.fill",args:[-1,1]},{name:"math.addscalar",args:[-1,-1,1]},{name:"math.add",args:[-1,-1,-1]},{name:"math.sub",args:[-1,-1,-1]},{name:"math.mul",args:[-1,-1,-1]},{name:"math.div",args:[-1,-1,-1]},{name:"math.min",args:[-1,-1,-1]},{name:"math.max",args:[-1,-1,-1]},{name:"math.clamp",args:[-1,-1,-1,-1]},{name:"math.dot",args:[1,
-1,-1,1]},{name:"math.stat",args:[-1,1,1,1]},{name:"math.argbounds",args:[-1,1,1]},{name:"math.sort",args:[-1]},{name:"math.muldiv",args:[-1,-1,-1,-1]},{name:"math.atan2",args:[-1,-1,-1]},{name:"math.sin",args:[-1,-1]},{name:"math.cos",args:[-1,-1]},{name:"math.rot2",args:[2,2,1]},{name:"math.sqrt",args:[-1,-1]},{name:"math.rand",args:[-1]},{name:"_leds.set",args:[1,1]},{name:"sound.record",args:[1]},{name:"sound.play",args:[1]},{name:"sound.replay",args:[1]},{name:"sound.system",args:[1]},{name:"leds.circle",
args:[1,1,1,1,1,1,1,1]},{name:"leds.top",args:[1,1,1]},{name:"leds.bottom.left",args:[1,1,1]},{name:"leds.bottom.right",args:[1,1,1]},{name:"sound.freq",args:[1,1]},{name:"leds.buttons",args:[1,1,1,1]},{name:"leds.prox.h",args:[1,1,1,1,1,1,1,1]},{name:"leds.prox.v",args:[1,1]},{name:"leds.rc",args:[1]},{name:"leds.sound",args:[1]},{name:"leds.temperature",args:[1,1]},{name:"sound.wave",args:[142]},{name:"prox.comm.enable",args:[1]},{name:"sd.open",args:[1,1]},{name:"sd.write",args:[-1,1]},{name:"sd.read",
args:[-1,1]},{name:"sd.seek",args:[1,1]},{name:"_rf.nodeid",args:[1]},{name:"_poweroff",args:[]}]};function If(a,b){this.pa=a;this.b=b}function Eh(a){var b={};a.pa.Xa.forEach(function(a){b[a.name]=a.offset});b._userdata=a.pa.Na;b._topdata=a.pa.b;b["_ev.init"]=65535;a.pa.vd.forEach(function(a,d){b["_ev."+a.name]=65534-d});a.pa.Lb.forEach(function(a){b["_nf."+a.name]=a.id});return b}
function Hf(a){for(var b=a.b.split("\n"),c=[],d=Eh(a),e=0;2>e;e++){c=[];var f=null;b.forEach(function(a,b){var g=/^\s*(;.*)?$/.exec(a);if(!g)if(g=/^\s*([\w_.]+:)\s*(;.*)?$/i.exec(a))f=g[1].slice(0,-1),d[f]=c.length;else if(g=/^\s*([\w_.]+:)?\s*([a-z0-9.]+)([-+a-z0-9\s._,=]*)(;.*)?$/i.exec(a)){if(g[1]&&(f=g[1].slice(0,-1),d[f]=c.length),a=g[2],g=g[3].trim(),a){var h=0<g.length?g.split(",").map(function(a){return a.trim().split(/\s+/)}):[];h=[].concat.apply([],h);g=Fh[a];if(void 0==g)throw'Unknown instruction "'+
a+'" (line '+(b+1).toString(10)+")";if(-1!==g.Mb&&(g.Mb||0)!=h.length)throw"Wrong number of arguments (line "+(b+1).toString(10)+")";void 0!==g.code?c=c.concat(g.code):g.Fb&&(a=h.map(function(a){/^[a-z]+=/.test(a)&&(a=a.replace(/^[a-z]+=/,""));return/^(0x[0-9a-f]+|[0-9]+)$/i.test(a)?parseInt(a,0):a}),c=c.concat(g.Fb(c.length,a,f,1==e?d:null,b+1)));f&&d[f]!==c.length&&(f=null)}}else throw"Syntax error (line "+(b+1).toString(10)+")";},a)}return c}
function Gh(a,b,c){function d(d){if(null==b)return 0;if(/^(0x[0-9a-f]+|[0-9]+)$/i.test(d))return parseInt(d,0);if(!b.hasOwnProperty(d))throw'Unknown symbol "'+a+'" (line '+c.toString(10)+")";return b[d]}if("string"===typeof a){for(var e=0,f=!1,g=0;g<a.length;){var h=/^(\+|-|[._a-z0-9]+)/i.exec(a.slice(g));if(null==h)throw"Syntax error (line "+c.toString(10)+")";switch(h[0]){case "+":f=!1;break;case "-":f=!0;break;default:e+=f?-d(h[0]):d(h[0])}g+=h[0].length}return e}return a}
var Fh={dc:{Mb:-1,Fb:function(a,b,c,d,e){return b.map(function(a){a=Gh(a,d,e);return a&65535})}},equ:{Mb:1,Fb:function(a,b,c,d,e){if(!c)throw'No label for pseudo-instruction "equ" (line '+e.toString(10)+")";d&&(d[c]=Gh(b[0],d,e));return[]}},stop:{code:[0]},"push.s":{Mb:1,Fb:function(a,b,c,d,e){a=Gh(b[0],d,e);if(4096<=a||4096<-a)throw"Small integer overflow (line "+e.toString(10)+")";return[4096|a&4095]}},push:{Mb:1,Fb:function(a,b,c,d,e){return[8192,Gh(b[0],d,e)&65535]}},load:{Mb:1,Fb:function(a,
b,c,d,e){a=Gh(b[0],d,e);if(0>a||4096<=a)throw"Data address out of range (line "+e.toString(10)+")";return[12288|a&4095]}},store:{Mb:1,Fb:function(a,b,c,d,e){a=Gh(b[0],d,e);if(0>a||4096<=a)throw"Data address out of range (line "+e.toString(10)+")";return[16384|a&4095]}},"load.ind":{Mb:2,Fb:function(a,b,c,d,e){a=Gh(b[0],d,e);if(0>a||4096<=a)throw"Data address out of range (line "+e.toString(10)+")";b=Gh(b[1],d,e);return[20480|a&4095,b&65535]}},"store.ind":{Mb:2,Fb:function(a,b,c,d,e){a=Gh(b[0],d,e);
if(0>a||4096<=a)throw"Data address out of range (line "+e.toString(10)+")";b=Gh(b[1],d,e);return[24576|a&4095,b&65535]}},neg:{code:[28672]},abs:{code:[28673]},bitnot:{code:[28674]},not:{Fb:function(a,b,c,d,e){throw"Unary not not implemented in the VM (line "+e.toString(10)+")";}},sl:{code:[32768]},asr:{code:[32769]},add:{code:[32770]},sub:{code:[32771]},mult:{code:[32772]},div:{code:[32773]},mod:{code:[32774]},bitor:{code:[32775]},bitxor:{code:[32776]},bitand:{code:[32777]},eq:{code:[32778]},ne:{code:[32779]},
gt:{code:[32780]},ge:{code:[32781]},lt:{code:[32782]},le:{code:[32783]},or:{code:[32784]},and:{code:[32785]},jump:{Mb:1,Fb:function(a,b,c,d,e){return[36864|Gh(b[0],d,e)-a&4095]}},"jump.if.not":{Mb:2,Fb:function(a,b,c,d,e){c=Fh[b[0]];if(void 0==c||void 0==c.code||1!==c.code.length||32768!==(c.code[0]&61440))throw'Unknown op "'+b[0]+'" for jump.if.not (line '+e.toString(10)+")";b=Gh(b[1],d,e);return[40960|c.code[0]&255,b-a&65535]}},"do.jump.when.not":{Mb:2,Fb:function(a,b,c,d,e){c=Fh[b[0]];if(void 0==
c||void 0==c.code||1!==c.code.length||32768!==(c.code[0]&61440))throw'Unknown op "'+b[0]+'" for do.jump.when.not (line '+e.toString(10)+")";b=Gh(b[1],d,e);return[41216|c.code[0]&255,b-a&65535]}},"do.jump.always":{Mb:2,Fb:function(a,b,c,d,e){c=Fh[b[0]];if(void 0==c||void 0==c.code||1!==c.code.length||32768!==(c.code[0]&61440))throw'Unknown op "'+b[0]+'" for do.jump.always (line '+e.toString(10)+")";b=Gh(b[1],d,e);return[41728|c.code[0]&255,b-a&65535]}},emit:{Mb:3,Fb:function(a,b,c,d,e){a=Gh(b[0],d,
e);if(0>a||4096<=a)throw"Event id out of range (line "+e.toString(10)+")";c=Gh(b[1],d,e);b=Gh(b[2],d,e);return[45056|a&4095,c&65535,b&65535]}},callnat:{Mb:1,Fb:function(a,b,c,d,e){a=Gh(b[0],d,e);if(0>a||4096<=a)throw"Native call id out of range (line "+e.toString(10)+")";return[49152|a&4095]}},callsub:{Mb:1,Fb:function(a,b,c,d,e){a=Gh(b[0],d,e);if(0>a||4096<=a)throw"Subroutine address out of range (line "+e.toString(10)+")";return[53248|a&4095]}},ret:{code:[57344]}};function Hh(a,b,c){this.id=a;this.o=b;if(c instanceof ArrayBuffer)this.h=c;else if(c){for(a=b=0;a<c.length;a++)b="string"===typeof c[a]?b+(1+c[a].length):b+2;b=new ArrayBuffer(b);for(var d=new DataView(b),e=a=0;a<c.length;a++)if("string"===typeof c[a]){d.setUint8(e++,c[a].length);for(var f=0;f<c[a].length;f++)d.setUint8(e++,c[a].charCodeAt(f))}else 32768>c[a]?d.setInt16(e,c[a],!0):d.setUint16(e,c[a],!0),e+=2;this.h=b}else this.h=new ArrayBuffer(0)}
function Ih(a){function b(a){for(var b=[],d=0,e=0;e<a.length;e++)if(a[e]){for(var f=c.getUint8(d),g="",t=0;t<f;t++)g+=String.fromCharCode(c.getUint8(d+1+t));b.push(g);d+=1+f}else b.push(c.getUint16(d,!0)),d+=2;return b}var c=new DataView(a.h);switch(a.id){case Jh:var d=b([!0,!1,!1,!1,!1,!1,!1,!1]);a.nodeName=d[0];a.ae=d[2];a.oe=d[3];a.Cd=d[4];break;case Kh:d=b([!1,!0]);a.Na=d[0];a.R=d[1];break;case Lh:d=b([!0,!0]);break;case Mh:var e=[!0,!0,!1];d=b(e);a.functionName=d[0];a.v=d[2];for(var f=0;f<a.v;f++)e.push(!1),
e.push(!0);d=b(e);a.ea=[];for(f=0;f<a.v;f++)a.ea.push({size:d[3+2*f]-(d[3+2*f]&32768?65536:0),name:d[4+2*f]});break;case Nh:c.getUint16(0,!0);a.Ec=[];for(f=2;f<c.byteLength;f+=2)a.Ec.push(c.getUint16(f,!0));break;case Oh:a.b=c.getUint16(0,!0);f=c.getUint16(2,!0);a.flags={flags:f,vh:0!==(f&1),Ah:0!==(f&2),wh:0!==(f&4)};break;case Ph:a.b=c.getUint16(2,!0);a.result=c.getUint16(4,!0);break;case Qh:a.m=c.getUint16(0,!0);c.getUint16(2,!0);d=[];for(f=4;f<c.byteLength;f+=2)d.push(c.getUint16(f,!0));a.Fd=
d;break;case Rh:case Sh:case Th:case Uh:case Vh:case Wh:case Xh:a.m=c.getUint16(0,!0);break;case Yh:case Zh:a.m=c.getUint16(0,!0);a.b=c.getUint16(2,!0);break;case $h:a.m=c.getUint16(0,!0);c.getUint16(2,!0);c.getUint16(4,!0);break;case ai:a.m=c.getUint16(0,!0);c.getUint16(2,!0);d=[];for(f=4;f<c.byteLength;f+=2)d.push(c.getUint16(f,!0));break;case bi:a.version=c.getUint16(0,!0)}}
function ci(a){var b=new ArrayBuffer(6+a.h.byteLength),c=new DataView(b);c.setUint16(0,a.h.byteLength,!0);c.setUint16(2,a.o,!0);c.setUint16(4,a.id,!0);(new Uint8Array(b)).set(new Uint8Array(a.h),6);return b}Hh.prototype.ob=function(){var a=new Hh(this.id,this.o,this.h);Ih(a);return a};Hh.prototype.toString=function(){var a=di[this.id]||"0x"+this.id.toString(16);a+=" from "+this.o.toString(10);0<=this.m&&(a+=" to "+this.m.toString());return a};
var Jh=36864,Kh=36865,Lh=36866,Mh=36867,Nh=36869,Oh=36874,Ph=36875,Qh=40961,Sh=40962,Th=40963,Uh=40964,Vh=40965,Wh=40966,Xh=40967,Yh=40968,Zh=40969,Rh=40970,$h=40971,ai=40972,bi=40977,di={36864:"description",36865:"namedVariableDescription",36866:"localEventDescription",36867:"nativeFunctionDescription",36869:"variables",36874:"executionStateChanged",36876:"nodePresent",40960:"getDescription",40961:"setBytecode",40962:"reset",40963:"run",40964:"pause",40965:"step",40966:"stop",40967:"getExecutionState",
40968:"breakpointSet",40969:"breakpointClear",40970:"breakpointClearAll",40971:"getVariables",40972:"setVariables",40976:"getNodeDescription",40977:"listNodes"};function ei(a){this.Md=a&&a.Md||54321;this.Xa=a&&a.Xa||[];this.vd=a&&a.vd||[];this.Lb=a&&a.Lb||[];this.ae=a&&a.ae||500;this.oe=a&&a.oe||200;this.Cd=a&&a.Cd||200;a=[];for(var b=0,c=0;c<this.Xa.length;c++)this.Xa[c].offset=b,a=a.concat(this.Xa[c].S),b+=this.Xa[c].S.length;for(;a.length<this.Cd;)a.push(0);this.Ec=a;this.K=[];this.b=0;this.h=!1;this.m=!0;this.o=!1;this.stack=[];this.R=[];this.write=this.v=this.M=null}
ei.prototype.ob=function(){var a=new ei({Md:this.Md,Xa:this.Xa,vd:this.vd,Lb:this.Lb,ae:this.ae,oe:this.oe,Cd:this.Cd});a.ae=this.ae;a.oe=this.oe;a.Cd=this.Cd;a.K=this.K.slice();a.b=this.b;a.h=this.h;a.m=this.m;a.o=this.o;a.stack=this.stack.slice();a.R=this.R.slice();return a};
function fi(a,b,c){if(a.M)for(var d=0;d<a.Xa.length;d++)if(a.Xa[d].offset+a.Xa[d].S.length>b&&a.Xa[d].offset<b+c.length)for(var e=0;e<a.Xa[d].S.length;e++)0<=a.Xa[d].offset+e-b&&a.Xa[d].offset+e-b<c.length&&a.M(a.Xa[d].name,e,c[a.Xa[d].offset+e-b],a.Ec[a.Xa[d].offset+e]);c.forEach(function(a,c){this.Ec[b+c]=a},a)}function gi(a,b){a:{if(0<a.K.length)for(var c=1;c<a.K[0];c+=2)if(a.K[c]==b){b=a.K[c+1];break a}b=null}null!==b&&(a.h&&(c=new Hh(36872,a.Md,[a.b]),a.write&&a.write(ci(c))),a.b=b,a.h=!0)}
function hi(a){a.h=!1;a.m=!0;a.o=!1;if(0<a.K.length)for(var b=a.K[0];b<a.K.length;){var c=a.K[b];10==c>>>12&&(a.K[b]&=-513);b+=[1,1,2,1,1,2,2,1,1,1,2,3,1,1,1,1][c>>>12]}a.stack=[];for(b=0;b<a.Ec.length;b++)a.Ec[b]=0;a.ga&&a.ga();gi(a,65535)}
function ii(a){function b(a){return 32768<=a?a-65536:a}function c(a){switch(a){case 28672:d.stack.push(-d.stack.pop());break;case 28673:d.stack.push(Math.abs(d.stack.pop()));break;case 28674:d.stack.push(~d.stack.pop());break;case 32768:a=d.stack.pop();d.stack.push(b(d.stack.pop()<<a&65535));break;case 32769:a=d.stack.pop();d.stack.push(d.stack.pop()>>a);break;case 32770:d.stack.push(b(d.stack.pop()+d.stack.pop()&65535));break;case 32771:a=d.stack.pop();d.stack.push(b(d.stack.pop()-a&65535));break;
case 32772:d.stack.push(b(d.stack.pop()*d.stack.pop()&65535));break;case 32773:a=d.stack.pop();d.stack.push(b(Math.trunc(d.stack.pop()/a)&65535));break;case 32774:a=d.stack.pop();d.stack.push(b(d.stack.pop()%a&65535));break;case 32775:d.stack.push(b((d.stack.pop()|d.stack.pop())&65535));break;case 32776:d.stack.push(b((d.stack.pop()^d.stack.pop())&65535));break;case 32777:d.stack.push(b(d.stack.pop()&d.stack.pop()&65535));break;case 32778:d.stack.push(d.stack.pop()===d.stack.pop()?1:0);break;case 32779:d.stack.push(d.stack.pop()!==
d.stack.pop()?1:0);break;case 32780:a=d.stack.pop();d.stack.push(d.stack.pop()>a?1:0);break;case 32781:a=d.stack.pop();d.stack.push(d.stack.pop()>=a?1:0);break;case 32782:a=d.stack.pop();d.stack.push(d.stack.pop()<a?1:0);break;case 32783:a=d.stack.pop();d.stack.push(d.stack.pop()<=a?1:0);break;case 32784:a=d.stack.pop();d.stack.push(d.stack.pop()||a?1:0);break;case 32785:a=d.stack.pop();d.stack.push(d.stack.pop()&&a?1:0);break;default:throw"unknown op 0x"+a.toString(16);}}var d=a,e=a.K[a.b],f=e&4095;
switch(e>>>12){case 0:a.h=!1;break;case 1:a.stack.push(2048<=f?f-4096:f);break;case 2:a.b++;a.stack.push(b(a.K[a.b]));break;case 3:a.stack.push(a.Ec[f]);break;case 4:fi(a,f,[a.stack.pop()]);break;case 5:a.b++;e=a.K[a.b];var g=a.stack.pop();if(g>=e)throw"out of bounds";a.stack.push(a.Ec[f+g]);break;case 6:a.b++;e=a.K[a.b];g=a.stack.pop();if(g>=e)throw"Index out of bounds";fi(a,f+g,[a.stack.pop()]);break;case 9:a.b+=(2048<=f?f-4096:f)-1;break;case 10:var h=e&256;c(32768|e&255);f=0!=a.stack.pop();a.b++;
g=b(a.K[a.b]);if(h){h=a.b-1;if(e&512||!f)a.b+=g-2;a.K[h]=f?a.K[h]|512:a.K[h]&-513}else f||(a.b+=g-2);break;case 11:null(f);break;case 12:if(0>f||f>=a.Lb.length)throw"Native call index out of bounds";var k=a.Lb[f].ea.map(function(){return{p:this.stack.pop()}},a),m=[];a.Lb[f].ea.forEach(function(a,b){k[b].Jg=0===a.size?this.stack.pop():a.size},a);a.Lb[f].ea.forEach(function(a){0>a.size&&void 0===m[-a.size]&&(m[-a.size]=0)},a);m=m.map(function(a){return void 0!==a?this.stack.pop():a},a);a.Lb[f].ea.forEach(function(a,
b){0>a.size&&(k[b].Jg=m[-a.size])},a);var q=k.map(function(a){return this.Ec.slice(a.p,a.p+a.Jg)},a);e=!1;a.v&&(e=a.v(a.Lb[f].name,a,q));e||a.Lb[f].za(a,q);k.forEach(function(a,b){fi(this,a.p,q[b])},a);break;case 13:a.stack.push(a.b+1);a.b=f-1;break;case 14:a.b=a.stack.pop()-1;break;case 15:throw"op 0x"+e.toString(16)+" (reserved) not implemented";default:c(e)}a.b++}ei.prototype.Zb=function(){for(;this.h&&(ii(this),!this.m););};function ji(a){function b(a){a&=65535;return 32768<=a?a-65536:a}ei.call(this,{Md:a,Xa:[{name:"_id",S:[0]},{name:"event.source",S:[0]},{name:"event.args",S:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{name:"_fwversion",S:[0,0]},{name:"_productId",S:[0]},{name:"buttons._raw",S:[0,0,0,0,0]},{name:"button.backward",S:[0]},{name:"button.left",S:[0]},{name:"button.center",S:[0]},{name:"button.forward",S:[0]},{name:"button.right",S:[0]},{name:"buttons._mean",S:[0,0,0,0,0]},{name:"buttons._noise",
S:[0,0,0,0,0]},{name:"prox.horizontal",S:[0,0,0,0,0,0,0]},{name:"prox.comm.rx._payloads",S:[0,0,0,0,0,0,0]},{name:"prox.comm.rx._intensities",S:[0,0,0,0,0,0,0]},{name:"prox.comm.rx",S:[0]},{name:"prox.comm.tx",S:[0]},{name:"prox.ground.ambiant",S:[0,0]},{name:"prox.ground.reflected",S:[0,0]},{name:"prox.ground.delta",S:[0,0]},{name:"motor.left.target",S:[0]},{name:"motor.right.target",S:[0]},{name:"_vbat",S:[0,0]},{name:"_imot",S:[0,0]},{name:"motor.left.speed",S:[0]},{name:"motor.right.speed",S:[0]},
{name:"motor.left.pwm",S:[0]},{name:"motor.right.pwm",S:[0]},{name:"acc",S:[0,0,0]},{name:"temperature",S:[0]},{name:"rc5.address",S:[0]},{name:"rc5.command",S:[0]},{name:"mic.intensity",S:[0]},{name:"mic.threshold",S:[0]},{name:"mic._mean",S:[0]},{name:"timer.period",S:[0,0]},{name:"acc._tap",S:[0]},{name:"sd.present",S:[0]}],vd:[{name:"button.backward",description:"Backward button state changed"},{name:"button.left",description:"Left button state changed"},{name:"button.center",description:"Center button state changed"},
{name:"button.forward",description:"Forward button state changed"},{name:"button.right",description:"Right button state changed"},{name:"buttons",description:"Buttons values updated"},{name:"prox",description:"Proximity values updated"},{name:"prox.comm",description:"Data received on the proximity communication"},{name:"tap",description:"Tap detected"},{name:"acc",description:"Accelerometer values updated"},{name:"mic",description:"Microphone above threshold"},{name:"sound.finished",description:"Sound playback finished"},
{name:"temperature",description:"Temperature value updated"},{name:"rc5",description:"RC5 message received"},{name:"motor",description:"Motor timer"},{name:"timer0",description:"Timer 0"},{name:"timer1",description:"Timer 1"}],Lb:[{name:"_system_reboot",ea:[],za:function(){}},{name:"_system_settings_read",ea:[],za:function(){}},{name:"_system_settings_write",ea:[],za:function(){}},{name:"_system_settings_flash",ea:[],za:function(){}},{name:"math.copy",ea:[],za:function(a,b){for(a=0;a<b[0].length;a++)b[0][a]=
b[1][a]}},{name:"math.fill",ea:[],za:function(a,b){for(a=0;a<b[0].length;a++)b[0][a]=b[1][0]}},{name:"math.addscalar",ea:[{name:"r",size:-1},{name:"a",size:-1},{name:"b",size:1}],za:function(a,d){for(a=0;a<d[0].length;a++)d[0][a]=b(d[1][a]+d[2][0])}},{name:"math.add",ea:[{name:"r",size:-1},{name:"a",size:-1},{name:"b",size:-1}],za:function(a,d){for(a=0;a<d[0].length;a++)d[0][a]=b(d[1][a]+d[2][a])}},{name:"math.sub",ea:[{name:"r",size:-1},{name:"a",size:-1},{name:"b",size:-1}],za:function(a,d){for(a=
0;a<d[0].length;a++)d[0][a]=b(d[1][a]-d[2][a])}},{name:"math.mul",ea:[{name:"r",size:-1},{name:"a",size:-1},{name:"b",size:-1}],za:function(a,d){for(a=0;a<d[0].length;a++)d[0][a]=b(d[1][a]*d[2][a])}},{name:"math.div",ea:[{name:"r",size:-1},{name:"a",size:-1},{name:"b",size:-1}],za:function(a,d){for(a=0;a<d[0].length;a++)d[0][a]=b(Math.trunc(d[1][a]/d[2][a]))}},{name:"math.min",ea:[{name:"r",size:-1},{name:"a",size:-1},{name:"b",size:-1}],za:function(a,b){for(a=0;a<b[0].length;a++)b[0][a]=Math.min(b[1][a],
b[2][a])}},{name:"math.max",ea:[{name:"r",size:-1},{name:"a",size:-1},{name:"b",size:-1}],za:function(a,b){for(a=0;a<b[0].length;a++)b[0][a]=Math.max(b[1][a],b[2][a])}},{name:"math.clamp",ea:[{name:"r",size:-1},{name:"x",size:-1},{name:"low",size:-1},{name:"high",size:-1}],za:function(a,b){for(a=0;a<b[0].length;a++)b[0][a]=Math.min(Math.max(b[1][a],b[2][a]),b[3][a])}},{name:"math.dot",ea:[{name:"r",size:-1},{name:"a",size:-1},{name:"b",size:-1},{name:"shift",size:1}],za:function(a,b){for(var c=a=
0;c<b[0].length;c++)a+=b[1][c]*b[2][c];b[0][0]=a/Math.pow(2,b[3][0])}},{name:"math.stat",ea:[{name:"x",size:-1},{name:"min",size:1},{name:"max",size:1},{name:"mean",size:1}],za:function(a,b){a=0;b[1][0]=32767;b[2][0]=-32768;for(var c=0;c<b[0].length;c++)b[1][0]=Math.min(b[1][0],b[0][c]),b[2][0]=Math.max(b[2][0],b[0][c]),a+=b[0][c];b[3][0]=a/b[0].length}},{name:"math.argbounds",ea:[{name:"x",size:-1},{name:"argmin",size:1},{name:"argmax",size:1}],za:function(a,b){a=-Infinity;for(var c=Infinity,d=0;d<
b[0].length;d++)b[0][d]<c&&(c=b[0][d],b[1][0]=d),b[0][d]>a&&(a=b[0][d],b[2][0]=d)}},{name:"math.sort",ea:[{name:"x",size:-1}],za:function(a,b){b[0].sort(function(a,b){return a-b})}},{name:"math.muldiv",ea:[{name:"r",size:-1},{name:"a",size:-1},{name:"b",size:-1},{name:"c",size:-1}],za:function(a,d){for(a=0;a<d[0].length;a++)d[0][a]=b(d[1][a]*d[2][a]/d[3][a])}},{name:"math.atan2",description:"Atan2",ea:[{name:"r",size:-1},{name:"y",size:-1},{name:"x",size:-1}],za:function(a,b){b[2].forEach(function(a,
c){b[0][c]=Math.round(32767*Math.atan2(b[1][c],a)/Math.PI)})}},{name:"math.sin",description:"Sine",ea:[{name:"r",size:-1},{name:"theta",size:-1}],za:function(a,b){b[1].forEach(function(a,c){b[0][c]=Math.round(32767*Math.sin(a*Math.PI/32768))})}},{name:"math.cos",description:"Cosine",ea:[{name:"r",size:-1},{name:"theta",size:-1}],za:function(a,b){b[1].forEach(function(a,c){b[0][c]=Math.round(32767*Math.cos(a*Math.PI/32768))})}},{name:"math.rot2",ea:[{name:"r",size:2},{name:"v",size:2},{name:"theta",
size:1}]},{name:"math.sqrt",description:"Square root",ea:[{name:"r",size:-1},{name:"x",size:-1}],za:function(a,b){b[1].forEach(function(a,c){b[0][c]=0<a?Math.floor(Math.sqrt(a)):0})}},{name:"math.rand",description:"Pseudo-random number",ea:[{name:"r",size:-1}],za:function(a,b){for(a=0;a<b[0].length;a++)b[0][a]=Math.floor(65535.9999*Math.random())-32768}},{name:"_leds.set",ea:[{name:"led",size:1},{name:"br",size:1}],za:function(){}},{name:"sound.record",ea:[{name:"n",size:1}],za:function(){}},{name:"sound.play",
ea:[{name:"n",size:1}],za:function(){}},{name:"sound.replay",ea:[{name:"n",size:1}],za:function(){}},{name:"sound.system",description:"Start playing system sound",ea:[{name:"n",size:1}],za:function(){}},{name:"leds.circle",description:"Set circular leds",ea:[{name:"l0",size:1},{name:"l1",size:1},{name:"l2",size:1},{name:"l3",size:1},{name:"l4",size:1},{name:"l5",size:1},{name:"l6",size:1},{name:"l7",size:1}],za:function(a,b){a.state["leds.circle"]=b.map(function(a){return a[0]});a.ad&&a.ad("leds.circle")}},
{name:"leds.top",description:"Set top RGB led",ea:[{name:"r",size:1},{name:"g",size:1},{name:"b",size:1}],za:function(a,b){a.state["leds.top"]=b.map(function(a){return a[0]});a.ad&&a.ad("leds.top")}},{name:"leds.bottom.left",description:"Set bottom-left RGB led",ea:[{name:"r",size:1},{name:"g",size:1},{name:"b",size:1}],za:function(a,b){a.state["leds.bottom.left"]=b.map(function(a){return a[0]});a.ad&&a.ad("leds.bottom.left")}},{name:"leds.bottom.right",description:"Set bottom-right RGB led",ea:[{name:"r",
size:1},{name:"g",size:1},{name:"b",size:1}],za:function(a,b){a.state["leds.bottom.right"]=b.map(function(a){return a[0]});a.ad&&a.ad("leds.bottom.right")}},{name:"sound.freq",description:"Play frequency",ea:[{name:"Hz",size:1},{name:"ds",size:1}],za:function(a,b){console.info(b)}},{name:"leds.buttons",description:"Set buttons leds",ea:[{name:"led 0",size:1},{name:"led 1",size:1},{name:"led 2",size:1},{name:"led 3",size:1}]},{name:"leds.prox.h",description:"Set horizontal proximity leds",ea:[{name:"led 0",
size:1},{name:"led 1",size:1},{name:"led 2",size:1},{name:"led 3",size:1},{name:"led 4",size:1},{name:"led 5",size:1},{name:"led 6",size:1},{name:"led 7",size:1}]},{name:"leds.prox.v",description:"Set vertical proximity leds",ea:[{name:"led 0",size:1},{name:"led 1",size:1}]},{name:"leds.rc",description:"Set rc led",ea:[{name:"led",size:1}]},{name:"leds.sound",description:"Set sound led",ea:[{name:"led",size:1}]},{name:"leds.temperature",description:"Set ntc led",ea:[{name:"red",size:1},{name:"blue",
size:1}]},{name:"sound.wave",description:"Set the primary wave of the tone generator",ea:[{name:"wave",size:142}],za:function(){}},{name:"prox.comm.enable",description:"Enable or disable the proximity communication",ea:[{name:"state",size:1}]},{name:"sd.open",description:"Open a file on the SD card",ea:[{name:"number",size:1},{name:"status",size:1}]},{name:"sd.write",description:"Write data to the opened file",ea:[{name:"data",size:-1},{name:"written",size:1}]},{name:"sd.read",description:"Read data from the opened file",
ea:[{name:"data",size:-1},{name:"read",size:1}]},{name:"sd.seek",description:"Seek the opened file",ea:[{name:"position",size:1},{name:"status",size:1}]},{name:"_rf.nodeid"},{name:"_poweroff"}],Cd:620});this.state={};this.ad=null}ji.prototype=Object.create(ei.prototype);ji.prototype.constructor=ji;function ki(){M.call(this);this.Xb=!0;this.m=new ji(9999);var a=this;this.m.ad=function(b){a.ga[b]&&a.ga[b](b,a.m.state[b])};this.m.M=function(b,c,d){switch(b){case "timer.period":a.setTimer(c,.001*d,!0)}};this.m.v=function(b,c,d){switch(b){case "sound.play":return a.ga.sound("sound",{pcm:d[0][0]}),!0}return!1};this.pa=new ub(vb)}ki.prototype=Object.create(M.prototype);ki.prototype.constructor=ki;ki.prototype.reset=function(a){M.prototype.reset.call(this,a);hi(this.m)};
function li(a,b){b=Rf(a.pa,b);return null==b?null:a.m.Ec.slice(b.offset,b.offset+b.size)}function mi(a,b,c){var d=Rf(a.pa,b);if(null==d)throw"Unknown VM variable "+b;if(c.length!==d.size)throw"Bad size for variable "+b;Array.prototype.splice.apply(a.m.Ec,[d.offset,d.size].concat(c))}
ki.prototype.set=function(a,b){if(this.Xb){M.prototype.set.call(this,a,b);switch(a){case "button.backward":case "button.left":case "button.center":case "button.forward":case "button.right":mi(this,a,[b?1:0]);break;case "prox.ground.delta":mi(this,"prox.ground.delta",b.map(function(a){return 2E3*a}));break;case "prox.horizontal":mi(this,"prox.horizontal",b.map(function(a){return 4E3*a}));break;case "acc":mi(this,"acc",b.map(function(a){return 22*a}));break;default:throw"Unknown variable "+a;}this.ga[a]&&
this.ga[a](a,b)}else M.prototype.set.call(this,a,b)};
ki.prototype.get=function(a){if(this.Xb)switch(a){case "leds.top":return(this.m.state&&this.m.state["leds.top"]||[0,0,0]).map(function(a){return 32<=a?1:0>=a?0:a/32});case "leds.bottom.left":return(this.m.state&&this.m.state["leds.bottom.left"]||[0,0,0]).map(function(a){return 32<=a?1:0>=a?0:a/32});case "leds.bottom.right":return(this.m.state&&this.m.state["leds.bottom.right"]||[0,0,0]).map(function(a){return 32<=a?1:0>=a?0:a/32});case "leds.circle":return(this.m.state&&this.m.state["leds.circle"]||
[0,0,0,0,0,0,0,0]).map(function(a){return 16<=a?1:0});case "motor.left":return li(this,"motor.left.target")[0]/200;case "motor.right":return li(this,"motor.right.target")[0]/200;default:return M.prototype.get.call(this,a)}else return M.prototype.get.call(this,a)};ki.prototype.sendEvent=function(a,b){if(this.Xb){if(null!=b)throw"Event arguments not implemented";a=Sf(this.pa,a);gi(this.m,a);ni(this)}else M.prototype.sendEvent.call(this,a,b)};
ki.prototype.loadCode=function(a,b){"js"===a?(M.prototype.loadCode.call(this,a,b),this.Xb=!1):("asm"===a?(b=new If(this.pa,b),b=Hf(b)):(b=(a=Ah(b))?new Ff(this.pa,b):new wb(this.pa,b),b.ga=a?Gf:xb,b=yb(b)),a=this.m,a.K.splice.apply(a.K,[0,b.length].concat(b)),hi(this.m),ni(this),this.Xb=!0)};function ni(a){for(var b=0;2E3>b&&a.m.h;b++)ii(a.m)};function Cf(a,b){a.b=new Kb(a.hb,{da:a.da});a.b.Oa=function(){null!==a.m&&(a.m=null,oi(a))};var c=null;return new mf({Zb:function(b,e){var d=a.G;d.Z.loadCode(b,e);null!==c&&clearInterval(c);d.Z.start(pi());c=setInterval(function(){d.Z.run(pi(),function(a,b){qi(d,a,b)})},10);d.Z.tc=d.paused;oi(a)},Lc:function(){var c=new ki;c=new ri(a.b,c);b&&b.jg&&Od(a.b,b.jg);b&&b.kg&&(a.b.transform=b.kg);a.G=c},getName:function(){return"Simulator"},yd:"js",languages:["js","aseba","l2","asm"]})};function si(){this.b=[]}si.prototype.add=function(a){this.b.push(a)};si.prototype.H=function(a){this.b.forEach(function(b){b.H(a)})};function ti(){}ti.prototype.b=function(){throw"internal";};ti.prototype.H=function(){};function ui(a,b,c){this.x=a;this.y=b;this.h=c}ui.prototype=Object.create(ti.prototype);ui.prototype.constructor=ui;
ui.prototype.b=function(a,b,c){for(var d=Infinity,e=this.x.length,f=0;f<(this.h?this.x.length:this.x.length-1);f++){var g=this.x[(f+1)%e],h=this.y[(f+1)%e],k=[Math.cos(c),g-this.x[f],Math.sin(c),h-this.y[f]];g=[g-a,h-b];h=k[0]*k[3]-k[1]*k[2];k=[(k[3]*g[0]-k[1]*g[1])/h,(k[0]*g[1]-k[2]*g[0])/h];d=Math.min(d,0<=k[1]&&1>=k[1]&&0<k[0]?k[0]:Infinity)}return d};
ui.prototype.H=function(a){a.save();a.beginPath();a.moveTo(this.x[0],this.y[0]);for(var b=1;b<this.x.length;b++)a.lineTo(this.x[b],this.y[b]);this.h&&a.closePath();a.stroke();a.restore()};function vi(a,b,c){this.x=a;this.y=b;this.r=c}vi.prototype=Object.create(ti.prototype);vi.prototype.constructor=vi;
vi.prototype.b=function(a,b,c){var d=(this.x-a)*Math.cos(c)+(this.y-b)*Math.sin(c);a=(a-this.x)*Math.sin(c)+(this.y-b)*Math.cos(c);a=this.r*this.r-a*a;if(0>a)return Infinity;a=Math.sqrt(a);return 0>d+a?Infinity:0>d-a?d+a:d-a};vi.prototype.H=function(a){a.save();a.beginPath();a.arc(this.x,this.y,this.r,0,2*Math.PI);a.stroke();a.restore()};function wi(a,b){this.width=a;this.height=b}
function ri(a,b){var c=this;this.ia=new Fa;this.Z=b;this.M=this.nf=this.paused=this.me=!1;this.mc=xi;this.b=new wi(10*this.Z.qb,7.07*this.Z.qb);b=this.Z.qb;this.Z.setPositionLimits(-this.b.width/2+b,this.b.width/2-b,-this.b.height/2+b,this.b.height/2-b);this.Ye=this.Yb=null;this.h=document.createElement("canvas");this.Gf=!1;this.Ze=this.yb=null;this.m=document.createElement("canvas");this.o=new si;this.fe=!1;this.$e=this.R=null;yi(this);this.Z.hb=function(){zi(c);Ai(c);Bi(c)};this.v=a;this.v.state=
{};this.ga=!1}var xi="ground";ri.prototype.ke=function(){this.ia.b=[]};function Ci(a){var b=a.G;if(b.Yb){b.h.width=b.Yb.width;b.h.height=b.Yb.height;var c=b.h.getContext("2d");c.fillStyle="white";c.fillRect(0,0,b.Yb.width,b.Yb.height);c.drawImage(b.Yb,0,0,b.Yb.width,b.Yb.height)}else b.h.width=b.v?b.v.width:800,b.h.height=b.h.width*b.b.height/b.b.width,c=b.h.getContext("2d"),c.fillStyle="white",c.fillRect(0,0,b.h.width,b.h.height);b.Gf=!1;Wb(a)}
function qi(a,b,c){if(a.nf){var d=a.h.getContext("2d");d.save();d.translate(a.h.width/2,a.h.height/2);d.scale(a.h.width/a.b.width,-a.h.height/a.b.height);d.beginPath();switch(b){case "l":d.moveTo(c[0],c[1]);d.lineTo(c[2],c[3]);break;case "a":d.arc(c[0],c[1],Math.abs(c[2]),c[3],c[4],0>c[2])}d.strokeStyle="#060";d.lineCap="round";d.lineWidth=.1*a.Z.qb;d.stroke();d.restore();a.Gf=!0}}
function yi(a){a.o.b=[];a.o.add(new ui([-a.b.width/2,a.b.width/2,a.b.width/2,-a.b.width/2],[-a.b.height/2,-a.b.height/2,a.b.height/2,a.b.height/2],!0))}
function Di(a,b){var c=a.G;yi(c);if(c.R=b){var d=new re(b),e=c.b.width/d.Ca[2],f=-c.b.width*(.5+d.Ca[0]/d.Ca[2]),g=-c.b.height/d.Ca[3],h=c.b.height*(.5+d.Ca[1]/d.Ca[3]);d.H(null,{xa:{line:function(a,b,d){c.o.add(new ui(a.map(function(a){return f+e*a}),b.map(function(a){return h+g*a}),d))},Ve:function(a,b,d){c.o.add(new vi(f+e*a,h+g*b,(e-g)/2*d))}}})}c.fe=null!=b;Ai(c);Wb(a)}
function Ei(a,b,c){b=Math.round(a.h.width*(b+a.b.width/2)/a.b.width);c=Math.round(a.h.height*(a.b.height/2-c)/a.b.height);return a.h.getContext("2d").getImageData(b,c,1,1).data[0]/255}function Fi(a,b,c){if(null==a.yb)return 0;b=Math.round(a.m.width*(b+a.b.width/2)/a.b.width);c=Math.round(a.m.height*(a.b.height/2-c)/a.b.height);a=a.m.getContext("2d").getImageData(b,c,1,1).data;return-(a[0]+a[1]+a[2])/765}
function zi(a){for(var b=[],c=0;2>c;c++)b.push(Ei(a,a.Z.b[0]+a.Z.kc*Math.cos(a.Z.h)+(0===c?-1:1)*a.Z.Wd*Math.sin(a.Z.h),a.Z.b[1]+a.Z.kc*Math.sin(a.Z.h)-(0===c?-1:1)*a.Z.Wd*Math.cos(a.Z.h))+Kf(a.Z,.05));a.Z.set("prox.ground.delta",b)}
function Ai(a){var b=Math.cos(a.Z.h),c=Math.sin(a.Z.h),d=[{wd:70,ud:60,bb:.7},{wd:85,ud:30,bb:.35},{wd:95,ud:0,bb:0},{wd:85,ud:-30,bb:-.35},{wd:70,ud:-60,bb:-.7},{wd:-25,ud:35,bb:2.8},{wd:-25,ud:-35,bb:-2.8}].map(function(a){var d=this.o,e=this.Z.b[0]+a.wd*b-a.ud*c,h=this.Z.b[1]+a.wd*c+a.ud*b;a=this.Z.h+a.bb;for(var k=Infinity,m=0;m<d.b.length;m++)k=Math.min(k,d.b[m].b(e,h,a));d=k+Kf(this.Z,.01*this.Z.r);return 100>d?1:300<d?0:(d-300)*(d-300)/4E4},a);a.Z.set("prox.horizontal",d)}
function Bi(a){for(var b=[0,0,a.Z.r],c=[-a.Z.r,a.Z.r,0],d=[],e=0;3>e;e++)d.push(Fi(a,a.Z.b[0]+b[e]*Math.cos(a.Z.h)+c[e]*Math.sin(a.Z.h),a.Z.b[1]+b[e]*Math.sin(a.Z.h)-c[e]*Math.cos(a.Z.h)));b=200*(d[1]-d[0])/(2*a.Z.r);d=200*(d[2]-(d[0]+d[1])/2)/a.Z.kc;a.Z.set("acc",[b+Kf(a.Z,.02),d+Kf(a.Z,.02),Math.sqrt(1-b*b-d*d)+Kf(a.Z,.02)])}
function qf(a,b,c){switch(c||a.G.mc){case xi:a.G.Ye=null==b?a.G.Yb:null;a.G.Yb=b;Ci(a);zi(a.G);Wb(a);break;case "height":a.G.Ze=null==b?a.G.yb:null,c=a.G,c.yb=b,c.yb?(c.m.width=c.yb.width,c.m.height=c.yb.height,b=c.m.getContext("2d"),b.fillStyle="white",b.fillRect(0,0,c.yb.width,c.yb.height),b.drawImage(c.yb,0,0,c.yb.width,c.yb.height)):(c.m.width=1,c.m.height=1),Bi(c),Wb(a)}}function pf(a,b,c){switch(c||a.G.mc){case "obstacle":a.G.$e=null==b?a.G.R:null,Di(a,b)}}
Hb.prototype.start=function(a){this.G.paused=a;this.G.me=!a;Wb(this)};function Gi(a){a=[a[0],Math.max(.2+.8*a[1],a[2]/2),a[2]];var b=Math.max(a[0],Math.max(a[1],a[2]));return"rgb("+a.map(function(a){return Math.round(225*(1-b)+(30+225*b)*a)}).join(",")+")"}function Hi(a){return function(b){a.m!==b&&(a.m=b,oi(a))}}function Ze(a,b,c,d,e){var f=new mc(a.b);Ac(f,a,b,["sim","top"],a.G.Sd||sc,a.G.re||xc);oc(f,c,e,d);return f}
function Wb(a){function b(a){return function(){d.m!==a&&(d.m=a,oi(d))}}function c(a,b,c,d){var f=(e.re||xc)(a,g.w);c=Math.min(c.width/(f.oa-f.X),c.height/(f.la-f.Y));b.save();b.translate(-f.X,-f.Y);b.scale(c,c);(e.Sd||sc)(a,b,g.w,g.da,["sim","event"],null,!0,!1,d);b.restore()}var d=a,e=a.G,f=e.Z,g=a.b;if(g.R){e.ga||(e.ga=!0,e.resize(a),Ci(a));g.$a=[];var h=e.Vf||a.Aa,k=Cc(a,h,["sim","top"]),m=Dc(k),q=$c(g);Zc(g);var n=F(g.da,{tag:"view",W:["sim"]}),t=F(g.da,{tag:"button",W:["sim","event"]}),l=F(g.da,
{tag:"sim-controller"}),u=F(g.da,{tag:"separator",id:"sim-controller-separator"}),p=F(g.da,{tag:"separator",W:["sim","top"]}),v=F(g.da,{tag:"toolbar",W:["sim","top"]}),x=F(g.da,{tag:"sim-playground-area"}),K=F(g.da,{tag:"sim-playground"});n.sc(q.width);n.fc(q.height);n.setPosition(0,0);var r=Math.max(t.width,t.height);l.width=3*C(t);l.fc(n.height);l.setPosition(n.x+n.width-C(l),n.y);v.sc(n.width-C(l));v.height=m;v.setPosition(n.x,n.y);x.sc(n.width-C(l));x.fc(n.height-v.ra());x.setPosition(n.x,n.y+
v.ra());D(g,function(a){n.H(a)});pc(Ze(a,h,v,p,k),v,k,Hi(a));D(g,function(a){l.H(a)});h=[];k=l.y+t.offsetTop();h.push(rc(g,l.x+C(t)+t.offsetLeft(),k,t,function(a,b,d){c("sim-event:forward",a,b,d)},function(){f.set("button.forward",!0);f.sendEvent("buttons",null);f.set("button.forward",!1);f.sendEvent("buttons",null)},null,null,b("sim:btn-button.forward"),"button.forward"));k+=t.ra();h.push(rc(g,l.x+t.offsetLeft(),k,t,function(a,b,d){c("sim-event:left",a,b,d)},function(){f.set("button.left",!0);f.sendEvent("buttons",
null);f.set("button.left",!1);f.sendEvent("buttons",null)},null,null,b("sim:btn-button.left"),"button.left"));h.push(rc(g,l.x+C(t)+t.offsetLeft(),k,t,function(a,b,d){c("sim-event:center",a,b,d)},function(){f.set("button.center",!0);f.sendEvent("buttons",null);f.set("button.center",!1);f.sendEvent("buttons",null)},null,null,b("sim:btn-button.center"),"button.center"));h.push(rc(g,l.x+2*C(t)+t.offsetLeft(),k,t,function(a,b,d){c("sim-event:right",a,b,d)},function(){f.set("button.right",!0);f.sendEvent("buttons",
null);f.set("button.right",!1);f.sendEvent("buttons",null)},null,null,b("sim:btn-button.right"),"button.right"));k+=t.ra();h.push(rc(g,l.x+C(t)+t.offsetLeft(),k,t,function(a,b,d){c("sim-event:backward",a,b,d)},function(){f.set("button.backward",!0);f.sendEvent("buttons",null);f.set("button.backward",!1);f.sendEvent("buttons",null)},null,null,b("sim:btn-button.backward"),"button.backward"));k+=t.ra()+u.ra();h.push(rc(g,l.x+.5*C(t)+t.offsetLeft(),k,t,function(a,b,d){c("sim-event:tap",a,b,d)},function(){f.sendEvent("tap",
null)},null,null,b("sim:btn-tap"),"tap"));h.push(rc(g,l.x+1.5*C(t)+t.offsetLeft(),k,t,function(a,b,d){c("sim-event:clap",a,b,d)},function(){f.sendEvent("mic",null)},null,null,b("sim:btn-clap"),"clap"));k+=2*r;var J=l.x+1.5*C(t),P=k+3.5*r;h.push(D(g,function(a){function b(b,c,d,e,f,g){function h(b,c){a.beginPath();a.arc(0,0,b,0,2*Math.PI);a.fillStyle=c;a.fill()}a.save();a.translate(b,c);h(d,g||"#222");h(.95*d,f||"#bbb");h(.95*d*e,g||"#222");a.restore()}a.save();a.beginPath();a.moveTo(J-1.2*r,P);a.lineTo(J-
1.2*r,P-1.8*r);a.bezierCurveTo(J-.72*r,P-2.4*r,J-.05*r,P-2.4*r,J,P-2.4*r);a.bezierCurveTo(J+.05*r,P-2.4*r,J+.72*r,P-2.4*r,J+1.2*r,P-1.8*r);a.lineTo(J+1.2*r,P);a.closePath();a.lineWidth=2;a.strokeStyle="black";a.stroke();var c=f.get("prox.ground.delta");b(J-.45*r,P-1.8*r,.4*r,c[0],"#afa","#060");b(J+.45*r,P-1.8*r,.4*r,c[1],"#9f9","#060");c=f.get("prox.horizontal");b(J-1.45*r,P-2.3*r,.4*r,c[0],"#fcc","#d00");b(J-.8*r,P-2.8*r,.4*r,c[1],"#fcc","#d00");b(J,P-3*r,.4*r,c[2],"#fcc","#d00");b(J+.8*r,P-2.8*
r,.4*r,c[3],"#fcc","#d00");b(J+1.45*r,P-2.3*r,.4*r,c[4],"#fcc","#d00");b(J-.8*r,P+.5*r,.4*r,c[5],"#fcc","#d00");b(J+.8*r,P+.5*r,.4*r,c[6],"#fcc","#d00");a.restore()}));var T=k+=5*r;h.push(D(g,function(a){function b(b,c,d,e){e=Math.max(-1,Math.min(1,e));a.save();a.translate(b,c);a.beginPath();a.arc(0,0,d,0,2*Math.PI);a.fillStyle="#ccc";a.fill();a.beginPath();a.moveTo(0,0);a.lineTo(d*Math.sin(3*e),-d*Math.cos(3*e));a.lineWidth=Math.max(d/6,1);a.strokeStyle="black";a.stroke();a.restore()}a.save();a.fillStyle=
"black";a.fillRect(J-1.15*r,T+.5*r,.3*r,.6*r);a.fillRect(J+.85*r,T+.5*r,.3*r,.6*r);a.fillStyle=Gi(f.get("leds.top"));a.fillRect(J-1.2*r,T,2.4*r,.5*r);a.fillStyle=Gi(f.get("leds.bottom.left"));a.fillRect(J-1.2*r,T+.5*r,1.2*r,.5*r);a.fillStyle=Gi(f.get("leds.bottom.right"));a.fillRect(J,T+.5*r,1.2*r,.5*r);a.lineWidth=1;a.beginPath();a.moveTo(J-1.2*r,T+.5*r);a.lineTo(J+1.2*r,T+.5*r);a.moveTo(J,T+.5*r);a.lineTo(J,T+r);a.strokeStyle="white";a.stroke();a.lineJoin="round";a.strokeStyle="black";a.strokeRect(J-
1.2*r,T,2.4*r,r);b(J-1.7*r,T+r,.4*r,f.get("motor.left")/2);b(J+1.7*r,T+r,.4*r,f.get("motor.right")/2);a.restore()}));k+=1.5*r;if(null!=e.yb){var za=k+1.5*r;h.push(D(g,function(a){var b=f.get("acc");b=[Math.atan2(b[0],b[1]),Math.atan2(b[1],b[2]),Math.atan2(b[0],b[2])];a.save();a.strokeStyle="black";a.lineWidth=.7*g.w.ja;for(var c=0;3>c;c++){a.save();a.translate(J+(c-1)*r,za);a.save();a.strokeStyle="silver";a.beginPath();a.moveTo(-.4*r,0);a.lineTo(.4*r,0);a.moveTo(0,-.4*r);a.lineTo(0,.4*r);a.stroke();
a.restore();a.rotate(-b[c]);switch(c){case 0:var d=.25*r;a.translate(0,1.2*d);a.beginPath();a.moveTo(-1.2*d,0);a.lineTo(-1.2*d,-1.8*d);a.bezierCurveTo(-.72*d,-2.4*d,-.05*d,-2.4*d,0,-2.4*d);a.bezierCurveTo(.05*d,-2.4*d,.72*d,-2.4*d,1.2*d,-1.8*d);a.lineTo(1.2*d,0);a.closePath();a.lineWidth=2;a.strokeStyle="black";a.stroke();break;case 1:a.strokeRect(-.4*r,-.15*r,.8*r,.3*r);a.beginPath();a.arc(-.2*r,.05*r,.15*r,0,2*Math.PI);a.fillStyle="white";a.fill();a.lineWidth=.07*r;a.stroke();break;case 2:a.strokeRect(-.4*
r,-.15*r,.8*r,.3*r),a.fillStyle="black",a.fillRect(-.35*r,.15*r,.15*r,.08*r),a.fillRect(.2*r,.15*r,.15*r,.08*r)}a.restore()}a.restore()}));k+=2.5*r}if(f.Vc){var Wa=k+2*r;h.push(D(g,function(a){for(var b=f.get("leds.circle"),c=0;8>c;c++)fe(a,J,Wa,.9*r,1.2*r,Math.PI*(.44-.25*c),Math.PI*(.56-.25*c),b[c]?"#fa0":"white","black",g.w.ja)}));k+=3.5*r}var fa=k+1.5*r,N=f.getTimer(0);0<=N?(h.push(D(g,function(a){g.state.pe?"lin"===g.state.pe&&4<N&&(g.state.pe="log"):g.state.pe=4<N?"log":"lin";de(a,J,fa,r,g.w.ja,
function(b){a.textAlign="start";a.textBaseline="top";a.font=(r/2).toFixed(1)+"px sans-serif";a.fillStyle="black";a.fillText(b.toFixed(1),l.x,fa-r)},Math.min(N,"log"===g.state.pe?9.9:3.95),!1,"log"===g.state.pe)})),k+=2.5*r):g.state.pe=!1;var Q=Math.min((x.y-l.y+l.y+l.height-k)/2,l.y+l.height-k);0<Q&&h.forEach(function(a){a.y+=Q});var O=x.x,pa=x.y,Gb=x.width,E=x.height;var la=Math.min(Gb/e.b.width,E/e.b.height);t=(Gb-e.b.width*la)/2;u=(E-e.b.height*la)/2;K.width=e.b.width*la;K.height=e.b.height*la;
K.x=O+t;K.y=pa+u;if(a.ia.Wb){var L=F(g.da,{tag:"widget",id:"vpl-customize"});D(g,function(){Uc(g,"vpl:customize",O+Gb/2,pa+E/2,L)})}else{var H=f.qb,Ia=!1;t=new Jc(null,e.b.width*la,e.b.height*la,O+t,pa+u,function(a,b,c,h){a=a.J;a.save();x.H(a);K.H(a);if(null===d.Sc)switch(e.mc){case xi:a.drawImage(e.h,b.x+c,b.y+h,b.width,b.height);break;case "height":null!=e.yb&&a.drawImage(e.m,b.x+c,b.y+h,b.width,b.height);break;case "obstacle":a.save(),a.translate(b.x+c+b.width/2,b.y+h+b.height/2),a.scale(la,-la),
e.o.H(a),a.restore()}else a.drawImage(e.h,b.x+c,b.y+h,b.width,b.height),null!=e.yb&&(a.save(),a.globalAlpha=.5,a.drawImage(e.m,b.x+c,b.y+h,b.width,b.height),a.restore()),e.fe&&(a.save(),a.translate(b.x+c+b.width/2,b.y+h+b.height/2),a.scale(la,-la),e.o.H(a),a.restore());a.translate(b.x+c+b.width/2,b.y+h+b.height/2);a.scale(la,la);a.translate(f.b[0],-f.b[1]);a.rotate(.5*Math.PI-f.h);a.beginPath();a.moveTo(0,.2*H);a.lineTo(.5*H,.2*H);a.lineTo(.5*H,-.55*H);a.bezierCurveTo(.3*H,-.8*H,.02*H,-.8*H,0,-.8*
H);a.bezierCurveTo(-.02*H,-.8*H,-.3*H,-.8*H,-.5*H,-.55*H);a.lineTo(-.5*H,.2*H);a.closePath();a.fillStyle=Gi(f.get("leds.top"));a.strokeStyle="black";a.lineJoin="round";a.lineWidth=2;a.moveTo(.05*H,0);a.arc(0,0,.05*H,0,2*Math.PI);a.fill();a.stroke();if(!e.me||e.paused)a.beginPath(),a.arc(0,0,H,0,2*Math.PI),a.strokeStyle=g.state.vg?"navy":"#3cf",a.lineWidth=.1*H,a.stroke(),a.beginPath(),a.arc(0,-H,.15*H,0,2*Math.PI),a.fillStyle=g.state.Mf?"navy":"white",a.strokeStyle=g.state.Mf?"navy":"#3cf",a.lineWidth=
.06*H,a.fill(),a.stroke();a.restore()},{$:function(a,b,c,d,h,k,l){a=(l.x-h-c/2)/la;d=(d/2-(l.y-k))/la;k=a-f.b[0];l=d-f.b[1];b=H*Math.cos(f.h);c=H*Math.sin(f.h);return(!e.me||e.paused)&&(k-b)*(k-b)+(l-c)*(l-c)<.1*H*H?(g.state.x=a,g.state.y=d,g.state.Mf=!0,1):k*k+l*l<H*H?(e.paused?Ia=!1:(f.suspend(),Ia=!0),g.state.x=a,g.state.y=d,g.state.vg=!0,0):null},Ra:function(a,b,c,d,h,k,l,m){a=(m.x-k-d/2)/la;h=(h/2-(m.y-l))/la;switch(c){case 0:c=f.b;f.setPosition([f.b[0]+a-g.state.x,f.b[1]+h-g.state.y],f.h);qi(e,
"l",[c[0],c[1],f.b[0],f.b[1]]);break;case 1:f.setPosition(f.b,f.h+(Math.atan2(h-f.b[1],a-f.b[0])-Math.atan2(g.state.y-f.b[1],g.state.x-f.b[0])))}g.state.x=a;g.state.y=h},jf:function(){g.state.vg=!1;g.state.Mf=!1;Ia&&f.resume(pi())}});t.m=!1;Lc(g,t)}a.m&&D(g,function(a){var b=F(g.da,{tag:"hint"});a.fillStyle=b.color;a.font=tc(b);a.textAlign="start";a.textBaseline="middle";var c=d.h.translate(d.m);b.width=a.measureText(c).width;b.height=1.2*b.fontSize;qc(b,a,b.marginLeft,q.height-b.ra()+b.marginTop,
!0);a.fillText(c,b.offsetLeft(),q.height-b.ra()+b.offsetTop()+b.height/2)});B(g);!e.paused&&f.shouldRunContinuously()&&oi(a)}}function oi(a){a.G.M||(a.G.M=!0,window.requestAnimationFrame(function(){a.G.M=!1;Wb(a)}))}function pi(){return.001*(new Date).getTime()}ri.prototype.resize=function(a){var b=window.innerWidth,c=window.innerHeight;window.vplDisableResize&&(c=this.v.b.getBoundingClientRect(),b=c.width,c=c.height);this.v.w=this.v.w;this.v.resize(b,c);Wb(a)};function Df(a){a.L.add("sim:close",{action:function(a){a.fb(["sim"],{Xe:!0})},object:a,T:function(a){return 1<a.Ba.length&&0<=a.Ba.indexOf("sim")}});a.L.add("sim:restart",{action:function(a){Ci(a);a.G.Z.reset(pi());a.G.Z.start();a.G.me=!0;a.G.paused=!1;Wb(a)},object:a});a.L.add("sim:pause",{action:function(a){a.G.me&&(a.G.paused=!a.G.paused,a.G.paused?a.G.Z.suspend():(a.G.Z.resume(pi()),Wb(a)))},isEnabled:function(a){return a.G.me},Ua:function(a){return a.G.paused},object:a,cb:[{selected:!1},{selected:!0}]});
a.L.add("sim:speedup",{action:function(a){var b=[.5,1,2,5,10];a.G.Z.zd=b[(b.indexOf(a.G.Z.zd)+1)%b.length]},Ua:function(a){return 1!==a.G.Z.zd},getState:function(a){return a.G.Z.zd},object:a,cb:[{selected:!1,state:1},{selected:!0,state:.5},{selected:!0,state:2},{selected:!0,state:5},{selected:!0,state:10}]});a.L.add("sim:noise",{action:function(a){a.G.Z.gf=!a.G.Z.gf},Ua:function(a){return a.G.Z.gf},object:a,cb:[{selected:!1},{selected:!0}]});a.L.add("sim:pen",{action:function(a){a.G.nf=!a.G.nf},Ua:function(a){return a.G.nf},
object:a,cb:[{selected:!1},{selected:!0}]});a.L.add("sim:clear",{action:function(a){Ci(a)},isEnabled:function(a){return a.G.Gf},object:a});a.L.add("sim:map-kind",{action:function(a){switch(a.G.mc){case xi:a.G.mc="height";break;case "height":a.G.mc="obstacle";break;case "obstacle":a.G.mc=xi}},getState:function(a){switch(a.G.mc){case xi:return"ground";case "height":return"height";case "obstacle":return"obstacles";default:return"ground"}},object:a,cb:[{state:"ground"},{state:"height"},{state:"obstacles"}],
T:function(a){return null===a.Sc}});a.L.add("sim:map",{action:function(a){switch(a.G.mc){case xi:qf(a,null==a.G.Yb?a.G.Ye:null);break;case "height":qf(a,null==a.G.yb?a.G.Ze:null);break;case "obstacle":pf(a,a.G.fe?null:a.G.$e)}},Ua:function(a){switch(a.G.mc){case xi:return null!=a.G.Yb;case "height":return null!=a.G.yb;case "obstacle":return a.G.fe}throw"internal";},getState:function(a){switch(a.G.mc){case xi:return"ground";case "height":return"height";case "obstacle":return"obstacles";default:return"ground"}},
object:a,cb:[{selected:!1,state:"ground"},{selected:!1,state:"height"},{selected:!1,state:"obstacles"},{selected:!0,state:"ground"},{selected:!0,state:"height"},{selected:!0,state:"obstacles"}],T:function(a){return null===a.Sc}});a.L.add("sim:map-ground",{action:function(a,c){c?a.Ge.show("Open ground image file",".gif,.png,.jpg,.svg",function(b){var c=new window.FileReader;c.onload=function(b){b=b.target.result;var c=new Image;c.addEventListener("load",function(){qf(a,c,xi)});c.src=b};c.readAsDataURL(b)}):
qf(a,null==a.G.Yb?a.G.Ye:null,xi)},Ua:function(a){return null!=a.G.Yb},object:a,cb:[{selected:!1},{selected:!0}],T:function(a){return a.Sc&&0<=a.Sc.indexOf("ground")}});a.L.add("sim:map-height",{action:function(a,c){c?a.Ge.show("Open height image file",".gif,.png,.jpg,.svg",function(b){var c=new window.FileReader;c.onload=function(b){b=b.target.result;var c=new Image;c.addEventListener("load",function(){qf(a,c,"height")});c.src=b};c.readAsDataURL(b)}):qf(a,null==a.G.yb?a.G.Ze:null,"height")},Ua:function(a){return null!=
a.G.yb},object:a,cb:[{selected:!1},{selected:!0}],T:function(a){return a.Sc&&0<=a.Sc.indexOf("height")}});a.L.add("sim:map-obstacles",{action:function(a,c){c?a.Ge.show("Open obstacle SVG file",".svg",function(b){var c=new window.FileReader;c.onload=function(b){pf(a,b.target.result,"obstacle")};c.readAsText(b)}):pf(a,a.G.fe?null:a.G.$e,"obstacle")},Ua:function(a){return a.G.fe},object:a,cb:[{selected:!1},{selected:!0}],T:function(a){return a.Sc&&0<=a.Sc.indexOf("obstacles")}});a.L.add("sim:vpl",{action:function(a){a.Ld?
a.fb(["vpl"],{Nd:!0}):a.fb(["vpl"],{Kd:"sim"})},isEnabled:function(a){return null==a.I||ef(a.I)},object:a,T:function(a){return(null==a.I||!a.I.fa)&&0>a.Ba.indexOf("vpl")}});a.L.add("sim:text",{action:function(a){a.Ld?a.fb(["src"],{Nd:!0,Yf:!a.I.Nc}):a.fb(["src"],{Kd:"sim",Yf:!a.I.Nc})},object:a,T:function(a){return 0>a.Ba.indexOf("src")}});a.L.add("sim:teacher-reset",{action:function(a){a.G.ke();Wb(a)},object:a,Pc:!0,T:function(a){return a.G.Eb&&a.G.ia.Wb}});a.L.add("sim:teacher",{action:function(a){a.G.ia.Wb=
!a.G.ia.Wb;Wb(a)},Ua:function(a){return a.G.ia.Wb},object:a,Pc:!0,T:function(a){return a.G.Eb},cb:[{selected:!1},{selected:!0}]})};function zf(a){return new mf({Zb:function(b,c){a.Ma[a.ya].eb.state.b(c)},Lc:function(){try{var b=xf("asebahttp")||("http:"!==document.location.origin.slice(0,5)?"http://127.0.0.1:3000":document.location.origin);ka(b,function(){a.Ma[a.ya].eb.state=ea[0];Qd(a.ca)})}catch(c){console.info(c),Qd(a.ca)}},isConnected:function(){return null!=a.Ma[a.ya].eb.state},isEnabled:function(b){return"aseba"===b&&null!=a.Ma[a.ya].eb.state},getName:function(){return"Thymio (HTTP)"},yd:"aseba",languages:["aseba","l2"],
state:null})};function Af(a){var b=null;return new mf({Zb:function(a,d){b.run(d)},Lc:function(){try{b=new window.TDM(xf("w"),{uuid:xf("uuid")||"auto",change:function(b){a.Ma[a.ya].eb.state=b?{}:null;Qd(a.ca)}})}catch(c){console.info(c),Qd(a.ca)}},isConnected:function(){return null!=a.Ma[a.ya].eb.state&&b.isConnected()},isEnabled:function(c){return"aseba"===c&&null!=a.Ma[a.ya].eb.state&&b.canRun()},getName:function(){return"Thymio (TDM)"},yd:"aseba",languages:["aseba"],state:null})};function Ii(a){this.v=a||"ws://127.0.0.1:8002/";this.o={};this.m=this.b=null}Ii.prototype.connect=function(){this.h=new WebSocket(this.v);var a=this;this.h.addEventListener("open",function(){a.h.send(JSON.stringify({type:"nodes"}))});this.h.addEventListener("message",function(b){try{var c=JSON.parse(b.data);switch(c.type){case "connect":if(c.id){var d=c.id;a.o[d]=c;a.b&&a.b(d,c.descr)}break;case "disconnect":d=c.id,delete a.o[d],a.m&&a.m(d)}}catch(e){}})};
Ii.prototype.Zb=function(a,b){this.h.send(JSON.stringify({type:"run",id:a,bc:b}))};function Bf(a){var b=null,c=xf("uuid")||null;c&&(c=c.replace(/^\{(.*)\}$/,"$1"));var d=null;return new mf({Zb:function(a,f){switch(a){case "aseba":a=new wb(d,f);a.ga=xb;var e=yb(a);break;case "l2":a=new wb(d,f);a.ga=Gf;e=yb(a);break;case "asm":a=new If(d,f),e=Hf(a)}b.Zb(c,e)},Lc:function(){try{var e=xf("w")||("http:"!==document.location.origin.slice(0,5)?"ws://127.0.0.1:8002":document.location.origin.replace(/^http/,"ws"));b=new Ii(e);b.b=function(b,e){if(null==c||b===c)d=new ub(e),a.Ma[a.ya].eb.state=
{},Qd(a.ca)};b.m=function(b){if(null==c||b===c)a.Ma[a.ya].eb.state=null,Qd(a.ca)};b.connect()}catch(f){console.info(f),Qd(a.ca)}},isConnected:function(){return null!=a.Ma[a.ya].eb.state},isEnabled:function(b){return("aseba"===b||"l2"===b||"asm"===b)&&null!=a.Ma[a.ya].eb.state},getName:function(){return"Thymio (JWS)"},yd:"aseba",languages:["aseba","l2","asm"],state:null})};
}).call(this);
