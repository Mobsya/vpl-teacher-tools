/* Copyright 2018-2020 ECOLE POLYTECHNIQUE FEDERALE DE LAUSANNE - author Yves Piguet */
(function(){
var Q,ba,ca,da;function ea(a,b){this.name=a;this.Od=b}var fa=[];function ia(){var a=na;if(a)for(var b=fa.length-1;0<=b;b--)fa[b]instanceof a&&fa.splice(b,1);else fa=[]}ea.prototype.b=function(){throw"not implemented";};ea.prototype.addEventListener=function(){throw"not implemented";};function na(a,b,c){ea.call(this,a,b);this.url=c}na.prototype=Object.create(ea.prototype);na.prototype.constructor=na;function oa(a,b,c,d){var e=new XMLHttpRequest;e.timeout=200;e.onerror=function(){c(null)};c&&(e.onreadystatechange=function(){if(4===e.readyState)switch(e.status){case 200:c(e.responseText);break;default:c(null)}});e.open(a,b,!0);e.send(d)}
function pa(a,b){a=a||"";oa("GET",a+"/nodes",function(c){null!==c&&(c=JSON.parse(c),0===c.length?pa(a,b):(ia(),c.forEach(function(d){var e=new na(d.name,d.aeslId,a+"/nodes/"+d.name,d.protocolVersion);oa("GET",a+"/nodes/"+d.name,function(f){e.description=f?JSON.parse(f):""});fa.push(e)}),b&&b()))})}
function qa(a,b){return"<!DOCTYPE aesl-source>\n<network>\n"+[].map(function(c){return"<event size='"+(c.size||0).toString(10)+"' name='"+c.name+"'/>\n"}).join("")+"<keywords flag='true'/>\n<node nodeId='"+(a.Od||1).toString(10)+"' name='"+a.name+"'><![CDATA["+b+"]]\x3e</node>\n</network>\n"}na.prototype.b=function(a){a=qa(this,a);oa("PUT",this.url,void 0,a)};
na.prototype.addEventListener=function(a,b){a=a.toString();var c=this.url+"/events";a&&(c+="/"+a);c=new EventSource(c);c.onmessage=function(d){b(d.data.split(" ").slice(1).map(function(e){return parseInt(e,10)}),a)};return c};function ra(a){this.name=a.name;this.type=a.type;this.la=a.la||["b","a"];this.xg=a.xg||!1;this.ha=a.ha||null;this.gb=a.gb||null;this.se=a.se||null;this.df=a.df||null;this.ie=a.ie||null;this.wc=a.wc||null;this.Jb=a.Jb||{aseba:"e"===this.type?function(b){return{Hd:"# onevent "+b.V.name+"\n"}}:function(b){return{ka:"# "+b.V.name+"\n"}}};this.H=a.H||function(b,c){b.text(c.V.name)};this.Yd=a.Yd||!1;this.aa=a.aa||null;this.Ra=a.Ra||null;this.Ic=a.Ic||null}var sa=[];
function ta(a,b,c,d){for(var e=null;;){var f=/`([^`]*)`/.exec(a);if(null==f)break;e=(new Function("$","i","rgb","toFixed","return "+f[1]+";"))(b,c,function(g){g=[g[0],Math.max(.2+.8*g[1],g[2]/2),g[2]];var h=Math.max(g[0],Math.max(g[1],g[2]));return g.map(function(k){return.88*(1-h)+(.12+.88*h)*k})},function(g,h){return parseFloat(g.toFixed(void 0===h?2:h)).toString()});a=a.slice(0,f.index)+e+a.slice(f.index+f[0].length)}return d?e:a};function ua(a,b,c){this.V=a;this.Ab=b;this.ke=c;this.locked=this.disabled=!1;this.g=a.ha?a.ha():null;this.ee=this.b=null}ua.prototype.ob=function(a,b,c){a=new ua(this.V,a,b);a.disabled=this.disabled;a.b=c;this.g&&(a.g=this.g.slice());return a};function va(a){a.b&&a.b()}ua.prototype.h=function(a){return this.disabled?{}:this.V.Jb[a]?this.V.Jb[a](this):wa[a].h(this)};function ya(a,b,c){ua.call(this,za[a],b,c)}ya.prototype=Object.create(ua.prototype);ya.prototype.constructor=ya;var za={e:new ra({name:"empty e",type:"e",H:function(a,b,c,d){var e=Aa("!empty event");e&&e.H(a,b,c,d)}}),a:new ra({name:"empty a",type:"a",H:function(a,b,c,d){var e=Aa("!empty action");e&&e.H(a,b,c,d)}}),s:new ra({name:"empty s",type:"s",H:function(a,b,c,d){var e=Aa("!empty state")||Aa("!empty event");e&&e.H(a,b,c,d)}})};ya.prototype.h=function(){return{}};function Ba(){this.U=[];this.actions=[];this.error=null;this.locked=this.disabled=!1}Ba.prototype.ob=function(){for(var a=new Ba,b=0;b<this.U.length;b++)Ca(a,this.U[b],null,null);for(b=0;b<this.actions.length;b++)Ca(a,this.actions[b],null,null);return a};Ba.prototype.Tb=function(){return 0===this.U.length&&0===this.actions.length};function Da(a){for(var b=0;b<a.U.length;b++)if("init"===a.U[b].V.name)return a.U[b];return null}
function Ca(a,b,c,d,e){if(b){switch(b.V.type){case "e":case "s":if(b.Ab===a)c&&(a.U.splice(b.ke.index,1),e?b.b=d:b=b.ob(a,c,d),a.U.splice(c.index,0,b));else if(c){if(a.U[c.index]===b)return;e?b.b=d:b=b.ob(a,c,d);a.U[c.index]=b}else e?b.b=d:b=b.ob(a,{Zc:!0,index:a.U.length},d),a.U.push(b);break;case "a":case "c":if(b.Ab===a)c&&(Ea(a,b.ke),e?b.b=d:b=b.ob(a,c,d),(c.Zc?a.U:a.actions).splice(c.index,0,b));else if(c){if((c.Zc?a.U:a.actions)[c.index]===b)return;e?b.b=d:b=b.ob(a,c,d);(c.Zc?a.U:a.actions)[c.index]=
b}else e?b.b=d:b=b.ob(a,{Zc:!1,index:a.actions.length},d),a.actions.push(b)}Fa(a)}}function Ea(a,b){b.Zc?a.U[b.index]&&a.U.splice(b.index,1):a.actions[b.index]&&a.actions.splice(b.index,1)}function Fa(a){a.U.forEach(function(b,c){b.Ab=this;b.ke={Zc:!0,index:c}},a);a.actions.forEach(function(b,c){b.Ab=this;b.ke={Zc:!1,index:c}},a)}
function Ga(a,b){function c(k,l){if(k.disabled)return l.disabled?0:1;if(l.disabled)return-1;k=k.V.name;l=l.V.name;return k>l?1:k<l?-1:0}function d(k,l){if(null===k.g&&null===l.g)return!0;if(null===k.g||null===l.g||k.g.length!==l.g.length)return!1;for(var w=0;w<k.g.length;w++)if(k.g[w]!==l.g[w])return!1;return!0}function e(k){for(var l=0;l<k.U.length;l++)if(!k.U[l].disabled)return!1;return!0}if(!(a.disabled||b.disabled||e(a)||e(b)||0===a.U.length||b.U.length!==a.U.length)){for(var f=a.U.slice(0,1).concat(a.U.slice(1).sort(c)),
g=b.U.slice(0,1).concat(b.U.slice(1).sort(c)),h=0;h<f.length&&!f[h].disabled&&!g[h].disabled;h++)if(f[h].V!==g[h].V||!d(f[h],g[h]))return;if(null==a.error||a.error.Kb)f=new Ha("Rules with same events"),Ia(f,b),a.error=f;if(null==b.error||b.error.Kb)f=new Ha("Rules with same events"),Ia(f,a),b.error=f}};function Ja(){this.b=[];this.xb=this.re=this.Wb=!1}function Ka(a,b){a.b=b.slice()}Ja.prototype.toggle=function(a){var b=this.b.indexOf(a);0<=b?this.b.splice(b,1):this.b.push(a)};function La(){this.b={};this.language="en"}function Ma(a,b,c){a.b[b]||(a.b[b]={});a=a.b[b];for(var d in c)c.hasOwnProperty(d)&&(a[d]=c[d])}La.prototype.translate=function(a,b){return(b=this.b[b||this.language])&&b[a]||a};function Na(){this.b={};this.uf={}}Na.prototype.add=function(a){for(var b in a)if(a.hasOwnProperty(b)){this.b[b]||(this.b[b]={});for(var c in a[b])if(a[b].hasOwnProperty(c)){this.b[b][c]||(this.b[b][c]={});for(var d in a[b][c])a[b][c].hasOwnProperty(d)&&(this.b[b][c][d]=a[b][c][d].slice())}}};Na.prototype.get=function(a,b,c){return this.b[a]&&this.b[a][b]&&this.b[a][b][c]?this.b[a][b][c]:null};
function Oa(a,b){var c="";b.forEach(function(d){function e(h,k){h=d.split(h);if(1<h.length){d=h[0];for(var l=1;l<h.length;l++)d+=(1==l%2?"<":"</")+k+">"+h[l];0==h.length%2&&(d+="</"+k+">")}}d=d.replace(/&\s/g,"&amp; ");var f="p";/^##/.test(d)?(d=d.slice(2),f="h3"):/^#/.test(d)&&(d=d.slice(1),f="h2");e(/\*\*|__/,"strong");for(e(/\*|_/,"em");;){var g=/!\[([^\]]*)\]\(([^)]*)\)/.exec(d);if(!g)break;d=d.slice(0,g.index)+'<img src="'+(this.uf[g[2]]||g[2])+'" alt="'+g[1]+'">'+d.slice(g.index+g[0].length)}d=
d.replace(/\[([^\]]*)\]\(([^)]*)\)/g,'<a href="$2">$1</a>');c+="<"+f+">"+d+"</"+f+">\n"},a);return c}Na.prototype.Ac=function(a,b){var c=c||"<html>\n<style>\nimg {float: left; margin-right: 10px; margin-bottom: 20px;}\nh1, h2 {clear: left;}\n</style>\n<div style='height: 100%; overflow-y: scroll;'>BLOCKS</div></html>\n";var d="";b.forEach(function(e){(e=this.get(a,"blocks",e))&&(d+=Oa(this,e))},this);return c.replace("BLOCKS",d||"<p>Empty</p>\n")};function Pa(a){this.filename=null;this.readOnly=!1;this.mode="b";this.fa=!1;this.Eb=Qa;this.rg=!1;this.i=[];this.Ec=!1;this.Mf=!0;this.w=this.o=this.pa=null;this.Uc=new Ra;this.code={};this.Cb="aseba";this.message=null;this.oc=Sa;this.h=Ta;this.nc=Ua;this.b=Va;this.ia=a||new Ja;this.m=null}var wa={},Sa=[],Ta=!1,Va=!0,Ua=[];function Wa(){Sa=Xa("b").map(function(a){return a.name});Ua=Xa("a").map(function(a){return a.name})}
function Ya(a){var b=Za.map(function(c){return c.name});switch(a){case "b":Sa=b;break;case "a":Ua=b}}Q=Pa.prototype;Q.me=function(){this.ia.b=[]};function $a(a,b){b?(b=a.Uc,b.hc=[],b.dd=[]):a.Bb();a.mode="b";a.oc=Sa;a.h=Ta;a.nc=Ua;a.b=Va;a.i=[];a.code={};a.Mf=!0}Q.Tb=function(){for(var a=0;a<this.i.length;a++)if(!this.i[a].Tb())return!1;return!0};Q.getError=function(){for(var a=0;a<this.i.length;a++)if(null!==this.i[a].error)return this.i[a].error;return null};
function ab(a){if("b"===a.mode?a.h:a.b)return!1;for(var b=0;b<a.i.length;b++)if(1<a.i[b].U.length||0<a.i[b].U.length&&"s"===a.i[b].U[0].V.type)return!1;return!0}Q.Bb=function(){this.Uc.Bb(bb(this),this.Ec);this.code={};this.Ec=!1};Q.Yf=function(a){if(0<this.Uc.hc.length){var b=this.Uc.Yf(bb(this),this.Ec);cb(this,b.state,a);this.Ec=b.b;this.code={}}};Q.Qf=function(a){if(0<this.Uc.dd.length){var b=this.Uc.Qf(bb(this),this.Ec);cb(this,b.state,a);this.Ec=b.b;this.code={}}};
function db(a,b){b!==a.mode&&(a.Bb(),a.mode=b,a.i.forEach(function(c){c.U.forEach(function(d,e){c.U[e]=d});c.actions.forEach(function(d,e){c.actions[e]=d})}))}var Qa="s";
function bb(a,b){var c={};b&&!1===b.$c||(c.advanced="a"===a.mode,c.basicBlocks=a.oc,c.basicMultiEvent=a.h,c.advancedBlocks=a.nc,c.advancedMultiEvent=a.b,c.disabledUI=a.ia.b);if(b&&!1===b.cd)return c;b=a.o?a.o():null;var d=null;null==b&&(d=a.i.map(function(e){function f(h){h&&g.push({name:h.V.name,disabled:h.disabled,locked:h.locked,param:h.V.df?h.V.df(h):h.g?h.g.slice():null})}var g=[];e.U.forEach(function(h){f(h)});e.actions.forEach(function(h){f(h)});return{blocks:g,disabled:e.disabled,locked:e.locked}}));
c.program=d;c.code=b;return c}function eb(a,b){return JSON.stringify(bb(a,b),null,"\t")}
function cb(a,b,c,d){var e=!1,f="vpl";try{if(b&&(!b.disabledUI||d&&d.vh||Ka(a.ia,b.disabledUI),d&&d.uh||(a.mode=b.advanced?"a":"b",a.oc=b.basicBlocks||Sa,a.h=void 0!==b.basicMultiEvent?b.basicMultiEvent:Ta,a.nc=b.advancedBlocks||Ua,a.b=void 0!==b.advancedMultiEvent?b.advancedMultiEvent:Va),!d||!d.ng)&&(b.program?a.i=b.program.map(function(h){var k=new Ba;h.blocks.forEach(function(l){var w=Aa(l.name);if(w){var n=new ua(w,null,null);n.disabled=l.disabled||!1;n.locked=l.locked||!1;w.ie?w.ie(n,l.param,
function(){e&&c&&c("vpl")}):n.g=l.param;Ca(k,n,null,function(){a.Bb()},!0)}},this);k.disabled=h.disabled||!1;k.locked=h.locked||!1;return k},a):a.i=[],a.w)){var g=b.code;a.w(void 0==b.code?null:g);null!=g&&(f="src")}}catch(h){}a.fa="src"===f;c&&c(f);e=!0}function fb(a,b,c,d){try{var e=JSON.parse(b);cb(a,e,c,d);var f=a.Uc;f.hc=[];f.dd=[]}catch(g){}}Pa.prototype.$b=function(a){"string"!==typeof this.code[a]&&(this.code[a]=wa[a].Ac(this));return this.code[a]};
function gb(a,b){var c=wa[a];a=hb(c,b,!0);b=hb(c,b,!1);return 0<=a&&0<=b?{Hd:a,end:b}:null}function ib(a,b){a.m=b}Pa.prototype.log=function(a){this.m&&this.m(a)};function jb(a,b,c){this.language=a;this.m=b;this.o=c;this.b=[]}function kb(a,b,c){this.id=a;this.m=b;this.h=c;if(0>a||6399<a)throw"internal";this.A=String.fromCharCode(57344+a);this.b=-1}
function lb(a,b){a.forEach(function(d){d.b=b.indexOf(d.A)});a.sort(function(d,e){return d.b-e.b});for(var c=0;c<a.length;c++)a[c].b-=c,b=b.replace(a[c].A,"");a.forEach(function(d){var e;if(d.h){for(;;){for(e=d.b;" "===b[e]||"\t"===b[e];e++);if("\n"===b[e])d.b=e+1;else break}if(" "===b[d.b-1]||"\t"===b[d.b-1]){for(e=d.b-1;" "===b[e]||"\t"===b[e];e--);"\n"===b[e]&&(d.b=e+1)}}else if(" "===b[d.b-1]||"\t"===b[d.b-1]){for(e=d.b-1;" "===b[e]||"\t"===b[e];e--);"\n"===b[e]&&(d.b=e+1)}});return b}
function mb(a){return a.replace(/[\ue000-\uf8ff]/g,"")}function nb(a,b,c){var d=a.b.length,e=new kb(d,c,!0);a.b.push(e);c=new kb(d+1,c,!1);a.b.push(c);return e.A+b+c.A}function hb(a,b,c){for(var d=0;d<a.b.length;d++)if(a.b[d].m===b&&a.b[d].h===c)return a.b[d].b;return-1}
function ob(a,b){if(b.disabled||b.Tb())return{};b.error=null;for(var c=!1,d=!1,e=0;e<b.U.length;e++)if(!b.U[e].disabled)if("e"===b.U[e].V.type){if(c=!0,b.U[e].V.wc){var f=b.U[e].V.wc(b.U[e]);if(f&&(pb(f,[e]),!f.Kb||!b.error)&&(b.error=f,!f.Kb))return{error:f}}}else"s"===b.U[e].V.type&&(d=!0);f=!1;for(e=0;e<b.actions.length;e++)if(!b.actions[e].disabled&&"a"===b.actions[e].V.type){f=!0;break}if(!c&&!f)return b.error?{error:b.error}:{};if(!c&&!d)return f=new Ha("Missing event block"),pb(f,[]),b.error=
f,{error:f};if(!f)return f=new Ha("Missing action block"),f.b.push(0),b.error=f,{error:f};if(!b.error)for(e=0;e<b.actions.length;e++)for(c=e+1;c<b.actions.length;c++)"a"===b.actions[c].V.type&&b.actions[c].V===b.actions[e].V&&(f=new Ha("Duplicate action blocks",!0),f.b.push(e),f.b.push(c),b.error=f);var g=[],h=[],k=[],l="",w=[],n="",v=[],m="";b.U.forEach(function(r,u){var p=r.h(this.language);if(0===u&&p.P)p.Va&&(l=nb(this,p.Va,r),p.ba&&(n+=p.ba));else if(p.mg||p.Va)w.push(nb(this,p.mg||p.Va,r)),
p.ba&&(v=v.concat(p.ba));p.Sb&&(g=g.concat(p.Sb));p.ac&&(h=h.concat(p.ac));p.Rb&&(k=k.concat(p.Rb));p.ka&&(m+=nb(this,p.ka,r))},a);for(e=0;e<b.actions.length;e++)c=b.actions[e].h(a.language),m+=c.ka?nb(a,c.ka,b.actions[e]):"",c.Sb&&c.Sb.forEach(function(r){0>g.indexOf(r)&&g.push(r)}),c.ac&&c.ac.forEach(function(r){0>h.indexOf(r)&&h.push(r)}),c.Rb&&c.Rb.forEach(function(r){0>k.indexOf(r)&&k.push(r)});return 0<m.length?(e="e"===b.U[0].V.type?b.U[0].h(a.language):null,c=b.U.slice(1).filter(function(r){return"e"===
r.V.type}).map(function(r){return r.h(this.language)},a),{yh:b.U[0]?b.U[0].V.name:"",Sb:g,ac:h,Rb:k,P:e?e.P:"",ib:e?e.ib:"",Wa:e?e.Wa:"",pd:c.map(function(r){return r.P||""}),Pe:c.map(function(r){return r.ib||""}),Qe:c.map(function(r){return r.Wa||""}),ba:n,od:v,Va:l,Gb:w.join(" "+a.m+" "),ka:(e&&e.ka||"")+m}):{}}jb.prototype.Ac=function(){throw"internal";};jb.prototype.h=function(){throw"internal";};function qb(){jb.call(this,"aseba","and","1 == 1")}qb.prototype=Object.create(jb.prototype);qb.prototype.constructor=qb;
qb.prototype.Ac=function(a,b){this.b=[];var c=a.i.map(function(q){return ob(this,q)},this),d={},e=[];c.forEach(function(q){q.P&&(d[q.P]={P:q.P,ib:q.ib,Wa:q.Wa,ba:"",Ia:""},0>e.indexOf(q.P)&&e.push(q.P));q.pd&&q.pd.forEach(function(z,C){d[z]={P:z,ib:q.Pe[C],Wa:q.Qe[C],ba:"",Ia:""};0>e.indexOf(z)&&e.push(z)})});var f=[],g=[],h=[],k=[];c.forEach(function(q,z){q.Sb&&q.Sb.forEach(function(y){0>f.indexOf(y)&&f.push(y)});q.ac&&q.ac.forEach(function(y){0>g.indexOf(y)&&g.push(y)});q.Rb&&q.Rb.forEach(function(y){0>
h.indexOf(y)&&h.push(y)});if(q.P&&(q.Ya=k.indexOf(mb(q.Va||q.P)),0>q.Ya)){q.Ya=k.length;k.push(mb(q.Va||q.P));var C=d[q.P];q.ba&&0>C.ba.indexOf(q.ba)&&(C.ba+=q.ba);C.Ia+=q.Va?"when "+q.Va+" do\neventCache["+q.Ya+"] = 1\nend\n":"eventCache["+q.Ya+"] = 1\n"}q.P||(q.ka=nb(this,q.ka||"",a.i[z]))},this);var l="";if(b){var w=new Ba,n=new ua(Aa("init"),null,null);Ca(w,n,null,null);b.forEach(function(q){Ca(w,q,null,null)});n=ob(this,w);var v=!0;n.Sb.forEach(function(q){0>f.indexOf(q)&&(v=!1)});n.Rb.forEach(function(q){0>
h.indexOf(q)&&(v=!1)});v?l=n.ka:n.lh&&(l=n.lh)}var m=[],r="",u="",p=0;for(n=0;n<a.i.length;n++)0<=c[n].Ya?(c[n].od&&c[n].od.forEach(function(q){0>m.indexOf(q)&&m.push(q)}),r+="if eventCache["+c[n].Ya+"] != 0"+(c[n].Gb?" and "+c[n].Gb:"")+" then\ntodo["+p+"] = 1\nend\n",u+="if todo["+p+"] != 0 then\n"+c[n].ka+"end\n",p++):c[n].Gb&&(r+="when "+c[n].Gb+" do\ntodo["+p+"] = 1\nend\n",u+="if todo["+p+"] != 0 then\n"+c[n].ka+"end\n",p++);c=0<f.length?"\n"+f.join("\n"):"";0<k.length&&(c+="var eventCache[] = ["+
k.map(function(){return"0"}).join(", ")+"]\n");if(0<p){c+="var todo[] = [";for(n=0;n<p;n++)c+=0<n?", 0":"0";c+="]\n"}b?c+="\n"+l:(0<g.length&&(c+="\n"+g.join("\n")),r&&(c+=(0<c.length?"\n":"")+"timer.period[1] = 50\n"));for(n=0;n<e.length;n++)!/onevent/.test(d[e[n]].P)&&(d[e[n]].Wa||d[e[n]].ba||d[e[n]].Ia)&&(c+="\n"+(d[e[n]].P||"")+(d[e[n]].Wa||"")+(d[e[n]].ba||"")+(d[e[n]].Ia||"")+(d[e[n]].ib||""));0<h.length&&(c+="\n"+h.join("\n"));for(n=0;n<e.length;n++)/onevent/.test(d[e[n]].P)&&(d[e[n]].Wa||
d[e[n]].ba||d[e[n]].Ia)&&(c+="\n"+(d[e[n]].P||"")+(d[e[n]].Wa||"")+(d[e[n]].ba||"")+(d[e[n]].Ia||"")+(d[e[n]].ib||""));if(r){c+="\nonevent timer1\n"+m.join("")+r+u;for(n=0;n<k.length;n++)c+="eventCache["+n+"] = 0\n";for(n=0;n<p;n++)c+="todo["+n+"] = 0\n"}"\n"===c[0]&&(c=c.slice(1));var t=0;b=c.split("\n").map(function(q){return q.trim()}).map(function(q){function z(A){for(var K=mb(q),I=0;I<A.length;I++)if(K.slice(0,A[I].length)===A[I]&&!/^\w/.test(K.slice(A[I].length)))return!0;return!1}if(0<q.length){var C=
z(["else","elseif","end","onevent","sub"]),y=z("if else elseif for onevent sub when while".split(" "));C&&(t=Math.max(t-1,0));q="\t\t\t\t\t".slice(0,t)+q;y&&t++}return q});for(n=b.length-2;0<=n;n--)/^\s*#/.test(b[n])&&(l=b[n+1].replace(/^(\s*).*$/,"$1"),b[n]=l+b[n].replace(/^\s*/,""));c=b.join("\n");for(n=0;n<a.i.length;n++)for(b=n+1;b<a.i.length;b++)Ga(a.i[n],a.i[b]);return c=lb(this.b,c)};
qb.prototype.h=function(a){var b="# missing Aseba implementation for block "+a.V.name+"\n";switch(a.V.type){case "e":case "s":return{ba:b,Va:"1 == 1"};case "a":return{ka:b};default:return{}}};wa.aseba=new qb;function rb(){jb.call(this,"l2","&&","true")}rb.prototype=Object.create(jb.prototype);rb.prototype.constructor=rb;
rb.prototype.Ac=function(a,b){this.b=[];var c=a.i.map(function(t){return ob(this,t)},this),d={},e=[];c.forEach(function(t){t.P&&(d[t.P]={P:t.P,ib:t.ib,Wa:t.Wa,ba:"",Ia:""},0>e.indexOf(t.P)&&e.push(t.P));t.pd&&t.pd.forEach(function(q,z){d[q]={P:q,ib:t.Pe[z],Wa:t.Qe[z],ba:"",Ia:""};0>e.indexOf(q)&&e.push(q)})});var f=[],g=[],h=[],k=[];c.forEach(function(t,q){t.Sb&&t.Sb.forEach(function(C){0>f.indexOf(C)&&f.push(C)});t.ac&&t.ac.forEach(function(C){0>g.indexOf(C)&&g.push(C)});t.Rb&&t.Rb.forEach(function(C){0>
h.indexOf(C)&&h.push(C)});if(t.P&&(t.Ya=k.indexOf(mb(t.Va||t.P)),0>t.Ya)){t.Ya=k.length;k.push(mb(t.Va||t.P));var z=d[t.P];t.ba&&0>z.ba.indexOf(t.ba)&&(z.ba+=t.ba);z.Ia+=t.Va?"when ("+t.Va+") {\neventCache["+t.Ya+"] = true;\n}\n":"eventCache["+t.Ya+"] = true;\n"}t.P||(t.ka=nb(this,t.ka||"",a.i[q]))},this);var l="";if(b){var w=new Ba,n=new ua(Aa("init"),null,null);Ca(w,n,null,null);b.forEach(function(t){Ca(w,t,null,null)});l=ob(this,w).ka}var v=[],m="",r="",u=0;for(n=0;n<a.i.length;n++)0<=c[n].Ya?
(c[n].od&&c[n].od.forEach(function(t){0>v.indexOf(t)&&v.push(t)}),m+="if (eventCache["+c[n].Ya+"]"+(c[n].Gb?" && "+c[n].Gb:"")+") {\ntodo["+u+"] = true;\n}\n",r+="if (todo["+u+"]) {\n"+c[n].ka+"}\n",u++):c[n].Gb&&(m+="when ("+c[n].Gb+") {\ntodo["+u+"] = true;\n}\n",r+="if (todo["+u+"]) {\n"+c[n].ka+"}\n",u++);c=0<f.length?"\n"+f.join("\n"):"";0<k.length&&(c+="bool eventCache["+k.length+"] = false;\n");b?c+="\n"+l:(n="",0<g.length&&(n+="\n"+g.join("\n")),n&&(c+=(0<c.length?"\n":"")+n.slice(1)),m&&
(c+=(0<c.length?"\n":"")+"timer.period[1] = 50;\n"));for(n=0;n<e.length;n++)!/onevent/.test(d[e[n]].P)&&(d[e[n]].Wa||d[e[n]].ba||d[e[n]].Ia)&&(c+="\n"+(d[e[n]].P||"")+(d[e[n]].Wa||"")+(d[e[n]].ba||"")+(d[e[n]].Ia||"")+(d[e[n]].ib||""));0<h.length&&(c+="\n"+h.join("\n"));for(n=0;n<e.length;n++)/onevent/.test(d[e[n]].P)&&(d[e[n]].Wa||d[e[n]].ba||d[e[n]].Ia)&&(c+="\n"+(d[e[n]].P||"")+(d[e[n]].Wa||"")+(d[e[n]].ba||"")+(d[e[n]].Ia||"")+(d[e[n]].ib||""));m&&(c+="\nonevent timer1 {\n",0<u&&(c+="bool todo["+
u+"] = false;\n"),c+=v.join("")+m+r+"eventCache = false;\n}\n");"\n"===c[0]&&(c=c.slice(1));var p=0;b=c.split("\n").map(function(t){return t.trim()}).map(function(t){var q=mb(t);if(0<q.length){var z="{"===q.slice(-1);"}"===q[0]&&(p=Math.max(p-1,0));t="\t\t\t\t\t".slice(0,p)+t;z&&p++}return t});for(n=b.length-2;0<=n;n--)/^\s*#/.test(b[n])&&(m=b[n+1].replace(/^(\s*).*$/,"$1"),b[n]=m+b[n].replace(/^\s*/,""));c=b.join("\n");for(n=0;n<a.i.length;n++)for(b=n+1;b<a.i.length;b++)Ga(a.i[n],a.i[b]);return c=
lb(this.b,c)};rb.prototype.h=function(a){var b="// missing L2 implementation for block "+a.V.name+"\n";switch(a.V.type){case "e":case "s":return{ba:b,Va:"true"};case "a":return{ka:b};default:return{}}};wa.l2=new rb;function sb(){jb.call(this,"js","&&","true")}sb.prototype=Object.create(jb.prototype);sb.prototype.constructor=sb;
sb.prototype.Ac=function(a,b){this.b=[];var c=a.i.map(function(C){return ob(this,C)},this),d={},e=[];c.forEach(function(C){C.P&&(d[C.P]={P:C.P,ib:C.ib,Wa:C.Wa,ba:"",Ia:""},0>e.indexOf(C.P)&&e.push(C.P));C.pd&&C.pd.forEach(function(y,A){d[y]={P:y,ib:C.Pe[A],Wa:C.Qe[A],ba:"",Ia:""};0>e.indexOf(y)&&e.push(y)})});var f=[],g=[],h=[],k=[],l=[],w=0;c.forEach(function(C,y){C.Sb&&C.Sb.forEach(function(I){0>f.indexOf(I)&&f.push(I)});C.ac&&C.ac.forEach(function(I){0>g.indexOf(I)&&g.push(I)});C.Rb&&C.Rb.forEach(function(I){0>
h.indexOf(I)&&h.push(I)});var A=C.ka||"";C.Va&&(A="cond = "+C.Va+";\nif (cond && !cond0["+w+"]) {\n"+A+"}\ncond0["+w+"] = cond;\n",w++);if(C.P&&(C.Ya=k.indexOf(mb(C.Va||C.P)),0>C.Ya)){C.Ya=k.length;k.push(mb(C.Va||C.P));var K=d[C.P];C.ba&&0>K.ba.indexOf(C.ba)&&(K.ba+=C.ba);C.Va?(K.Ia+="cond = "+C.Va+";\nif (cond && !cond0["+w+"]) {\neventCache["+C.Ya+"] = true;\n}\ncond0["+w+"] = cond;\n",w++):K.Ia+="eventCache["+C.Ya+"] = true;\n"}C.P||(C.ka=nb(this,A,a.i[y]));Da(a.i[y])&&l.push(y)},this);var n=
"";if(b){var v=new Ba,m=new ua(Aa("init"),null,null);Ca(v,m,null,null);b.forEach(function(C){Ca(v,C,null,null)});n=ob(this,v).ka}var r=[],u="",p="",t=0;for(m=0;m<a.i.length;m++)0<=c[m].Ya?(c[m].od&&c[m].od.forEach(function(C){0>r.indexOf(C)&&r.push(C)}),u+="if (eventCache["+c[m].Ya+"]"+(c[m].Gb?" && "+c[m].Gb:"")+") {\ntodo["+t+"] = true;\n}\n",p+="if (todo["+t+"]) {\n"+c[m].ka+"}\n",t++):c[m].Gb&&(u+="cond = "+c[m].Gb+";\nif (cond && !cond0["+w+"]) {\ntodo["+t+"] = true;\n}\ncond0["+w+"] = cond;\n",
w++,p+="if (todo["+t+"]) {\n"+c[m].ka+"}\n",t++);0<w&&(f.unshift("var cond0;\nvar cond;\n"),g.unshift("cond0 = [];\n"));var q=0<f.length?"\n"+f.join("\n"):"";0<k.length&&(q+="var eventCache = [];\n");0<t&&(q+="var todo = [];\n");if(b)q+="\n"+n;else{b="";0<g.length&&(b+="\n"+g.join("\n"));u&&(b+="this.setTimer(1, 0.1, true);\n");for(m=0;m<a.i.length;m++)0<=l.indexOf(m)&&c[m].ka&&(b+=(0<b.length?"\n":"")+(c[m].P||"")+(c[m].ka||"")+(c[m].ib||""));b&&(q+=(0<q.length?"\n":"")+'this.addEventListener("init", function (name, param) {\n'+
b.slice(1)+"});\n")}if(0<h.length)throw"internal error, unsupported sub/onevent in js";for(m=0;m<e.length;m++)if(d[e[m]].Wa||d[e[m]].ba||d[e[m]].Ia)q+="\n"+(d[e[m]].P||"")+(d[e[m]].Wa||"")+(d[e[m]].ba||"")+(d[e[m]].Ia||"")+(d[e[m]].ib||"");if(u){q+='\nthis.addEventListener("timer1", function (name, param) {\n'+r.join("")+u+p;for(m=0;m<k.length;m++)q+="eventCache["+m+"] = false;\n";for(m=0;m<t;m++)q+="todo["+m+"] = false;\n"}0<q.trim().length&&(q+="});");"\n"===q[0]&&(q=q.slice(1));var z=0;c=q.split("\n").map(function(C){return C.trim()}).map(function(C){var y=
mb(C);if(0<y.length){var A="{"===y.slice(-1);"}"===y[0]&&(z=Math.max(z-1,0));C="\t\t\t\t\t".slice(0,z)+C;A&&z++}return C});for(m=c.length-2;0<=m;m--)/^\s*#/.test(c[m])&&(q=c[m+1].replace(/^(\s*).*$/,"$1"),c[m]=q+c[m].replace(/^\s*/,""));q=c.join("\n");for(m=0;m<a.i.length;m++)for(c=m+1;c<a.i.length;c++)Ga(a.i[m],a.i[c]);return q=lb(this.b,q)};
sb.prototype.h=function(a){var b="// missing JavaScript implementation for block "+a.V.name+"\n";switch(a.V.type){case "e":case "s":return{ba:b,Va:"true"};case "a":return{ka:b};default:return{}}};wa.js=new sb;function tb(){jb.call(this,"python","and","True")}tb.prototype=Object.create(jb.prototype);tb.prototype.constructor=tb;
tb.prototype.Ac=function(a,b){this.b=[];var c=a.i.map(function(z){return ob(this,z)},this),d={},e=[];c.forEach(function(z){z.P&&(d[z.P]={P:z.P,ib:z.ib,Wa:z.Wa,ba:"",Ia:""},0>e.indexOf(z.P)&&e.push(z.P));z.pd&&z.pd.forEach(function(C,y){d[C]={P:C,ib:z.Pe[y],Wa:z.Qe[y],ba:"",Ia:""};0>e.indexOf(C)&&e.push(C)})});var f=[],g=[],h=[],k=[],l=0;c.forEach(function(z,C){z.Sb&&z.Sb.forEach(function(A){0>f.indexOf(A)&&f.push(A)});z.ac&&z.ac.forEach(function(A){0>g.indexOf(A)&&g.push(A)});z.Rb&&z.Rb.forEach(function(A){0>
h.indexOf(A)&&h.push(A)});if(z.P&&(z.Ya=k.indexOf(mb(z.Va||z.P)),0>z.Ya)){z.Ya=k.length;k.push(mb(z.Va||z.P));var y=d[z.P];z.ba&&0>y.ba.indexOf(z.ba)&&(y.ba+=z.ba);z.Va?(y.Ia+="cond = "+z.Va+"\nif cond and not cond0["+l+"]:\neventCache["+z.Ya+"] = True\n<\ncond0["+l+"] = cond\n",l++):y.Ia+="eventCache["+z.Ya+"] = True\n"}z.P||(z.ka=nb(this,z.ka||"",a.i[C]))},this);if(b){var w=new Ba,n=new ua(Aa("init"),null,null);Ca(w,n,null,null);b.forEach(function(z){Ca(w,z,null,null)});var v=ob(this,w);v.Sb.forEach(function(){});
v.Rb.forEach(function(){})}0<l&&g.unshift("cond0 = [False for i in range("+l+")]\n");var m=[],r="",u="",p=0;for(n=0;n<a.i.length;n++)0<=c[n].Ya?(c[n].od&&c[n].od.forEach(function(z){0>m.indexOf(z)&&m.push(z)}),r+="if eventCache["+c[n].Ya+"]"+(c[n].Gb?" and "+c[n].Gb:"")+":\ntodo["+p+"] = True\n<\n",u+="if todo["+p+"]:\n"+c[n].ka+"<\n",p++):c[n].Gb&&(r+="cond = "+c[n].Gb+"\nif cond and not cond0["+n+"]:\ntodo["+p+"] = 1\n<\ncond0["+n+"] = cond\n",u+="if todo["+p+"]:\n"+c[n].ka+"<\n",p++);c=0<f.length?
f.join("\n"):"";0<k.length&&(c+="eventCache = ["+k.map(function(){return"0"}).join(", ")+"]\n");if(0<p){c+="todo = [";for(n=0;n<p;n++)c+=0<n?", 0":"0";c+="]\n"}b?c+="\n"+v:(0<g.length&&(c+="\n"+g.join("\n")),r&&(c+=(0<c.length?"\n":"")+"thymio.timer.period[1] = 50\n"));for(n=0;n<e.length;n++)!/onevent/.test(d[e[n]].P)&&(d[e[n]].Wa||d[e[n]].ba||d[e[n]].Ia)&&(c+="\n"+(d[e[n]].P||"")+(d[e[n]].Wa||"")+(d[e[n]].ba||"")+(d[e[n]].Ia||"")+(d[e[n]].ib||""));0<h.length&&(c+="\n"+h.join("\n"));for(n=0;n<e.length;n++)/onevent/.test(d[e[n]].P)&&
(d[e[n]].Wa||d[e[n]].ba||d[e[n]].Ia)&&(c+="\n"+(d[e[n]].P||"")+(d[e[n]].Wa||"")+(d[e[n]].ba||"")+(d[e[n]].Ia||"")+(d[e[n]].ib||""));if(r){c+="\n@thymio.onevent(thymio.TIMER1)\ndef onevent_timer1():\n"+m.join("")+r+u;for(n=0;n<k.length;n++)c+="eventCache["+n+"] = False\n";for(n=0;n<p;n++)c+="todo["+n+"] = False\n";c+="<\n"}"\n"===c[0]&&(c=c.slice(1));c&&(c="import thymio\n\n"+c);c=mb(c);c=c.replace(/\n[ \t]+/g,"\n").replace(/\n<\n\n<\n/g,"\n<\n<\n");var t=0,q="";c.split("\n").map(function(z){return z.trim()}).forEach(function(z){var C=
mb(z);if(0<C.length){var y=":"===C.slice(-1);"<"===C&&(t=Math.max(t-1,0));"<"!==C&&(z="\t\t\t\t\t".slice(0,t)+z,y&&t++)}"<"!==C&&(q+=z+"\n")});c=q;for(n=0;n<a.i.length;n++)for(b=n+1;b<a.i.length;b++)Ga(a.i[n],a.i[b]);return c=lb(this.b,c)};tb.prototype.h=function(a){var b="# missing Python implementation for block "+a.V.name+"\n";switch(a.V.type){case "e":case "s":return{ba:b,Va:"True"};case "a":return{ka:b};default:return{}}};wa.python=new tb;function ub(){qb.call(this)}ub.prototype=Object.create(jb.prototype);ub.prototype.constructor=ub;ub.prototype.Ac=function(a,b){a=qb.prototype.Ac.call(this,a,b);b=new vb(wb);a=new xb(b,a);a.ga=yb;a=zb(a);return Ab(a,!0)};wa.asm=new ub;function Bb(a){this.L=[];this.b=a||null}Q=Bb.prototype;Q.add=function(a,b){this.L.push(new Cb(a,b))};Q.find=function(a){for(var b=0;b<this.L.length;b++)if(this.L[b].name===a)return this.L[b];return null};function Db(a,b){a=a.find(b);return null!=a&&null!=a.m}function Eb(a,b){if(a.b){var c=a.find(b);b={cmd:b};c.h&&(b.selected=c.Ua());c.b&&(b.state=c.getState());a.b({type:"cmd",data:b})}}Q.lb=function(a,b){this.b&&this.b({type:"drop",data:{cmd:a}});(a=this.find(a))&&a.lb(b)};
Q.kb=function(a,b){a=this.find(a);return null!=a&&a.kb(b)};Q.T=function(a){a=this.find(a);return null!=a&&a.T()};Q.isEnabled=function(a){a=this.find(a);return null!=a&&a.isEnabled()};Q.Ua=function(a){a=this.find(a);return null!=a&&a.Ua()};Q.getState=function(a){a=this.find(a);return null!=a?a.getState():null};
function Cb(a,b){this.name=a;this.o=b.isEnabled||null;this.h=b.Ua||null;this.b=b.getState||null;this.m=b.action||null;this.M=b.lb||null;this.w=b.kb||null;this.Dc=b.object||null;this.Qc=b.Qc||!1;this.R=b.T||null;this.cb=b.cb||null}function Fb(a,b){a.isEnabled()&&a.m&&a.m(a.Dc,b)}function Gb(a,b){if(!a.b)return!1;var c=a.getState();if(b===c)return!0;for(var d=0;100>d;d++){Fb(a,void 0);var e=a.getState();if(e===b)return!0;if(e===c)break}return!1}Q=Cb.prototype;
Q.lb=function(a){this.kb(a)&&this.M&&this.M(this.Dc,a)};Q.kb=function(a){return null!=this.w&&this.w(this.Dc,a)};Q.isEnabled=function(){return null==this.o||this.o(this.Dc)};Q.Ua=function(){return null!=this.h&&this.h(this.Dc)};Q.getState=function(){return null!=this.b?this.b(this.Dc):null};Q.T=function(){return null==this.R||this.R(this.Dc)};function Hb(a){Ib||(Wa(),Ib=!0);this.hb=a;this.X=new Jb;this.h=new La;this.ia=new Ja;var b=this;this.L=new Bb(function(c){b.log(c)});this.Pb=null;this.ga="vpl:close !space vpl:about vpl:help !space vpl:new vpl:save vpl:load vpl:upload vpl:filename vpl:exportToHTML !space vpl:advanced !stretch vpl:readonly !stretch vpl:undo vpl:redo !stretch vpl:connected !stretch vpl:run vpl:stop vpl:debug vpl:robot !stretch vpl:sim vpl:text !stretch vpl:teacher-reset vpl:teacher-save vpl:teacher-setasnew vpl:teacher".split(" ");
this.M="!!stretch vpl:message-error vpl:message-warning !!stretch vpl:duplicate vpl:disable vpl:lock vpl:trashcan".split(" ");this.Oa="src:close !space src:new src:save !space src:language src:disass !stretch src:run src:stop !stretch src:sim src:vpl !space src:locked !stretch src:teacher-reset src:teacher".split(" ");this.za="sim:close !stretch sim:restart sim:pause !space sim:speedup sim:noise !stretch sim:pen sim:clear !space sim:map-kind sim:map sim:map-ground sim:map-obstacles sim:map-height !stretch sim:vpl sim:text !stretch sim:teacher-reset sim:teacher".split(" ");
this.Aa=["vpl"];this.kc={vpl:1,src:1,sim:1};this.Tc=["ground","height","obstacles"];this.Td=this.Jf=this.Ge=this.ue=this.Ee=null;this.uc=!1;this.username=null;this.i=new Pa(this.ia);ib(this.i,function(c){b.log(c)});this.ic="";this.Ud=!1;this.da=new Kb(a,{X:this.X});this.da.state={oh:new Lb};this.R="";this.G=this.b=null;this.Ma=[];this.ya=-1;this.ag=this.Nd=!1;this.o=null;this.da.Oa=function(){null!==b.o&&(b.o=null,Mb(b))};this.m=null;this.Xb=[];this.Me=this.qb=null}var Ib=!1;
Hb.prototype.translate=function(a,b){return this.h.translate(a,b)};function Nb(a,b){a.ue=b?new Ob(b):null}function Pb(a,b){a.Jf=b?new Ob(b):null}function Qb(a){if(a.w){var b="b"===a.i.mode?a.i.oc:a.i.nc;a.w.uf={};var c=Rb(100,100);Za.forEach(function(d){try{var e=new ua(d,null,null);e.g=d.gb?d.gb():e.g;var f="vpl:block:"+d.name.replace(/ /g,"-"),g=e.toDataURL(this.X,c,1);this.w.uf[f]=g}catch(h){}},a);b=a.w.Ac(a.h.language,b);Pb(a,b)}}
Hb.prototype.fb=function(a,b){function c(){0<=a.indexOf("vpl")&&Sb(d.da);0<=a.indexOf("src")&&Sb(d.I.Ha);0<=a.indexOf("sim")&&Sb(d.b)}var d=this;b&&(b.fa||b.Zf)&&(this.i.fa=!0,this.I.fa=!0,Tb(this.I,!1));if(1===a.length&&b&&b.Ld&&1<this.Aa.length){if(0<=this.Aa.indexOf(a[0]))return;var e=this.Aa.slice();e[this.Aa[0]===b.Ld?1:0]=a[0];a=e}else b&&b.Pd?0>this.Aa.indexOf(a[0])&&(a=this.Aa.concat(a)):1===a.length&&b&&b.Ye&&1<this.Aa.length&&0<=this.Aa.indexOf(a[0])?(this.Aa.splice(this.Aa.indexOf(a[0]),
1),a=this.Aa):1===a.length&&b&&b.toggle&&(0<=this.Aa.indexOf(a[0])?(this.Aa.splice(this.Aa.indexOf(a[0]),1),a=this.Aa):a=this.Aa.concat(a));this.Aa=a;null!=this.G&&this.b.Cc();this.da.Cc();null!=this.I&&(document.getElementById("src-editor").style.display=0<=a.indexOf("src")?"block":"none",this.I.Ha.Cc());0<=a.indexOf("vpl")&&this.da.show();0<=a.indexOf("src")&&this.I.Ha.show();null!=this.G&&0<=a.indexOf("sim")&&this.b.show();Ub(this,window.innerWidth<window.innerHeight);for(e=0;e<a.length;e++)switch(a[e]){case "vpl":this.da.pa=
function(){if(!d.i.fa){d.i.code={};var f=d.i;if(0!==f.i.length&&f.i[f.i.length-1].Tb())for(;1<f.i.length&&f.i[f.i.length-2].Tb();)f.i.splice(-2,1);else f.i.push(new Ba);if(d.I){f=d.I;var g=d.i.$b(d.i.Cb);if(f.hd){var h=f.de(f.language,g);null!==h&&(Vb(f,h,!0),f.fc.vb.readOnly=!0,f.hd=g)}else Vb(f,g)}d.log()}Mb(d)};break;case "src":Tb(this.I,!(b&&(b.fa||b.Zf)));this.I.focus();this.I.resize(window.innerWidth,window.innerHeight);break;case "sim":this.b.pa=function(){Wb(d)}}b&&(b.Ye||b.Pd)&&Xb(d);this.da&&
(this.da.pb=c);this.I&&this.I.Ha&&(this.I.Ha.pb=c);this.b&&(this.b.pb=c);0<=a.indexOf("vpl")&&(this.da.pa(),this.da.pb?this.da.pb():Sb(this.da));0<=a.indexOf("src")&&(Yb(this),this.I.Ha.pb?this.I.Ha.pb():Sb(this.I.Ha));0<=a.indexOf("sim")&&(this.start(!1),this.b.pa(),this.b.pb?this.b.pb():Sb(this.b))};Hb.prototype.setView=Hb.prototype.fb;
function Ub(a,b){for(var c=a.Aa.map(function(h){return this.kc[h]},a),d=c.reduce(function(h,k){return h+k},0),e=0,f=0;f<a.Aa.length;f++){var g=b?{Z:0,ra:1,$:e,na:e+c[f]/d}:{Z:e,ra:e+c[f]/d,$:0,na:1};e+=c[f]/d;switch(a.Aa[f]){case "vpl":Zb(a.da,g);break;case "src":Zb(a.I.Ha,g);break;case "sim":Zb(a.b,g)}}}
function Xb(a){var b=a.da.b.parentElement.getBoundingClientRect(),c=b.width;b=window.innerHeight-b.top;Ub(a,c<b);window.vplDisableResize&&(b=a.da.b.getBoundingClientRect(),c=b.width,b=b.height);a.da.resize(c,b);a.I&&a.I.resize(c,b);a.G&&a.b.resize(c,b);a.Aa.forEach(function(d){switch(d){case "vpl":Mb(this);break;case "src":Sb(this.I.Ha);break;case "sim":this.G&&Wb(this)}},a);a.ue&&$b(a.ue)}function ac(a){if(0<=a.ya){var b=Aa("!stop"),c=a.i.Cb;(b=b&&b.Jb[c])&&a.Ma[a.ya].eb.Zb(b(null).ka,c)}}
function bc(a){return!a.i.fa&&a.Ma[a.ya].eb.isEnabled(a.i.Cb)}function cc(a,b){a.Xb.push(b)}
Hb.prototype.log=function(a){if(null==a){dc(this);a={type:"vpl-changed",data:{filename:this.i.filename,nrules:this.i.i.reduce(function(c,d){return 0<d.U.length+d.actions.length?c+1:c},0),nblocks:this.i.i.reduce(function(c,d){return c+d.U.length+d.actions.length},0),error:this.ic&&!this.Ud?this.ic:null,warning:this.ic&&this.Ud?this.ic:null,robot:0<=this.ya?this.Ma[this.ya].eb.isConnected()&&this.Ma[this.ya].eb.Md():null}};var b=JSON.stringify(a);if(b===this.qb)return;this.qb=b}this.Xb.forEach(function(c){try{c(a)}catch(d){}})};function ec(a){function b(e){function f(y){for(var A=0;A<t.length;A++)if(t[A].uri){var K=fc(t[A].uri);if(a.ub[K.Jc].If(y,K.id))return!0}return!1}var g=e.name;if("!"===g[0])return 0;var h=0;/^\w/.test(g)||(c+='Bad block name "'+g+'"\n',h++);var k=e.defaultParameters,l=e.typicalParameters,w=e.buttons,n=e.radiobuttons,v=e.sliders,m=e.rotating,r=e.diffwheelmotion,u=e.score,p=e.otherParameters?parseInt(e.otherParameters,10):0,t=e.draw;if(t){e=null;for(var q=0;q<t.length;q++)if(t[q].uri)if(null==e){e=fc(t[q].uri).Jc;
var z=a.ub[e]}else{var C=fc(t[q].uri);C.Jc!==e?(c+='In block "'+g+'", multiple svg\n',h++):z.qc(C.id)||(c+='In block "'+g+'", uri "'+t[q].uri+'" not found\n',h++)}}w&&w.forEach(function(y){z.qc(y.id)?f(y.id)||(c+='In block "'+g+'", button id "'+y.id+'" not displayed\n',h++):(c+='In block "'+g+'", button id "'+y.id+'" not found\n',h++);void 0==y.val?(c+='In block "'+g+'", missing property "val"\n',h++):void 0==y.st?(c+='In block "'+g+'", missing property "st"\n',h++):y.val.length!==y.st.length&&(c+=
'In block "'+g+'", properties "val" and "st" have different lengths\n',h++)});n&&n.forEach(function(y){z.qc(y.id)?f(y.id)?void 0==y.val?(c+='In block "'+g+'", missing property "val"\n',h++):y.val instanceof Array?(c+='In block "'+g+'", illegal array in property "val"\n',h++):void 0==y.st?(c+='In block "'+g+'", missing property "st"\n',h++):2!==y.st.length&&(c+='In block "'+g+'", property "st" must have length 2\n',h++):(c+='In block "'+g+'", radiobutton id "'+y.id+'" not displayed\n',h++):(c+='In block "'+
g+'", radiobutton id "'+y.id+'" not found\n',h++)});v&&v.forEach(function(y){z.qc(y.id)?f(y.id)||(c+='In block "'+g+'", slider id "'+y.id+'" not displayed\n',h++):(c+='In block "'+g+'", slider id "'+y.id+'" not found\n',h++);z.qc(y.thumbId)?f(y.thumbId)||(c+='In block "'+g+'", slider thumbId "'+y.thumbId+'" not displayed\n',h++):(c+='In block "'+g+'", slider thumbId "'+y.thumbId+'" not found\n',h++);void 0==y.min&&(c+='In block "'+g+'", slider min undefined\n',h++);void 0==y.max&&(c+='In block "'+
g+'", slider max undefined\n',h++);y.lowerPartId&&!z.qc(y.lowerPartId)&&(c+='In block "'+g+'", slider lowerPartId "'+y.lowerPartId+'" not found\n',h++);if(y.snap&&(y=y.snap,y instanceof Array))for(var A=0;A<y.length;A++)"string"===typeof y[A]?/^`.+`$/.test(y[A])||(c+='In block "'+g+'", invalid slider snap expression\n',h++):"number"!==typeof y[A]&&(c+='In block "'+g+'", slider snap must be a number or a string\n',h++)});m&&m.forEach(function(y){var A=y.id,K=y.centerId;y=y.thumbId;z.qc(A)?f(A)||(c+=
'In block "'+g+'", rotating id "'+A+'" not displayed\n',h++):(c+='In block "'+g+'", rotating id "'+A+'" not found\n',h++);z.qc(K)||(c+='In block "'+g+'", rotating centerId "'+K+'" not found\n',h++);z.qc(y)?f(y)||(c+='In block "'+g+'", rotating thumbId "'+y+'" not displayed\n',h++):(c+='In block "'+g+'", rotating thumbId "'+y+'" not found\n',h++);z.If(y,A)||(c+='In block "'+g+'", rotating thumbId "'+y+'" not a descendent of id "'+A+'"\n',h++)});r&&(z.qc(r.id)?f(r.id)||(c+='In block "'+g+'", diffwheelmotion id "'+
r.id+'" not displayed\n',h++):(c+='In block "'+g+'", diffwheelmotion id "'+r.id+'" not found\n',h++));u&&(z.qc(u.id)?f(u.id)||(c+='In block "'+g+'", score id "'+u.id+'" not displayed\n',h++):(c+='In block "'+g+'", score id "'+u.id+'" not found\n',h++),"number"!==typeof u.numHeights||u.numHeights!==Math.round(u.numHeights)||0>=u.numHeights)&&(c+='In block "'+g+'", score numHeights must be a strictly positive integer\n',h++);(w||n||v||m||u||0<p)&&!k&&(c+='In block "'+g+'", missing defaultParameters\n',
h++);k&&(r=0,w&&(r+=w.length),n&&(r+=1),v&&(r+=v.length),m&&(r+=m.length),u&&(r+=2*Math.floor((k.length-r)/2)),r+=p,r!==k.length?(c+='In block "'+g+'", defaultParameters.length='+k.length+", needs "+r+" parameters\n",h++):l&&l.length!=r&&(c+='In block "'+g+'", typicalParameters.length='+l.length+", needs "+r+" parameters\n",h++));return h}var c="",d=0;a.blocks&&a.blocks.forEach(function(e){d+=b(e)});0<d&&(c+=d+" error"+(1<d?"s":"")+"\n");return c||null};function gc(a){a.L.add("vpl:close",{action:function(b){b.fb(["vpl"],{Ye:!0})},object:a,T:function(b){return 1<b.Aa.length&&0<=b.Aa.indexOf("vpl")}});a.L.add("vpl:about",{action:function(b){b.ue.show()},object:a,T:function(b){return null!=b.ue}});a.L.add("vpl:help",{action:function(b){b.Jf.show()},object:a,T:function(b){return null!=b.Jf}});a.L.add("vpl:readonly",{isEnabled:function(){return!1},object:a,T:function(b){return b.i.readOnly||b.i.fa}});a.L.add("vpl:suspend",{action:function(b){b.uc=!b.uc;
b.uc?(bc(b)&&(ac(b),b.i.Ec=!1),b.Td.show()):b.Td.Cc()},Ua:function(b){return b.uc},object:a,T:function(b){return b.i.Eb===Qa&&null!=b.Td}});a.L.add("vpl:new",{action:function(b){$a(b.i);b.Ee&&hc(b,b.Ee)},isEnabled:function(b){return!b.i.fa&&!b.i.readOnly&&!b.i.Tb()},object:a,T:function(b){return!b.i.readOnly}});a.L.add("vpl:save",{action:function(b,c){c?(b=ic(b,b.X),jc(b,"vpl-program.html","text/html")):(c=eb(b.i,{$c:!0,cd:!0}),jc(c,b.i.filename||"program.vpl3","application/x-vpl3"))},isEnabled:function(b){return!b.i.fa&&
!b.i.Tb()},object:a,T:function(b){return!b.i.readOnly}});a.L.add("vpl:load",{action:function(b){b.Ge.show("Open program file",".aesl,.json,.vpl3,.vpl3ui",function(c){kc(b,c)})},isEnabled:function(b){return!b.i.fa&&!b.i.readOnly},object:a,T:function(b){return!b.i.readOnly}});a.L.add("vpl:upload",{action:function(b){var c=eb(b.i,{$c:!1,cd:!0});window.vplUpload(b.i.filename,c)},isEnabled:function(b){return!b.i.fa&&!b.i.readOnly&&!b.i.Tb()},object:a,T:function(b){return null!=window.vplUpload&&!b.i.readOnly}});
a.L.add("vpl:exportToHTML",{action:function(b,c){c?(b=lc(b,b.X),jc(b,"vpl-ui.html","text/html")):(b=ic(b,b.X),jc(b,"vpl-program.html","text/html"))},isEnabled:function(b){return!b.i.fa&&!b.i.Tb()},object:a});a.L.add("vpl:text",{action:function(b){b.Nd?b.fb(["src"],{Pd:!0}):b.fb(["src"],{Ld:"vpl"})},isEnabled:function(b){return!b.i.fa},lb:function(b,c){if(c.data instanceof ua&&c.data.Ab){if(c=gb(b.i.Cb,c.data))b.fb(["src"]),b.I.qf(c.Hd,c.end)}else c.data instanceof Ba&&(c=gb(b.i.Cb,c.data))&&(b.fb(["src"]),
b.I.qf(c.Hd,c.end))},kb:function(b,c){return c.data instanceof ua&&null!=c.data.Ab||c.data instanceof Ba},object:a,T:function(b){return b.I&&0>b.Aa.indexOf("src")}});a.L.add("vpl:text-toggle",{action:function(b){b.fb(["src"],{toggle:!0})},isEnabled:function(b){return!b.i.fa},Ua:function(b){return 0<=b.Aa.indexOf("src")},object:a,cb:[{selected:!1},{selected:!0}]});a.L.add("vpl:advanced",{action:function(b){db(b.i,"b"===b.i.mode?"a":"b");Qb(b)},isEnabled:function(b){return!b.i.fa&&!b.i.readOnly},Ua:function(b){return"a"===
b.i.mode},object:a,T:function(b){return!b.i.readOnly},cb:[{selected:!1},{selected:!0}]});a.L.add("vpl:undo",{action:function(b){b.i.Yf(function(){Mb(b)})},isEnabled:function(b){return!b.i.fa&&0<b.i.Uc.hc.length},object:a,T:function(b){return!b.i.readOnly}});a.L.add("vpl:redo",{action:function(b){b.i.Qf(function(){Mb(b)})},isEnabled:function(b){return!b.i.fa&&0<b.i.Uc.dd.length},object:a,T:function(b){return!b.i.readOnly}});a.L.add("vpl:run",{action:function(b){var c=b.i.$b(b.i.Cb);b.Ma[b.ya].eb.Zb(c,
b.i.Cb);b.i.Ec=!0;b.i.Mf=!1},isEnabled:function(b){if(b.i.fa||!b.Ma[b.ya].eb.isEnabled(b.i.Cb))return!1;b=b.i.getError();return null==b||b.Kb},Ua:function(b){return b.i.Ec},getState:function(b){if(b.i.Tb())return"empty";if(b.i.Ec)return"running";var c=b.i.getError();return c&&!c.Kb?"error":b.i.Mf?"canLoad":"canReload"},lb:function(b,c){c.data instanceof ua?c.data.Ab?(c=wa[b.i.Cb].Ac(b.i,[c.data]),b.Ma[b.ya].eb.Zb(c,b.i.Cb)):b.da.wb=mc(b.da,c):c.data instanceof Ba&&(c=wa[b.i.Cb].Ac(b.i,c.data.actions),
b.Ma[b.ya].eb.Zb(c,b.i.Cb))},kb:function(b,c){if(b=b.Ma[b.ya].eb.isEnabled(b.i.Cb)&&c.data instanceof Ba)a:{b=c.data;for(var d=0;d<b.U.length;d++)if("a"===b.U[d].V.type){b=!0;break a}for(d=0;d<b.actions.length;d++)if("a"===b.actions[d].V.type){b=!0;break a}b=!1}return b||c.data instanceof ua&&null!=c.data.Ab&&"a"===c.data.V.type},object:a,T:function(b){return 0<=b.ya},cb:[{selected:!1},{selected:!0},{state:"empty"},{state:"running"},{state:"error"},{state:"canLoad"},{state:"canReload"}]});a.L.add("vpl:stop",
{action:function(b){ac(b);b.i.Ec=!1},isEnabled:function(b){return bc(b)},object:a,T:function(b){return 0<=b.ya}});a.L.add("vpl:debug",{action:function(){},Ua:function(){return!1},object:a,T:function(){return!1},cb:[{selected:!1},{selected:!0}]});a.L.add("vpl:connected",{Ua:function(b){return!b.i.fa&&b.Ma[b.ya].eb.isConnected()},getState:function(b){return b.Me?"monitored":!1===b.Me?"nonmonitored":""},object:a,T:function(b){return 0<=b.ya},cb:[{selected:!1},{selected:!0},{selected:!1,state:"monitored"},
{selected:!0,state:"monitored"},{selected:!1,state:"nonmonitored"},{selected:!0,state:"nonmonitored"}]});a.L.add("vpl:robot",{action:function(b){b.ya=(b.ya+1)%b.Ma.length},getState:function(b){return b.Ma[b.ya].name},object:a,T:function(b){return 1<b.Ma.length}});a.L.add("vpl:sim",{action:function(b){b.Nd?b.fb(["sim"],{Pd:!0}):b.fb(["sim"],{Ld:"vpl"})},isEnabled:function(b){return!b.i.fa},object:a,T:function(b){return 0<=b.ya&&null!=b.G&&0>b.Aa.indexOf("sim")}});a.L.add("vpl:duplicate",{isEnabled:function(b){return!b.i.fa},
lb:function(b,c){var d=b.i.i.indexOf(c.data);0<=d&&(b.i.Bb(),b.i.i.splice(d+1,0,c.data.ob()),b.da.pa&&b.da.pa(),b.log())},kb:function(b,c){return c.data instanceof Ba&&!c.data.Tb()},object:a,T:function(b){return!b.i.readOnly}});a.L.add("vpl:disable",{isEnabled:function(b){return!b.i.fa},lb:function(b,c){c.data instanceof ua?(b.i.Bb(),c.data.disabled=!c.data.disabled,b.da.pa&&b.da.pa(),b.log()):c.data instanceof Ba&&(b.i.Bb(),c=c.data,c.disabled=!c.disabled,c.disabled&&(c.error=null),b.da.pa&&b.da.pa(),
b.log())},kb:function(b,c){return c.data instanceof Ba?!c.data.Tb():c.data instanceof ua&&null!==c.data.Ab},object:a,T:function(b){return!b.i.readOnly}});a.L.add("vpl:lock",{isEnabled:function(b){return!b.i.fa},lb:function(b,c){c.data instanceof ua?(b.i.Bb(),c.data.locked=!c.data.locked,b.da.pa&&b.da.pa(),b.log()):c.data instanceof Ba&&(b.i.Bb(),c.data.locked=!c.data.locked,b.da.pa&&b.da.pa(),b.log())},kb:function(b,c){return c.data instanceof Ba?!c.data.Tb():c.data instanceof ua&&null!==c.data.Ab},
object:a,T:function(b){return b.i.rg&&"t"===b.i.Eb&&!b.i.readOnly}});a.L.add("vpl:trashcan",{isEnabled:function(b){return!b.i.fa},lb:function(b,c){c.data instanceof ua?null!==c.data.Ab&&(b.i.Bb(),Ea(c.data.Ab,c.data.ke),b.da.pa&&b.da.pa(),b.log()):c.data instanceof Ba&&(c=b.i.i.indexOf(c.data),0<=c&&(b.i.Bb(),b.i.i.splice(c,1),b.da.pa&&b.da.pa(),b.log()))},kb:function(b,c){return c.data instanceof ua?null!==c.data.Ab&&!c.data.locked:c.data instanceof Ba&&(!c.data.Tb()||b.i.i.indexOf(c.data)+1<b.i.i.length)&&
!c.data.locked},object:a,T:function(b){return!b.i.readOnly}});a.L.add("vpl:message-error",{isEnabled:function(){return!1},getState:function(b){return b.ic},object:a,T:function(b){return b.ic&&!b.Ud}});a.L.add("vpl:message-warning",{isEnabled:function(){return!1},getState:function(b){return b.ic},object:a,T:function(b){return b.ic&&b.Ud}});a.L.add("vpl:message-empty",{isEnabled:function(){return!1},object:a,T:function(b){return!b.ic}});a.L.add("vpl:filename",{isEnabled:function(){return!1},getState:function(b){return(b.i.filename||
"")+(b.username?"\n"+b.username:"")},object:a,T:function(b){return b.i.filename||b.username?!0:!1}});a.L.add("vpl:teacher",{action:function(b){b.i.ia.xb=!b.i.ia.xb;"t"===b.i.Eb?b.i.ia.Wb=b.i.ia.xb:b.i.ia.re=b.i.ia.xb;b.i.ia.xb||Qb(b)},isEnabled:function(b){return!b.i.fa&&!b.i.readOnly},Ua:function(b){return b.i.ia.xb},object:a,Qc:!0,T:function(b){return b.i.Eb!==Qa&&!b.i.readOnly},cb:[{selected:!1},{selected:!0}]});a.L.add("vpl:teacher-reset",{action:function(b,c){c?(Ya(b.i.mode),b.i.oc=Sa,b.i.nc=
Ua):(Wa(),$a(b.i),b.i.me())},isEnabled:function(b){return!b.i.fa},object:a,Qc:!0,T:function(b){return b.i.Eb!==Qa&&b.i.ia.xb&&!b.i.readOnly}});a.L.add("vpl:teacher-save",{action:function(b){b=eb(b.i,{$c:!0,cd:!1});jc(b,"ui.vpl3ui","application/x-vpl3-ui")},isEnabled:function(b){return!b.i.fa},object:a,Qc:!0,T:function(b){return b.i.Eb!==Qa&&b.i.ia.xb&&!b.i.readOnly}});a.L.add("vpl:teacher-setasnew",{action:function(b){var c=eb(b.i,{$c:!0,cd:!1});b.Ee=b.Ee===c?null:c},Ua:function(b){return b.Ee===
eb(b.i,{$c:!0,cd:!1})},object:a,Qc:!0,T:function(b){return b.i.Eb!==Qa&&b.i.ia.xb&&!b.i.readOnly},cb:[{selected:!1},{selected:!0}]})};function nc(a){this.h=a;this.controls=[];this.b="";this.y=this.x=0}function oc(a,b,c,d,e,f,g){a.controls.push({H:b,action:d||null,lb:e||null,kb:f||null,id:g||"",Hc:c,x:0,y:0});a.b+="X"}
function pc(a,b,c,d){a.x=b.x;a.y=b.y;for(var e=a.b.replace(/^[s ]+/,"").replace(/[s ]+$/,"").replace(/ +/g," ").replace(/s +/g,"s").replace(/ +s/g,"s").replace(/s+/g,"s"),f=0,g=0,h=0,k=0,l=0;l<e.length;l++)switch(e[l]){case "X":f+=qc(c[a.controls[k].id]);k++;break;case " ":case "_":g++;break;case "s":case "S":h++}d=d?qc(d):0;var w=0;if(f>=b.width)d=0;else for(;;){w=(b.width-(f+d*g))/h;if(w>=d||!(0<d))break;d/=2}k=0;f=b.x;for(l=0;l<e.length;l++)switch(e[l]){case "X":g=a.controls[k];g.x=f+c[g.id].offsetLeft();
f+=qc(c[g.id]);g.y=b.y+c[g.id].offsetTop();k++;break;case " ":case "_":f+=d;break;case "s":case "S":f+=w}}function rc(a,b,c,d){sc(a.h,function(e){tc(b,e,a.x,a.y)});a.controls.forEach(function(e){uc(this.h,e.x,e.y,c[e.id],function(f,g,h){var k=Math.min(g.width/(e.Hc.ra-e.Hc.Z),g.height/(e.Hc.na-e.Hc.$));f.save();f.translate(-e.Hc.Z,-e.Hc.$);f.scale(k,k);e.H(f,g,h);f.restore()},e.action,e.lb,e.kb,d?function(){d(e.id)}:null,e.id)},a)};function vc(a,b,c,d,e,f,g,h,k,l){function w(p,t,q){b.save();q&&(b.scale(-1,1),b.translate(-2*p-c.c,0));b.fillStyle=k&&g?m.wa:m.sa;b.fillRect(p,t,c.c,c.c);b.fillStyle=g?m.O:m.ca;b.beginPath();b.moveTo(p+.1*c.c,t+.6*c.c);b.lineTo(p+.4*c.c,t+.6*c.c);b.lineTo(p+.25*c.c,t+.34*c.c);b.closePath();b.fill();b.beginPath();b.arc(p+.5*c.c,t+.83*c.c,.4*c.c,4.2,5.6);b.strokeStyle=b.fillStyle;b.lineWidth=.08*c.c;b.stroke();b.restore()}function n(p,t,q){b.save();b.fillStyle=k?m.wa:m.sa;b.fillRect(p,t,r.width,r.height);
b.translate(p+r.width/2,t+r.width/2);b.rotate(-q*Math.PI/2);b.translate(-p-r.width/2,-t-r.width/2);b.beginPath();b.moveTo(p+.3557*r.width,t+.25*r.width);b.lineTo(p+.3557*r.width,t+.75*r.width);b.lineTo(p+.7887*r.width,t+.5*r.width);b.closePath();b.strokeStyle=m.O;b.lineWidth=c.ta;b.stroke();b.restore()}function v(){b.beginPath();b.moveTo(0,.5*c.c);b.lineTo(.5*c.c,.5*c.c);b.lineTo(.5*c.c,-.25*c.c);b.bezierCurveTo(.3*c.c,-.5*c.c,.02*c.c,-.5*c.c,0,-.5*c.c);b.lineTo(0,-.5*c.c);b.bezierCurveTo(-.02*c.c,
-.5*c.c,-.3*c.c,-.5*c.c,-.5*c.c,-.25*c.c);b.lineTo(-.5*c.c,.5*c.c);b.closePath();b.fillStyle=g?m.O:m.ca;b.fill()}var m={sa:"navy",wa:"#37f",Yc:"#06f",O:"white",ca:"#777",Kc:"#44a",Cf:"#ddf",fe:"#99a",we:"#a00",wf:"#d10",xe:"#d00",xf:"#f50",Kd:"#c66",Df:"#800"};m={sa:"white",wa:"#ddd",Yc:"white",O:"#333",ca:"#999",Kc:"#ddd",Cf:"#555",fe:"#666",we:"#fcc",wf:"#fcc",xe:"#faa",xf:"#faa",Kd:"#866",Df:"#faa"};var r=wc(d,{tag:"button",W:e,id:a.replace(/:/g,"-")}),u={"vpl:close":function(){b.fillStyle=k&&
g?m.wa:m.sa;b.fillRect(0,0,.5*c.c,c.c);b.beginPath();b.moveTo(.1*c.c,.1*c.c);b.lineTo(.4*c.c,.4*c.c);b.moveTo(.1*c.c,.4*c.c);b.lineTo(.4*c.c,.1*c.c);b.strokeStyle=g?m.O:m.ca;b.lineWidth=c.ta;b.stroke()},"vpl:about":function(){b.fillStyle=k&&g?m.wa:m.sa;b.fillRect(0,0,c.c,c.c);b.textAlign="center";b.textBaseline="middle";b.font="bold "+Math.round(.7*c.c).toString(10)+"px times";b.fillStyle=g?m.O:m.ca;b.fillText("i",.5*c.c,.5*c.c)},"vpl:help":function(){b.fillStyle=k&&g?m.wa:m.sa;b.fillRect(0,0,c.c,
c.c);b.textAlign="center";b.textBaseline="middle";b.font="bold "+Math.round(.7*c.c).toString(10)+"px times";b.fillStyle=g?m.O:m.ca;b.fillText("?",.5*c.c,.5*c.c)},"vpl:readonly":function(){var p=c.c;b.save();b.fillStyle=m.fe;b.strokeStyle=m.fe;b.lineWidth=c.ta;b.translate(.5*p,.7*p);b.save();b.rotate(.6);b.beginPath();b.moveTo(-.015/.22*p,.07*p);b.lineTo(0,.22*p);b.lineTo(.015/.22*p,.07*p);b.fill();b.beginPath();b.moveTo(-.1*p,-.4*p);b.lineTo(-.1*p,0);b.lineTo(0,.22*p);b.lineTo(.1*p,0);b.lineTo(.1*
p,-.4*p);b.restore();b.moveTo(-.2*p,-.4*p);b.lineTo(.4*p,.2*p);b.stroke();b.restore()},"vpl:new":function(){b.fillStyle=k&&g?m.wa:m.sa;b.fillRect(0,0,c.c,c.c);b.beginPath();b.moveTo(.25*c.c,.2*c.c);b.lineTo(.25*c.c,.8*c.c);b.lineTo(.75*c.c,.8*c.c);b.lineTo(.75*c.c,.3*c.c);b.lineTo(.65*c.c,.2*c.c);b.closePath();b.moveTo(.65*c.c,.2*c.c);b.lineTo(.65*c.c,.3*c.c);b.lineTo(.75*c.c,.3*c.c);b.strokeStyle=g?m.O:m.ca;b.lineWidth=c.ta;b.stroke()},"vpl:save":function(){b.fillStyle=k&&g?m.wa:m.sa;b.fillRect(0,
0,c.c,c.c);b.beginPath();b.moveTo(.25*c.c,.2*c.c);b.lineTo(.25*c.c,.7*c.c);b.lineTo(.67*c.c,.7*c.c);b.lineTo(.67*c.c,.27*c.c);b.lineTo(.6*c.c,.2*c.c);b.closePath();b.moveTo(.6*c.c,.2*c.c);b.lineTo(.6*c.c,.27*c.c);b.lineTo(.67*c.c,.27*c.c);b.strokeStyle=g?m.O:m.ca;b.lineWidth=c.ta;b.stroke();b.lineWidth=2*c.ta;b.beginPath();b.moveTo(.8*c.c,.5*c.c);b.lineTo(.8*c.c,.8*c.c);b.moveTo(.7*c.c,.7*c.c);b.lineTo(.8*c.c,.8*c.c);b.lineTo(.9*c.c,.7*c.c);b.stroke()},"vpl:exportToHTML":function(){b.fillStyle=k&&
g?m.wa:m.sa;b.fillRect(0,0,c.c,c.c);b.strokeStyle=g?m.O:m.ca;b.lineWidth=2*c.ta;b.beginPath();b.moveTo(.8*c.c,.2*c.c);b.lineTo(.8*c.c,.5*c.c);b.moveTo(.7*c.c,.4*c.c);b.lineTo(.8*c.c,.5*c.c);b.lineTo(.9*c.c,.4*c.c);b.textAlign="center";b.textBaseline="middle";b.font="bold "+Math.round(.3*c.c).toString(10)+"px sans-serif";b.fillStyle=g?m.O:m.ca;b.fillText("HTML",.5*c.c,.7*c.c);b.stroke()},"vpl:load":function(){b.fillStyle=k&&g?m.wa:m.sa;b.fillRect(0,0,c.c,c.c);b.beginPath();b.moveTo(.25*c.c,.2*c.c);
b.lineTo(.25*c.c,.7*c.c);b.lineTo(.67*c.c,.7*c.c);b.lineTo(.67*c.c,.27*c.c);b.lineTo(.6*c.c,.2*c.c);b.closePath();b.moveTo(.6*c.c,.2*c.c);b.lineTo(.6*c.c,.27*c.c);b.lineTo(.67*c.c,.27*c.c);b.strokeStyle=g?m.O:m.ca;b.lineWidth=c.ta;b.stroke();b.lineWidth=2*c.ta;b.beginPath();b.moveTo(.8*c.c,.55*c.c);b.lineTo(.8*c.c,.85*c.c);b.moveTo(.7*c.c,.65*c.c);b.lineTo(.8*c.c,.55*c.c);b.lineTo(.9*c.c,.65*c.c);b.stroke()},"vpl:upload":function(){b.fillStyle=k&&g?m.wa:m.sa;b.fillRect(0,0,c.c,c.c);b.beginPath();
b.moveTo(.25*c.c,.3*c.c);b.lineTo(.25*c.c,.8*c.c);b.lineTo(.67*c.c,.8*c.c);b.lineTo(.67*c.c,.37*c.c);b.lineTo(.6*c.c,.3*c.c);b.closePath();b.moveTo(.6*c.c,.3*c.c);b.lineTo(.6*c.c,.37*c.c);b.lineTo(.67*c.c,.37*c.c);b.strokeStyle=g?m.O:m.ca;b.lineWidth=c.ta;b.stroke();b.lineWidth=2*c.ta;b.beginPath();b.moveTo(.8*c.c,.5*c.c);b.lineTo(.8*c.c,.2*c.c);b.moveTo(.7*c.c,.3*c.c);b.lineTo(.8*c.c,.2*c.c);b.lineTo(.9*c.c,.3*c.c);b.stroke()},"vpl:text":function(){b.fillStyle=k&&g?m.wa:m.sa;b.fillRect(0,0,c.c,c.c);
b.beginPath();b.moveTo(.25*c.c,.2*c.c);b.lineTo(.25*c.c,.8*c.c);b.lineTo(.75*c.c,.8*c.c);b.lineTo(.75*c.c,.3*c.c);b.lineTo(.65*c.c,.2*c.c);b.closePath();b.moveTo(.65*c.c,.2*c.c);b.lineTo(.65*c.c,.3*c.c);b.lineTo(.75*c.c,.3*c.c);for(var p=.2;.6>p;p+=.1)b.moveTo(.3*c.c,c.c*(.2+p)),b.lineTo(.7*c.c,c.c*(.2+p));b.strokeStyle=g?m.O:m.ca;b.lineWidth=c.ta;b.stroke()},"vpl:text-toggle":function(){b.fillStyle=k&&g?m.wa:m.sa;b.fillRect(0,0,c.c,c.c);b.beginPath();b.moveTo(.28*c.c,.2*c.c);b.lineTo(.28*c.c,.7*
c.c);b.lineTo(.7*c.c,.7*c.c);b.lineTo(.7*c.c,.27*c.c);b.lineTo(.63*c.c,.2*c.c);b.closePath();b.moveTo(.63*c.c,.2*c.c);b.lineTo(.63*c.c,.27*c.c);b.lineTo(.7*c.c,.27*c.c);for(var p=.1;.5>p;p+=.1)b.moveTo(.33*c.c,c.c*(.2+p)),b.lineTo(.63*c.c,c.c*(.2+p));b.strokeStyle=g?m.O:m.ca;b.lineWidth=c.ta;b.stroke();b.fillStyle=g?h||k?m.O:m.Kc:m.ca;b.fillRect(.1*c.c,.8*c.c,.8*c.c,.1*c.c)},"vpl:advanced":function(){b.fillStyle=k&&g?m.wa:h?m.Yc:m.sa;b.fillRect(0,0,c.c,c.c);b.fillStyle=g?m.O:m.ca;for(var p=0;4>p;p++)for(var t=
0;5>t;t++)b.fillRect(.1*c.c*(1+p)+(2>p?0:.43*c.c),.1*c.c*(2+t),.07*c.c,.07*c.c);b.fillStyle=g?h||k?m.O:m.Kc:m.ca;b.fillRect(.1*c.c,.8*c.c,.8*c.c,.1*c.c)},"vpl:undo":function(){w(0,0,!1)},"vpl:redo":function(){w(0,0,!0)},"vpl:run":function(){b.fillStyle=k&&g?m.wa:m.sa;b.fillRect(0,0,c.c,c.c);b.beginPath();b.moveTo(.3*c.c,.25*c.c);b.lineTo(.3*c.c,.75*c.c);b.lineTo(.8*c.c,.5*c.c);b.closePath();b.fillStyle=g?m.O:m.ca;b.fill();b.fillStyle=g?h||k?m.O:m.Kc:m.ca;b.fillRect(.1*c.c,.8*c.c,.8*c.c,.1*c.c)},"vpl:stop":function(){b.fillStyle=
k&&g?m.wa:m.sa;b.fillRect(0,0,c.c,c.c);b.fillStyle=g?m.O:m.ca;b.fillRect(.28*c.c,.28*c.c,.44*c.c,.44*c.c)},"vpl:debug":function(){b.fillStyle=k&&g?m.wa:m.sa;b.fillRect(0,0,c.c,c.c);b.strokeStyle=g?m.O:m.ca;b.lineWidth=c.ta;b.save();b.translate(.5*c.c,.42*c.c);b.scale(.0085*c.c,.012*c.c);b.beginPath();b.arc(0,0,20,0,2*Math.PI);b.moveTo(-13,-10);b.bezierCurveTo(0,-5,0,-5,13,-10);b.moveTo(0,-5);b.lineTo(0,20);b.moveTo(-18,-5);b.lineTo(-30,-10);b.moveTo(-18,2);b.lineTo(-32,6);b.moveTo(-15,10);b.lineTo(-26,
18);b.moveTo(18,-5);b.lineTo(30,-10);b.moveTo(18,2);b.lineTo(32,6);b.moveTo(15,10);b.lineTo(26,18);b.restore();b.stroke();b.fillStyle=g?h||k?m.O:m.Kc:m.ca;b.fillRect(.1*c.c,.8*c.c,.8*c.c,.1*c.c)},"vpl:connected":function(){function p(t,q){var z=.08*c.c;b.save();b.fillStyle=g?m.wa:m.sa;b.fillRect(t-z,q-z,2*z,2*z);b.beginPath();b.moveTo(t-z,q-z);b.lineTo(t+z,q+z);b.moveTo(t+z,q-z);b.lineTo(t-z,q+z);b.stroke();b.restore()}g=!1;b.translate(0,.1*c.c);b.save();b.translate(.8*c.c,.2*c.c);b.scale(.35,.35);
v();b.restore();b.fillStyle=g?m.O:m.ca;b.strokeStyle=g?m.O:m.ca;b.lineWidth=1.5*c.ta;l&&b.strokeRect(0,.05*c.c,.3*c.c,.3*c.c);b.strokeRect(.3*c.c,.55*c.c,.4*c.c,.3*c.c);b.lineWidth=c.ta;b.beginPath();b.moveTo(.7*c.c,.7*c.c);b.bezierCurveTo(.9*c.c,.7*c.c,.9*c.c,.7*c.c,.85*c.c,.35*c.c);l&&(b.moveTo(.3*c.c,.7*c.c),b.bezierCurveTo(.1*c.c,.7*c.c,.1*c.c,.7*c.c,.15*c.c,.35*c.c));b.stroke();h||p(.86*c.c,.55*c.c);"nonmonitored"===l&&p(.14*c.c,.55*c.c)},"vpl:robot":function(){b.fillStyle=k?m.wa:m.sa;b.fillRect(0,
0,c.c,c.c);switch(l){case "thymio":b.save();b.translate(c.c/2,.35*c.c);b.scale(.3,.3);b.rotate(.2);v();b.restore();break;case "thymio-tdm":b.save();b.translate(c.c/2,.35*c.c);b.scale(.3,.3);b.rotate(.2);v();b.restore();b.fillStyle=m.O;b.fillRect(.4*c.c,.65*c.c,.2*c.c,.2*c.c);break;case "sim":b.save(),b.translate(c.c/2,.35*c.c),b.scale(.3,.3),b.rotate(.2),v(),b.beginPath(),b.strokeStyle=m.O,b.lineWidth=c.ta/.3,b.strokeRect(-c.c,-.8*c.c,2*c.c,1.6*c.c),b.restore()}b.beginPath();b.moveTo(.2*c.c,.75*c.c);
b.lineTo(.5*c.c,.75*c.c);b.lineTo(.5*c.c,c.c*("sim"===l?.6:.3));b.strokeStyle=m.O;b.lineWidth=c.ta;b.stroke()},"vpl:sim":function(){b.fillStyle=k&&g?m.wa:m.sa;b.fillRect(0,0,c.c,c.c);b.save();b.translate(c.c/2,.35*c.c);b.scale(.4,.4);b.rotate(.2);v();b.beginPath();b.arc(c.c,.5*c.c,1.4*c.c,-3.2,-3.8,!0);b.strokeStyle=k&&g?m.Cf:m.fe;b.lineWidth=.2*c.c;b.stroke();b.beginPath();b.arc(c.c,.5*c.c,.6*c.c,-3.3,-3.8,!0);b.stroke();b.restore()},"vpl:message-empty":function(){},"vpl:message-error":function(){if(l){b.fillStyle=
r.color;b.font=xc(r);b.textAlign="center";b.textBaseline="middle";var p=f.translate(l);b.fillText(p,r.width/2,r.height/2)}},"vpl:filename":function(){if(l){b.beginPath();var p=3*c.c;b.rect(0,0,p,c.c);b.clip();b.fillStyle=r.color;b.font=xc(r);b.textAlign="center";b.textBaseline="middle";var t=l.trim().split("\n").slice(0,2).map(function(q){q=q.slice(0,80);if(1<q.length&&b.measureText(q).width>p){for(;1<q.length&&b.measureText(q+"\u2026").width>p;)q=q.slice(0,-1);q+="\u2026"}return q});1<t.length?(b.fillText(t[0],
r.width/2,.25*r.height),b.fillText(t[1],r.width/2,.75*r.height)):b.fillText(t[0],r.width/2,r.height/2)}},"vpl:duplicate":function(){b.fillStyle=k&&g?m.wa:m.sa;b.fillRect(0,0,c.c,c.c);b.strokeStyle=g?m.O:m.ca;b.lineWidth=c.ta;b.strokeRect(.3*c.c,.3*c.c,.4*c.c,.15*c.c);b.strokeRect(.3*c.c,.55*c.c,.4*c.c,.15*c.c)},"vpl:disable":function(){b.fillStyle=k&&g?m.wa:m.sa;b.fillRect(0,0,c.c,c.c);b.strokeStyle=g?m.O:m.ca;b.lineWidth=c.ta;b.strokeRect(.3*c.c,.3*c.c,.4*c.c,.4*c.c);b.beginPath();b.moveTo(.2*c.c,
.6*c.c);b.lineTo(.8*c.c,.4*c.c);b.stroke()},"vpl:lock":function(){b.fillStyle=k&&g?m.wa:m.sa;b.fillRect(0,0,c.c,c.c);b.strokeStyle=g?m.O:m.ca;b.fillStyle=g?m.O:m.ca;b.lineWidth=c.ta;b.strokeRect(.3*c.c,.3*c.c,.4*c.c,.4*c.c);yc(b,.5*c.c,.52*c.c,.04*c.c,m.O)},"vpl:trashcan":function(){b.fillStyle=k&&g?m.wa:m.sa;b.fillRect(0,0,c.c,c.c);b.beginPath();b.moveTo(.25*c.c,.2*c.c);b.lineTo(.32*c.c,.8*c.c);b.lineTo(.68*c.c,.8*c.c);b.lineTo(.75*c.c,.2*c.c);b.closePath();b.strokeStyle=g?m.O:m.ca;b.lineWidth=c.ta;
b.stroke()},"vpl:teacher-reset":function(){b.fillStyle=k&&g?m.xe:m.we;b.fillRect(0,0,c.c,c.c);b.beginPath();b.moveTo(.25*c.c,.2*c.c);b.lineTo(.25*c.c,.8*c.c);b.lineTo(.75*c.c,.8*c.c);b.lineTo(.75*c.c,.3*c.c);b.lineTo(.65*c.c,.2*c.c);b.closePath();b.moveTo(.65*c.c,.2*c.c);b.lineTo(.65*c.c,.3*c.c);b.lineTo(.75*c.c,.3*c.c);b.strokeStyle=g?m.O:m.Kd;b.lineWidth=c.ta;b.stroke();b.fillStyle=g?m.O:m.Kd;zc(b,.63*c.c,.7*c.c,.2*c.c)},"vpl:teacher-save":function(){b.fillStyle=k&&g?m.xe:m.we;b.fillRect(0,0,c.c,
c.c);b.strokeStyle=g?m.O:m.Kd;b.beginPath();b.moveTo(.25*c.c,.2*c.c);b.lineTo(.25*c.c,.7*c.c);b.lineTo(.67*c.c,.7*c.c);b.lineTo(.67*c.c,.27*c.c);b.lineTo(.6*c.c,.2*c.c);b.closePath();b.moveTo(.6*c.c,.2*c.c);b.lineTo(.6*c.c,.27*c.c);b.lineTo(.67*c.c,.27*c.c);b.lineWidth=c.ta;b.stroke();b.lineWidth=2*c.ta;b.beginPath();b.moveTo(.8*c.c,.5*c.c);b.lineTo(.8*c.c,.8*c.c);b.moveTo(.7*c.c,.7*c.c);b.lineTo(.8*c.c,.8*c.c);b.lineTo(.9*c.c,.7*c.c);b.stroke();b.fillStyle=g?m.O:m.Kd;zc(b,.46*c.c,.45*c.c,.2*c.c)},
"vpl:teacher-setasnew":function(){b.fillStyle=k&&g?h?m.xf:m.xe:h&&g?m.wf:m.we;b.fillRect(0,0,c.c,c.c);b.strokeStyle=g?m.O:m.Kd;b.beginPath();b.moveTo(.25*c.c,.2*c.c);b.lineTo(.25*c.c,.7*c.c);b.lineTo(.67*c.c,.7*c.c);b.lineTo(.67*c.c,.27*c.c);b.lineTo(.6*c.c,.2*c.c);b.closePath();b.moveTo(.6*c.c,.2*c.c);b.lineTo(.6*c.c,.27*c.c);b.lineTo(.67*c.c,.27*c.c);b.lineWidth=c.ta;b.stroke();b.lineWidth=2*c.ta;b.beginPath();b.moveTo(.8*c.c,.5*c.c);b.lineTo(.5*c.c,.5*c.c);b.moveTo(.6*c.c,.4*c.c);b.lineTo(.5*c.c,
.5*c.c);b.lineTo(.6*c.c,.6*c.c);b.stroke();b.fillStyle=g?h||k?m.O:m.Df:m.ca;b.fillRect(.1*c.c,.8*c.c,.8*c.c,.1*c.c)},"vpl:teacher":function(){b.fillStyle=k&&g?h?m.xf:m.xe:h&&g?m.wf:m.we;b.fillRect(0,0,c.c,c.c);b.fillStyle=g?m.O:m.Kd;zc(b,.5*c.c,.4*c.c,.27*c.c);b.fillStyle=g?h||k?m.O:m.Df:m.ca;b.fillRect(.1*c.c,.8*c.c,.8*c.c,.1*c.c)},"src:vpl":function(){b.save();b.fillStyle=k&&g?m.wa:m.sa;b.fillRect(0,0,c.c,c.c);b.beginPath();b.moveTo(.25*c.c,.2*c.c);b.lineTo(.25*c.c,.8*c.c);b.lineTo(.75*c.c,.8*c.c);
b.lineTo(.75*c.c,.3*c.c);b.lineTo(.65*c.c,.2*c.c);b.closePath();b.moveTo(.65*c.c,.2*c.c);b.lineTo(.65*c.c,.3*c.c);b.lineTo(.75*c.c,.3*c.c);b.strokeStyle=g?m.O:m.ca;b.lineWidth=c.ta;b.stroke();b.fillStyle=k&&g?m.O:m.fe;for(var p=.15;.6>p;p+=.15)b.fillRect(.3*c.c,c.c*(.2+p),.4*c.c,.1*c.c);b.restore()},"src:locked":function(){b.save();b.fillStyle=g?k?m.wa:h?m.Yc:m.sa:m.sa;b.fillRect(0,0,c.c,c.c);b.strokeStyle=g?m.O:m.ca;b.lineWidth=c.ta;b.fillStyle=g?h?m.Cf:m.fe:m.ca;for(var p=.15;.6>p;p+=.15)b.fillRect(.15*
c.c,c.c*p,.4*c.c,.1*c.c);yc(b,.77*c.c,.36*c.c,.06*c.c,g?m.O:m.ca,!h);b.fillStyle=g?h||k?m.O:m.Kc:m.ca;b.fillRect(.1*c.c,.8*c.c,.8*c.c,.1*c.c);b.restore()},"src:language":function(){var p=c.c;b.save();b.fillStyle=g?k?m.wa:m.sa:m.sa;b.fillRect(0,0,p,p);b.beginPath();for(var t=0;3>t;t++)b.moveTo(.2*p,p*(.2+.1*t)),b.lineTo(.5*p,p*(.2+.1*t));b.strokeStyle=g?m.O:m.ca;b.lineWidth=c.ta;b.stroke();for(t=0;3>t;t++){var q=2*(t+.25)/3*Math.PI;Ac(b,.75*p,.3*p,.15*p,q-.3*Math.PI,q+.3*Math.PI,{Fd:!1,Xc:3*c.ta,style:g?
m.O:m.ca})}b.textAlign="center";b.textBaseline="middle";b.font="bold "+Math.round(p/3).toString(10)+"px sans-serif";b.fillStyle=g?m.O:m.ca;b.fillText({aseba:"Aa",l2:"l2",asm:"asm",js:"js",python:"Py"}[l],.5*p,.7*p);b.restore()},"src:disass":function(){var p=c.c;b.save();b.fillStyle=g&&k?m.wa:h?m.Yc:m.sa;b.fillRect(0,0,p,p);b.beginPath();b.moveTo(.2*p,.2*p);b.lineTo(.3*p,.2*p);for(var t=0;5>t;t++)b.moveTo(.4*p,p*(.2+.1*t)),b.lineTo(.45*p,p*(.2+.1*t)),b.moveTo(.55*p,p*(.2+.1*t)),b.lineTo(.65*p,p*(.2+
.1*t));b.strokeStyle=g?m.O:m.ca;b.lineWidth=c.ta;b.stroke();b.fillStyle=g&&(h||k)?m.O:m.Kc;b.fillRect(.1*c.c,.8*c.c,.8*c.c,.1*c.c);b.restore()},"sim:restart":function(){b.save();b.fillStyle=k?m.wa:m.sa;b.fillRect(0,0,r.width,r.height);var p=c.c;b.lineWidth=.05*p;Ac(b,.5*p,.5*p,.25*p,1.56,0,{Fd:!1,Xc:.2*p,style:m.O});b.restore()},"sim:pause":function(){b.save();b.fillStyle=k?m.wa:h?m.Yc:m.sa;b.fillRect(0,0,c.c,c.c);b.fillStyle=g?m.O:m.ca;b.fillRect(.28*c.c,.28*c.c,.15*c.c,.44*c.c);h?(b.beginPath(),
b.moveTo(.54*c.c,.28*c.c),b.lineTo(.62*c.c,.28*c.c),b.lineTo(.75*c.c,.5*c.c),b.lineTo(.62*c.c,.72*c.c),b.lineTo(.54*c.c,.72*c.c),b.fill()):b.fillRect(.57*c.c,.28*c.c,.15*c.c,.44*c.c);b.restore()},"sim:speedup":function(){b.save();b.fillStyle=k&&g?m.wa:h?m.Yc:m.sa;b.fillRect(0,0,c.c,c.c);b.fillStyle=g?m.O:m.ca;b.beginPath();for(var p=0;2>p;p++)b.moveTo(c.c*(.3+.22*p),.25*c.c/2),b.lineTo(c.c*(.3+.22*p),.75*c.c/2),b.lineTo(c.c*(.5+.22*p),.5*c.c/2),b.closePath();b.fill();b.textAlign="center";b.textBaseline=
"middle";b.font="bold "+Math.round(c.c/3).toString(10)+"px sans-serif";b.fillText(1<=l?"\u00d7"+l.toString(10):"\u00f7"+Math.round(1/l).toString(10),.5*c.c,.7*c.c);b.restore()},"sim:noise":function(){b.save();b.fillStyle=k&&g?m.wa:h?m.Yc:m.sa;b.fillRect(0,0,c.c,c.c);b.beginPath();var p=[.58,1.48,.96,.39,1.36,.09,-.75,-1.58,-.32,-1.36,-1.39,-.94,-1.1,-1.04,-.1,.93,1.22,.6,.89,.61];b.moveTo(.1*c.c,(.4+.1*p[0])*c.c);for(var t=1;t<p.length;t++)b.lineTo((.1+.8/(p.length-1)*t)*c.c,(.4+.1*p[t])*c.c);b.strokeStyle=
g?m.O:m.ca;b.lineWidth=c.ta;b.stroke();b.fillStyle=g?h||k?m.O:m.Kc:m.ca;b.fillRect(.1*c.c,.8*c.c,.8*c.c,.1*c.c);b.restore()},"sim:pen":function(){var p=c.c;b.save();b.fillStyle=k&&g?m.wa:h?m.Yc:m.sa;b.fillRect(0,0,p,p);b.fillStyle=g?h||k?m.O:m.Kc:m.ca;b.fillRect(.1*p,.8*p,.8*p,.1*p);b.translate(.5*p,p*(.4+(h?.13:0)));b.beginPath();b.moveTo(-.015/.22*p,.07*p);b.lineTo(0,.22*p);b.lineTo(.015/.22*p,.07*p);b.fillStyle=g?m.O:m.ca;b.fill();b.beginPath();b.moveTo(-.1*p,-.22*p);b.lineTo(-.1*p,0);b.lineTo(0,
.22*p);b.lineTo(.1*p,0);b.lineTo(.1*p,-.22*p);b.strokeStyle=g?m.O:m.ca;b.lineWidth=c.ta;b.stroke();b.restore()},"sim:clear":function(){var p=c.c;b.save();b.fillStyle=k&&g?m.wa:m.sa;b.fillRect(0,0,p,p);b.strokeStyle=g?m.O:m.ca;b.lineWidth=c.ta;b.strokeRect(.15*p,.25*p,.7*p,.5*p);b.translate(.5*p,.4*p);b.rotate(.4);b.fillStyle=g?m.O:m.ca;b.fillRect(0,0,.3*p,.2*p);b.restore()},"sim:map-kind":function(){var p=c.c,t=c.ta;b.save();b.fillStyle=k&&g?m.wa:m.sa;b.fillRect(0,0,c.c,c.c);b.lineWidth=t;b.strokeStyle=
g?m.O:m.ca;b.fillStyle=g?m.O:m.ca;for(var q=["ground","height","obstacles"].indexOf(l),z=0;3>z;z++){var C=2*(z+.25)/3*Math.PI;z===q?b.fillRect(p*(.35+.25*Math.cos(C)),p*(.39+.25*Math.sin(C)),.3*p,.22*p):b.strokeRect(p*(.35+.25*Math.cos(C)),p*(.39+.25*Math.sin(C)),.3*p,.22*p);Ac(b,.5*p,.5*p,.36*p,C-.42*Math.PI,C-.22*Math.PI,{Fd:!1,Xc:3*t,style:m.O})}b.restore()},"sim:map":function(){var p=c.c;b.save();b.fillStyle=k&&g?m.wa:h?m.Yc:m.sa;b.fillRect(0,0,c.c,c.c);b.fillStyle=g?h||k?m.O:m.Kc:m.ca;b.fillRect(.1*
p,.8*p,.8*p,.1*p);b.lineWidth=c.ta;b.strokeStyle=g?m.O:m.ca;b.strokeRect(.15*p,.15*p,.7*p,.5*p);switch(l){case "ground":b.lineWidth=.08*p;b.beginPath();b.arc(.6*p,.4*p,.15*p,-.5*Math.PI,.5*Math.PI);b.lineTo(.4*p,.55*p);b.arc(.4*p,.4*p,.15*p,.5*Math.PI,1.5*Math.PI);b.closePath();b.stroke();break;case "height":b.beginPath();for(var t=0;.75>=t;t+=.25)for(var q=0;1>=q;q+=.1){var z=p*(.2+.5*q+.15*t),C=p*(.5-.3*t-.2*(.2*Math.cos(5*q+2*t-3)-(t-.9)*(t-.9)/3));0===q?b.moveTo(z,C):b.lineTo(z,C)}b.stroke();
break;case "obstacles":b.strokeRect(.2*p,.2*p,.6*p,.4*p),b.beginPath(),b.moveTo(.4*p,.2*p),b.lineTo(.4*p,.43*p),b.moveTo(.6*p,.6*p),b.lineTo(.6*p,.37*p),b.stroke()}b.restore()},"sim:map-ground":function(){l="ground";u["sim:map"]()},"sim:map-height":function(){l="height";u["sim:map"]()},"sim:map-obstacles":function(){l="obstacles";u["sim:map"]()},"sim-event:forward":function(){n(0,0,1)},"sim-event:backward":function(){n(0,0,3)},"sim-event:left":function(){n(0,0,2)},"sim-event:right":function(){n(0,
0,0)},"sim-event:center":function(){b.save();b.fillStyle=k?m.wa:m.sa;b.fillRect(0,0,r.width,r.height);b.beginPath();b.arc(.5*r.width,.5*r.width,.25*r.width,0,2*Math.PI);b.strokeStyle=m.O;b.lineWidth=c.ta;b.stroke();b.restore()},"sim-event:clap":function(){b.save();b.fillStyle=k?m.wa:m.sa;b.fillRect(0,0,r.width,r.height);b.beginPath();b.strokeStyle=m.O;b.lineWidth=c.ta;b.translate(.5*r.width,.5*r.width);b.rotate(.1);for(var p=0;9>p;p++)b.beginPath(),b.moveTo(.12*r.width,0),b.lineTo(.24*r.width,0),
b.moveTo(.28*r.width,0),b.lineTo(.36*r.width,0),b.stroke(),b.rotate(Math.PI/4.5);b.restore()},"sim-event:tap":function(){b.save();b.fillStyle=k?m.wa:m.sa;b.fillRect(0,0,r.width,r.height);b.beginPath();b.strokeStyle=m.O;b.lineWidth=c.ta;b.translate(.6*r.width,.6*r.width);for(var p=1;3>=p;p++)b.beginPath(),b.arc(0,0,.15*r.width*p,.9*Math.PI,1.7*Math.PI),b.stroke();b.moveTo(.3*r.width,0);b.lineTo(0,0);b.lineTo(0,.3*r.width);b.stroke();b.restore()}};u["vpl:message-warning"]=u["vpl:message-error"];u["src:close"]=
u["vpl:close"];u["src:new"]=u["vpl:new"];u["src:save"]=u["vpl:save"];u["src:load"]=u["vpl:load"];u["src:run"]=u["vpl:run"];u["src:stop"]=u["vpl:stop"];u["src:connected"]=u["vpl:connected"];u["src:sim"]=u["vpl:sim"];u["src:teacher"]=u["vpl:teacher"];u["src:teacher-reset"]=u["vpl:teacher-reset"];u["sim:close"]=u["vpl:close"];u["sim:vpl"]=u["src:vpl"];u["sim:text"]=u["vpl:text"];u["sim:teacher"]=u["vpl:teacher"];u["sim:teacher-reset"]=u["vpl:teacher-reset"];(a=u[a])&&a()}
function Bc(a,b){switch(a){case "vpl:close":case "src:close":case "sim:close":return{Z:0,ra:b.c/2,$:0,na:b.c};case "vpl:message-error":case "vpl:message-warning":case "vpl:message-empty":return{Z:0,ra:5*b.c,$:0,na:b.c};case "vpl:filename":return{Z:0,ra:3*b.c,$:0,na:b.c}}return{Z:0,ra:b.c,$:0,na:b.c}};function Cc(a,b,c,d,e,f){var g=0<=b.ia.b.indexOf(c);if((b.Pb?b.Pb.T:b.L.T(c))&&(b.ia.Wb||!g)){var h=a.h,k=b.L.find(c).Qc;oc(a,function(l,w,n){b.Pb?e(c,l,h.v,h.X,d,b.h,b.Pb.isEnabled&&(k||!b.ia.re),b.Pb.Ua,b.Pb.fh,b.Pb.state):e(c,l,h.v,h.X,d,b.h,b.L.isEnabled(c)&&(k||!b.ia.re),b.L.Ua(c),n,b.L.getState(c));(b.Pb?b.Pb.disabled:g)&&Dc(h,0,0,w.width,w.height,["button"],["button"])},f,b.ia.Wb&&!k?function(){b.ia.toggle(c);return 1}:!Db(b.L,c)||!k&&b.ia.re?null:function(l){var w=b.L;l=l.gh;var n=w.find(c);
n&&(Fb(n,l),Eb(w,c))},b.ia.Wb&&!k&&b.ia.re?null:function(l,w){b.L.lb(c,w)},b.ia.Wb&&!k&&b.ia.re?null:function(l,w){return b.L.kb(c,w)},c)}}function Ec(a,b,c,d,e,f){a.controls=[];a.b="";for(var g=0;g<c.length;g++)switch(c[g]){case "!space":a.b+=" ";break;case "!!space":a.b+="_";break;case "!stretch":a.b+="s";break;case "!!stretch":a.b+="S";break;default:Cc(a,b,c[g],d,e,f(c[g],a.h.v,b.L.find(c[g]).Dc))}}function Fc(a,b){for(var c=0;c<b.length;c++)if("!"!==b[c][0]&&a.L.T(b[c]))return!0;return!1}
function Gc(a,b,c){for(var d={},e=0;e<b.length;e++)if("!"!==b[e][0]&&(a.Pb?a.Pb.T:a.L.find(b[e]).T())){var f=wc(a.X,{tag:"button",id:b[e].replace(/:/g,"-"),W:c});d[b[e]]=f}return d}function Hc(a){var b=0,c;for(c in a)a.hasOwnProperty(c)&&(b=Math.max(b,a[c].qa()));return b};var Ic={"vpl:then":function(a,b,c,d){b=Math.min(d.width,d.height);a.strokeStyle=c.Rf;a.lineWidth=.2*b;a.beginPath();a.moveTo(-.25*b,-.5*b);a.lineTo(.25*b,0);a.lineTo(-.25*b,.5*b);a.stroke()},"vpl:error":function(a,b,c,d){b=Math.min(d.width,d.height);a.fillStyle="white";a.strokeStyle=c.Bf;a.lineWidth=.07*b;a.beginPath();a.arc(0,0,.5*b,0,2*Math.PI);a.fill();a.stroke();a.fillStyle=c.Bf;a.font="bold "+Math.round(.75*b).toString()+"px sans-serif";a.textAlign="center";a.textBaseline="middle";a.fillText("?",
0,.05*b)},"vpl:warning":function(a,b,c,d){b=Math.min(d.width,d.height);a.fillStyle="white";a.strokeStyle=c.bg;a.lineWidth=.07*b;a.beginPath();a.arc(0,0,.5*b,0,2*Math.PI);a.fill();a.stroke();a.fillStyle=c.bg;a.font="bold "+Math.round(.75*b).toString()+"px sans-serif";a.textAlign="center";a.textBaseline="middle";a.fillText("!",0,.05*b)},"vpl:moreHigh":function(a,b,c,d){b=Math.min(d.width,d.height);a.beginPath();a.moveTo(-.2*b,.1*b);a.lineTo(0,-.1*b);a.lineTo(.2*b,.1*b);a.lineWidth=.1*b;a.strokeStyle=
"black";a.shadowColor="white";a.shadowBlur=.2*b;a.stroke()},"vpl:moreLow":function(a,b,c,d){b=Math.min(d.width,d.height);a.beginPath();a.moveTo(-.2*b,-.1*b);a.lineTo(0,.1*b);a.lineTo(.2*b,-.1*b);a.lineWidth=.1*b;a.strokeStyle="black";a.shadowColor="white";a.shadowBlur=.2*b;a.stroke()},"vpl:customize":function(a,b,c,d){b=Math.min(d.width,d.height)/2;a.fillStyle=c.Rf;zc(a,0,0,b)}};function Lb(){this.m=new Jc;this.b=new Jc;this.b.R=!0;this.h=new Jc}function Kc(a,b){return function(){a.o!==b&&(a.o=b,Mb(a))}}function Lc(a){return function(b){a.o!==b&&(a.o=b,Mb(a))}}
function Mc(a,b,c,d,e,f,g,h){function k(v){return"a"===v||"c"===v}var l=a.i,w=Math.min(d.width,d.height),n=w/b.v.j;f=new Nc(c,d.width,d.height,f,g,function(v,m,r,u,p){var t=v.J;t.save();var q=v.v;v.v=Rb(w,v.v.c*n);tc(d,t,m.x+r,m.y+u);var z=c.V,C=m.data,y=m.x+r,A=m.y+u;v.J.save();v.J.translate(y,A);z.H(v,C,d,p);v.J.restore();c.locked&&Oc(v,m.x+r,m.y+u,w,w,!0);(c.disabled||h.disabled)&&Dc(v,m.x+r,m.y+u,w,w,e,e,!c.disabled&&!h.ah);v.v=q;t.restore()},h&&h.nf||c.disabled||c.locked||c.Ab&&c.Ab.locked||
!c.V.aa?h&&h.aa?{aa:h.aa}:null:{aa:c.V.aa,Ra:c.V.Ra},h&&h.mf?null:function(v,m){v.data.Ab&&(l.Bb(),Ca(v.data.Ab,m.data,v.data.ke,function(){l.Bb()}));b.pa&&b.pa()},h&&h.mf?null:function(v,m){return m.data instanceof ua&&(k(v.data.V.type)===k(m.data.V.type)||"c"===m.data.V.type)&&v.data!==m.data});if(!(h&&h.nf||!c.V.aa)){if(l.R||c.V.Yd)f.w=function(v){return mc(b,v)};if(l.M||c.V.Yd)f.M=function(v){return mc(b,v)}}f.Oa=!(h&&h.lf);f.m=!(h&&h.Ie);f.R=Kc(a,c.V.name);Pc(b,f,Qc(b,c));return f}
function Rc(a,b,c,d,e,f){var g=new ua(c,null,null);c.gb&&(g.g=c.gb());var h=a.i,k=0>("b"===h.mode?h.oc:h.nc).indexOf(c.name);a=Mc(a,b,g,d,["block","library"],e,f,{nf:!0,mf:!0,Ie:a.fa||a.readOnly,disabled:k||a.readOnly,ah:k,aa:!a.ia.xb||a.fa||h.readOnly?null:function(){var l="b"===h.mode?h.oc:h.nc;0<=l.indexOf(c.name)?l.splice(l.indexOf(c.name),1):l.push(c.name);return 1}});c.gb&&(a.za=function(l){l=l.clone();l.data=new ua(c,null,null);return l})}
function Sc(a,b,c){var d=[],e=0;d=a.U.map(function(h,k){var l=a.error&&a.error.h&&(0===a.error.m.length||0<=a.error.m.indexOf(k))?a.error.Kb?c.rd:c.qd:c.Ea;l.width=null==h?qc(1===d.length?c.Ue:c.Te):qc(Tc(h,0===k,c));e+=qc(l);return c.Ea.width});if(0===a.U.length||!b&&null!==a.U[a.U.length-1])c.Ea.width=qc(0===a.U.length?c.Ue:c.Te),d.push(c.Ea.width),e+=qc(c.Ea);b=qc(c.Db);var f=[],g=0;f=a.actions.map(function(h,k){var l=a.error&&!a.error.h&&(0===a.error.b.length||0<=a.error.b.indexOf(k))?a.error.Kb?
c.rd:c.qd:c.Ea;l.width=null==h?qc(1===f.length?c.Se:c.Re):qc(Tc(h,0===k,c));g+=qc(l);return qc(l)});if(0===a.actions.length||null!==a.actions[a.actions.length-1])c.Ea.width=qc(0===a.actions.length?c.Se:c.Re),f.push(c.Ea.width),g+=qc(c.Ea);return{total:e+b+g,U:d,Xf:e,Ah:b,actions:f,mh:g}}function Tc(a,b,c){switch(a.V.type){case "e":return b?c.xc:c.lc;case "a":return c.Gc;case "s":return c.Yg;case "c":return c.Vg;default:throw"internal";}}
function Uc(a,b){switch(a.verticalAlign){case "middle":return(b.height-a.qa())/2;case "bottom":return b.height-a.qa();case "top":return 0;default:return b.height-a.qa()-a.verticalAlign}}
function Vc(a,b,c,d,e,f,g,h,k){var l=f,w=Sc(c,d,k),n=a.i,v=0<c.U.length&&"e"===c.U[0].V.type?k.xc:k.lc,m=new Nc(c,Wc(k.Ja),Xc(k.Ja),l-k.Ja.paddingLeft-k.Ea.offsetLeft()-v.offsetLeft(),h-k.Ja.paddingTop-k.Ea.offsetTop()-v.offsetTop(),function(t,q,z,C){var y=t.J;tc(k.Ja,y,q.x+z,q.y+C,!0);tc(k.Db,y,g-k.Db.width-k.Db.marginRight-k.Db.paddingRight-k.Ea.offsetLeft()-k.Gc.offsetLeft()+z,q.y+(Xc(k.Ja)-k.Db.height)/2+C);Yc(t,"vpl:then",g-qc(k.Db)/2-k.Ea.offsetLeft()-k.Gc.offsetLeft()+z,q.y+Xc(k.Ja)/2+C,k.Db);
c.locked&&Oc(t,q.x,q.y,q.width,q.height,!1,c.disabled?"#ddd":"");var A=q.x+z+k.Ja.paddingLeft;0<e&&(A+=e-w.Xf);u.forEach(function(K,I){var M=c.error&&c.error.h&&(0===c.error.m.length||0<=c.error.m.indexOf(I))?c.error.Kb?k.rd:k.qd:k.Ea;M.width=null==K?qc(1===u.length?k.Ue:k.Te):qc(Tc(K,0===I,k));tc(M,y,A+M.marginLeft,q.y+C+k.Ja.paddingTop+k.Ea.marginTop,!0);A+=qc(M)});A=q.x+z+k.Ja.paddingLeft+g-f;p.forEach(function(K,I){var M=c.error&&!c.error.h&&(0===c.error.b.length||0<=c.error.b.indexOf(I))?c.error.Kb?
k.rd:k.qd:k.Ea;M.width=null==K?qc(1===p.length?k.Se:k.Re):qc(Tc(K,0===I,k));tc(M,y,A+M.marginLeft,q.y+C+k.Ja.paddingTop+k.Ea.marginTop,!0);A+=qc(M)})},null,function(t,q){if(q.data instanceof Ba){t=n.i.indexOf(t.data);var z=n.i.indexOf(q.data);0<=t&&0<=z&&(n.Bb(),n.i.splice(z,1),n.i.splice(t,0,q.data))}else q.data instanceof ua&&(n.Bb(),Ca(t.data,q.data,null,function(){n.Bb()}));b.pa&&b.pa()},function(t,q){return q.data instanceof Ba?q.data!==t.data:q.data.Ab!==t.data&&("a"===n.mode||0===t.data.U.length||
q.data instanceof ua&&"a"===q.data.V.type)});c.disabled&&(m.h=function(t,q,z,C){Dc(b,q.x+z,q.y+C,q.width,q.height,["rule"],["rule"])});if(a.i.fa||a.i.readOnly)m.m=!1;Pc(b,m);var r,u=c.U;if(0===u.length||!d&&null!==u[u.length-1])u=u.concat(null);l=f;0<e&&(l+=e-w.Xf);u.forEach(function(t,q){var z=t?Tc(t,0===q,k):1===u.length?k.Ue:k.Te,C=c.error&&c.error.h&&(0===c.error.m.length||0<=c.error.m.indexOf(q))?c.error.Kb?k.rd:k.qd:k.Ea,y=Uc(z,C);t?(C.width=qc(z),r=Mc(this,b,t,z,["block"],l,h+y,{nf:c.disabled||
this.i.fa||this.i.readOnly,lf:c.disabled||this.i.fa||this.i.readOnly,Ie:this.i.fa||this.i.readOnly})):(C.width=qc(z),r=Mc(this,b,new ya("e",c,{Zc:!0,index:q}),z,["block"],l,h+y,{mf:c.disabled||this.readOnly,lf:!0,Ie:!0}));m.ga.push(r);l+=qc(C)},a);var p=c.actions;if(0===p.length||null!==p[p.length-1])p=p.concat(null);l=g;p.forEach(function(t,q){var z=t?Tc(t,0==q,k):1===p.length?k.Se:k.Re,C=c.error&&!c.error.h&&(0===c.error.b.length||0<=c.error.b.indexOf(q))?c.error.Kb?k.rd:k.qd:k.Ea,y=Uc(z,C);t?(C.width=
qc(z),r=Mc(this,b,t,Tc(t,0===q,k),["block"],l,h+y,{nf:c.disabled||this.i.fa||this.i.readOnly,lf:c.disabled||this.i.fa||this.i.readOnly,Ie:this.i.fa||this.i.readOnly})):(C.width=qc(z),r=Mc(this,b,new ya("a",c,{Zc:!1,index:q}),z,["block"],l,h,{mf:n.readOnly,lf:!0,Ie:!0}));m.ga.push(r);l+=qc(C)},a);sc(b,function(){if(null!==c.error){var t=c.error.Kb?k.Rg:k.bf;Yc(b,c.error.Kb?"vpl:warning":"vpl:error",f-k.Ja.paddingLeft-k.Ja.marginLeft-k.Ea.offsetLeft()-v.offsetLeft()-t.width/2-t.marginRight-t.paddingRight,
h+.5*v.height,t)}})}function Zc(a,b,c,d,e,f){var g=f?e.Rg:e.bf;sc(a,function(h){var k=$c(a.X,{tag:"conflict-line",W:[f?"warning":"error"]}),l=b-e.Ja.paddingLeft-e.Ja.marginLeft-e.Ea.offsetLeft()-e.xc.offsetLeft()-g.width/2-g.marginRight-g.paddingRight,w=c+(e.Ea.height+g.height)/2,n=d+(e.Ea.height-g.height)/2;h.beginPath();h.moveTo(l,w);h.lineTo(l,n);k.stroke(h);h.beginPath();h.arc(l,w,k.lineWidth,0,Math.PI);k.stroke(h);h.beginPath();h.arc(l,n,k.lineWidth,-Math.PI,0);k.stroke(h)})}
function ad(a,b){var c={};a=window.matchMedia&&window.matchMedia("(pointer: coarse)").matches?a.i.M:a.i.R;c.Ca=wc(b,{tag:"view",W:["vpl"]});c.Qg=wc(b,{tag:"separator",W:["vpl","top"]});c.Pg=wc(b,{tag:"separator",W:["vpl","bottom"]});c.vc=wc(b,{tag:"toolbar",W:["vpl","top"]});c.Cd=wc(b,{tag:"toolbar",W:["vpl","bottom"]});c.Ka=wc(b,{tag:"vpl",id:"scrolling-vpl"});c.xc=wc(b,{tag:"block",W:["event","event-main"],mb:a?["small"]:[]});c.lc=wc(b,{tag:"block",W:["event","event-aux"],mb:a?["small"]:[]});c.Gc=
wc(b,{tag:"block",W:["action"],mb:a?["small"]:[]});c.Yg=wc(b,{tag:"block",W:["state"],mb:a?["small"]:[]});c.Vg=wc(b,{tag:"block",W:["comment"],mb:a?["small"]:[]});c.ph=wc(b,{tag:"block",W:["event","empty"],mb:a?["small"]:[]});c.Re=wc(b,{tag:"block",W:["action","empty"],mb:a?["small"]:[]});c.Ue=wc(b,{tag:"block",W:["event","empty"],mb:a?["only-child","small"]:["only-child"]});c.Te=wc(b,{tag:"block",W:["event","event-aux","empty"],mb:a?["small"]:[]});c.Se=wc(b,{tag:"block",W:["action","empty"],mb:a?
["only-child","small"]:["only-child"]});c.Ea=wc(b,{tag:"block-container"});c.qd=wc(b,{tag:"block-container",W:["error"]});c.rd=wc(b,{tag:"block-container",W:["warning"]});c.Ja=wc(b,{tag:"rule",mb:a?["small"]:[]});c.Db=wc(b,{tag:"widget",id:"widget-then",mb:a?["small"]:[]});c.ye=wc(b,{tag:"block",W:["library","event"]});c.Zd=wc(b,{tag:"block",W:["library","action"]});c.Zg=wc(b,{tag:"block",W:["library","state"]});c.Wg=wc(b,{tag:"block",W:["library","comment"]});c.Pa=wc(b,{tag:"block-library",W:["event"]});
c.Ta=wc(b,{tag:"block-library",W:["action"]});c.bf=wc(b,{tag:"widget",id:"widget-error",mb:a?["small"]:[]});c.Rg=wc(b,{tag:"widget",id:"widget-warning",mb:a?["small"]:[]});return c}function dc(a){var b=a.ia,c=a.i;c.$b(c.Cb);a.ic="";a.Ud=!1;if(!b.xb)for(b=0;b<c.i.length;b++)if(c.i[b].error)if(c.i[b].error.Kb)a.ic||(a.ic=c.i[b].error.w,a.Ud=!0);else{a.ic=c.i[b].error.w;a.Ud=!1;break}}function bd(a,b,c,d,e,f){var g=new nc(a.da);Ec(g,a,b,c,a.i.gc||vc,a.i.Ne||Bc);pc(g,d,f,e);return g}
function Mb(a){function b(J,B){switch(B.type){case "e":return J.ye;case "a":return J.Zd;case "s":return J.Zg;case "c":return J.Wg;default:throw"internal";}}var c=a.ia,d=a.da,e=a.i,f=ad(a,d.X);cd(d);dc(a);e.R=d.v.j<d.v.ug;e.M=d.v.j<d.v.vg;var g=dd(d),h=d.state.oh,k=Fc(a,a.M),l=ab(e),w=0,n=0;e.i.forEach(function(J){J=Sc(J,l,f);w=Math.max(w,J.Xf);n=Math.max(n,J.mh)});var v=0,m=0;Za.forEach(function(J){if(c.xb||0<=("b"===e.mode?e.oc:e.nc).indexOf(J.name))switch(J.type){case "e":case "s":v++;break;case "a":case "c":m++}},
a);ed(d,function(J,B,T){if(a.L.kb("vpl:trashcan",B)){J=C-f.Ja.offsetLeft()-f.Ea.offsetLeft()-f.xc.offsetLeft();var P=qc(f.Ja);if(T<J||T>J+P)return a.L.lb("vpl:trashcan",B),!0}return!1});var r=Gc(a,a.ga,["vpl","top"]),u=Hc(r),p=Gc(a,a.M,["vpl","bottom"]),t=Hc(r);f.Ca.tc(g.width);f.Ca.ec(g.height);f.Ca.setPosition(0,0);f.vc.tc(f.Ca.width);f.vc.height=u;f.vc.setPosition(f.Ca.x,f.Ca.y);f.Pa.ec(f.Ca.height-f.vc.qa());var q=Math.max(Math.floor(f.Pa.height/f.ye.qa()),1);u=f.Pa.scroll?1:Math.ceil(v/q);f.Pa.width=
u*qc(f.ye);f.Pa.setPosition(f.Ca.x,f.Ca.y+f.vc.qa());f.Ta.ec(f.Ca.height-f.vc.qa());var z=f.Ta.scroll?1:Math.ceil(m/q);f.Ta.width=z*qc(f.Zd);f.Ta.setPosition(f.Ca.x+f.Ca.width-qc(f.Ta),f.Ca.y+f.vc.qa());f.Cd.tc(f.Ca.width-qc(f.Pa)-qc(f.Ta));f.Cd.height=t;f.Cd.setPosition(f.Ca.x+qc(f.Pa),f.Ca.y+f.Ca.height-f.Cd.qa());f.Ka.tc(f.Ca.width-qc(f.Pa)-qc(f.Ta));f.Ka.ec(f.Ca.height-f.vc.qa()-(k?f.Cd.qa():0));f.Ka.setPosition(f.Ca.x+qc(f.Pa),f.Ca.y+f.vc.qa());f.Ea.width=f.qd.width=f.rd.width=qc(f.xc);f.Ea.height=
f.qd.height=f.rd.height=f.xc.qa();t=qc(f.Db);q=w+n+t;var C=f.Ca.x+(f.Ca.width-q+qc(f.bf))/2,y=C+w+t;f.Ja.width=q;f.Ja.height=f.Ea.qa();d.$a=[];sc(d,function(J){f.Ca.H(J)});rc(bd(a,a.ga,["vpl","top"],f.vc,f.Qg,r),f.vc,r,Lc(a));0<k&&rc(bd(a,a.M,["vpl","bottom"],f.Cd,f.Pg,p),f.Cd,p,Lc(a));var A=f.ye.qa(),K=f.Zd.qa(),I=0,M=0;if(f.Pa.scroll){I=qc(f.ye);h.b.ec(v*A);f.Pa.width=I;f.Pa.height=f.Pa.height;h.b.resize(f.Pa.x,f.Pa.y,f.Pa.width,f.Pa.height);sc(d,function(J){f.Pa.H(J)});h.b.Hd(d);var N=0;Za.forEach(function(J){if(("e"===
J.type||"s"===J.type)&&(c.xb||0<=("b"===e.mode?e.oc:e.nc).indexOf(J.name))){var B=b(f,J);Rc(this,d,J,B,f.Pa.x+B.offsetLeft(),f.Pa.y+B.offsetTop()+N*A);N++}},a);h.b.end();sc(d,function(){var J=wc(d.X,{tag:"widget",id:"widget-moreHigh"}),B=wc(d.X,{tag:"widget",id:"widget-moreLow"});fd(h.b)||Yc(d,"vpl:moreHigh",f.Pa.x+f.Pa.width/2,f.Pa.y+J.qa()/2,J);gd(h.b)||Yc(d,"vpl:moreLow",f.Pa.x+f.Pa.width/2,f.Pa.y+f.Pa.height-B.qa()/2,B)})}else{sc(d,function(J){f.Pa.H(J)});I=u*A+hd(f.Pa);var S=Math.ceil(v/u);N=
0;Za.forEach(function(J){if(("e"===J.type||"s"===J.type)&&(c.xb||0<=("b"===e.mode?e.oc:e.nc).indexOf(J.name))){var B=b(f,J),T=f.Pa.x+B.offsetLeft()+Math.floor(N/S)*A,P=f.Pa.y+B.offsetTop()+N%S*A;Rc(a,d,J,B,T,P);N++}},a)}f.Ta.scroll?(M=qc(f.Zd),h.h.ec(m*K),f.Ta.width=M,f.Ta.height=f.Ta.height,h.h.resize(f.Ta.x,f.Ta.y,f.Ta.width,f.Ta.height),sc(d,function(J){f.Ta.H(J)}),h.h.Hd(d),N=0,Za.forEach(function(J){if(("a"===J.type||"c"===J.type)&&(c.xb||0<=("b"===e.mode?e.oc:e.nc).indexOf(J.name))){var B=b(f,
J);Rc(this,d,J,B,f.Ta.x+f.Zd.offsetLeft(),f.Ta.y+f.Zd.offsetTop()+N*K);N++}},a),h.h.end(),sc(d,function(){var J=wc(d.X,{tag:"widget",id:"widget-moreHigh"}),B=wc(d.X,{tag:"widget",id:"widget-moreLow"});fd(h.h)||Yc(d,"vpl:moreHigh",f.Ta.x+f.Ta.width/2,f.Ta.y+J.qa()/2,J);gd(h.h)||Yc(d,"vpl:moreLow",f.Ta.x+f.Ta.width/2,f.Ta.y+f.Ta.height-B.qa()/2,B)})):(sc(d,function(J){f.Ta.H(J)}),M=z*K+hd(f.Ta),S=Math.ceil(m/z),N=0,Za.forEach(function(J){if(("a"===J.type||"c"===J.type)&&(c.xb||0<=("b"===e.mode?e.oc:
e.nc).indexOf(J.name))){var B=b(f,J),T=f.Ta.x+B.offsetLeft()+f.Ta.width-(z-Math.floor(N/S))*K,P=f.Ta.y+B.offsetTop()+N%S*K;Rc(a,d,J,B,T,P);N++}},a));if(c.xb){(function(){var J=f.Ea.ob();J.width=qc(f.xc);var B=f.Ea.ob();B.width=qc(f.lc);var T=f.Ea.ob();T.width=qc(f.Gc);var P=qc(J)+qc(B)+qc(f.Db)+qc(T),Y=f.Ja.ob();Y.width=P;var x=f.Ca.x+(f.Ca.width-P)/2+(I-M)/2-d.v.Sc/2,R=x+P-qc(T);P=f.Ka.y+Y.offsetTop()+J.offsetTop();var H=!1;P=new Nc(a,Wc(Y),Xc(Y),x-Y.paddingLeft-J.offsetLeft(),P-Y.paddingTop-J.offsetTop(),
function(D,E,G,Z){var O=D.J;tc(Y,O,E.x+G,E.y+Z,!0);tc(f.Db,O,R-f.Db.width-f.Db.marginRight-f.Db.paddingRight-f.Ea.offsetLeft()-f.Gc.offsetLeft()+G,E.y+(Xc(f.Ja)-f.Db.height)/2+Z);Yc(D,"vpl:then",R-qc(f.Db)/2-f.Ea.offsetLeft()-f.Gc.offsetLeft()+G,E.y+Xc(f.Ja)/2+Z,f.Db);var ka=E.x+G+Y.paddingLeft;tc(J,O,ka+J.marginLeft,E.y+Z+Y.paddingTop+J.marginTop,!0);tc(f.xc,O,ka+J.offsetLeft()+f.xc.marginLeft,E.y+Z+Y.paddingTop+J.offsetTop()+f.xc.marginTop+Uc(f.xc,J),!0);ka+=qc(J);tc(B,O,ka+B.marginLeft,E.y+Z+Y.paddingTop+
B.marginTop,!0);tc(f.lc,O,ka+J.offsetLeft()+f.lc.marginLeft,E.y+Z+Y.paddingTop+B.offsetTop()+f.lc.marginTop+Uc(f.lc,B),!0);!("a"===a.i.mode?a.i.b:a.i.h)^H&&Dc(D,ka+J.offsetLeft()+f.lc.marginLeft,E.y+Z+Y.paddingTop+B.offsetTop()+f.lc.marginTop+Uc(f.lc,B),f.lc.width,f.lc.height,["block"],["block"],!1);ka=E.x+G+f.Ja.paddingLeft+R-x;tc(T,O,ka+T.marginLeft,E.y+Z+Y.paddingTop+T.marginTop,!0);tc(f.Gc,O,ka+T.offsetLeft()+f.Gc.marginLeft,E.y+Z+Y.paddingTop+T.offsetTop()+f.Gc.marginTop+Uc(f.Gc,T),!0)},{aa:function(D){H=
!0;Sb(D);return 0},Ra:function(D,E,G,Z,O,ka,la,X){G=D.b.getBoundingClientRect();E=X.x-G.left;X=X.y-G.top;H=E>=ka&&E<ka+Z&&X>=la&&X<la+O;Sb(D)},kf:function(D){H&&("a"===a.i.mode?a.i.b=!a.i.b:a.i.h=!a.i.h);Sb(D)}},null,null);P.m=!1;Pc(d,P)})();var aa=wc(d.X,{tag:"widget",id:"vpl-customize"});aa.width=f.Ka.width/2;aa.height=(f.Ka.height-f.Ja.qa())/2;sc(d,function(){Yc(d,"vpl:customize",f.Ka.x+f.Ka.width/2,f.Ka.y+(f.Ka.height+f.Ja.qa())/2,aa)})}else if(e.message)sc(d,function(J){var B=e.message.split("\n"),
T=Math.min(14,g.height/B.length);J.font=T+"px sans-serif";J.textAlign="start";J.textBaseline="top";var P=f.Ka.x+T,Y=f.Ka.y+T;B.forEach(function(x,R){J.fillText(x,P,Y+1.2*T*R)})});else{k=qc(f.Ja)+f.Ka.paddingLeft+f.Ka.paddingRight+qc(f.bf);h.m.tc(k);h.m.ec(e.i.length*f.Ja.qa());h.m.resize(f.Ka.x,f.Ka.y,f.Ka.width,f.Ka.height);sc(d,function(J){f.Ka.H(J)});h.m.Hd(d);C+=(I-M)/2-d.v.Sc/2;y+=(I-M)/2-d.v.Sc/2;k>f.Ka.width&&(C+=(k-f.Ka.width)/2+f.Ka.paddingLeft+f.Ka.marginLeft,y+=(k-f.Ka.width)/2+f.Ka.paddingLeft+
f.Ka.marginLeft);var ha="";e.i.forEach(function(J,B){Vc(this,d,J,l,d.v.qg?w:0,C,y,f.Ka.y+f.Ja.qa()*B+f.Ja.offsetTop()+f.Ea.offsetTop(),f);if(null!==J.error&&""===ha&&(ha=J.error.w,null!==J.error.o))for(var T=B+1;T<e.i.length;T++)if(e.i[T]===J.error.o){Zc(d,C,f.Ka.y+f.Ja.qa()*B+f.Ja.offsetTop()+f.Ea.offsetTop(),f.Ka.y+f.Ja.qa()*T+f.Ja.offsetTop()+f.Ea.offsetTop(),f,J.error.Kb);break}},a);h.m.end();e.fa&&sc(d,function(){Dc(d,f.Ka.x,f.Ka.y,f.Ka.width,f.Ka.height,["vpl"],["vpl"])})}a.o&&sc(d,function(J){var B=
wc(d.X,{tag:"hint"});J.fillStyle=B.color;J.font=xc(B);J.textAlign="start";J.textBaseline="middle";var T=a.h.translate(a.o);B.width=J.measureText(T).width;B.height=1.2*B.fontSize;tc(B,J,B.marginLeft,g.height-B.qa()+B.marginTop,!0);J.fillText(T,B.offsetLeft(),g.height-B.qa()+B.offsetTop()+B.height/2)});sc(d,function(J){J.font="9px sans-serif";J.textAlign="start";J.textBaseline="bottom";J.rotate(-Math.PI/2);J.fillText("EPFL 2018-2020",-g.height+d.v.ja,g.width-d.v.ja)});e.pa&&e.pa();Sb(d)};function id(){this.Oa={};this.m=[];this.ga={px:1,cm:96/2.54,mm:96/25.4,"in":96,pc:16,pt:96/72};this.M={rad:1,deg:Math.PI/180,grad:Math.PI/200,turn:2*Math.PI};this.b=null}
function jd(a,b,c){function d(){return b+" line "+w+" col "+n}function e(){for(;l<c.length;)if(" "===c[l]||"\t"===c[l])l++,n++;else if("\n"===c[l])l++,n=1,w++;else if("\r"===c[l])l++;else if("/*"===c.slice(l,l+2))for(l+=2,n+=2;l<c.length;)if("*/"===c.slice(l,l+2)){l+=2;n+=2;break}else l++,n++;else break}function f(){"\n"===c[l]?(n=1,w++):"\r"!==c[l]&&n++;l++}function g(){for(var p=0;l+p<c.length&&/[-_a-z0-9]/i.test(c[l+p]);)p++;l+=p;n+=p;return c.slice(l-p,l)}function h(){var p=new kd;if(!/[a-z_.#*:]/i.test(c[l]))throw"Syntax error "+
d();for(/[a-z_]/i.test(c[l])?p.tag=g():"*"===c[l]&&f();;)if("#"===c[l]){if(p.id)throw"Multiple ids in selector "+d();f();p.id=g()}else if("."===c[l])f(),p.W.push(g());else if(":"===c[l])f(),p.mb.push(g());else break;return p}function k(){for(var p=0;l+p<c.length&&";"!==c[l+p]&&"}"!==c[l+p];)"\n"===c[l]?(w++,n=1):"\r"!==c[l]&&n++,p++;l+=p;return c.slice(l-p,l).trim()}a.Oa[b]=c;for(var l=0,w=1,n=1;l<c.length;){e();if(l>=c.length)break;for(var v=[];;){v.push(h());e();if(","!==c[l])break;l++;n++;e()}if("{"!==
c[l])throw"Syntax error "+d();l++;n++;for(var m={};;){for(;;){e();if(";"!==c[l])break;l++}if(l>=c.length)throw"Unclosed block "+d();if("}"===c[l]){l++;n++;break}else if(!/[a-z_]/i.test(c[l]))throw"Syntax error "+d();var r=g();e();if(":"!==c[l])throw"Missing colon "+d();l++;n++;var u=k();m[r]=a.za(r,u)}for(r=0;r<v.length;r++)a.m.push({Uf:v[r],Rc:m})}}id.prototype.za=function(a,b){return b};
function ld(a,b){if(/^(max|min)\(.*\)$/.test(b))return a=b.slice(4,-1).split(",").map(function(e){return ld(this,e)},a),new md(b.slice(0,3),a);b=/^(-?([0-9]+\.?|[0-9]*\.[0-9]+))([a-z]*|%)$/.exec(b);var c=1,d=nd;if(null==b)throw"Illegal length";if("%"===b[3])d=od;else if(a.ga.hasOwnProperty(b[3]))c=a.ga[b[3]];else if("vw"===b[3])d=rd;else if("vh"===b[3])d=sd;else if("vmin"===b[3])d=td;else if("vmax"===b[3])d=ud;else if("ww"===b[3])d=vd;else if("wh"===b[3])d=wd;else if("wmin"===b[3])d=xd;else if("wmax"===
b[3])d=yd;else if(0==parseFloat(b[1]))c=0;else throw"Unknown length unit";return new zd(parseFloat(b[1])*c,d)}
var Ad={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgreen:"#006400",
darkgrey:"#A9A9A9",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",
ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",green:"#008000",greenyellow:"#ADFF2F",grey:"#808080",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgreen:"#90EE90",lightgrey:"#D3D3D3",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",
lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",
moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",
seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32",transparent:"rgba(0,0,0,0)"};function zd(a,b){this.S=a;this.type=b?b:nd}
var nd="abs",od="%",rd="vw",sd="vh",td="vmin",ud="vmax",vd="ww",wd="wh",xd="wmin",yd="wmax";
zd.prototype.N=function(a){switch(this.type){case nd:return this.S;case od:return this.S*(a?a.w/100:1);case rd:return this.S*(a?a.h:1);case sd:return this.S*(a?a.b:1);case td:return this.S*(a?Math.min(a.h,a.b):1);case ud:return this.S*(a?Math.max(a.h,a.b):1);case vd:return this.S*(a?a.o:1);case wd:return this.S*(a?a.m:1);case xd:return this.S*(a?Math.min(a.o,a.m):1);case yd:return this.S*(a?Math.max(a.o,a.m):1);default:throw"internal";}};function md(a,b){zd.call(this,0);this.Ba=a;this.values=b}
md.prototype=Object.create(zd.prototype);md.prototype.constructor=md;md.prototype.N=function(a){switch(this.Ba){case "max":return this.values.reduce(function(b,c){return Math.max(b,c.N(a))},-Infinity);case "min":return this.values.reduce(function(b,c){return Math.min(b,c.N(a))},Infinity);default:throw"internal";}};function Bd(a,b,c,d,e){this.w=a;this.h=b;this.b=c;this.o=d;this.m=e}function kd(){this.id=this.tag=null;this.W=[];this.mb=[]}
function Cd(a,b){a=a.id?"#"+a.id:(a.tag||"")+(a.W&&0<a.W.length?"."+a.W.join("."):"")+(a.mb&&0<a.mb.length?":"+a.mb.join("."):"")||"*";b&&(a+="/"+Math.round(b.w).toString(10)+","+Math.round(b.h).toString(10)+","+Math.round(b.b).toString(10)+","+Math.round(b.o).toString(10)+","+Math.round(b.m).toString(10));return a}
kd.prototype.match=function(a){if(a.tag&&this.tag&&a.tag!==this.tag||this.id&&this.id!==a.id)return!1;for(var b=0;b<this.W.length;b++)if(void 0==a.W||0>a.W.indexOf(this.W[b]))return!1;for(b=0;b<this.mb.length;b++)if(void 0==a.mb||0>a.mb.indexOf(this.mb[b]))return!1;return!0};function Jb(){id.call(this);this.h=[];this.o={};this.w={};this.R="none hidden dotted dashed solid double".split(" ");this.hb=["normal","italic","oblique"];this.qb=["normal","bold"]}Jb.prototype=Object.create(id.prototype);Jb.prototype.constructor=Jb;Jb.prototype.defineProperties=function(){for(var a=0;a<this.m.length;a++){var b=new Dd;Ed(b,this.m[a].Rc);this.h.push({Uf:this.m[a].Uf,Hg:b})}};
Jb.prototype.za=function(a,b){function c(v){try{ld(e,v)}catch(m){return!1}return!0}function d(v){return Ad.hasOwnProperty(v)||/^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(v)||/^rgba\([^()]*\)$/.test(v)}var e=this;b=b.replace(/\s+(?=[^()]*\))/g,"");switch(a){case "margin-left":case "margin-right":case "margin-top":case "margin-bottom":case "padding-left":case "padding-right":case "padding-top":case "padding-bottom":case "border-left-width":case "border-right-width":case "border-top-width":case "border-bottom-width":case "line-width":case "width":case "height":case "min-width":case "min-height":case "max-width":case "max-height":case "font-size":return ld(this,
b);case "margin":case "padding":case "border-width":switch(a=b.replace(/ +/g," ").split(" ").map(function(v){return ld(e,v)}),a.length){case 1:return[a[0],a[0],a[0],a[0]];case 2:return[a[0],a[1],a[0],a[1]];case 3:return[a[0],a[1],a[2],a[1]];case 4:return a;default:throw"Wrong number of lengths";}case "border-style":case "border-left-style":case "border-right-style":case "border-top-style":case "border-bottom-style":case "line-style":if(!(0<=e.R.indexOf(b)))throw"Unknown border style";return b;case "line-cap":if(!(0<=
["butt","round","square"].indexOf(b)))throw"Unknown line cap";return b;case "border-color":case "border-left-color":case "border-right-color":case "border-top-color":case "border-bottom-color":case "color":case "background-color":case "background":case "border-cut-background":if(!d(b))throw"Unknown border color";return b;case "border-left":case "border-right":case "border-top":case "border-bottom":case "border":case "line":var f=null,g=null,h=null;b.replace(/ +/g," ").split(" ").forEach(function(v){if(d(v))f=
v;else if(0<=e.R.indexOf(v))g=v;else if(c(v))h=ld(e,v);else throw"Illegal border property";});return{color:f,style:null===g&&(f||h)?"solid":g,width:null===h&&(f||g)?new zd(1):h};case "border-top-left-radius":case "border-top-right-radius":case "border-bottom-right-radius":case "border-bottom-left-radius":case "border-top-left-cut":case "border-top-right-cut":case "border-bottom-left-cut":case "border-bottom-right-cut":switch(a=b.replace(/ +/g," ").split(" ").map(function(v){return ld(e,v)}),a.length){case 1:return[a[0],
a[0]];case 2:return a;default:throw"Wrong number of radii";}case "border-radius":case "border-cut":switch(a=b.split("/").map(function(v){v=v.replace(/ +/g," ").split(" ").map(function(m){return"/"===m?"/":ld(e,m)});switch(v.length){case 1:return[v[0],v[0],v[0],v[0]];case 2:return[v[0],v[1],v[0],v[1]];case 3:return[v[0],v[1],v[2],v[1]];case 4:return v;default:throw"Wrong number of radii";}}),a.length){case 1:return a[0].concat(a[0]);case 2:return a[0].concat(a[1]);default:throw"Wrong number of radius dimensions";
}case "font":var k="",l="",w=null,n="";b.replace(/ +/g," ").split(" ").forEach(function(v){if(null===w)if(c(v))w=ld(e,v);else if(0<=e.hb.indexOf(v))k=v;else if(0<=e.qb.indexOf(v))l=v;else throw"Unknown font style "+v;else{if(""!==n)throw"Unexpected font style after font-family";n=v}});return{fontFamily:n,fontSize:w,fontStyle:k,fontWeight:l};case "box-shadow":case "line-shadow":return b=b.split(",")[0],a=b.replace(/ +/g," ").split(" "),"inset"===a[0]&&(a=a.slice(1)),3<=a.length&&5>=a.length?{offset:[ld(this,
a[0]),ld(this,a[1])],color:a[a.length-1],Ve:4<=a.length?ld(this,a[2]):null,rf:5<=a.length?ld(this,a[3]):null}:{};case "overflow":if(0>["wrap","scroll"].indexOf(b))throw"Unknown overflow mode";return b;case "vertical-align":return 0<=["top","middle","bottom"].indexOf(b)?b:ld(this,b);default:return b}};
function Fd(a,b){for(var c=null,d=0;d<a.h.length;d++)if(a.h[d].Uf.match(b)){if(c){var e=void 0;var f=a.h[d].Hg;c=c.ob();for(e in f.Rc)f.Rc.hasOwnProperty(e)&&(c.Rc[e]=f.Rc[e]);e=c}else e=a.h[d].Hg.ob();c=e}for(var g in c)c.hasOwnProperty(g)&&c[g]instanceof zd&&(c[g]=c[g].N(a.b));return c}function wc(a,b){var c=Cd(b,a.b);if(a.o[c])return a.o[c];b=Fd(a,b);b=new Gd(b,a.b);return a.o[c]=b}function $c(a,b){var c=Cd(b,a.b);if(a.w[c])return a.w[c];b=Fd(a,b);b=new Hd(b,a.b);return a.w[c]=b}
function Dd(){this.Rc={}}function Ed(a,b){for(var c in b)b.hasOwnProperty(c)&&(a.Rc[c]=b[c])}Dd.prototype.ob=function(){var a=new Dd;Ed(a,this.Rc);return a};
function Gd(a,b){this.marginBottom=this.marginTop=this.marginRight=this.marginLeft=this.y=this.x=this.height=this.width=0;this.sb=!0;this.cc=!1;this.borderBottomWidth=this.borderTopWidth=this.borderRightWidth=this.borderLeftWidth=0;this.borderBottomStyle=this.borderTopStyle=this.borderRightStyle=this.borderLeftStyle="none";this.borderBottomColor=this.borderTopColor=this.borderRightColor=this.borderLeftColor="black";this.borderTopLeftRadius=[0,0];this.borderTopRightRadius=[0,0];this.borderBottomRightRadius=
[0,0];this.borderBottomLeftRadius=[0,0];this.ze=this.ae=this.Be=this.Ae=!1;this.paddingBottom=this.paddingTop=this.paddingRight=this.paddingLeft=0;this.backgroundColor=this.ve="transparent";this.color="black";this.fontFamily="sans-serif";this.fontSize=10;this.fontWeight=this.fontStyle="";this.scroll=!1;this.verticalAlign="middle";this.Nb=null;this.Sd=this.ed=0;this.shadowColor=null;a&&Id(this,a.Rc,b)}Gd.prototype=Object.create(Dd.prototype);Q=Gd.prototype;Q.constructor=Gd;
function Id(a,b,c){var d=-1,e=-1,f=-1,g=-1,h=1E9,k=1E9,l;for(l in b)switch(l){case "margin-left":a.marginLeft=b[l].N(c);break;case "margin-right":a.marginRight=b[l].N(c);break;case "margin-top":a.marginTop=b[l].N(c);break;case "margin-bottom":a.marginBottom=b[l].N(c);break;case "border-left-width":a.borderLeftWidth=b[l].N(c);a.sb=!1;break;case "border-right-width":a.borderRightWidth=b[l].N(c);a.sb=!1;break;case "border-top-width":a.borderTopWidth=b[l].N(c);a.sb=!1;break;case "border-bottom-width":a.borderBottomWidth=
b[l].N(c);a.sb=!1;break;case "padding-left":a.paddingLeft=b[l].N(c);break;case "padding-right":a.paddingRight=b[l].N(c);break;case "padding-top":a.paddingTop=b[l].N(c);break;case "padding-bottom":a.paddingBottom=b[l].N(c);break;case "margin":a.marginTop=b[l][0].N(c);a.marginRight=b[l][1].N(c);a.marginBottom=b[l][2].N(c);a.marginLeft=b[l][3].N(c);break;case "border-width":a.borderTopWidth=b[l][0].N(c);"none"===a.borderTopStyle&&0<a.borderTopWidth&&(a.borderTopStyle=null);a.borderRightWidth=b[l][1].N(c);
"none"===a.borderRightStyle&&0<a.borderRightWidth&&(a.borderRightStyle=null);a.borderBottomWidth=b[l][2].N(c);"none"===a.borderBottomStyle&&0<a.borderBottomWidth&&(a.borderBottomStyle=null);a.borderLeftWidth=b[l][3].N(c);"none"===a.borderLeftStyle&&0<a.borderLeftWidth&&(a.borderLeftStyle=null);break;case "padding":a.paddingTop=b[l][0].N(c);a.paddingRight=b[l][1].N(c);a.paddingBottom=b[l][2].N(c);a.paddingLeft=b[l][3].N(c);break;case "border-style":a.borderLeftStyle=b[l];a.borderRightStyle=b[l];a.borderTopStyle=
b[l];a.borderBottomStyle=b[l];break;case "border-left-style":a.borderLeftStyle=b[l];a.sb=!1;break;case "border-right-style":a.borderRightStyle=b[l];a.sb=!1;break;case "border-top-style":a.borderTopStyle=b[l];a.sb=!1;break;case "border-bottom-style":a.borderBottomStyle=b[l];a.sb=!1;break;case "border-color":a.borderLeftColor=b[l];a.borderRightColor=b[l];a.borderTopColor=b[l];a.borderBottomColor=b[l];break;case "border-left-color":a.borderLeftColor=b[l];a.sb=!1;break;case "border-right-color":a.borderRightColor=
b[l];a.sb=!1;break;case "border-top-color":a.borderTopColor=b[l];a.sb=!1;break;case "border-bottom-color":a.borderBottomColor=b[l];a.sb=!1;break;case "border-left":null!==b[l].color&&(a.borderLeftColor=b[l].color);null!==b[l].style&&(a.borderLeftStyle=b[l].style);null!==b[l].width&&(a.borderLeftWidth=b[l].width.N(c));a.sb=!1;break;case "border-right":null!==b[l].color&&(a.borderRightColor=b[l].color);null!==b[l].style&&(a.borderRightStyle=b[l].style);null!==b[l].width&&(a.borderRightWidth=b[l].width.N(c));
a.sb=!1;break;case "border-top":null!==b[l].color&&(a.borderTopColor=b[l].color);null!==b[l].style&&(a.borderTopStyle=b[l].style);null!==b[l].width&&(a.borderTopWidth=b[l].width.N(c));a.sb=!1;break;case "border-bottom":null!==b[l].color&&(a.borderBottomColor=b[l].color);null!==b[l].style&&(a.borderBottomStyle=b[l].style);null!==b[l].width&&(a.borderBottomWidth=b[l].width.N(c));a.sb=!1;break;case "border":null!==b[l].color&&(a.borderLeftColor=a.borderRightColor=a.borderTopColor=a.borderBottomColor=
b[l].color);null!==b[l].style&&(a.borderLeftStyle=a.borderRightStyle=a.borderTopStyle=a.borderBottomStyle=b[l].style);null!==b[l].width&&(a.borderLeftWidth=a.borderRightWidth=a.borderTopWidth=a.borderBottomWidth=b[l].width.N(c));a.sb=!0;break;case "border-top-left-radius":a.borderTopLeftRadius=b[l].map(function(w){return w.N(c)});a.cc=!0;break;case "border-top-right-radius":a.borderTopRightRadius=b[l].map(function(w){return w.N(c)});a.cc=!0;break;case "border-bottom-right-radius":a.borderBottomRightRadius=
b[l].map(function(w){return w.N(c)});a.cc=!0;break;case "border-bottom-left-radius":a.borderBottomLeftRadius=b[l].map(function(w){return w.N(c)});a.cc=!0;break;case "border-radius":a.borderTopLeftRadius=[b[l][0].N(c),b[l][4].N(c)];a.borderTopRightRadius=[b[l][1].N(c),b[l][5].N(c)];a.borderBottomRightRadius=[b[l][2].N(c),b[l][6].N(c)];a.borderBottomLeftRadius=[b[l][3].N(c),b[l][7].N(c)];a.cc=!0;break;case "border-top-left-cut":a.borderTopLeftRadius=b[l].map(function(w){return w.N(c)});a.Ae=!0;a.cc=
!0;break;case "border-top-right-cut":a.borderTopRightRadius=b[l].map(function(w){return w.N(c)});a.Be=!0;a.cc=!0;break;case "border-bottom-left-cut":a.ae=b[l].map(function(w){return w.N(c)});a.ae=!0;a.cc=!0;break;case "border-bottom-right-cut":a.borderBottomRightRadius=b[l].map(function(w){return w.N(c)});a.ze=!0;a.cc=!0;break;case "border-cut":a.borderTopLeftRadius=[b[l][0].N(c),b[l][4].N(c)];a.borderTopRightRadius=[b[l][1].N(c),b[l][5].N(c)];a.borderBottomRightRadius=[b[l][2].N(c),b[l][6].N(c)];
a.borderBottomLeftRadius=[b[l][3].N(c),b[l][7].N(c)];a.Ae=!0;a.Be=!0;a.ae=!0;a.ze=!0;a.cc=!0;break;case "backdrop-color":a.ve=b[l];break;case "background-color":case "background":a.backgroundColor=b[l];break;case "color":a.color=b[l];break;case "font":a.fontFamily=b[l].fontFamily;a.fontSize=b[l].fontSize.N(c);a.fontStyle=b[l].fontStyle;a.fontWeight=b[l].fontWeight;break;case "font-family":a.fontFamily=b[l];break;case "font-size":a.fontSize=b[l].N(c);break;case "font-style":a.fontStyle=b[l];break;
case "font-weight":a.fontWeight=b[l];break;case "overflow":a.scroll="scroll"===b[l];break;case "vertical-align":a.verticalAlign=b[l]instanceof zd?b[l].N(c):b[l];break;case "box-shadow":null!==b[l].Nb&&(a.Nb=b[l].offset.map(function(w){return w?w.N(c):0}),a.ed=b[l].Ve?b[l].Ve.N(c):0,a.Sd=b[l].rf?b[l].rf.N(c):0,a.shadowColor=b[l].color);break;case "width":d=b[l].N(c);break;case "min-width":f=b[l].N(c);break;case "max-width":h=b[l].N(c);break;case "height":e=b[l].N(c);break;case "min-height":g=b[l].N(c);
break;case "max-height":k=b[l].N(c)}d=Math.max(Math.min(d,h),f);e=Math.max(Math.min(e,k),g);0<=d&&(a.width=d);0<=e&&(a.height=e)}Q.setPosition=function(a,b){this.x=a+this.offsetLeft();this.y=b+this.offsetTop()};function qc(a){return a.width+hd(a)}Q.qa=function(){return this.height+(this.marginTop+this.borderTopWidth+this.paddingTop+this.paddingBottom+this.borderBottomWidth+this.marginBottom)};
Q.tc=function(a){this.width=a-(this.marginLeft+this.borderLeftWidth+this.paddingLeft+this.paddingRight+this.borderRightWidth+this.marginRight)};Q.ec=function(a){this.height=a-(this.marginTop+this.borderTopWidth+this.paddingTop+this.paddingBottom+this.borderBottomWidth+this.marginBottom)};
Q.ob=function(){var a=new Gd;a.width=this.width;a.height=this.height;a.x=this.x;a.y=this.y;a.marginLeft=this.marginLeft;a.marginRight=this.marginRight;a.marginTop=this.marginTop;a.marginBottom=this.marginBottom;a.sb=this.sb;a.cc=this.cc;a.borderLeftWidth=this.borderLeftWidth;a.borderRightWidth=this.borderRightWidth;a.borderTopWidth=this.borderTopWidth;a.borderBottomWidth=this.borderBottomWidth;a.borderLeftStyle=this.borderLeftStyle;a.borderRightStyle=this.borderRightStyle;a.borderTopStyle=this.borderTopStyle;
a.borderBottomStyle=this.borderBottomStyle;a.borderLeftColor=this.borderLeftColor;a.borderRightColor=this.borderRightColor;a.borderTopColor=this.borderTopColor;a.borderBottomColor=this.borderBottomColor;a.borderTopLeftRadius=this.borderTopLeftRadius;a.borderTopRightRadius=this.borderTopRightRadius;a.borderBottomRightRadius=this.borderBottomRightRadius;a.borderBottomLeftRadius=this.borderBottomLeftRadius;a.Ae=this.Ae;a.Be=this.Be;a.ae=this.ae;a.ze=this.ze;a.paddingLeft=this.paddingLeft;a.paddingRight=
this.paddingRight;a.paddingTop=this.paddingTop;a.paddingBottom=this.paddingBottom;a.ve=this.ve;a.backgroundColor=this.backgroundColor;a.color=this.color;a.fontFamily=this.fontFamily;a.fontSize=this.fontSize;a.fontStyle=this.fontStyle;a.fontWeight=this.fontWeight;a.scroll=this.scroll;a.verticalAlign=this.verticalAlign;a.Nb=this.Nb;a.ed=this.ed;a.Sd=this.Sd;a.shadowColor=this.shadowColor;return a};Q.offsetLeft=function(){return this.marginLeft+this.borderLeftWidth+this.paddingLeft};
function hd(a){return a.marginLeft+a.borderLeftWidth+a.paddingLeft+a.paddingRight+a.borderRightWidth+a.marginRight}Q.offsetTop=function(){return this.marginTop+this.borderTopWidth+this.paddingTop};function Wc(a){return a.width+a.paddingLeft+a.paddingRight}function Xc(a){return a.height+a.paddingTop+a.paddingBottom}function xc(a){return(a.fontStyle?a.fontStyle+" ":"")+(a.fontWeight?a.fontWeight+" ":"")+a.fontSize.toFixed(1)+"px "+a.fontFamily}
function Hd(a,b){this.margin=0;this.ce=this.style=this.width=null;this.color="black";this.Nb=null;this.Sd=this.ed=0;this.shadowColor=null;this.Of={};a&&Jd(this,a.Rc,b);null===this.width&&(this.width=null!==this.style&&"none"!==this.style?1:0);null===this.style&&(this.style=0<this.width?"solid":"none");null===this.ce&&(this.ce="butt")}Hd.prototype=Object.create(Dd.prototype);Hd.prototype.constructor=Hd;
function Jd(a,b,c){for(var d in b)switch(d){case "margin":a.margin=b[d].N(c);break;case "line-width":a.width=b[d].N(c);break;case "line-style":a.style=b[d];break;case "line-cap":a.ce=b[d];break;case "color":a.color=b[d];break;case "line":null!==b[d].color&&(a.color=b[d].color);null!==b[d].style&&(a.style=b[d].style);null!==b[d].width&&(a.width=b[d].width.N(c));break;case "line-shadow":null!==b[d].Nb&&(a.Nb=b[d].offset.map(function(e){return e?e.N(c):0}),a.ed=b[d].Ve?b[d].Ve.N(c):0,a.Sd=b[d].rf?b[d].rf.N(c):
0,a.shadowColor=b[d].color);break;default:b.hasOwnProperty(d)&&(a.Of[d]=b[d])}}Hd.prototype.ob=function(){var a=new Hd;a.margin=this.margin;a.width=this.width;a.style=this.style;a.ce=this.ce;a.color=this.color;a.Nb=this.Nb;a.ed=this.ed;a.Sd=this.Sd;a.shadowColor=this.shadowColor;return a};var Kd=!1;function Ld(a,b,c,d){a.strokeStyle=c||"black";switch(d){case "dotted":a.setLineDash([2*b,3*b]);a.lineDashOffset=0;break;case "dashed":a.setLineDash([3*b,3*b]),a.lineDashOffset=0}a.lineWidth=b||0}
function tc(a,b,c,d,e){function f(){var l=Math.min(g.borderTopLeftRadius[0],h/2),w=Math.min(g.borderTopLeftRadius[1],k/2);b.moveTo(c,d+w);g.Ae?b.lineTo(c+l,d):b.bezierCurveTo(c,d+w/2,c+l/2,d,c+l,d);l=Math.min(g.borderTopRightRadius[0],h/2);w=Math.min(g.borderTopRightRadius[1],k/2);b.lineTo(c+h-l,d);g.Be?b.lineTo(c+h,d+w):b.bezierCurveTo(c+h-l/2,d,c+h,d+w/2,c+h,d+w);l=Math.min(g.borderBottomRightRadius[0],h/2);w=Math.min(g.borderBottomRightRadius[1],k/2);b.lineTo(c+h,d+k-w);g.ze?b.lineTo(c+h-l,d+k):
b.bezierCurveTo(c+h,d+k-w/2,c+h-l/2,d+k,c+h-l,d+k);l=Math.min(g.borderBottomLeftRadius[0],h/2);w=Math.min(g.borderBottomLeftRadius[1],k/2);b.lineTo(c+l,d+k);g.ae?b.lineTo(c,d+k-w):b.bezierCurveTo(c+l/2,d+k,c,d+k-w/2,c,d+k-w);b.closePath()}e||(c-=a.paddingLeft,d-=a.paddingTop);var g=a,h=a.width+a.paddingLeft+a.paddingRight,k=a.height+a.paddingTop+a.paddingBottom;Kd&&(b.save(),b.strokeStyle="black",b.lineWidth=1,b.strokeRect(c,d,h,k),b.strokeRect(c+a.paddingLeft,d+a.paddingTop,a.width,a.height),b.strokeRect(c-
a.marginLeft,d-a.marginTop,h+a.marginLeft+a.marginRight,k+a.marginTop+a.marginBottom),b.restore());b.save();"transparent"!==a.ve&&(b.fillStyle=a.ve,b.fillRect(c,d,h,k));b.beginPath();a.cc?(b.beginPath(),f()):b.rect(c,d,h,k);b.save();a.Nb&&(b.shadowOffsetX=a.Nb[0],b.shadowOffsetY=a.Nb[1],b.shadowColor=a.shadowColor,b.shadowBlur=a.ed);a.backgroundColor?b.fillStyle=a.backgroundColor:a.Nb&&(b.fillStyle="transparent");b.fill();b.restore();a.sb?0<a.borderLeftWidth&&a.borderLeftColor&&"none"!==a.borderLeftStyle&&
"hidden"!==a.borderLeftStyle&&(Ld(b,a.borderLeftWidth,a.borderLeftColor,a.borderLeftStyle),"double"===a.borderLeftStyle&&(b.save(),b.translate(c+h/2,d+k/2),b.scale((h-3*a.borderLeftWidth)/h,(k-3*a.borderLeftWidth)/k),b.translate(-c-h/2,-d-k/2),f(),b.restore()),b.stroke()):(0<a.borderLeftWidth&&a.borderLeftColor&&"none"!==a.borderLeftStyle&&"hidden"!==a.borderLeftStyle&&(Ld(b,a.borderLeftWidth,a.borderLeftColor,a.borderLeftStyle),b.beginPath(),b.moveTo(c,d),b.lineTo(c,d+k),b.stroke()),0<a.borderRightWidth&&
a.borderRightColor&&"none"!==a.borderRightStyle&&"hidden"!==a.borderRightStyle&&(Ld(b,a.borderRightWidth,a.borderRightColor,a.borderRightStyle),b.beginPath(),b.moveTo(c+h,d),b.lineTo(c+h,d+k),b.stroke()),0<a.borderTopWidth&&a.borderTopColor&&"none"!==a.borderTopStyle&&"hidden"!==a.borderTopStyle&&(Ld(b,a.borderTopWidth,a.borderTopColor,a.borderTopStyle),b.beginPath(),b.moveTo(c,d),b.lineTo(c+h,d),b.stroke()),0<a.borderBottomWidth&&a.borderBottomColor&&"none"!==a.borderBottomStyle&&"hidden"!==a.borderBottomStyle&&
(Ld(b,a.borderBottomWidth,a.borderBottomColor,a.borderBottomStyle),b.beginPath(),b.moveTo(c,d+k),b.lineTo(c+h,d+k),b.stroke()));b.restore()}Gd.prototype.H=function(a){tc(this,a,this.x,this.y)};Hd.prototype.stroke=function(a){a.save();this.Nb&&(a.shadowOffsetX=this.Nb[0],a.shadowOffsetY=this.Nb[1],a.shadowColor=this.shadowColor,a.shadowBlur=this.ed);0<this.width&&this.color&&"none"!==this.style&&"hidden"!==this.style&&(Ld(a,this.width,this.color,this.style),a.lineCap=this.ce,a.stroke());a.restore()};function Nc(a,b,c,d,e,f,g,h,k,l){this.data=a;this.width=b;this.height=c;this.x=d;this.y=e;this.b=null;this.ga=[];this.o=f;this.h=null;this.m=this.Oa=!0;this.za=null;this.Nc=g||null;this.lb=h||null;this.kb=k||null;this.Af=this.hb=!1;this.R=this.doScroll=null;this.id=l||"";this.ee=this.pa=this.M=this.w=null}Nc.prototype.clone=function(){var a=new Nc(this.data,this.width,this.height,this.x,this.y,this.o,this.Nc,this.lb,this.kb,this.id);a.h=this.h;return a};
Nc.prototype.H=function(a,b,c,d,e){var f=a.J,g=this.b&&void 0===b;g&&(f.save(),f.beginPath(),f.rect(this.b.x,this.b.y,this.b.Vc,this.b.Lc),f.clip(),b=this.b.cg,c=this.b.dg);d?this.h&&this.h(a,this,b||0,c||0,e):this.o&&this.o(a,this,b||0,c||0,e);g&&f.restore()};Nc.prototype.toDataURL=function(a,b,c){var d=document.createElement("canvas");b=b||1;d.width=b*this.width;d.height=b*this.height;b=new Kb(d,{Ag:b});b.v=a;this.H(b);this.H(b,0,0,!0);return d.toDataURL(c||"image/png")};
function Md(a){return a.b?{Hb:a.b.cg,Ib:a.b.dg}:{Hb:0,Ib:0}}
function Kb(a,b){function c(f){function g(r){var u=e.b.getBoundingClientRect(),p=Md(r);r.ee=r.Nc.aa(e,r.data,r.width,r.height,u.left+r.x+p.Hb,u.top+r.y+p.Ib,h);return null!==r.ee?(r.Nc.Ra&&r.Nc.Ra(e,r.data,r.ee,r.width,r.height,u.left+r.x+p.Hb,u.top+r.y+p.Ib,h),e.pa&&e.pa(),e.pb?e.pb():Sb(e),Nd=r.Nc.Ra?function(t,q){q?r.Nc.kf&&(r.Nc.kf(e,r.data,r.ee),e.pa&&e.pa(),e.pb?e.pb():Sb(e)):(r.Nc.Ra(e,r.data,r.ee,r.width,r.height,u.left+r.x+p.Hb,u.top+r.y+p.Ib,Od(e,t,d)),e.pa&&e.pa(),e.pb?e.pb():Sb(e))}:null,
e.pa&&e.pa(),e.pb?e.pb():Sb(e),!0):!1}if(e.R){var h=Od(e,f,d);if(Pd(e,h)){var k=e.wb;k.Nc&&g(k)}else if(e.wb)e.w=-1,e.wb=null,e.pa&&e.pa(),e.pb?e.pb():Sb(e);else{var l=Qd(e,h,!0);if(0<l.length){if(k=e.$a[l[0]],0<=e.w&&e.w!==l[0]&&(e.w=-1,e.wb=null),e.qb=Date.now(),(!k.Nc||(f instanceof MouseEvent?k.w:k.M)&&e.w!==l[0]||!g(k))&&k.m){var w=k.za?k.za(k):k,n=null;f=Md(w);var v=h.x-f.Hb,m=h.y-f.Ib;Nd=function(r,u,p){var t=Od(e,r,d);if(u){if((p?k.M:k.w)&&k===e.$a[Qd(e,t,!1)[0]])e.w=l[0],e.wb=(p?k.M:k.w)(k,
p);else if(n&&n.lb&&(!n.kb||n.kb(n,w)))n.lb(n,w);else if(null==n||null==n.lb||n.kb&&!n.kb(n,w))for(u=0;u<e.za.length&&!e.za[u].lb(n,w,t.x,t.y);u++);Sb(e);e.b.style.cursor="default"}else{p=Qd(e,t,!1);n=null;r=!1;for(u=0;!r&&u<p.length;u++)n=e.$a[p[u]],r=n.lb&&(!n.kb||n.kb(n,w));r&&null!=n?(n.Af=!0,Sb(e),n.Af=!1):Sb(e);u=e.J;r&&!n.hb&&(p=Md(n),Rd(e,n.x+p.Hb,n.y+p.Ib,n.width,n.height,["drop-target"]));u.save();Sd(e);e.transform&&(u.translate(e.width/2,e.height/2),CanvasRenderingContext2D.prototype.transform.apply(u,
e.transform),u.translate(-e.width/2,-e.height/2));u.translate(e.m*e.va.Z,e.h*e.va.$);u.globalAlpha=.5;w.H(e,t.x-v,t.y-m);w.ga.forEach(function(q){q.H(e,t.x-v,t.y-m);q.H(e,t.x-v,t.y-m,!0)});w.H(e,t.x-v,t.y-m,!0);u.restore();e.b.style.cursor=r?"copy":"default"}}}}else 0<=e.w&&(e.w=-1,e.wb=null,Sb(e))}}}var d=b&&b.Ag||("devicePixelRatio"in window?window.devicePixelRatio:1);this.b=a;this.m=a.width/d;this.h=a.height/d;this.va=b&&b.va||{Z:0,ra:1,$:0,na:1};this.width=this.m*(this.va.ra-this.va.Z);this.height=
this.h*(this.va.na-this.va.$);this.R=!0;this.transform=this.hb=null;this.J=this.b.getContext("2d");this.Oa=this.state=null;this.za=[];this.qb=0;this.w=-1;this.wb=null;this.o={};this.clientData={};this.X=b&&b.X||new Jb;this.v=null;this.resize(this.width,this.height,b&&b.Ag);this.ga={};var e=this;a.addEventListener("mousedown",c,!1);a.addEventListener("touchstart",function(f){var g=f.targetTouches;1===g.length&&(f.preventDefault(),c(g[0]),Td=g[0])},!1);a.addEventListener("wheel",function(f){function g(l){l.doScroll&&
(f.preventDefault(),l.doScroll(0===f.deltaMode?f.deltaX:1===f.deltaMode?10*f.deltaX:30*f.deltaX,0===f.deltaMode?f.deltaY:1===f.deltaMode?10*f.deltaY:30*f.deltaY))}if(e.R){var h=Od(e,f,d);if(Pd(e,h))e.wb&&g(e.wb);else if(0>e.w){h=Qd(e,h,!0);for(var k=0;k<h.length;k++)if(null!=e.$a[h[k]].doScroll){g(e.$a[h[k]]);break}}}},!1);a.addEventListener("mousemove",function(f){if(e.R){var g=Od(e,f,d);g=Qd(e,g,!0);for(var h=0;h<g.length;h++)if(null!=e.$a[g[h]].R){f.preventDefault();e.$a[g[h]].R();return}e.Oa&&
e.Oa()}},!1);this.$a=[];this.M=[];this.pb=this.pa=null}function Zb(a,b){a.va=b||{Z:0,ra:1,$:0,na:1};a.width=a.m*(a.va.ra-a.va.Z);a.height=a.h*(a.va.na-a.va.$)}function ed(a,b){for(var c=0;c<a.za.length;c++)if("delete"===a.za[c].tag){a.za[c].lb=b;return}a.za.push({tag:"delete",lb:b})}Kb.prototype.show=function(){this.R=!0};Kb.prototype.Cc=function(){this.R=!1};function Ud(a,b){a.b.style.filter=b}function Vd(a,b){a.hb=b&&b.slice();a.transform=a.hb}
function Od(a,b,c){var d=a.b.getBoundingClientRect();b={x:b.clientX*a.b.width/c/d.width,y:b.clientY*a.b.height/c/d.height,gh:b.altKey};c=[b.x,b.y];c=[c[0]-a.m*a.va.Z,c[1]-a.h*a.va.$];if(d=a.transform){var e=a.width/2;a=a.height/2;d=d.slice(0,4).concat(d[4]-e*d[0]-a*d[2]+e,d[5]-e*d[1]-a*d[3]+a);a=d[0]*d[3]-d[1]*d[2];a=[(d[3]*c[0]-d[2]*c[1]+d[2]*d[5]-d[3]*d[4])/a,(-d[1]*c[0]+d[0]*c[1]+d[1]*d[4]-d[0]*d[5])/a]}else a=c;b.x=a[0];b.y=a[1];return b}function Wd(a){a.pa&&a.pa();a.pb?a.pb():Sb(a)}
function Rb(a,b){return{j:a,ug:60,vg:120,qg:!1,ja:Math.max(1,Math.min(3,Math.round(a/40))),yf:Math.round(a/4).toString(10)+"px sans-serif",sh:"navy",th:"#37f",rh:"#06f",c:b,ta:Math.max(1,Math.min(3,b/30)),$g:"bold 15px sans-serif",Tf:"navy",Sf:"#ccc",Sc:5,Bf:"#e44",bg:"#f88",Rf:"#bbb"}}
function cd(a,b){a.width=a.m*(a.va.ra-a.va.Z);a.height=a.h*(a.va.na-a.va.$);a.J=a.b.getContext("2d");b=b||("devicePixelRatio"in window?window.devicePixelRatio:1);1!=b&&(a.J.resetTransform(),a.J.scale(b,b));a.X.b=new Bd(a.width,a.width/100,a.height/100,a.m/100,a.h/100);b=wc(a.X,{tag:"block"}).width;var c=wc(a.X,{tag:"button"}).width;a.v=Rb(b,c)}
Kb.prototype.resize=function(a,b,c){var d=c||("devicePixelRatio"in window?window.devicePixelRatio:1);this.b.width=a*d;this.b.height=b*d;this.m=a;this.h=b;cd(this,c)};function Qc(a,b){for(var c=0;c<a.$a.length;c++)if(a.$a[c].data===b)return c;return-1}
function Qd(a,b,c){var d=a.b.getBoundingClientRect(),e=b.x-d.left;b=b.y-d.top;d=[];for(var f=a.$a.length-1;0<=f;f--){var g=Md(a.$a[f]);if(g=(!c||a.$a[f].Oa)&&e>=a.$a[f].x+g.Hb&&e<=a.$a[f].x+g.Hb+a.$a[f].width&&b>=a.$a[f].y+g.Ib&&b<=a.$a[f].y+g.Ib+a.$a[f].height)g=a.$a[f],g=!g.b||e>=g.b.x&&e<g.b.x+g.b.Vc&&b>=g.b.y&&b<g.b.y+g.b.Lc;g&&d.push(f)}return d}
function mc(a,b){var c=b.clone();a=dd(a);var d=Math.min(a.width,a.height)/1.5/c.width;c.width*=d;c.height*=d;c.x=(a.width-c.width)/2;c.y=(a.height-c.height)/2;c.w=null;c.M=null;c.o=function(e,f){var g=e.J;g.save();g.translate(f.x,f.y);g.scale(d,d);g.translate(-f.x,-f.y);b.o(e,c,f.x-c.x,f.y-c.y,!0);g.restore()};b.h&&(c.h=function(e,f){var g=e.J;g.save();g.translate(f.x,f.y);g.scale(d,d);g.translate(-f.x,-f.y);b.h(e,c,f.x-c.x,f.y-c.y,!0);g.restore()});return c}
function Pd(a,b){if(null==a.wb)return!1;var c=a.b.getBoundingClientRect(),d=b.x-c.left;b=b.y-c.top;return d>=a.wb.x&&d<=a.wb.x+a.wb.width&&b>=a.wb.y&&b<=a.wb.y+a.wb.height}function dd(a){return{width:a.width,height:a.height}}function Sd(a){a.J.beginPath();a.J.rect(a.m*a.va.Z,a.h*a.va.$,a.m*(a.va.ra-a.va.Z),a.h*(a.va.na-a.va.$));a.J.clip()}
function Xd(a,b,c,d,e,f,g){f=f||0;g=g||0;if(0<a.M.length){var h=a.M[a.M.length-1];h.x>b&&(d-=h.x-b,b=h.x);h.x+h.Vc<b+d&&(d=h.x+h.Vc-b);h.y>c&&(e-=h.y-c,c=h.y);h.y+h.Lc<c+e&&(e=h.y+h.Lc-c);f+=h.cg;g+=h.dg}a.M.push({x:b,y:c,Vc:d,Lc:e,cg:f,dg:g})}function Pc(a,b,c){0<a.M.length&&(b.b=a.M[a.M.length-1]);0<=c?a.$a[c]=b:a.$a.push(b)}function sc(a,b){var c=new Nc(null,-1,-1,0,0,function(d,e,f,g){d=d.J;d.save();d.translate(e.x+f,e.y+g);b(d);d.restore()});Pc(a,c);return c}
function uc(a,b,c,d,e,f,g,h,k,l){var w,n=new Nc(null,d.width,d.height,b,c,function(v,m,r,u){v=v.J;v.save();tc(d,v,m.x+r,m.y+u);v.translate(m.x+r,m.y+u);e(v,d,a.o.id===l&&a.o.ud||m.Af);v.restore()},f?{aa:function(v,m,r,u,p,t,q){a.o={id:l,rect:{x:n.x,y:n.y,Vc:r,Lc:u},ud:!0};w=q;Sb(a);return 0},Ra:function(v,m,r,u,p,t,q,z){r=v.b.getBoundingClientRect();m=z.x-r.left;z=z.y-r.top;a.o.ud=m>=a.o.rect.x&&m<a.o.rect.x+a.o.rect.Vc&&z>=a.o.rect.y&&z<a.o.rect.y+a.o.rect.Lc;Sb(v)},kf:function(){a.o.ud&&f(w);a.o=
{};Sb(a)}}:null,g,h,l);n.R=k||null;n.m=!1;n.hb=!0;Pc(a,n);return n}function Yc(a,b,c,d,e){tc(e,a.J,c-e.width/2,d-e.height/2);var f=a.ga[b];void 0!=f&&(a.J.save(),a.J.translate(c,d),f(a.J,b,a.v,e),a.J.restore())}
function Sb(a){a.R&&(a.J.clearRect(a.m*a.va.Z,a.h*a.va.$,a.m*(a.va.ra-a.va.Z),a.h*(a.va.na-a.va.$)),a.J.save(),a.transform&&(a.J.translate(a.width/2,a.height/2),CanvasRenderingContext2D.prototype.transform.apply(a.J,a.transform),a.J.translate(-a.width/2,-a.height/2)),a.J.translate(a.m*a.va.Z,a.h*a.va.$),a.$a.forEach(function(b){b.H(this)},a),a.$a.forEach(function(b){b.H(this,void 0,void 0,!0)},a),a.wb&&(a.J.save(),a.J.globalAlpha=.5,a.J.fillStyle="black",a.J.fillRect(a.m*a.va.Z,a.h*a.va.$,a.m*(a.va.ra-
a.va.Z),a.h*(a.va.na-a.va.$)),a.J.restore(),a.wb.H(a),a.wb.H(a,0,0,!0)),a.J.restore())};function Jc(){this.w=this.M=1;this.b=this.h=this.y=this.x=0;this.R=!1;this.za="";this.Wd=this.m=this.Vd=this.o=0;this.ga=null}Q=Jc.prototype;Q.tc=function(a){this.M=a;this.o=Math.max(0,Math.min(this.o,this.M-this.h))};Q.ec=function(a){this.w=a;this.m=Math.max(0,Math.min(this.m,this.w-this.b))};Q.resize=function(a,b,c,d){this.x=a;this.y=b;this.h=c;this.b=d;this.o=Math.max(0,Math.min(this.o,this.M-this.h));this.m=Math.max(0,Math.min(this.m,this.w-this.b))};
Q.Hd=function(a){this.ga=a;var b=this,c=new Nc(null,this.h,this.b,this.x,this.y,null,this.M>this.h||this.w>this.b?{aa:function(d,e,f,g,h,k,l){b.Vd=l.x;b.Wd=l.y;return 0},Ra:function(d,e,f,g,h,k,l,w){d=Math.max(Math.min(w.x-b.Vd,b.o),b.o-b.M+b.h);b.o-=d;b.Vd+=d;w=Math.max(Math.min(w.y-b.Wd,b.m),b.m-b.w+b.b);b.m-=w;b.Wd+=w}}:null,null,null);c.m=!1;c.doScroll=function(d,e){b.o+=d;b.m+=e;a.pa()};Pc(a,c);this.za&&sc(a,function(d){d.save();d.fillStyle=b.za;d.fillRect(b.x,b.y,b.h,b.b);d.restore()});(this.M>
this.h||this.w>this.b)&&sc(a,function(d){d.save();if(b.M>b.h){var e=b.h/b.M;e=Math.max(e*b.h,Math.min(20,b.h));var f=b.h-e,g=b.o/(b.M-b.h);f*=g;d.fillStyle=a.v.Sf;d.fillRect(b.x,b.y+b.b+2,b.h,a.v.Sc);d.fillStyle=a.v.Tf;d.fillRect(b.x+f,b.y+b.b+2,e,a.v.Sc)}b.w>b.b&&(e=b.b/b.w,e=Math.max(e*b.b,Math.min(20,b.b)),f=b.b-e,g=b.m/(b.w-b.b),f*=g,d.save(),d.fillStyle=a.v.Sf,d.fillRect(b.R?b.x-2-a.v.Sc:b.x+b.h+2,b.y,a.v.Sc,b.b),d.fillStyle=a.v.Tf,d.fillRect(b.R?b.x-2-a.v.Sc:b.x+b.h+2,b.y+f,a.v.Sc,e));d.restore()});
Xd(a,this.x,this.y,this.h,this.b,-this.o,-this.m)};Q.end=function(){this.ga.M.pop()};function fd(a){return a.m<=.001*a.b}function gd(a){return a.m>=a.w-1.001*a.b};function Rd(a,b,c,d,e,f){f=wc(a.X,{tag:"overlay-rectangle",W:f||[]});f.x=b;f.y=c;f.width=d;f.height=e;f.H(a.J)}
function Dc(a,b,c,d,e,f,g,h){Rd(a,b,c,d,e,(f||[]).concat("disabled"));wc(a.X,{tag:"overlay-rectangle",W:f||[]});if(!h){a.J.save();f=$c(a.X,{tag:"crossout-line",W:g||[]});a.J.beginPath();h=a.X;g=/^(-?([0-9]+\.?|[0-9]*\.[0-9]+))([a-z]*)$/.exec(f.Of["line-angle"]||"0");if(null==g)throw"Illegal angle";if(h.M.hasOwnProperty(g[3]))h=h.M[g[3]];else if(0==parseFloat(g[1]))h=0;else throw"Unknown angle unit";g=parseFloat(g[1])*h;h=ld(a.X,f.Of["line-overflow"]||"0").N(a.X.b);if(Math.abs(g%Math.PI)<.25*Math.PI||
Math.abs((Math.PI-g)%Math.PI)<.25*Math.PI){h=(d/2+h)*Math.sign(Math.cos(g));var k=e/2*Math.sin(g)*Math.sqrt(2)}else k=(e/2+h)*Math.sign(Math.sin(g)),h=d/2*Math.cos(g)*Math.sqrt(2);a.J.moveTo(b+d/2-h,c+e/2-k);a.J.lineTo(b+d/2+h,c+e/2+k);f.stroke(a.J);a.J.restore()}}
function yc(a,b,c,d,e,f){a.save();a.strokeStyle=e;a.fillStyle=e;a.lineWidth=d;a.fillRect(b-2.5*d,c-d,5*d,4*d);a.beginPath();a.moveTo(b-1.7*d,c);a.lineTo(b-1.7*d,c);f?(a.arc(b-3.4*d,c-2*d,1.7*d,0,Math.PI,!0),a.lineTo(b-5.1*d,c)):(a.arc(b,c-2*d,1.7*d,-Math.PI,0),a.lineTo(b+1.7*d,c));a.stroke();a.restore()}function Oc(a,b,c,d,e,f,g){var h=.03*a.v.j;yc(a.J,b+d+(f?-5:5)*h,c+.15*e,h,g||"#333")}
function Ac(a,b,c,d,e,f,g){a.save();g&&(g.style&&(a.strokeStyle=g.style,a.fillStyle=g.style),void 0!==g.lineWidth&&(a.lineWidth=g.lineWidth),void 0!==g.alpha&&(a.globalAlpha=g.alpha));var h=g&&void 0!==g.Xc?g.Xc:5*a.lineWidth;a.beginPath();var k=e+(g&&g.Fd?h/d:0),l=f-(g&&g.Fd?0:h/d);a.arc(b,c,d,k,l);a.stroke();g&&g.Fd?(a.translate(b+d*Math.cos(e),c+d*Math.sin(e)),a.rotate((e+k)/2+Math.PI)):(a.translate(b+d*Math.cos(f),c+d*Math.sin(f)),a.rotate((f+l)/2));a.beginPath();a.moveTo(0,0);a.lineTo(h/2,1.2*
-h);a.lineTo(-h/2,1.2*-h);a.fill();a.restore()}Kb.prototype.text=function(a,b){var c=this.J,d=this.v;c.save();c.fillStyle=b&&b.fillStyle||"white";c.font=d.yf;c.textAlign="center";c.textBaseline="middle";c.translate(.5*d.j+(b&&b.x||0),.5*d.j-(b&&b.y||0));b&&b.ih&&c.rotate(-b.ih);c.translate(-.5*d.j,-.5*d.j);c.fillText(a,.5*d.j,.5*d.j);c.restore()};
function Yd(a,b){var c=a.J,d=a.v;c.save();c.beginPath();c.rect(0,0,a.v.j,a.v.j);c.clip();b&&(b.scale||b.rotation)&&(b.sf&&c.translate(-b.sf[0],-b.sf[1]),c.translate(.5*d.j,.5*d.j),b.scale&&c.scale(b.scale,b.scale),b.rotation&&c.rotate(-b.rotation),c.translate(-.5*d.j,-.5*d.j));c.beginPath();c.moveTo(.5*d.j,d.j-d.ja);b&&"left"===b.Le||(c.lineTo(d.j-d.ja,d.j-d.ja),c.lineTo(d.j-d.ja,.25*d.j),c.bezierCurveTo(.8*d.j,d.ja,.52*d.j,d.ja,.5*d.j,d.ja));b&&"right"===b.Le||(c.lineTo(.5*d.j,d.ja),c.bezierCurveTo(.48*
d.j,d.ja,.2*d.j,d.ja,d.ja,.25*d.j),c.lineTo(d.ja,d.j-d.ja));c.closePath();if(b&&b.Ub){a=[b.Ub[0],Math.max(.2+.8*b.Ub[1],b.Ub[2]/2),b.Ub[2]];var e=Math.max(a[0],Math.max(a[1],a[2]));c.fillStyle="rgb("+a.map(function(f){return Math.round(225*(1-e)+(30+225*e)*f)}).join(",")+")"}else c.fillStyle="white";c.fill();b&&b.Ub&&(c.strokeStyle="white",c.lineWidth=d.ja,c.stroke());b&&b.jc&&(c.fillStyle="black",c.fillRect(0,.6*d.j,.1*d.j,.35*d.j),c.fillRect(.9*d.j,.6*d.j,.1*d.j,.35*d.j));c.restore()}
function Zd(a,b){var c=(b-a)/2,d=b===a?Infinity:(b+a)/(2*c);return{bb:c,vf:d,x:Math.abs(d)>1E3*Math.abs(a+b)?0:d*(.01>c?c*c/2:1-Math.cos(c)),y:Math.abs(d)>1E3*Math.abs(a+b)?(a+b)/2:d*Math.sin(c)}}
function $d(a,b,c,d,e){var f=a.J;a=a.v;d*=a.j;var g=e&&e.r||[-1,0,1],h=e&&e.color||"black";e=e&&void 0!==e.Fe?e.Fe:1;var k=Zd(b,c);f.save();f.translate(.5*a.j,.5*a.j);f.strokeStyle=h;f.lineWidth=a.ja*e;20<Math.abs(k.vf)?(f.beginPath(),g.forEach(function(l){f.moveTo(l*d,0);f.lineTo((k.x+l)*d,-k.y*d)}),f.stroke()):g.forEach(function(l){f.beginPath();var w=-k.vf*d;l=(k.vf+l)*d;var n=k.bb;0<l?f.arc(w,0,l,0,-n,0<n):0>l&&f.arc(w,0,-l,Math.PI,Math.PI-n,0<n);f.stroke()});f.restore();return k}
function ae(a,b,c,d,e,f,g){a=a.v;e*=a.j;f*=a.j;a=.21*a.j;c=g.x-c-b/2;b=d+b/2-g.y;e=Zd(e,f);return(c-e.x)*(c-e.x)+(b-e.y)*(b-e.y)<a*a}
function be(a){var b=a.J;a=a.v;b.save();b.translate(.5*a.j,.5*a.j);b.scale(.7,.7);b.translate(-.5*a.j,-.5*a.j);b.fillStyle="white";b.fillRect(a.ja,.45*a.j,a.j-2*a.ja,.35*a.j);b.fillStyle="black";b.beginPath();b.arc(.27*a.j,.72*a.j,.2*a.j,0,2*Math.PI);b.fill();b.fillStyle="white";b.beginPath();b.arc(.27*a.j,.72*a.j,.12*a.j,0,2*Math.PI);b.fill();b.beginPath();b.arc(.8*a.j,.8*a.j-a.ja,.1*a.j,0,2*Math.PI);b.fill();b.restore()}
function ce(a){var b=a.J;a=a.v;b.save();b.lineWidth=a.ja;b.strokeStyle="white";for(var c=1;3>=c;c++)b.beginPath(),b.arc(.185*a.j,.48*a.j,.05*a.j*c,.9*Math.PI,1.7*Math.PI),b.stroke();b.restore()}
Kb.prototype.buttons=function(a,b,c){var d=this.J,e=this.v;a.forEach(function(f,g){d.save();d.translate(e.j*(.5+f.x),e.j*(.5-f.y));d.rotate(f.r||0);d.fillStyle=f.fillStyle?f.fillStyle:c&&c.Ef&&b?c.Ef[b[g]]:b&&!0===b[g]?"red":b&&1===b[g]?"#f66":b&&-1===b[g]?"#333":"white";d.strokeStyle=f.strokeStyle?f.strokeStyle:c&&c.Vf&&b?c.Vf[b[g]]:!b||1!==b[g]&&!0!==b[g]?b&&0>b[g]?"black":"#aaa":"#700";d.lineWidth=e.ja;d.lineJoin="round";var h=f.size||1;switch(f.D){case "r":d.fillRect(.08*-e.j*h,.08*-e.j*h,.16*
e.j*h,.16*e.j*h);d.strokeRect(.08*-e.j*h,.08*-e.j*h,.16*e.j*h,.16*e.j*h);break;case "t":d.beginPath();d.moveTo(0,-.122*e.j*h);d.lineTo(.106*e.j*h,.062*e.j*h);d.lineTo(-.106*e.j*h,.062*e.j*h);d.closePath();d.fill();d.stroke();break;case "c":d.beginPath(),d.arc(0,0,.112*e.j*h,0,2*Math.PI),d.fill(),d.stroke()}b&&c&&void 0!==c.Id&&c.Id===b[g]&&(d.strokeStyle="white",d.beginPath(),d.moveTo(.06*-e.j*h,.06*-e.j*h),d.lineTo(.06*e.j*h,.06*e.j*h),d.moveTo(.06*-e.j*h,.06*e.j*h),d.lineTo(.06*e.j*h,.06*-e.j*h),
d.stroke());d.restore()})};function de(a,b,c,d,e,f,g,h,k){var l=a.J;a=a.v;l.save();l.strokeStyle="black";l.lineWidth=a.ja*k;k=b.length/2;for(var w=0;w<k;w++)0<b[2*w+1]&&(l.fillStyle=2===b[2*w+1]?"white":"black",l.beginPath(),l.arc(a.j*(c+(d-c)/k*(w+.5)),a.j*(e+(f-e)/g*(b[2*w]+.5)),a.j*h/2,0,2*Math.PI),l.fill(),l.stroke());l.restore()}
function ee(a,b){var c=a.J,d=a.v,e=null===b?-.15*d.j:0;c.save();c.beginPath();c.moveTo(.4*d.j+e,.3*d.j);c.lineTo(.4*d.j+e,.7*d.j);c.lineTo(.7*d.j+e,.7*d.j);c.lineTo(.7*d.j+e,.37*d.j);c.lineTo(.63*d.j+e,.3*d.j);c.closePath();c.lineWidth=d.ja;c.strokeStyle="white";c.lineJoin="round";c.stroke();for(var f=.15;.31>f;f+=.06)c.beginPath(),c.arc(.65*d.j+e,.5*d.j,d.j*f,-.6,.6),c.stroke();null===b?(c.beginPath(),c.moveTo(.12*d.j,.6*d.j),c.lineTo(.88*d.j,.4*d.j),c.lineWidth=1.5*d.ja,c.stroke()):a.text(b.toString(10),
{x:-.3*d.j});c.restore()}function fe(a){var b=a.J;a=a.v;b.beginPath();b.arc(0,0,.4*a.j,0,2*Math.PI,!0);b.moveTo(0,0);b.lineTo(0,.4*-a.j);b.strokeStyle="#666";b.lineWidth=a.ja;b.stroke();b.beginPath();b.arc(0,.4*-a.j,.1*a.j,0,2*Math.PI);b.fillStyle="white";b.fill();b.strokeStyle="black";b.stroke()}
function ge(a,b,c){var d=a.J,e=a.v;c=c*Math.PI/12;d.save();d.translate(.5*e.j,.5*e.j);d.rotate(c);fe(a);d.fillRect(-.28*e.j,-.1*e.j,.56*e.j,.2*e.j);d.fillStyle="black";b?(d.beginPath(),d.arc(-.15*e.j,.03*e.j,.11*e.j,0,2*Math.PI),d.fill(),d.fillStyle="white",d.beginPath(),d.arc(-.15*e.j,.03*e.j,.07*e.j,0,2*Math.PI),d.fill(),d.beginPath(),d.arc(.15*e.j,.07*e.j,.06*e.j,0,2*Math.PI)):(d.fillRect(-.28*e.j,.1*e.j,.08*e.j,.04*e.j),d.fillRect(.2*e.j,.1*e.j,.08*e.j,.04*e.j),d.fillStyle="white",d.beginPath(),
d.arc(0,.06*e.j,.06*e.j,0,2*Math.PI));d.fill();d.restore()}function he(a,b,c,d,e){b=d.x-b-a/2;c=c+a/2-d.y;a=(b*b+c*c)/(a*a/4);return 1>a&&.4<a&&(e||0<=c)}function ie(a,b,c,d,e){a=Math.round(12*Math.atan2(d.x-b-a/2,c+a/2-d.y)/Math.PI);return e?12===a?-12:a:Math.max(-6,Math.min(6,a))}
function je(a,b,c,d,e,f,g,h,k){var l=k?0>=g?0:Math.max(Math.log(10*g)/Math.log(100),0):g/4;a.save();!h&&f&&f(g);a.beginPath();a.arc(b,c,d,0,2*Math.PI);a.fillStyle="white";a.fill();f=.9*d;g=k?.8*d:.6*d;var w=2*Math.PI*(h?.2:l),n=h?"#ddd":"red";k=(g-(k?.5*d:.6*d))/4;a.save();a.beginPath();a.arc(b,c,f,-Math.PI/2,3*Math.PI/2-.05);a.arc(b,c,g-4*k,3*Math.PI/2-.05,Math.PI,!0);a.arc(b+k,c,g-3*k,Math.PI,Math.PI/2,!0);a.arc(b+k,c-k,g-2*k,Math.PI/2,0,!0);a.arc(b,c-k,g-k,0,-Math.PI/2,!0);a.clip();a.fillStyle=
n;a.beginPath();a.arc(b,c,f,-Math.PI/2,-Math.PI/2+w);a.lineTo(b,c);a.fill();a.restore();a.beginPath();a.arc(b,c,d/2,0,2*Math.PI);a.fill();a.beginPath();a.arc(b,c,d,0,2*Math.PI);a.strokeStyle="black";a.lineWidth=e;a.stroke();a.beginPath();a.moveTo(b-.1*d*Math.sin(2*l*Math.PI),c+.1*d*Math.cos(2*l*Math.PI));a.lineTo(b+.9*d*Math.sin(2*l*Math.PI),c-.9*d*Math.cos(2*l*Math.PI));a.lineWidth=2*e;a.stroke();h&&Ac(a,b,c,1.25*d,.5*-Math.PI,.1*-Math.PI,{Fd:!0,Xc:5*e,style:"black"});a.restore()}
function ke(a,b,c,d){var e=a.J,f=a.v.j;je(e,f/2+(c?-.05*f:.05*f),f/2+(c?.07*f:.03*f),.4*f,a.v.ja,function(g){e.textAlign="start";e.textBaseline="top";e.font=Math.round(f/6).toString(10)+"px sans-serif";e.fillStyle="white";e.fillText(g.toFixed(1>g?2:1),f/20,f/40)},b,c,d)}
function le(a,b,c,d,e,f,g,h,k,l){var w=(d+e)/2,n=(e-d)/2;a.save();a.beginPath();a.arc(b,c,d,-g,-f);a.arc(b+w*Math.cos(f),c-w*Math.sin(f),n,-f-Math.PI,-f,!0);a.arc(b,c,e,-f,-g,!0);a.arc(b+w*Math.cos(g),c-w*Math.sin(g),n,-g,-g+Math.PI,!0);a.fillStyle=h;a.strokeStyle=k;a.lineWidth=l;a.fill();a.stroke();a.restore()}function me(a,b,c,d){var e=a.v;le(a.J,e.j/2,e.j/2,.3*e.j,.45*e.j,b,c,0>d?"white":2===d?"red":0<d?"#f70":"#ddd",0===d?"#bbb":"black",e.ja)}
function ne(a,b){var c=a.J;c.save();me(a,.65*Math.PI,.85*Math.PI,b[0]);me(a,.15*Math.PI,.35*Math.PI,b[1]);me(a,1.15*Math.PI,1.35*Math.PI,b[2]);me(a,1.65*Math.PI,1.85*Math.PI,b[3]);c.restore()}function oe(a,b){var c=a.J;c.save();for(var d=0;8>d;d++)me(a,Math.PI*(.46-.25*d),Math.PI*(.54-.25*d),d===b?1:-1);c.restore()}function pe(a,b,c,d,e,f){b=(f.x-d)/b-.5;c=.5-(f.y-e)/c;for(e=0;e<a.length;e++)if(Math.max(Math.abs(b-a[e].x),Math.abs(c-a[e].y))<.11*(a[e].size||1))return e;return null}
function qe(a,b,c,d,e,f){function g(l,w){h.beginPath();h.moveTo(k.j*(.1+.8*l),k.j*(.46-c));h.lineTo(k.j*(.1+.8*w),k.j*(.46-c));h.arc(k.j*(.1+.8*w),k.j*(.5-c),.04*k.j,-Math.PI/2,Math.PI/2);h.lineTo(k.j*(.1+.8*w),k.j*(.54-c));h.lineTo(k.j*(.1+.8*l),k.j*(.54-c));h.arc(k.j*(.1+.8*l),k.j*(.5-c),.04*k.j,Math.PI/2,-Math.PI/2)}var h=a.J,k=a.v;h.save();d&&(h.translate(.5*k.j,.5*k.j),h.rotate(-Math.PI/2),h.scale(1,-1),h.translate(-.5*k.j,-.5*k.j));h.lineWidth=k.ja;h.fillStyle="white";h.strokeStyle="black";
g(0,1);h.fill();h.stroke();h.fillStyle=e;switch(f||0){case 1:g(0,b);h.fill();h.stroke();break;case 2:g(b,1),h.fill(),h.stroke()}h.fillStyle=e;h.strokeStyle="black";h.lineWidth=k.ja;h.beginPath();h.arc(k.j*(.1+.8*b),k.j*(.5-c),.1*k.j,0,2*Math.PI);h.fill();h.stroke();h.restore()}function re(a,b,c,d,e,f,g){c=(g.x-e)/c-.5;d=.5-(g.y-f)/d;return.1>Math.abs((b?c:d)-a)}function se(a,b,c,d,e,f){b=(f.x-d)/b-.5;c=.5-(f.y-e)/c;return.5+(a?c:b)/.8}
function te(a,b,c,d,e,f,g,h,k,l,w){a=Math.floor(((w.x-k)/g-a)/((b-a)/e));c=Math.floor((c-(w.y-l)/h)/((c-d)/f));return 0<=a&&a<e&&0<=c&&c<f?{index:a,tone:c}:null}function ue(a,b,c,d,e){var f=.4*a;a=e.x-c-.55*a;b=d+.53*b-e.y;return a*a+b*b<=f*f}function ve(a,b,c,d,e,f){a=(Math.PI-Math.atan2(f.x-c-.55*a,-(d+.53*b-f.y)))/(2*Math.PI);return e?Math.exp(a*Math.log(100))/10:4*a}function we(a,b,c,d,e){c=e.x-c-a/2;b=b/2-(e.y-d);return Math.abs(Math.sqrt(c*c+b*b)-.375*a)<=.15*a?0<=b?0>c?0:1:0>c?2:3:null}
function xe(a,b,c,d,e){c=e.x-c-a/2;b=b/2-(e.y-d);return Math.abs(Math.sqrt(c*c+b*b)-.375*a)<=.15*a?(a=Math.atan2(c,b)+Math.PI/8,Math.floor((0>a?a+2*Math.PI:a)/(Math.PI/4))):null}function zc(a,b,c,d){a.beginPath();a.moveTo(b+d*Math.cos(.1),c+d*Math.sin(.2));for(var e=1;6>e;e++)a.lineTo(b+d*Math.cos(e*Math.PI/3+.2),c+d*Math.sin(e*Math.PI/3+.2));a.closePath();a.arc(b,c,.5*d,0,2*Math.PI,!0);a.fill()};function Aa(a){for(var b=0;b<Za.length;b++)if(Za[b].name===a)return Za[b];return null}function Xa(a){var b=[];(Za||[]).forEach(function(c){"h"!==c.type&&0<=c.la.indexOf(a)&&b.push(c)});return b};var Za=[new ra({name:"!stop",type:"h"}),new ra(function(){var a=[{D:"c",x:0,y:0,r:0},{D:"t",x:0,y:.3,r:0},{D:"t",x:0,y:-.3,r:Math.PI},{D:"t",x:.3,y:0,r:Math.PI/2},{D:"t",x:-.3,y:0,r:-Math.PI/2}];return{name:"button 1",type:"e",ha:function(){return[0]},H:function(b,c){Yd(b);c=c.g[0];b.buttons(a,[0==c,1==c,2==c,3==c,4==c])},aa:function(b,c,d,e,f,g,h){b=pe(a,d,e,f,g,h);null!==b&&(va(c),c.g[0]=b);return b}}}()),new ra(function(){var a=[{D:"c",x:0,y:0,r:0},{D:"t",x:0,y:.3,r:0},{D:"t",x:0,y:-.3,r:Math.PI},
{D:"t",x:.3,y:0,r:Math.PI/2},{D:"t",x:-.3,y:0,r:-Math.PI/2}];return{name:"button",la:["c"],type:"e",ha:function(){return[!1,!1,!1,!1,!1]},gb:function(){return[!1,!1,!0,!1,!0]},H:function(b,c){Yd(b);b.buttons(a,c.g)},aa:function(b,c,d,e,f,g,h){b=pe(a,d,e,f,g,h);null!==b&&(va(c),c.g[b]=!c.g[b]);return b},wc:function(b){for(var c=0;5>c;c++)if(b.g[c])return null;return new Ha("No button specified",!0)}}}()),new ra(function(){var a=[{D:"r",x:0,y:.4,r:0,A:"2"},{D:"r",x:-.22,y:.35,r:-.45,A:"1"},{D:"r",x:.22,
y:.35,r:.45,A:"3"},{D:"r",x:-.4,y:.22,r:-.8,A:"0"},{D:"r",x:.4,y:.22,r:.8,A:"4"},{D:"r",x:-.2,y:-.4,A:"5"},{D:"r",x:.2,y:-.4,A:"6"}];return{name:"horiz prox",la:["b"],type:"e",ha:function(){return[0,0,0,0,0,0,0]},gb:function(){return[0,1,-1,1,-1,0,0]},H:function(b,c){Yd(b);b.buttons(a,c.g,{Id:!0})},aa:function(b,c,d,e,f,g,h){b=pe(a,d,e,f,g,h);null!==b&&(va(c),c.g[b]=(c.g[b]+2)%3-1);return b},wc:function(b){for(var c=0;7>c;c++)if(b.g[c])return null;return new Ha("No proximity sensor specified",!0)},
Ic:function(b,c){switch(c){case "a":return c=new ua(Aa("horiz prox adv"),null,null),c.g=b.g.concat(c.g.slice(7)),c;default:return b}}}}()),new ra(function(){var a=[{D:"r",x:0,y:.4,r:0,A:"2"},{D:"r",x:-.22,y:.35,r:-.45,A:"1"},{D:"r",x:.22,y:.35,r:.45,A:"3"},{D:"r",x:-.4,y:.22,r:-.8,A:"0"},{D:"r",x:.4,y:.22,r:.8,A:"4"},{D:"r",x:-.2,y:-.4,A:"5"},{D:"r",x:.2,y:-.4,A:"6"}];return{name:"horiz prox adv",la:["c"],type:"e",ha:function(){return[0,0,0,0,0,0,0,.1,.4]},gb:function(){return[0,1,2,1,2,3,3,.1,.4]},
H:function(b,c){Yd(b);b.buttons(a,c.g,{Ef:["white","red","#333","#888"],Vf:["#aaa","black","black","black"],Id:2});qe(b,c.g[8],.02,!1,"red",2);qe(b,c.g[7],-.2,!1,"black",1)},aa:function(b,c,d,e,f,g,h){b=pe(a,d,e,f,g,h);return null!==b?(va(c),c.g[b]=(c.g[b]+1)%4,b):re(.02,!1,d,e,f,g,h)?(va(c),8):re(-.2,!1,d,e,f,g,h)?(va(c),7):null},Ra:function(b,c,d,e,f,g,h,k){7<=d&&(c.g[d]=Math.max(0,Math.min(1,se(!1,e,f,g,h,k))))},wc:function(b){for(var c=0;7>c;c++)if(b.g[c])return null;return new Ha("No sensor specified",
!0)},Ic:function(b,c){switch(c){case "b":if(c=b.V.ha(),b.g[7]===c[7]&&b.g[8]===c[8])return c=new ua(Aa("horiz prox"),null,null),c.g=b.g.slice(0,7),c;default:return b}}}}()),new ra(function(){var a=[{D:"r",x:0,y:.4,r:0,A:"2"},{D:"r",x:-.22,y:.35,r:-.45,A:"1"},{D:"r",x:.22,y:.35,r:.45,A:"3"},{D:"r",x:-.4,y:.22,r:-.8,A:"0"},{D:"r",x:.4,y:.22,r:.8,A:"4"},{D:"r",x:-.2,y:-.4,A:"5"},{D:"r",x:.2,y:-.4,A:"6"}];return{name:"horiz prox 1",la:["a"],type:"e",ha:function(){return[0,0,0,0,0,0,0,.25]},gb:function(){return[0,
1,-1,1,-1,0,0,.25]},H:function(b,c){Yd(b);b.buttons(a,c.g,{Id:!0});qe(b,c.g[7],-.1,!1,"black",1)},aa:function(b,c,d,e,f,g,h){b=pe(a,d,e,f,g,h);return null!==b?(va(c),c.g[b]=(c.g[b]+2)%3-1,b):re(-.1,!1,d,e,f,g,h)?(va(c),7):null},Ra:function(b,c,d,e,f,g,h,k){7<=d&&(c.g[d]=Math.max(.25,Math.min(.75,Math.round(4*se(!1,e,f,g,h,k))/4)))},wc:function(b){for(var c=0;7>c;c++)if(b.g[c])return null;return new Ha("No sensor specified",!0)},Ic:function(b,c){switch(c){case "b":if(c=b.V.ha(),b.g[7]===c[7])return c=
new ua(Aa("horiz prox"),null,null),c.g=b.g.slice(0,7),c;default:return b}}}}()),new ra(function(){var a=[{D:"r",x:-.15,y:.35,A:"0"},{D:"r",x:.15,y:.35,A:"1"}];return{name:"ground",la:["b"],type:"e",ha:function(){return[0,0]},gb:function(){return[1,-1]},H:function(b,c){Yd(b,{jc:!0});b.buttons(a,c.g,{Id:!0})},aa:function(b,c,d,e,f,g,h){b=pe(a,d,e,f,g,h);null!==b&&(va(c),c.g[b]=(c.g[b]+2)%3-1);return b},wc:function(b){return b.g[0]||b.g[1]?null:new Ha("No ground sensor specified",!0)},Ic:function(b,
c){switch(c){case "a":return c=new ua(Aa("ground adv"),null,null),c.g=b.g.concat(c.g.slice(2)),c;default:return b}}}}()),new ra(function(){var a=[{D:"r",x:-.15,y:.35,A:"0"},{D:"r",x:.15,y:.35,A:"1"}];return{name:"ground adv",la:["c"],type:"e",ha:function(){return[0,0,.4,.6]},gb:function(){return[1,2,.4,.6]},H:function(b,c){Yd(b,{jc:!0});b.buttons(a,c.g,{Ef:["white","red","#333","#888"],Vf:["#aaa","black","black","black"],Id:2});qe(b,c.g[3],.02,!1,"red",2);qe(b,c.g[2],-.2,!1,"black",1)},aa:function(b,
c,d,e,f,g,h){b=pe(a,d,e,f,g,h);return null!==b?(va(c),c.g[b]=(c.g[b]+1)%4,b):re(.02,!1,d,e,f,g,h)?(va(c),3):re(-.2,!1,d,e,f,g,h)?(va(c),2):null},Ra:function(b,c,d,e,f,g,h,k){2<=d&&(c.g[d]=Math.max(0,Math.min(1,se(!1,e,f,g,h,k))))},wc:function(b){return b.g[0]||b.g[1]?null:new Ha("No ground sensor specified",!0)},Ic:function(b,c){switch(c){case "b":if(c=b.V.ha(),b.g[2]===c[2]&&b.g[3]===c[3])return c=new ua(Aa("ground"),null,null),c.g=b.g.slice(0,2),c;default:return b}}}}()),new ra(function(){var a=
[{D:"r",x:-.15,y:.35,A:"0"},{D:"r",x:.15,y:.35,A:"1"}];return{name:"ground 1",la:["a"],type:"e",ha:function(){return[0,0,.5]},gb:function(){return[1,-1,.5]},H:function(b,c){Yd(b,{jc:!0});b.buttons(a,c.g,{Id:!0});qe(b,c.g[2],0,!1,"black",1)},aa:function(b,c,d,e,f,g,h){b=pe(a,d,e,f,g,h);return null!==b?(va(c),c.g[b]=(c.g[b]+2)%3-1,b):re(0,!1,d,e,f,g,h)?(va(c),2):null},Ra:function(b,c,d,e,f,g,h,k){2<=d&&(c.g[d]=Math.max(.25,Math.min(.75,Math.round(4*se(!1,e,f,g,h,k))/4)))},wc:function(b){return b.g[0]||
b.g[1]?null:new Ha("No ground sensor specified",!0)},Ic:function(b,c){switch(c){case "b":if(c=b.V.ha(),b.g[2]===c[2])return c=new ua(Aa("ground"),null,null),c.g=b.g.slice(0,2),c;default:return b}}}}()),new ra({name:"tap",la:["b","a"],type:"e",H:function(a){a.J.translate(.05*a.v.j,0);be(a);ce(a)},Ic:function(a,b){switch(b){case "a":return new ua(Aa("accelerometer"),null,null);default:return a}}}),new ra(function(){var a=[{D:"c",x:-.33,y:-.3,r:0},{D:"c",x:0,y:-.3,r:0},{D:"c",x:.33,y:-.3,r:0}];return{name:"accelerometer",
la:["c"],type:"e",ha:function(){return[0,0]},H:function(b,c){var d=c.g[0];c=c.g[1];0===d?(b.J.save(),b.J.translate(.08*b.v.j,-.2*b.v.j),be(b),ce(b),b.J.restore()):ge(b,2===d,2===d?-c:c);b.buttons(a,[0===d,1===d,2===d])},aa:function(b,c,d,e,f,g,h){if(0!==c.g[0]&&he(d,f,g,h))return va(c),1;b=pe(a,d,e,f,g,h);return null!==b?(va(c),c.g[0]=b,2):null},Ra:function(b,c,d,e,f,g,h,k){1===d&&(b=ie(e,g,h,k),c.g[1]=2===c.g[0]?-b:b)},Ic:function(b,c){switch(c){case "b":if(0===b.g[0])return new ua(Aa("tap"),null,
null);default:return b}}}}()),new ra({name:"roll",la:["a"],type:"e",ha:function(){return[0]},gb:function(){return[2]},H:function(a,b){ge(a,!1,b.g[0])},aa:function(a,b,c,d,e,f,g){return he(c,e,f,g,!0)?(va(b),1):null},Ra:function(a,b,c,d,e,f,g,h){b.g[0]=ie(d,f,g,h,!0)}}),new ra({name:"pitch",la:["a"],type:"e",ha:function(){return[0]},gb:function(){return[2]},H:function(a,b){ge(a,!0,b.g[0])},aa:function(a,b,c,d,e,f,g){return he(c,e,f,g,!0)?(va(b),1):null},Ra:function(a,b,c,d,e,f,g,h){b.g[0]=ie(d,f,g,
h,!0)}}),new ra({name:"yaw",la:["a"],type:"e",ha:function(){return[0]},gb:function(){return[2]},H:function(a,b){var c=a.J,d=a.v;b=b.g[0]*Math.PI/12;c.save();c.translate(.5*d.j,.5*d.j);c.rotate(b);fe(a);c.translate(-d.j/2,-d.j/2);Yd(a,{jc:!0,scale:.45});c.restore()},aa:function(a,b,c,d,e,f,g){return he(c,e,f,g,!0)?(va(b),1):null},Ra:function(a,b,c,d,e,f,g,h){b.g[0]=ie(d,f,g,h,!0)}}),new ra({name:"clap",type:"e",H:function(a){var b=a.J;a=a.v;b.save();b.beginPath();b.arc(.7*a.j,.6*a.j,.15*a.j,0,2*Math.PI);
b.fillStyle="white";b.fill();b.beginPath();b.moveTo(.7*a.j,.6*a.j);b.lineTo(.8*a.j,.95*a.j);b.strokeStyle="white";b.lineWidth=.13*a.j;b.stroke();b.lineWidth=1.5*a.ja;b.translate(.3*a.j,.3*a.j);b.rotate(.1);for(var c=0;9>c;c++)b.beginPath(),b.moveTo(.07*a.j,0),b.lineTo(.14*a.j,0),b.moveTo(.17*a.j,0),b.lineTo(.22*a.j,0),b.stroke(),b.rotate(Math.PI/4.5);b.restore()}}),new ra({name:"init",la:["b","a"],type:"e",H:function(a){var b=a.J;a=a.v;var c=.4*a.j;b.save();b.fillStyle="black";b.strokeStyle="black";
b.lineWidth=a.ja;b.beginPath();b.arc(.3*a.j,.5*a.j,.08*a.j,0,2*Math.PI);b.fill();b.beginPath();b.moveTo(.42*a.j,.5*a.j);b.lineTo(.7*a.j,.5*a.j);b.stroke();c*=.4;b.beginPath();b.moveTo(.8*a.j,.5*a.j);b.lineTo(.8*a.j-c*Math.sqrt(3)/2,.5*a.j+c/2);b.lineTo(.8*a.j-c*Math.sqrt(3)/2,.5*a.j-c/2);b.fill();b.restore()},xg:!0}),new ra({name:"timer",la:["a"],type:"e",H:function(a){ke(a,0,!0,!1)}}),new ra(function(){var a=[{D:"t",x:-.25,y:0,r:-Math.PI/2},{D:"t",x:0,y:.25,r:0},{D:"t",x:0,y:-.25,r:Math.PI},{D:"t",
x:.25,y:0,r:Math.PI/2},{D:"c",x:0,y:0,r:0}];return{name:"remote control arrows",la:[],type:"e",ha:function(){return[0]},H:function(b,c){var d=b.J,e=b.v;d.save();d.fillStyle="#eee";d.fillRect(.1*e.j,e.ja,.8*e.j,e.j-2*e.ja);d.restore();c=c.g[0];b.buttons(a,[0==c,1==c,2==c,3==c,4==c])},aa:function(b,c,d,e,f,g,h){b=pe(a,d,e,f,g,h);null!==b&&(va(c),c.g[0]=b);return b}}}()),new ra({name:"state",la:["a"],type:"s",ha:function(){return[0,0,0,0]},gb:function(){return[1,0,0,-1]},H:function(a,b){Yd(a);ne(a,b.g)},
aa:function(a,b,c,d,e,f,g){a=we(c,d,e,f,g);null!==a&&(va(b),b.g[a]=(b.g[a]+2)%3-1);return a},Ic:function(a,b){return"b"===b&&0===a.g[0]&&0===a.g[1]&&0===a.g[2]&&0===a.g[3]?null:a}}),new ra({name:"state 8",la:["c"],type:"s",ha:function(){return[0]},H:function(a,b){Yd(a);oe(a,b.g[0])},aa:function(a,b,c,d,e,f,g){a=xe(c,d,e,f,g);null!==a&&(va(b),b.g[0]=a);return a}}),new ra(function(){var a=[{D:"t",x:-.3,y:.3,r:0},{D:"t",x:-.3,y:-.3,r:Math.PI},{D:"t",x:.1,y:.3,r:0},{D:"t",x:.1,y:-.3,r:Math.PI},{D:"c",
x:.35,y:-.3,r:0}];return{name:"counter comparison",la:["a"],type:"s",ha:function(){return[0,0]},H:function(b,c){b.text(0===c.g[0]?"=":0<c.g[0]?"\u2265":"\u2264",{x:-.3*b.v.j,fillStyle:"black"});b.text(c.g[1].toString(10),{x:.1*b.v.j,fillStyle:"black"});b.buttons(a,[1>c.g[0]?-2:0,-1<c.g[0]?-2:0,255>c.g[1]?-2:0,0<c.g[1]?-2:0,0!==c.g[1]?-2:0])},aa:function(b,c,d,e,f,g,h){b=pe(a,d,e,f,g,h);if(null!==b)switch(va(c),b){case 0:c.g[0]=Math.min(1,c.g[0]+1);break;case 1:c.g[0]=Math.max(-1,c.g[0]-1);break;case 2:c.g[1]=
Math.min(255,c.g[1]+1);break;case 3:c.g[1]=Math.max(0,c.g[1]-1);break;case 4:c.g[1]=0}return b}}}()),new ra({name:"color state",la:["c"],type:"s",ha:function(){return[0,0,0]},H:function(a,b){Yd(a,{Ub:b.g});qe(a,b.g[0],.3,!1,"red");qe(a,b.g[1],0,!1,"#0c0");qe(a,b.g[2],-.3,!1,"#08f")},aa:function(a,b,c,d,e,f,g){return re(.3,!1,c,d,e,f,g)?(va(b),0):re(0,!1,c,d,e,f,g)?(va(b),1):re(-.3,!1,c,d,e,f,g)?(va(b),2):null},Ra:function(a,b,c,d,e,f,g,h){b.g[c]=Math.max(0,Math.min(1,Math.round(se(!1,d,e,f,g,h))))}}),
new ra(function(){var a=[{D:"r",x:-.15,y:.3,size:1.4,A:"black",fillStyle:"#666",strokeStyle:"white"},{D:"r",x:-.3,y:0,size:1.4,A:"red",fillStyle:"red",strokeStyle:"white"},{D:"r",x:0,y:0,size:1.4,A:"green",fillStyle:"#0c0",strokeStyle:"white"},{D:"r",x:.3,y:0,size:1.4,A:"yellow",fillStyle:"yellow",strokeStyle:"silver"},{D:"r",x:-.3,y:-.3,size:1.4,A:"blue",fillStyle:"blue",strokeStyle:"white"},{D:"r",x:0,y:-.3,size:1.4,A:"magenta",fillStyle:"magenta",strokeStyle:"white"},{D:"r",x:.3,y:-.3,size:1.4,
A:"cyan",fillStyle:"cyan",strokeStyle:"white"},{D:"r",x:.15,y:.3,size:1.4,A:"white",fillStyle:"white",strokeStyle:"silver"}];return{name:"color 8 state",la:["a"],type:"s",ha:function(){return[0]},H:function(b,c){Yd(b,{Ub:[c.g&1,(c.g&2)/2,(c.g&4)/4]});b.buttons(a,[1>c.g[0]?-2:0,-1<c.g[0]?-2:0])},aa:function(b,c,d,e,f,g,h){b=pe(a,d,e,f,g,h);null!==b&&(va(c),c.g=[b]);return b}}}()),new ra({name:"motor state",la:["c"],type:"s",ha:function(){return[0,0]},H:function(a,b){var c=$d(a,2.4*b.g[0],2.4*b.g[1],
.19);Yd(a,{jc:!0,scale:.45,rotation:c.bb,sf:[.19*c.x*a.v.j+.13*a.v.j*Math.sin(c.bb),.19*c.y*a.v.j+.13*a.v.j*Math.cos(c.bb)]});a.J.save();a.J.globalAlpha=.2;$d(a,2.4*b.g[0],2.4*b.g[1],.19);a.J.restore();qe(a,.5+.5*b.g[0],-.4,!0,0===b.g[0]?"white":b.g[0]===b.g[1]?"#0c0":b.g[0]===-b.g[1]?"#f70":"#fd0");qe(a,.5+.5*b.g[1],.4,!0,0===b.g[1]?"white":b.g[0]===b.g[1]?"#0c0":b.g[0]===-b.g[1]?"#f70":"#fd0")},aa:function(a,b,c,d,e,f,g){return re(-.4,!0,c,d,e,f,g)?(va(b),0):re(.4,!0,c,d,e,f,g)?(va(b),1):ae(a,c,
e,f,.5*b.g[0],.5*b.g[1],g)?(va(b),2):null},Ra:function(a,b,c,d,e,f,g,h){2>c?(a=se(!0,d,e,f,g,h),b.g[c]=.25>a?-1:.75<a?1:0):(a=se(!0,d,e,f,g,h),a=.25>a?-1:.75<a?1:0,b.g[0]=a,b.g[1]=a)}}),new ra({name:"motor",type:"a",ha:function(){return[0,0]},gb:function(){return[.5,.2]},H:function(a,b){var c=$d(a,2.4*b.g[0],2.4*b.g[1],.19);Yd(a,{jc:!0,scale:.45,rotation:c.bb,sf:[.19*c.x*a.v.j+.13*a.v.j*Math.sin(c.bb),.19*c.y*a.v.j+.13*a.v.j*Math.cos(c.bb)]});a.J.save();a.J.globalAlpha=.2;$d(a,2.4*b.g[0],2.4*b.g[1],
.19);a.J.restore();qe(a,.5+.5*b.g[0],-.4,!0,0===b.g[0]?"white":b.g[0]===b.g[1]?"#0c0":b.g[0]===-b.g[1]?"#f70":"#fd0");qe(a,.5+.5*b.g[1],.4,!0,0===b.g[1]?"white":b.g[0]===b.g[1]?"#0c0":b.g[0]===-b.g[1]?"#f70":"#fd0")},aa:function(a,b,c,d,e,f,g){return re(-.4,!0,c,d,e,f,g)?(va(b),0):re(.4,!0,c,d,e,f,g)?(va(b),1):ae(a,c,e,f,.5*b.g[0],.5*b.g[1],g)?(va(b),2):null},Ra:function(a,b,c,d,e,f,g,h){2>c?(a=2*se(!0,d,e,f,g,h)-1,d=b.g[1-c],.1>Math.abs(a)?a=0:.1>Math.abs(a-d)?a=d:.1>Math.abs(a+d)&&(a=-d),b.g[c]=
Math.max(-1,Math.min(1,a))):(a=2*se(!0,d,e,f,g,h)-1,a=.1>Math.abs(a)?0:Math.max(-1,Math.min(1,a)),.05>Math.abs(b.g[0]-b.g[1])?(b.g[0]=a,b.g[1]=a):Math.abs(b.g[0])>Math.abs(b.g[1])?(b.g[1]*=a/b.g[0],b.g[0]=a):(b.g[0]*=a/b.g[1],b.g[1]=a))}}),new ra(function(){var a=[{D:"c",x:0,y:0,r:0},{D:"t",x:0,y:.35,r:0},{D:"t",x:0,y:-.35,r:Math.PI},{D:"t",x:-.3,y:.32,r:-.4},{D:"t",x:.3,y:.32,r:.4},{D:"t",x:-.35,y:.05,r:-Math.PI/2},{D:"t",x:.35,y:.05,r:Math.PI/2}];return{name:"move",la:["c"],type:"a",ha:function(){return[0]},
H:function(b,c){Yd(b,{jc:!0,scale:.45});b.buttons(a,[0===c.g[0]?1:-2,1===c.g[0]?1:-2,2===c.g[0]?1:-2,3===c.g[0]?1:-2,4===c.g[0]?1:-2,5===c.g[0]?1:-2,6===c.g[0]?1:-2])},aa:function(b,c,d,e,f,g,h){b=pe(a,d,e,f,g,h);null!==b&&(va(c),c.g[0]=b);return b}}}()),new ra({name:"nn obstacles",la:[],type:"a",ha:function(){return[0,0,0,0]},gb:function(){return[.3,.2,.1,.3]},H:function(a,b,c,d){c=d?.5:1;var e=a.J,f=a.v;e.save();d&&e.scale(c,c);e.fillStyle="white";e.font=f.yf;e.textAlign="center";e.textBaseline=
"middle";e.translate(.5*f.j,.5*f.j);e.translate(-.5*f.j,-.5*f.j);d?(e.fillText("\u21d1",.25*f.j,.35*f.j),e.fillText(b.g[0].toFixed(1),.6*f.j,.35*f.j),e.fillText("\u21a7",.25*f.j,.81*f.j),e.fillText(b.g[1].toFixed(1),.6*f.j,.81*f.j),e.fillText("+",.25*f.j,1.27*f.j),e.fillText(b.g[2].toFixed(1),.6*f.j,1.27*f.j),e.fillText("\u2212",.25*f.j,1.69*f.j),e.fillText(b.g[3].toFixed(1),.6*f.j,1.69*f.j),e.translate(f.j,0),qe(a,b.g[0],.15,!1),qe(a,b.g[1],-.3,!1),qe(a,b.g[2],-.75,!1),qe(a,b.g[3],-1.2,!1)):(e.fillText("\u21d1",
.25*f.j,.17*f.j),e.fillText(b.g[0].toFixed(1),.6*f.j,.17*f.j),e.fillText("\u21a7",.25*f.j,.4*f.j),e.fillText(b.g[1].toFixed(1),.6*f.j,.4*f.j),e.fillText("+",.25*f.j,.63*f.j),e.fillText(b.g[2].toFixed(1),.6*f.j,.63*f.j),e.fillText("\u2212",.25*f.j,.87*f.j),e.fillText(b.g[3].toFixed(1),.6*f.j,.87*f.j));e.restore()},Yd:!0,aa:function(a,b,c,d,e,f,g){return re(.35,!1,c/2,d,e+c/2,f,g)?(va(b),0):re(.12,!1,c/2,d,e+c/2,f,g)?(va(b),1):re(-.12,!1,c/2,d,e+c/2,f,g)?(va(b),2):re(-.35,!1,c/2,d,e+c/2,f,g)?(va(b),
3):null},Ra:function(a,b,c,d,e,f,g,h){b.g[c]=Math.max(0,Math.min(1,Math.round(20*se(!1,d/2,e,f+d/2,g,h))/20))}}),new ra({name:"top color",la:["a"],type:"a",ha:function(){return[0,0,0]},H:function(a,b){Yd(a,{Ub:b.g});qe(a,b.g[0],.3,!1,"red");qe(a,b.g[1],0,!1,"#0c0");qe(a,b.g[2],-.3,!1,"#08f")},aa:function(a,b,c,d,e,f,g){return re(.3,!1,c,d,e,f,g)?(va(b),0):re(0,!1,c,d,e,f,g)?(va(b),1):re(-.3,!1,c,d,e,f,g)?(va(b),2):null},Ra:function(a,b,c,d,e,f,g,h){b.g[c]=Math.max(0,Math.min(1,se(!1,d,e,f,g,h)))}}),
new ra(function(){var a=[{D:"r",x:-.15,y:.3,size:1.4,A:"black",fillStyle:"#666",strokeStyle:"white"},{D:"r",x:-.3,y:0,size:1.4,A:"red",fillStyle:"red",strokeStyle:"white"},{D:"r",x:0,y:0,size:1.4,A:"green",fillStyle:"#0c0",strokeStyle:"white"},{D:"r",x:.3,y:0,size:1.4,A:"yellow",fillStyle:"yellow",strokeStyle:"silver"},{D:"r",x:-.3,y:-.3,size:1.4,A:"blue",fillStyle:"blue",strokeStyle:"white"},{D:"r",x:0,y:-.3,size:1.4,A:"magenta",fillStyle:"magenta",strokeStyle:"white"},{D:"r",x:.3,y:-.3,size:1.4,
A:"cyan",fillStyle:"cyan",strokeStyle:"white"},{D:"r",x:.15,y:.3,size:1.4,A:"white",fillStyle:"white",strokeStyle:"silver"}];return{name:"top color 8",la:["b"],type:"a",ha:function(){return[0]},H:function(b,c){Yd(b,{Ub:[c.g&1,(c.g&2)/2,(c.g&4)/4]});b.buttons(a,[1>c.g[0]?-2:0,-1<c.g[0]?-2:0])},aa:function(b,c,d,e,f,g,h){b=pe(a,d,e,f,g,h);null!==b&&(va(c),c.g=[b]);return b}}}()),new ra({name:"bottom color",la:["a"],type:"a",ha:function(){return[0,0,0]},H:function(a,b){Yd(a,{jc:!0,Ub:b.g});qe(a,b.g[0],
.3,!1,"red");qe(a,b.g[1],0,!1,"#0c0");qe(a,b.g[2],-.3,!1,"#08f")},aa:function(a,b,c,d,e,f,g){return re(.3,!1,c,d,e,f,g)?(va(b),0):re(0,!1,c,d,e,f,g)?(va(b),1):re(-.3,!1,c,d,e,f,g)?(va(b),2):null},Ra:function(a,b,c,d,e,f,g,h){b.g[c]=Math.max(0,Math.min(1,se(!1,d,e,f,g,h)))}}),new ra({name:"bottom-left color",la:["c"],type:"a",ha:function(){return[0,0,0]},H:function(a,b){Yd(a,{jc:!0,Ub:b.g,Le:"left"});qe(a,b.g[0],.3,!1,"red");qe(a,b.g[1],0,!1,"#0c0");qe(a,b.g[2],-.3,!1,"#08f")},aa:function(a,b,c,d,
e,f,g){return re(.3,!1,c,d,e,f,g)?(va(b),0):re(0,!1,c,d,e,f,g)?(va(b),1):re(-.3,!1,c,d,e,f,g)?(va(b),2):null},Ra:function(a,b,c,d,e,f,g,h){b.g[c]=Math.max(0,Math.min(1,se(!1,d,e,f,g,h)))}}),new ra({name:"bottom-right color",la:["c"],type:"a",ha:function(){return[0,0,0]},H:function(a,b){Yd(a,{jc:!0,Ub:b.g,Le:"right"});qe(a,b.g[0],.3,!1,"red");qe(a,b.g[1],0,!1,"#0c0");qe(a,b.g[2],-.3,!1,"#08f")},aa:function(a,b,c,d,e,f,g){return re(.3,!1,c,d,e,f,g)?(va(b),0):re(0,!1,c,d,e,f,g)?(va(b),1):re(-.3,!1,c,
d,e,f,g)?(va(b),2):null},Ra:function(a,b,c,d,e,f,g,h){b.g[c]=Math.max(0,Math.min(1,se(!1,d,e,f,g,h)))}}),new ra(function(){var a=[{D:"r",x:-.15,y:.3,size:1.4,A:"black",fillStyle:"#666",strokeStyle:"white"},{D:"r",x:-.3,y:0,size:1.4,A:"red",fillStyle:"red",strokeStyle:"white"},{D:"r",x:0,y:0,size:1.4,A:"green",fillStyle:"#0c0",strokeStyle:"white"},{D:"r",x:.3,y:0,size:1.4,A:"yellow",fillStyle:"yellow",strokeStyle:"silver"},{D:"r",x:-.3,y:-.3,size:1.4,A:"blue",fillStyle:"blue",strokeStyle:"white"},
{D:"r",x:0,y:-.3,size:1.4,A:"magenta",fillStyle:"magenta",strokeStyle:"white"},{D:"r",x:.3,y:-.3,size:1.4,A:"cyan",fillStyle:"cyan",strokeStyle:"white"},{D:"r",x:.15,y:.3,size:1.4,A:"white",fillStyle:"white",strokeStyle:"silver"}];return{name:"bottom color 8",la:["b"],type:"a",ha:function(){return[0]},H:function(b,c){Yd(b,{jc:!0,Ub:[c.g&1,(c.g&2)/2,(c.g&4)/4]});b.buttons(a,[1>c.g[0]?-2:0,-1<c.g[0]?-2:0])},aa:function(b,c,d,e,f,g,h){b=pe(a,d,e,f,g,h);null!==b&&(va(c),c.g=[b]);return b}}}()),new ra(function(){var a=
[{D:"r",x:-.15,y:.3,size:1.4,A:"black",fillStyle:"#666",strokeStyle:"white"},{D:"r",x:-.3,y:0,size:1.4,A:"red",fillStyle:"red",strokeStyle:"white"},{D:"r",x:0,y:0,size:1.4,A:"green",fillStyle:"#0c0",strokeStyle:"white"},{D:"r",x:.3,y:0,size:1.4,A:"yellow",fillStyle:"yellow",strokeStyle:"silver"},{D:"r",x:-.3,y:-.3,size:1.4,A:"blue",fillStyle:"blue",strokeStyle:"white"},{D:"r",x:0,y:-.3,size:1.4,A:"magenta",fillStyle:"magenta",strokeStyle:"white"},{D:"r",x:.3,y:-.3,size:1.4,A:"cyan",fillStyle:"cyan",
strokeStyle:"white"},{D:"r",x:.15,y:.3,size:1.4,A:"white",fillStyle:"white",strokeStyle:"silver"}];return{name:"bottom-left color 8",la:["c"],type:"a",ha:function(){return[0]},H:function(b,c){Yd(b,{jc:!0,Ub:[c.g&1,(c.g&2)/2,(c.g&4)/4],Le:"left"});b.buttons(a,[1>c.g[0]?-2:0,-1<c.g[0]?-2:0])},aa:function(b,c,d,e,f,g,h){b=pe(a,d,e,f,g,h);null!==b&&(va(c),c.g=[b]);return b}}}()),new ra(function(){var a=[{D:"r",x:-.15,y:.3,size:1.4,A:"black",fillStyle:"#666",strokeStyle:"white"},{D:"r",x:-.3,y:0,size:1.4,
A:"red",fillStyle:"red",strokeStyle:"white"},{D:"r",x:0,y:0,size:1.4,A:"green",fillStyle:"#0c0",strokeStyle:"white"},{D:"r",x:.3,y:0,size:1.4,A:"yellow",fillStyle:"yellow",strokeStyle:"silver"},{D:"r",x:-.3,y:-.3,size:1.4,A:"blue",fillStyle:"blue",strokeStyle:"white"},{D:"r",x:0,y:-.3,size:1.4,A:"magenta",fillStyle:"magenta",strokeStyle:"white"},{D:"r",x:.3,y:-.3,size:1.4,A:"cyan",fillStyle:"cyan",strokeStyle:"white"},{D:"r",x:.15,y:.3,size:1.4,A:"white",fillStyle:"white",strokeStyle:"silver"}];return{name:"bottom-right color 8",
la:["c"],type:"a",ha:function(){return[0]},H:function(b,c){Yd(b,{jc:!0,Ub:[c.g&1,(c.g&2)/2,(c.g&4)/4],Le:"right"});b.buttons(a,[1>c.g[0]?-2:0,-1<c.g[0]?-2:0])},aa:function(b,c,d,e,f,g,h){b=pe(a,d,e,f,g,h);null!==b&&(va(c),c.g=[b]);return b}}}()),new ra({name:"notes",type:"a",ha:function(){return[0,1,1,1,2,1,0,1,2,1,4,2]},H:function(a,b){b=b.g;var c=a.J,d=a.v;c.save();c.fillStyle="#eee";for(var e=0;5>e;e++)c.fillRect(.1*d.j,d.j*(.1+.16*e),.8*d.j,.16*d.j-d.ja);de(a,b,.1,.9,.9,.1,5,.14,1);c.restore()},
aa:function(a,b,c,d,e,f,g){return(a=te(.1,.9,.9,.1,6,5,c,d,e,f,g))?(va(b),b.g[2*a.index]===a.tone?b.g[2*a.index+1]=(b.g[2*a.index+1]+1)%3:(b.g[2*a.index]=a.tone,b.g[2*a.index+1]=1),0):null}}),new ra(function(){var a=[{D:"t",x:-.3,y:.3,r:0},{D:"t",x:-.3,y:-.3,r:Math.PI}];return{name:"play",la:["c"],type:"a",ha:function(){return[0]},H:function(b,c){ee(b,c.g[0]);b.buttons(a,[-2,-2])},aa:function(b,c,d,e,f,g,h){b=pe(a,d,e,f,g,h);if(null!==b)switch(va(c),b){case 0:c.g[0]=(c.g[0]+1)%100;break;case 1:c.g[0]=
(c.g[0]+99)%100}return b}}}()),new ra({name:"play stop",la:["c"],type:"a",H:function(a){ee(a,null)}}),new ra({name:"set state",la:["a"],type:"a",ha:function(){return[0,0,0,0]},gb:function(){return[0,1,-1,0]},H:function(a,b){Yd(a);ne(a,b.g)},aa:function(a,b,c,d,e,f,g){a=we(c,d,e,f,g);null!==a&&(va(b),b.g[a]=(b.g[a]+2)%3-1);return a}}),new ra({name:"toggle state",la:["c"],type:"a",ha:function(){return[!1,!1,!1,!1]},gb:function(){return[!0,!1,!1,!1]},H:function(a,b){Yd(a);ne(a,b.g.map(function(c){return c?
2:0}));Ac(a.J,a.v.j/2,a.v.j/2,.2*a.v.j,-1.4,1.4,{style:"black",lineWidth:a.v.ja,Xc:5*a.v.ja});Ac(a.J,a.v.j/2,a.v.j/2,.2*a.v.j,Math.PI-1.4,Math.PI+1.4,{style:"black",lineWidth:a.v.ja,Xc:5*a.v.ja})},aa:function(a,b,c,d,e,f,g){a=we(c,d,e,f,g);null!==a&&(va(b),b.g[a]=!b.g[a]);return a}}),new ra({name:"set state 8",la:["c"],type:"a",ha:function(){return[0]},H:function(a,b){Yd(a);oe(a,b.g[0])},aa:function(a,b,c,d,e,f,g){a=xe(c,d,e,f,g);null!==a&&(va(b),b.g[0]=a);return a}}),new ra(function(){var a=[{D:"c",
x:-.2,y:0},{D:"c",x:.2,y:0}];return{name:"change state 8",la:["c"],type:"a",ha:function(){return[1]},H:function(b,c){Yd(b);var d=b.J;d.save();for(var e=0;8>e;e++)me(b,Math.PI*(.46-.25*e),Math.PI*(.54-.25*e),0);d.restore();Ac(b.J,b.v.j/2,b.v.j/2,.375*b.v.j,-.8,.8,{style:"black",lineWidth:b.v.ja,Xc:5*b.v.ja});Ac(b.J,b.v.j/2,b.v.j/2,.375*b.v.j,Math.PI-.8,Math.PI+.8,{Fd:!0,style:"black",lineWidth:b.v.ja,Xc:5*b.v.ja});b.buttons(a,[0>c.g[0],0<c.g[0]])},aa:function(b,c,d,e,f,g,h){b=pe(a,d,e,f,g,h);null!==
b&&(va(c),c.g[0]=0===b?-1:1);return b}}}()),new ra(function(){var a=[{D:"t",x:0,y:.3,r:0},{D:"t",x:0,y:-.3,r:Math.PI}];return{name:"set counter",la:["a"],type:"a",ha:function(){return[0]},H:function(b,c){b.text(0===c.g[0]?"= 0":0<c.g[0]?"+1":"\u22121");b.buttons(a,[1>c.g[0]?-2:0,-1<c.g[0]?-2:0])},aa:function(b,c,d,e,f,g,h){b=pe(a,d,e,f,g,h);if(null!==b)switch(va(c),b){case 0:c.g[0]=Math.min(1,c.g[0]+1);break;case 1:c.g[0]=Math.max(-1,c.g[0]-1)}return b}}}()),new ra({name:"set timer",la:["a"],type:"a",
ha:function(){return[1]},H:function(a,b){ke(a,b.g[0],!1,!1)},aa:function(a,b,c,d,e,f,g){return ue(c,d,e,f,g)?(va(b),1):null},Ra:function(a,b,c,d,e,f,g,h){b.g[0]=ve(d,e,f,g,!1,h)}}),new ra({name:"set timer log",la:["c"],type:"a",ha:function(){return[1]},H:function(a,b){ke(a,b.g[0],!1,!0)},aa:function(a,b,c,d,e,f,g){return ue(c,d,e,f,g)?(va(b),1):null},Ra:function(a,b,c,d,e,f,g,h){b.g[0]=ve(d,e,f,g,!0,h)}}),new ra(function(){function a(c,d){if(c.g[1]){var e=new Image;e.src=c.g[1];e.addEventListener("load",
function(){c.g[2]=e;d&&d()},!1)}}var b=[{D:"c",x:-.33,y:-.3,r:0}];return{name:"picture comment",la:["a"],type:"c",ha:function(){return[!1,"",null]},df:function(c){return 2<=c.g.length?[!1,c.g[1]]:[!1,""]},ie:function(c,d,e){c.g=2<=d.length?[!1,d[1]]:[!1,""];a(c,e)},H:function(c,d){d.g[2]&&c.J.drawImage(d.g[2],0,0,240,240,0,0,c.v.j,c.v.j);c.buttons(b,[d.g[0]])},aa:function(c,d,e,f,g,h,k){e=pe(b,e,f,g,h,k);0===e&&(d.g[0]?ba&&(ba.pause&&ba.pause(),ca.getTracks().forEach(function(l){l.stop()}),ba=null):
(va(d),navigator.mediaDevices.getUserMedia({audio:!1,video:{width:320,height:240}}).then(function(l){ca=l;ba=document.createElement("video");ba.srcObject=l;ba.addEventListener("loadedmetadata",function(){ba.play();var w=setInterval(function(){ba?(da||(da=document.createElement("canvas"),da.width=240,da.height=240),da.getContext("2d").drawImage(ba,0,0,240,240,0,0,240,240),d.g[1]=da.toDataURL("image/png"),a(d,function(){c.pa&&c.pa();Sb(c)})):clearInterval(w)},100)},!1)})),d.g[0]=!d.g[0]);return e}}}())];function ye(a,b){function c(f){return f instanceof Array?f.join(""):f}function d(f,g){return f.map(function(h){return ta(h,g.g)})}var e=b||{};["aseba","l2","js","python"].forEach(function(f){a[f]&&(e[f]=function(g){var h={};a[f].initVarDecl&&(h.Sb=d(a[f].initVarDecl.map(c),g));a[f].initCodeDecl&&(h.Rb=d(a[f].initCodeDecl.map(c),g));a[f].initCodeExec&&(h.ac=d(a[f].initCodeExec.map(c),g));a[f].sectionBegin&&(h.P=ta(c(a[f].sectionBegin),g.g));a[f].sectionEnd&&(h.ib=ta(c(a[f].sectionEnd),g.g));a[f].sectionPreamble&&
(h.Wa=ta(c(a[f].sectionPreamble),g.g));a[f].clauseInit&&(h.ba=ta(c(a[f].clauseInit),g.g));if(a[f].clauseAnd){var k="";g.g.forEach(function(l,w){(l=ta(c(a[f].clauseAnd),g.g,w))&&(k+=(0<k.length?" "+wa[f].m+" ":"")+l)});h.Va=k||wa[f].o}else a[f].clause&&(h.Va=ta(c(a[f].clause),g.g));a[f].clauseAsCondition&&(h.mg=ta(c(a[f].clauseAsCondition),g.g));h.qh=a[f].clauseOptional||!1;a[f].statement1?h.ka=g.g.map(function(l,w){return ta(c(a[f].statement1),g.g,w)}).join(""):a[f].statement&&(h.ka=ta(c(a[f].statement),
g.g));a[f].error&&(h.Va=ta(c(a.error.error),g.g));return h})});return e};function ze(a){this.R=new DOMParser;this.b=this.R.parseFromString(a,"text/xml");this.h=this.b.documentElement;this.Ca=(this.h.getAttribute("viewBox")||"0 0 1 1").split(" ").map(function(b){return parseFloat(b)});this.w={}}
var Ae={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgreen:"#006400",
darkgrey:"#A9A9A9",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",
ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",green:"#008000",greenyellow:"#ADFF2F",grey:"#808080",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgreen:"#90EE90",lightgrey:"#D3D3D3",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",
lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",
moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",
seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"};function Be(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}function Ce(a){var b={};Be(b,a);return b}
function De(a,b){b.split(";").forEach(function(c){c=c.trim().split(":").map(function(d){return d.trim()});2===c.length&&(a[c[0]]=c[1])})}
function Ee(a,b,c,d,e){a&&(a=a.replace(/\s*\(\s*/g,"(").replace(/\s*\)\s*/g,")").replace(/ +,/g,",").replace(/, +/g,",").replace(/ +/g,","),a.split(")").slice(0,-1).forEach(function(f){var g=f.split("(")[0];f=f.split("(")[1].split(",").map(function(k){return parseFloat(k)});switch(g){case "translate":b(f[0]||0,f[1]||0);break;case "rotate":g=(f[0]||0)*Math.PI/180;var h=f[1]||0;f=f[2]||0;0!==h||0!==f?(b(-h,-f),c(g),b(h,f)):c(g);break;case "scale":g=f[0]||1;d(g,f[1]||g);break;case "matrix":e(f[0],f[1],
f[2],f[3],f[4],f[5]);break;default:throw"transform not implemented: "+g;}}))}function Fe(a,b){Ee(a,function(c,d){b.translate(c,d)},function(c){b.rotate(c)},function(c,d){b.scale(c,d)},function(c,d,e,f,g,h){b.He(c,d,e,f,g,h)})}
ze.prototype.H=function(a,b){function c(q,z,C){function y(){for(var D=0;D<q.childElementCount;D++)c(q.children[D],z,C)}function A(D,E){D=q.getAttribute(D);return null===D?E||0:parseFloat(D)}function K(D,E){D=n.apply(new Ge(D,E));v.push(D.x);m.push(D.y)}function I(D,E,G){if(null==D||""==D)return E;D=/^\s*(-?[0-9.]+)\s*([a-z%]*)\s*$/i.exec(D);E=parseFloat(D[1]);switch(D[2]||"px"){case "pt":return 25.4*E/72*3;case "pc":return 25.4*E/6*3;case "in":return 25.4*E*3;case "mm":return 3*E;case "cm":return 30*
E;case "em":return 18*E;case "ex":return 9*E;case "%":return E*G/100;default:return E}}function M(D){D=D.replace(/\.([0-9]+)(?=\.)/g,".$1 ").replace(/([.0-9])-/g,"$1 -").replace(/\s*([a-z])\s*/gi,";$1").replace(/\s*,\s*/g,",").replace(/\s+/g,",");var E=0,G=0,Z=0,O=0,ka=0,la=0,X=[],ja=[],ma=!0;a&&a.beginPath();D.slice(1).split(";").forEach(function(L){var F=L[0];L=1<L.length?L.slice(1).split(",").map(function(Nh){return parseFloat(Nh)}):[];switch(F){case "M":if(2<=L.length){E=L[0];G=L[1];ka=E;la=G;
a&&a.moveTo(E,G);K(E,G);ma&&1<X.length&&b&&b.xa&&b.xa.line&&b.xa.line(X,ja,!1);ma=!0;X=v.slice(-1);ja=m.slice(-1);for(F=2;F+1<L.length;F+=2)E=L[F],G=L[F+1],a&&a.lineTo(E,G),K(E,G),X.push(v[v.length-1]),ja.push(m[m.length-1]);Z=E;O=G}break;case "m":if(2<=L.length)for(E+=L[0],G+=L[1],ka=E,la=G,a&&a.moveTo(E,G),K(E,G),ma&&1<X.length&&b&&b.xa&&b.xa.line&&b.xa.line(X,ja,!1),ma=!0,X=v.slice(-1),ja=m.slice(-1),F=2;F+1<L.length;F+=2)E+=L[F],G+=L[F+1],a&&a.lineTo(E,G),K(E,G),X.push(v[v.length-1]),ja.push(m[m.length-
1]);Z=E;O=G;break;case "L":for(F=0;F+1<L.length;F+=2)E=L[F],G=L[F+1],a&&a.lineTo(E,G),K(E,G),X.push(v[v.length-1]),ja.push(m[m.length-1]);Z=E;O=G;break;case "l":for(F=0;F+1<L.length;F+=2)E+=L[F],G+=L[F+1],a&&a.lineTo(E,G),K(E,G),X.push(v[v.length-1]),ja.push(m[m.length-1]);Z=E;O=G;break;case "H":for(F=0;F<L.length;F++)E=L[F],a&&a.lineTo(E,G),K(E,G),X.push(v[v.length-1]),ja.push(m[m.length-1]);Z=E;O=G;break;case "h":for(F=0;F<L.length;F++)E+=L[F],a&&a.lineTo(E,G),K(E,G),X.push(v[v.length-1]),ja.push(m[m.length-
1]);Z=E;O=G;break;case "V":for(F=0;F<L.length;F++)G=L[F],a&&a.lineTo(E,G),K(E,G),X.push(v[v.length-1]),ja.push(m[m.length-1]);Z=E;O=G;break;case "v":for(F=0;F<L.length;F++)G+=L[F],a&&a.lineTo(E,G),K(E,G),X.push(v[v.length-1]),ja.push(m[m.length-1]);Z=E;O=G;break;case "A":for(F=0;F+6<L.length;F+=7){var xa=L[F+5],pd=L[F+6],qd=d(L[F],L[F+1],L[F+2]*Math.PI/180,0!=L[F+3],0==L[F+4],E,G,xa,pd);E=xa;G=pd;K(qd.x,qd.y);K(E,G);ma=!1}Z=E;O=G;break;case "a":for(F=0;F+6<L.length;F+=7)xa=E+L[F+5],pd=G+L[F+6],qd=
d(L[F],L[F+1],L[F+2]*Math.PI/180,0!=L[F+3],0==L[F+4],E,G,xa,pd),E=xa,G=pd,K(qd.x,qd.y),K(E,G),ma=!1;Z=E;O=G;break;case "C":for(F=0;F+5<L.length;F+=6)a&&a.bezierCurveTo(L[F],L[F+1],L[F+2],L[F+3],L[F+4],L[F+5]),E=L[F+4],G=L[F+5],Z=2*E-L[F+2],O=2*G-L[F+3],K(E,G),ma=!1;break;case "c":for(F=0;F+5<L.length;F+=6)a&&a.bezierCurveTo(E+L[F],G+L[F+1],E+L[F+2],G+L[F+3],E+L[F+4],G+L[F+5]),Z=E+2*L[F+4]-L[F+2],O=G+2*L[F+5]-L[F+3],E+=L[F+4],G+=L[F+5],K(E,G),ma=!1;break;case "S":for(F=0;F+3<L.length;F+=4)a&&a.bezierCurveTo(Z,
O,L[F],L[F+1],L[F+2],L[F+3]),E=L[F+2],G=L[F+3],Z=2*E-L[F],O=2*G-L[F+1],K(E,G),ma=!1;break;case "s":for(F=0;F+3<L.length;F+=4)a&&a.bezierCurveTo(Z,O,E+L[F],G+L[F+1],E+L[F+2],G+L[F+3]),Z=E-L[F],O=G-L[F+1],E+=L[F+2],G+=L[F+3],K(E,G),ma=!1;break;case "Q":for(F=0;F+3<L.length;F+=4)a&&a.quadraticCurveTo(L[F],L[F+1],L[F+2],L[F+3]),E=L[F+2],G=L[F+3],Z=2*E-L[F],O=2*G-L[F+1],K(E,G),ma=!1;break;case "q":for(F=0;F+3<L.length;F+=4)a&&a.quadraticCurveTo(E+L[F],G+L[F+1],E+L[F+2],G+L[F+3]),Z=E+2*L[F+2]-L[F],O=G+
2*L[F+3]-L[F+1],E+=L[F+2],G+=L[F+3],K(E,G),ma=!1;break;case "T":for(F=0;F+1<L.length;F+=2)a&&a.quadraticCurveTo(Z,O,L[F],L[F+1]),E=L[F],G=L[F+1],Z=2*E-Z,O=2*G-O,K(E,G),ma=!1;break;case "t":for(F=0;F+1<L.length;F+=2)a&&a.quadraticCurveTo(Z,O,E+L[F],G+L[F+1]),E+=L[F],G+=L[F+1],Z=2*E-Z,O=2*G-O,K(E,G),ma=!1;break;case "Z":case "z":E=ka;G=la;a&&a.closePath();ma&&1<X.length&&b&&b.xa&&b.xa.line&&b.xa.line(X,ja,!0);ma=!0;X=[];ja=[];break;default:throw"unimplemented path command: "+F;}});ma&&1<X.length&&b&&
b.xa&&b.xa.line&&b.xa.line(X,ja,!1)}function N(D){function E(la,X){if(0<X.length){la.splice(0,la.length);for(var ja=0;ja<X.length&&1>ja;ja++){var ma=(X[ja].getAttribute("offset")||"0").trim(),L=/%$/.test(ma)?parseFloat(ma.slice(0,-1))/100:parseFloat(ma),F=X[ja].getAttribute("style");ma={};F&&De(ma,F);isNaN(L)||(F=X[ja].getAttribute("stop-color")||ma["stop-color"]||"#000",Ae.hasOwnProperty(F)&&(F=Ae[F]),ma=(X[ja].getAttribute("stop-opacity")||ma["stop-opacity"]||"1").trim(),ma=/%$/.test(ma)?parseFloat(ma.slice(0,
-1))/100:parseFloat(ma),1!==ma&&(/^#[0-9a-f]{3}$/i.test(F)?F="rgba("+F.slice(1).split("").map(function(xa){return 17*parseInt(xa,16)}).map(function(xa){return xa.toString(10)}).join(",")+","+ma.toFixed(2)+")":/^#[0-9a-f]{6}$/i.test(F)?F="rgba("+[F.slice(1,3),F.slice(3,5),F.slice(5)].map(function(xa){return parseInt(xa,16)}).map(function(xa){return xa.toString(10)}).join(",")+","+ma.toFixed(2)+")":/^rgb(\d+%?(,|\s+)\d+%?(,|\s+)\d+%?)$/i.test(F)?F=F.slice(0,-1).replace(/\s+/g,",")+","+ma.toFixed(2)+
")":/^hsl(\d+%?(,|\s+)\d+%?(,|\s+)\d+%?)$/i.test(F)&&(F=F.slice(0,-1).replace(/\s+/g,",")+","+ma.toFixed(2)+")")),la.push({offset:L,color:F}))}}}function G(la,X){if(la.attributes["xlink:href"]){var ja=la.getAttribute("xlink:href");"#"===ja[0]&&(ja=k.b.getElementById(ja.slice(1)))&&(X=G(ja,X))}X.kd=la.attributes.x1?parseFloat(la.getAttribute("x1")):X.kd||0;X.md=la.attributes.y1?parseFloat(la.getAttribute("y1")):X.md||0;X.ld=la.attributes.x2?parseFloat(la.getAttribute("x2")):X.ld||0;X.nd=la.attributes.y2?
parseFloat(la.getAttribute("y2")):X.nd||0;X.Bc=la.attributes.gradientUnits?la.getAttribute("gradientUnits"):X.Bc||"objectBoundingBox";X.Qb=la.attributes.gradientTransform?la.getAttribute("gradientTransform"):X.Qb||"";X.jb=X.jb||[];E(X.jb,la.getElementsByTagName("stop"));return X}function Z(la,X){if(la.attributes["xlink:href"]){var ja=la.getAttribute("xlink:href");"#"===ja[0]&&(ja=k.b.getElementById(ja.slice(1)))&&(X=Z(ja,X))}X.yc=la.attributes.cx?parseFloat(la.getAttribute("cx")):X.yc||0;X.zc=la.attributes.cy?
parseFloat(la.getAttribute("cy")):X.zc||0;X.r=la.attributes.r?parseFloat(la.getAttribute("r")):X.r||0;X.Bc=la.attributes.gradientUnits?la.getAttribute("gradientUnits"):X.Bc||"objectBoundingBox";X.Qb=la.attributes.gradientTransform?la.getAttribute("gradientTransform"):X.Qb||"";X.jb=X.jb||[];E(X.jb,la.getElementsByTagName("stop"));return X}var O=/^url\(#(.+)\)$/.exec(D);if(O&&O[1]&&(O=k.b.getElementById(O[1])))switch(O.tagName){case "linearGradient":D=G(O,{});if("objectBoundingBox"===D.Bc)throw"objectBoundingBox not supported";
if(D.Qb)throw O=new He,Fe(D.Qb,O),"gradientTransform not supported";var ka=a.createLinearGradient(D.kd,D.md,D.ld,D.nd);for(O=0;O<D.jb.length;O++)ka.addColorStop(D.jb[O].offset,D.jb[O].color);return ka;case "radialGradient":D=Z(O,{});if("objectBoundingBox"===D.Bc)throw"objectBoundingBox not supported";D.Qb&&(O=new He,Fe(D.Qb,O),ka=Ie(O,{x:D.yc,y:D.zc}),O=D.r/Math.sqrt(Math.abs(O.b[0]*O.b[4])),D.yc=ka.x,D.zc=ka.y,D.r=O);ka=a.createRadialGradient(D.yc,D.zc,0,D.yc,D.zc,D.r);for(O=0;O<D.jb.length;O++)ka.addColorStop(D.jb[O].offset,
D.jb[O].color);return ka}return D}function S(D,E,G,Z,O,ka){0>=O||0>=ka?a.rect(D,E,G,Z):(O=Math.min((O+ka)/2,Math.min(G,Z)/2),a.moveTo(D+G-O,E),a.arc(D+G-O,E+O,O,1.5*Math.PI,2*Math.PI),a.lineTo(D+G,E+Z-O),a.arc(D+G-O,E+Z-O,O,0,.5*Math.PI),a.lineTo(D+O,E+Z),a.arc(D+O,E+Z-O,O,.5*Math.PI,Math.PI),a.lineTo(D,E+O),a.arc(D+O,E+O,O,Math.PI,1.5*Math.PI),a.closePath())}function aa(){if(a){var D=(z||"")+";"+(C||""),E={};D&&De(E,D);"hidden"!==E.visibility&&(E.opacity&&(a.globalAlpha*=parseFloat(E.opacity)),E.fill&&
"none"===E.fill||(a.fillStyle="white"===E.fill||"#fff"===E.fill||"#ffffff"===E.fill?"white":N(E.fill)||"none",a.fill()),E.stroke&&"none"!==E.stroke&&(a.lineWidth=I(E["stroke-width"]||"1px",1,100),a.strokeStyle=E.stroke||"none",a.miterLimit=E["stroke-miterlimit"]||4,a.lineJoin=E["stroke-linejoin"]||"miter",a.lineCap=E["stroke-linecap"]||"butt",E["stroke-dasharray"]&&(a.setLineDash(E["stroke-dasharray"].split(" ").map(function(G){return parseFloat(G)})),a.lineDashOffset=E["stroke-dashoffset"]?parseFloat(E["stroke-dashoffset"]):
0),a.stroke()))}}function ha(D,E,G){if(a){var Z=(z||"")+";"+(C||""),O={};Z&&De(O,Z);"hidden"!==O.visibility&&(a.font=(O["font-size"]||"12px")+" "+(O["font-family"]||"helvetica"),O.fill&&"none"!==O.fill&&(a.fillStyle="white"===O.fill||"#fff"===O.fill||"#ffffff"===O.fill?"white":b&&b.fill||"silver",a.fillText(D,E,G)),O.stroke&&"none"!==O.stroke&&(a.strokeStyle=b&&b.stroke||"black",a.strokeText(D,E,G)))}}function J(D,E){D=Je({x:D,y:E});a.save();a.strokeStyle="black";a.lineWidth=1;a.strokeRect(D.Z,D.$,
D.ra-D.Z,D.na-D.$);a.restore()}var B=q.getAttribute("id"),T=B&&b&&b.sd&&b.sd[B];B=B&&b&&b.Xe&&b.Xe[B];a&&a.save();n.save();T&&a&&f(q,T);B&&a&&g(q,B);(function(){var D=(b&&b.pg||"")+";"+(q.getAttribute("style")||""),E=q.getAttribute("class");E&&w.hasOwnProperty(E)&&(D=w[E]+";"+D);z=(z||"")+";"+D;(D=q.getAttribute("fill"))&&(z+=";fill:"+D);(D=q.getAttribute("stroke"))&&(z+=";stroke:"+D);(D=q.getAttribute("stroke-width"))&&(z+="stroke-width:"+D);(D=q.getAttribute("stroke-dasharray"))&&(z+=";stroke-dasharray:"+
D.split(",").join(" "));(D=q.getAttribute("stroke-dashoffset"))&&(z+=";stroke-dashoffset:"+D);(D=q.getAttribute("id"))&&b&&b.style&&b.style.hasOwnProperty(D)&&(C=(C||"")+";"+b.style[D])})();T=v.length;switch(q.tagName){case "svg":n.save();h(q.getAttribute("transform"));y();n.restore();break;case "g":n.save();h(q.getAttribute("transform"));y();n.restore();break;case "path":a&&a.save();n.save();h(q.getAttribute("transform"));M(q.getAttribute("d")||"");aa();a&&a.restore();n.restore();break;case "line":B=
A("x1");var P=A("y1"),Y=A("x2"),x=A("y2");a&&a.save();n.save();h(q.getAttribute("transform"));a&&a.beginPath();a&&a.moveTo(B,P);a&&a.lineTo(Y,x);aa();K(B,P);K(Y,x);b&&b.xa&&b.xa.line&&b.xa.line([B,Y],[P,x],!1);a&&a.restore();n.restore();break;case "polygon":case "polyline":B=q.getAttribute("points").trim().replace(/\s+/g," ").split(" ").map(function(D){return parseFloat(D)});if(4<=B.length){a&&a.save();n.save();h(q.getAttribute("transform"));a&&a.beginPath();a&&a.moveTo(B[0],B[1]);K(B[0],B[1]);for(P=
2;P+1<B.length;P+=2)a&&a.lineTo(B[P],B[P+1]),K(B[P],B[P+1]);"polygon"===q.tagName&&a.closePath();aa();b&&b.xa&&b.xa.line&&b.xa.line(v.slice(-B.length/2),m.slice(-B.length/2),"polygon"===q.tagName);a&&a.restore();n.restore()}break;case "circle":B=A("cx");P=A("cy");Y=A("r");a&&a.save();n.save();h(q.getAttribute("transform"));a&&a.beginPath();a&&a.arc(B,P,Y,0,2*Math.PI);aa();K(B-Y,P-Y);K(B-Y,P+Y);K(B+Y,P-Y);K(B+Y,P+Y);b&&b.xa&&b.xa.We&&(B=v.slice(-4),P=m.slice(-4),Y=(B[3]-B[0])*(B[3]-B[0])+(P[3]-P[0])*
(P[3]-P[0]),x=(B[2]-B[1])*(B[2]-B[1])+(P[2]-P[1])*(P[2]-P[1]),.001>Math.abs(Y-x)/(Y+x)&&.001>((B[3]-B[0])*(B[2]-B[1])+(P[3]-P[0])*(P[2]-P[1]))/Y&&b.xa.We((B[0]+B[2])/2,(P[0]+P[2])/2,Math.sqrt(Y/8)));a&&a.restore();n.restore();break;case "rect":B=A("x");P=A("y");Y=A("width");x=A("height");var R=A("rx"),H=A("ry",R);R=A("rx",H);a&&a.save();n.save();h(q.getAttribute("transform"));a&&(a.beginPath(),0<R||0<H?S(B,P,Y,x,R,H):a.rect(B,P,Y,x));aa();K(B,P);K(B,P+x);K(B+Y,P);K(B+Y,P+x);a&&a.restore();n.restore();
break;case "text":B=A("x"),P=A("y"),a&&a.save(),n.save(),h(q.getAttribute("transform")),ha(q.textContent,B,P),K(B,P),a&&a.restore(),n.restore()}a&&a.restore();n.restore();a&&b&&b.og&&J(v.slice(T),m.slice(T))}function d(q,z,C,y,A,K,I,M,N){if(0===q||0===z)return a&&a.lineTo(M,N),new Ge(M,N);var S=Math.cos(C),aa=Math.sin(C),ha=(S*K+aa*I)/q;I=(-aa*K+S*I)/z;K=(S*M+aa*N)/q;M=(-aa*M+S*N)/z;N=(K-ha)/2;S=(M-I)/2;aa=N*N+S*S;aa=Math.sqrt((1-aa)/aa);isNaN(aa)?aa=0:y===A&&(aa=-aa);y=(ha+K)/2+aa*S;N=(I+M)/2-aa*
N;ha=Math.atan2((I-N)/q,(ha-y)/z);I=Math.atan2((M-N)/q,(K-y)/z);a&&(a.rotate(C),a.scale(q,z),A?a.arc(y,N,1,ha,I,!0):a.arc(y,N,1,ha,I),a.scale(1/q,1/z),a.rotate(-C));K=new He;K.rotate(C);K.scale(q,z);q=A?ha<I?(ha+I)/2+Math.PI:(ha+I)/2:ha<I?(ha+I)/2:(ha+I)/2+Math.PI;return K.apply(new Ge(y+Math.cos(q),N+Math.sin(q)))}function e(q){switch(q.tagName){case "svg":case "defs":for(var z=0;z<q.childElementCount;z++)e(q.children[z]);break;case "style":l+=q.textContent}}function f(q,z){if(z.bb&&0!=z.bb){var C=
z.Vd,y=z.Wd;if(void 0==C||void 0==y)C=k.H(null,{element:q}),q=Je(C),C=(q.Z+q.ra)/2,y=(q.$+q.na)/2;a.translate(C+(z.Hb||0),y+(z.Ib||0));a.rotate(z.bb);a.translate(-C,-y)}else(z.Hb||z.Ib)&&a.translate(z.Hb,z.Ib)}function g(q,z){a.beginPath();a.rect(z.x,z.y,z.Vc,z.Lc);a.clip()}function h(q){Ee(q,function(z,C){a&&a.translate(z,C);n.translate(z,C)},function(z){a&&a.rotate(z);n.rotate(z)},function(z,C){a&&a.scale(z,C);n.scale(z,C)},function(z,C,y,A,K,I){a&&a.transform(z,C,y,A,K,I);n.He(z,C,y,A,K,I)})}var k=
this,l="",w={},n=new Ke,v=[],m=[];e(this.h);(function(){l.split("}").forEach(function(q){var z=q.split("{");z[0].split(",").forEach(function(C){C=C.trim();/^\.[-a-z0-9]+/i.test(C)&&(C=C.slice(1),w[C]=w[C]?w[C]+";"+z[1]:z[1])})})})();var r=this.h;b&&b.Jd?r=this.b.getElementById(b.Jd):b&&b.element&&(r=b.element);if(r){b&&b.gf&&b.gf(a,this.Ca);if(a){for(var u=[],p=r.parentElement;null!=p;p=p.parentElement)u.push(p);for(p=u.length-1;0<=p;p--){var t=u[p].getAttribute("id");(t=t&&b&&b.sd&&b.sd[t])&&f(u[p],
t);t=u[p].getAttribute("transform");h(t)}}c(r)}return{x:v,y:m}};function Je(a){if(0===a.x.length)return{Z:0,ra:0,$:0,na:0};for(var b=a.x[0],c=a.x[0],d=a.y[0],e=a.y[0],f=1;f<a.x.length;f++)b=Math.min(b,a.x[f]),c=Math.max(c,a.x[f]),d=Math.min(d,a.y[f]),e=Math.max(e,a.y[f]);return{Z:b,ra:c,$:d,na:e}}function Le(a,b){if(a.w[b])return a.w[b];var c=a.H(null,{Jd:b});c=Je(c);return a.w[b]=c}ze.prototype.ud=function(a,b,c){a=Le(this,a);return b>=a.Z&&b<=a.ra&&c>=a.$&&c<=a.na};
ze.prototype.qc=function(a){return null!=this.b.getElementById(a)};ze.prototype.If=function(a,b){a=this.b.getElementById(a);b=this.b.getElementById(b);return null!=b&&null!=a&&b.contains(a)};function Me(a){ze.call(this,a);this.m={};this.M={};this.o={};Ne(this)}Me.prototype=Object.create(ze.prototype);Me.prototype.constructor=Me;
function Ne(a){function b(g){switch(g.tagName){case "svg":case "defs":for(var h=0;h<g.childElementCount;h++)b(g.children[h]);break;case "style":f+=g.textContent}}function c(g){return g?(g=g.replace(/\s*\(\s*/g,"(").replace(/\s*\)\s*/g,")").replace(/ +,/g,",").replace(/, +/g,",").replace(/ +/g,","),g.split(")").slice(0,-1).map(function(h){var k=h.split("(")[0];h=h.split("(")[1].split(",").map(function(w){return parseFloat(w)});switch(k){case "translate":return{ab:k,B:[h[0]||0,h[1]||0]};case "rotate":return{ab:k,
B:[(h[0]||0)*Math.PI/180,h[1]||0,h[2]||0]};case "scale":var l=h[0]||1;return{ab:k,B:[l,h[1]||l]};case "matrix":return{ab:k,B:h};default:throw"transform not implemented: "+k;}})):null}function d(g,h){function k(m){for(var r=[],u=0;u<g.childElementCount;u++){var p=d(g.children[u],m);p&&r.push(p)}return r}function l(m,r){m=g.getAttribute(m);return null===m?r||0:parseFloat(m)}function w(m){m=m.replace(/\.([0-9]+)(?=\.)/g,".$1 ").replace(/([.0-9])-/g,"$1 -").replace(/\s*([a-z])\s*/gi,";$1").replace(/\s*,\s*/g,
",").replace(/\s+/g,",");var r=[],u=0,p=0,t=0,q=0,z=0,C=0;m.slice(1).split(";").forEach(function(y){var A=y[0];y=1<y.length?y.slice(1).split(",").map(function(M){return parseFloat(M)}):[];switch(A){case "M":if(2<=y.length){u=y[0];p=y[1];z=u;C=p;r.push({ab:"M",B:[u,p]});for(A=2;A+1<y.length;A+=2)u=y[A],p=y[A+1],r.push({ab:"L",B:[u,p]});t=u;q=p}break;case "m":if(2<=y.length)for(u+=y[0],p+=y[1],z=u,C=p,r.push({ab:"M",B:[u,p]}),A=2;A+1<y.length;A+=2)u+=y[A],p+=y[A+1],r.push({ab:"L",B:[u,p]});t=u;q=p;
break;case "L":for(A=0;A+1<y.length;A+=2)u=y[A],p=y[A+1],r.push({ab:"L",B:[u,p]});t=u;q=p;break;case "l":for(A=0;A+1<y.length;A+=2)u+=y[A],p+=y[A+1],r.push({ab:"L",B:[u,p]});t=u;q=p;break;case "H":for(A=0;A<y.length;A++)u=y[A],r.push({ab:"L",B:[u,p]});t=u;q=p;break;case "h":for(A=0;A<y.length;A++)u+=y[A],r.push({ab:"L",B:[u,p]});t=u;q=p;break;case "V":for(A=0;A<y.length;A++)p=y[A],r.push({ab:"L",B:[u,p]});t=u;q=p;break;case "v":for(A=0;A<y.length;A++)p+=y[A],r.push({ab:"L",B:[u,p]});t=u;q=p;break;
case "A":for(A=0;A+6<y.length;A+=7){var K=y[A+5],I=y[A+6];r.push({ab:"A",B:[y[A],y[A+1],y[A+2]*Math.PI/180,0!=y[A+3]?1:0,0==y[A+4]?1:0,u,p,K,I]});u=K;p=I}t=u;q=p;break;case "a":for(A=0;A+6<y.length;A+=7)K=u+y[A+5],I=p+y[A+6],r.push({ab:"A",B:[y[A],y[A+1],y[A+2]*Math.PI/180,0!=y[A+3],0==y[A+4],u,p,K,I]}),u=K,p=I;t=u;q=p;break;case "C":for(A=0;A+5<y.length;A+=6)r.push({ab:"C",B:y.slice(A,A+6)}),u=y[A+4],p=y[A+5],t=2*u-y[A+2],q=2*p-y[A+3];break;case "c":for(A=0;A+5<y.length;A+=6)r.push({ab:"C",B:[u+
y[A],p+y[A+1],u+y[A+2],p+y[A+3],u+y[A+4],p+y[A+5]]}),t=u+2*y[A+4]-y[A+2],q=p+2*y[A+5]-y[A+3],u+=y[A+4],p+=y[A+5];break;case "S":for(A=0;A+3<y.length;A+=4)r.push({ab:"S",B:[t,q,y[A],y[A+1],y[A+2],y[A+3]]}),u=y[A+2],p=y[A+3],t=2*u-y[A],q=2*p-y[A+1];break;case "s":for(A=0;A+3<y.length;A+=4)r.push({ab:"S",B:[t,q,u+y[A],p+y[A+1],u+y[A+2],p+y[A+3]]}),t=u-y[A],q=p-y[A+1],u+=y[A+2],p+=y[A+3];break;case "Q":for(A=0;A+3<y.length;A+=4)r.push({ab:"Q",B:[y[A],y[A+1],y[A+2],y[A+3]]}),u=y[A+2],p=y[A+3],t=2*u-y[A],
q=2*p-y[A+1];break;case "q":for(A=0;A+3<y.length;A+=4)r.push({ab:"Q",B:[u+y[A],p+y[A+1],u+y[A+2],p+y[A+3]]}),t=u+2*y[A+2]-y[A],q=p+2*y[A+3]-y[A+1],u+=y[A+2],p+=y[A+3];break;case "T":for(A=0;A+1<y.length;A+=2)r.push({ab:"Q",B:[t,q,y[A],y[A+1]]}),u=y[A],p=y[A+1],t=2*u-t,q=2*p-q;break;case "t":for(A=0;A+1<y.length;A+=2)r.push({ab:"Q",B:[t,q,u+y[A],p+y[A+1]]}),u+=y[A],p+=y[A+1],t=2*u-t,q=2*p-q;break;case "Z":case "z":u=z;p=C;r.push({ab:"Z",B:[]});break;default:throw"unimplemented path command: "+A;}});
return r}var n=g.getAttribute("id"),v=function(){var m=g.getAttribute("style")||"",r=g.getAttribute("class");r&&e.o.hasOwnProperty(r)&&(m=e.o[r]+";"+m);r={};De(r,m);(m=g.getAttribute("fill"))&&(r.fill=m);(m=g.getAttribute("stroke"))&&(r.stroke=m);(m=g.getAttribute("stroke-width"))&&(r["stroke-width"]=m);(m=g.getAttribute("stroke-dasharray"))&&(r["stroke-dasharray"]=m.split(","));(m=g.getAttribute("stroke-dashoffset"))&&(r["stroke-dashoffset"]=m);(m=g.getAttribute("id"))&&(r.id=m);return r}();h={name:g.tagName,
id:n,style:v,parent:h};switch(g.tagName){case "svg":h.children=k(h);break;case "g":h.children=k(h);h.transform=c(g.getAttribute("transform"));break;case "path":h.path=w(g.getAttribute("d")||"");h.transform=c(g.getAttribute("transform"));break;case "line":h.kd=l("x1");h.md=l("y1");h.ld=l("x2");h.nd=l("y2");h.transform=c(g.getAttribute("transform"));break;case "polygon":case "polyline":h.rc=g.getAttribute("points").trim().replace(/\s+/g," ").split(" ").map(function(m){return parseFloat(m)});h.transform=
c(g.getAttribute("transform"));break;case "circle":h.x=l("cx");h.y=l("cy");h.r=l("r");h.transform=c(g.getAttribute("transform"));break;case "rect":h.x=l("x");h.y=l("y");h.width=l("width");h.height=l("height");n=l("rx");v=l("ry",n);n=l("rx",v);h.Ig=n;h.Jg=v;h.transform=c(g.getAttribute("transform"));break;case "text":h.x=l("x");h.y=l("y");h.text=g.textContent;h.transform=c(g.getAttribute("transform"));break;default:return null}return h}var e=a,f="";b(a.h);a.o=function(){var g={};f.split("}").forEach(function(h){var k=
h.split("{");k[0].split(",").forEach(function(l){l=l.trim();/^\.[-a-z0-9]+/i.test(l)&&(l=l.slice(1),g[l]=g[l]?g[l]+";"+k[1]:k[1])})});return g}();a.h&&(a.m=d(a.h,null))}function Oe(a,b){function c(e,f){if(e.id===f)return e;if(e.children)for(var g=0;g<e.children.length;g++){var h=c(e.children[g],f);if(h)return h}return null}if(a.M[b])return a.M[b];var d=c(a.m,b);d&&(a.M[b]=d);return d}
function Pe(a,b,c,d,e){a&&a.forEach(function(f){switch(f.ab){case "translate":b(f.B[0],f.B[1]);break;case "rotate":0!==f.B[1]||0!==f.B[2]?(b(-f.B[1],-f.B[2]),c(f.B[0]),b(f.B[1],f.B[2])):c(f.B[0]);break;case "scale":d(f.B[0],f.B[1]);break;case "matrix":e(f.B[0],f.B[1],f.B[2],f.B[3],f.B[4],f.B[5])}})}
Me.prototype.H=function(a,b){function c(r,u,p){function t(){for(var B=0;B<r.children.length;B++)c(r.children[B],u,p)}function q(B,T){B=h.apply(new Ge(B,T));k.push(B.x);l.push(B.y)}function z(B,T,P){if(null==B||""==B)return T;B=/^\s*(-?[0-9.]+)\s*([a-z%]*)\s*$/i.exec(B);T=parseFloat(B[1]);switch(B[2]||"px"){case "pt":return 25.4*T/72*3;case "pc":return 25.4*T/6*3;case "in":return 25.4*T*3;case "mm":return 3*T;case "cm":return 30*T;case "em":return 18*T;case "ex":return 9*T;case "%":return T*P/100;
default:return T}}function C(B){var T=0,P=0,Y=[],x=[],R=!0;a&&a.beginPath();B.forEach(function(H){switch(H.ab){case "M":2<=H.B.length&&(T=H.B[0],P=H.B[1],a&&a.moveTo(T,P),q(T,P),R&&1<Y.length&&b&&b.xa&&b.xa.line&&b.xa.line(Y,x,!1),R=!0,Y=k.slice(-1),x=l.slice(-1));break;case "L":T=H.B[0];P=H.B[1];a&&a.lineTo(T,P);q(T,P);Y.push(k[k.length-1]);x.push(l[l.length-1]);break;case "A":var D=H.B[5],E=H.B[6];var G=H.B[0];var Z=H.B[1],O=H.B[2],ka=0!=H.B[3],la=0!=H.B[4],X=H.B[5],ja=H.B[6],ma=H.B[7],L=H.B[8];
if(0===G||0===Z)a&&a.lineTo(ma,L),G=new Ge(ma,L);else{var F=Math.cos(O),xa=Math.sin(O);H=(F*X+xa*ja)/G;ja=(-xa*X+F*ja)/Z;X=(F*ma+xa*L)/G;ma=(-xa*ma+F*L)/Z;L=(X-H)/2;F=(ma-ja)/2;xa=L*L+F*F;xa=Math.sqrt((1-xa)/xa);isNaN(xa)?xa=0:ka===la&&(xa=-xa);ka=(H+X)/2+xa*F;L=(ja+ma)/2-xa*L;H=Math.atan2((ja-L)/G,(H-ka)/Z);ja=Math.atan2((ma-L)/G,(X-ka)/Z);a&&(a.rotate(O),a.scale(G,Z),la?a.arc(ka,L,1,H,ja,!0):a.arc(ka,L,1,H,ja),a.scale(1/G,1/Z),a.rotate(-O));X=new He;X.rotate(O);X.scale(G,Z);G=la?H<ja?(H+ja)/2+Math.PI:
(H+ja)/2:H<ja?(H+ja)/2:(H+ja)/2+Math.PI;G=X.apply(new Ge(ka+Math.cos(G),L+Math.sin(G)))}T=D;P=E;q(G.x,G.y);q(T,P);R=!1;break;case "C":a&&a.bezierCurveTo(H.B[0],H.B[1],H.B[2],H.B[3],H.B[4],H.B[5]);T=H.B[4];P=H.B[5];q(T,P);R=!1;break;case "S":a&&a.bezierCurveTo(H.B[0],H.B[1],H.B[2],H.B[3],H.B[4],H.B[5]);T=H.B[4];P=H.B[5];q(T,P);R=!1;break;case "Q":a&&a.quadraticCurveTo(H.B[0],H.B[1],H.B[2],H.B[3]);T=H.B[2];P=H.B[3];q(T,P);R=!1;break;case "Z":a&&a.closePath(),R&&1<Y.length&&b&&b.xa&&b.xa.line&&b.xa.line(Y,
x,!0),R=!0,Y=[],x=[]}});R&&1<Y.length&&b&&b.xa&&b.xa.line&&b.xa.line(Y,x,!1)}function y(B){function T(H,D){if(0<D.length){H.splice(0,H.length);for(var E=0;E<D.length&&1>E;E++){var G=(D[E].getAttribute("offset")||"0").trim(),Z=/%$/.test(G)?parseFloat(G.slice(0,-1))/100:parseFloat(G),O=D[E].getAttribute("style");G={};O&&De(G,O);isNaN(Z)||(O=D[E].getAttribute("stop-color")||G["stop-color"]||"#000",Ae.hasOwnProperty(O)&&(O=Ae[O]),G=(D[E].getAttribute("stop-opacity")||G["stop-opacity"]||"1").trim(),G=
/%$/.test(G)?parseFloat(G.slice(0,-1))/100:parseFloat(G),1!==G&&(/^#[0-9a-f]{3}$/i.test(O)?O="rgba("+O.slice(1).split("").map(function(ka){return 17*parseInt(ka,16)}).map(function(ka){return ka.toString(10)}).join(",")+","+G.toFixed(2)+")":/^#[0-9a-f]{6}$/i.test(O)?O="rgba("+[O.slice(1,3),O.slice(3,5),O.slice(5)].map(function(ka){return parseInt(ka,16)}).map(function(ka){return ka.toString(10)}).join(",")+","+G.toFixed(2)+")":/^rgb(\d+%?(,|\s+)\d+%?(,|\s+)\d+%?)$/i.test(O)?O=O.slice(0,-1).replace(/\s+/g,
",")+","+G.toFixed(2)+")":/^hsl(\d+%?(,|\s+)\d+%?(,|\s+)\d+%?)$/i.test(O)&&(O=O.slice(0,-1).replace(/\s+/g,",")+","+G.toFixed(2)+")")),H.push({offset:Z,color:O}))}}}function P(H,D){if(H.attributes["xlink:href"]){var E=H.getAttribute("xlink:href");"#"===E[0]&&(E=g.b.getElementById(E.slice(1)))&&(D=P(E,D))}D.kd=H.attributes.x1?parseFloat(H.getAttribute("x1")):D.kd||0;D.md=H.attributes.y1?parseFloat(H.getAttribute("y1")):D.md||0;D.ld=H.attributes.x2?parseFloat(H.getAttribute("x2")):D.ld||0;D.nd=H.attributes.y2?
parseFloat(H.getAttribute("y2")):D.nd||0;D.Bc=H.attributes.gradientUnits?H.getAttribute("gradientUnits"):D.Bc||"objectBoundingBox";D.Qb=H.attributes.gradientTransform?H.getAttribute("gradientTransform"):D.Qb||"";D.jb=D.jb||[];T(D.jb,H.getElementsByTagName("stop"));return D}function Y(H,D){if(H.attributes["xlink:href"]){var E=H.getAttribute("xlink:href");"#"===E[0]&&(E=g.b.getElementById(E.slice(1)))&&(D=Y(E,D))}D.yc=H.attributes.cx?parseFloat(H.getAttribute("cx")):D.yc||0;D.zc=H.attributes.cy?parseFloat(H.getAttribute("cy")):
D.zc||0;D.r=H.attributes.r?parseFloat(H.getAttribute("r")):D.r||0;D.Bc=H.attributes.gradientUnits?H.getAttribute("gradientUnits"):D.Bc||"objectBoundingBox";D.Qb=H.attributes.gradientTransform?H.getAttribute("gradientTransform"):D.Qb||"";D.jb=D.jb||[];T(D.jb,H.getElementsByTagName("stop"));return D}var x=/^url\(#(.+)\)$/.exec(B);if(x&&x[1]&&(x=g.b.getElementById(x[1])))switch(x.tagName){case "linearGradient":B=P(x,{});if("objectBoundingBox"===B.Bc)throw"objectBoundingBox not supported";if(B.Qb)throw x=
new He,Fe(B.Qb,x),"gradientTransform not supported";var R=a.createLinearGradient(B.kd,B.md,B.ld,B.nd);for(x=0;x<B.jb.length;x++)R.addColorStop(B.jb[x].offset,B.jb[x].color);return R;case "radialGradient":B=Y(x,{});if("objectBoundingBox"===B.Bc)throw"objectBoundingBox not supported";B.Qb&&(x=new He,Fe(B.Qb,x),R=Ie(x,{x:B.yc,y:B.zc}),x=B.r/Math.sqrt(Math.abs(x.b[0]*x.b[4])),B.yc=R.x,B.zc=R.y,B.r=x);R=a.createRadialGradient(B.yc,B.zc,0,B.yc,B.zc,B.r);for(x=0;x<B.jb.length;x++)R.addColorStop(B.jb[x].offset,
B.jb[x].color);return R}return B}function A(B,T,P,Y,x,R){0>=x||0>=R?a.rect(B,T,P,Y):(x=Math.min((x+R)/2,Math.min(P,Y)/2),a.moveTo(B+P-x,T),a.arc(B+P-x,T+x,x,1.5*Math.PI,2*Math.PI),a.lineTo(B+P,T+Y-x),a.arc(B+P-x,T+Y-x,x,0,.5*Math.PI),a.lineTo(B+x,T+Y),a.arc(B+x,T+Y-x,x,.5*Math.PI,Math.PI),a.lineTo(B,T+x),a.arc(B+x,T+x,x,Math.PI,1.5*Math.PI),a.closePath())}function K(){if(a){var B={};u&&Be(B,u);p&&Be(B,p);"hidden"!==B.visibility&&(B.opacity&&(a.globalAlpha*=parseFloat(B.opacity)),B.fill&&"none"===
B.fill||(a.fillStyle="white"===B.fill||"#fff"===B.fill||"#ffffff"===B.fill?"white":y(B.fill)||"none",a.fill()),B.stroke&&"none"!==B.stroke&&(a.lineWidth=z(B["stroke-width"]||"1px",1,100),a.strokeStyle=B.stroke||"none",a.miterLimit=B["stroke-miterlimit"]||4,a.lineJoin=B["stroke-linejoin"]||"miter",a.lineCap=B["stroke-linecap"]||"butt",B["stroke-dasharray"]&&(a.setLineDash(B["stroke-dasharray"].split(" ").map(function(T){return parseFloat(T)})),a.lineDashOffset=B["stroke-dashoffset"]?parseFloat(B["stroke-dashoffset"]):
0),a.stroke()))}}function I(B,T,P){if(a){var Y={};u&&Be(Y,u);p&&Be(Y,p);"hidden"!==Y.visibility&&(a.font=(Y["font-size"]||"12px")+" "+(Y["font-family"]||"helvetica"),Y.fill&&"none"!==Y.fill&&(a.fillStyle="white"===Y.fill||"#fff"===Y.fill||"#ffffff"===Y.fill?"white":b&&b.fill||"silver",a.fillText(B,T,P)),Y.stroke&&"none"!==Y.stroke&&(a.strokeStyle=b&&b.stroke||"black",a.strokeText(B,T,P)))}}function M(B,T){B=Je({x:B,y:T});a.save();a.strokeStyle="black";a.lineWidth=1;a.strokeRect(B.Z,B.$,B.ra-B.Z,B.na-
B.$);a.restore()}var N=r.id&&b&&b.sd&&b.sd[r.id],S=r.id&&b&&b.Xe&&b.Xe[r.id];a&&a.save();h.save();N&&a&&d(r,N);S&&a&&e(S);u=Ce(u);p=Ce(p);r.style&&Be(u,r.style);b&&b.pg&&De(u,b.pg);r.id&&b&&b.style&&b.style.hasOwnProperty(r.id)&&De(p,b.style[r.id]);N=k.length;switch(r.name){case "svg":h.save();f(r.transform);t();h.restore();break;case "g":h.save();f(r.transform);t();h.restore();break;case "path":a&&a.save();h.save();f(r.transform);C(r.path);K();a&&a.restore();h.restore();break;case "line":a&&a.save();
h.save();f(r.transform);a&&a.beginPath();a&&a.moveTo(r.kd,r.md);a&&a.lineTo(r.ld,r.nd);K();q(r.kd,r.md);q(r.ld,r.nd);b&&b.xa&&b.xa.line&&b.xa.line([r.kd,r.ld],[r.md,r.nd],!1);a&&a.restore();h.restore();break;case "polygon":case "polyline":if(4<=r.rc.length){a&&a.save();h.save();f(r.transform);a&&a.beginPath();a&&a.moveTo(r.rc[0],r.rc[1]);q(r.rc[0],r.rc[1]);for(S=2;S+1<r.rc.length;S+=2)a&&a.lineTo(r.rc[S],r.rc[S+1]),q(r.rc[S],r.rc[S+1]);"polygon"===r.name&&a&&a.closePath();K();b&&b.xa&&b.xa.line&&
b.xa.line(k.slice(-r.rc.length/2),l.slice(-r.rc.length/2),"polygon"===r.name);a&&a.restore();h.restore()}break;case "circle":a&&a.save();h.save();f(r.transform);a&&a.beginPath();a&&a.arc(r.x,r.y,r.r,0,2*Math.PI);K();q(r.x-r.r,r.y-r.r);q(r.x-r.r,r.y+r.r);q(r.x+r.r,r.y-r.r);q(r.x+r.r,r.y+r.r);if(b&&b.xa&&b.xa.We){S=k.slice(-4);var aa=l.slice(-4),ha=(S[3]-S[0])*(S[3]-S[0])+(aa[3]-aa[0])*(aa[3]-aa[0]),J=(S[2]-S[1])*(S[2]-S[1])+(aa[2]-aa[1])*(aa[2]-aa[1]);.001>Math.abs(ha-J)/(ha+J)&&.001>((S[3]-S[0])*
(S[2]-S[1])+(aa[3]-aa[0])*(aa[2]-aa[1]))/ha&&b.xa.We((S[0]+S[2])/2,(aa[0]+aa[2])/2,Math.sqrt(ha/8))}a&&a.restore();h.restore();break;case "rect":a&&a.save();h.save();f(r.transform);a&&(a.beginPath(),0<r.Ig||0<r.Jg?A(r.x,r.y,r.width,r.height,r.Ig,r.Jg):a.rect(r.x,r.y,r.width,r.height));K();q(r.x,r.y);q(r.x,r.y+r.height);q(r.x+r.width,r.y);q(r.x+r.width,r.y+r.height);a&&a.restore();h.restore();break;case "text":a&&a.save(),h.save(),f(r.transform),I(r.text,r.x,r.y),q(r.x,r.y),a&&a.restore(),h.restore()}a&&
a.restore();h.restore();a&&b&&b.og&&M(k.slice(N),l.slice(N))}function d(r,u){if(u.bb&&0!=u.bb){var p=u.Vd,t=u.Wd;if(void 0==p||void 0==t)p=g.H(null,{Dc:r}),r=Je(p),p=(r.Z+r.ra)/2,t=(r.$+r.na)/2;a.translate(p+(u.Hb||0),t+(u.Ib||0));a.rotate(u.bb);a.translate(-p,-t)}else(u.Hb||u.Ib)&&a.translate(u.Hb,u.Ib)}function e(r){a.beginPath();a.rect(r.x,r.y,r.Vc,r.Lc);a.clip()}function f(r){Pe(r,function(u,p){a&&a.translate(u,p);h.translate(u,p)},function(u){a&&a.rotate(u);h.rotate(u)},function(u,p){a&&a.scale(u,
p);h.scale(u,p)},function(u,p,t,q,z,C){a&&a.transform(u,p,t,q,z,C);h.He(u,p,t,q,z,C)})}var g=this,h=new Ke,k=[],l=[],w=this.m;b&&b.Jd?w=Oe(this,b.Jd):b&&b.Dc&&(w=b.Dc);if(w){b&&b.gf&&b.gf(a,this.Ca);if(a){for(var n=[],v=w.parentElement;null!=v;v=v.parentElement)n.push(v);for(v=n.length-1;0<=v;v--){var m=n[v].id;(m=m&&b&&b.sd&&b.sd[m])&&d(n[v],m);f(n[v].transform)}}c(w,{},{})}return{x:k,y:l}};
function Qe(a,b){if(a.id===b)return a;if(a.children)for(var c=0;c<a.children.length;c++){var d=Qe(a.children[c],b);if(d)return d}return null}Me.prototype.qc=function(a){return null!=Qe(this.m,a)};Me.prototype.If=function(a,b){var c=Qe(this.m,b);if(null==c)throw"Undefined SVG element id "+b;return null!=Qe(c,a)};function He(a){this.b=a||[1,0,0,0,1,0]}Q=He.prototype;Q.ob=function(){return new He(this.b)};Q.apply=function(a){return new Ge(this.b[0]*a.x+this.b[1]*a.y+this.b[2],this.b[3]*a.x+this.b[4]*a.y+this.b[5])};function Ie(a,b){var c=a.b[0]*a.b[4]-a.b[3]*a.b[1];return new Ge((a.b[4]*b.x-a.b[1]*b.y+a.b[1]*a.b[5]-a.b[4]*a.b[2])/c,(-a.b[3]*b.x+a.b[0]*b.y+a.b[3]*a.b[2]-a.b[0]*a.b[5])/c)}
Q.translate=function(a,b){this.b=[this.b[0],this.b[1],this.b[0]*a+this.b[1]*b+this.b[2],this.b[3],this.b[4],this.b[3]*a+this.b[4]*b+this.b[5]]};Q.scale=function(a,b){this.b=[this.b[0]*a,this.b[1]*b,this.b[2],this.b[3]*a,this.b[4]*b,this.b[5]]};Q.rotate=function(a){var b=Math.cos(a);a=Math.sin(a);this.b=[b*this.b[0]+a*this.b[1],-a*this.b[0]+b*this.b[1],this.b[2],b*this.b[3]+a*this.b[4],-a*this.b[3]+b*this.b[4],this.b[5]]};
Q.He=function(a,b,c,d,e,f){this.b=[a*this.b[0]+c*this.b[1],b*this.b[0]+d*this.b[1],a*this.b[2]+c*this.b[3],b*this.b[2]+d*this.b[3],a*this.b[4]+c*this.b[5]+e,b*this.b[4]+d*this.b[5]+f]};function Ge(a,b){this.x=a||0;this.y=b||0}function Ke(){this.stack=[new He]}Q=Ke.prototype;Q.apply=function(a){return this.stack[this.stack.length-1].apply(a)};Q.save=function(){this.stack.push(this.stack[this.stack.length-1].ob())};Q.restore=function(){if(2>this.stack.length)throw"restore doesn't match save";this.stack.pop()};
Q.translate=function(a,b){this.stack[this.stack.length-1].translate(a,b)};Q.scale=function(a,b){this.stack[this.stack.length-1].scale(a,b)};Q.rotate=function(a){this.stack[this.stack.length-1].rotate(a)};Q.He=function(a,b,c,d,e,f){this.stack[this.stack.length-1].He(a,b,c,d,e,f)};function Re(a){for(var b=0;b<a.draw.length;b++)if(a.draw[b].uri)return a.draw[b].uri;throw"URI not found";}function fc(a){a=a.split("#");return{Jc:a[0],id:a[1]}}function Se(a,b,c){a.J.save();c.gf=function(d,e){this.clientData.$d=e;d.translate(-e[0],-e[1]);d.scale(this.v.j/(e[2]-e[0]),this.v.j/(e[3]-e[1]))}.bind(a);b.H(a.J,c);a.J.restore()}
function Te(a,b,c,d,e){return{x:(a.clientData.$d[2]-a.clientData.$d[0])/d*(b+a.clientData.$d[0]),y:(a.clientData.$d[3]-a.clientData.$d[1])/e*(c+a.clientData.$d[1])}}
function Ue(a,b,c){var d={},e=(a.buttons?a.buttons.length:0)+(a.radiobuttons?1:0);if(void 0!=a.sliders){for(var f=0;f<a.sliders.length;f++){var g=a.sliders[f],h=Le(b,g.id),k=Le(b,g.thumbId),l=(k.Z+k.ra)/2,w=(k.$+k.na)/2;h.ra-h.Z<h.na-h.$?(h.Z=h.ra=(h.Z+h.ra)/2,l=h.Z):(h.$=h.na=(h.$+h.na)/2,w=h.$);k=(c[e+f]-g.min)/(g.max-g.min);d[g.thumbId]={Hb:k*(h.ra-h.Z)-(l-h.Z),Ib:k*(h.$-h.na)-(w-h.na)}}e+=a.sliders.length}if(void 0!=a.rotating)for(f=0;f<a.rotating.length;f++)g=a.rotating[f],k=g.numSteps?2*Math.PI/
g.numSteps:1,h=Le(b,g.centerId),d[g.id]={bb:c[e+f]*k,Vd:(h.Z+h.ra)/2,Wd:(h.$+h.na)/2};return d}function Ve(a,b,c){return Math.min(Math.max((c-a)/(b-a),0),1)}
function We(a,b,c,d,e,f,g,h,k){e=Te(a,k.x-g,k.y-h,e,f);var l=a.clientData.fd.min+(a.clientData.fd.max-a.clientData.fd.min)*Ve(a.clientData.min,a.clientData.max,a.clientData.te?e.y:e.x),w=a.clientData.fd.min,n=a.clientData.fd.max;(e=a.clientData.fd.discrete)&&0<e.length?l=e.reduce(function(v,m){return Math.abs(l-m)<Math.abs(l-v)?m:v},e[0]):(a=a.clientData.fd.snap)&&a.forEach(function(v,m){"string"===typeof v&&/^`.+`$/.test(v)&&(v=ta(v,b.g,m,!0));Math.abs(l-v)<Math.abs(n-w)/10&&(l=v)});b.g[(d.buttons?
d.buttons.length:0)+(d.radiobuttons?1:0)+c]=Math.max(Math.min(w,n),Math.min(Math.max(w,n),l))}
function Xe(a,b,c,d){if(0!==c.draw.length){var e=fc(Re(c)).Jc,f=e?Ue(c,b.ub[e],d.g):{},g=null;if(c.diffwheelmotion&&c.diffwheelmotion.id){g=c.diffwheelmotion;var h=g.id,k=g.dx||0,l=g.dy||0,w=g.adjscale||1,n=g.color||"black",v=void 0===g.linewidth?1:g.linewidth;g=Le(b.ub[e],h);var m=(c.buttons?c.buttons.length:0)+(c.radiobuttons?1:0),r=2.4*d.g[m];m=2.4*d.g[m+1];var u=a.v.j;g=(.5+k)*(g.ra-g.Z)*w/u;k=$d(a,r,m,g,{color:n,Fe:v});f[h]={Hb:-(k.x*g*u+l*u*Math.sin(k.bb)),Ib:-(k.y*g*u+l*u*Math.cos(k.bb)),bb:-k.bb};
g={dh:r,eh:m,jh:g,color:n,Fe:v}}c.draw.forEach(function(p){if(p.uri){var t=fc(p.uri),q=b.ub[t.Jc];t=t.id;for(var z={},C=c.buttons?c.buttons.length:0,y=c.radiobuttons?c.radiobuttons.length:0,A=c.styles?c.styles.length:0,K=0;K<C;K++){var I=c.buttons[K].val,M=c.buttons[K].st;I=I.indexOf(d.g[K]);0<=I&&(z[c.buttons[K].id]=M[I])}for(K=0;K<y;K++)I=c.radiobuttons[K].val,M=c.radiobuttons[K].st,z[c.radiobuttons[K].id]=M[d.g[C]===I?1:0];for(K=0;K<A;K++)z[c.styles[K].id]=ta(c.styles[K].st,d.g);C=b.ub[e];y=d.g;
A={};if(void 0!=c.sliders)for(K=0;K<c.sliders.length;K++){M=c.sliders[K];I=Le(C,M.id);var N=M.lowerPartId&&Le(C,M.lowerPartId);if(N){var S=(y[K]-M.min)/(M.max-M.min),aa=N.ra-N.Z,ha=N.na-N.$;A[M.lowerPartId]=I.ra-I.Z<I.na-I.$?{x:N.Z-ha,y:N.$,Vc:aa+2*ha,Lc:ha*S}:{x:N.Z,y:N.$-ha,Vc:aa*S,Lc:ha+2*aa}}}Se(this,q,{Jd:t,style:z,sd:f,Xe:A,og:!1})}p.js&&(p=new Function("ctx","$",p.js),this.J.save(),this.J.scale(this.v.j/1E3,this.v.j/1E3),this.J.beginPath(),p(this.J,d.g),this.J.restore())},a);g&&$d(a,g.dh,g.eh,
g.jh,{color:g.color,Fe:g.Fe});c.score&&c.score.id&&(h=(c.buttons?c.buttons.length:0)+(c.radiobuttons?1:0)+(c.sliders?c.sliders.length:0),l=c.score,n=l.numHeights||5,g=Le(b.ub[e],l.id),v=b.ub[e].Ca,de(a,d.g.slice(h),(g.Z-v[0])/(v[2]-v[0]),(g.ra-v[0])/(v[2]-v[0]),(g.na-v[1])/(v[3]-v[1]),(g.$-v[1])/(v[3]-v[1]),n,(g.na-g.$)/(v[3]-v[1])/n*(l.noteSize||1),void 0===l.linewidth?1:l.linewidth))}}
function Ye(a,b,c){function d(e){for(var f=0;f<c.length;f++)if(c[f].name===e)return f;return-1}b.forEach(function(e){var f=e.name;if(!f)throw"Missing block name";var g=d(f),h=0<=g?c[g]:null,k=h?h.type:"?";if(e.type||!h)switch(e.type){case "event":k="e";break;case "action":k="a";break;case "state":k="s";break;case "comment":k="c";break;case "hidden":k="h";break;default:throw"Unknown block type "+e.type+" for block "+f;}var l=h?h.la:[];e.modes&&!h&&e.modes.forEach(function(p){switch(p){case "basic":l.push("b");
break;case "advanced":l.push("a");break;default:throw"Unknown block mode "+p;}});var w=h?h.wc:null,n=e.validation;n&&(w=function(p){for(var t=0;t<n.length;t++){var q=n[t].assert;if("string"===typeof q&&/^`.+`$/.test(q)?!ta(q,p.g,void 0,!0):!q)return(p=n[t].warning)?new Ha(p,!0):new Ha(n[t].error||"Error")}});var v=h?h.H:function(p,t){Xe(p,a,e,t)},m=h?h.aa:function(p,t,q,z,C,y,A){a:{var K=fc(Re(e)).Jc,I=0,M=e.buttons;if(M){var N;b:{var S=a.ub[K],aa=Te(p,A.x-C,A.y-y,q,z);for(N=0;N<M.length;N++)if(S.ud(M[N].id,
aa.x,aa.y)){S=M[N].val.indexOf(t.g[N]);0<=S&&(va(t),t.g[N]=M[N].val[(S+1)%M[N].val.length]);break b}N=null}if(null!==N){t=I+N;break a}I+=M.length}if(N=e.radiobuttons){b:{S=a.ub[K];M=M||0;aa=Te(p,A.x-C,A.y-y,q,z);for(var ha=0;ha<N.length;ha++)if(S.ud(N[ha].id,aa.x,aa.y)){va(t);t.g[M]=N[ha].val;N=0;break b}N=null}if(null!==N){t=I+N;break a}I++}if(N=M=e.pushbuttons){b:{N=a.ub[K];S=Te(p,A.x-C,A.y-y,q,z);for(aa=0;aa<M.length;aa++)if(N.ud(M[aa].id,S.x,S.y)){va(t);M=M[aa].newParameters;"string"===typeof M&&
/^`.+`$/.test(M)&&(M=ta(M,t.g,void 0,!0));t.g=M;M=!0;break b}M=null}N=null!==M}if(N)t=-1;else{if(M=e.sliders){b:{N=a.ub[K];S=Te(p,A.x-C,A.y-y,q,z);for(aa=0;aa<M.length;aa++){p.clientData.fd=M[aa];var J=Le(N,p.clientData.fd.id);p.clientData.te=J.ra-J.Z<J.na-J.$;p.clientData.min=p.clientData.te?J.na:J.Z;p.clientData.max=p.clientData.te?J.$:J.ra;ha=(J.Z+J.ra)/2;J=(J.$+J.na)/2;var B=Le(N,p.clientData.fd.thumbId);if(Math.abs((p.clientData.te?S.x:S.y)-(p.clientData.te?ha:J))<(p.clientData.te?B.ra-B.Z:B.na-
B.$)){va(t);N=aa;break b}}N=null}if(null!==N){t=I+N;break a}I+=M.length}if(M=e.rotating){b:{N=a.ub[K];S=t.g.slice(I,I+M.length);aa=Te(p,A.x-C,A.y-y,q,z);for(ha=0;ha<M.length;ha++){J=Le(N,M[ha].centerId);J={x:(J.Z+J.ra)/2,y:(J.$+J.na)/2};var T=M[ha].numSteps?2*Math.PI/M[ha].numSteps:1;B=J.x+(aa.x-J.x)*Math.cos(S[ha]*T)+(aa.y-J.y)*Math.sin(S[ha]*T);T=J.y-(aa.x-J.x)*Math.sin(S[ha]*T)+(aa.y-J.y)*Math.cos(S[ha]*T);if(N.ud(M[ha].thumbId,B,T)){p.clientData.zh=M[ha];p.clientData.jg=J;p.clientData.hh=Math.atan2(T-
J.y,B-J.x);va(t);N=ha;break b}}N=null}if(null!==N){t=I+N;break a}I+=M.length}if(e.score&&(S=a.ub[K],p=(e.buttons?e.buttons.length:0)+(e.radiobuttons?1:0)+(e.sliders?e.sliders.length:0),K=t.g.slice(p).length/2,M=e.score.numHeights||5,N=Le(S,e.score.id),S=S.Ca,(q=te((N.Z-S[0])/(S[2]-S[0]),(N.ra-S[0])/(S[2]-S[0]),(N.na-S[1])/(S[3]-S[1]),(N.$-S[1])/(S[3]-S[1]),K,M,q,z,C,y,A))?(va(t),t.g[p+2*q.index]===q.tone?t.g[p+2*q.index+1]=(t.g[p+2*q.index+1]+1)%3:(t.g[p+2*q.index]=q.tone,t.g[p+2*q.index+1]=1),N=
0):N=null,null!==N)){t=I+N;break a}t=null}}return t},r=h?h.Ra:function(p,t,q,z,C,y,A,K){var I=(e.buttons?e.buttons.length:0)+(e.radiobuttons?1:0),M=e.sliders?e.sliders.length:0;q>=I&&q<I+M?We(p,t,q-I,e,z,C,y,A,K):(I+=M,M=e.rotating?e.rotating.length:0,q>=I&&q<I+M&&(q-=I,z=Te(p,K.x-y,K.y-A,z,C),t.g[(e.buttons?e.buttons.length:0)+(e.radiobuttons?1:0)+(e.sliders?e.sliders.length:0)+q]=Math.round(((Math.atan2(z.y-p.clientData.jg.y,z.x-p.clientData.jg.x)-p.clientData.hh+Math.PI)%(2*Math.PI)-Math.PI)/(e.rotating[q].numSteps?
2*Math.PI/e.rotating[q].numSteps:1))))},u=ye(e,h&&h.Jb);f={name:f,type:k,la:l,ha:h?h.ha:function(){return e.defaultParameters||[]},gb:h?h.gb:function(){return e.typicalParameters||e.defaultParameters||[]},se:h?h.se||null:e.typicalParamSet||null,H:v,Yd:h?h.Yd||!1:e.alwaysZoom||!1,aa:m,Ra:r,Jb:u,wc:w};0<=g?c[g]=new ra(f):c.push(new ra(f))})}
function Ze(a){Rb=function(c,d){return{j:c,ug:void 0===a.styles.minInteractiveBlockSize?60:a.styles.minInteractiveBlockSize,vg:void 0===a.styles.minTouchInteractiveBlockSize?120:a.styles.minTouchInteractiveBlockSize,qg:void 0===a.styles.eventRightAlign?!1:a.styles.eventRightAlign,ja:void 0===a.styles.blockLineWidth?Math.max(1,Math.min(3,c/40)):a.styles.blockLineWidth,yf:Math.round(c/4).toString(10)+"px sans-serif",c:d,ta:void 0===a.styles.controlLineWidth?Math.max(1,Math.min(3,c/40)):a.styles.controlLineWidth,
$g:"bold 15px sans-serif",Bf:a.styles.errorColor||"#f88",bg:a.styles.warningColor||"#f88",background:a.styles.background||"white",Rf:a.styles.ruleMarks||"#bbb",Tf:a.styles.scrollbarThumbColor||"navy",Sf:a.styles.scrollbarBackgroundColor||"#ccc",Sc:a.styles.scrollbarWidth||5}};var b=[];Ye(a,a.blocks||[],b);Za=b};function Ha(a,b){this.w=a;this.Kb=b||!1;this.h=!1;this.m=[];this.b=[];this.o=null}function pb(a,b){a.h=!0;a.m=b}function Ia(a,b){a.h=!0;a.o=b};function Ra(){this.hc=[];this.dd=[]}function $e(a,b){this.state=a;this.b=b||!1}function af(a){a.hc.forEach(function(b){b.b=!1});a.dd.forEach(function(b){b.b=!1})}Ra.prototype.Bb=function(a,b){b&&af(this);this.hc.push(new $e(a,b));20<this.hc.length&&(this.hc=this.hc.slice(-20));this.dd=[]};Ra.prototype.Yf=function(a,b){b&&af(this);return 0<this.hc.length?(this.dd.push(new $e(a,b)),this.hc.pop()):new $e(a,b)};
Ra.prototype.Qf=function(a,b){b&&af(this);return 0<this.dd.length?(this.hc.push(new $e(a,b)),this.dd.pop()):new $e(a,b)};ua.prototype.toDataURL=function(a,b,c){var d=this;switch(this.V.type){case "e":var e=wc(a,{tag:"block",W:["event","html"]});break;case "a":e=wc(a,{tag:"block",W:["action","html"]});break;case "s":e=wc(a,{tag:"block",W:["state","html"]});break;case "c":e=wc(a,{tag:"block",W:["comment","html"]});break;default:throw"internal";}e.width=b.j;e.height=b.j;return(new Nc(this,qc(e),e.qa(),0,0,function(f,g,h,k,l){h=g.x+e.offsetLeft()+h;k=g.y+e.offsetTop()+k;tc(e,f.J,h,k);var w=d.V;g=g.data;var n=e;f.J.save();
f.J.translate(h,k);w.H(f,g,n,l);f.J.restore()})).toDataURL(b,c||1)};function bf(a,b,c,d,e){a=a.toDataURL(b,c,d);c="<img width='"+c.j.toString(10)+"' height='"+c.j.toString(10)+"' src='"+a+"'>";return e?"<a href='"+a+"' download='"+e+"'>"+c+"</a>":c}function cf(a,b,c,d,e){var f=wc(c,{tag:"widget",id:"widget-"+b.replace(/^.*:/g,"")}),g=qc(f),h=f.qa();return{url:(new Nc(null,g,h,0,0,function(k,l,w,n){k.ga=a.ga;Yc(k,b,g/2+w,h/2+n,f)})).toDataURL(d,e||1),width:g,height:h}}
function df(a,b,c,d,e,f){a=cf(a,b,c,d,e);b="<img width='"+a.width.toString(10)+"' height='"+a.height.toString(10)+"' src='"+a.url+"'>";return f?"<a href='"+a.url+"' download='"+f+"'>"+b+"</a>":b}function ef(a,b,c,d,e,f){return{url:(new Nc(null,b,c,0,0,function(g){a(g.J,d,!1)})).toDataURL(e,f||1),width:b,height:c}}
function ic(a,b){var c=Rb(100,100),d=df(a.da,"vpl:then",b,c,5);return"<!DOCTYPE html>\n<html>\n"+(a.R?"<head>\n<style>\n"+a.R+"</style>\n</head>\n":"")+"<body>\n<table class='program'>\n"+a.i.i.map(function(e){return e.Tb()?"":"<tr class='rule'>\n<td class='events'>\n<table class='events'>\n<tr class='events'>\n"+e.U.map(function(f,g){var h="block";switch(f.V.type){case "e":h=h+" event"+(0===g?" event-main":" event-aux");break;case "s":h+=" state";break;case "c":h+=" comment"}return"<td class='"+
h+"'>"+bf(f,b,c,5)+"</td>\n"}).join("")+"</tr>\n</table>\n</td>\n<td class='then'>"+d+"</td>\n<td class='actions'>\n<table class='actions'>\n<tr class='actions'>\n"+e.actions.map(function(f){var g="block";switch(f.V.type){case "a":g+=" action";break;case "c":g+=" comment"}return"<td class='"+g+"'>"+bf(f,b,c,5)+"</td>\n"}).join("")+"</tr>\n</table>\n</td>\n</tr>\n"}).join("")+"</table>\n</body>\n</html>\n"}
function lc(a,b){function c(r,u){return u.controls.map(function(p){return(r.L.find(p.id).cb||[{}]).map(function(t){r.Pb.Ua=!0===t.selected;r.Pb.state=t.state||null;var q=!0===t.selected?"selected":!1===t.selected?"unselected":"";t.state&&(q+=(0<q.length?" ":"")+"="+t.state);t=p.id+(q?"-"+q.replace(/\s+/g,"-").replace("=",""):"")+".png";a:{var z=p.id;for(var C=g[p.id],y=d,A=e,K=0;K<u.controls.length;K++){var I=u.controls[K];if(I.id===z){z=ef(I.H,I.Hc.ra-I.Hc.Z,I.Hc.na-I.Hc.$,C,y,A);break a}}throw"button id not found";
}C="<img width='"+z.width.toString(10)+"' height='"+z.height.toString(10)+"' src='"+z.url+"'>";return"<tr><td>"+(t?"<a href='"+z.url+"' download='"+t+"'>"+C+"</a>":C)+"</td><td>"+p.id+"</td><td>"+q+"</td></tr>\n"}).join("")}).join("")}var d=Rb(100,100),e=5,f=ad(a,b);a.Pb={disabled:!1,T:!0,fh:!1,isEnabled:!0,Ua:!1,state:null};var g=Gc(a,a.ga,["vpl","top"]),h=bd(a,a.ga,["vpl","top"],f.vc,f.Qg,g);g=Object.assign(g,Gc(a,a.M,["vpl","bottom"]));f=bd(a,a.M,["vpl","bottom"],f.Cd,f.Pg,g);a.Oa.forEach(function(r){g[r]=
wc(b,{tag:"button",id:r.replace(/:/g,"-"),W:["src","top"]})},a);var k=ff(a,a.Oa,wc(b,{tag:"toolbar",W:["src","top"]}),wc(b,{tag:"separator",W:["src","top"]}),g);a.za.forEach(function(r){g[r]=wc(b,{tag:"button",id:r.replace(/:/g,"-"),W:["sim","top"]})},a);var l=gf(a,a.za,wc(b,{tag:"toolbar",W:["sim","top"]}),wc(b,{tag:"separator",W:["sim","top"]}),g),w="sim-event:forward sim-event:backward sim-event:left sim-event:right sim-event:center sim-event:clap sim-event:tap".split(" "),n=a.G,v=wc(b,{tag:"button",
W:["sim","event"]}),m=w.map(function(r){return ef(function(u,p,t){(n.gc||vc)(r,u,d,b,["sim","event"],null,!0,!1,t)},v.width,v.height,v,d,e)});h="<!DOCTYPE html>\n<html>\n"+(a.R?"<head>\n<style>\n"+a.R+"</style>\n</head>\n":"")+"<body>\n<table>\n"+Za.map(function(r){var u=null;switch(r.type){case "e":u="event";break;case "s":u="state";break;case "a":u="action";break;case "c":u="comment";break;default:return""}var p=new ua(r,null,null),t="<tr class='"+u+"'>\n<td>\n";r.se?r.se.forEach(function(q,z){p.g=
q;t+=bf(p,b,d,e,r.name.replace(/ /g,"_")+"-"+z.toString(10)+".png")}):(p.g=r.gb?r.gb():p.g,t+=bf(p,b,d,e,r.name.replace(/ /g,"_")+".png"));return t+="</td>\n<td>"+r.name+"</td>\n</tr>\n"}).join("")+"</table>\n<table>\n"+Object.keys(a.da.ga).map(function(r){return"<tr><td>"+df(this.da,r,b,d,e,r+".png")+"</td><td>"+r+"</td></tr>\n"},a).join("")+"</table>\n<table>\n"+c(a,h)+c(a,f)+c(a,k)+c(a,l)+m.map(function(r,u){u=w[u];var p="<img width='"+r.width.toString(10)+"' height='"+r.height.toString(10)+"' src='"+
r.url+"'>",t=u.replace(/ /g,"_")+".png";return"<tr><td><a href='"+(r.url+"' download='"+t+"'>"+p+"</a></td><td>")+u+"</td></tr>\n"})+"</table>\n</body>\n</html>\n";a.Pb=null;return h};function hf(a,b){b=(new DOMParser).parseFromString(b,"text/xml").getElementsByTagName("node");if(1>b.length)throw"empty";b=b[0].getElementsByTagName("program");if(1!==b.length)throw"program";var c="0"!==b[0].getAttribute("advanced_mode");b=b[0].getElementsByTagName("set");$a(a);a.mode=c?"a":"b";for(c=0;c<b.length;c++){var d=jf(b[c],function(){a.Bb()});a.i.push(d)}}
function jf(a,b){a=a.getElementsByTagName("block");for(var c=new Ba,d=0;d<a.length;d++){a:{var e=a[d];e.getAttribute("type");var f=e.getAttribute("name");var g=[];for(var h=[],k=0;1E3>k;k++){var l=e.getAttribute("value"+k);if(null===l)break;g.push(l);h.push(parseFloat(l))}for(k=0;k<sa.length;k++)if(f===sa[k].Ug&&(!sa[k].Ga||ta(sa[k].Ga,sa[k].Ng?g:h,void 0,!0))){e=sa[k].Xg;if(void 0==e){g=null;break a}g=sa[k].parameters?ta(sa[k].parameters,sa[k].Ng?g:h,void 0,!0):null;h=Aa(e);k=new ua(h,null,null);
h.ie?h.ie(k,g):k.g=g;g=k;break a}throw"unknown AESL block "+f;}g&&Ca(c,g,null,b,!0)}return c}
var jc=function(){var a=null;return function(b,c,d){null===a&&(a=document.createElement("a"),document.body.appendChild(a),a.style.display="none");d=d||"application/xml";var e;"function"===typeof window.Blob&&window.URL?e=window.URL.createObjectURL(new window.Blob([b],{type:d})):e="data:"+d+";base64,"+window.btoa(b);var f=a;d=d||"application/xml";var g;"function"===typeof window.Blob&&window.URL?g=window.URL.createObjectURL(new window.Blob([b],{type:d})):g="data:"+d+";base64,"+window.btoa(b);f.href=
g;f.download=c||"untitled.xml";a.click();"string"!==typeof e&&window.URL.revokeObjectURL(e)}}();function kf(){this.vb=document.getElementById("editor");this.vb.value="";this.b=this.vb.parentElement;var a=window.innerWidth,b=window.getComputedStyle(this.vb);this.vb.style.width=a-10-parseInt(b.paddingLeft,10)-parseInt(b.paddingRight,10)+"px";this.vb.style.border="0px";this.vb.style.outline="none";this.vb.style.resize="none";this.vb.style.whiteSpace="pre";this.vb.setAttribute("wrap","off");this.h=null}kf.prototype.qf=function(a,b){this.vb.setSelectionRange(a,b)};
kf.prototype.resize=function(){var a=this.b.getBoundingClientRect().width,b=window.getComputedStyle(this.vb);this.vb.style.width=a-10-parseInt(b.paddingLeft,10)-parseInt(b.paddingRight,10)+"px"};function lf(a,b){a.vb.value=b;window.getComputedStyle(a.vb)};function mf(a,b,c){this.fa=b;this.language=c||"aseba";this.b="";this.Oc=!0;this.hd=this.de=this.$f=null;this.Eb=!1;this.ia=a.ia||new Ja;this.fc=new kf;this.fc.vb.readOnly=this.Oc;this.fc.h=function(f){window.vplBreakpointsFunction&&window.vplBreakpointsFunction(f)};var d=this;this.Ha=new Kb(a.hb,{X:a.X});document.getElementById("editor").addEventListener("input",function(){Yb(a);nf(d)===a.i.fa&&(a.i.fa=!a.i.fa,Mb(a))},!1);var e=document.getElementById("editor");e&&document.getElementById("editor").addEventListener("keydown",
function(f){if(9===f.keyCode){f.preventDefault();f.b=!0;f=e.value;var g=this.selectionStart;f=f.slice(0,g)+"\t"+f.slice(this.selectionEnd);lf(d.fc,f);this.selectionStart=this.selectionEnd=g+1;return!1}return!0},!1)}function of(a,b){a.$f=b}Q=mf.prototype;Q.me=function(){this.ia.b=[]};function Vb(a,b,c){null===b?lf(a.fc,a.b):(a.b=b,lf(a.fc,b));c||(a.hd=null)}Q.$b=function(){return document.getElementById("editor").value.replace(/\s+$/,"")};function nf(a){return a.$b()===a.b.trim()}
Q.qf=function(a,b){this.fc.qf(a,b)};function pf(a){var b=wc(a.Ha.X,{tag:"button",W:["src","top"]});b.height=a.Ha.v.c;a=wc(a.Ha.X,{tag:"toolbar",W:["src","top"]});a.height=b.qa();return{height:a.height,qa:a.qa()}}function ff(a,b,c,d,e){var f=new nc(a.I.Ha);Ec(f,a,b,["src","top"],a.I.gc||vc,a.I.Ne||Bc);pc(f,c,e,d);return f}
function Yb(a){var b=a.I;b.Ha.$a=[];var c=b.Wf||a.Oa,d=Gc(a,c,["src","top"]),e=pf(b).height,f=dd(b.Ha);cd(b.Ha);var g=wc(b.Ha.X,{tag:"view",W:["src"]});wc(b.Ha.X,{tag:"button",W:["src","top"]});var h=wc(b.Ha.X,{tag:"separator",W:["src","top"]}),k=wc(b.Ha.X,{tag:"toolbar",W:["src","top"]});g.tc(f.width);g.ec(f.height);g.setPosition(0,0);k.tc(g.width);k.height=e;k.setPosition(g.x,g.y);sc(b.Ha,function(l){g.H(l)});rc(ff(a,c,k,h,d),k,d);Sb(b.Ha)}
function Tb(a,b){(a.Oc=b)&&lf(a.fc,a.b);a.fc.vb.readOnly=b;Yb(window.vplApp)}
Q.resize=function(a,b){this.Ha.resize(a,b);a=this.Ha.b.getBoundingClientRect();b=document.getElementById("src-editor");var c=dd(this.Ha);var d=wc(this.Ha.X,{tag:"view",W:["src"]});d.tc(c.width);d.ec(c.height);d.setPosition(0,0);var e=pf(this);c=d.x;var f=d.y+e.qa;var g=d.width;d=d.height-e.qa;b.style.left=a.left+a.width*this.Ha.va.Z+c+"px";b.style.width=g+"px";b.style.top=a.top+a.height*this.Ha.va.$+f+"px";b.style.height=d+"px";this.fc.resize();Yb(window.vplApp)};
Q.focus=function(){document.getElementById("editor").focus();Sb(this.Ha)};function qf(a){a.L.add("src:close",{action:function(b){b.fb(["src"],{Ye:!0})},object:a,T:function(b){return 1<b.Aa.length&&0<=b.Aa.indexOf("src")}});a.L.add("src:new",{action:function(b){lf(b.I.fc,"");Sb(b.I.Ha)},isEnabled:function(b){return!b.I.Oc&&0<b.I.$b().length},object:a});a.L.add("src:save",{action:function(b){var c=eb(b.i,{$c:!1,cd:!0});jc(c,b.i.filename||"program.vpl3","application/x-vpl3")},isEnabled:function(b){return 0<b.I.$b().length},object:a});a.L.add("src:vpl",{action:function(b){b.Nd?
b.fb(["vpl"],{Pd:!0}):b.fb(["vpl"],{Ld:"src"})},isEnabled:function(b){return nf(b.I)},object:a,T:function(b){return!b.I.fa&&0>b.Aa.indexOf("vpl")}});a.L.add("src:locked",{action:function(b){Tb(b.I,!b.I.Oc);Sb(b.I.Ha);b.I.Oc&&(b.i.fa=!1,Mb(b))},isEnabled:function(b){return null===b.I.hd},Ua:function(b){return b.I.Oc},object:a,T:function(b){return!b.I.fa},cb:[{selected:!1},{selected:!0}]});a.L.add("src:language",{action:function(b){var c=b.I.$f();b.I.language=c.language;b.I.Oc&&Vb(b.I,c.code)},isEnabled:function(b){return null===
b.I.hd},getState:function(b){return b.I.language},object:a,T:function(b){return null!=b.I.$f},cb:[{state:"aseba"},{state:"l2"},{state:"asm"},{state:"js"},{state:"python"}]});a.L.add("src:disass",{action:function(b){if(null!==b.I.hd)Vb(b.I,b.I.hd),b.I.fc.vb.readOnly=b.I.Oc;else{var c=b.I.$b(),d=b.I.de(b.I.language,c);null!==d&&(Vb(b.I,d,!0),b.I.fc.vb.readOnly=!0,b.I.hd=c)}Yb(b)},isEnabled:function(b){return null!=b.I.de&&null!==b.I.de(b.I.language,"")},Ua:function(b){return null!==b.I.hd},object:a,
T:function(b){return null!==b.I.de},cb:[{selected:!1},{selected:!0}]});a.L.add("src:run",{action:function(b){var c=b.I.$b();b.Ma[b.ya].eb.Zb(c,b.I.language)},isEnabled:function(b){return b.Ma[b.ya].eb.isEnabled(b.I.language)},getState:function(b){return 0===b.I.$b().length?"empty":"canLoad"},object:a,T:function(b){return 0<=b.ya},cb:[{selected:!1},{selected:!0},{state:"empty"},{state:"running"},{state:"error"},{state:"canLoad"},{state:"canReload"}]});a.L.add("src:stop",{action:function(b){ac(b)},
isEnabled:function(b){return bc(b)},object:a,T:function(b){return 0<=b.ya}});a.L.add("src:connected",{isEnabled:function(b){return!b.i.fa&&0<=b.ya&&b.Ma[b.ya].eb.isConnected()},object:a,T:function(b){return 0<b.Ma.length},cb:[{selected:!1},{selected:!0},{selected:!1,state:"monitored"},{selected:!0,state:"monitored"},{selected:!1,state:"nonmonitored"},{selected:!0,state:"nonmonitored"}]});a.L.add("src:sim",{action:function(b){b.Nd?b.fb(["sim"],{Pd:!0}):b.fb(["sim"],{Ld:"src"})},object:a,T:function(b){return null!=
b.Ma.find(function(c){return"sim"===c.name})&&null!=b.G&&0>b.Aa.indexOf("sim")}});a.L.add("src:teacher-reset",{action:function(b){b.I.me();Yb(b)},object:a,Qc:!0,T:function(b){return b.I.Eb&&b.I.ia.Wb}});a.L.add("src:teacher",{action:function(b){b.I.ia.Wb=!b.I.ia.Wb;Yb(b)},Ua:function(b){return b.I.ia.Wb},object:a,Qc:!0,T:function(b){return b.I.Eb},cb:[{selected:!1},{selected:!0}]})};function rf(a){var b=["vpl:message-error","vpl:message-warning"];return function(c,d,e,f,g,h,k,l,w,n){function v(u){if(void 0==u)return!0;for(var p=0;p<u.length;p++)switch(u[p]){case "pressed":if(!w||!k)return!1;break;case "unpressed":if(w&&k)return!1;break;case "selected":if(!l)return!1;break;case "unselected":if(l)return!1;break;case "disabled":if(k)return!1;break;case "enabled":if(!k)return!1;break;default:if("="===u[p][0]&&(n||"").toString()!==u[p].slice(1))return!1}return!0}var m=wc(f,{tag:"button",
W:g,id:c.replace(/:/g,"-")});if(a.buttons)for(var r=0;r<a.buttons.length;r++)if(a.buttons[r].name===c&&v(a.buttons[r].state)){a.buttons[r].draw.forEach(function(u){if(u.uri){var p=fc(u.uri);d.save();u.alpha&&(d.globalAlpha=u.alpha);a.ub[p.Jc].H(d,{Jd:p.id});u.debug&&(d.fillStyle="black",d.textAlign="center",d.textBaseline="middle",d.fillText(u.debug,m.width/2,m.height/2));d.restore()}u.js&&(u=new Function("ctx",u.js),d.save(),d.scale(m.width,m.height),d.beginPath(),u(d),d.restore())});return}0<=b.indexOf(c)?
vc(c,d,e,f,g,h,k,l,w,n):(d.fillStyle="brown",d.fillRect(0,0,m.width,m.height),d.fillStyle="white",d.textAlign="left",d.textBaseline="top",d.font=Math.round(m.height/6).toString(10)+"px sans-serif",d.fillText(c,.02*m.width,.02*m.height),d.fillText((w?"pr ":"")+(l?"sel ":"")+(k?"":"dis"),.02*m.width,.22*m.height),n&&d.fillText("="+n,.02*m.width,.42*m.height))}}
function sf(a){return function(b,c){if(a.buttons)for(var d=0;d<a.buttons.length;d++){var e=a.buttons[d];if(e.name===b&&(void 0==e.state||0>e.state.indexOf("pressed")&&0>e.state.indexOf("selected")&&0>e.state.indexOf("disabled")))return b=fc(e.draw[0].uri),Le(a.ub[b.Jc],b.id)}return{Z:0,ra:c.c,$:0,na:c.c}}}
function tf(a){function b(d){for(var e=0;e<a.widgets.length;e++)if(a.widgets[e].name===d)return a.widgets[e];return null}if(void 0==a.widgets)return{};var c={};["vpl:then","vpl:error","vpl:warning","vpl:moreHigh","vpl:moreLow"].forEach(function(d){var e=b(d);if(e){var f=fc(e.draw[0].uri),g=Le(a.ub[f.Jc],f.id);c[d]=function(h,k,l,w){e.draw.forEach(function(n){if(n.uri){var v=fc(n.uri);n.alpha&&(h.globalAlpha=n.alpha);h.save();var m=Math.min(w.width/(g.ra-g.Z),w.height/(g.na-g.$));h.scale(m,m);h.translate(-(g.Z+
g.ra)/2,-(g.$+g.na)/2);a.ub[v.Jc].H(h,{Jd:v.id});h.restore();n.debug&&(h.fillStyle="black",h.textAlign="center",h.textBaseline="middle",h.fillText(n.debug,0,0))}n.js&&(n=new Function("ctx",n.js),h.save(),h.scale(w.width,w.height),h.beginPath(),n(h),h.restore())})}}});return c};function uf(a){this.w=a&&a.Zb?a.Zb:null;this.m=a&&a.Mc?a.Mc:null;this.o=a&&a.isConnected?a.isConnected:null;this.b=a&&a.isEnabled?a.isEnabled:null;this.h=a&&a.Md?a.Md:null;this.zd=a&&a.zd?a.zd:"aseba";this.languages=a&&a.languages?a.languages:[this.zd];this.state=a&&a.state?a.state:null}Q=uf.prototype;Q.isConnected=function(){return null==this.o||this.o()};Q.isEnabled=function(a){return null!=this.w&&0<=this.languages.indexOf(a)&&(null==this.b||this.b(a))};
Q.Md=function(){return null!=this.h?this.h():null};Q.Mc=function(a){this.m&&this.m(a)};Q.Zb=function(a,b){this.isEnabled(b)&&this.w(b,a)};function Ob(a,b){this.o=a;this.m=document.createElement("div");this.m.style.width="100%";this.m.style.height="100%";this.m.style.position="fixed";this.m.style.top="0";this.m.style.left="0";this.m.style.zIndex="1000";this.m.style.backgroundColor="rgba(1,1,1,0.5)";this.m.style.display="none";this.h=document.createElement("div");this.h.style.width="80%";this.h.style.height="80%";this.h.style.position="fixed";this.h.style.top="50%";this.h.style.left="50%";this.h.style.backgroundColor="white";this.h.style.padding=
"2em";this.m.appendChild(this.h);document.body.appendChild(this.m);this.b=null;if(!b){this.b=document.createElement("div");this.b.style.position="absolute";this.b.style.width="32px";this.b.style.height="32px";this.b.style.top="0";this.b.style.left="0";this.b.textContent="\u00d7";this.b.style.font="bold 30px sans-serif";this.b.style.textAlign="left";this.b.style.padding="5px";this.b.style.paddingLeft="10px";var c=this;this.b.addEventListener("click",function(){c.Cc()},!1)}}
Ob.prototype.show=function(){this.h.innerHTML=this.o;this.b&&this.h.appendChild(this.b);this.m.style.display="block";$b(this)};Ob.prototype.Cc=function(){this.m.style.display="none"};function $b(a){var b=a.h.getBoundingClientRect();a.h.style.marginLeft=-b.width/2+"px";a.h.style.marginTop=-b.height/2+"px"};function hc(a,b,c){try{fb(a.i,b,function(d){if(0>this.Aa.indexOf(d))if(1===this.Aa.length)this.fb([d]);else{var e=this.Aa.slice();e[0<=e.indexOf("vpl")?e.indexOf("vpl"):0<=e.indexOf("src")?e.indexOf("src"):0]=d;this.fb(e)}0<=this.Aa.indexOf("vpl")&&this.da.pa()},c)}catch(d){}}function vf(a){return(a=/^[^.]+\.(.*)$/.exec(a))?a[1].toLowerCase():""}
function kc(a,b){var c=vf(b.name),d=new window.FileReader;switch(c){case "aesl":case "vpl3":case "vpl3ui":case "json":return d.onload=function(e){e=e.target.result;var f=b.name;"<"===e.trim()[0]?hf(a.i,e):hc(a,e,{ng:"vpl3ui"===c});a.i.filename=f;a.da.pa()},d.readAsText(b),!0}return!1}
function wf(a,b){var c=/^[^.]+\.(.*)$/.exec(b.name);c=c?c[1]:"";var d=new window.FileReader;switch(c.toLowerCase()){case "svg":case "png":case "jpg":case "gif":return a.G&&("obstacle"===a.G.mc?(d.onload=function(e){xf(a,e.target.result)},d.readAsText(b)):(d.onload=function(e){e=e.target.result;var f=new Image;f.addEventListener("load",function(){yf(a,f)});f.src=e},d.readAsDataURL(b))),!0}return!1}
function zf(a,b){var c=/^[^.]+\.(.*)$/.exec(b.name);c=c?c[1]:"";var d=new window.FileReader;switch(c.toLowerCase()){case "wav":a.G&&(d.onload=function(e){a.G.Y.setFile(b.name,e.target.result)},d.readAsArrayBuffer(b))}};function Af(a){var b=this;this.b=document.createElement("div");this.b.style.width="100%";this.b.style.height="100%";this.b.style.position="fixed";this.b.style.top="0";this.b.style.left="0";this.b.style.zIndex="1000";this.b.style.backgroundColor="rgba(1,1,1,0.5)";this.b.style.display="none";this.h=document.createElement("div");this.h.style.width="40em";this.h.style.position="fixed";this.h.style.top="50%";this.h.style.left="50%";this.h.style.backgroundColor="white";this.h.style.padding="2em";this.b.appendChild(this.h);
document.body.appendChild(this.b);var c=document.createElement("p");this.w=c;this.h.appendChild(c);c=document.createElement("table");c.style.width="100%";this.h.appendChild(c);var d=document.createElement("tr");c.appendChild(d);var e=document.createElement("td");d.appendChild(e);this.input=document.createElement("input");this.input.setAttribute("type","file");this.input.style.width="35em";e.appendChild(this.input);e=document.createElement("td");e.align="right";d.appendChild(e);d=document.createElement("input");
d.setAttribute("type","button");d.setAttribute("value",a.h.translate("OK"));d.addEventListener("click",function(){var f=b.input.files[0];f&&b.m(f);b.Cc()},!1);e.appendChild(d);e.appendChild(document.createTextNode("\u00a0\u00a0"));d=document.createElement("input");d.setAttribute("type","button");d.setAttribute("value",a.h.translate("Cancel"));d.addEventListener("click",function(){b.Cc()},!1);e.appendChild(d);e=document.createElement("div");e.style.position="absolute";e.style.width="32px";e.style.height=
"32px";e.style.top="0";e.style.left="0";e.textContent="\u00d7";e.style.font="bold 30px sans-serif";e.style.textAlign="left";e.style.padding="5px";e.style.paddingLeft="10px";e.addEventListener("click",function(){b.Cc()},!1);c.appendChild(e);this.o=a.h;this.m=null}
Af.prototype.show=function(a,b,c){this.w.textContent=this.o.translate(a);this.input.setAttribute("accept",b);this.m=c;this.b.style.display="block";a=this.h.getBoundingClientRect();this.h.style.marginLeft=-a.width/2+"px";this.h.style.marginTop=-a.height/2+"px"};Af.prototype.Cc=function(){this.b.style.display="none"};function Bf(a,b,c){this.b=a;this.w=b;this.h=null;this.o=!1;this.m=c;var d=this;setInterval(function(){null!=d.h&&2<=d.h.readyState&&(!1!==d.b.Me&&(d.b.Me=!1,Mb(d.b)),d.connect())},5E3)}
Bf.prototype.connect=function(){var a=this;this.h=new WebSocket(this.w);this.h.addEventListener("open",function(){a.b.Me=!0;a.h.send(JSON.stringify({sender:{type:"vpl",sessionid:a.m,role:a.b.i.Eb?"teacher":"student"},type:"hello"}));window.addEventListener("unload",function(){a.h.send(JSON.stringify({sender:{type:"vpl",sessionid:a.m,role:a.b.i.Eb?"teacher":"student"},type:"bye"}))});Mb(a.b)});this.h.addEventListener("message",function(b){try{var c=JSON.parse(b.data);switch(c.type){case "cmd":var d=
c.data.cmd,e=c.data.selected,f=c.data.state,g=a.b.L;if(g.T(d)&&Db(g,d)&&g.isEnabled(d))if(void 0!==e){var h=g.find(d),k;if(k=h)h.h?e===h.Ua()?k=!0:(Fb(h,void 0),k=e===h.Ua()):k=!1;k&&Eb(g,d)}else if(void 0!==f){var l=g.find(d);l&&Gb(l,f)&&Eb(g,d)}else{var w=g.find(d);w&&(Fb(w,void 0),Eb(g,d))}Wd(a.b.da);break;case "file":var n=c.data.content;switch(c.data.kind){case "vpl":var v=vf(c.data.name||"");/^[\s]*{/.test(n)?hc(a.b,n,{ng:"vpl3ui"===v}):(hf(a.b.i,n),a.b.da.pa());a.b.i.filename=c.data.name||
null;Wd(a.b.da);break;case "about":Nb(a.b,n);break;case "help":Pb(a.b,n);break;case "suspend":var m=a.b,r=m.uc;r&&m.Td&&m.Td.Cc();m.Td=n?new Ob(n,!0):null;n&&r&&m.Td.show()}}}catch(u){console.info(u)}});this.o||(cc(this.b,function(b){a.log(b)}),this.o=!0)};
Bf.prototype.log=function(a){try{if("cmd"===a.type&&a.data&&0<=["vpl:run"].indexOf(a.data.cmd)){var b=eb(this.b.i,{$c:!1,cd:!0});this.h.send(JSON.stringify({sender:{type:"vpl",sessionid:this.m},type:"file",data:{name:this.b.i.filename,content:b}}))}this.h.send(JSON.stringify({sender:{type:"vpl",sessionid:this.m},type:"log",data:a||null}))}catch(c){}};var Nd=null;document.addEventListener("mousemove",function(a){null!==Nd&&(Nd(a,!1,!1),a.preventDefault())},!1);document.addEventListener("mouseup",function(a){null!==Nd&&(Nd(a,!0,!1),Nd=null,a.preventDefault())},!1);var Td=null;document.addEventListener("touchmove",function(a){a.preventDefault();null!==Nd&&(Td=a.targetTouches[0],Nd(Td,!1,!0));return!1},{capture:!1,passive:!1});document.addEventListener("touchend",function(a){null!==Nd&&(Nd(Td,!0,!0),Nd=null,a.preventDefault());return!1},!1);
function Cf(a,b,c,d,e){var f=0<=a.indexOf("/")?a.replace(/\/[^/]*$/,"/"):"",g={},h=new XMLHttpRequest;h.addEventListener("load",function(){if(200===h.status){g[a]=h.responseText;var k=JSON.parse(h.responseText),l=c(k),w=l.length,n=!1;l.forEach(function(v){var m=new XMLHttpRequest;m.addEventListener("load",function(){200===m.status?(g[v]=m.responseText,w--,n||0!==w||d(k,g)):n||(n=!0,e("HTTP error "+m.status))});m.addEventListener("error",function(){n||(n=!0,e("XMLHttpRequest error for "+a))});m.open("GET",
f+v);m.send()})}else e("HTTP error "+h.status)});h.addEventListener("error",e);h.open("GET",a);h.send()}
function Df(a,b,c,d,e){try{var f=document.getElementById(a).textContent,g=JSON.parse(f),h={};g.svgFilenames&&g.svgFilenames.forEach(function(k){f=document.getElementById(k).textContent;h[k]=f});g.overlays&&g.overlays.forEach(function(k){f=document.getElementById(k).textContent;h[k]=f});g.css&&g.css.forEach(function(k){f=document.getElementById(k).textContent.trim();h[k]=f});d(g,h)}catch(k){e(k)}}
function Ef(a){var b=/^[^?]*\?([^#]*)/.exec(document.location.href);if(b=b&&b[1]){b=b.split("&").map(function(d){return d.split("=").map(function(e){return decodeURIComponent(e)})});for(var c=0;c<b.length;c++)if(b[c][0]===a)return b[c][1]}return""}function Ff(a){return(document.location.hash||"#").slice(1).split("&").map(function(b){return b.split("=").map(decodeURIComponent)}).reduce(function(b,c){b[c[0]]=c[1];return b},{})[a]||null}
function Gf(a,b){var c=[];a&&a.overlays&&a.overlays.forEach(function(I){try{var M=JSON.parse(a.Ke[I])}catch(ha){console.error(ha.message)}for(var N in M)if(M.hasOwnProperty(N))switch(N){case "blocks":case "aeslImportRules":case "buttons":case "widgets":a[N]=a[N]?a[N].concat(M[N]):M[N];break;case "toolbars":for(var S in M[N])M[N].hasOwnProperty(S)&&(a[N]=a[N]||{},a[N][S]=M[N][S]);break;case "i18n":for(S in M[N])if(M[N].hasOwnProperty(S)){a[N]=a[N]||{};a[N][S]=a[N][S]||{};for(var aa in M[N][S])M[N][S].hasOwnProperty(aa)&&
(a[N][S][aa]=M[N][S][aa])}break;case "help":c.push(M[N])}});var d=document.getElementById("programCanvas"),e=Ef("role"),f=new Hb(d);f.Tc=void 0==window.vplSimMaps?"ground,height,obstacles":"merged"===window.vplSimMaps?null:window.vplSimMaps.split(",");window.vplApp=f;f.username=Ef("user")||window.vplUsername||f.username;a&&ec&&(f.i.message=ec(a),f.i.message&&window.console.info(f.i.message));a&&a.css&&(a.css.forEach(function(I){jd(f.X,I,a.Ke[I])}),f.X.defineProperties());if(a&&a.i18n)for(var g in a.i18n)a.i18n.hasOwnProperty(g)&&
Ma(f.h,g,a.i18n[g]);d=Ef("uilanguage")||"en";f.h.language=d;f.Ge=new Af(f);var h=void 0==a||a["hardcoded-gui"]||"classic"===Ef("appearance");f.ag="local"===Ef("storage");f.Nd="false"!==Ef("multiview");var k=Ef("language");Kd="true"===Ef("cssdebug");var l=vc,w=Bc,n=Ic;if(a){if(h)null!==a.blocks&&0<a.blocks.length&&(a.blocks||[]).forEach(function(I){var M=Aa(I.name);ye(I,M.Jb);I.typicalParamSet&&(M.se=I.typicalParamSet)});else if(null!==a.buttons&&0<a.buttons.length&&(l=rf(a),w=sf(a)),null!==a.widgets&&
0<a.widgets.length&&(n=tf(a)),null!==a.blocks&&0<a.blocks.length)try{Ze(a)}catch(I){window.console&&window.console.error(I)}a.aeslImportRules&&0<a.aeslImportRules.length&&(sa=a.aeslImportRules.map(function(I){return{Ug:I.aeslName,Ga:I.condition||null,Xg:I.blockName,parameters:I.parameters||null,Ng:I.stringParam||!1}}));a.miscSettings&&void 0!=a.miscSettings.basicMultiEvent&&(Ta=1==a.miscSettings.basicMultiEvent);a.miscSettings&&void 0!=a.miscSettings.advancedMultiEvent&&(Va=1==a.miscSettings.advancedMultiEvent);
a.miscSettings&&a.miscSettings.viewRelativeSizes&&(d=a.miscSettings.viewRelativeSizes,f.kc={vpl:d.vpl||1,src:d.src||1,sim:d.sim||1})}d=Ef("server");g=Ef("session");var v="true"===Ef("adv"),m="true"===Ef("exp"),r=0,u=0,p="",t=Ef("blur").trim()||"";/^\d+$/.test(t)&&(r=parseInt(t,10)/10);t=Ef("grayscale")||"";/^\d+$/.test(t)&&(u=parseInt(t,10)/100);if(0<r||0<u)p="blur("+r.toFixed(1)+"px) grayscale("+u.toFixed(2)+")";r=1;u=0;t=!1;var q=null;t=Ef("scale").trim()||"";/^\d+(\.\d*)?$/.test(t)&&(r=parseFloat(t));
t=Ef("rotation").trim()||"";/^-?\d+(\.\d*)?$/.test(t)&&(u=parseFloat(t)*Math.PI/180);t=Ef("mirror").trim()||"";t="true"===t;if(1!==r||0!==u||t)q=[r*Math.cos(u)*(t?-1:1),r*Math.sin(u)*(t?-1:1),-r*Math.sin(u),r*Math.cos(u),0,0];k||(k=0<=f.ya?f.Ma[f.ya].eb.zd:"aseba");Wa();$a(f.i,!0);f.i.me();r=Ef("view");t=0===r.length?["vpl"]:r.split("+");u=Ef("robot");if(0<=t.indexOf("sim")||"sim"===u)u="sim";u.replace(/[+;]/g,",").split(",").forEach(function(I){var M=null;switch(I){case "thymio":M=Hf(f);M.Mc(k);
break;case "thymio-tdm":M=If(f);M.Mc(k);break;case "thymio-jws":M=Jf(f);M.Mc(k);break;case "sim":M=Kf(f,{kg:p,lg:q}),M.Mc(k)}M&&f.Ma.push({name:I,eb:M})});f.ya=0<f.Ma.length?0:-1;if(!wa[k])throw"Unsupported language "+k;Ka(f.ia,v?[]:["src:language"]);f.i.Cb=k;f.da.ga=n;f.i.i.push(new Ba);null!=f.b&&(f.b.ga=n);gc(f);!h&&a&&a.toolbars&&(a.toolbars.vpl&&(f.ga=a.toolbars.vpl),a.toolbars.vpl2&&(f.M=a.toolbars.vpl2));f.i.gc=l;f.i.Ne=w;mf&&document.getElementById("editor")&&(f.I=new mf(f,f.i.fa,k),Ud(f.I.Ha,
p),f.i.o=function(){return nf(f.I)?null:f.I.$b()},f.i.w=function(I){Vb(f.I,I)},f.I.Ha.ga=n,qf(f),!h&&a&&a.toolbars&&a.toolbars.editor&&(f.I.Wf=a.toolbars.editor),f.I.gc=l,f.I.Ne=w,f.I.Eb="teacher"===e);null!=f.G&&(Lf(f),!h&&a&&a.toolbars&&a.toolbars.simulator&&(f.G.Wf=a.toolbars.simulator),f.G.gc=l,f.G.Ne=w);p&&Ud(f.da,p);Vd(f.da,q);document.getElementsByTagName("body")[0].addEventListener("dragover",function(I){I.stopPropagation();I.preventDefault();I.dataTransfer.dropEffect="copy"},!1);document.getElementsByTagName("body")[0].addEventListener("drop",
function(I){I.stopPropagation();I.preventDefault();I=I.dataTransfer.files;1===I.length&&(I=I[0],kc(f,I)||wf(f,I)||zf(f,I))},!1);if(f.G){f.G.ia=f.ia;var z=new Image;z.addEventListener("load",function(){f.G.Ze=z});z.src="data:image/svg+xml;base64,"+btoa('<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="297mm" height="210mm" viewBox="0 0 1052 744" version="1.1"><defs><linearGradient id="gradient" x1="-1000" y1="0" x2="-800" y2="0" gradientUnits="userSpaceOnUse"><stop style="stop-color:#000;stop-opacity:1;" offset="0" /><stop style="stop-color:#000;stop-opacity:0;" offset="1" /></linearGradient></defs><g transform="translate(0,-308)"><rect style="fill:url(#gradient);stroke:none" width="319" height="687" x="-1027" y="336" transform="scale(-1,1)" /><path style="fill:none;stroke:#000;stroke-width:30;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none" d="M 114,592 C 102,417 750,306 778,532 806,757 674,675 559,622 444,568 259,567 278,664 296,762 726,730 778,808 829,887 725,955 616,936 507,917 144,1083 129,837 Z" /></g></svg>');
var C=new Image;C.addEventListener("load",function(){f.G.$e=C});C.src="data:image/svg+xml;base64,"+btoa('<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" width="297mm" height="210mm" viewBox="0 0 1052 744" version="1.1"><defs><radialGradient id="gradient" cx="400" cy="650" fx="400" fy="650" r="230" gradientTransform="matrix(1.6,0,0,1.16,-113,-75)" gradientUnits="userSpaceOnUse"><stop style="stop-color:#000;stop-opacity:1;" offset="0" /><stop style="stop-color:#000;stop-opacity:0;" offset="1" /></radialGradient></defs><g transform="translate(0,-308)"><rect style="fill:url(#gradient);fill-opacity:1;stroke:none" width="939" height="650" x="54" y="357" /></g></svg>');
f.G.af='<?xml version="1.0" encoding="UTF-8"?><svg xmlns="http://www.w3.org/2000/svg" width="297mm" height="210mm" viewBox="0 0 1052 744" version="1.1"><g transform="translate(0,-308)"><path style="fill:none;stroke:#000;stroke-width:6;stroke-linecap:butt;stroke-linejoin:miter" d="M 172,928 137,420 763,371 905,688 708,981 Z" /><path style="fill:none;stroke:#949494;stroke-width:6;stroke-linecap:butt;stroke-linejoin:miter" d="m 402,754 168,91 101,-142" /><circle style="fill:none;stroke:#000;stroke-width:6" cx="531" cy="550" r="59" /></g></svg>'}if(window.vplStorageGetFunction)window.vplStorageGetFunction("program.vpl3",
function(I,M){try{I&&(fb(f.i,I,function(){Mb(f)}),f.i.filename=M&&M.filename||"program.vpl3",f.i.readOnly=void 0!=M&&1==M.readOnly,void 0!=M&&1==M.customizationMode&&(f.ia.xb=!0,f.ia.Wb="t"===e))}catch(N){}});else if(f.ag)try{var y=window.localStorage.getItem("program.vpl3");y&&fb(f.i,y,function(){Mb(f)})}catch(I){}"text"===Ef("view")?f.fb(["src"],{fa:!0}):(f.fb(["vpl"]),f.i.rg=m,f.i.Eb="teacher"===e?"t":"teacher1"===e?"custb":Qa,Mb(f),f.I&&(document.getElementById("editor").textContent=f.i.$b(f.i.Cb)));
var A=["aseba","l2","asm","js","python"];f.I&&0<=A.indexOf(k)&&of(f.I,function(){k=A[(A.indexOf(k)+1)%A.length];f.i.Cb=k;var I=f.i.$b(k);return{language:k,code:I}});if(v&&f.I){var K=new vb(wb);f.I.de=function(I,M){try{switch(I){case "aseba":var N=new xb(K,M);N.ga=yb;var S=zb(N);return Mf(M,S,N.Vb);case "l2":return N=new Nf(K,M),N.ga=Of,S=zb(N),Mf(M,S,N.Vb);case "asm":return S=Pf(new Qf(K,M)),Ab(S);default:return null}}catch(aa){return"; "+aa}}}a&&a.fragments&&a.fragments["about.html"]&&Nb(f,a.fragments["about.html"].replace(/UIROOT/g,
b));a&&a.fragments&&a.fragments["help.html"]&&Pb(f,a.fragments["help.html"].replace(/UIROOT/g,b));if(a&&a.help||0<c.length)f.w=new Na,a&&a.help&&f.w.add(a.help),c.forEach(function(I){f.w.add(I)}),Qb(f);a&&a.fragments&&a.fragments["vpl-export-html.css"]&&(f.R=a.fragments["vpl-export-html.css"]);Xb(f);Wd(f.da);window.addEventListener("resize",function(){Xb(f)},!1);f.G&&(f.G.Eb="teacher"===e);if("text"===r)f.fb(["src"],{fa:!0});else{b=["vpl","src","sim"];if(1>t.length||3<t.length||""===r)r="vpl";else for(y=
0;y<t.length;y++){if(0>!b.indexOf(t[y])){r="vpl";break}for(h=0;h<y;h++)if(t[y]===t[h]){r="vpl";break}}f.fb(t)}Xb(f);d&&(window.vplCommandServer=new Bf(f,d,g),window.vplCommandServer.connect())}
window.addEventListener("load",function(){var a=Ef("ui")||"ui.json",b=null!=document.getElementById(a),c=window.vplUIRoot?window.vplUIRoot:b?".":0<=a.indexOf("/")?a.replace(/\/[^/]*$/,""):".";(b?Df:Cf)(a,c,function(d){return(d.svgFilenames||[]).concat(d.overlays||[]).concat(d.css||[])},function(d,e){d.Ke={};d.ub={};d.svgFilenames&&d.svgFilenames.forEach(function(f){d.Ke[f]=e[f];d.ub[f]=new Me(e[f])});d.overlays&&d.overlays.forEach(function(f){d.Ke[f]=e[f]});d.css&&d.css.forEach(function(f){d.Ke[f]=
e[f]});Gf(d,c)},function(d){window.console&&window.console.error(d);Gf()})},!1);window.vplIsProgramChanged=function(){return 0<window.vplApp.i.Uc.hc.length};window.vplGetProgramAsJSON=function(a){return eb(window.vplApp.i,a?{$c:!0,cd:!1}:void 0)};window.vplGetUIAsJSON=function(){return eb(window.vplApp.i,{$c:!0,cd:!1})};
window.addEventListener("unload",function(){var a=eb(window.vplApp.i);try{window.vplStorageSetFunction?window.vplStorageSetFunction("program.vpl3",a):window.vplApp.ag&&window.localStorage.setItem("program.vpl3",a)}catch(b){}},!1);function Rf(){this.Ad=1}Rf.prototype.reset=function(){};Rf.prototype.resetEventListeners=function(){};Rf.prototype.set=function(){};Rf.prototype.get=function(){return null};Rf.prototype.setClientState=function(){};Rf.prototype.getClientState=function(){return null};Rf.prototype.addEventListener=function(){};Rf.prototype.sendEvent=function(){};Rf.prototype.start=function(){this.sendEvent("init",null)};Rf.prototype.setTimer=function(){};Rf.prototype.getTimer=function(){return-1};
Rf.prototype.loadCode=function(){};Rf.prototype.shouldRunContinuously=function(){return!1};Rf.prototype.run=function(){};Rf.prototype.suspend=function(){};Rf.prototype.resume=function(){};function Sf(){this.Ad=1;this.Oa={Z:-Infinity,ra:Infinity,$:-Infinity,na:Infinity};this.w=this.R=0;this.r=70;this.b=[0,0];this.h=0;this.hf=!1;this.files={};this.qb=120;this.kc=80;this.Xd=20;this.state={};this.ga={};this.hb=null;this.Ed={};this.o=[];this.za={};this.Wc=!1;this.M=null;Sf.prototype.reset.call(this,0);Sf.prototype.resetEventListeners.call(this)}Sf.prototype=Object.create(Rf.prototype);Sf.prototype.constructor=Sf;Sf.prototype.setPositionLimits=function(a,b,c,d){this.Oa={Z:a,ra:b,$:c,na:d}};
Sf.prototype.setFile=function(a,b){this.files[a]=b};
Sf.prototype.reset=function(a){this.w=this.R=a;this.b=[0,0];this.h=0;this.state={"button.center":!1,"button.left":!1,"button.right":!1,"button.forward":!1,"button.backward":!1,"prox.ground.delta":[1,1],"prox.horizontal":[0,0,0,0,0,0,0],acc:[0,0,1],"motor.left":0,"motor.right":0,"leds.top":[0,0,0],"leds.bottom.left":[0,0,0],"leds.bottom.right":[0,0,0],"leds.circle":[0,0,0,0,0,0,0,0],sound:{}};this.Wc=!1;var b=this;this.ga={"leds.circle":function(){b.Wc=!0},sound:function(c,d){function e(){if(!(g>=
d.f.length)){b.M||(b.M=new (window.AudioContext||window.webkitAudioContext));var h=b.M.createOscillator();h.type="sawtooth";h.frequency.value=d.f[g];var k=b.M.createGain();k.connect(b.M.destination);h.connect(k);h.start(0);var l=d.d[g]/50;k.gain.exponentialRampToValueAtTime(.01,b.M.currentTime+l);h.stop(b.M.currentTime+l);h.addEventListener("ended",e);g++}}if(d.hasOwnProperty("pcm")){if(c=b.files["P"+d.pcm+".wav"]){b.M||(b.M=new (window.AudioContext||window.webkitAudioContext));var f=b.M;f.decodeAudioData(c.slice(),
function(h){var k=f.createBufferSource();k.buffer=h;k.connect(f.destination);k.start(0)})}}else if(d.f){var g=0;e()}}};this.o=[];this.uc=!1};Sf.prototype.resetEventListeners=function(){this.za={}};Sf.prototype.enforcePositionLimits=function(){this.b=[Math.max(this.Oa.Z,Math.min(this.Oa.ra,this.b[0])),Math.max(this.Oa.$,Math.min(this.Oa.na,this.b[1]))]};Sf.prototype.setPosition=function(a,b){this.b=a;this.h=b;this.enforcePositionLimits();this.hb&&this.hb.call(this)};
Sf.prototype.set=function(a,b){this.state[a]=b;this.ga[a]&&this.ga[a](a,b)};Sf.prototype.get=function(a){return this.state[a]};Sf.prototype.setClientState=function(a,b){this.Ed[a]=b};Sf.prototype.getClientState=function(a){a=this.Ed[a];a instanceof Array&&(a=a.slice());return a};Sf.prototype.addEventListener=function(a,b){this.za[a]=b};Sf.prototype.sendEvent=function(a,b){this.za[a]&&this.za[a].call(this,a,b);for(var c in this.za)if(0===c.indexOf(a+"."))this.za[c](a,b)};
Sf.prototype.setTimer=function(a,b,c){this.o[a]={next:this.w-this.R+b,zg:c?b:-1}};Sf.prototype.getTimer=function(a){return void 0===this.o[a]||0>this.o[a].next?-1:this.R+this.o[a]-this.w};Sf.prototype.loadCode=function(a,b){if("js"!==a)throw"unsupported language "+a;(new Function(b)).call(this)};
Sf.prototype.shouldRunContinuously=function(){if(this.uc)return!1;if(0!==this.get("motor.left")||0!==this.get("motor.right"))return!0;for(var a=0;a<this.o.length;a++)if(this.o[a]&&0<this.o[a].next)return!0;return!1};function Tf(a,b){return a.hf?b*Math.sqrt(-2*Math.log(Math.random()))*Math.sin(2*Math.PI*Math.random()):0}
Sf.prototype.run=function(a,b){0===this.R&&this.reset(a);1!==this.Ad&&(this.R-=(this.Ad-1)*(a-this.w),this.w=this.Ad*(this.w-a)+a);for(var c=Math.max(.01,(a-this.w)/10),d=this.b;!this.uc&&this.w<a;){c=Math.min(c,a-this.w);var e=(100*this.get("motor.left")+Tf(this,1))*c,f=(100*this.get("motor.right")+Tf(this,1))*c;if(0!==e||0!=f){if(1E-6>Math.abs(e-f)||Math.abs(e-f)<1E-4*(Math.abs(e)+Math.abs(f)))this.b=[this.b[0]+.5*(e+f)*Math.cos(this.h),this.b[1]+.5*(e+f)*Math.sin(this.h)];else{var g=(e+f)*this.r/
(e-f);e=(f-e)/(2*this.r);this.b=[this.b[0]+g*(Math.sin(this.h)-Math.sin(this.h+e)),this.b[1]-g*(Math.cos(this.h)-Math.cos(this.h+e))];this.h+=e}this.enforcePositionLimits();this.hb&&this.hb.call(this)}this.w+=c;this.sendEvent("prox",null);for(g=0;g<this.o.length;g++)this.o[g]&&0<this.o[g].next&&this.w>=this.R+this.o[g].next+Tf(this,.01)&&(this.o[g].next=0<=this.o[g].zg?this.o[g].next+this.o[g].zg:-1,this.sendEvent("timer"+g.toString(10),null))}b&&b("l",d.concat(this.b))};
Sf.prototype.suspend=function(){this.uc=!0};Sf.prototype.resume=function(a){this.uc&&(this.R+=a-this.w,this.w=a,this.uc=!1)};var Uf="shift left;shift right;add;sub;mult;div;mod;bitor;bitxor;bitand;eq;ne;gt;ge;lt;le;or;and".split(";");function Vf(a,b){function c(l){return 32784<=l?l-65536:l}function d(l){return 2048<=l?l-4096:l}var e=[],f=a[0];if(0<a.length){if(1!==f%2||f>a.length)throw"Bad event table";e.push({Ob:0,yd:a.slice(0,1),jf:-1,A:"dc "+a[0]})}for(var g=[],h=1;h<f;h+=2)g.push({id:a[h],Ob:a[h+1]}),e.push({Ob:h,yd:a.slice(h,h+2),jf:-1,A:"dc 0x"+a[h].toString(16)+", "+a[h+1]});for(h=f;h<a.length;h++){f={Ob:h,yd:a.slice(h,h+1),jf:a[h]>>>12};if(!b)for(var k=0;k<g.length;k++)if(g[k].Ob===h){f.id="onevent_"+g[k].id.toString(16);
break}k=a[h];switch(k>>>12){case 0:f.A="stop";break;case 1:f.A="push.s "+((k&4095)-(k&2048?4096:0));break;case 2:f.yd=a.slice(h,h+2);f.A="push "+c(a[++h]);break;case 3:f.A="load "+(k&4095);break;case 4:f.A="store "+(k&4095);break;case 5:f.yd=a.slice(h,h+2);f.A="load.ind "+(k&4095)+" size="+a[++h];break;case 6:f.yd=a.slice(h,h+2);f.A="store.ind "+(k&4095)+" size="+a[++h];break;case 7:case 8:switch(k){case 28672:f.A="neg";break;case 28673:f.A="abs";break;case 28674:f.A="bitnot";break;case 28675:f.A=
"not ; not implemented";break;case 32768:f.A="sl";break;case 32769:f.A="asr";break;case 32770:f.A="add";break;case 32771:f.A="sub";break;case 32772:f.A="mult";break;case 32773:f.A="div";break;case 32774:f.A="mod";break;case 32775:f.A="bitor";break;case 32776:f.A="bitxor";break;case 32777:f.A="bitand";break;case 32778:f.A="eq";break;case 32779:f.A="ne";break;case 32780:f.A="gt";break;case 32781:f.A="ge";break;case 32782:f.A="lt";break;case 32783:f.A="le";break;case 32784:f.A="or";break;case 32785:f.A=
"and";break;default:throw"Unknown instruction "+k.toString(16);}break;case 9:f.A="jump "+(h+d(k&4095));break;case 10:f.yd=a.slice(h,h+2);f.A=(k&256?k&512?"dont.":"do.":"")+"jump."+(k&256?"when":"if")+".not "+Uf[k&31]+" "+(h+c(a[h+1]));h++;break;case 11:f.A="emit id="+(k&4095)+" data="+c(a[h+1])+" count="+c(a[h+2]);h+=2;break;case 12:f.A="callnat "+(k&4095);break;case 13:f.A="callsub "+(k&4095);break;case 14:f.A="ret";break;default:throw"Unknown instruction "+k.toString(16);}e.push(f)}return e}
function Ab(a,b){var c=Vf(a).map(function(d){var e=d.Ob.toString(10);e="    ".slice(e.length-1)+e;var f=d.yd.map(function(g){g=g.toString(16);return"000".slice(g.length-1)+g}).join(" ");f+="     ".slice(f.length-4);return(d.id?d.id+":\n":"")+(b?"    ":e+"  "+f+"  ")+d.A+(d.Ob===a[0]-2||0===d.jf||14===d.jf?"\n":"")}).join("\n");0===c.length&&(c="; empty");return c};function Mf(a,b,c){function d(w){var n=e[w].Ob.toString(10);n="    ".slice(n.length-1)+n;var v=e[w].yd.map(function(m){m=m.toString(16);return"000".slice(m.length-1)+m}).join(" ");v+="     ".slice(v.length-4);f+=(e[w].id?e[w].id+":\n":"")+n+"  "+v+"  "+e[w].A+"\n";e.splice(w,1)}var e=Vf(b,!0);a=a.split("\n");c=c.slice().sort(function(w,n){return w.Ob-n.Ob});c=[new Wf(-1,-1,-1,0)].concat(c,new Wf(Infinity,Infinity,Infinity,b.length));var f="";for(b=0;b<a.length;b++){for(var g=!1,h=0;h<c.length-1;)if(c[h].line<=
b){for(var k=c[h].Ob;k<c[h+1].Ob;k++)for(var l=0;l<e.length;)e[l].Ob===k?(!g&&0<b&&(f+="\n"),g=!0,d(l)):l++;c.splice(h,1)}else h++;g&&(f+="\n");f+=a[b]+"\n"}for(l=0;l<e.length;)d(l);return f};function vb(a){this.name=a.name;this.b=a.maxVarSize;this.Xa=[];for(var b=this.Na=0;b<a.variables.length;b++)this.Xa.push(new Xf(a.variables[b].name,a.variables[b].size,[1],this.Na,Yf)),this.Na+=a.variables[b].size;this.Lb=a.nativeFunctions.map(function(c,d){return{id:d,name:c.name,B:c.args}});this.wd=a.localEvents.map(function(c){return{name:c.name}})}function Zf(a,b){for(var c=0;c<a.Lb.length;c++)if(a.Lb[c].name===b)return a.Lb[c];return null}
function $f(a,b){for(var c=0;c<a.Xa.length;c++)if(a.Xa[c].name===b)return a.Xa[c];return null}function ag(a,b){if("init"===b)return 65535;for(var c=0;c<a.wd.length;c++)if(a.wd[c].name===b)return 65534-c;throw"unknown local event "+b;}function xb(a,b){this.Xb=bg;this.eg=!1;this.oa=a;this.m=b;this.M=b.length;this.b=0;this.line=1;this.Fa=0;this.C=[];this.l=0;this.h=[];this.hg=[];this.ga=[];this.R={};this.Za=[];this.hb=[];this.kc=this.Wc=this.oa.b;this.Kf=!1;this.La=0;this.Vb=[]}
function Xf(a,b,c,d,e){this.name=a;this.size=b;this.v=c;this.offset=d;this.resultType=e}Xf.prototype.td=function(a,b){return[12288|this.offset+(b||0)]};Xf.prototype.ff=function(a,b){return[16384|this.offset+(b||0)]};Xf.prototype.De=function(){return[20480|this.offset,this.size]};Xf.prototype.Gf=function(){return[24576|this.offset,this.size]};
xb.prototype.Lg=function(){for(;this.b<this.M;)if(" "===this.m[this.b]||"\t"===this.m[this.b])this.b++,this.Fa++;else if("\n"===this.m[this.b])this.b++,this.Fa=0,this.line++;else if("\r"===this.m[this.b])this.b++;else if("#*"===this.m.slice(this.b,this.b+2))for(this.b+=2,this.Fa+=2;this.b<this.M&&"*#"!==this.m.slice(this.b-2,this.b);)"\n"===this.m[this.b]?(this.Fa=0,this.line++):"\r"!==this.m[this.b]&&this.Fa++,this.b++;else if("#"===this.m[this.b])for(;this.b<this.M&&"\n"!==this.m[this.b];)this.b++,
this.Fa++;else break};function cg(a,b){a.hb.push(b.length-1)}function dg(a,b,c){if(0===a.hb.length)throw"internal";void 0===c&&(c=b.length);a=a.hb.pop();b[a]=36864===b[a]?b[a]+(c-a&4095):c-a+1&65535}xb.prototype.Ed=function(a,b,c,d,e){var f;a:{for(f=0;f<this.Za.length;f++)if(this.Za[f].name===a){f=!0;break a}for(f=0;f<this.oa.Xa.length;f++)if(this.oa.Xa[f].name===a){f=!0;break a}f=!1}if(f)throw'duplicate variable declaration "'+a+'"';this.Za.push(new Xf(a,b,c,d,e))};
function eg(a,b){for(var c=a.Za.length-1;0<=c;c--)if(a.Za[c].name===b.name)return a.Za[c];for(c=0;c<a.oa.Xa.length;c++)if(a.oa.Xa[c].name===b.name)return a.oa.Xa[c];throw"unknown variable "+b.name+" "+U(b.head);}function fg(a,b){for(var c=0;c<a.ga.length;c++)if(a.ga[c].name===b)return a.ga[c];return null}function gg(a,b){a.kc-=b;return a.kc}xb.prototype.qb=function(){return[]};var hg="== != <= >= |= ^= &= *= /= %= += -= <<= >>= ++ -- ( ) [ ] - ~ * / % + << >> & ^ | > < = , : abs and callsub call const do elseif else emit end for if in not onevent or return step sub then var when while".split(" ");
function ig(a,b,c){this.Bd=a;this.jd=b;this.gd=c}function U(a){return"line "+a.jd.toString()+" col "+a.gd.toString()}function jg(a,b,c,d){ig.call(this,a,b,c);this.n=d}jg.prototype=Object.create(ig.prototype);jg.prototype.constructor=jg;function kg(a,b,c,d){ig.call(this,a,b,c);this.n=d}kg.prototype=Object.create(jg.prototype);kg.prototype.constructor=kg;function lg(a,b,c,d){ig.call(this,a,b,c);this.name=d}lg.prototype=Object.create(ig.prototype);lg.prototype.constructor=lg;
function mg(a,b,c,d){ig.call(this,a,b,c);this.name=d}mg.prototype=Object.create(ig.prototype);mg.prototype.constructor=mg;
xb.prototype.zf=function(a){for(;;){a:{var b=(b=a)||hg;this.Lg();if(this.b>=this.M)var c=null;else{for(var d=0;d<b.length;d++)if(c=b[d].length,this.m.slice(this.b,this.b+c)===b[d]&&!/[a-zA-Z0-9_.]{2}/.test(this.m.slice(this.b+c-1,this.b+c+1))){b=new mg(this.b,this.line,this.Fa,b[d]);this.b+=c;this.Fa+=c;c=b;break a}c=0;if("0x"===this.m.slice(this.b,this.b+2)){for(this.b+=2;this.b+c<this.M&&/[0-9a-fA-F]/.test(this.m[this.b+c]);)c++;if(0===c)throw"hexadecimal number syntax error";b=parseInt(this.m.slice(this.b,
this.b+c),16);b=new jg(this.b,this.line,this.Fa,b);this.b+=c;this.Fa+=2+c}else if("0b"===this.m.slice(this.b,this.b+2)){for(this.b+=2;this.b+c<this.M&&/[01]/.test(this.m[this.b+c]);)c++;if(0===c)throw"binary number syntax error";b=parseInt(this.m.slice(this.b,this.b+c),2);b=new jg(this.b,this.line,this.Fa,b);this.b+=c;this.Fa+=2+c}else if(/[0-9]/.test(this.m[this.b])){for(;this.b+c<this.M&&/[0-9]/.test(this.m[this.b+c]);)c++;if(this.eg&&this.b+c<this.M&&"."===this.m[this.b+c]){for(c++;this.b+c<this.M&&
/[0-9]/.test(this.m[this.b+c]);c++);b=parseFloat(this.m.slice(this.b,this.b+c));b=new kg(this.b,this.line,this.Fa,b)}else b=parseInt(this.m.slice(this.b,this.b+c),10),b=new jg(this.b,this.line,this.Fa,b);this.b+=c;this.Fa+=c}else if(/[a-zA-Z_]/.test(this.m[this.b])){for(;this.b+c<this.M&&/[a-zA-Z0-9_.]/.test(this.m[this.b+c]);)c++;if(0===c)throw"name syntax error";b=new lg(this.b,this.line,this.Fa,this.m.slice(this.b,this.b+c));this.b+=c;this.Fa+=c}else throw"syntax error line "+this.line.toString()+
" col "+this.Fa.toString();c=b}}if(null===c)break;this.C.push(c)}};function Wf(a,b,c,d){this.Mg=a;this.line=b;this.Fa=c;this.Ob=d}function ng(a,b,c){(b=b.head||b.children[0]&&b.children[0].head)&&a.Vb.push(new Wf(b.Bd,b.jd,b.gd,void 0===c?a.La:c))}function og(a){this.head=a;this.children=[];this.nb=0;this.resultType=pg;this.tb=!0}function qg(a,b){for(var c=0;c<a.length;c++)a[c]=a[c].F(b)}og.prototype.F=function(){return this};og.prototype.Sa=function(a){this.children.forEach(function(b){b.Sa(a)})};
og.prototype.w=function(a){this.Sa(a);for(var b=0;b<this.children.length;b++)this.children[b]=this.children[b].w(a);return this};function rg(a,b){og.call(this,a);this.n=void 0===b?this.head.n:b;this.resultType=Yf}rg.prototype=Object.create(og.prototype);rg.prototype.constructor=rg;rg.prototype.Sa=function(){this.nb=1};function sg(a){a&=65535;return 32768<=a?a-65536:a}function tg(a,b){rg.call(this,a,b);this.resultType=ug}tg.prototype=Object.create(rg.prototype);tg.prototype.constructor=tg;
function vg(a){og.call(this,a);this.name=a.name;this.b=!1}vg.prototype=Object.create(og.prototype);vg.prototype.constructor=vg;vg.prototype.Sa=function(a){a.R.hasOwnProperty(this.name)?(this.nb=1,this.resultType=a.R[this.name].resultType):(a=eg(a,this),this.nb=a.size,this.resultType=a.resultType)};vg.prototype.F=function(a){return a.R.hasOwnProperty(this.name)?a.R[this.name].resultType===ug?new tg(this.head,a.R[this.name].S):new rg(this.head,a.R[this.name].S):this};
function wg(a){var b=new vg(a.head);b.resultType=a.resultType;b.b=!0;return b}var pg="?",Yf="n",ug="fx";function xg(a,b,c,d){og.call(this,a);this.type=b;this.resultType=c?c.resultType:pg;this.Da=c;this.children=d||[]}xg.prototype=Object.create(og.prototype);xg.prototype.constructor=xg;
xg.prototype.Sa=function(a){og.prototype.Sa.call(this,a);for(var b=1,c=0;c<this.children.length;c++)if(1===b)b=this.children[c].nb;else if(1!==this.children[c].nb&&this.children[c].nb!==b)throw"incompatible sizes "+U(this.head);this.nb=b;this.Da&&this.Da.ma&&(this.resultType=this.Da.ma(a,this,this.children.map(function(d){return d.resultType})))};xg.prototype.F=function(a){this.children=this.children.map(function(b){return b.F(a)});return this.Da&&this.Da.F?this.Da.F(this,a):this};
xg.prototype.w=function(a){var b=og.prototype.w.call(this,a);if(b.type===V&&b.Da.priority===yg&&(b.children[1]instanceof zg||b.children[1]instanceof vg&&1!==b.children[1].nb)){var c=b.children[0];if(!(c instanceof vg)||b.tb)throw"bad array assignment "+U(b.head);for(var d=b.children[1],e=new Ag(b.head),f=0;f<d.nb;f++){var g=c;1<d.nb&&(g=new Bg(c.head,[new rg(c.head,f)]),g.resultType=c.resultType);if(d instanceof zg)var h=d.children[f];else h=new Bg(d.head,[new rg(c.head,f)]),h.resultType=d.resultType;
g=new xg(b.head,b.type,b.Da,[g,h]);g.resultType=c.resultType;g.tb=!1;g=g.F(a);e.children.push(g)}return e}return b};function Bg(a,b){vg.call(this,a);this.children=b}Bg.prototype=Object.create(vg.prototype);Bg.prototype.constructor=Bg;Bg.prototype.Sa=function(a){og.prototype.Sa.call(this,a);a=eg(a,this);this.nb=1;this.resultType=a.resultType};function Cg(a){for(var b=0;b<a.children.length;b++)if(!(a.children[b]instanceof rg))return!1;return!0}
function Dg(a,b){for(var c=0,d=1,e=0;e<a.children.length;e++){if(!(a.children[e]instanceof rg))throw"internal";c+=d*a.children[e].n;d*=b.v[e]}return c}function zg(a){og.call(this,a);this.v=[]}zg.prototype=Object.create(og.prototype);zg.prototype.constructor=zg;zg.prototype.Sa=function(a){this.nb=this.children.length;this.children[0]&&(this.children.forEach(function(b){b.Sa(a)}),this.resultType=this.children[0].resultType)};
function Eg(a,b){og.call(this,a);this.type=b||Fg;this.za=!1;this.Qa=[null]}Eg.prototype=Object.create(og.prototype);Q=Eg.prototype;Q.constructor=Eg;Q.Lf=function(){throw"internal";};Q.Bg=function(){};Q.Dg=function(){throw"internal";};Q.Cg=function(){};Q.Qd=function(){};function Gg(a,b){b.kc=b.Wc;ng(b,a)}var Fg=1;function Hg(a,b){this.b=a;this.ka=b}Hg.prototype.u=function(){return"internal"};function Ig(a,b){Eg.call(this,a,2);this.cf=b}Ig.prototype=Object.create(Eg.prototype);
Ig.prototype.constructor=Ig;Ig.prototype.F=function(a){qg(this.children,a);return this};Ig.prototype.Lf=function(){return this};function Jg(a,b){Eg.call(this,a,2);this.Og=b}Jg.prototype=Object.create(Eg.prototype);Jg.prototype.constructor=Jg;Jg.prototype.F=function(a){qg(this.children,a);return this};Jg.prototype.Lf=function(){return this};function Kg(a){Eg.call(this,a)}Kg.prototype=Object.create(Eg.prototype);Kg.prototype.constructor=Kg;
function Lg(a,b,c){Eg.call(this,a);this.b=b;this.S=c;this.resultType=c.resultType}Lg.prototype=Object.create(Eg.prototype);Lg.prototype.constructor=Lg;function Mg(a,b,c,d,e){Eg.call(this,a);this.R=b.name;this.resultType=c;this.b=d||null;this.size=-1;this.v=[];this.offset=-1;e&&this.children.push(e)}Mg.prototype=Object.create(Eg.prototype);Mg.prototype.constructor=Mg;Mg.prototype.Sa=function(a){this.children[0]&&(og.prototype.Sa.call(this,a),this.resultType=this.children[0].children[1].resultType)};
Mg.prototype.F=function(a){qg(this.children,a);return this};function Ng(a){Eg.call(this,a.head);this.children.push(a)}Ng.prototype=Object.create(Eg.prototype);Ng.prototype.constructor=Ng;Ng.prototype.F=function(a){qg(this.children,a);return this};function Ag(a){Eg.call(this,a)}Ag.prototype=Object.create(Eg.prototype);Ag.prototype.constructor=Ag;Ag.prototype.F=function(a){qg(this.children,a);return this};function Og(a,b){Eg.call(this,a,3);this.b=[b];this.h=[];this.m=[]}Og.prototype=Object.create(Eg.prototype);
Q=Og.prototype;Q.constructor=Og;Q.Sa=function(a){this.b.forEach(function(b){b.Sa(a)});this.h.forEach(function(b){b.forEach(function(c){c.Sa(a)})})};Q.F=function(a){qg(this.b,a);this.h.forEach(function(b){qg(b,a)});return this};Q.Dg=function(a){if(this.h.length>=this.b.length)throw"multiple else "+U(a.head);a instanceof Pg&&this.b.push(a.Ga);this.h.push(this.children);this.m.push(a);this.children=[];this.Qa.push(a.Qa[0])};
Q.Qd=function(a,b){this.h.push(this.children);this.children=[];this.m.push(b);for(a=0;a<this.b.length;)if(this.b[a]instanceof rg)if(0===this.b[a].n)this.b.splice(a,1),this.h.splice(a,1);else{this.b.splice(a);this.h.splice(a+1);break}else a++};function Pg(a,b){Eg.call(this,a,4);this.Ga=b}Pg.prototype=Object.create(Eg.prototype);Pg.prototype.constructor=Pg;Pg.prototype.F=function(a){this.Ga=this.Ga.F(a);qg(this.children,a);return this};function Qg(a){Eg.call(this,a,4)}Qg.prototype=Object.create(Eg.prototype);
Qg.prototype.constructor=Qg;function Rg(a,b){Eg.call(this,a,3);this.Ga=b}Rg.prototype=Object.create(Eg.prototype);Rg.prototype.constructor=Rg;Rg.prototype.Sa=function(a){og.prototype.Sa.call(this,a);this.Ga.Sa(a)};Rg.prototype.F=function(a){this.Ga=this.Ga.F(a);qg(this.children,a);return this};function Sg(a,b){Eg.call(this,a,3);this.Ga=b;this.b=[]}Sg.prototype=Object.create(Eg.prototype);Sg.prototype.constructor=Sg;Sg.prototype.Sa=function(a){og.prototype.Sa.call(this,a);this.Ga.Sa(a)};
Sg.prototype.F=function(a){this.Ga=this.Ga.F(a);qg(this.children,a);return this};Sg.prototype.Qd=function(a,b){this.Ga instanceof rg&&(0===this.Ga.n&&(this.children=[]),this.Ga=null);this.b.push(b)};function Tg(a,b,c,d,e){Eg.call(this,a,3);this.m=new vg(b);this.children.push(c);this.children.push(d);this.b=e||null;this.h=[]}Tg.prototype=Object.create(Eg.prototype);Tg.prototype.constructor=Tg;Tg.prototype.Sa=function(a){og.prototype.Sa.call(this,a);this.b&&this.b.Sa(a)};
Tg.prototype.F=function(a){this.b&&(this.b=this.b.F(a));qg(this.children,a);return this};Tg.prototype.Qd=function(a,b){this.h.push(b)};function Ug(a,b,c){Eg.call(this,a);this.name=b;this.children=c}Ug.prototype=Object.create(Eg.prototype);Ug.prototype.constructor=Ug;Ug.prototype.F=function(a){qg(this.children,a);return this};function Vg(a,b){Eg.call(this,a);this.name=b}Vg.prototype=Object.create(Eg.prototype);Vg.prototype.constructor=Vg;function Wg(a){Eg.call(this,a,5)}Wg.prototype=Object.create(Eg.prototype);
Wg.prototype.constructor=Wg;var yg=30,V=1;function W(a,b,c){this.name=a;this.type=b;this.priority=c&&c.priority||0;this.resultType=c&&c.resultType||(c&&c.ma?pg:Yf);this.ma=c&&c.ma||null;this.F=c&&c.F||null;this.K=c&&c.K||[];this.u=c&&c.u||null}function Xg(a,b){for(var c=[],d=0;d<a.children.length;d++){if(!(a.children[d]instanceof rg))return a;c.push(a.children[d].n)}return new rg(a.head,sg(b(c)))}
var bg=[new W("--",0,{priority:150}),new W("++",0,{priority:150}),new W("-",0,{priority:150,F:function(a){return Xg(a,function(b){return-b[0]})},K:[28672]}),new W("~",0,{priority:150,F:function(a){return Xg(a,function(b){return~b[0]})},K:[28674]}),new W("abs",0,{priority:150,F:function(a){return Xg(a,function(b){return Math.abs(b[0])})},K:[28673]}),new W("not",0,{priority:150,resultType:"b",F:function(a){return Xg(a,function(b){return 0==b[0]?1:0})},K:[4096,32778]}),new W("size",0,{priority:150,F:function(a,
b){var c=0<a.children[0].nb?a.children[0].nb:a.children[0]instanceof zg?a.children[0].children.length:-1;if(0>c&&a.children[0]instanceof vg)for(var d=b.Za.length-1;0<=d;d--)if(b.Za[d].name===a.children[0].name){c=b.Za[d].size;break}return 0<c?new rg(a.head,c):a}}),new W("--",2,{priority:150}),new W("++",2,{priority:150}),new W("+=",V,{priority:yg}),new W("-=",V,{priority:yg}),new W("*=",V,{priority:yg}),new W("/=",V,{priority:yg}),new W("%=",V,{priority:yg}),new W("<<=",V,{priority:yg}),new W(">>=",
V,{priority:yg}),new W("&=",V,{priority:yg}),new W("|=",V,{priority:yg}),new W("^=",V,{priority:yg}),new W("*",V,{priority:140,F:function(a){return Xg(a,function(b){return b[0]*b[1]})},K:[32772]}),new W("/",V,{priority:140,F:function(a){return Xg(a,function(b){return Math.trunc(b[0]/b[1])})},K:[32773]}),new W("%",V,{priority:140,F:function(a){return Xg(a,function(b){return b[0]%b[1]})},K:[32774]}),new W("+",V,{priority:130,F:function(a){return Xg(a,function(b){return b[0]+b[1]})},K:[32770]}),new W("-",
V,{priority:130,F:function(a){return Xg(a,function(b){return b[0]-b[1]})},K:[32771]}),new W("<<",V,{priority:120,F:function(a){return Xg(a,function(b){return b[0]<<b[1]})},K:[32768]}),new W(">>",V,{priority:120,F:function(a){return Xg(a,function(b){return b[0]>>b[1]})},K:[32769]}),new W("==",V,{priority:80,resultType:"b",F:function(a){return Xg(a,function(b){return b[0]===b[1]?1:0})},K:[32778]}),new W("!=",V,{priority:80,resultType:"b",F:function(a){return Xg(a,function(b){return b[0]!==b[1]?1:0})},
K:[32779]}),new W("<",V,{priority:80,resultType:"b",F:function(a){return Xg(a,function(b){return b[0]<b[1]?1:0})},K:[32782]}),new W("<=",V,{priority:80,resultType:"b",F:function(a){return Xg(a,function(b){return b[0]<=b[1]?1:0})},K:[32783]}),new W(">",V,{priority:80,resultType:"b",F:function(a){return Xg(a,function(b){return b[0]>b[1]?1:0})},K:[32780]}),new W(">=",V,{priority:80,resultType:"b",F:function(a){return Xg(a,function(b){return b[0]>=b[1]?1:0})},K:[32781]}),new W("&",V,{priority:110,F:function(a){return Xg(a,
function(b){return b[0]&b[1]})},K:[32777]}),new W("|",V,{priority:90,F:function(a){return Xg(a,function(b){return b[0]|b[1]})},K:[32775]}),new W("^",V,{priority:100,F:function(a){return Xg(a,function(b){return b[0]^b[1]})},K:[32776]}),new W("and",V,{priority:60,resultType:"b",F:function(a){return Xg(a,function(b){return b[0]&&b[1]?1:0})},K:[32785]}),new W("or",V,{priority:50,resultType:"b",F:function(a){return Xg(a,function(b){return b[0]||b[1]?1:0})},K:[32784]}),new W("=",V,{priority:yg})];
function Yg(a,b,c){for(var d=0;d<a.Xb.length;d++)if(a.Xb[d].type===c&&a.Xb[d].name===b)return a.Xb[d];return null}function Zg(a,b,c){return a.C[a.l+b]instanceof c}function $g(a,b,c){return a.C[a.l+b]instanceof mg&&a.C[a.l+b].name===c}Q=xb.prototype;Q.tg=function(a){return new xg(a,4,null)};
function ah(a,b){b=b||10;if(Zg(a,0,kg)){var c=new tg(a.C[a.l]);a.l++}else if(Zg(a,0,jg))c=new rg(a.C[a.l]),a.l++;else if(Zg(a,0,lg))$g(a,1,"(")?(c=a.tg(a.C[a.l]),a.l++,$g(a,1,")")?a.l+=2:c.children=bh(a)):(c=new vg(a.C[a.l]),a.l++);else if($g(a,0,"(")){a.l++;c=ah(a,20);if(!$g(a,0,")"))throw"subexpression in expression "+U(a.C[a.l]);a.l++}else if($g(a,0,"[")){c=new zg(a.C[a.l]);a.l++;var d=[];for(var e=0,f=0,g=0;;){d.push(ah(a,25));0===g&&f++;g++;if(1<f&&g>e)throw"non-rectangular array "+U(a.C[a.l]);
g>e&&(e=g);if(Zg(a,0,mg))if(a.l++,"]"===a.C[a.l-1].name)break;else if(","===a.C[a.l-1].name)continue;else if(";"===a.C[a.l-1].name){e=g;g=0;continue}throw"array "+U(a.C[a.l-1]);}for(g=0;g<e;g++)for(var h=0;h<f;h++)c.children.push(d[h*e+g])}else if(Zg(a,0,mg)&&(d=Yg(a,a.C[a.l].name,0)))c=new xg(a.C[a.l],0,d),a.l++,c.children.push(ah(a,150)),d.ma&&(c.resultType=d.ma(a,c,[c.children[0].resultType]));else if(Zg(a,0,mg)&&(d=Yg(a,a.C[a.l].name,3)))c=new xg(a.C[a.l],3,d),a.l++;else{if(a.l<a.C.length)throw"unexpected token in expression "+
U(a.C[a.l]);throw"unexpected end of file";}for(;Zg(a,0,mg);)if((d=Yg(a,a.C[a.l].name,2))&&d.priority>=b)c=new xg(a.C[a.l],2,d,[c]),a.l++;else if((d=Yg(a,a.C[a.l].name,V))&&(b===yg?d.priority>=b:d.priority>b))c=new xg(a.C[a.l],V,d,[c]),a.l++,c.children.push(ah(a,d.priority)),d.ma&&(c.resultType=d.ma(a,c,c.children.map(function(k){return k.resultType})));else if("["===a.C[a.l].name){if(!(c instanceof vg))throw"unexpected indexing";d=c.resultType;e=bh(a,!0);c=new Bg(c.head,e);c.resultType=d}else break;
return c}function bh(a,b){var c=[];if(!$g(a,0,b?"[":"("))throw"left "+(b?"bracket":"parenthesis")+" expected";for(a.l++;;){var d=ah(a,25);c.push(d);if(!Zg(a,0,mg))throw"syntax error in arguments";if($g(a,0,b?"]":")")){a.l++;break}else if($g(a,0,","))a.l++;else throw"syntax error in arguments "+U(a.C[a.l]);}return c}
Q.yg=function(){if(this.l>=this.C.length)throw"no more tokens";if(this.C[this.l]instanceof mg){var a=this.C[this.l];switch(a.name){case "const":if(!Zg(this,1,lg)||!$g(this,2,"="))throw'syntax error for "const" '+U(a);var b=this.C[this.l+1];this.l+=3;var c=ah(this);c=c.F(this);if(!(c instanceof rg))throw"non-constant expression in constant definition "+U(this.C[this.l]);return[new Lg(a,b.name,c)];case "var":if(!Zg(this,1,lg))throw'unexpected token after "var" '+U(a);b=this.C[this.l+1];this.l+=2;if(Zg(this,
0,mg))switch(this.C[this.l].name){case "[":if($g(this,1,"]")){this.l+=2;if(!$g(this,0,"="))throw"missing size or initial value in array declaration"+U(this.C[this.l-2]);c=new xg(this.C[this.l],V,Yg(this,"=",V),[new vg(b)]);this.l++;c.children.push(ah(this));c.resultType=c.children[1].resultType;c.tb=!1;var d=new xg(new mg(c.head.Bd,c.head.jd,c.head.gd,"size"),0,Yg(this,"size",0),[c.children[1]]);return[new Mg(a,b,c.resultType,[d],c)]}this.l++;d=ah(this);if(!$g(this,0,"]"))throw"array size syntax error"+
U(this.C[this.l]);this.l++;return $g(this,0,"=")?(c=new xg(this.C[this.l],V,Yg(this,"=",V),[new vg(b)]),this.l++,c.children.push(ah(this)),c.resultType=c.children[1].resultType,c.tb=!1,c=c.F(this),[new Mg(a,b,c.resultType,[d],c)]):[new Mg(a,b,pg,[d])];case "=":return c=new xg(this.C[this.l],V,Yg(this,"=",V),[new vg(b)]),this.l++,c.children.push(ah(this)),c.resultType=c.children[1].resultType,c.tb=!1,c=c.F(this),[new Mg(a,b,c.resultType,null,c)]}return[new Mg(a,b,pg)];case "if":case "elseif":this.l++;
c=ah(this);if(!$g(this,0,"then"))throw'"then" expected after "if" statement '+U(this.C[this.l]);this.l++;return["if"===a.name?new Og(a,c):new Pg(a,c)];case "when":this.l++;c=ah(this);if(!$g(this,0,"do"))throw'"do" expected after "when" statement '+U(this.C[this.l]);this.l++;return[new Rg(a,c)];case "while":this.l++;c=ah(this);if(!$g(this,0,"do"))throw'"do" expected after "while" statement '+U(this.C[this.l]);this.l++;return[new Sg(a,c)];case "for":if(!Zg(this,1,lg)||!$g(this,2,"in"))throw'"for" syntax error '+
U(a);b=this.C[this.l+1];this.l+=3;c=ah(this);if(!$g(this,0,":"))throw'range expected in "for" statement '+U(this.C[this.l]);this.l++;d=ah(this);var e=null;$g(this,0,"step")&&(this.l++,e=ah(this));if(!$g(this,0,"do"))throw'"do" expected after "for" statement '+U(this.C[this.l]);this.l++;return[new Tg(a,b,c,d,e)];case "end":return this.l++,[new Wg(a)];case "call":if(!Zg(this,1,lg))throw'"call" syntax error '+U(a);b=this.C[this.l+1];this.l+=2;return $g(this,0,"(")?[new Ug(a,b.name,bh(this))]:[new Ug(a,
b.name,[])];case "callsub":if(!Zg(this,1,lg))throw'"callsub" syntax error '+U(a);b=this.C[this.l+1];this.l+=2;return[new Vg(a,b.name)];case "else":return this.l++,[new Qg(a)];case "onevent":if(!Zg(this,1,lg))throw'unexpected token after "onevent" '+U(a);b=this.C[this.l+1];this.l+=2;return[new Ig(a,b.name)];case "return":return this.l++,[new Kg(a)];case "sub":if(!Zg(this,1,lg))throw'unexpected token after "sub" '+U(a);b=this.C[this.l+1];this.l+=2;return[new Jg(a,b.name)]}}c=ah(this);c instanceof xg&&
(c.tb=!1);c=c.F(this);return[new Ng(c)]};Q.Fg=function(){};Q.Eg=function(){};
Q.Oe=function(a){if(a instanceof Lg){a.S=a.S.F(this);if(!(a.S instanceof rg))throw"constant definition "+U(a.head);this.R[a.b]={S:a.S.n,resultType:a.S.resultType}}else a instanceof Mg&&(a.size=1,a.v=[],a.b&&(a.b=a.b.map(function(b){b=b.F(this);if(!(b instanceof rg)||0>=b.n)throw"array variable size "+U(a.head);a.size*=b.n;a.v.push(b.n);return b},this)),a.offset=this.Na,a.children[0]&&(a.resultType=a.children[0].resultType),this.Na+=a.size,this.Ed(a.R,a.size,a.v,a.offset,a.resultType))};Q.Rd=function(){};
Q.ua=function(){};Q.getContext=function(){return null};Q.ig=function(){this.Na=this.oa.Na;for(var a=0;a<this.h.length;a++)this.Oe(this.h[a])};function ch(a,b,c){switch(b.type){case 3:c.push(a.getContext());a.ua(b.Qa[0]);break;case 4:a.ua(b.Qa[0]);break;case 5:a.ua(c.pop())}}
function dh(a){function b(){if(1<f.length){var h=f[f.length-1].head;throw"unterminated "+h.name+" "+U(h);}c.o.push(f[0])}var c=a,d=[];a.ig();a.Rd();d=[];a.h.forEach(function(h){ch(this,h,d);h.Sa(this)},a);a.Rd();d=[];for(var e=0;e<a.h.length;e++)ch(a,a.h[e],d),a.h[e]=a.h[e].F(a);a.Rd();d=[];for(e=0;e<a.h.length;e++)ch(a,a.h[e],d),a.h[e]=a.h[e].w(a);a.o=[];var f=[new Ig(null,"init")];a.Rd();for(e=0;e<a.h.length;e++)switch(a.h[e].type){case Fg:a.h[e].Qd(a,a.h[e]);f[f.length-1].children.push(a.h[e]);
break;case 2:a.ua(a.h[e].Qa[0]);b();f=[a.h[e].Lf()];break;case 3:a.ua(a.h[e].Qa[0]);a.h[e].Bg(a);f.push(a.h[e]);break;case 4:a.ua(a.h[e].Qa[0]);f[f.length-1].Dg(a.h[e]);break;case 5:if(2>f.length)throw"unexpected end "+U(a.h[e].head);a.ua(a.h[e].Qa[0]);f[f.length-1].Cg(a.h[e]);var g=f.pop();a.ua(a.h[e].Qa[a.h[e].Qa.length-1]);g.Qd(a,a.h[e]);f[f.length-1].children.push(g);break;default:throw"not implemented "+a.h[e].type;}b()}Q.Gg=function(){};Q.sg=function(){return null};
og.prototype.u=function(a){for(var b=[],c=a.La,d=0;d<this.children.length;d++)b=b.concat(this.children[d].u(a)),a.La=c+b.length;return b};function eh(a){return-2048<=a&&2048>a?[4096|a&4095]:[8192,a&65535]}rg.prototype.u=function(){return this.tb?eh(this.n):[]};vg.prototype.u=function(a){return this.b?[]:a.R.hasOwnProperty(this.name)?eh(a.R[this.name].S):eg(a,this).td(a)};
xg.prototype.u=function(a){function b(h,k,l,w){function n(u,p){w===c.Pf&&(v=v.concat(u.td(a,p)));l&&(v=v.concat(u.td(a,p)));v=v.concat(k.u(a)).concat(a.qb(k.resultType,u.resultType),u.ff(a,p));w===c.Je&&(v=v.concat(u.td(a,p)))}var v=[];if(h instanceof Bg){var m=eg(a,h);if(Cg(h)){h=Dg(h,m);if(h>=m.size)throw"index out of range";n(m,h)}else if(w!==c.tf||l){var r=gg(a,1);v=v.concat(fh(h,a)).concat(16384|r);w===c.Pf&&(v=v.concat(12288|r).concat(m.De(a)));l&&(v=v.concat(12288|r).concat(m.De(a)));v=v.concat(k.u(a)).concat(a.qb(k.resultType,
m.resultType),12288|r,m.Gf(a));w===c.Je&&(v=v.concat(12288|r).concat(m.De(a)))}else v=v.concat(k.u(a)).concat(a.qb(k.resultType,m.resultType)).concat(fh(h,a),m.Gf(a))}else if(h instanceof vg)m=eg(a,h),n(m);else throw"bad assignment";return v}var c={tf:0,Je:1,Pf:2},d=this.head.name;switch(d){case "=":return b(this.children[0],this.children[1],!1,this.tb?c.Je:c.tf);case "++":case "--":if(!(this.children[0]instanceof vg))throw"invalid operand "+U(this.head);var e=d[0],f=Yg(a,e,V);e=new xg(new mg(this.head.Bd,
this.head.jd,this.head.gd,e),V,f,[wg(this.children[0]),new rg(new jg(this.head.Bd,this.head.jd,this.head.gd,1))]);f.ma&&(d=eg(a,this.children[0]),e.resultType=f.ma(a,e,[d.resultType,Yf]));return b(this.children[0],e,!0,this.tb?0===this.type?c.Je:c.Pf:c.tf);default:if(this.type===V&&this.Da.priority===yg){if(!(this.children[0]instanceof vg))throw"invalid operand "+U(this.head);e=d.slice(0,-1);f=Yg(a,e,V);e=new xg(new mg(this.head.Bd,this.head.jd,this.head.gd,e),V,f,[wg(this.children[0]),this.children[1]]);
f.ma&&(d=eg(a,this.children[0]),e.resultType=f.ma(a,e,[d.resultType,this.children[1].resultType]));return b(this.children[0],e,!0,this.tb?c.Je:c.tf)}if(this.Da&&this.Da.u)return this.Da.u(this,a);switch(this.type){case 0:return og.prototype.u.call(this,a).concat(this.Da.K);case V:return og.prototype.u.call(this,a).concat(this.Da.K);case 3:return this.Da.K;case 4:f=a.sg(this);if(null!==f)return f;e=fg(a,d);if(null!=e){if(e.ad!==this.children.length)throw"wrong number of arguments";f=[];d=gg(a,e.ad+
(e.je||0));for(var g=0;g<this.children.length;g++)f=f.concat(this.children[g].u(a)),f=f.concat(16384|d+g);return f=f.concat(e.Jb(a,a.oa,this.children.map(function(h){return h.resultType}),d))}throw"unknown function "+d+" "+U(this.head);default:throw"internal";}}};function gh(a,b,c){return a instanceof xg&&2===a.children.length?a.children[0].u(b).concat(a.children[1].u(b)).concat([40960|(c?256:0)|a.Da.K[0]&255,0]):a.u(b).concat(4096,40960|(c?256:0)|Uf.indexOf("ne"),0)}
function fh(a,b){var c=eg(b,a);if(a.children.length>c.v.length)throw"too many indices"+U(a.head);for(var d=[],e=1,f=0;f<a.children.length;f++)d=d.concat(a.children[f].u(b)),0<f&&(d=d.concat(4096|e,32772,32770)),e*=c.v[f];return d}Bg.prototype.u=function(a){if(this.b)return[];var b=eg(a,this);if(Cg(this)){var c=Dg(this,b);if(c>=b.size)throw"index out of range "+U(this.head);return b.td(a,c)}return fh(this,a).concat(b.De(a))};zg.prototype.u=function(){throw"internal";};
Eg.prototype.u=function(){throw"internal";};Ig.prototype.u=function(a){var b=a.getContext();Gg(this,a);a.ua(this.Qa[0]);var c="init"===this.cf?a.hg:[];a.La+=c.length;c=c.concat(og.prototype.u.call(this,a),0);a.ua(b);return c};Jg.prototype.u=function(a){var b=a.getContext();Gg(this,a);a.ua(this.Qa[0]);var c=og.prototype.u.call(this,a).concat(57344);a.ua(b);return c};Lg.prototype.u=function(a){Gg(this,a);return[]};
Mg.prototype.u=function(a){Gg(this,a);return 0===this.children.length?[]:og.prototype.u.call(this,a)};Ng.prototype.u=function(a){Gg(this,a);return this.children[0].u(a)};Ag.prototype.u=function(a,b){Gg(this,a);var c=[];this.children.forEach(function(d){c=c.concat(d.u(a,b))});return c};
Og.prototype.u=function(a){var b=a.getContext();Gg(this,a);for(var c=a.La,d=[],e=0,f=0;f<this.b.length;f++)a.La=c+d.length,0<f&&ng(a,this.m[f-1]),d=d.concat(gh(this.b[f],a)),a.La=c+d.length,cg(a,d),a.ua(this.Qa[f]),this.h[f].forEach(function(g){d=d.concat(g.u(a));a.La=c+d.length}),a.ua(b),f+1<this.h.length?(d=d.concat(36864),dg(a,d),cg(a,d),e++):dg(a,d);a.La=c+d.length;this.h.length>this.b.length&&(ng(a,this.m[this.b.length-1],a.La+d.length),a.ua(this.Qa[this.b.length]),this.h[this.b.length].forEach(function(g){d=
d.concat(g.u(a));a.La=c+d.length}));for(;0<e--;)dg(a,d);a.ua(b);return d};Rg.prototype.u=function(a){var b=a.getContext();Gg(this,a);var c=a.La,d=gh(this.Ga,a,!0);cg(a,d);a.ua(this.Qa[0]);this.children.forEach(function(e){a.La=c+d.length;d=d.concat(e.u(a))});dg(a,d);a.ua(b);return d};
Sg.prototype.u=function(a){if(null==this.Ga&&0===this.children.length)return[];var b=a.getContext();Gg(this,a);var c=a.La,d=[];null!=this.Ga&&(d=gh(this.Ga,a));cg(a,d);a.ua(this.Qa[0]);this.children.forEach(function(e){a.La=c+d.length;d=d.concat(e.u(a))});a.La=c+d.length;ng(a,this.b[0]);d=d.concat(36864|-d.length&4095);dg(a,d);a.ua(b);return d};
Tg.prototype.u=function(a){var b=a.getContext();Gg(this,a);var c=a.La,d=this.children[0].u(a),e=eg(a,this.m);d=d.concat(e.ff(a));var f=d.length;d=d.concat(e.td(a)).concat(this.children[1].u(a),40975,0);cg(a,d);a.ua(this.Qa[0]);for(var g=2;g<this.children.length;g++)a.La=c+d.length,d=d.concat(this.children[g].u(a));a.La=c+d.length;ng(a,this.h[0]);d=d.concat(e.td(a));d=this.b?d.concat(this.b.u(a)):d.concat(eh(1));d=d.concat(32770,e.ff(a),36864|f-d.length-2&4095);dg(a,d);a.ua(b);return d};
Ug.prototype.u=function(a){Gg(this,a);var b=Zf(a.oa,this.name);if(!b)throw'native function "'+this.name+'" not found';if(this.children.length!==b.B.length)throw'wrong number of arguments for native function "'+this.name+'"';for(var c=[],d=[],e=[],f=this.children.length-1;0<=f;f--){var g=this.children[f];if(0>b.B[f])if(void 0==d[-b.B[f]-1])d[-b.B[f]-1]=g.nb;else{if(d[-b.B[f]-1]!==g.nb)throw'argument size mismatch in native function "'+this.name+'"';}else 0===b.B[f]&&e.push(g.nb);if(g instanceof Bg)c=
c.concat(eh(eg(a,g).offset)).concat(fh(g,a),32770);else if(g instanceof vg)c=c.concat(eh(eg(a,g).offset));else{for(var h=gg(a,g.nb),k=0;k<g.nb;k++)c=c.concat((g instanceof zg?g.children[k]:g).u(a)),c=c.concat(16384|h+k);c=c.concat(eh(h))}}for(f=e.length-1;0<=f;f--)c=eh(e[f]).concat(c);for(f=d.length-1;0<=f;f--)void 0!==d[f]&&(c=eh(d[f]).concat(c));return c=c.concat(49152|b.id)};Kg.prototype.u=function(a){Gg(this,a);return[(a.Kf?14:0)<<12]};function hh(a,b){Hg.call(this,a,b)}hh.prototype=Object.create(Hg.prototype);
hh.prototype.constructor=hh;hh.prototype.u=function(){var a=this.ka.name;if(void 0===this.b.Xd[a])throw'unknown function "'+a+'" '+U(this.ka.head);return 53248|this.b.Xd[a]};Vg.prototype.u=function(a){Gg(this,a);return[new hh(a,this)]};function ih(a,b){b=b||0;for(var c=0;c<a.length;c++)a[c]instanceof Hg&&(a[c]=a[c].u(b+c))}
xb.prototype.u=function(){this.hb=[];this.Rd();this.Vb=[];var a=this.o.map(function(f){this.La=0;this.ua(f.Qa[0]);this.Kf=f instanceof Jg;this.Vb=[];return{Gd:f.u(this,!0),mapping:this.Vb}},this);if(0<this.hb.length)throw"internal";for(var b=0,c=0;c<this.o.length;c++)this.o[c]instanceof Ig&&b++;this.Xd={};var d=[],e=[1+2*b];this.Vb=[];for(c=0;c<this.o.length;c++)this.Vb=this.Vb.concat(a[c].mapping.map(function(f){return new Wf(f.Mg,f.line,f.Fa,f.Ob+1+2*b+d.length)})),this.o[c]instanceof Ig?(e=e.concat(ag(this.oa,
this.o[c].cf),1+2*b+d.length),d=d.concat(a[c].Gd)):this.o[c]instanceof Jg&&(this.Xd[this.o[c].Og]=1+2*b+d.length,d=d.concat(a[c].Gd));ih(d,1+2*b);return e.concat(d)};function zb(a){a.zf();a.Fg();a.l=0;for(a.h=[];a.l<a.C.length;)a.h=a.h.concat(a.yg());a.Eg();dh(a);a.Gg();return a.u()};function jh(a,b,c){void 0===c&&(c=1);return{name:a,ad:c,je:1,Ce:function(d){return null!=Zf(d,b)},Jb:function(d,e,f,g){d=Zf(e,b);e=[4097];for(f=0;f<c;f++)e=e.concat([4096|g+c-1-f]);return e=e.concat([4096|g+c,49152|d.id,12288|g+c])}}}var yb=[jh("min","math.min",2),jh("max","math.max",2),jh("clamp","math.clamp",3),jh("muldiv","math.muldiv",3),jh("atan2","math.atan2",2),jh("sin","math.sin"),jh("cos","math.cos"),jh("sqrt","math.sqrt"),jh("rand","math.rand",0)];function Nf(a,b){xb.call(this,a,b);this.eg=!0;this.Xb=kh;this.rb=100;this.Sg=[];this.ef=[];this.gg=[];this.labels=[[]];this.fg=[];this.zb=!1;this.label=null;this.za=pg;this.Oa=[]}Nf.prototype=Object.create(xb.prototype);Nf.prototype.constructor=Nf;var lh="== != <= >= |= ^= &= *= /= %= += -= <<= >>= ++ -- ( ) [ ] - ~ ! * / % + << >> && || & ^ | > < = , ? : { } ; bool break case const continue default do else emit false fixed for goto if int onevent return size switch true void when while".split(" ");
function mh(a,b,c){return c[0]}function nh(a,b,c){for(a=0;a<c.length;a++)switch(c[a]){case pg:case ug:return c[a];case "v":throw"cannot use void result in expression";}return Yf}function oh(a,b,c){if(!(a instanceof zg)&&a.resultType!==b&&a.resultType!==pg){if("v"===a.resultType)throw"cannot use void result "+U(a.head);if(b=ph(b))a=new xg(new mg(a.head.Bd,a.head.jd,a.head.gd,b),0,Yg(c,b,0),[a]),a=a.F(c)}return a}function qh(a,b){a.children[1]=oh(a.children[1],a.resultType,b);return a}
Nf.prototype.qb=function(a,b){if(a===pg||b===pg)throw"internal";if("v"===a)throw"bad conversion from void";switch(a){case Yf:case "b":switch(b){case ug:return[4196,32772]}break;case ug:switch(b){case Yf:case "b":return[4196,32773]}}return[]};function rh(a,b,c){var d=[];a.forEach(function(e){d=e instanceof tg&&b===Yf?d.concat(eh(Math.trunc(e.n))):e instanceof rg&&e.resultType===Yf&&b===ug?d.concat(eh(e.n*c.rb)):d.concat(e.u(c)).concat(c.qb(e.resultType,b))});return d}
function sh(a,b,c,d){var e=gg(a,4);return(b instanceof og?b.u(a):eh(b)).concat(16384|e).concat(c instanceof og?c.u(a):eh(c),16384|e+1).concat(d instanceof og?d.u(a):eh(d),[16384|e+2,4097,4096|e+2,4096|e+1,4096|e,4096|e+3,49152|Zf(a.oa,"math.muldiv").id,12288|e+3])}
function th(a,b,c,d){for(var e=!1,f=[],g=0;g<a.children.length;g++){if(a.children[g]instanceof tg)e=!0;else if(!(a.children[g]instanceof rg))return a;f.push(a.children[g].n)}c=(e&&d?d:c)(f);d=a.Da.resultType;a.Da.ma&&(d=a.Da.ma(b,a,a.children.map(function(h){return h.resultType})));switch(d){case Yf:case "b":return new rg(a.head,sg(c));case ug:return new tg(a.head,c);default:throw"internal";}}
var kh=[new W("--",0,{priority:150,ma:mh}),new W("++",0,{priority:150,ma:mh}),new W("-",0,{priority:150,ma:mh,F:function(a,b){return th(a,b,function(c){return-c[0]})},K:[28672]}),new W("~",0,{priority:150,F:function(a,b){return th(a,b,function(c){return~c[0]})},K:[28674]}),new W("!",0,{priority:150,resultType:"b",F:function(a,b){return th(a,b,function(c){return 0==c[0]?1:0})},K:[4096,32778]}),new W("bool",0,{priority:150,resultType:"b",F:function(a,b){return th(a,b,function(c){return 0!=c[0]?1:0})},
K:[],u:function(a,b){b=a.children[0].u(b);"b"!==a.children[0].resultType&&(b=b.concat(4096,32779));return b}}),new W("fixed",0,{priority:150,resultType:ug,F:function(a,b){return th(a,b,function(c){return c[0]})},K:[],u:function(a,b){var c=a.children[0].u(b);a.children[0].resultType!==ug&&(c=c.concat(4096|b.rb,32772));return c}}),new W("int",0,{priority:150,F:function(a,b){return th(a,b,function(c){return c[0]})},K:[],u:function(a,b){var c=a.children[0].u(b);a.children[0].resultType===ug&&(c=c.concat(4096|
b.rb,32773));return c}}),new W("size",0,{priority:150,F:function(a,b){var c=0<a.children[0].nb?a.children[0].nb:a.children[0]instanceof zg?a.children[0].children.length:-1;if(0>c&&a.children[0]instanceof vg)for(var d=b.Za.length-1;0<=d;d--)if(b.Za[d].name===a.children[0].name){c=b.Za[d].size;break}return 0<c?new rg(a.head,c):a}}),new W("--",2,{priority:150,ma:mh}),new W("++",2,{priority:150,ma:mh}),new W("+=",V,{priority:yg,ma:mh,F:qh}),new W("-=",V,{priority:yg,ma:mh}),new W("*=",V,{priority:yg,
ma:mh}),new W("/=",V,{priority:yg,ma:mh}),new W("%=",V,{priority:yg,ma:mh}),new W("<<=",V,{priority:yg}),new W(">>=",V,{priority:yg}),new W("&=",V,{priority:yg}),new W("|=",V,{priority:yg}),new W("^=",V,{priority:yg}),new W("*",V,{priority:140,ma:nh,K:[32772],F:function(a,b){return th(a,b,function(c){return c[0]*c[1]})},u:function(a,b){var c=a.children[1].resultType===ug,d=[];a.children[0].resultType===ug&&c?d=d.concat(sh(b,a.children[0],a.children[1],b.rb)):(a.children.forEach(function(e){d=d.concat(e.u(b))}),
d=d.concat(a.Da.K));return d}}),new W("/",V,{priority:140,ma:nh,K:[32773],F:function(a,b){return th(a,b,function(c){if(0===c[1])throw"division by 0 "+U(a.head);return Math.trunc(c[0]/c[1])},function(c){if(0===c[1])throw"division by 0 "+U(a.head);return c[0]/c[1]})},u:function(a,b){var c=a.children[1].resultType===ug,d=[];a.children[0].resultType===ug?c?d=d.concat(sh(b,a.children[0],b.rb,a.children[1])):(a.children.forEach(function(e){d=d.concat(e.u(b))}),d=d.concat(a.Da.K)):c?d=d.concat(sh(b,a.children[0],
b.rb*b.rb,a.children[1])):(a.children.forEach(function(e){d=d.concat(e.u(b))}),d=d.concat(a.Da.K));return d}}),new W("%",V,{priority:140,ma:nh,F:function(a,b){return th(a,b,function(c){if(0===c[1])throw"division by 0 "+U(a.head);return c[0]%c[1]})},K:[32774],u:function(a,b){return rh(a.children,a.resultType,b).concat(a.Da.K)}}),new W("+",V,{priority:130,ma:nh,F:function(a,b){return th(a,b,function(c){return c[0]+c[1]})},K:[32770],u:function(a,b){return rh(a.children,a.resultType,b).concat(a.Da.K)}}),
new W("-",V,{priority:130,ma:nh,F:function(a,b){return th(a,b,function(c){return c[0]-c[1]})},K:[32771],u:function(a,b){return rh(a.children,a.resultType,b).concat(a.Da.K)}}),new W("<<",V,{priority:120,F:function(a,b){return th(a,b,function(c){return c[0]<<c[1]})},K:[32768],u:function(a,b){return a.children[0].u(b).concat(rh(a.children.slice(1),Yf,b)).concat(a.Da.K)}}),new W(">>",V,{priority:120,F:function(a,b){return th(a,b,function(c){return c[0]>>c[1]})},K:[32769],u:function(a,b){return a.children[0].u(b).concat(rh(a.children.slice(1),
Yf,b)).concat(a.Da.K)}}),new W("==",V,{priority:80,resultType:"b",F:function(a,b){return th(a,b,function(c){return c[0]===c[1]?1:0})},K:[32778],u:function(a,b){var c=a.children.map(function(d){return d.resultType});return rh(a.children,nh(b,a,c),b).concat(a.Da.K)}}),new W("!=",V,{priority:80,resultType:"b",F:function(a,b){return th(a,b,function(c){return c[0]!==c[1]?1:0})},K:[32779],u:function(a,b){var c=a.children.map(function(d){return d.resultType});return rh(a.children,nh(b,a,c),b).concat(a.Da.K)}}),
new W("<",V,{priority:80,resultType:"b",F:function(a,b){return th(a,b,function(c){return c[0]<c[1]?1:0})},K:[32782],u:function(a,b){var c=a.children.map(function(d){return d.resultType});return rh(a.children,nh(b,a,c),b).concat(a.Da.K)}}),new W("<=",V,{priority:80,resultType:"b",F:function(a,b){return th(a,b,function(c){return c[0]<=c[1]?1:0})},K:[32783],u:function(a,b){var c=a.children.map(function(d){return d.resultType});return rh(a.children,nh(b,a,c),b).concat(a.Da.K)}}),new W(">",V,{priority:80,
resultType:"b",F:function(a,b){return th(a,b,function(c){return c[0]>c[1]?1:0})},K:[32780],u:function(a,b){var c=a.children.map(function(d){return d.resultType});return rh(a.children,nh(b,a,c),b).concat(a.Da.K)}}),new W(">=",V,{priority:80,resultType:"b",F:function(a,b){return th(a,b,function(c){return c[0]>=c[1]?1:0})},K:[32781],u:function(a,b){var c=a.children.map(function(d){return d.resultType});return rh(a.children,nh(b,a,c),b).concat(a.Da.K)}}),new W("&",V,{priority:110,F:function(a,b){return th(a,
b,function(c){return c[0]&c[1]})},K:[32777]}),new W("|",V,{priority:90,F:function(a,b){return th(a,b,function(c){return c[0]|c[1]})},K:[32775]}),new W("^",V,{priority:100,F:function(a,b){return th(a,b,function(c){return c[0]^c[1]})},K:[32776]}),new W("&&",V,{priority:60,ma:mh,F:function(a,b){return th(a,b,function(c){return c[0]&&c[1]?1:0})},K:[32785],u:function(a,b){var c=a.children[0].u(b).concat([16384|b.sc,12288|b.sc,4096,40960|Uf.indexOf("eq"),4,12288|b.sc,36864]);cg(b,c);a=oh(a.children[1],
a.children[0].resultType,b).F(b);c=c.concat(a.u(b));dg(b,c);return c}}),new W("||",V,{priority:50,ma:mh,F:function(a,b){return th(a,b,function(c){return c[0]||c[1]?1:0})},K:[32784],u:function(a,b){var c=a.children[0].u(b).concat([16384|b.sc,12288|b.sc,4096,40960|Uf.indexOf("ne"),4,12288|b.sc,36864]);cg(b,c);a=oh(a.children[1],a.children[0].resultType,b).F(b);c=c.concat(a.u(b));dg(b,c);return c}}),new W("?",V,{priority:40,ma:function(a,b,c){return c[1]},F:function(a){if(!(a.children[1]instanceof xg)||
0==a.children[1].Da||":"!==a.children[1].Da.name)throw"missing else part in conditional expression "+U(a.head);return a.children[0]instanceof rg?a.children[1].children[a.children[0].n?0:1]:a},u:function(a,b){var c=gh(a.children[0],b);cg(b,c);c=c.concat(a.children[1].children[0].u(b)).concat(36864);dg(b,c);cg(b,c);c=c.concat(a.children[1].children[1].u(b));dg(b,c);return c}}),new W(":",V,{priority:41,ma:mh,F:function(a,b){a.children[1]=oh(a.children[1],a.children[0].resultType,b);return a},u:function(a){throw"unexpected colon outside conditional expression "+
U(a.head);}}),new W("=",V,{priority:yg,ma:mh,F:qh}),new W(",",V,{priority:25,ma:function(a,b){return b[1]},F:function(a){a.children[0].tb=!1;return a}}),new W("false",3,{resultType:"b",F:function(a,b){return th(a,b,function(){return 0})},K:[4096]}),new W("true",3,{resultType:"b",F:function(a,b){return th(a,b,function(){return 1})},K:[4097]})];Q=Nf.prototype;
Q.Lg=function(){for(;this.b<this.M;)if(" "===this.m[this.b]||"\t"===this.m[this.b])this.b++,this.Fa++;else if("\n"===this.m[this.b])this.b++,this.Fa=0,this.line++;else if("\r"===this.m[this.b])this.b++;else if("/*"===this.m.slice(this.b,this.b+2))for(this.b+=2,this.Fa+=2;this.b<this.M&&"*/"!==this.m.slice(this.b-2,this.b);)"\n"===this.m[this.b]?(this.Fa=0,this.line++):"\r"!==this.m[this.b]&&this.Fa++,this.b++;else if("//"===this.m.slice(this.b,this.b+2))for(;this.b<this.M&&"\n"!==this.m[this.b];)this.b++,
this.Fa++;else break};Q.zf=function(a){return xb.prototype.zf.call(this,a||lh)};Q.Fg=function(){this.C.forEach(function(a,b){a instanceof mg&&("def"===a.name||0<=["int","bool","fixed","void"].indexOf(a.name))&&this.C[b+1]instanceof lg&&this.C[b+2]instanceof mg&&"("===this.C[b+2].name&&this.Sg.push(this.C[b+1].name)},this)};
function uh(a,b){switch(a.name){case "var":case "def":return b||Yf;case "void":return"v";case "int":return Yf;case "bool":return"b";case "fixed":return ug;default:throw"internal";}}function ph(a){switch(a){case Yf:return"int";case ug:return"fixed";case "b":return"bool";default:return""}}function vh(a){return $g(a,0,"int")||$g(a,0,"bool")||$g(a,0,"fixed")}
Q.yg=function(){function a(){var k=[];for(this.l++;;){d=this.C[this.l];this.l++;if(!Zg(this,0,mg))throw"syntax error "+U(c);switch(this.C[this.l].name){case "[":if($g(this,1,"]")){this.l+=2;if(!$g(this,0,"="))throw"missing size or initial value in array declaration"+U(this.C[this.l-2]);e=new xg(this.C[this.l],V,Yg(this,"=",V),[new vg(d)]);this.l++;e.children.push(ah(this,25));e.resultType=uh(c,e.children[1].resultType);e.children[1].Sa(this);e.tb=!1;var l=new xg(new mg(this.C[this.l].Bd,this.C[this.l].jd,
this.C[this.l].gd,"size"),0,Yg(this,"size",0),[e.children[1]]);k.push(new Mg(c,d,e.resultType,[l],e))}else l=bh(this,!0),$g(this,0,"=")?(e=new xg(this.C[this.l],V,Yg(this,"=",V),[new vg(d)]),this.l++,e.children.push(ah(this,25)),e.resultType=uh(c,e.children[1].resultType),e.tb=!1,k.push(new Mg(c,d,e.resultType,l,e))):k.push(new Mg(c,d,uh(c),l));break;case "=":e=new xg(this.C[this.l],V,Yg(this,"=",V),[new vg(d)]);this.l++;e.children.push(ah(this,25));e.resultType=uh(c,e.children[1].resultType);e.tb=
!1;e=e.F(this);k.push(new Mg(c,d,e.resultType,null,e));break;default:k.push(new Mg(c,d,uh(c)))}if($g(this,0,","))this.l++;else{if($g(this,0,";"))return this.l++,k;throw"missing semicolon "+U(this.C[this.l]);}}}function b(){var k=uh(c);d=this.C[this.l+1];this.l+=3;var l=[];if(!$g(this,0,")"))for(;;){var w=Yf;vh(this)&&(w=uh(this.C[this.l]),this.l++);if(!Zg(this,0,lg))throw"bad function definition argument "+U(this.C[this.l]);var n=this.C[this.l].name,v=[],m=!1;this.l++;$g(this,0,"[")&&(m=!0,v=bh(this,
!0));l.push({name:n,type:w,bh:v,size:1,v:[],Pc:m});if($g(this,0,","))this.l++;else if($g(this,0,")"))break;else throw"syntax error in function definition "+U(this.C[this.l]);}this.l++;if(!$g(this,0,"{"))throw"block expected after function header "+U(this.C[this.l]);this.l++;return new wh(c,d.name,k,l)}if(this.l>=this.C.length)throw"no more tokens";var c=this.C[this.l];if(this.C[this.l]instanceof mg)switch(c.name){case "const":if(!Zg(this,1,lg)||!$g(this,2,"="))throw'syntax error for "const" '+U(c);
var d=this.C[this.l+1];this.l+=3;var e=ah(this,25);e=e.F(this);if(!(e instanceof rg))throw"non-constant expression in constant definition "+U(this.C[this.l]);if(!$g(this,0,";"))throw"missing semicolon "+U(c);this.l++;return[new Lg(c,d.name,e)];case "int":case "bool":case "fixed":if(!Zg(this,1,lg))throw'unexpected token after "'+c.name+'" '+U(c);return $g(this,2,"(")?[b.call(this)]:a.call(this);case "void":return[b.call(this)];case "if":this.l++;var f=bh(this);if(1!==f.length)throw'bad condition in "if" statement '+
U(this.C[this.l]);var g=new Og(c,f[0]);$g(this,0,"{")?this.l++:g.za=!0;return[g];case "when":this.l++;f=bh(this);if(1!==f.length)throw'bad condition in "when" statement '+U(this.C[this.l]);if(!$g(this,0,"{"))throw'block expected after "when" statement '+U(this.C[this.l]);this.l++;return[new Rg(c,f[0])];case "switch":this.l++;f=bh(this);if(1!==f.length)throw'bad expression in "switch" statement '+U(this.C[this.l]);if(!$g(this,0,"{"))throw'block expected after "switch" statement '+U(this.C[this.l]);
this.l++;return[new xh(c,f[0])];case "case":this.l++;e=ah(this);if(!$g(this,0,":"))throw'missing colon after "case" '+U(this.C[this.l]);this.l++;return[new yh(c,e)];case "default":if(!$g(this,1,":"))throw'missing colon after "default" '+U(this.C[this.l]);this.l+=2;return[new yh(c,null)];case "goto":if(!Zg(this,1,lg))throw'missing label after "goto" '+U(this.C[this.l]);d=this.C[this.l+1];this.l+=2;return[new zh(c,d.name)];case "while":this.l++;f=bh(this);if(1!==f.length)throw'bad condition in "while" statement '+
U(this.C[this.l]);if($g(this,0,";"))return this.l++,[new Ah(c,f[0])];if(!$g(this,0,"{"))throw'block expected after "while" statement '+U(this.C[this.l]);this.l++;return[new Bh(c,f[0])];case "do":if(!$g(this,1,"{"))throw'block expected after "do" statement '+U(this.C[this.l]);this.l+=2;return[new Ch(c)];case "for":if(!$g(this,1,"("))throw'"for" syntax error '+U(c);this.l+=2;d=null;var h=Yf;if($g(this,0,";"))e=null;else{if($g(this,0,"var")||vh(this)){if(!Zg(this,1,lg))throw'bad variable declaration in "for" statement '+
U(this.C[this.l]);h=uh(this.C[this.l]);this.l++;d=this.C[this.l]}e=ah(this);if(!$g(this,0,";"))throw'semicolon expected in "for" statement '+U(this.C[this.l]);}this.l++;if($g(this,0,";"))g=null;else if(g=ah(this),!$g(this,0,";"))throw'semicolon expected in "for" statement '+U(this.C[this.l]);this.l++;if($g(this,0,")"))f=null;else if(f=ah(this),!$g(this,0,")"))throw'semicolon expected in "for" statement '+U(this.C[this.l]);this.l++;if(!$g(this,0,"{"))throw'block expected after "for" statement '+U(this.C[this.l]);
this.l++;return[new Dh(c,d,h,e,g,f)];case ";":return this.l++,[new Eh(c)];case "{":return this.l++,[new Fh(c)];case "}":this.l++;if($g(this,0,"else")){this.l++;if($g(this,0,"if")){this.l++;f=bh(this);if(1>f.length)throw'empty condition in "if" statement '+U(this.C[this.l]);1<f.length&&(g=new Ag(c),g.children=f.slice(0,-1).map(function(k){k instanceof xg&&(k.tb=!1);return k}),f=f.slice(-1));if(!$g(this,0,"{"))throw'block expected after "if" statement '+U(this.C[this.l]);this.l++;return[new Pg(c,f[0])]}if(!$g(this,
0,"{"))throw'block expected after "else" statement '+U(this.C[this.l]);this.l++;return[new Qg(c)]}return[new Wg(c)];case "else":throw'unexpected "else" '+U(this.C[this.l]);case "onevent":if(!Zg(this,1,lg))throw'unexpected token after "onevent" '+U(c);if(!$g(this,2,"{"))throw'block expected after "onevent" statement '+U(this.C[this.l]);d=this.C[this.l+1];this.l+=3;return[new Gh(c,d.name)];case "return":this.l++;$g(this,0,";")?e=null:e=ah(this);if(!$g(this,0,";"))throw"missing semicolon "+U(c);this.l++;
return[new Hh(c,e)];case "break":d=null;Zg(this,1,lg)&&(d=this.C[this.l+1],this.l++);if(!$g(this,1,";"))throw"missing semicolon "+U(c);this.l+=2;return[new Ih(c,!1,d?d.name:null)];case "continue":d=null;Zg(this,1,lg)&&(d=this.C[this.l+1],this.l++);if(!$g(this,1,";"))throw"missing semicolon "+U(c);this.l+=2;return[new Ih(c,!0,d?d.name:null)]}if(Zg(this,0,lg)&&$g(this,1,"(")&&(d=this.C[this.l],Zf(this.oa,d.name)))return this.l++,[new Ug(c,d.name,bh(this))];if(Zg(this,0,lg)&&$g(this,1,":"))return d=
this.C[this.l],this.l+=2,[new Jh(c,d.name)];e=ah(this);e.tb=!1;if(!$g(this,0,";"))throw"missing semicolon "+(this.l<this.C.length?U(this.C[this.l]):"eof");this.l++;e=e.F(this);return[new Ng(e)]};
Q.Oe=function(a){if(a instanceof wh){for(var b=0;b<a.B.length;b++)a.B[b].size=1,a.B[b].v=a.B[b].bh.map(function(c){c=c.F(this);if(!(c instanceof rg))throw"non-constant expression in argument dimension "+U(c.head);if(0>=c.n||Math.round(c.n)!==c.n)throw"bad value for argument dimension "+U(c.head);a.B[b].size*=c.n;return c.n},this),this.Ed(a.B[b].name,a.B[b].size,a.B[b].v,this.Na,a.B[b].type,a.B[b].Pc),this.Na+=a.B[b].Pc?1:a.B[b].size;a.Qa[1]={Za:this.Za.slice(),labels:this.labels.slice()}}else a instanceof
Dh?a.ga&&(this.Ed(a.ga.name,1,[1],this.Na,a.Oa),this.Na+=1,a.Qa[1]={Za:this.Za.slice(),labels:this.labels.slice()}):xb.prototype.Oe.call(this,a)};Q.Rd=function(){this.Za=this.gg;this.labels=this.fg};Q.ua=function(a){a&&(this.Za=a.Za,this.labels=a.labels)};Q.getContext=function(){return{Za:this.Za,labels:this.labels.slice()}};function Kh(a,b,c,d,e,f,g){Xf.call(this,a,b,c,d,e);this.zb=f;this.Pc=g||!1}Kh.prototype=Object.create(Xf.prototype);Q=Kh.prototype;Q.constructor=Kh;
Q.td=function(a,b){return this.zb?this.Pc?[12288|a.w,20480|this.offset,a.oa.b,20480|(b||0),a.oa.b]:[12288|a.w,20480|this.offset+(b||0),a.oa.b]:[12288|this.offset+(b||0)]};Q.ff=function(a,b){return this.zb?this.Pc?[12288|a.w,20480|this.offset,a.oa.b,24576|(b||0),a.oa.b]:[12288|a.w,24576|this.offset+(b||0),a.oa.b]:[16384|this.offset+(b||0)]};Q.De=function(a){return this.zb?this.Pc?[12288|a.w,20480|this.offset,a.oa.b,32770,20480,a.oa.b]:[12288|a.w,32770,20480|this.offset,a.oa.b]:[20480|this.offset,this.size]};
Q.Gf=function(a){return this.zb?this.Pc?[12288|a.w,20480|this.offset,a.oa.b,32770,24576,a.oa.b]:[12288|a.w,32770,24576|this.offset,a.oa.b]:[24576|this.offset,this.size]};Nf.prototype.Ed=function(a,b,c,d,e,f){this.Za.push(new Kh(a,b,c,d,e,this.zb,f))};function Lh(a){xg.call(this,a,4,null)}Lh.prototype=Object.create(xg.prototype);Lh.prototype.constructor=Lh;Q=Nf.prototype;
Q.tg=function(a){var b=new Lh(a,this.zb,this.Na);b.Da={ma:function(c,d){var e;a:{for(e=0;e<c.ef.length;e++)if(c.ef[e].Ff===a.name){e=c.ef[e];break a}e=null}return e?e.resultType:(e=fg(c,a.name))&&e.ma?e.ma(c,e,d):Yf}};return b};
Q.ig=function(){this.Na=this.oa.Na;this.zb=!1;for(var a=[],b=0;b<this.h.length;b++){if(0<=[Wg,Pg,Qg].indexOf(this.h[b].constructor)){if(0===a.length)throw"unexpected end of block "+U(this.h[b].head);var c=a.pop();this.Na=c.Na;this.zb=c.zb;c.kh.Qa[0]={Za:this.Za.slice(),labels:this.labels.slice()};this.Za.splice(c.nh);this.labels.pop();0===a.length&&(this.za=pg)}0<=[Og,Rg,xh,Bh,Fh,Dh,Gh,wh,Pg,Qg].indexOf(this.h[b].constructor)&&(a.push({Na:this.Na,zb:this.zb,nh:this.Za.length,kh:this.h[b]}),this.labels.push([]),
this.h[b]instanceof wh&&(this.zb=!0,this.za=this.h[b].resultType,this.Na=0));this.Oe(this.h[b]);if(this.h[b]instanceof Jh){c=this.h[b].label;for(var d=this.labels.length-1,e=0;e<this.labels[d].length;e++)if(this.labels[d][e].label===c)throw'duplicate label "'+c+'"';this.labels[d].push({label:c})}}this.gg=this.Za.slice();this.fg=this.labels};
Q.Eg=function(){for(var a=1;a<this.h.length;)this.h[a]instanceof Ah&&this.h[a-1]instanceof Wg?this.h.splice(a-1,1):a++;this.h.forEach(function(b){b instanceof wh&&(this.ef.push(b),this.za=b.resultType)},this);for(a=0;a<this.h.length-1;a++)this.h[a]instanceof Jh&&(this.h[a+1]instanceof Bh?this.h[a+1].label=this.h[a].label:this.h[a+1]instanceof Ch?this.h[a+1].label=this.h[a].label:this.h[a+1]instanceof Dh?this.h[a+1].label=this.h[a].label:this.h[a+1]instanceof xh&&(this.h[a+1].label=this.h[a].label))};
Q.Gg=function(){for(var a=0;a<this.h.length;a++)(this.h[a]instanceof Gh||this.h[a]instanceof wh)&&this.o.push(this.h[a])};function Mh(a,b){for(var c=a.length-1;0<=c;c--)for(var d=a[c].length-1;0<=d;d--)if(a[c][d].label===b)return a[c][d];return null}
Q.u=function(){this.hb=[];this.Rd();this.Vb=[];this.sc=this.kc=this.Wc=this.oa.b-2;this.w=this.sc+1;this.hg=[];var a=this.o.map(function(h){this.La=0;this.ua(h.Qa[0]);this.Kf=h instanceof Jg||h instanceof wh;this.zb=h instanceof wh;this.Vb=[];h=h.u(this,!0);ih(h);return{Gd:h,mapping:this.Vb}},this);if(0<this.hb.length)throw"internal";for(var b=0,c=0;c<this.o.length;c++)this.o[c]instanceof Ig&&b++;var d=[],e={},f=[];this.Vb=[];for(c=0;c<this.o.length;c++){var g=1+2*b+f.length;this.o[c]instanceof Gh||
this.o[c]instanceof Ig?(d.push({id:ag(this.oa,this.o[c].cf),offset:f.length}),f=f.concat(a[c].Gd)):this.o[c]instanceof Jg?(e[this.o[c].Og]=f.length,f=f.concat(a[c].Gd)):this.o[c]instanceof wh&&(e[this.o[c].Ff]=f.length,f=f.concat(a[c].Gd));this.Vb=this.Vb.concat(a[c].mapping.map(function(h){return new Wf(h.Mg,h.line,h.Fa,h.Ob+g)}))}a=[1+2*d.length];for(c=0;c<d.length;c++)a=a.concat(d[c].id,1+2*d.length+d[c].offset);for(c=0;c<f.length;c++)if("string"===typeof f[c]){if(void 0===e[f[c]])throw Oh(f[c]),
'unknown function "'+f[c]+'"';f[c]=53248|e[f[c]]+a.length}return a.concat(f)};
Q.sg=function(a){for(var b=a.head.name,c=0;c<this.o.length;c++)if(this.o[c]instanceof wh&&this.o[c].Ff===b){if(a.children.length!==this.o[c].B.length)throw"wrong number of arguments "+U(a.head);b=a.tb?[b,12288|this.sc]:[b];this.zb?0<this.Na&&(b=[12288|this.w,4096|this.Na,32770,16384|this.w].concat(b,12288|this.w,4096|this.Na,32771,16384|this.w)):b=[4096|this.Na,16384|this.w].concat(b);for(var d=[],e=0;e<a.children.length;e++){if(this.o[c].B[e].size!==a.children[e].nb)throw"incompatible size "+U(a.children[e].head);
if(this.o[c].B[e].Pc){if(!(a.children[e]instanceof vg))throw"variable reference expected "+U(a.children[e].head);if(this.o[c].B[e].type!==a.children[e].resultType)throw"variable reference type mismatch "+U(a.children[e].head);}if(this.o[c].B[e].Pc){var f=eg(this,a.children[e]);d=d.concat(f.zb?f.Pc?[12288|this.w,20480|f.offset,this.oa.b]:[12288|this.w,4096|f.offset,32770]:[4096|f.offset]).concat(this.zb?[12288|this.w,24576|e+this.Na,this.oa.b]:16384|e+this.Na)}else a.children[e]=oh(a.children[e],this.o[c].B[e].type,
this).F(this),d=d.concat(a.children[e].u(this)).concat(this.qb(a.children[e].resultType,this.o[c].B[e].type),this.zb?[12288|this.w,24576|e+this.Na,this.oa.b]:16384|e+this.Na)}return d.concat(b)}return null};function Ph(a){a=a.trim();if(""===a)return!1;var b=["#","//","/*"].map(function(c){c=a.indexOf(c);return 0>c?a.length:c}).sort(function(c,d){return c-d})[0];return b<a.length?"#"!==a[b]:/[;{]/.test(a)}tg.prototype.u=function(a){return eh(Math.round(this.n*a.rb))};
function Fh(a){Eg.call(this,a,3)}Fh.prototype=Object.create(Eg.prototype);Fh.prototype.constructor=Fh;Fh.prototype.F=function(a){qg(this.children,a);return this};Fh.prototype.u=function(a){var b=a.getContext();Gg(this,a);a.ua(this.Qa[0]);var c=og.prototype.u.call(this,a);a.ua(b);return c};function Eh(a){Eg.call(this,a)}Eh.prototype=Object.create(Eg.prototype);Eh.prototype.constructor=Eh;Eh.prototype.u=function(){return[]};function Bh(a,b){Sg.call(this,a,b);this.label=null}Bh.prototype=Object.create(Sg.prototype);
Bh.prototype.constructor=Bh;Bh.prototype.u=function(a){if(null==this.Ga&&0===this.children.length)return[];var b=a.getContext();Gg(this,a);var c=[],d=a.La;a.Oa.push({});null!=this.Ga&&(c=gh(this.Ga,a));cg(a,c);a.ua(this.Qa[0]);this.children.forEach(function(e){a.La=d+c.length;c=c.concat(e.u(a))});c=c.concat(36864|-c.length&4095);dg(a,c);Qh(c,0,c.length,this.label);a.Oa.pop();a.ua(b);return c};function Ch(a){Eg.call(this,a,3);this.label=this.Ga=null}Ch.prototype=Object.create(Eg.prototype);
Ch.prototype.constructor=Ch;Ch.prototype.Cg=function(a){if(!(a instanceof Ah))throw'unexpected closing statement for "do"';this.Ga=a.Ga};
Ch.prototype.u=function(a){if(null==this.Ga&&0===this.children.length)return[];var b=a.getContext();Gg(this,a);var c=[],d=a.La;a.Oa.push({});a.ua(this.Qa[0]);this.children.forEach(function(e){a.La=d+c.length;c=c.concat(e.u(a))});null!=this.Ga&&(c=c.concat(gh(new xg(new mg(this.Ga.head.Bd,this.Ga.head.jd,this.Ga.head.gd,"not"),0,Yg(a,"!",0),[this.Ga]),a)),cg(a,c),dg(a,c,0));Qh(c,0,c.length,this.label);a.Oa.pop();a.ua(b);return c};function Ah(a,b){Eg.call(this,a,5);this.Ga=b}Ah.prototype=Object.create(Eg.prototype);
Ah.prototype.constructor=Ah;function Dh(a,b,c,d,e,f){Eg.call(this,a,3);d&&(d.tb=!1);f&&(f.tb=!1);this.ga=b;this.Oa=c;this.h=d;this.b=e;this.m=f;this.label=null;this.R=[]}Dh.prototype=Object.create(Eg.prototype);Q=Dh.prototype;Q.constructor=Dh;Q.Sa=function(a){og.prototype.Sa.call(this,a);this.h&&this.h.Sa(a);this.b&&this.b.Sa(a);this.m&&this.m.Sa(a)};Q.F=function(a){this.h&&(this.h=this.h.F(a));this.b&&(this.b=this.b.F(a));this.m&&(this.m=this.m.F(a));qg(this.children,a);return this};
Q.Qd=function(a,b){this.R.push(b)};
Q.u=function(a){var b=a.getContext();Gg(this,a);a.ua(this.Qa[1]);var c=a.La,d=this.h?this.h.u(a):[];a.Oa.push({});var e=d.length;this.b&&(d=d.concat(gh(this.b,a)),cg(a,d));a.ua(this.Qa[0]);for(var f=0;f<this.children.length;f++)a.La=c+d.length,d=d.concat(this.children[f].u(a));a.ua(this.Qa[1]);f=d.length;a.La=c+d.length;ng(a,this.R[0]);this.m&&(d=d.concat(this.m.u(a)));d=d.concat(36864|e-d.length&4095);this.b&&dg(a,d);Qh(d,f,d.length,this.label);a.Oa.pop();a.ua(b);return d};
function Ih(a,b,c){Eg.call(this,a);this.M=b;this.label=c}Ih.prototype=Object.create(Eg.prototype);Ih.prototype.constructor=Ih;function Rh(a,b){Hg.call(this,a,b)}Rh.prototype=Object.create(Hg.prototype);Rh.prototype.constructor=Rh;function Qh(a,b,c,d){for(var e=0;e<a.length;e++)if(a[e]instanceof Rh){var f=a[e].ka.label;if(null==f||f===d)a[e]=a[e].ka.M?36864|b-e&4095:36864|c-e&4095}}
function Oh(a){if(a instanceof Rh){var b=a.ka.label;if(null!=b)throw"unknown "+(a.ka.M?"continue":"break")+' label "'+b+'"'+U(a.ka.head);throw'unexpected "'+(a.ka.M?"continue":"break")+'" '+U(a.ka.head);}}Ih.prototype.u=function(a){if(0===a.Oa.length)throw(this.M?'"continue"':'"break"')+" outside loop "+U(this.head);Gg(this,a);return[new Rh(a,this)]};function xh(a,b){Eg.call(this,a,3);this.o=b;this.label=null}xh.prototype=Object.create(Eg.prototype);xh.prototype.constructor=xh;
xh.prototype.u=function(a){var b=a.La,c=this.o.u(a).concat(16384|a.sc),d=a.getContext();a.ua(this.Qa[0]);var e=!(this.children[0]instanceof yh);e&&(c=c.concat(36864),cg(a,c));a.Oa.push({});for(var f=!1,g=0;g<this.children.length;)if(a.La=b+c.length,this.children[g]instanceof yh){for(var h=[],k=!1;g<this.children.length&&this.children[g]instanceof yh;){if(null!=this.children[g].o){var l=this.children[g].o.F(a);if(!(l instanceof rg))throw'non-constant expression in "case" '+U(this.children[g].head);
h.push(l.n)}else k=!0;g++}k?e&&(dg(a,c),e=!1):(1===h.length?(f&&(c=c.concat(36869)),e&&dg(a,c),c=c.concat(12288|a.sc).concat(eh(h[0])).concat(40960|Uf.indexOf("eq"),0)):(f&&(c=c.concat(36864|4*h.length+1)),e&&dg(a,c),h.forEach(function(w,n){c=c.concat(12288|a.sc).concat(eh(w)).concat(40960|Uf.indexOf("ne"),4*(h.length-n)-1)}),c=c.concat(36864)),cg(a,c),e=!0);f=!0}else c=c.concat(this.children[g].u(a)),f=!(this.children[g]instanceof Ih)&&!(this.children[g]instanceof Hh),g++;Qh(c,-1,c.length,this.label);
a.Oa.pop();a.ua(d);return c};function yh(a,b){Eg.call(this,a);this.o=b}yh.prototype=Object.create(Eg.prototype);yh.prototype.constructor=yh;yh.prototype.u=function(){throw(this.o?'"case"':'"default"')+" outside switch "+U(this.head);};function Jh(a,b){Eg.call(this,a);this.label=b}Jh.prototype=Object.create(Eg.prototype);Jh.prototype.constructor=Jh;Jh.prototype.u=function(a){a.label=this.label;Mh(a.labels,this.label).Tg=a.La;return[]};function zh(a,b){Eg.call(this,a);this.label=b}zh.prototype=Object.create(Eg.prototype);
zh.prototype.constructor=zh;function Sh(a,b,c){Hg.call(this,a,b);this.labels=c}Sh.prototype=Object.create(Hg.prototype);Sh.prototype.constructor=Sh;Sh.prototype.u=function(a){var b=Mh(this.labels,this.ka.label);if(null===b)throw'unknown label "'+this.ka.label+'" '+U(this.ka.head);return 36864|b.Tg-a&4095};zh.prototype.u=function(a){return[new Sh(a,this,a.labels.slice())]};function Gh(a,b){Eg.call(this,a,3);this.cf=b}Gh.prototype=Object.create(Eg.prototype);Gh.prototype.constructor=Gh;
Gh.prototype.F=function(a){qg(this.children,a);return this};Gh.prototype.u=function(a,b){if(b){b=a.getContext();Gg(this,a);a.ua(this.Qa[0]);var c=og.prototype.u.call(this,a).concat(0);a.ua(b);return c}return[]};function wh(a,b,c,d){Eg.call(this,a,3);this.Ff=b;this.resultType=c;this.B=d}wh.prototype=Object.create(Eg.prototype);wh.prototype.constructor=wh;wh.prototype.Bg=function(a){a.za=this.resultType};wh.prototype.F=function(a){qg(this.children,a);return this};
wh.prototype.u=function(a,b){if(b){b=a.getContext();Gg(this,a);a.ua(this.Qa[0]);var c=og.prototype.u.call(this,a).concat(57344);a.ua(b);return c}return[]};function Hh(a,b){Eg.call(this,a);b&&this.children.push(b)}Hh.prototype=Object.create(Eg.prototype);Hh.prototype.constructor=Hh;
Hh.prototype.Qd=function(a){if(a.za===pg)throw'"return" outside function definition '+U(this.head);if("v"===a.za&&0<this.children.length)throw"unexpected return value in void function "+U(this.head);if("v"!==a.za&&0===this.children.length)throw"missing return value in non-void function "+U(this.head);0<this.children.length&&(this.children[0]=oh(this.children[0],a.za,a).F(a))};
Hh.prototype.u=function(a){Gg(this,a);var b=[];0<this.children.length&&(b=this.children[0].u(a).concat(a.qb(this.children[0].resultType,a.za)).concat(16384|a.sc));return b.concat(57344)};var Of=[{name:"abs",ad:1,ma:function(a,b){return b[0]},Ce:function(){return!0},Jb:function(a,b,c,d){return[12288|d,28673]}},{name:"atan2",ad:2,je:1,ma:function(){return ug},Ce:function(a){return null!=Zf(a,"math.atan2")},Jb:function(a,b,c,d){return(c[0]===ug&&c[1]!==ug?[12288|d+1,4096|a.rb,32772,16384|d+1]:c[0]!==ug&&c[1]===ug?[12288|d,4096|a.rb,32772,16384|d]:[]).concat([4097,4096|d+1,4096|d,4096|d+2,49152|Zf(b,"math.atan2").id,12288|d+2,4096|Math.floor(32768/(a.rb*Math.PI)),32773])}},{name:"cos",
ad:1,je:1,ma:function(){return ug},Ce:function(a){return null!=Zf(a,"math.cos")},Jb:function(a,b,c,d){return[12288|d,4096|Math.round(32767/((c[0]===ug?a.rb:1)*Math.PI)),32772,16384|d,4097,4096|d,4096|d+1,49152|Zf(b,"math.cos").id,12288|d+1,4096|Math.floor(32768/a.rb),32773]}},jh("rand","math.rand",0),{name:"random",ad:0,je:1,ma:function(){return ug},Ce:function(a){return null!=Zf(a,"math.rand")},Jb:function(a,b,c,d){return[4097,4096|d,49152|Zf(b,"math.rand").id,12288|d,28673,4096|Math.floor(32768/
a.rb),32773]}},{name:"stop",ad:0,ma:function(){return"v"},Jb:function(){return[0]}},{name:"sin",ad:1,je:1,ma:function(){return ug},Ce:function(a){return null!=Zf(a,"math.sin")},Jb:function(a,b,c,d){return[12288|d,4096|Math.round(32767/((c[0]===ug?a.rb:1)*Math.PI)),32772,16384|d,4097,4096|d,4096|d+1,49152|Zf(b,"math.sin").id,12288|d+1,4096|Math.floor(32768/a.rb),32773]}},{name:"sqrt",ad:1,je:6,ma:function(){return ug},Jb:function(a,b,c,d){b=eh(c[0]===ug?a.rb:a.rb*a.rb);return[4096|a.rb,16384|d+1,4106,
16384|d+2,12288|d,16384|d+4].concat(b,[16384|d+5,12288|d+1,16384|d+6,4097,4096|d+6,4096|d+5,4096|d+4,4096|d+3,49152|Zf(a.oa,"math.muldiv").id,12288|d+3,12288|d+1,32770,4098,32773,16384|d+1,12288|d+2,4097,32771,16384|d+2,12288|d+2,4096,40960|Uf.indexOf("le"),-(23+b.length)&65535,12288|d+1])}}];var wb={name:"thymio-II",maxVarSize:620,variables:[{name:"_id",size:1},{name:"event.source",size:1},{name:"event.args",size:32},{name:"_fwversion",size:2},{name:"_productId",size:1},{name:"buttons._raw",size:5},{name:"button.backward",size:1},{name:"button.left",size:1},{name:"button.center",size:1},{name:"button.forward",size:1},{name:"button.right",size:1},{name:"buttons._mean",size:5},{name:"buttons._noise",size:5},{name:"prox.horizontal",size:7},{name:"prox.comm.rx._payloads",size:7},{name:"prox.comm.rx._intensities",
size:7},{name:"prox.comm.rx",size:1},{name:"prox.comm.tx",size:1},{name:"prox.ground.ambiant",size:2},{name:"prox.ground.reflected",size:2},{name:"prox.ground.delta",size:2},{name:"motor.left.target",size:1},{name:"motor.right.target",size:1},{name:"_vbat",size:2},{name:"_imot",size:2},{name:"motor.left.speed",size:1},{name:"motor.right.speed",size:1},{name:"motor.left.pwm",size:1},{name:"motor.right.pwm",size:1},{name:"acc",size:3},{name:"temperature",size:1},{name:"rc5.address",size:1},{name:"rc5.command",
size:1},{name:"mic.intensity",size:1},{name:"mic.threshold",size:1},{name:"mic._mean",size:1},{name:"timer.period",size:2},{name:"acc._tap",size:1}],localEvents:[{name:"button.backward"},{name:"button.left"},{name:"button.center"},{name:"button.forward"},{name:"button.right"},{name:"buttons"},{name:"prox"},{name:"prox.comm"},{name:"tap"},{name:"acc"},{name:"mic"},{name:"sound.finished"},{name:"temperature"},{name:"rc5"},{name:"motor"},{name:"timer0"},{name:"timer1"}],nativeFunctions:[{name:"_system_reboot",
args:[]},{name:"_system_settings_read",args:[1,1]},{name:"_system_settings_write",args:[1,1]},{name:"_system_settings_flash",args:[]},{name:"math.copy",args:[-1,-1]},{name:"math.fill",args:[-1,1]},{name:"math.addscalar",args:[-1,-1,1]},{name:"math.add",args:[-1,-1,-1]},{name:"math.sub",args:[-1,-1,-1]},{name:"math.mul",args:[-1,-1,-1]},{name:"math.div",args:[-1,-1,-1]},{name:"math.min",args:[-1,-1,-1]},{name:"math.max",args:[-1,-1,-1]},{name:"math.clamp",args:[-1,-1,-1,-1]},{name:"math.dot",args:[1,
-1,-1,1]},{name:"math.stat",args:[-1,1,1,1]},{name:"math.argbounds",args:[-1,1,1]},{name:"math.sort",args:[-1]},{name:"math.muldiv",args:[-1,-1,-1,-1]},{name:"math.atan2",args:[-1,-1,-1]},{name:"math.sin",args:[-1,-1]},{name:"math.cos",args:[-1,-1]},{name:"math.rot2",args:[2,2,1]},{name:"math.sqrt",args:[-1,-1]},{name:"math.rand",args:[-1]},{name:"_leds.set",args:[1,1]},{name:"sound.record",args:[1]},{name:"sound.play",args:[1]},{name:"sound.replay",args:[1]},{name:"sound.system",args:[1]},{name:"leds.circle",
args:[1,1,1,1,1,1,1,1]},{name:"leds.top",args:[1,1,1]},{name:"leds.bottom.left",args:[1,1,1]},{name:"leds.bottom.right",args:[1,1,1]},{name:"sound.freq",args:[1,1]},{name:"leds.buttons",args:[1,1,1,1]},{name:"leds.prox.h",args:[1,1,1,1,1,1,1,1]},{name:"leds.prox.v",args:[1,1]},{name:"leds.rc",args:[1]},{name:"leds.sound",args:[1]},{name:"leds.temperature",args:[1,1]},{name:"sound.wave",args:[142]},{name:"prox.comm.enable",args:[1]},{name:"sd.open",args:[1,1]},{name:"sd.write",args:[-1,1]},{name:"sd.read",
args:[-1,1]},{name:"sd.seek",args:[1,1]},{name:"_rf.nodeid",args:[1]},{name:"_poweroff",args:[]}]};function Qf(a,b){this.oa=a;this.b=b}function Th(a){var b={};a.oa.Xa.forEach(function(c){b[c.name]=c.offset});b._userdata=a.oa.Na;b._topdata=a.oa.b;b["_ev.init"]=65535;a.oa.wd.forEach(function(c,d){b["_ev."+c.name]=65534-d});a.oa.Lb.forEach(function(c){b["_nf."+c.name]=c.id});return b}
function Pf(a){for(var b=a.b.split("\n"),c=[],d=Th(a),e=0;2>e;e++){c=[];var f=null;b.forEach(function(g,h){var k=/^\s*(;.*)?$/.exec(g);if(!k)if(k=/^\s*([\w_.]+:)\s*(;.*)?$/i.exec(g))f=k[1].slice(0,-1),d[f]=c.length;else if(k=/^\s*([\w_.]+:)?\s*([a-z0-9.]+)([-+a-z0-9\s._,=]*)(;.*)?$/i.exec(g)){if(k[1]&&(f=k[1].slice(0,-1),d[f]=c.length),g=k[2],k=k[3].trim(),g){var l=0<k.length?k.split(",").map(function(w){return w.trim().split(/\s+/)}):[];l=[].concat.apply([],l);k=Uh[g];if(void 0==k)throw'Unknown instruction "'+
g+'" (line '+(h+1).toString(10)+")";if(-1!==k.Mb&&(k.Mb||0)!=l.length)throw"Wrong number of arguments (line "+(h+1).toString(10)+")";void 0!==k.code?c=c.concat(k.code):k.Fb&&(g=l.map(function(w){/^[a-z]+=/.test(w)&&(w=w.replace(/^[a-z]+=/,""));return/^(0x[0-9a-f]+|[0-9]+)$/i.test(w)?parseInt(w,0):w}),c=c.concat(k.Fb(c.length,g,f,1==e?d:null,h+1)));f&&d[f]!==c.length&&(f=null)}}else throw"Syntax error (line "+(h+1).toString(10)+")";},a)}return c}
function Vh(a,b,c){function d(k){if(null==b)return 0;if(/^(0x[0-9a-f]+|[0-9]+)$/i.test(k))return parseInt(k,0);if(!b.hasOwnProperty(k))throw'Unknown symbol "'+a+'" (line '+c.toString(10)+")";return b[k]}if("string"===typeof a){for(var e=0,f=!1,g=0;g<a.length;){var h=/^(\+|-|[._a-z0-9]+)/i.exec(a.slice(g));if(null==h)throw"Syntax error (line "+c.toString(10)+")";switch(h[0]){case "+":f=!1;break;case "-":f=!0;break;default:e+=f?-d(h[0]):d(h[0])}g+=h[0].length}return e}return a}
var Uh={dc:{Mb:-1,Fb:function(a,b,c,d,e){return b.map(function(f){f=Vh(f,d,e);return f&65535})}},equ:{Mb:1,Fb:function(a,b,c,d,e){if(!c)throw'No label for pseudo-instruction "equ" (line '+e.toString(10)+")";d&&(d[c]=Vh(b[0],d,e));return[]}},stop:{code:[0]},"push.s":{Mb:1,Fb:function(a,b,c,d,e){a=Vh(b[0],d,e);if(4096<=a||4096<-a)throw"Small integer overflow (line "+e.toString(10)+")";return[4096|a&4095]}},push:{Mb:1,Fb:function(a,b,c,d,e){return[8192,Vh(b[0],d,e)&65535]}},load:{Mb:1,Fb:function(a,
b,c,d,e){a=Vh(b[0],d,e);if(0>a||4096<=a)throw"Data address out of range (line "+e.toString(10)+")";return[12288|a&4095]}},store:{Mb:1,Fb:function(a,b,c,d,e){a=Vh(b[0],d,e);if(0>a||4096<=a)throw"Data address out of range (line "+e.toString(10)+")";return[16384|a&4095]}},"load.ind":{Mb:2,Fb:function(a,b,c,d,e){a=Vh(b[0],d,e);if(0>a||4096<=a)throw"Data address out of range (line "+e.toString(10)+")";b=Vh(b[1],d,e);return[20480|a&4095,b&65535]}},"store.ind":{Mb:2,Fb:function(a,b,c,d,e){a=Vh(b[0],d,e);
if(0>a||4096<=a)throw"Data address out of range (line "+e.toString(10)+")";b=Vh(b[1],d,e);return[24576|a&4095,b&65535]}},neg:{code:[28672]},abs:{code:[28673]},bitnot:{code:[28674]},not:{Fb:function(a,b,c,d,e){throw"Unary not not implemented in the VM (line "+e.toString(10)+")";}},sl:{code:[32768]},asr:{code:[32769]},add:{code:[32770]},sub:{code:[32771]},mult:{code:[32772]},div:{code:[32773]},mod:{code:[32774]},bitor:{code:[32775]},bitxor:{code:[32776]},bitand:{code:[32777]},eq:{code:[32778]},ne:{code:[32779]},
gt:{code:[32780]},ge:{code:[32781]},lt:{code:[32782]},le:{code:[32783]},or:{code:[32784]},and:{code:[32785]},jump:{Mb:1,Fb:function(a,b,c,d,e){return[36864|Vh(b[0],d,e)-a&4095]}},"jump.if.not":{Mb:2,Fb:function(a,b,c,d,e){c=Uh[b[0]];if(void 0==c||void 0==c.code||1!==c.code.length||32768!==(c.code[0]&61440))throw'Unknown op "'+b[0]+'" for jump.if.not (line '+e.toString(10)+")";b=Vh(b[1],d,e);return[40960|c.code[0]&255,b-a&65535]}},"do.jump.when.not":{Mb:2,Fb:function(a,b,c,d,e){c=Uh[b[0]];if(void 0==
c||void 0==c.code||1!==c.code.length||32768!==(c.code[0]&61440))throw'Unknown op "'+b[0]+'" for do.jump.when.not (line '+e.toString(10)+")";b=Vh(b[1],d,e);return[41216|c.code[0]&255,b-a&65535]}},"do.jump.always":{Mb:2,Fb:function(a,b,c,d,e){c=Uh[b[0]];if(void 0==c||void 0==c.code||1!==c.code.length||32768!==(c.code[0]&61440))throw'Unknown op "'+b[0]+'" for do.jump.always (line '+e.toString(10)+")";b=Vh(b[1],d,e);return[41728|c.code[0]&255,b-a&65535]}},emit:{Mb:3,Fb:function(a,b,c,d,e){a=Vh(b[0],d,
e);if(0>a||4096<=a)throw"Event id out of range (line "+e.toString(10)+")";c=Vh(b[1],d,e);b=Vh(b[2],d,e);return[45056|a&4095,c&65535,b&65535]}},callnat:{Mb:1,Fb:function(a,b,c,d,e){a=Vh(b[0],d,e);if(0>a||4096<=a)throw"Native call id out of range (line "+e.toString(10)+")";return[49152|a&4095]}},callsub:{Mb:1,Fb:function(a,b,c,d,e){a=Vh(b[0],d,e);if(0>a||4096<=a)throw"Subroutine address out of range (line "+e.toString(10)+")";return[53248|a&4095]}},ret:{code:[57344]}};function Wh(a,b,c){this.id=a;this.o=b;if(c instanceof ArrayBuffer)this.h=c;else if(c){for(a=b=0;a<c.length;a++)b="string"===typeof c[a]?b+(1+c[a].length):b+2;b=new ArrayBuffer(b);for(var d=new DataView(b),e=a=0;a<c.length;a++)if("string"===typeof c[a]){d.setUint8(e++,c[a].length);for(var f=0;f<c[a].length;f++)d.setUint8(e++,c[a].charCodeAt(f))}else 32768>c[a]?d.setInt16(e,c[a],!0):d.setUint16(e,c[a],!0),e+=2;this.h=b}else this.h=new ArrayBuffer(0)}
function Xh(a){function b(g){for(var h=[],k=0,l=0;l<g.length;l++)if(g[l]){for(var w=c.getUint8(k),n="",v=0;v<w;v++)n+=String.fromCharCode(c.getUint8(k+1+v));h.push(n);k+=1+w}else h.push(c.getUint16(k,!0)),k+=2;return h}var c=new DataView(a.h);switch(a.id){case Yh:var d=b([!0,!1,!1,!1,!1,!1,!1,!1]);a.nodeName=d[0];a.be=d[2];a.pe=d[3];a.Dd=d[4];break;case Zh:d=b([!1,!0]);a.Na=d[0];a.R=d[1];break;case $h:d=b([!0,!0]);break;case ai:var e=[!0,!0,!1];d=b(e);a.functionName=d[0];a.w=d[2];for(var f=0;f<a.w;f++)e.push(!1),
e.push(!0);d=b(e);a.ea=[];for(f=0;f<a.w;f++)a.ea.push({size:d[3+2*f]-(d[3+2*f]&32768?65536:0),name:d[4+2*f]});break;case bi:c.getUint16(0,!0);a.Fc=[];for(f=2;f<c.byteLength;f+=2)a.Fc.push(c.getUint16(f,!0));break;case ci:a.b=c.getUint16(0,!0);f=c.getUint16(2,!0);a.flags={flags:f,wh:0!==(f&1),Bh:0!==(f&2),xh:0!==(f&4)};break;case di:a.b=c.getUint16(2,!0);a.result=c.getUint16(4,!0);break;case ei:a.m=c.getUint16(0,!0);c.getUint16(2,!0);d=[];for(f=4;f<c.byteLength;f+=2)d.push(c.getUint16(f,!0));a.Gd=
d;break;case fi:case gi:case hi:case ii:case ji:case ki:case li:a.m=c.getUint16(0,!0);break;case mi:case ni:a.m=c.getUint16(0,!0);a.b=c.getUint16(2,!0);break;case oi:a.m=c.getUint16(0,!0);c.getUint16(2,!0);c.getUint16(4,!0);break;case pi:a.m=c.getUint16(0,!0);c.getUint16(2,!0);d=[];for(f=4;f<c.byteLength;f+=2)d.push(c.getUint16(f,!0));break;case qi:a.version=c.getUint16(0,!0)}}
function ri(a){var b=new ArrayBuffer(6+a.h.byteLength),c=new DataView(b);c.setUint16(0,a.h.byteLength,!0);c.setUint16(2,a.o,!0);c.setUint16(4,a.id,!0);(new Uint8Array(b)).set(new Uint8Array(a.h),6);return b}Wh.prototype.ob=function(){var a=new Wh(this.id,this.o,this.h);Xh(a);return a};Wh.prototype.toString=function(){var a=si[this.id]||"0x"+this.id.toString(16);a+=" from "+this.o.toString(10);0<=this.m&&(a+=" to "+this.m.toString());return a};
var Yh=36864,Zh=36865,$h=36866,ai=36867,bi=36869,ci=36874,di=36875,ei=40961,gi=40962,hi=40963,ii=40964,ji=40965,ki=40966,li=40967,mi=40968,ni=40969,fi=40970,oi=40971,pi=40972,qi=40977,si={36864:"description",36865:"namedVariableDescription",36866:"localEventDescription",36867:"nativeFunctionDescription",36869:"variables",36874:"executionStateChanged",36876:"nodePresent",40960:"getDescription",40961:"setBytecode",40962:"reset",40963:"run",40964:"pause",40965:"step",40966:"stop",40967:"getExecutionState",
40968:"breakpointSet",40969:"breakpointClear",40970:"breakpointClearAll",40971:"getVariables",40972:"setVariables",40976:"getNodeDescription",40977:"listNodes"};function ti(a){this.Od=a&&a.Od||54321;this.Xa=a&&a.Xa||[];this.wd=a&&a.wd||[];this.Lb=a&&a.Lb||[];this.be=a&&a.be||500;this.pe=a&&a.pe||200;this.Dd=a&&a.Dd||200;a=[];for(var b=0,c=0;c<this.Xa.length;c++)this.Xa[c].offset=b,a=a.concat(this.Xa[c].S),b+=this.Xa[c].S.length;for(;a.length<this.Dd;)a.push(0);this.Fc=a;this.K=[];this.b=0;this.h=!1;this.m=!0;this.o=!1;this.stack=[];this.R=[];this.write=this.w=this.M=null}
ti.prototype.ob=function(){var a=new ti({Od:this.Od,Xa:this.Xa,wd:this.wd,Lb:this.Lb,be:this.be,pe:this.pe,Dd:this.Dd});a.be=this.be;a.pe=this.pe;a.Dd=this.Dd;a.K=this.K.slice();a.b=this.b;a.h=this.h;a.m=this.m;a.o=this.o;a.stack=this.stack.slice();a.R=this.R.slice();return a};
function ui(a,b,c){if(a.M)for(var d=0;d<a.Xa.length;d++)if(a.Xa[d].offset+a.Xa[d].S.length>b&&a.Xa[d].offset<b+c.length)for(var e=0;e<a.Xa[d].S.length;e++)0<=a.Xa[d].offset+e-b&&a.Xa[d].offset+e-b<c.length&&a.M(a.Xa[d].name,e,c[a.Xa[d].offset+e-b],a.Fc[a.Xa[d].offset+e]);c.forEach(function(f,g){this.Fc[b+g]=f},a)}function vi(a,b){a:{if(0<a.K.length)for(var c=1;c<a.K[0];c+=2)if(a.K[c]==b){b=a.K[c+1];break a}b=null}null!==b&&(a.h&&(c=new Wh(36872,a.Od,[a.b]),a.write&&a.write(ri(c))),a.b=b,a.h=!0)}
function wi(a){a.h=!1;a.m=!0;a.o=!1;if(0<a.K.length)for(var b=a.K[0];b<a.K.length;){var c=a.K[b];10==c>>>12&&(a.K[b]&=-513);b+=[1,1,2,1,1,2,2,1,1,1,2,3,1,1,1,1][c>>>12]}a.stack=[];for(b=0;b<a.Fc.length;b++)a.Fc[b]=0;a.ga&&a.ga();vi(a,65535)}
function xi(a){function b(n){return 32768<=n?n-65536:n}function c(n){switch(n){case 28672:d.stack.push(-d.stack.pop());break;case 28673:d.stack.push(Math.abs(d.stack.pop()));break;case 28674:d.stack.push(~d.stack.pop());break;case 32768:n=d.stack.pop();d.stack.push(b(d.stack.pop()<<n&65535));break;case 32769:n=d.stack.pop();d.stack.push(d.stack.pop()>>n);break;case 32770:d.stack.push(b(d.stack.pop()+d.stack.pop()&65535));break;case 32771:n=d.stack.pop();d.stack.push(b(d.stack.pop()-n&65535));break;
case 32772:d.stack.push(b(d.stack.pop()*d.stack.pop()&65535));break;case 32773:n=d.stack.pop();d.stack.push(b(Math.trunc(d.stack.pop()/n)&65535));break;case 32774:n=d.stack.pop();d.stack.push(b(d.stack.pop()%n&65535));break;case 32775:d.stack.push(b((d.stack.pop()|d.stack.pop())&65535));break;case 32776:d.stack.push(b((d.stack.pop()^d.stack.pop())&65535));break;case 32777:d.stack.push(b(d.stack.pop()&d.stack.pop()&65535));break;case 32778:d.stack.push(d.stack.pop()===d.stack.pop()?1:0);break;case 32779:d.stack.push(d.stack.pop()!==
d.stack.pop()?1:0);break;case 32780:n=d.stack.pop();d.stack.push(d.stack.pop()>n?1:0);break;case 32781:n=d.stack.pop();d.stack.push(d.stack.pop()>=n?1:0);break;case 32782:n=d.stack.pop();d.stack.push(d.stack.pop()<n?1:0);break;case 32783:n=d.stack.pop();d.stack.push(d.stack.pop()<=n?1:0);break;case 32784:n=d.stack.pop();d.stack.push(d.stack.pop()||n?1:0);break;case 32785:n=d.stack.pop();d.stack.push(d.stack.pop()&&n?1:0);break;default:throw"unknown op 0x"+n.toString(16);}}var d=a,e=a.K[a.b],f=e&4095;
switch(e>>>12){case 0:a.h=!1;break;case 1:a.stack.push(2048<=f?f-4096:f);break;case 2:a.b++;a.stack.push(b(a.K[a.b]));break;case 3:a.stack.push(a.Fc[f]);break;case 4:ui(a,f,[a.stack.pop()]);break;case 5:a.b++;e=a.K[a.b];var g=a.stack.pop();if(g>=e)throw"out of bounds";a.stack.push(a.Fc[f+g]);break;case 6:a.b++;e=a.K[a.b];g=a.stack.pop();if(g>=e)throw"Index out of bounds";ui(a,f+g,[a.stack.pop()]);break;case 9:a.b+=(2048<=f?f-4096:f)-1;break;case 10:var h=e&256;c(32768|e&255);f=0!=a.stack.pop();a.b++;
g=b(a.K[a.b]);if(h){h=a.b-1;if(e&512||!f)a.b+=g-2;a.K[h]=f?a.K[h]|512:a.K[h]&-513}else f||(a.b+=g-2);break;case 11:null(f);break;case 12:if(0>f||f>=a.Lb.length)throw"Native call index out of bounds";var k=a.Lb[f].ea.map(function(){return{p:this.stack.pop()}},a),l=[];a.Lb[f].ea.forEach(function(n,v){k[v].Kg=0===n.size?this.stack.pop():n.size},a);a.Lb[f].ea.forEach(function(n){0>n.size&&void 0===l[-n.size]&&(l[-n.size]=0)},a);l=l.map(function(n){return void 0!==n?this.stack.pop():n},a);a.Lb[f].ea.forEach(function(n,
v){0>n.size&&(k[v].Kg=l[-n.size])},a);var w=k.map(function(n){return this.Fc.slice(n.p,n.p+n.Kg)},a);e=!1;a.w&&(e=a.w(a.Lb[f].name,a,w));e||a.Lb[f].Ba(a,w);k.forEach(function(n,v){ui(this,n.p,w[v])},a);break;case 13:a.stack.push(a.b+1);a.b=f-1;break;case 14:a.b=a.stack.pop()-1;break;case 15:throw"op 0x"+e.toString(16)+" (reserved) not implemented";default:c(e)}a.b++}ti.prototype.Zb=function(){for(;this.h&&(xi(this),!this.m););};function yi(a){function b(c){c&=65535;return 32768<=c?c-65536:c}ti.call(this,{Od:a,Xa:[{name:"_id",S:[0]},{name:"event.source",S:[0]},{name:"event.args",S:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{name:"_fwversion",S:[0,0]},{name:"_productId",S:[0]},{name:"buttons._raw",S:[0,0,0,0,0]},{name:"button.backward",S:[0]},{name:"button.left",S:[0]},{name:"button.center",S:[0]},{name:"button.forward",S:[0]},{name:"button.right",S:[0]},{name:"buttons._mean",S:[0,0,0,0,0]},{name:"buttons._noise",
S:[0,0,0,0,0]},{name:"prox.horizontal",S:[0,0,0,0,0,0,0]},{name:"prox.comm.rx._payloads",S:[0,0,0,0,0,0,0]},{name:"prox.comm.rx._intensities",S:[0,0,0,0,0,0,0]},{name:"prox.comm.rx",S:[0]},{name:"prox.comm.tx",S:[0]},{name:"prox.ground.ambiant",S:[0,0]},{name:"prox.ground.reflected",S:[0,0]},{name:"prox.ground.delta",S:[0,0]},{name:"motor.left.target",S:[0]},{name:"motor.right.target",S:[0]},{name:"_vbat",S:[0,0]},{name:"_imot",S:[0,0]},{name:"motor.left.speed",S:[0]},{name:"motor.right.speed",S:[0]},
{name:"motor.left.pwm",S:[0]},{name:"motor.right.pwm",S:[0]},{name:"acc",S:[0,0,0]},{name:"temperature",S:[0]},{name:"rc5.address",S:[0]},{name:"rc5.command",S:[0]},{name:"mic.intensity",S:[0]},{name:"mic.threshold",S:[0]},{name:"mic._mean",S:[0]},{name:"timer.period",S:[0,0]},{name:"acc._tap",S:[0]},{name:"sd.present",S:[0]}],wd:[{name:"button.backward",description:"Backward button state changed"},{name:"button.left",description:"Left button state changed"},{name:"button.center",description:"Center button state changed"},
{name:"button.forward",description:"Forward button state changed"},{name:"button.right",description:"Right button state changed"},{name:"buttons",description:"Buttons values updated"},{name:"prox",description:"Proximity values updated"},{name:"prox.comm",description:"Data received on the proximity communication"},{name:"tap",description:"Tap detected"},{name:"acc",description:"Accelerometer values updated"},{name:"mic",description:"Microphone above threshold"},{name:"sound.finished",description:"Sound playback finished"},
{name:"temperature",description:"Temperature value updated"},{name:"rc5",description:"RC5 message received"},{name:"motor",description:"Motor timer"},{name:"timer0",description:"Timer 0"},{name:"timer1",description:"Timer 1"}],Lb:[{name:"_system_reboot",ea:[],Ba:function(){}},{name:"_system_settings_read",ea:[],Ba:function(){}},{name:"_system_settings_write",ea:[],Ba:function(){}},{name:"_system_settings_flash",ea:[],Ba:function(){}},{name:"math.copy",ea:[],Ba:function(c,d){for(c=0;c<d[0].length;c++)d[0][c]=
d[1][c]}},{name:"math.fill",ea:[],Ba:function(c,d){for(c=0;c<d[0].length;c++)d[0][c]=d[1][0]}},{name:"math.addscalar",ea:[{name:"r",size:-1},{name:"a",size:-1},{name:"b",size:1}],Ba:function(c,d){for(c=0;c<d[0].length;c++)d[0][c]=b(d[1][c]+d[2][0])}},{name:"math.add",ea:[{name:"r",size:-1},{name:"a",size:-1},{name:"b",size:-1}],Ba:function(c,d){for(c=0;c<d[0].length;c++)d[0][c]=b(d[1][c]+d[2][c])}},{name:"math.sub",ea:[{name:"r",size:-1},{name:"a",size:-1},{name:"b",size:-1}],Ba:function(c,d){for(c=
0;c<d[0].length;c++)d[0][c]=b(d[1][c]-d[2][c])}},{name:"math.mul",ea:[{name:"r",size:-1},{name:"a",size:-1},{name:"b",size:-1}],Ba:function(c,d){for(c=0;c<d[0].length;c++)d[0][c]=b(d[1][c]*d[2][c])}},{name:"math.div",ea:[{name:"r",size:-1},{name:"a",size:-1},{name:"b",size:-1}],Ba:function(c,d){for(c=0;c<d[0].length;c++)d[0][c]=b(Math.trunc(d[1][c]/d[2][c]))}},{name:"math.min",ea:[{name:"r",size:-1},{name:"a",size:-1},{name:"b",size:-1}],Ba:function(c,d){for(c=0;c<d[0].length;c++)d[0][c]=Math.min(d[1][c],
d[2][c])}},{name:"math.max",ea:[{name:"r",size:-1},{name:"a",size:-1},{name:"b",size:-1}],Ba:function(c,d){for(c=0;c<d[0].length;c++)d[0][c]=Math.max(d[1][c],d[2][c])}},{name:"math.clamp",ea:[{name:"r",size:-1},{name:"x",size:-1},{name:"low",size:-1},{name:"high",size:-1}],Ba:function(c,d){for(c=0;c<d[0].length;c++)d[0][c]=Math.min(Math.max(d[1][c],d[2][c]),d[3][c])}},{name:"math.dot",ea:[{name:"r",size:-1},{name:"a",size:-1},{name:"b",size:-1},{name:"shift",size:1}],Ba:function(c,d){for(var e=c=
0;e<d[0].length;e++)c+=d[1][e]*d[2][e];d[0][0]=c/Math.pow(2,d[3][0])}},{name:"math.stat",ea:[{name:"x",size:-1},{name:"min",size:1},{name:"max",size:1},{name:"mean",size:1}],Ba:function(c,d){c=0;d[1][0]=32767;d[2][0]=-32768;for(var e=0;e<d[0].length;e++)d[1][0]=Math.min(d[1][0],d[0][e]),d[2][0]=Math.max(d[2][0],d[0][e]),c+=d[0][e];d[3][0]=c/d[0].length}},{name:"math.argbounds",ea:[{name:"x",size:-1},{name:"argmin",size:1},{name:"argmax",size:1}],Ba:function(c,d){c=-Infinity;for(var e=Infinity,f=0;f<
d[0].length;f++)d[0][f]<e&&(e=d[0][f],d[1][0]=f),d[0][f]>c&&(c=d[0][f],d[2][0]=f)}},{name:"math.sort",ea:[{name:"x",size:-1}],Ba:function(c,d){d[0].sort(function(e,f){return e-f})}},{name:"math.muldiv",ea:[{name:"r",size:-1},{name:"a",size:-1},{name:"b",size:-1},{name:"c",size:-1}],Ba:function(c,d){for(c=0;c<d[0].length;c++)d[0][c]=b(d[1][c]*d[2][c]/d[3][c])}},{name:"math.atan2",description:"Atan2",ea:[{name:"r",size:-1},{name:"y",size:-1},{name:"x",size:-1}],Ba:function(c,d){d[2].forEach(function(e,
f){d[0][f]=Math.round(32767*Math.atan2(d[1][f],e)/Math.PI)})}},{name:"math.sin",description:"Sine",ea:[{name:"r",size:-1},{name:"theta",size:-1}],Ba:function(c,d){d[1].forEach(function(e,f){d[0][f]=Math.round(32767*Math.sin(e*Math.PI/32768))})}},{name:"math.cos",description:"Cosine",ea:[{name:"r",size:-1},{name:"theta",size:-1}],Ba:function(c,d){d[1].forEach(function(e,f){d[0][f]=Math.round(32767*Math.cos(e*Math.PI/32768))})}},{name:"math.rot2",ea:[{name:"r",size:2},{name:"v",size:2},{name:"theta",
size:1}]},{name:"math.sqrt",description:"Square root",ea:[{name:"r",size:-1},{name:"x",size:-1}],Ba:function(c,d){d[1].forEach(function(e,f){d[0][f]=0<e?Math.floor(Math.sqrt(e)):0})}},{name:"math.rand",description:"Pseudo-random number",ea:[{name:"r",size:-1}],Ba:function(c,d){for(c=0;c<d[0].length;c++)d[0][c]=Math.floor(65535.9999*Math.random())-32768}},{name:"_leds.set",ea:[{name:"led",size:1},{name:"br",size:1}],Ba:function(){}},{name:"sound.record",ea:[{name:"n",size:1}],Ba:function(){}},{name:"sound.play",
ea:[{name:"n",size:1}],Ba:function(){}},{name:"sound.replay",ea:[{name:"n",size:1}],Ba:function(){}},{name:"sound.system",description:"Start playing system sound",ea:[{name:"n",size:1}],Ba:function(){}},{name:"leds.circle",description:"Set circular leds",ea:[{name:"l0",size:1},{name:"l1",size:1},{name:"l2",size:1},{name:"l3",size:1},{name:"l4",size:1},{name:"l5",size:1},{name:"l6",size:1},{name:"l7",size:1}],Ba:function(c,d){c.state["leds.circle"]=d.map(function(e){return e[0]});c.bd&&c.bd("leds.circle")}},
{name:"leds.top",description:"Set top RGB led",ea:[{name:"r",size:1},{name:"g",size:1},{name:"b",size:1}],Ba:function(c,d){c.state["leds.top"]=d.map(function(e){return e[0]});c.bd&&c.bd("leds.top")}},{name:"leds.bottom.left",description:"Set bottom-left RGB led",ea:[{name:"r",size:1},{name:"g",size:1},{name:"b",size:1}],Ba:function(c,d){c.state["leds.bottom.left"]=d.map(function(e){return e[0]});c.bd&&c.bd("leds.bottom.left")}},{name:"leds.bottom.right",description:"Set bottom-right RGB led",ea:[{name:"r",
size:1},{name:"g",size:1},{name:"b",size:1}],Ba:function(c,d){c.state["leds.bottom.right"]=d.map(function(e){return e[0]});c.bd&&c.bd("leds.bottom.right")}},{name:"sound.freq",description:"Play frequency",ea:[{name:"Hz",size:1},{name:"ds",size:1}],Ba:function(c,d){console.info(d)}},{name:"leds.buttons",description:"Set buttons leds",ea:[{name:"led 0",size:1},{name:"led 1",size:1},{name:"led 2",size:1},{name:"led 3",size:1}]},{name:"leds.prox.h",description:"Set horizontal proximity leds",ea:[{name:"led 0",
size:1},{name:"led 1",size:1},{name:"led 2",size:1},{name:"led 3",size:1},{name:"led 4",size:1},{name:"led 5",size:1},{name:"led 6",size:1},{name:"led 7",size:1}]},{name:"leds.prox.v",description:"Set vertical proximity leds",ea:[{name:"led 0",size:1},{name:"led 1",size:1}]},{name:"leds.rc",description:"Set rc led",ea:[{name:"led",size:1}]},{name:"leds.sound",description:"Set sound led",ea:[{name:"led",size:1}]},{name:"leds.temperature",description:"Set ntc led",ea:[{name:"red",size:1},{name:"blue",
size:1}]},{name:"sound.wave",description:"Set the primary wave of the tone generator",ea:[{name:"wave",size:142}],Ba:function(){}},{name:"prox.comm.enable",description:"Enable or disable the proximity communication",ea:[{name:"state",size:1}]},{name:"sd.open",description:"Open a file on the SD card",ea:[{name:"number",size:1},{name:"status",size:1}]},{name:"sd.write",description:"Write data to the opened file",ea:[{name:"data",size:-1},{name:"written",size:1}]},{name:"sd.read",description:"Read data from the opened file",
ea:[{name:"data",size:-1},{name:"read",size:1}]},{name:"sd.seek",description:"Seek the opened file",ea:[{name:"position",size:1},{name:"status",size:1}]},{name:"_rf.nodeid"},{name:"_poweroff"}],Dd:620});this.state={};this.bd=null}yi.prototype=Object.create(ti.prototype);yi.prototype.constructor=yi;function zi(){Sf.call(this);this.Xb=!0;this.m=new yi(9999);var a=this;this.m.bd=function(b){a.ga[b]&&a.ga[b](b,a.m.state[b])};this.m.M=function(b,c,d){switch(b){case "timer.period":a.setTimer(c,.001*d,!0)}};this.m.w=function(b,c,d){switch(b){case "sound.play":return a.ga.sound("sound",{pcm:d[0][0]}),!0}return!1};this.oa=new vb(wb)}zi.prototype=Object.create(Sf.prototype);zi.prototype.constructor=zi;zi.prototype.reset=function(a){Sf.prototype.reset.call(this,a);wi(this.m)};
function Ai(a,b){b=$f(a.oa,b);return null==b?null:a.m.Fc.slice(b.offset,b.offset+b.size)}function Bi(a,b,c){var d=$f(a.oa,b);if(null==d)throw"Unknown VM variable "+b;if(c.length!==d.size)throw"Bad size for variable "+b;Array.prototype.splice.apply(a.m.Fc,[d.offset,d.size].concat(c))}
zi.prototype.set=function(a,b){if(this.Xb){Sf.prototype.set.call(this,a,b);switch(a){case "button.backward":case "button.left":case "button.center":case "button.forward":case "button.right":Bi(this,a,[b?1:0]);break;case "prox.ground.delta":Bi(this,"prox.ground.delta",b.map(function(c){return 2E3*c}));break;case "prox.horizontal":Bi(this,"prox.horizontal",b.map(function(c){return 4E3*c}));break;case "acc":Bi(this,"acc",b.map(function(c){return 22*c}));break;default:throw"Unknown variable "+a;}this.ga[a]&&
this.ga[a](a,b)}else Sf.prototype.set.call(this,a,b)};
zi.prototype.get=function(a){if(this.Xb)switch(a){case "leds.top":return(this.m.state&&this.m.state["leds.top"]||[0,0,0]).map(function(b){return 32<=b?1:0>=b?0:b/32});case "leds.bottom.left":return(this.m.state&&this.m.state["leds.bottom.left"]||[0,0,0]).map(function(b){return 32<=b?1:0>=b?0:b/32});case "leds.bottom.right":return(this.m.state&&this.m.state["leds.bottom.right"]||[0,0,0]).map(function(b){return 32<=b?1:0>=b?0:b/32});case "leds.circle":return(this.m.state&&this.m.state["leds.circle"]||
[0,0,0,0,0,0,0,0]).map(function(b){return 16<=b?1:0});case "motor.left":return Ai(this,"motor.left.target")[0]/200;case "motor.right":return Ai(this,"motor.right.target")[0]/200;default:return Sf.prototype.get.call(this,a)}else return Sf.prototype.get.call(this,a)};zi.prototype.sendEvent=function(a,b){if(this.Xb){if(null!=b)throw"Event arguments not implemented";a=ag(this.oa,a);vi(this.m,a);Ci(this)}else Sf.prototype.sendEvent.call(this,a,b)};
zi.prototype.loadCode=function(a,b){"js"===a?(Sf.prototype.loadCode.call(this,a,b),this.Xb=!1):("asm"===a?(b=new Qf(this.oa,b),b=Pf(b)):(b=(a=Ph(b))?new Nf(this.oa,b):new xb(this.oa,b),b.ga=a?Of:yb,b=zb(b)),a=this.m,a.K.splice.apply(a.K,[0,b.length].concat(b)),wi(this.m),Ci(this),this.Xb=!0)};function Ci(a){for(var b=0;2E3>b&&a.m.h;b++)xi(a.m)};function Kf(a,b){a.b=new Kb(a.hb,{X:a.X});a.b.Oa=function(){null!==a.m&&(a.m=null,Di(a))};var c=null;return new uf({Zb:function(d,e){var f=a.G;f.Y.loadCode(d,e);null!==c&&clearInterval(c);f.Y.start(Ei());c=setInterval(function(){f.Y.run(Ei(),function(g,h){Fi(f,g,h)})},10);f.Y.uc=f.paused;Di(a)},Mc:function(){var d=new zi;d=new Gi(a.b,d);b&&b.kg&&Ud(a.b,b.kg);b&&b.lg&&(a.b.transform=b.lg);a.G=d},Md:function(){return"Simulator"},zd:"js",languages:["js","aseba","l2","asm"]})};function Hi(){this.b=[]}Hi.prototype.add=function(a){this.b.push(a)};Hi.prototype.H=function(a){this.b.forEach(function(b){b.H(a)})};function Ii(){}Ii.prototype.b=function(){throw"internal";};Ii.prototype.H=function(){};function Ji(a,b,c){this.x=a;this.y=b;this.h=c}Ji.prototype=Object.create(Ii.prototype);Ji.prototype.constructor=Ji;
Ji.prototype.b=function(a,b,c){function d(h,k,l,w,n,v,m){l=[Math.cos(l),v-w,Math.sin(l),m-n];h=[v-h,m-k];k=l[0]*l[3]-l[1]*l[2];h=[(l[3]*h[0]-l[1]*h[1])/k,(l[0]*h[1]-l[2]*h[0])/k];return 0<=h[1]&&1>=h[1]&&0<h[0]?h[0]:Infinity}for(var e=Infinity,f=this.x.length,g=0;g<(this.h?this.x.length:this.x.length-1);g++)e=Math.min(e,d(a,b,c,this.x[g],this.y[g],this.x[(g+1)%f],this.y[(g+1)%f]));return e};
Ji.prototype.H=function(a){a.save();a.beginPath();a.moveTo(this.x[0],this.y[0]);for(var b=1;b<this.x.length;b++)a.lineTo(this.x[b],this.y[b]);this.h&&a.closePath();a.stroke();a.restore()};function Ki(a,b,c){this.x=a;this.y=b;this.r=c}Ki.prototype=Object.create(Ii.prototype);Ki.prototype.constructor=Ki;
Ki.prototype.b=function(a,b,c){var d=(this.x-a)*Math.cos(c)+(this.y-b)*Math.sin(c);a=(a-this.x)*Math.sin(c)+(this.y-b)*Math.cos(c);a=this.r*this.r-a*a;if(0>a)return Infinity;a=Math.sqrt(a);return 0>d+a?Infinity:0>d-a?d+a:d-a};Ki.prototype.H=function(a){a.save();a.beginPath();a.arc(this.x,this.y,this.r,0,2*Math.PI);a.stroke();a.restore()};function Li(a,b){this.width=a;this.height=b}
function Gi(a,b){var c=this;this.ia=new Ja;this.Y=b;this.M=this.pf=this.paused=this.oe=!1;this.mc=Mi;this.b=new Li(10*this.Y.qb,7.07*this.Y.qb);b=this.Y.qb;this.Y.setPositionLimits(-this.b.width/2+b,this.b.width/2-b,-this.b.height/2+b,this.b.height/2-b);this.Ze=this.Yb=null;this.h=document.createElement("canvas");this.Hf=!1;this.$e=this.yb=null;this.m=document.createElement("canvas");this.o=new Hi;this.he=!1;this.af=this.R=null;Ni(this);this.Y.hb=function(){Oi(c);Pi(c);Qi(c)};this.w=a;this.w.state=
{};this.ga=!1}var Mi="ground";Gi.prototype.me=function(){this.ia.b=[]};function Ri(a){var b=a.G;if(b.Yb){b.h.width=b.Yb.width;b.h.height=b.Yb.height;var c=b.h.getContext("2d");c.fillStyle="white";c.fillRect(0,0,b.Yb.width,b.Yb.height);c.drawImage(b.Yb,0,0,b.Yb.width,b.Yb.height)}else b.h.width=b.w?b.w.width:800,b.h.height=b.h.width*b.b.height/b.b.width,c=b.h.getContext("2d"),c.fillStyle="white",c.fillRect(0,0,b.h.width,b.h.height);b.Hf=!1;Wb(a)}
function Fi(a,b,c){if(a.pf){var d=a.h.getContext("2d");d.save();d.translate(a.h.width/2,a.h.height/2);d.scale(a.h.width/a.b.width,-a.h.height/a.b.height);d.beginPath();switch(b){case "l":d.moveTo(c[0],c[1]);d.lineTo(c[2],c[3]);break;case "a":d.arc(c[0],c[1],Math.abs(c[2]),c[3],c[4],0>c[2])}d.strokeStyle="#060";d.lineCap="round";d.lineWidth=.1*a.Y.qb;d.stroke();d.restore();a.Hf=!0}}
function Ni(a){a.o.b=[];a.o.add(new Ji([-a.b.width/2,a.b.width/2,a.b.width/2,-a.b.width/2],[-a.b.height/2,-a.b.height/2,a.b.height/2,a.b.height/2],!0))}
function Si(a,b){var c=a.G;Ni(c);if(c.R=b){var d=new ze(b),e=c.b.width/d.Ca[2],f=-c.b.width*(.5+d.Ca[0]/d.Ca[2]),g=-c.b.height/d.Ca[3],h=c.b.height*(.5+d.Ca[1]/d.Ca[3]);d.H(null,{xa:{line:function(k,l,w){c.o.add(new Ji(k.map(function(n){return f+e*n}),l.map(function(n){return h+g*n}),w))},We:function(k,l,w){c.o.add(new Ki(f+e*k,h+g*l,(e-g)/2*w))}}})}c.he=null!=b;Pi(c);Wb(a)}
function Ti(a,b,c){b=Math.round(a.h.width*(b+a.b.width/2)/a.b.width);c=Math.round(a.h.height*(a.b.height/2-c)/a.b.height);return a.h.getContext("2d").getImageData(b,c,1,1).data[0]/255}function Ui(a,b,c){if(null==a.yb)return 0;b=Math.round(a.m.width*(b+a.b.width/2)/a.b.width);c=Math.round(a.m.height*(a.b.height/2-c)/a.b.height);a=a.m.getContext("2d").getImageData(b,c,1,1).data;return-(a[0]+a[1]+a[2])/765}
function Oi(a){for(var b=[],c=0;2>c;c++)b.push(Ti(a,a.Y.b[0]+a.Y.kc*Math.cos(a.Y.h)+(0===c?-1:1)*a.Y.Xd*Math.sin(a.Y.h),a.Y.b[1]+a.Y.kc*Math.sin(a.Y.h)-(0===c?-1:1)*a.Y.Xd*Math.cos(a.Y.h))+Tf(a.Y,.05));a.Y.set("prox.ground.delta",b)}
function Pi(a){var b=Math.cos(a.Y.h),c=Math.sin(a.Y.h),d=[{xd:70,vd:60,bb:.7},{xd:85,vd:30,bb:.35},{xd:95,vd:0,bb:0},{xd:85,vd:-30,bb:-.35},{xd:70,vd:-60,bb:-.7},{xd:-25,vd:35,bb:2.8},{xd:-25,vd:-35,bb:-2.8}].map(function(e){var f=this.o,g=this.Y.b[0]+e.xd*b-e.vd*c,h=this.Y.b[1]+e.xd*c+e.vd*b;e=this.Y.h+e.bb;for(var k=Infinity,l=0;l<f.b.length;l++)k=Math.min(k,f.b[l].b(g,h,e));f=k+Tf(this.Y,.01*this.Y.r);return 100>f?1:300<f?0:(f-300)*(f-300)/4E4},a);a.Y.set("prox.horizontal",d)}
function Qi(a){for(var b=[0,0,a.Y.r],c=[-a.Y.r,a.Y.r,0],d=[],e=0;3>e;e++)d.push(Ui(a,a.Y.b[0]+b[e]*Math.cos(a.Y.h)+c[e]*Math.sin(a.Y.h),a.Y.b[1]+b[e]*Math.sin(a.Y.h)-c[e]*Math.cos(a.Y.h)));b=200*(d[1]-d[0])/(2*a.Y.r);d=200*(d[2]-(d[0]+d[1])/2)/a.Y.kc;a.Y.set("acc",[b+Tf(a.Y,.02),d+Tf(a.Y,.02),Math.sqrt(1-b*b-d*d)+Tf(a.Y,.02)])}
function yf(a,b,c){switch(c||a.G.mc){case Mi:a.G.Ze=null==b?a.G.Yb:null;a.G.Yb=b;Ri(a);Oi(a.G);Wb(a);break;case "height":a.G.$e=null==b?a.G.yb:null,c=a.G,c.yb=b,c.yb?(c.m.width=c.yb.width,c.m.height=c.yb.height,b=c.m.getContext("2d"),b.fillStyle="white",b.fillRect(0,0,c.yb.width,c.yb.height),b.drawImage(c.yb,0,0,c.yb.width,c.yb.height)):(c.m.width=1,c.m.height=1),Qi(c),Wb(a)}}function xf(a,b,c){switch(c||a.G.mc){case "obstacle":a.G.af=null==b?a.G.R:null,Si(a,b)}}
Hb.prototype.start=function(a){this.G.paused=a;this.G.oe=!a;Wb(this)};function Vi(a){a=[a[0],Math.max(.2+.8*a[1],a[2]/2),a[2]];var b=Math.max(a[0],Math.max(a[1],a[2]));return"rgb("+a.map(function(c){return Math.round(225*(1-b)+(30+225*b)*c)}).join(",")+")"}function Wi(a){return function(b){a.m!==b&&(a.m=b,Di(a))}}function gf(a,b,c,d,e){var f=new nc(a.b);Ec(f,a,b,["sim","top"],a.G.gc||vc,a.G.Ne||Bc);pc(f,c,e,d);return f}
function Wb(a){function b(x){return function(){c.m!==x&&(c.m=x,Di(c))}}var c=a,d=a.G,e=d.Y,f=a.b;if(f.R){d.ga||(d.ga=!0,d.resize(a),Ri(a));f.$a=[];var g=d.Wf||a.za,h=Gc(a,g,["sim","top"]),k=Hc(h),l=dd(f);cd(f);var w=wc(f.X,{tag:"view",W:["sim"]}),n=wc(f.X,{tag:"button",W:["sim","event"]}),v=wc(f.X,{tag:"sim-controller"}),m=wc(f.X,{tag:"separator",id:"sim-controller-separator"}),r=wc(f.X,{tag:"separator",W:["sim","top"]}),u=wc(f.X,{tag:"toolbar",W:["sim","top"]}),p=wc(f.X,{tag:"sim-playground-area"}),
t=wc(f.X,{tag:"sim-playground"});w.tc(l.width);w.ec(l.height);w.setPosition(0,0);var q=Math.max(n.width,n.height);v.width=3*qc(n);v.ec(w.height);v.setPosition(w.x+w.width-qc(v),w.y);u.tc(w.width-qc(v));u.height=k;u.setPosition(w.x,w.y);p.tc(w.width-qc(v));p.ec(w.height-u.qa());p.setPosition(w.x,w.y+u.qa());sc(f,function(x){w.H(x)});rc(gf(a,g,u,r,h),u,h,Wi(a));sc(f,function(x){v.H(x)});g=[];h=v.y+n.offsetTop();g.push(uc(f,v.x+qc(n)+n.offsetLeft(),h,n,function(x,R,H){(d.gc||vc)("sim-event:forward",
x,f.v,f.X,["sim","event"],null,!0,!1,H)},function(){e.set("button.forward",!0);e.sendEvent("buttons",null);e.set("button.forward",!1);e.sendEvent("buttons",null)},null,null,b("sim:btn-button.forward"),"button.forward"));h+=n.qa();g.push(uc(f,v.x+n.offsetLeft(),h,n,function(x,R,H){(d.gc||vc)("sim-event:left",x,f.v,f.X,["sim","event"],null,!0,!1,H)},function(){e.set("button.left",!0);e.sendEvent("buttons",null);e.set("button.left",!1);e.sendEvent("buttons",null)},null,null,b("sim:btn-button.left"),
"button.left"));g.push(uc(f,v.x+qc(n)+n.offsetLeft(),h,n,function(x,R,H){(d.gc||vc)("sim-event:center",x,f.v,f.X,["sim","event"],null,!0,!1,H)},function(){e.set("button.center",!0);e.sendEvent("buttons",null);e.set("button.center",!1);e.sendEvent("buttons",null)},null,null,b("sim:btn-button.center"),"button.center"));g.push(uc(f,v.x+2*qc(n)+n.offsetLeft(),h,n,function(x,R,H){(d.gc||vc)("sim-event:right",x,f.v,f.X,["sim","event"],null,!0,!1,H)},function(){e.set("button.right",!0);e.sendEvent("buttons",
null);e.set("button.right",!1);e.sendEvent("buttons",null)},null,null,b("sim:btn-button.right"),"button.right"));h+=n.qa();g.push(uc(f,v.x+qc(n)+n.offsetLeft(),h,n,function(x,R,H){(d.gc||vc)("sim-event:backward",x,f.v,f.X,["sim","event"],null,!0,!1,H)},function(){e.set("button.backward",!0);e.sendEvent("buttons",null);e.set("button.backward",!1);e.sendEvent("buttons",null)},null,null,b("sim:btn-button.backward"),"button.backward"));h+=n.qa()+m.qa();g.push(uc(f,v.x+.5*qc(n)+n.offsetLeft(),h,n,function(x,
R,H){(d.gc||vc)("sim-event:tap",x,f.v,f.X,["sim","event"],null,!0,!1,H)},function(){e.sendEvent("tap",null)},null,null,b("sim:btn-tap"),"tap"));g.push(uc(f,v.x+1.5*qc(n)+n.offsetLeft(),h,n,function(x,R,H){(d.gc||vc)("sim-event:clap",x,f.v,f.X,["sim","event"],null,!0,!1,H)},function(){e.sendEvent("mic",null)},null,null,b("sim:btn-clap"),"clap"));h+=2*q;var z=v.x+1.5*qc(n),C=h+3.5*q;g.push(sc(f,function(x){function R(D,E,G,Z,O,ka){x.save();x.translate(D,E);x.beginPath();x.arc(0,0,G,0,2*Math.PI);x.arc(0,
0,G/2,2*Math.PI,0,!0);x.fillStyle=O||"#bbb";x.fill();x.beginPath();x.arc(0,0,G,(-.5+2*Z)*Math.PI,-.5*Math.PI,!0);x.arc(0,0,G/2,-.5*Math.PI,(-.5+2*Z)*Math.PI,!1);x.fillStyle=ka||"#222";x.fill();x.restore()}x.save();x.beginPath();x.moveTo(z-1.2*q,C);x.lineTo(z-1.2*q,C-1.8*q);x.bezierCurveTo(z-.72*q,C-2.4*q,z-.05*q,C-2.4*q,z,C-2.4*q);x.bezierCurveTo(z+.05*q,C-2.4*q,z+.72*q,C-2.4*q,z+1.2*q,C-1.8*q);x.lineTo(z+1.2*q,C);x.closePath();x.lineWidth=2;x.strokeStyle="black";x.stroke();var H=e.get("prox.ground.delta");
R(z-.45*q,C-1.8*q,.4*q,H[0],"#afa","#060");R(z+.45*q,C-1.8*q,.4*q,H[1],"#9f9","#060");H=e.get("prox.horizontal");R(z-1.45*q,C-2.3*q,.4*q,H[0],"#fcc","#d00");R(z-.8*q,C-2.8*q,.4*q,H[1],"#fcc","#d00");R(z,C-3*q,.4*q,H[2],"#fcc","#d00");R(z+.8*q,C-2.8*q,.4*q,H[3],"#fcc","#d00");R(z+1.45*q,C-2.3*q,.4*q,H[4],"#fcc","#d00");R(z-.8*q,C+.5*q,.4*q,H[5],"#fcc","#d00");R(z+.8*q,C+.5*q,.4*q,H[6],"#fcc","#d00");x.restore()}));var y=h+=5*q;g.push(sc(f,function(x){function R(H,D,E,G){G=Math.max(-1,Math.min(1,G));
x.save();x.translate(H,D);x.beginPath();x.arc(0,0,E,0,2*Math.PI);x.fillStyle="#ccc";x.fill();x.beginPath();x.moveTo(0,0);x.lineTo(E*Math.sin(3*G),-E*Math.cos(3*G));x.lineWidth=Math.max(E/6,1);x.strokeStyle="black";x.stroke();x.restore()}x.save();x.fillStyle="black";x.fillRect(z-1.15*q,y+.5*q,.3*q,.6*q);x.fillRect(z+.85*q,y+.5*q,.3*q,.6*q);x.fillStyle=Vi(e.get("leds.top"));x.fillRect(z-1.2*q,y,2.4*q,.5*q);x.fillStyle=Vi(e.get("leds.bottom.left"));x.fillRect(z-1.2*q,y+.5*q,1.2*q,.5*q);x.fillStyle=Vi(e.get("leds.bottom.right"));
x.fillRect(z,y+.5*q,1.2*q,.5*q);x.lineWidth=1;x.beginPath();x.moveTo(z-1.2*q,y+.5*q);x.lineTo(z+1.2*q,y+.5*q);x.moveTo(z,y+.5*q);x.lineTo(z,y+q);x.strokeStyle="white";x.stroke();x.lineJoin="round";x.strokeStyle="black";x.strokeRect(z-1.2*q,y,2.4*q,q);R(z-1.7*q,y+q,.4*q,e.get("motor.left")/2);R(z+1.7*q,y+q,.4*q,e.get("motor.right")/2);x.restore()}));h+=1.5*q;if(null!=d.yb){var A=h+1.5*q;g.push(sc(f,function(x){var R=e.get("acc");R=[Math.atan2(R[0],R[1]),Math.atan2(R[1],R[2]),Math.atan2(R[0],R[2])];
x.save();x.strokeStyle="black";x.lineWidth=.7*f.v.ja;for(var H=0;3>H;H++){x.save();x.translate(z+(H-1)*q,A);x.save();x.strokeStyle="silver";x.beginPath();x.moveTo(-.4*q,0);x.lineTo(.4*q,0);x.moveTo(0,-.4*q);x.lineTo(0,.4*q);x.stroke();x.restore();x.rotate(-R[H]);switch(H){case 0:var D=.25*q;x.translate(0,1.2*D);x.beginPath();x.moveTo(-1.2*D,0);x.lineTo(-1.2*D,-1.8*D);x.bezierCurveTo(-.72*D,-2.4*D,-.05*D,-2.4*D,0,-2.4*D);x.bezierCurveTo(.05*D,-2.4*D,.72*D,-2.4*D,1.2*D,-1.8*D);x.lineTo(1.2*D,0);x.closePath();
x.lineWidth=2;x.strokeStyle="black";x.stroke();break;case 1:x.strokeRect(-.4*q,-.15*q,.8*q,.3*q);x.beginPath();x.arc(-.2*q,.05*q,.15*q,0,2*Math.PI);x.fillStyle="white";x.fill();x.lineWidth=.07*q;x.stroke();break;case 2:x.strokeRect(-.4*q,-.15*q,.8*q,.3*q),x.fillStyle="black",x.fillRect(-.35*q,.15*q,.15*q,.08*q),x.fillRect(.2*q,.15*q,.15*q,.08*q)}x.restore()}x.restore()}));h+=2.5*q}if(e.Wc){var K=h+2*q;g.push(sc(f,function(x){for(var R=e.get("leds.circle"),H=0;8>H;H++)le(x,z,K,.9*q,1.2*q,Math.PI*(.44-
.25*H),Math.PI*(.56-.25*H),R[H]?"#fa0":"white","black",f.v.ja)}));h+=3.5*q}var I=h+1.5*q,M=e.getTimer(0);0<=M?(g.push(sc(f,function(x){f.state.qe?"lin"===f.state.qe&&4<M&&(f.state.qe="log"):f.state.qe=4<M?"log":"lin";je(x,z,I,q,f.v.ja,function(R){x.textAlign="start";x.textBaseline="top";x.font=(q/2).toFixed(1)+"px sans-serif";x.fillStyle="black";x.fillText(R.toFixed(1),v.x,I-q)},Math.min(M,"log"===f.state.qe?9.9:3.95),!1,"log"===f.state.qe)})),h+=2.5*q):f.state.qe=!1;var N=Math.min((p.y-v.y+v.y+v.height-
h)/2,v.y+v.height-h);0<N&&g.forEach(function(x){x.y+=N});var S=p.x,aa=p.y,ha=p.width,J=p.height;var B=Math.min(ha/d.b.width,J/d.b.height);n=(ha-d.b.width*B)/2;m=(J-d.b.height*B)/2;t.width=d.b.width*B;t.height=d.b.height*B;t.x=S+n;t.y=aa+m;if(a.ia.Wb){var T=wc(f.X,{tag:"widget",id:"vpl-customize"});sc(f,function(){Yc(f,"vpl:customize",S+ha/2,aa+J/2,T)})}else{var P=e.qb,Y=!1;n=new Nc(null,d.b.width*B,d.b.height*B,S+n,aa+m,function(x,R,H,D){x=x.J;x.save();p.H(x);t.H(x);if(null===c.Tc)switch(d.mc){case Mi:x.drawImage(d.h,
R.x+H,R.y+D,R.width,R.height);break;case "height":null!=d.yb&&x.drawImage(d.m,R.x+H,R.y+D,R.width,R.height);break;case "obstacle":x.save(),x.translate(R.x+H+R.width/2,R.y+D+R.height/2),x.scale(B,-B),d.o.H(x),x.restore()}else x.drawImage(d.h,R.x+H,R.y+D,R.width,R.height),null!=d.yb&&(x.save(),x.globalAlpha=.5,x.drawImage(d.m,R.x+H,R.y+D,R.width,R.height),x.restore()),d.he&&(x.save(),x.translate(R.x+H+R.width/2,R.y+D+R.height/2),x.scale(B,-B),d.o.H(x),x.restore());x.translate(R.x+H+R.width/2,R.y+D+
R.height/2);x.scale(B,B);x.translate(e.b[0],-e.b[1]);x.rotate(.5*Math.PI-e.h);x.beginPath();x.moveTo(0,.2*P);x.lineTo(.5*P,.2*P);x.lineTo(.5*P,-.55*P);x.bezierCurveTo(.3*P,-.8*P,.02*P,-.8*P,0,-.8*P);x.bezierCurveTo(-.02*P,-.8*P,-.3*P,-.8*P,-.5*P,-.55*P);x.lineTo(-.5*P,.2*P);x.closePath();x.fillStyle=Vi(e.get("leds.top"));x.strokeStyle="black";x.lineJoin="round";x.lineWidth=2;x.moveTo(.05*P,0);x.arc(0,0,.05*P,0,2*Math.PI);x.fill();x.stroke();if(!d.oe||d.paused)x.beginPath(),x.arc(0,0,P,0,2*Math.PI),
x.strokeStyle=f.state.wg?"navy":"#3cf",x.lineWidth=.1*P,x.stroke(),x.beginPath(),x.arc(0,-P,.15*P,0,2*Math.PI),x.fillStyle=f.state.Nf?"navy":"white",x.strokeStyle=f.state.Nf?"navy":"#3cf",x.lineWidth=.06*P,x.fill(),x.stroke();x.restore()},{aa:function(x,R,H,D,E,G,Z){x=(Z.x-E-H/2)/B;D=(D/2-(Z.y-G))/B;G=x-e.b[0];Z=D-e.b[1];R=P*Math.cos(e.h);H=P*Math.sin(e.h);return(!d.oe||d.paused)&&(G-R)*(G-R)+(Z-H)*(Z-H)<.1*P*P?(f.state.x=x,f.state.y=D,f.state.Nf=!0,1):G*G+Z*Z<P*P?(d.paused?Y=!1:(e.suspend(),Y=!0),
f.state.x=x,f.state.y=D,f.state.wg=!0,0):null},Ra:function(x,R,H,D,E,G,Z,O){x=(O.x-G-D/2)/B;E=(E/2-(O.y-Z))/B;switch(H){case 0:H=e.b;e.setPosition([e.b[0]+x-f.state.x,e.b[1]+E-f.state.y],e.h);Fi(d,"l",[H[0],H[1],e.b[0],e.b[1]]);break;case 1:e.setPosition(e.b,e.h+(Math.atan2(E-e.b[1],x-e.b[0])-Math.atan2(f.state.y-e.b[1],f.state.x-e.b[0])))}f.state.x=x;f.state.y=E},kf:function(){f.state.wg=!1;f.state.Nf=!1;Y&&e.resume(Ei())}});n.m=!1;Pc(f,n)}a.m&&sc(f,function(x){var R=wc(f.X,{tag:"hint"});x.fillStyle=
R.color;x.font=xc(R);x.textAlign="start";x.textBaseline="middle";var H=c.h.translate(c.m);R.width=x.measureText(H).width;R.height=1.2*R.fontSize;tc(R,x,R.marginLeft,l.height-R.qa()+R.marginTop,!0);x.fillText(H,R.offsetLeft(),l.height-R.qa()+R.offsetTop()+R.height/2)});Sb(f);!d.paused&&e.shouldRunContinuously()&&Di(a)}}function Di(a){a.G.M||(a.G.M=!0,window.requestAnimationFrame(function(){a.G.M=!1;Wb(a)}))}function Ei(){return.001*(new Date).getTime()}
Gi.prototype.resize=function(a){var b=window.innerWidth,c=window.innerHeight;window.vplDisableResize&&(c=this.w.b.getBoundingClientRect(),b=c.width,c=c.height);this.w.v=this.w.v;this.w.resize(b,c);Wb(a)};function Lf(a){a.L.add("sim:close",{action:function(b){b.fb(["sim"],{Ye:!0})},object:a,T:function(b){return 1<b.Aa.length&&0<=b.Aa.indexOf("sim")}});a.L.add("sim:restart",{action:function(b){Ri(b);b.G.Y.reset(Ei());b.G.Y.start();b.G.oe=!0;b.G.paused=!1;Wb(b)},object:a});a.L.add("sim:pause",{action:function(b){b.G.oe&&(b.G.paused=!b.G.paused,b.G.paused?b.G.Y.suspend():(b.G.Y.resume(Ei()),Wb(b)))},isEnabled:function(b){return b.G.oe},Ua:function(b){return b.G.paused},object:a,cb:[{selected:!1},{selected:!0}]});
a.L.add("sim:speedup",{action:function(b){var c=[.5,1,2,5,10];b.G.Y.Ad=c[(c.indexOf(b.G.Y.Ad)+1)%c.length]},Ua:function(b){return 1!==b.G.Y.Ad},getState:function(b){return b.G.Y.Ad},object:a,cb:[{selected:!1,state:1},{selected:!0,state:.5},{selected:!0,state:2},{selected:!0,state:5},{selected:!0,state:10}]});a.L.add("sim:noise",{action:function(b){b.G.Y.hf=!b.G.Y.hf},Ua:function(b){return b.G.Y.hf},object:a,cb:[{selected:!1},{selected:!0}]});a.L.add("sim:pen",{action:function(b){b.G.pf=!b.G.pf},Ua:function(b){return b.G.pf},
object:a,cb:[{selected:!1},{selected:!0}]});a.L.add("sim:clear",{action:function(b){Ri(b)},isEnabled:function(b){return b.G.Hf},object:a});a.L.add("sim:map-kind",{action:function(b){switch(b.G.mc){case Mi:b.G.mc="height";break;case "height":b.G.mc="obstacle";break;case "obstacle":b.G.mc=Mi}},getState:function(b){switch(b.G.mc){case Mi:return"ground";case "height":return"height";case "obstacle":return"obstacles";default:return"ground"}},object:a,cb:[{state:"ground"},{state:"height"},{state:"obstacles"}],
T:function(b){return null===b.Tc}});a.L.add("sim:map",{action:function(b){switch(b.G.mc){case Mi:yf(b,null==b.G.Yb?b.G.Ze:null);break;case "height":yf(b,null==b.G.yb?b.G.$e:null);break;case "obstacle":xf(b,b.G.he?null:b.G.af)}},Ua:function(b){switch(b.G.mc){case Mi:return null!=b.G.Yb;case "height":return null!=b.G.yb;case "obstacle":return b.G.he}throw"internal";},getState:function(b){switch(b.G.mc){case Mi:return"ground";case "height":return"height";case "obstacle":return"obstacles";default:return"ground"}},
object:a,cb:[{selected:!1,state:"ground"},{selected:!1,state:"height"},{selected:!1,state:"obstacles"},{selected:!0,state:"ground"},{selected:!0,state:"height"},{selected:!0,state:"obstacles"}],T:function(b){return null===b.Tc}});a.L.add("sim:map-ground",{action:function(b,c){c?b.Ge.show("Open ground image file",".gif,.png,.jpg,.svg",function(d){var e=new window.FileReader;e.onload=function(f){f=f.target.result;var g=new Image;g.addEventListener("load",function(){yf(b,g,Mi)});g.src=f};e.readAsDataURL(d)}):
yf(b,null==b.G.Yb?b.G.Ze:null,Mi)},Ua:function(b){return null!=b.G.Yb},object:a,cb:[{selected:!1},{selected:!0}],T:function(b){return b.Tc&&0<=b.Tc.indexOf("ground")}});a.L.add("sim:map-height",{action:function(b,c){c?b.Ge.show("Open height image file",".gif,.png,.jpg,.svg",function(d){var e=new window.FileReader;e.onload=function(f){f=f.target.result;var g=new Image;g.addEventListener("load",function(){yf(b,g,"height")});g.src=f};e.readAsDataURL(d)}):yf(b,null==b.G.yb?b.G.$e:null,"height")},Ua:function(b){return null!=
b.G.yb},object:a,cb:[{selected:!1},{selected:!0}],T:function(b){return b.Tc&&0<=b.Tc.indexOf("height")}});a.L.add("sim:map-obstacles",{action:function(b,c){c?b.Ge.show("Open obstacle SVG file",".svg",function(d){var e=new window.FileReader;e.onload=function(f){xf(b,f.target.result,"obstacle")};e.readAsText(d)}):xf(b,b.G.he?null:b.G.af,"obstacle")},Ua:function(b){return b.G.he},object:a,cb:[{selected:!1},{selected:!0}],T:function(b){return b.Tc&&0<=b.Tc.indexOf("obstacles")}});a.L.add("sim:vpl",{action:function(b){b.Nd?
b.fb(["vpl"],{Pd:!0}):b.fb(["vpl"],{Ld:"sim"})},isEnabled:function(b){return null==b.I||nf(b.I)},object:a,T:function(b){return(null==b.I||!b.I.fa)&&0>b.Aa.indexOf("vpl")}});a.L.add("sim:text",{action:function(b){b.Nd?b.fb(["src"],{Pd:!0,Zf:!b.I.Oc}):b.fb(["src"],{Ld:"sim",Zf:!b.I.Oc})},object:a,T:function(b){return 0>b.Aa.indexOf("src")}});a.L.add("sim:teacher-reset",{action:function(b){b.G.me();Wb(b)},object:a,Qc:!0,T:function(b){return b.G.Eb&&b.G.ia.Wb}});a.L.add("sim:teacher",{action:function(b){b.G.ia.Wb=
!b.G.ia.Wb;Wb(b)},Ua:function(b){return b.G.ia.Wb},object:a,Qc:!0,T:function(b){return b.G.Eb},cb:[{selected:!1},{selected:!0}]})};function Hf(a){return new uf({Zb:function(b,c){a.Ma[a.ya].eb.state.b(c)},Mc:function(){try{var b=Ff("asebahttp")||("http:"!==document.location.origin.slice(0,5)?"http://127.0.0.1:3000":document.location.origin);pa(b,function(){a.Ma[a.ya].eb.state=fa[0];Wd(a.da)})}catch(c){console.info(c),Wd(a.da)}},isConnected:function(){return null!=a.Ma[a.ya].eb.state},isEnabled:function(b){return"aseba"===b&&null!=a.Ma[a.ya].eb.state},Md:function(){return"Thymio (HTTP)"},zd:"aseba",languages:["aseba","l2"],state:null})}
;function If(a){var b=null;return new uf({Zb:function(c,d){b.run(d)},Mc:function(){try{b=new window.TDM(Ff("w"),{uuid:Ff("uuid")||"auto",change:function(c){a.Ma[a.ya].eb.state=c?{}:null;Wd(a.da)}})}catch(c){console.info(c),Wd(a.da)}},isConnected:function(){return null!=a.Ma[a.ya].eb.state&&b.isConnected()},isEnabled:function(c){return"aseba"===c&&null!=a.Ma[a.ya].eb.state&&b.canRun()},Md:function(){return"Thymio (TDM)"},zd:"aseba",languages:["aseba"],state:null})};function Xi(a){this.w=a||"ws://127.0.0.1:8002/";this.o={};this.m=this.b=null}Xi.prototype.connect=function(){this.h=new WebSocket(this.w);var a=this;this.h.addEventListener("open",function(){a.h.send(JSON.stringify({type:"nodes"}))});this.h.addEventListener("message",function(b){try{var c=JSON.parse(b.data);switch(c.type){case "connect":if(c.id){var d=c.id;a.o[d]=c;a.b&&a.b(d,c.descr)}break;case "disconnect":d=c.id,delete a.o[d],a.m&&a.m(d)}}catch(e){}})};
Xi.prototype.Zb=function(a,b){this.h.send(JSON.stringify({type:"run",id:a,bc:b}))};function Jf(a){var b=null,c=Ff("uuid")||null;c&&(c=c.replace(/^\{(.*)\}$/,"$1"));var d=null;return new uf({Zb:function(e,f){switch(e){case "aseba":e=new xb(d,f);e.ga=yb;var g=zb(e);break;case "l2":e=new xb(d,f);e.ga=Of;g=zb(e);break;case "asm":e=new Qf(d,f),g=Pf(e)}b.Zb(c,g)},Mc:function(){try{var e=Ff("w")||("http:"!==document.location.origin.slice(0,5)?"ws://127.0.0.1:8002":document.location.origin.replace(/^http/,"ws"));b=new Xi(e);b.b=function(f,g){if(null==c||f===c)d=new vb(g),a.Ma[a.ya].eb.state=
{},Wd(a.da)};b.m=function(f){if(null==c||f===c)a.Ma[a.ya].eb.state=null,Wd(a.da)};b.connect()}catch(f){console.info(f),Wd(a.da)}},isConnected:function(){return null!=a.Ma[a.ya].eb.state},isEnabled:function(e){return("aseba"===e||"l2"===e||"asm"===e)&&null!=a.Ma[a.ya].eb.state},Md:function(){return"Thymio (JWS)"},zd:"aseba",languages:["aseba","l2","asm"],state:null})};
}).call(this);
