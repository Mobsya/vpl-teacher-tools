/* Copyright 2018-2019 ECOLE POLYTECHNIQUE FEDERALE DE LAUSANNE - author Yves Piguet */
(function(){
var v,aa,ba,da;function ea(a,b){this.name=a;this.wd=b}var fa=[];function ha(){var a=ia;if(a)for(var b=fa.length-1;0<=b;b--)fa[b]instanceof a&&fa.splice(b,1);else fa=[]}ea.prototype.b=function(){throw"not implemented";};ea.prototype.addEventListener=function(){throw"not implemented";};function ia(a,b,c){ea.call(this,a,b);this.url=c}ia.prototype=Object.create(ea.prototype);ia.prototype.constructor=ia;function ja(a,b,c,d){var e=new XMLHttpRequest;e.timeout=200;e.onerror=function(){c(null)};c&&(e.onreadystatechange=function(){if(4===e.readyState)switch(e.status){case 200:c(e.responseText);break;default:c(null)}});e.open(a,b,!0);e.send(d)}
function ka(a,b){a=a||"";ja("GET",a+"/nodes",function(c){null!==c&&(c=JSON.parse(c),0===c.length?ka(a,b):(ha(),c.forEach(function(b){var c=new ia(b.name,b.aeslId,a+"/nodes/"+b.name,b.protocolVersion);ja("GET",a+"/nodes/"+b.name,function(a){c.description=a?JSON.parse(a):""});fa.push(c)}),b&&b()))})}
function la(a,b){return"<!DOCTYPE aesl-source>\n<network>\n"+[].map(function(a){return"<event size='"+(a.size||0).toString(10)+"' name='"+a.name+"'/>\n"}).join("")+"<keywords flag='true'/>\n<node nodeId='"+(a.wd||1).toString(10)+"' name='"+a.name+"'><![CDATA["+b+"]]\x3e</node>\n</network>\n"}ia.prototype.b=function(a){a=la(this,a);ja("PUT",this.url,void 0,a)};
ia.prototype.addEventListener=function(a,b){a=a.toString();var c=this.url+"/events";a&&(c+="/"+a);c=new EventSource(c);c.onmessage=function(c){b(c.data.split(" ").slice(1).map(function(a){return parseInt(a,10)}),a)};return c};function w(a){this.name=a.name;this.type=a.type;this.ta=a.ta||["b","a"];this.Yf=a.Yf||!1;this.ka=a.ka||null;this.zb=a.zb||null;this.Be=a.Be||null;this.Td=a.Td||null;this.oc=a.oc||null;this.X=a.X||{aseba:"e"===this.type?function(a){return{qd:"# onevent "+a.Z.name+"\n"}}:function(a){return{u:"# "+a.Z.name+"\n"}}};this.J=a.J||function(a,c){a.text(c.Z.name)};this.ga=a.ga||null;this.Ra=a.Ra||null;this.sc=a.sc||null}
function ma(a,b,c,d){for(var e=null;;){var f=/`([^`]*)`/.exec(a);if(null==f)break;e=(new Function("$","i","rgb","return "+f[1]+";"))(b.c,c,function(a){a=[a[0],Math.max(.2+.8*a[1],a[2]/2),a[2]];var b=Math.max(a[0],Math.max(a[1],a[2]));return a.map(function(a){return.88*(1-b)+(.12+.88*b)*a})});a=a.slice(0,f.index)+e+a.slice(f.index+f[0].length)}return d?e:a};function y(a,b,c){this.Z=a;this.wb=b;this.Vd=c;this.locked=this.disabled=!1;this.c=a.ka?a.ka():null;this.Rd=this.b=null}y.prototype.Ab=function(a,b,c){a=new y(this.Z,a,b);a.disabled=this.disabled;a.b=c;this.c&&(a.c=this.c.slice());return a};function z(a){a.b&&a.b()}y.prototype.h=function(a){return this.disabled?{}:this.Z.X[a]?this.Z.X[a](this):na[a].m(this)};function oa(a,b,c){y.call(this,pa[a],b,c)}oa.prototype=Object.create(y.prototype);oa.prototype.constructor=oa;var pa={e:new w({name:"empty e",type:"e",J:function(a,b,c){var d=ra("!empty event");d&&d.J(a,b,c)}}),a:new w({name:"empty a",type:"a",J:function(a,b,c){var d=ra("!empty action");d&&d.J(a,b,c)}}),s:new w({name:"empty s",type:"s",J:function(a,b,c){var d=ra("!empty state")||ra("!empty event");d&&d.J(a,b,c)}})};oa.prototype.h=function(){return{}};function sa(){this.W=[];this.actions=[];this.error=null;this.locked=this.disabled=!1}sa.prototype.Ab=function(){for(var a=new sa,b=0;b<this.W.length;b++)ua(a,this.W[b],null,null);for(b=0;b<this.actions.length;b++)ua(a,this.actions[b],null,null);return a};sa.prototype.Jb=function(){return 0===this.W.length&&0===this.actions.length};function va(a){for(var b=0;b<a.W.length;b++)if("init"===a.W[b].Z.name)return a.W[b];return null}
function ua(a,b,c,d,e){if(b){switch(b.Z.type){case "e":case "s":if(b.wb===a)c&&(a.W.splice(b.Vd.index,1),e?b.b=d:b=b.Ab(a,c,d),a.W.splice(c.index,0,b));else if(c){if(a.W[c.index]===b)return;e?b.b=d:b=b.Ab(a,c,d);a.W[c.index]=b}else e?b.b=d:b=b.Ab(a,{Hc:!0,index:a.W.length},d),a.W.push(b);break;case "a":case "c":if(b.wb===a)c&&(wa(a,b.Vd),e?b.b=d:b=b.Ab(a,c,d),(c.Hc?a.W:a.actions).splice(c.index,0,b));else if(c){if((c.Hc?a.W:a.actions)[c.index]===b)return;e?b.b=d:b=b.Ab(a,c,d);(c.Hc?a.W:a.actions)[c.index]=
b}else e?b.b=d:b=b.Ab(a,{Hc:!1,index:a.actions.length},d),a.actions.push(b)}xa(a)}}function wa(a,b){b.Hc?a.W[b.index]&&a.W.splice(b.index,1):a.actions[b.index]&&a.actions.splice(b.index,1)}function xa(a){a.W.forEach(function(a,c){a.wb=this;a.Vd={Hc:!0,index:c}},a);a.actions.forEach(function(a,c){a.wb=this;a.Vd={Hc:!1,index:c}},a)}
function ya(a,b){function c(a,b){if(a.disabled)return b.disabled?0:1;if(b.disabled)return-1;a=a.Z.name;b=b.Z.name;return a>b?1:a<b?-1:0}function d(a,b){if(null===a.c&&null===b.c)return!0;if(null===a.c||null===b.c||a.c.length!==b.c.length)return!1;for(var c=0;c<a.c.length;c++)if(a.c[c]!==b.c[c])return!1;return!0}function e(a){for(var b=0;b<a.W.length;b++)if(!a.W[b].disabled)return!1;return!0}if(!(a.disabled||b.disabled||e(a)||e(b)||0===a.W.length||b.W.length!==a.W.length)){for(var f=a.W.slice().sort(c),
g=b.W.slice().sort(c),h=0;h<f.length&&!f[h].disabled&&!g[h].disabled;h++)if(f[h].Z!==g[h].Z||!d(f[h],g[h]))return;if(null==a.error||a.error.Eb)f=new za("Duplicate event"),Aa(f,b),a.error=f;if(null==b.error||b.error.Eb)f=new za("Duplicate event"),Aa(f,a),b.error=f}};function Ba(){this.b=[];this.Ua=!1}function Ca(a,b){a.b=b.slice()}Ba.prototype.toggle=function(a){var b=this.b.indexOf(a);0<=b?this.b.splice(b,1):this.b.push(a)};function Da(a){this.filename=null;this.readOnly=!1;this.mode="b";this.ia=!1;this.Gb=!0;this.Sf=!1;this.i=[];this.Ac=!1;this.mf=!0;this.o=this.m=this.na=null;this.zc=new Ea;this.code={};this.Bb="aseba";this.message=null;this.jc=Fa;this.b=Ga;this.ic=Ha;this.Ba=a||new Ba;this.h=null}var na={},Fa=[],Ga=!1,Ha=[];function Ia(){Fa=Ja("b").map(function(a){return a.name});Ha=Ja("a").map(function(a){return a.name})}
function Ma(a){var b=Na.map(function(a){return a.name});switch(a){case "b":Fa=b;break;case "a":Ha=b}}v=Da.prototype;v.Wd=function(){this.Ba.b=[]};function Oa(a,b){b?(b=a.zc,b.Ub=[],b.Mc=[]):a.yb();a.mode="b";a.jc=Fa;a.b=Ga;a.ic=Ha;a.i=[];a.code={};a.mf=!0}v.Jb=function(){for(var a=0;a<this.i.length;a++)if(!this.i[a].Jb())return!1;return!0};v.getError=function(){for(var a=0;a<this.i.length;a++)if(null!==this.i[a].error)return this.i[a].error;return null};
function Pa(a){if("b"!==a.mode||a.b)return!1;for(var b=0;b<a.i.length;b++)if(1<a.i[b].W.length||0<a.i[b].W.length&&"s"===a.i[b].W[0].Z.type)return!1;return!0}v.yb=function(){this.zc.yb(Qa(this),this.Ac);this.code={};this.Ac=!1};v.xf=function(a){if(0<this.zc.Ub.length){var b=this.zc.xf(Qa(this),this.Ac);Ra(this,b.state,a);this.Ac=b.b;this.code={}}};v.qf=function(a){if(0<this.zc.Mc.length){var b=this.zc.qf(Qa(this),this.Ac);Ra(this,b.state,a);this.Ac=b.b;this.code={}}};
function Sa(a,b){b!==a.mode&&(a.yb(),a.mode=b,a.i.forEach(function(a){a.W.forEach(function(b,c){a.W[c]=b});a.actions.forEach(function(b,c){a.actions[c]=b})}))}function Ta(a){var b="teacher"===Ua("role");a.Gb=b}
function Qa(a,b){var c={};b&&!1===b.ed||(c.advanced="a"===a.mode,c.basicBlocks=a.jc,c.basicMultiEvent=a.b,c.advancedBlocks=a.ic,c.disabledUI=a.Ba.b);if(b&&!1===b.gd)return c;b=a.m?a.m():null;var d=null;null==b&&(d=a.i.map(function(a){function b(a){a&&c.push({name:a.Z.name,disabled:a.disabled,locked:a.locked,param:a.Z.Be?a.Z.Be(a):a.c?a.c.slice():null})}var c=[];a.W.forEach(function(a){b(a)});a.actions.forEach(function(a){b(a)});return{blocks:c,disabled:a.disabled,locked:a.locked}}));c.program=d;c.code=
b;return c}function Va(a,b){return JSON.stringify(Qa(a,b),null,"\t")}
function Ra(a,b,c){var d=!1,e="vpl";try{if(b&&(a.mode=b.advanced?"a":"b",b.disabledUI&&Ca(a.Ba,b.disabledUI),a.jc=b.basicBlocks||Fa,a.b=b.basicMultiEvent||Ga,a.ic=b.advancedBlocks||Ha,b.program?a.i=b.program.map(function(b){var e=new sa;b.blocks.forEach(function(b){var f=ra(b.name);if(f){var g=new y(f,null,null);g.disabled=b.disabled||!1;g.locked=b.locked||!1;f.Td?f.Td(g,b.param,function(){d&&c&&c("vpl")}):g.c=b.param;ua(e,g,null,function(){a.yb()},!0)}},this);e.disabled=b.disabled||!1;e.locked=b.locked||
!1;return e},a):a.i=[],a.o)){var f=b.code;a.o(void 0==b.code?null:f);null!=f&&(e="src")}}catch(g){}a.ia="src"===e;c&&c(e);d=!0}function Wa(a,b,c){try{var d=JSON.parse(b);Ra(a,d,c);var e=a.zc;e.Ub=[];e.Mc=[]}catch(f){}}v.Qb=function(a){"string"!==typeof this.code[a]&&(this.code[a]=na[a].h(this));return this.code[a]};function Xa(a,b){var c=na[a];a=Ya(c,b,!0);b=Ya(c,b,!1);return 0<=a&&0<=b?{qd:a,end:b}:null}function Za(a,b){a.h=b}v.log=function(a){this.h&&this.h(a)};function $a(a,b,c){this.language=a;this.o=b;this.F=c;this.b=[]}function ab(a,b,c){this.id=a;this.m=b;this.h=c;if(0>a||6399<a)throw"internal";this.w=String.fromCharCode(57344+a);this.b=-1}
function bb(a,b){a.forEach(function(a){a.b=b.indexOf(a.w)});a.sort(function(a,b){return a.b-b.b});for(var c=0;c<a.length;c++)a[c].b-=c,b=b.replace(a[c].w,"");a.forEach(function(a){var c;if(a.h){for(;;){for(c=a.b;" "===b[c]||"\t"===b[c];c++);if("\n"===b[c])a.b=c+1;else break}if(" "===b[a.b-1]||"\t"===b[a.b-1]){for(c=a.b-1;" "===b[c]||"\t"===b[c];c--);"\n"===b[c]&&(a.b=c+1)}}else if(" "===b[a.b-1]||"\t"===b[a.b-1]){for(c=a.b-1;" "===b[c]||"\t"===b[c];c--);"\n"===b[c]&&(a.b=c+1)}});return b}
function cb(a){return a.replace(/[\ue000-\uf8ff]/g,"")}function db(a,b,c){var d=a.b.length,e=new ab(d,c,!0);a.b.push(e);c=new ab(d+1,c,!1);a.b.push(c);return e.w+b+c.w}function Ya(a,b,c){for(var d=0;d<a.b.length;d++)if(a.b[d].m===b&&a.b[d].h===c)return a.b[d].b;return-1}
function eb(a,b){if(b.disabled||b.Jb())return{};b.error=null;for(var c=!1,d=!1,e=0;e<b.W.length;e++)if(!b.W[e].disabled)if("e"===b.W[e].Z.type){if(c=!0,b.W[e].Z.oc){var f=b.W[e].Z.oc(b.W[e]);if(f&&(hb(f,[e]),!f.Eb||!b.error)&&(b.error=f,!f.Eb))return{error:f}}}else"s"===b.W[e].Z.type&&(d=!0);f=!1;for(e=0;e<b.actions.length;e++)if(!b.actions[e].disabled&&"a"===b.actions[e].Z.type){f=!0;break}if(!c&&!f)return b.error?{error:b.error}:{};if(!c&&!d)return f=new za("Missing event block"),hb(f,[]),b.error=
f,{error:f};if(!f)return f=new za("Missing action block"),f.b.push(0),b.error=f,{error:f};if(!b.error)for(e=0;e<b.actions.length;e++)for(c=e+1;c<b.actions.length;c++)"a"===b.actions[c].Z.type&&b.actions[c].Z===b.actions[e].Z&&(f=new za("Duplicate action blocks",!0),f.b.push(e),f.b.push(c),b.error=f);var g=[],h=[],m=[],l="",r=[],n="",k=[],q="";b.W.forEach(function(a,b){var c=a.h(this.language);c.I&&(0===b&&c.B?(l=db(this,c.I,a),c.R&&(n+=c.R)):(r.push(db(this,c.I,a)),c.R&&(k=k.concat(c.R))));c.S&&(g=
g.concat(c.S));c.C&&(h=h.concat(c.C));c.Xa&&(m=m.concat(c.Xa));c.u&&(q+=db(this,c.u,a))},a);for(e=0;e<b.actions.length;e++)c=b.actions[e].h(a.language),q+=c.u?db(a,c.u,b.actions[e]):"",c.S&&c.S.forEach(function(a){0>g.indexOf(a)&&g.push(a)}),c.C&&c.C.forEach(function(a){0>h.indexOf(a)&&h.push(a)}),c.Xa&&c.Xa.forEach(function(a){0>m.indexOf(a)&&m.push(a)});return 0<q.length?(e="e"===b.W[0].Z.type?b.W[0].h(a.language):null,c=b.W.slice(1).filter(function(a){return"e"===a.Z.type}).map(function(a){return a.h(this.language)},
a),{Sg:b.W[0]?b.W[0].Z.name:"",S:g,C:h,Xa:m,B:e?e.B:"",U:e?e.U:"",bb:e?e.bb:"",Jd:c.map(function(a){return a.B||""}),Qe:c.map(function(a){return a.U||""}),Re:c.map(function(a){return a.bb||""}),R:n,Id:k,I:l,Xb:r.join(" "+a.o+" "),u:(e&&e.u||"")+q}):{}}$a.prototype.h=function(){throw"internal";};$a.prototype.m=function(){throw"internal";};function ib(){$a.call(this,"aseba","and","1 == 1")}ib.prototype=Object.create($a.prototype);ib.prototype.constructor=ib;
ib.prototype.h=function(a,b){this.b=[];var c=a.i.map(function(a){return eb(this,a)},this),d={},e=[];c.forEach(function(a){a.B&&(d[a.B]={B:a.B,U:a.U,bb:a.bb,R:"",pb:""},0>e.indexOf(a.B)&&e.push(a.B));a.Jd&&a.Jd.forEach(function(b,c){d[b]={B:b,U:a.Qe[c],bb:a.Re[c],R:"",pb:""};0>e.indexOf(b)&&e.push(b)})});var f=[],g=[],h=[],m=[];c.forEach(function(b,c){b.S&&b.S.forEach(function(a){0>f.indexOf(a)&&f.push(a)});b.C&&b.C.forEach(function(a){0>g.indexOf(a)&&g.push(a)});b.Xa&&b.Xa.forEach(function(a){0>h.indexOf(a)&&
h.push(a)});if(b.B&&(b.mb=m.indexOf(cb(b.I||b.B)),0>b.mb)){b.mb=m.length;m.push(cb(b.I||b.B));var e=d[b.B];b.R&&0>e.R.indexOf(b.R)&&(b.R+=b.R);e.pb+=b.I?"when "+b.I+" do\neventCache["+b.mb+"] = 1\nend\n":"eventCache["+b.mb+"] = 1\n"}b.B||(b.u=db(this,b.u||"",a.i[c]))},this);var l="";if(b){var r=new sa,n=new y(ra("init"),null,null);ua(r,n,null,null);b.forEach(function(a){ua(r,a,null,null)});n=eb(this,r);var k=!0;n.S.forEach(function(a){0>f.indexOf(a)&&(k=!1)});n.Xa.forEach(function(a){0>h.indexOf(a)&&
(k=!1)});k?l=n.u:n.Ob&&(l=n.Ob)}var q=[],p="",u="",t=0;for(n=0;n<a.i.length;n++)0<=c[n].mb?(c[n].Id&&c[n].Id.forEach(function(a){0>q.indexOf(a)&&q.push(a)}),p+="if eventCache["+c[n].mb+"] != 0"+(c[n].Xb?" and "+c[n].Xb:"")+" then\ntodo["+t+"] = 1\nend\n",u+="if todo["+t+"] != 0 then\n"+c[n].u+"end\n",t++):c[n].Xb&&(p+="when "+c[n].Xb+" do\ntodo["+t+"] = 1\nend\n",u+="if todo["+t+"] != 0 then\n"+c[n].u+"end\n",t++);c=0<f.length?"\n"+f.join("\n"):"";0<m.length&&(c+="var eventCache[] = ["+m.map(function(){return"0"}).join(", ")+
"]\n");if(0<t){c+="var todo[] = [";for(n=0;n<t;n++)c+=0<n?", 0":"0";c+="]\n"}b?c+="\n"+l:(0<g.length&&(c+="\n"+g.join("\n")),p&&(c+=(0<c.length?"\n":"")+"timer.period[1] = 50\n"));0<h.length&&(c+="\n"+h.join("\n"));for(n=0;n<e.length;n++)if(d[e[n]].bb||d[e[n]].R||d[e[n]].pb)c+="\n"+(d[e[n]].B||"")+(d[e[n]].bb||"")+(d[e[n]].R||"")+(d[e[n]].pb||"")+(d[e[n]].U||"");if(p){c+="\nonevent timer1\n"+q.join("")+p+u;for(n=0;n<m.length;n++)c+="eventCache["+n+"] = 0\n";for(n=0;n<t;n++)c+="todo["+n+"] = 0\n"}"\n"===
c[0]&&(c=c.slice(1));var B=0;b=c.split("\n").map(function(a){return a.trim()}).map(function(a){function b(b){for(var c=cb(a),d=0;d<b.length;d++)if(c.slice(0,b[d].length)===b[d]&&!/^\w/.test(c.slice(b[d].length)))return!0;return!1}if(0<a.length){var c=b("if else elseif for onevent sub when while".split(" "));b(["else","elseif","end","onevent","sub"])&&(B=Math.max(B-1,0));a="\t\t\t\t\t".slice(0,B)+a;c&&B++}return a});for(n=b.length-2;0<=n;n--)/^\s*#/.test(b[n])&&(l=b[n+1].replace(/^(\s*).*$/,"$1"),
b[n]=l+b[n].replace(/^\s*/,""));c=b.join("\n");for(n=0;n<a.i.length;n++)for(b=n+1;b<a.i.length;b++)ya(a.i[n],a.i[b]);return c=bb(this.b,c)};ib.prototype.m=function(a){var b="# missing Aseba implementation for block "+a.Z.name+"\n";switch(a.Z.type){case "e":case "s":return{R:b,I:"1 == 1"};case "a":return{u:b};default:return{}}};na.aseba=new ib;function jb(){$a.call(this,"l2","&&","true")}jb.prototype=Object.create($a.prototype);jb.prototype.constructor=jb;
jb.prototype.h=function(a,b){this.b=[];var c=a.i.map(function(a){return eb(this,a)},this),d={},e=[];c.forEach(function(a){a.B&&(d[a.B]={B:a.B,U:a.U,bb:a.bb,R:"",pb:""},0>e.indexOf(a.B)&&e.push(a.B));a.Jd&&a.Jd.forEach(function(b,c){d[b]={B:b,U:a.Qe[c],bb:a.Re[c],R:"",pb:""};0>e.indexOf(b)&&e.push(b)})});var f=[],g=[],h=[],m=[];c.forEach(function(b,c){b.S&&b.S.forEach(function(a){0>f.indexOf(a)&&f.push(a)});b.C&&b.C.forEach(function(a){0>g.indexOf(a)&&g.push(a)});b.Xa&&b.Xa.forEach(function(a){0>h.indexOf(a)&&
h.push(a)});if(b.B&&(b.mb=m.indexOf(cb(b.I||b.B)),0>b.mb)){b.mb=m.length;m.push(cb(b.I||b.B));var e=d[b.B];b.R&&0>e.R.indexOf(b.R)&&(b.R+=b.R);e.pb+=b.I?"when ("+b.I+") {\neventCache["+b.mb+"] = true;\n}\n":"eventCache["+b.mb+"] = true;\n"}b.B||(b.u=db(this,b.u||"",a.i[c]))},this);var l="";if(b){var r=new sa,n=new y(ra("init"),null,null);ua(r,n,null,null);b.forEach(function(a){ua(r,a,null,null)});l=eb(this,r).u}var k=[],q="",p="",u=0;for(n=0;n<a.i.length;n++)0<=c[n].mb?(c[n].Id&&c[n].Id.forEach(function(a){0>
k.indexOf(a)&&k.push(a)}),q+="if (eventCache["+c[n].mb+"]"+(c[n].Xb?" && "+c[n].Xb:"")+") {\ntodo["+u+"] = true;\n}\n",p+="if (todo["+u+"]) {\n"+c[n].u+"}\n",u++):c[n].Xb&&(q+="when ("+c[n].Xb+") {\ntodo["+u+"] = true;\n}\n",p+="if (todo["+u+"]) {\n"+c[n].u+"}\n",u++);c=0<f.length?"\n"+f.join("\n"):"";0<m.length&&(c+="bool eventCache["+m.length+"] = false;\n");b?c+="\n"+l:(n="",0<g.length&&(n+="\n"+g.join("\n")),n&&(c+=(0<c.length?"\n":"")+n.slice(1)),q&&(c+=(0<c.length?"\n":"")+"timer.period[1] = 50;\n"));
0<h.length&&(c+="\n"+h.join("\n"));for(n=0;n<e.length;n++)if(d[e[n]].bb||d[e[n]].R||d[e[n]].pb)c+="\n"+(d[e[n]].B||"")+(d[e[n]].bb||"")+(d[e[n]].R||"")+(d[e[n]].pb||"")+(d[e[n]].U||"");q&&(c+="\nonevent timer1 {\n",0<u&&(c+="bool todo["+u+"] = false;\n"),c+=k.join("")+q+p+"eventCache = false;\n}\n");"\n"===c[0]&&(c=c.slice(1));var t=0;b=c.split("\n").map(function(a){return a.trim()}).map(function(a){var b=cb(a);if(0<b.length){var c="{"===b.slice(-1);"}"===b[0]&&(t=Math.max(t-1,0));a="\t\t\t\t\t".slice(0,
t)+a;c&&t++}return a});for(n=b.length-2;0<=n;n--)/^\s*#/.test(b[n])&&(q=b[n+1].replace(/^(\s*).*$/,"$1"),b[n]=q+b[n].replace(/^\s*/,""));c=b.join("\n");for(n=0;n<a.i.length;n++)for(b=n+1;b<a.i.length;b++)ya(a.i[n],a.i[b]);return c=bb(this.b,c)};jb.prototype.m=function(a){var b="// missing L2 implementation for block "+a.Z.name+"\n";switch(a.Z.type){case "e":case "s":return{R:b,I:"true"};case "a":return{u:b};default:return{}}};na.l2=new jb;function kb(){$a.call(this,"js","&&","true")}kb.prototype=Object.create($a.prototype);kb.prototype.constructor=kb;
kb.prototype.h=function(a,b){this.b=[];var c=a.i.map(function(a){return eb(this,a)},this),d={},e=[];c.forEach(function(a){a.B&&(d[a.B]={B:a.B,U:a.U,bb:a.bb,R:"",pb:""},0>e.indexOf(a.B)&&e.push(a.B));a.Jd&&a.Jd.forEach(function(b,c){d[b]={B:b,U:a.Qe[c],bb:a.Re[c],R:"",pb:""};0>e.indexOf(b)&&e.push(b)})});var f=[],g=[],h=[],m=[],l=[],r=0;c.forEach(function(b,c){b.S&&b.S.forEach(function(a){0>f.indexOf(a)&&f.push(a)});b.C&&b.C.forEach(function(a){0>g.indexOf(a)&&g.push(a)});b.Xa&&b.Xa.forEach(function(a){0>
h.indexOf(a)&&h.push(a)});var e=b.u||"";b.I&&(e="cond = "+b.I+";\nif (cond && !cond0["+r+"]) {\n"+e+"}\ncond0["+r+"] = cond;\n",r++);if(b.B&&(b.mb=m.indexOf(cb(b.I||b.B)),0>b.mb)){b.mb=m.length;m.push(cb(b.I||b.B));var p=d[b.B];b.R&&0>p.R.indexOf(b.R)&&(b.R+=b.R);b.I?(p.pb+="cond = "+b.I+";\nif (cond && !cond0["+r+"]) {\neventCache["+b.mb+"] = true;\n}\ncond0["+r+"] = cond;\n",r++):p.pb+="eventCache["+b.mb+"] = true;\n"}b.B||(b.u=db(this,e,a.i[c]));va(a.i[c])&&l.push(c)},this);var n="";if(b){var k=
new sa,q=new y(ra("init"),null,null);ua(k,q,null,null);b.forEach(function(a){ua(k,a,null,null)});n=eb(this,k).u}var p=[],u="",t="",B=0;for(q=0;q<a.i.length;q++)0<=c[q].mb?(c[q].Id&&c[q].Id.forEach(function(a){0>p.indexOf(a)&&p.push(a)}),u+="if (eventCache["+c[q].mb+"]"+(c[q].Xb?" && "+c[q].Xb:"")+") {\ntodo["+B+"] = true;\n}\n",t+="if (todo["+B+"]) {\n"+c[q].u+"}\n",B++):c[q].Xb&&(u+="cond = "+c[q].Xb+";\nif (cond && !cond0["+r+"]) {\ntodo["+B+"] = 1\n}\ncond0["+r+"] = cond;\n",r++,t+="if todo["+
B+"] != 0 then\n"+c[q].u+"end\n",B++);0<r&&(f.unshift("var cond0;\nvar cond;\n"),g.unshift("cond0 = [];\n"));var A=0<f.length?"\n"+f.join("\n"):"";0<m.length&&(A+="var eventCache = [];\n");0<B&&(A+="var todo = [];\n");if(b)A+="\n"+n;else{b="";0<g.length&&(b+="\n"+g.join("\n"));u&&(b+="this.setTimer(1, 0.1, true);\n");for(q=0;q<a.i.length;q++)0<=l.indexOf(q)&&c[q].u&&(b+=(0<b.length?"\n":"")+(c[q].B||"")+(c[q].u||"")+(c[q].U||""));b&&(A+=(0<A.length?"\n":"")+'this.addEventListener("init", function (name, param) {\n'+
b.slice(1)+"});\n")}if(0<h.length)throw"internal error, unsupported sub/onevent in js";for(q=0;q<e.length;q++)if(d[e[q]].bb||d[e[q]].R||d[e[q]].pb)A+="\n"+(d[e[q]].B||"")+(d[e[q]].bb||"")+(d[e[q]].R||"")+(d[e[q]].pb||"")+(d[e[q]].U||"");if(u){A+='\nthis.addEventListener("timer1", function (name, param) {\n'+p.join("")+u+t;for(q=0;q<m.length;q++)A+="eventCache["+q+"] = false;\n";for(q=0;q<B;q++)A+="todo["+q+"] = false;\n"}A+="});";"\n"===A[0]&&(A=A.slice(1));var J=0;c=A.split("\n").map(function(a){return a.trim()}).map(function(a){var b=
cb(a);if(0<b.length){var c="{"===b.slice(-1);"}"===b[0]&&(J=Math.max(J-1,0));a="\t\t\t\t\t".slice(0,J)+a;c&&J++}return a});for(q=c.length-2;0<=q;q--)/^\s*#/.test(c[q])&&(A=c[q+1].replace(/^(\s*).*$/,"$1"),c[q]=A+c[q].replace(/^\s*/,""));A=c.join("\n");for(q=0;q<a.i.length;q++)for(c=q+1;c<a.i.length;c++)ya(a.i[q],a.i[c]);return A=bb(this.b,A)};
kb.prototype.m=function(a){var b="// missing JavaScript implementation for block "+a.Z.name+"\n";switch(a.Z.type){case "e":case "s":return{R:b,I:"true"};case "a":return{u:b};default:return{}}};na.js=new kb;function lb(){$a.call(this,"python","and","True")}lb.prototype=Object.create($a.prototype);lb.prototype.constructor=lb;
lb.prototype.h=function(a,b){this.b=[];var c=a.i.map(function(a){return eb(this,a)},this),d=[],e=[],f=[],g={},h=[],m=!1;c.forEach(function(b,l){b.S&&b.S.forEach(function(a){0>d.indexOf(a)&&d.push(a)});b.C&&b.C.forEach(function(a){0>e.indexOf(a)&&e.push(a)});b.Xa&&b.Xa.forEach(function(a){0>f.indexOf(a)&&f.push(a)});var p=b.u||"";b.I&&(p="self.cond = "+b.I+"\nif self.cond and not self.cond0["+l+"]:\n"+p+"<\nself.cond0["+l+"] = cond\n",m=!0);p=db(this,p,a.i[l]);if(b.B)if(void 0!==g[b.B]){var k=c[g[b.B]];
b.R&&(!k.R||0>k.R.indexOf(b.R))&&(k.R=(k.R||"")+b.R);k.u+=p;b.u=void 0}else g[b.B]=l,b.u=p;else b.u=p;va(a.i[l])&&h.push(l)},this);var l="";if(b){var r=new sa,n=new y(ra("init"),null,null);ua(r,n,null,null);b.forEach(function(a){ua(r,a,null,null)});l=eb(this,r).u}m&&(d.unshift("self.cond0 = {}\nself.cond = {}\n"),e.unshift("self.cond0 = {}\n"));n=0<d.length?d.join("\n"):"";b&&(n+="\n"+l);n&&(n="def __init__(self):\n"+n+"<\n");if(!b){l="";0<e.length&&(l+="\n"+e.join("\n"));for(b=0;b<a.i.length;b++)0<=
h.indexOf(b)&&c[b].u&&(l+=(0<l.length?"\n":"")+(c[b].B||"")+(c[b].u||"")+(c[b].U||""));l&&(n+=(0<n.length?"\n":"")+"def event_init(self):\n"+l.slice(1)+"<\n")}if(0<f.length)throw"internal error, unsupported sub/onevent in js";for(b=0;b<a.i.length;b++)0>h.indexOf(b)&&c[b].u&&(n+="\n",n+=(c[b].B||"")+(c[b].R||"")+(c[b].u||"")+(c[b].U||""));"\n"===n[0]&&(n=n.slice(1));n="class Robot(RobotBase):\n"+(cb(n)?n:"pass\n")+"<\n";n=cb(n);n=n.replace(/\n[ \t]+/g,"\n").replace(/\n<\n\n<\n/g,"\n<\n<\n");var k=
0,q="";n.split("\n").map(function(a){return a.trim()}).forEach(function(a){var b=cb(a);if(0<b.length){var c=":"===b.slice(-1);"<"===b&&(k=Math.max(k-1,0));"<"!==b&&(a="\t\t\t\t\t".slice(0,k)+a,c&&k++)}"<"!==b&&(q+=a+"\n")});n=q;for(b=0;b<a.i.length;b++)for(l=b+1;l<a.i.length;l++)ya(a.i[b],a.i[l]);return n=bb(this.b,n)};lb.prototype.m=function(a){var b="# missing Python implementation for block "+a.Z.name+"\n";switch(a.Z.type){case "e":case "s":return{R:b,I:"True"};case "a":return{u:b};default:return{}}};
na.python=new lb;function mb(a){this.b=[];this.h=a||null}v=mb.prototype;v.add=function(a,b){this.b.push(new nb(a,b))};v.find=function(a){for(var b=0;b<this.b.length;b++)if(this.b[b].name===a)return this.b[b];return null};function pb(a,b){a=a.find(b);return null!=a&&null!=a.m}function qb(a,b){if(a.h){var c=a.find(b);b={cmd:b};c.h&&(b.selected=c.Za());c.b&&(b.state=c.getState());a.h({type:"cmd",data:b})}}v.hb=function(a,b){this.h&&this.h({type:"drop",data:{cmd:a}});(a=this.find(a))&&a.hb(b)};
v.gb=function(a,b){a=this.find(a);return null!=a&&a.gb(b)};v.ba=function(a){a=this.find(a);return null!=a&&a.ba()};v.isEnabled=function(a){a=this.find(a);return null!=a&&a.isEnabled()};v.Za=function(a){a=this.find(a);return null!=a&&a.Za()};v.getState=function(a){a=this.find(a);return null!=a?a.getState():null};
function nb(a,b){this.name=a;this.o=b.isEnabled||null;this.h=b.Za||null;this.b=b.getState||null;this.m=b.action||null;this.P=b.hb||null;this.F=b.gb||null;this.mc=b.object||null;this.xc=b.xc||!1;this.ca=b.ba||null}function rb(a,b){a.isEnabled()&&a.m&&a.m(a.mc,b)}function sb(a,b){if(!a.b)return!1;var c=a.getState();if(b===c)return!0;for(var d=0;100>d;d++){rb(a,void 0);var e=a.getState();if(e===b)return!0;if(e===c)break}return!1}v=nb.prototype;v.hb=function(a){this.gb(a)&&this.P&&this.P(this.mc,a)};
v.gb=function(a){return null!=this.F&&this.F(this.mc,a)};v.isEnabled=function(){return null==this.o||this.o(this.mc)};v.Za=function(){return null!=this.h&&this.h(this.mc)};v.getState=function(){return null!=this.b?this.b(this.mc):null};v.ba=function(){return null==this.ca||this.ca(this.mc)};function tb(){var a=document.getElementById("programCanvas");ub||(Ia(),ub=!0);this.ca=a;this.ea=new vb;this.Ba=new Ba;var b=this;this.b=new mb(function(a){b.log(a)});this.m=null;this.P="vpl:close !space vpl:about vpl:help !space vpl:new vpl:save vpl:load vpl:upload vpl:filename vpl:exportToHTML !space vpl:advanced !stretch vpl:readonly !stretch vpl:undo vpl:redo !stretch vpl:run vpl:stop vpl:robot !stretch vpl:sim vpl:text !stretch vpl:teacher-reset vpl:teacher-save vpl:teacher-setasnew vpl:teacher".split(" ");
this.o="!!stretch vpl:message-error vpl:message-warning !!stretch vpl:duplicate vpl:disable vpl:lock vpl:trashcan".split(" ");this.za=["vpl"];this.cb={vpl:1,src:1,sim:1};this.Dd=this.hf=this.Uf=this.ae=this.ie=null;this.dc=!1;this.username=null;this.i=new Da(this.Ba);Za(this.i,function(a){b.log(a)});this.Vb="";this.Ed=!1;this.ja=new wb(a,{ea:this.ea});this.ja.state={Lg:new xb};this.F="";this.O=this.h=null;this.$a=[];this.Ma=-1;this.Af=this.vd=!1;this.Da=[];this.qa=null}var ub=!1;
function yb(a,b){a.ae=b?new zb(b):null}function Ab(a,b){a.hf=b?new zb(b):null}
function Bb(a,b,c){function d(){0<=b.indexOf("vpl")&&C(a.ja);0<=b.indexOf("src")&&C(a.K.Ha);0<=b.indexOf("sim")&&C(a.h)}c&&(c.ia||c.yf)&&(a.i.ia=!0,a.K.ia=!0,Cb(a.K,!1));if(1===b.length&&c&&c.td&&1<a.za.length){if(0<=a.za.indexOf(b[0]))return;var e=a.za.slice();e[a.za[0]===c.td?1:0]=b[0];b=e}else c&&c.yd?0>a.za.indexOf(b[0])&&(b=a.za.concat(b)):1===b.length&&c&&c.ye&&1<a.za.length&&0<=a.za.indexOf(b[0])?(a.za.splice(a.za.indexOf(b[0]),1),b=a.za):1===b.length&&c&&c.toggle&&(0<=a.za.indexOf(b[0])?(a.za.splice(a.za.indexOf(b[0]),
1),b=a.za):b=a.za.concat(b));a.za=b;null!=a.O&&a.h.lc();a.ja.lc();null!=a.K&&(document.getElementById("src-editor").style.display=0<=b.indexOf("src")?"block":"none",a.K.Ha.lc());0<=b.indexOf("vpl")&&a.ja.show();0<=b.indexOf("src")&&a.K.Ha.show();null!=a.O&&0<=b.indexOf("sim")&&a.h.show();Db(a,window.innerWidth<window.innerHeight);for(e=0;e<b.length;e++)switch(b[e]){case "vpl":a.ja.na=function(){if(!a.i.ia){a.i.code={};var b=a.i;if(0!==b.i.length&&b.i[b.i.length-1].Jb())for(;1<b.i.length&&b.i[b.i.length-
2].Jb();)b.i.splice(-2,1);else b.i.push(new sa);if(a.K){b=a.K;var c=a.i.Qb(a.i.Bb);if(b.Sc){var d=b.Qd(b.language,c);null!==d&&(Eb(b,d,!0),b.Tb.sb.readOnly=!0,b.Sc=c)}else Eb(b,c)}a.log()}Fb(a)};break;case "src":Cb(a.K,!(c&&(c.ia||c.yf)));a.K.focus();a.K.resize(window.innerWidth,window.innerHeight);break;case "sim":a.h.na=function(){Gb(a)}}c&&(c.ye||c.yd)&&Hb(a);a.ja&&(a.ja.kb=d);a.K&&a.K.Ha&&(a.K.Ha.kb=d);a.h&&(a.h.kb=d);0<=b.indexOf("vpl")&&(a.ja.na(),a.ja.kb?a.ja.kb():C(a.ja));0<=b.indexOf("src")&&
(Ib(a),a.K.Ha.kb?a.K.Ha.kb():C(a.K.Ha));0<=b.indexOf("sim")&&(a.start(!1),a.h.na(),a.h.kb?a.h.kb():C(a.h))}function Db(a,b){for(var c=a.za.map(function(a){return this.cb[a]},a),d=c.reduce(function(a,b){return a+b},0),e=0,f=0;f<a.za.length;f++){var g=b?{Y:0,oa:1,aa:e,ma:e+c[f]/d}:{Y:e,oa:e+c[f]/d,aa:0,ma:1};e+=c[f]/d;switch(a.za[f]){case "vpl":Jb(a.ja,g);break;case "src":Jb(a.K.Ha,g);break;case "sim":Jb(a.h,g)}}}
function Hb(a){var b=a.ja.b.parentElement.getBoundingClientRect(),c=b.width;b=window.innerHeight-b.top;Db(a,c<b);window.vplDisableResize&&(b=a.ja.b.getBoundingClientRect(),c=b.width,b=b.height);a.ja.resize(c,b);a.K&&a.K.resize(c,b);a.O&&a.h.resize(c,b);a.za.forEach(function(a){switch(a){case "vpl":Fb(this);break;case "src":C(this.K.Ha);break;case "sim":this.O&&Gb(this)}},a);a.ae&&Kb(a.ae)}function Lb(a){if(0<=a.Ma){var b=ra("!stop"),c=a.i.Bb;(b=b&&b.X[c])&&a.$a[a.Ma].xb.nc(b(null).u,c)}}
function Mb(a){return!a.i.ia&&a.$a[a.Ma].xb.isEnabled(a.i.Bb)}function Nb(a,b){a.Da.push(b)}tb.prototype.log=function(a){if(null==a){Ob(this);a={type:"vpl-changed",data:{nrules:this.i.i.reduce(function(a,b){return 0<b.W.length+b.actions.length?a+1:a},0),nblocks:this.i.i.reduce(function(a,b){return a+b.W.length+b.actions.length},0),error:this.Vb&&!this.Ed?this.Vb:null,warning:this.Vb&&this.Ed?this.Vb:null}};var b=JSON.stringify(a);if(b===this.qa)return;this.qa=b}this.Da.forEach(function(b){b(a)})};function Pb(a){function b(b){function d(b){for(var c=0;c<B.length;c++)if(B[c].uri&&a.rb[A].ff(b,Qb(B[c].uri).id))return!0;return!1}var e=b.name;if("!"===e[0])return 0;var h=0;/^\w/.test(e)||(c+='Bad block name "'+e+'"\n',h++);var m=b.defaultParameters,l=b.typicalParameters,r=b.buttons,n=b.radiobuttons,k=b.sliders,q=b.rotating,p=b.diffwheelmotion,u=b.score,t=b.otherParameters?parseInt(b.otherParameters,10):0,B=b.draw;if(B){var A=null;for(b=0;b<B.length;b++)if(B[b].uri)if(null==A){A=Qb(B[b].uri).Ic;
var J=a.rb[A]}else{var D=Qb(B[b].uri);D.Ic!==A?(c+='In block "'+e+'", multiple svg\n',h++):J.$b(D.id)||(c+='In block "'+e+'", uri "'+B[b].uri+'" not found\n',h++)}}r&&r.forEach(function(a){J.$b(a.id)?d(a.id)||(c+='In block "'+e+'", button id "'+a.id+'" not displayed\n',h++):(c+='In block "'+e+'", button id "'+a.id+'" not found\n',h++);void 0==a.val?(c+='In block "'+e+'", missing property "val"\n',h++):void 0==a.st?(c+='In block "'+e+'", missing property "st"\n',h++):a.val.length!==a.st.length&&(c+=
'In block "'+e+'", properties "val" and "st" have different lengths\n',h++)});n&&n.forEach(function(a){J.$b(a.id)?d(a.id)?void 0==a.val?(c+='In block "'+e+'", missing property "val"\n',h++):a.val instanceof Array?(c+='In block "'+e+'", illegal array in property "val"\n',h++):void 0==a.st?(c+='In block "'+e+'", missing property "st"\n',h++):2!==a.st.length&&(c+='In block "'+e+'", property "st" must have length 2\n',h++):(c+='In block "'+e+'", radiobutton id "'+a.id+'" not displayed\n',h++):(c+='In block "'+
e+'", radiobutton id "'+a.id+'" not found\n',h++)});k&&k.forEach(function(a){J.$b(a.id)?d(a.id)||(c+='In block "'+e+'", slider id "'+a.id+'" not displayed\n',h++):(c+='In block "'+e+'", slider id "'+a.id+'" not found\n',h++);J.$b(a.thumbId)?d(a.thumbId)||(c+='In block "'+e+'", slider thumbId "'+a.thumbId+'" not displayed\n',h++):(c+='In block "'+e+'", slider thumbId "'+a.thumbId+'" not found\n',h++);void 0==a.min&&(c+='In block "'+e+'", slider min undefined\n',h++);void 0==a.max&&(c+='In block "'+
e+'", slider max undefined\n',h++);a.lowerPartId&&!J.$b(a.lowerPartId)&&(c+='In block "'+e+'", slider lowerPartId "'+a.lowerPartId+'" not found\n',h++);if(a.snap&&(a=a.snap,a instanceof Array))for(var b=0;b<a.length;b++)"string"===typeof a[b]?/^`.+`$/.test(a[b])||(c+='In block "'+e+'", invalid slider snap expression\n',h++):"number"!==typeof a[b]&&(c+='In block "'+e+'", slider snap must be a number or a string\n',h++)});q&&q.forEach(function(a){var b=a.id,f=a.centerId;a=a.thumbId;J.$b(b)?d(b)||(c+=
'In block "'+e+'", rotating id "'+b+'" not displayed\n',h++):(c+='In block "'+e+'", rotating id "'+b+'" not found\n',h++);J.$b(f)||(c+='In block "'+e+'", rotating centerId "'+f+'" not found\n',h++);J.$b(a)?d(a)||(c+='In block "'+e+'", rotating thumbId "'+a+'" not displayed\n',h++):(c+='In block "'+e+'", rotating thumbId "'+a+'" not found\n',h++);J.ff(a,b)||(c+='In block "'+e+'", rotating thumbId "'+a+'" not a descendent of id "'+b+'"\n',h++)});p&&(J.$b(p.id)?d(p.id)||(c+='In block "'+e+'", diffwheelmotion id "'+
p.id+'" not displayed\n',h++):(c+='In block "'+e+'", diffwheelmotion id "'+p.id+'" not found\n',h++));u&&(J.$b(u.id)?d(u.id)||(c+='In block "'+e+'", score id "'+u.id+'" not displayed\n',h++):(c+='In block "'+e+'", score id "'+u.id+'" not found\n',h++),"number"!==typeof u.numHeights||u.numHeights!==Math.round(u.numHeights)||0>=u.numHeights)&&(c+='In block "'+e+'", score numHeights must be a strictly positive integer\n',h++);(r||n||k||q||u||0<t)&&!m&&(c+='In block "'+e+'", missing defaultParameters\n',
h++);m&&(p=0,r&&(p+=r.length),n&&(p+=1),k&&(p+=k.length),q&&(p+=q.length),u&&(p+=2*Math.floor((m.length-p)/2)),p+=t,p!==m.length?(c+='In block "'+e+'", defaultParameters.length='+m.length+", needs "+p+" parameters\n",h++):l&&l.length!=p&&(c+='In block "'+e+'", typicalParameters.length='+l.length+", needs "+p+" parameters\n",h++));return h}var c="",d=0;a.blocks&&a.blocks.forEach(function(a){d+=b(a)});0<d&&(c+=d+" error"+(1<d?"s":"")+"\n");return c||null};function Rb(a){a.b.add("vpl:close",{action:function(a){Bb(a,["vpl"],{ye:!0})},object:a,ba:function(a){return 1<a.za.length&&0<=a.za.indexOf("vpl")}});a.b.add("vpl:about",{action:function(a){a.ae.show()},object:a,ba:function(a){return null!=a.ae}});a.b.add("vpl:help",{action:function(a){a.hf.show()},object:a,ba:function(a){return null!=a.hf}});a.b.add("vpl:readonly",{isEnabled:function(){return!1},object:a,ba:function(a){return a.i.readOnly}});a.b.add("vpl:suspend",{action:function(a){a.dc=!a.dc;a.dc?
a.Dd.show():a.Dd.lc()},Za:function(a){return a.dc},object:a,ba:function(a){return!a.i.Gb&&null!=a.Dd}});a.b.add("vpl:new",{action:function(a){Oa(a.i);a.ie&&Sb(a,a.ie)},isEnabled:function(a){return!a.i.ia&&!a.i.readOnly&&!a.i.Jb()},object:a,ba:function(a){return!a.i.readOnly}});a.b.add("vpl:save",{action:function(a,c){c?(a=Tb(a,a.ea),Ub(a,"vpl-program.html","text/html")):(c=Va(a.i,{ed:!1,gd:!0}),Ub(c,a.i.filename||"vpl.json","application/json"))},isEnabled:function(a){return!a.i.ia&&!a.i.Jb()},object:a,
ba:function(a){return!a.i.readOnly}});a.b.add("vpl:load",{action:function(a){a.Uf.show()},isEnabled:function(a){return!a.i.ia&&!a.i.readOnly},object:a,ba:function(a){return!a.i.readOnly}});a.b.add("vpl:upload",{action:function(a){var b=Va(a.i,{ed:!1,gd:!0});window.vplUpload(a.i.filename,b)},isEnabled:function(a){return!a.i.ia&&!a.i.readOnly&&!a.i.Jb()},object:a,ba:function(a){return null!=window.vplUpload&&!a.i.readOnly}});a.b.add("vpl:exportToHTML",{action:function(a,c){c?(a=Vb(a,a.ea),Ub(a,"vpl-ui.html",
"text/html")):(a=Tb(a,a.ea),Ub(a,"vpl-program.html","text/html"))},isEnabled:function(a){return!a.i.ia&&!a.i.Jb()},object:a});a.b.add("vpl:text",{action:function(a){a.vd?Bb(a,["src"],{yd:!0}):Bb(a,["src"],{td:"vpl"})},isEnabled:function(a){return!a.i.ia},hb:function(a,c){if(c.data instanceof y&&c.data.wb){if(c=Xa(a.i.Bb,c.data))Bb(a,["src"]),a.K.Le(c.qd,c.end)}else c.data instanceof sa&&(c=Xa(a.i.Bb,c.data))&&(Bb(a,["src"]),a.K.Le(c.qd,c.end))},gb:function(a,c){return c.data instanceof y&&null!=c.data.wb||
c.data instanceof sa},object:a,ba:function(a){return a.K&&0>a.za.indexOf("src")}});a.b.add("vpl:text-toggle",{action:function(a){Bb(a,["src"],{toggle:!0})},isEnabled:function(a){return!a.i.ia},Za:function(a){return 0<=a.za.indexOf("src")},object:a});a.b.add("vpl:advanced",{action:function(a){Sa(a.i,"b"===a.i.mode?"a":"b")},isEnabled:function(a){return!a.i.ia&&!a.i.readOnly},Za:function(a){return"a"===a.i.mode},object:a,ba:function(a){return!a.i.readOnly}});a.b.add("vpl:undo",{action:function(a){a.i.xf(function(){Fb(a)})},
isEnabled:function(a){return!a.i.ia&&0<a.i.zc.Ub.length},object:a,ba:function(a){return!a.i.readOnly}});a.b.add("vpl:redo",{action:function(a){a.i.qf(function(){Fb(a)})},isEnabled:function(a){return!a.i.ia&&0<a.i.zc.Mc.length},object:a,ba:function(a){return!a.i.readOnly}});a.b.add("vpl:run",{action:function(a){var b=a.i.Qb(a.i.Bb);a.$a[a.Ma].xb.nc(b,a.i.Bb);a.i.Ac=!0;a.i.mf=!1},isEnabled:function(a){if(a.i.ia||!a.$a[a.Ma].xb.isEnabled(a.i.Bb))return!1;a=a.i.getError();return null==a||a.Eb},Za:function(a){return a.i.Ac},
getState:function(a){if(a.i.Jb())return"empty";if(a.i.Ac)return"running";var b=a.i.getError();return b&&!b.Eb?"error":a.i.mf?"canLoad":"canReload"},hb:function(a,c){c.data instanceof y?c.data.wb?(c=na[a.i.Bb].h(a.i,[c.data]),a.$a[a.Ma].xb.nc(c,a.i.Bb)):a.ja.tb=Wb(a.ja,c):c.data instanceof sa&&(c=na[a.i.Bb].h(a.i,c.data.actions),a.$a[a.Ma].xb.nc(c,a.i.Bb))},gb:function(a,c){if(a=a.$a[a.Ma].xb.isEnabled(a.i.Bb)&&c.data instanceof sa)a:{a=c.data;for(var b=0;b<a.W.length;b++)if("a"===a.W[b].Z.type){a=
!0;break a}for(b=0;b<a.actions.length;b++)if("a"===a.actions[b].Z.type){a=!0;break a}a=!1}return a||c.data instanceof y&&null!=c.data.wb&&"a"===c.data.Z.type},object:a,ba:function(a){return 0<=a.Ma}});a.b.add("vpl:stop",{action:function(a){Lb(a);a.i.Ac=!1},isEnabled:function(a){return Mb(a)},object:a,ba:function(a){return 0<=a.Ma}});a.b.add("vpl:connected",{isEnabled:function(){return!1},Za:function(a){return!a.i.ia&&a.$a[a.Ma].xb.isConnected()},object:a,ba:function(a){return 0<=a.Ma}});a.b.add("vpl:robot",
{action:function(a){a.Ma=(a.Ma+1)%a.$a.length},getState:function(a){return a.$a[a.Ma].name},object:a,ba:function(a){return 1<a.$a.length}});a.b.add("vpl:sim",{action:function(a){a.vd?Bb(a,["sim"],{yd:!0}):Bb(a,["sim"],{td:"vpl"})},isEnabled:function(a){return!a.i.ia},object:a,ba:function(a){return 0<=a.Ma&&null!=a.O&&0>a.za.indexOf("sim")}});a.b.add("vpl:duplicate",{isEnabled:function(a){return!a.i.ia},hb:function(a,c){var b=a.i.i.indexOf(c.data);0<=b&&(a.i.yb(),a.i.i.splice(b+1,0,c.data.Ab()),a.ja.na&&
a.ja.na(),a.log())},gb:function(a,c){return c.data instanceof sa&&!c.data.Jb()},object:a,ba:function(a){return!a.i.readOnly}});a.b.add("vpl:disable",{isEnabled:function(a){return!a.i.ia},hb:function(a,c){c.data instanceof y?(a.i.yb(),c.data.disabled=!c.data.disabled,a.ja.na&&a.ja.na(),a.log()):c.data instanceof sa&&(a.i.yb(),c=c.data,c.disabled=!c.disabled,c.disabled&&(c.error=null),a.ja.na&&a.ja.na(),a.log())},gb:function(a,c){return c.data instanceof sa?!c.data.Jb():c.data instanceof y&&null!==
c.data.wb},object:a,ba:function(a){return!a.i.readOnly}});a.b.add("vpl:lock",{isEnabled:function(a){return!a.i.ia},hb:function(a,c){c.data instanceof y?(a.i.yb(),c.data.locked=!c.data.locked,a.ja.na&&a.ja.na(),a.log()):c.data instanceof sa&&(a.i.yb(),c.data.locked=!c.data.locked,a.ja.na&&a.ja.na(),a.log())},gb:function(a,c){return c.data instanceof sa?!c.data.Jb():c.data instanceof y&&null!==c.data.wb},object:a,ba:function(a){return a.i.Sf&&a.i.Gb&&!a.i.readOnly}});a.b.add("vpl:trashcan",{isEnabled:function(a){return!a.i.ia},
hb:function(a,c){c.data instanceof y?null!==c.data.wb&&(a.i.yb(),wa(c.data.wb,c.data.Vd),a.ja.na&&a.ja.na(),a.log()):c.data instanceof sa&&(c=a.i.i.indexOf(c.data),0<=c&&(a.i.yb(),a.i.i.splice(c,1),a.ja.na&&a.ja.na(),a.log()))},gb:function(a,c){return c.data instanceof y?null!==c.data.wb&&!c.data.locked:c.data instanceof sa&&(!c.data.Jb()||a.i.i.indexOf(c.data)+1<a.i.i.length)&&!c.data.locked},object:a,ba:function(a){return!a.i.readOnly}});a.b.add("vpl:message-error",{isEnabled:function(){return!1},
getState:function(a){return a.Vb},object:a,ba:function(a){return a.Vb&&!a.Ed}});a.b.add("vpl:message-warning",{isEnabled:function(){return!1},getState:function(a){return a.Vb},object:a,ba:function(a){return a.Vb&&a.Ed}});a.b.add("vpl:message-empty",{isEnabled:function(){return!1},object:a,ba:function(a){return!a.Vb}});a.b.add("vpl:filename",{isEnabled:function(){return!1},getState:function(a){return(a.i.filename||"")+(a.username?"\n"+a.username:"")},object:a,ba:function(a){return a.i.filename||a.username?
!0:!1}});a.b.add("vpl:teacher",{action:function(a){a.i.Ba.Ua=!a.i.Ba.Ua},isEnabled:function(a){return!a.i.ia&&!a.i.readOnly},Za:function(a){return a.i.Ba.Ua},object:a,xc:!0,ba:function(a){return a.i.Gb&&!a.i.readOnly}});a.b.add("vpl:teacher-reset",{action:function(a,c){c?(Ma(a.i.mode),a.i.jc=Fa,a.i.ic=Ha):(Ia(),Oa(a.i),a.i.Wd())},isEnabled:function(a){return!a.i.ia},object:a,xc:!0,ba:function(a){return a.i.Gb&&a.i.Ba.Ua&&!a.i.readOnly}});a.b.add("vpl:teacher-save",{action:function(a){a=Va(a.i,{ed:!0,
gd:!1});Ub(a,"gui-config.json","application/json")},isEnabled:function(a){return!a.i.ia},object:a,xc:!0,ba:function(a){return a.i.Gb&&a.i.Ba.Ua&&!a.i.readOnly}});a.b.add("vpl:teacher-setasnew",{action:function(a){var b=Va(a.i,{ed:!1,gd:!0});a.ie=a.ie===b?null:b},Za:function(a){return a.ie===Va(a.i,{ed:!1,gd:!0})},object:a,xc:!0,ba:function(a){return a.i.Gb&&a.i.Ba.Ua&&!a.i.readOnly}})};function Xb(a){this.h=a;this.controls=[];this.b="";this.y=this.x=0}function Yb(a,b,c,d,e,f,g){a.controls.push({J:b,action:d||null,hb:e||null,gb:f||null,id:g||"",rc:c,x:0,y:0});a.b+="X"}
function Zb(a,b,c,d){a.x=b.x;a.y=b.y;for(var e=a.b.replace(/^[s ]+/,"").replace(/[s ]+$/,"").replace(/ +/g," ").replace(/s +/g,"s").replace(/ +s/g,"s").replace(/s+/g,"s"),f=0,g=0,h=0,m=0,l=0;l<e.length;l++)switch(e[l]){case "X":f+=E(c[a.controls[m].id]);m++;break;case " ":case "_":g++;break;case "s":case "S":h++}d=d?E(d):0;var r=0;if(f>=b.width)d=0;else for(;;){r=(b.width-(f+d*g))/h;if(r>=d||!(0<d))break;d/=2}m=0;f=b.x;for(l=0;l<e.length;l++)switch(e[l]){case "X":g=a.controls[m];g.x=f+c[g.id].offsetLeft();
f+=E(c[g.id]);g.y=b.y+c[g.id].offsetTop();m++;break;case " ":case "_":f+=d;break;case "s":case "S":f+=r}}function $b(a,b,c){ac(a.h,function(c){bc(b,c,a.x,a.y)});a.controls.forEach(function(a){cc(this.h,a.x,a.y,c[a.id],function(b,c,d){var e=Math.min(c.width/(a.rc.oa-a.rc.Y),c.height/(a.rc.ma-a.rc.aa));b.save();b.translate(-a.rc.Y,-a.rc.aa);b.scale(e,e);a.J(b,c,d);b.restore()},a.action,a.hb,a.gb,a.id)},a)};function dc(a,b,c,d,e,f,g,h,m){function l(a,d,e){b.save();e&&(b.scale(-1,1),b.translate(-2*a-c.g,0));b.fillStyle=h&&f?k.xa:k.sa;b.fillRect(a,d,c.g,c.g);b.fillStyle=f?k.T:k.ha;b.beginPath();b.moveTo(a+.1*c.g,d+.6*c.g);b.lineTo(a+.4*c.g,d+.6*c.g);b.lineTo(a+.25*c.g,d+.34*c.g);b.closePath();b.fill();b.beginPath();b.arc(a+.5*c.g,d+.83*c.g,.4*c.g,4.2,5.6);b.strokeStyle=b.fillStyle;b.lineWidth=.08*c.g;b.stroke();b.restore()}function r(a,d,e){b.save();b.fillStyle=h?k.xa:k.sa;b.fillRect(a,d,q.width,q.height);
b.translate(a+q.width/2,d+q.width/2);b.rotate(-e*Math.PI/2);b.translate(-a-q.width/2,-d-q.width/2);b.beginPath();b.moveTo(a+.3557*q.width,d+.25*q.width);b.lineTo(a+.3557*q.width,d+.75*q.width);b.lineTo(a+.7887*q.width,d+.5*q.width);b.closePath();b.strokeStyle=k.T;b.lineWidth=c.ya;b.stroke();b.restore()}function n(){b.beginPath();b.moveTo(0,.5*c.g);b.lineTo(.5*c.g,.5*c.g);b.lineTo(.5*c.g,-.25*c.g);b.bezierCurveTo(.3*c.g,-.5*c.g,.02*c.g,-.5*c.g,0,-.5*c.g);b.lineTo(0,-.5*c.g);b.bezierCurveTo(-.02*c.g,
-.5*c.g,-.3*c.g,-.5*c.g,-.5*c.g,-.25*c.g);b.lineTo(-.5*c.g,.5*c.g);b.closePath();b.fillStyle=f?k.T:k.ha;b.fill()}var k={sa:"navy",xa:"#37f",Gc:"#06f",T:"white",ha:"#777",Jc:"#44a",af:"#ddf",Sd:"#99a",ce:"#a00",Se:"#d10",de:"#d00",Te:"#f50",sd:"#c66",bf:"#800"};k={sa:"white",xa:"#ddd",Gc:"white",T:"#333",ha:"#999",Jc:"#ddd",af:"#555",Sd:"#666",ce:"#fcc",Se:"#fcc",de:"#faa",Te:"#faa",sd:"#866",bf:"#faa"};var q=F(d,{tag:"button",da:e,id:a.replace(/:/g,"-")});d={"vpl:close":function(){b.fillStyle=h&&
f?k.xa:k.sa;b.fillRect(0,0,.5*c.g,c.g);b.beginPath();b.moveTo(.1*c.g,.1*c.g);b.lineTo(.4*c.g,.4*c.g);b.moveTo(.1*c.g,.4*c.g);b.lineTo(.4*c.g,.1*c.g);b.strokeStyle=f?k.T:k.ha;b.lineWidth=c.ya;b.stroke()},"vpl:about":function(){b.fillStyle=h&&f?k.xa:k.sa;b.fillRect(0,0,c.g,c.g);b.textAlign="center";b.textBaseline="middle";b.font="bold "+Math.round(.7*c.g).toString(10)+"px times";b.fillStyle=f?k.T:k.ha;b.fillText("i",.5*c.g,.5*c.g)},"vpl:help":function(){b.fillStyle=h&&f?k.xa:k.sa;b.fillRect(0,0,c.g,
c.g);b.textAlign="center";b.textBaseline="middle";b.font="bold "+Math.round(.7*c.g).toString(10)+"px times";b.fillStyle=f?k.T:k.ha;b.fillText("?",.5*c.g,.5*c.g)},"vpl:readonly":function(){var a=c.g;b.save();b.fillStyle=k.Sd;b.strokeStyle=k.Sd;b.lineWidth=c.ya;b.translate(.5*a,.7*a);b.save();b.rotate(.6);b.beginPath();b.moveTo(-.015/.22*a,.07*a);b.lineTo(0,.22*a);b.lineTo(.015/.22*a,.07*a);b.fill();b.beginPath();b.moveTo(-.1*a,-.4*a);b.lineTo(-.1*a,0);b.lineTo(0,.22*a);b.lineTo(.1*a,0);b.lineTo(.1*
a,-.4*a);b.restore();b.moveTo(-.2*a,-.4*a);b.lineTo(.4*a,.2*a);b.stroke();b.restore()},"vpl:new":function(){b.fillStyle=h&&f?k.xa:k.sa;b.fillRect(0,0,c.g,c.g);b.beginPath();b.moveTo(.25*c.g,.2*c.g);b.lineTo(.25*c.g,.8*c.g);b.lineTo(.75*c.g,.8*c.g);b.lineTo(.75*c.g,.3*c.g);b.lineTo(.65*c.g,.2*c.g);b.closePath();b.moveTo(.65*c.g,.2*c.g);b.lineTo(.65*c.g,.3*c.g);b.lineTo(.75*c.g,.3*c.g);b.strokeStyle=f?k.T:k.ha;b.lineWidth=c.ya;b.stroke()},"vpl:save":function(){b.fillStyle=h&&f?k.xa:k.sa;b.fillRect(0,
0,c.g,c.g);b.beginPath();b.moveTo(.25*c.g,.2*c.g);b.lineTo(.25*c.g,.7*c.g);b.lineTo(.67*c.g,.7*c.g);b.lineTo(.67*c.g,.27*c.g);b.lineTo(.6*c.g,.2*c.g);b.closePath();b.moveTo(.6*c.g,.2*c.g);b.lineTo(.6*c.g,.27*c.g);b.lineTo(.67*c.g,.27*c.g);b.strokeStyle=f?k.T:k.ha;b.lineWidth=c.ya;b.stroke();b.lineWidth=2*c.ya;b.beginPath();b.moveTo(.8*c.g,.5*c.g);b.lineTo(.8*c.g,.8*c.g);b.moveTo(.7*c.g,.7*c.g);b.lineTo(.8*c.g,.8*c.g);b.lineTo(.9*c.g,.7*c.g);b.stroke()},"vpl:exportToHTML":function(){b.fillStyle=h&&
f?k.xa:k.sa;b.fillRect(0,0,c.g,c.g);b.strokeStyle=f?k.T:k.ha;b.lineWidth=2*c.ya;b.beginPath();b.moveTo(.8*c.g,.2*c.g);b.lineTo(.8*c.g,.5*c.g);b.moveTo(.7*c.g,.4*c.g);b.lineTo(.8*c.g,.5*c.g);b.lineTo(.9*c.g,.4*c.g);b.textAlign="center";b.textBaseline="middle";b.font="bold "+Math.round(.3*c.g).toString(10)+"px sans-serif";b.fillStyle=f?k.T:k.ha;b.fillText("HTML",.5*c.g,.7*c.g);b.stroke()},"vpl:load":function(){b.fillStyle=h&&f?k.xa:k.sa;b.fillRect(0,0,c.g,c.g);b.beginPath();b.moveTo(.25*c.g,.2*c.g);
b.lineTo(.25*c.g,.7*c.g);b.lineTo(.67*c.g,.7*c.g);b.lineTo(.67*c.g,.27*c.g);b.lineTo(.6*c.g,.2*c.g);b.closePath();b.moveTo(.6*c.g,.2*c.g);b.lineTo(.6*c.g,.27*c.g);b.lineTo(.67*c.g,.27*c.g);b.strokeStyle=f?k.T:k.ha;b.lineWidth=c.ya;b.stroke();b.lineWidth=2*c.ya;b.beginPath();b.moveTo(.8*c.g,.55*c.g);b.lineTo(.8*c.g,.85*c.g);b.moveTo(.7*c.g,.65*c.g);b.lineTo(.8*c.g,.55*c.g);b.lineTo(.9*c.g,.65*c.g);b.stroke()},"vpl:upload":function(){b.fillStyle=h&&f?k.xa:k.sa;b.fillRect(0,0,c.g,c.g);b.beginPath();
b.moveTo(.25*c.g,.3*c.g);b.lineTo(.25*c.g,.8*c.g);b.lineTo(.67*c.g,.8*c.g);b.lineTo(.67*c.g,.37*c.g);b.lineTo(.6*c.g,.3*c.g);b.closePath();b.moveTo(.6*c.g,.3*c.g);b.lineTo(.6*c.g,.37*c.g);b.lineTo(.67*c.g,.37*c.g);b.strokeStyle=f?k.T:k.ha;b.lineWidth=c.ya;b.stroke();b.lineWidth=2*c.ya;b.beginPath();b.moveTo(.8*c.g,.5*c.g);b.lineTo(.8*c.g,.2*c.g);b.moveTo(.7*c.g,.3*c.g);b.lineTo(.8*c.g,.2*c.g);b.lineTo(.9*c.g,.3*c.g);b.stroke()},"vpl:text":function(){b.fillStyle=h&&f?k.xa:k.sa;b.fillRect(0,0,c.g,c.g);
b.beginPath();b.moveTo(.25*c.g,.2*c.g);b.lineTo(.25*c.g,.8*c.g);b.lineTo(.75*c.g,.8*c.g);b.lineTo(.75*c.g,.3*c.g);b.lineTo(.65*c.g,.2*c.g);b.closePath();b.moveTo(.65*c.g,.2*c.g);b.lineTo(.65*c.g,.3*c.g);b.lineTo(.75*c.g,.3*c.g);for(var a=.2;.6>a;a+=.1)b.moveTo(.3*c.g,c.g*(.2+a)),b.lineTo(.7*c.g,c.g*(.2+a));b.strokeStyle=f?k.T:k.ha;b.lineWidth=c.ya;b.stroke()},"vpl:text-toggle":function(){b.fillStyle=h&&f?k.xa:k.sa;b.fillRect(0,0,c.g,c.g);b.beginPath();b.moveTo(.28*c.g,.2*c.g);b.lineTo(.28*c.g,.7*
c.g);b.lineTo(.7*c.g,.7*c.g);b.lineTo(.7*c.g,.27*c.g);b.lineTo(.63*c.g,.2*c.g);b.closePath();b.moveTo(.63*c.g,.2*c.g);b.lineTo(.63*c.g,.27*c.g);b.lineTo(.7*c.g,.27*c.g);for(var a=.1;.5>a;a+=.1)b.moveTo(.33*c.g,c.g*(.2+a)),b.lineTo(.63*c.g,c.g*(.2+a));b.strokeStyle=f?k.T:k.ha;b.lineWidth=c.ya;b.stroke();b.fillStyle=f?g||h?k.T:k.Jc:k.ha;b.fillRect(.1*c.g,.8*c.g,.8*c.g,.1*c.g)},"vpl:advanced":function(){b.fillStyle=h&&f?k.xa:g?k.Gc:k.sa;b.fillRect(0,0,c.g,c.g);b.fillStyle=f?k.T:k.ha;for(var a=0;4>a;a++)for(var d=
0;5>d;d++)b.fillRect(.1*c.g*(1+a)+(2>a?0:.43*c.g),.1*c.g*(2+d),.07*c.g,.07*c.g);b.fillStyle=f?g||h?k.T:k.Jc:k.ha;b.fillRect(.1*c.g,.8*c.g,.8*c.g,.1*c.g)},"vpl:undo":function(){l(0,0,!1)},"vpl:redo":function(){l(0,0,!0)},"vpl:run":function(){b.fillStyle=h&&f?k.xa:k.sa;b.fillRect(0,0,c.g,c.g);b.beginPath();b.moveTo(.3*c.g,.25*c.g);b.lineTo(.3*c.g,.75*c.g);b.lineTo(.8*c.g,.5*c.g);b.closePath();b.fillStyle=f?k.T:k.ha;b.fill();b.fillStyle=f?g||h?k.T:k.Jc:k.ha;b.fillRect(.1*c.g,.8*c.g,.8*c.g,.1*c.g)},"vpl:stop":function(){b.fillStyle=
h&&f?k.xa:k.sa;b.fillRect(0,0,c.g,c.g);b.fillStyle=f?k.T:k.ha;b.fillRect(.28*c.g,.28*c.g,.44*c.g,.44*c.g)},"vpl:connected":function(){b.fillStyle=f?k.xa:k.sa;b.fillRect(0,0,c.g,c.g);b.textAlign="center";b.textBaseline="middle";b.font="bold "+Math.round(.7*c.g).toString(10)+"px sans-serif";b.fillStyle=f?k.T:k.ha;b.fillText("C",.5*c.g,.5*c.g)},"vpl:robot":function(){b.fillStyle=h?k.xa:k.sa;b.fillRect(0,0,c.g,c.g);switch(m){case "thymio":b.save();b.translate(c.g/2,.35*c.g);b.scale(.3,.3);b.rotate(.2);
n();b.restore();break;case "thymio-tdm":b.save();b.translate(c.g/2,.35*c.g);b.scale(.3,.3);b.rotate(.2);n();b.restore();b.fillStyle=k.T;b.fillRect(.4*c.g,.65*c.g,.2*c.g,.2*c.g);break;case "sim":b.save(),b.translate(c.g/2,.35*c.g),b.scale(.3,.3),b.rotate(.2),n(),b.beginPath(),b.strokeStyle=k.T,b.lineWidth=c.ya/.3,b.strokeRect(-c.g,-.8*c.g,2*c.g,1.6*c.g),b.restore()}b.beginPath();b.moveTo(.2*c.g,.75*c.g);b.lineTo(.5*c.g,.75*c.g);b.lineTo(.5*c.g,c.g*("sim"===m?.6:.3));b.strokeStyle=k.T;b.lineWidth=c.ya;
b.stroke()},"vpl:sim":function(){b.fillStyle=h&&f?k.xa:k.sa;b.fillRect(0,0,c.g,c.g);b.save();b.translate(c.g/2,.35*c.g);b.scale(.4,.4);b.rotate(.2);n();b.beginPath();b.arc(c.g,.5*c.g,1.4*c.g,-3.2,-3.8,!0);b.strokeStyle=h&&f?k.af:k.Sd;b.lineWidth=.2*c.g;b.stroke();b.beginPath();b.arc(c.g,.5*c.g,.6*c.g,-3.3,-3.8,!0);b.stroke();b.restore()},"vpl:message-empty":function(){},"vpl:message-error":function(){m&&(b.fillStyle=q.color,b.font=ec(q),b.textAlign="center",b.textBaseline="middle",b.fillText(m,q.width/
2,q.height/2))},"vpl:filename":function(){if(m){b.beginPath();b.rect(0,0,3*c.g,c.g);b.clip();b.fillStyle=q.color;b.font=ec(q);b.textAlign="center";b.textBaseline="middle";var a=m.trim();0<=a.indexOf("\n")?(a=a.split("\n"),b.fillText(a[0],q.width/2,.25*q.height),b.fillText(a[1],q.width/2,.75*q.height)):b.fillText(a,q.width/2,q.height/2)}},"vpl:duplicate":function(){b.fillStyle=h&&f?k.xa:k.sa;b.fillRect(0,0,c.g,c.g);b.strokeStyle=f?k.T:k.ha;b.lineWidth=c.ya;b.strokeRect(.3*c.g,.3*c.g,.4*c.g,.15*c.g);
b.strokeRect(.3*c.g,.55*c.g,.4*c.g,.15*c.g)},"vpl:disable":function(){b.fillStyle=h&&f?k.xa:k.sa;b.fillRect(0,0,c.g,c.g);b.strokeStyle=f?k.T:k.ha;b.lineWidth=c.ya;b.strokeRect(.3*c.g,.3*c.g,.4*c.g,.4*c.g);b.beginPath();b.moveTo(.2*c.g,.6*c.g);b.lineTo(.8*c.g,.4*c.g);b.stroke()},"vpl:lock":function(){b.fillStyle=h&&f?k.xa:k.sa;b.fillRect(0,0,c.g,c.g);b.strokeStyle=f?k.T:k.ha;b.fillStyle=f?k.T:k.ha;b.lineWidth=c.ya;b.strokeRect(.3*c.g,.3*c.g,.4*c.g,.4*c.g);fc(b,.5*c.g,.52*c.g,.04*c.g,k.T)},"vpl:trashcan":function(){b.fillStyle=
h&&f?k.xa:k.sa;b.fillRect(0,0,c.g,c.g);b.beginPath();b.moveTo(.25*c.g,.2*c.g);b.lineTo(.32*c.g,.8*c.g);b.lineTo(.68*c.g,.8*c.g);b.lineTo(.75*c.g,.2*c.g);b.closePath();b.strokeStyle=f?k.T:k.ha;b.lineWidth=c.ya;b.stroke()},"vpl:teacher-reset":function(){b.fillStyle=h&&f?k.de:k.ce;b.fillRect(0,0,c.g,c.g);b.beginPath();b.moveTo(.25*c.g,.2*c.g);b.lineTo(.25*c.g,.8*c.g);b.lineTo(.75*c.g,.8*c.g);b.lineTo(.75*c.g,.3*c.g);b.lineTo(.65*c.g,.2*c.g);b.closePath();b.moveTo(.65*c.g,.2*c.g);b.lineTo(.65*c.g,.3*
c.g);b.lineTo(.75*c.g,.3*c.g);b.strokeStyle=f?k.T:k.sd;b.lineWidth=c.ya;b.stroke();b.fillStyle=f?k.T:k.sd;gc(b,.63*c.g,.7*c.g,.2*c.g)},"vpl:teacher-save":function(){b.fillStyle=h&&f?k.de:k.ce;b.fillRect(0,0,c.g,c.g);b.strokeStyle=f?k.T:k.sd;b.beginPath();b.moveTo(.25*c.g,.2*c.g);b.lineTo(.25*c.g,.7*c.g);b.lineTo(.67*c.g,.7*c.g);b.lineTo(.67*c.g,.27*c.g);b.lineTo(.6*c.g,.2*c.g);b.closePath();b.moveTo(.6*c.g,.2*c.g);b.lineTo(.6*c.g,.27*c.g);b.lineTo(.67*c.g,.27*c.g);b.lineWidth=c.ya;b.stroke();b.lineWidth=
2*c.ya;b.beginPath();b.moveTo(.8*c.g,.5*c.g);b.lineTo(.8*c.g,.8*c.g);b.moveTo(.7*c.g,.7*c.g);b.lineTo(.8*c.g,.8*c.g);b.lineTo(.9*c.g,.7*c.g);b.stroke();b.fillStyle=f?k.T:k.sd;gc(b,.46*c.g,.45*c.g,.2*c.g)},"vpl:teacher-setasnew":function(){b.fillStyle=h&&f?g?k.Te:k.de:g&&f?k.Se:k.ce;b.fillRect(0,0,c.g,c.g);b.strokeStyle=f?k.T:k.sd;b.beginPath();b.moveTo(.25*c.g,.2*c.g);b.lineTo(.25*c.g,.7*c.g);b.lineTo(.67*c.g,.7*c.g);b.lineTo(.67*c.g,.27*c.g);b.lineTo(.6*c.g,.2*c.g);b.closePath();b.moveTo(.6*c.g,
.2*c.g);b.lineTo(.6*c.g,.27*c.g);b.lineTo(.67*c.g,.27*c.g);b.lineWidth=c.ya;b.stroke();b.lineWidth=2*c.ya;b.beginPath();b.moveTo(.8*c.g,.5*c.g);b.lineTo(.5*c.g,.5*c.g);b.moveTo(.6*c.g,.4*c.g);b.lineTo(.5*c.g,.5*c.g);b.lineTo(.6*c.g,.6*c.g);b.stroke();b.fillStyle=f?g||h?k.T:k.bf:k.ha;b.fillRect(.1*c.g,.8*c.g,.8*c.g,.1*c.g)},"vpl:teacher":function(){b.fillStyle=h&&f?g?k.Te:k.de:g&&f?k.Se:k.ce;b.fillRect(0,0,c.g,c.g);b.fillStyle=f?k.T:k.sd;gc(b,.5*c.g,.4*c.g,.27*c.g);b.fillStyle=f?g||h?k.T:k.bf:k.ha;
b.fillRect(.1*c.g,.8*c.g,.8*c.g,.1*c.g)},"src:vpl":function(){b.save();b.fillStyle=h&&f?k.xa:k.sa;b.fillRect(0,0,c.g,c.g);b.beginPath();b.moveTo(.25*c.g,.2*c.g);b.lineTo(.25*c.g,.8*c.g);b.lineTo(.75*c.g,.8*c.g);b.lineTo(.75*c.g,.3*c.g);b.lineTo(.65*c.g,.2*c.g);b.closePath();b.moveTo(.65*c.g,.2*c.g);b.lineTo(.65*c.g,.3*c.g);b.lineTo(.75*c.g,.3*c.g);b.strokeStyle=f?k.T:k.ha;b.lineWidth=c.ya;b.stroke();b.fillStyle=h&&f?k.T:k.Sd;for(var a=.15;.6>a;a+=.15)b.fillRect(.3*c.g,c.g*(.2+a),.4*c.g,.1*c.g);b.restore()},
"src:locked":function(){b.save();b.fillStyle=f?h?k.xa:g?k.Gc:k.sa:k.sa;b.fillRect(0,0,c.g,c.g);b.strokeStyle=f?k.T:k.ha;b.lineWidth=c.ya;b.fillStyle=f?g?k.af:k.Sd:k.ha;for(var a=.15;.6>a;a+=.15)b.fillRect(.15*c.g,c.g*a,.4*c.g,.1*c.g);fc(b,.77*c.g,.36*c.g,.06*c.g,f?k.T:k.ha,!g);b.fillStyle=f?g||h?k.T:k.Jc:k.ha;b.fillRect(.1*c.g,.8*c.g,.8*c.g,.1*c.g);b.restore()},"src:language":function(){var a=c.g;b.save();b.fillStyle=f?h?k.xa:k.sa:k.sa;b.fillRect(0,0,a,a);b.beginPath();for(var d=0;3>d;d++)b.moveTo(.2*
a,a*(.2+.1*d)),b.lineTo(.5*a,a*(.2+.1*d));b.strokeStyle=f?k.T:k.ha;b.lineWidth=c.ya;b.stroke();for(d=0;3>d;d++){var e=2*(d+.25)/3*Math.PI;hc(b,.75*a,.3*a,.15*a,e-.3*Math.PI,e+.3*Math.PI,{od:!1,Fc:3*c.ya,style:f?k.T:k.ha})}b.textAlign="center";b.textBaseline="middle";b.font="bold "+Math.round(a/3).toString(10)+"px sans-serif";b.fillStyle=f?k.T:k.ha;b.fillText({aseba:"Aa",l2:"l2",js:"js",python:"py"}[m],.5*a,.7*a);b.restore()},"src:disass":function(){var a=c.g;b.save();b.fillStyle=f&&h?k.xa:g?k.Gc:
k.sa;b.fillRect(0,0,a,a);b.beginPath();b.moveTo(.2*a,.2*a);b.lineTo(.3*a,.2*a);for(var d=0;5>d;d++)b.moveTo(.4*a,a*(.2+.1*d)),b.lineTo(.45*a,a*(.2+.1*d)),b.moveTo(.55*a,a*(.2+.1*d)),b.lineTo(.65*a,a*(.2+.1*d));b.strokeStyle=f?k.T:k.ha;b.lineWidth=c.ya;b.stroke();b.fillStyle=f&&(g||h)?k.T:k.Jc;b.fillRect(.1*c.g,.8*c.g,.8*c.g,.1*c.g);b.restore()},"sim:restart":function(){b.save();b.fillStyle=h?k.xa:k.sa;b.fillRect(0,0,q.width,q.height);var a=c.g;b.lineWidth=.08*a;hc(b,.5*a,.5*a,.28*a,.1,-.1,{od:!1,
Fc:.2*a,style:k.T});b.restore()},"sim:pause":function(){b.save();b.fillStyle=h?k.xa:g?k.Gc:k.sa;b.fillRect(0,0,c.g,c.g);b.fillStyle=f?k.T:k.ha;b.fillRect(.28*c.g,.28*c.g,.15*c.g,.44*c.g);g?(b.beginPath(),b.moveTo(.54*c.g,.28*c.g),b.lineTo(.62*c.g,.28*c.g),b.lineTo(.75*c.g,.5*c.g),b.lineTo(.62*c.g,.72*c.g),b.lineTo(.54*c.g,.72*c.g),b.fill()):b.fillRect(.57*c.g,.28*c.g,.15*c.g,.44*c.g);b.restore()},"sim:speedup":function(){b.save();b.fillStyle=h&&f?k.xa:g?k.Gc:k.sa;b.fillRect(0,0,c.g,c.g);b.fillStyle=
f?k.T:k.ha;b.beginPath();for(var a=0;2>a;a++)b.moveTo(c.g*(.3+.22*a),.25*c.g/2),b.lineTo(c.g*(.3+.22*a),.75*c.g/2),b.lineTo(c.g*(.5+.22*a),.5*c.g/2),b.closePath();b.fill();b.textAlign="center";b.textBaseline="middle";b.font="bold "+Math.round(c.g/3).toString(10)+"px sans-serif";b.fillText(1<=m?"\u00d7"+m.toString(10):"\u00f7"+Math.round(1/m).toString(10),.5*c.g,.7*c.g);b.restore()},"sim:noise":function(){b.save();b.fillStyle=h&&f?k.xa:g?k.Gc:k.sa;b.fillRect(0,0,c.g,c.g);b.beginPath();var a=[.58,1.48,
.96,.39,1.36,.09,-.75,-1.58,-.32,-1.36,-1.39,-.94,-1.1,-1.04,-.1,.93,1.22,.6,.89,.61];b.moveTo(.1*c.g,(.4+.1*a[0])*c.g);for(var d=1;d<a.length;d++)b.lineTo((.1+.8/(a.length-1)*d)*c.g,(.4+.1*a[d])*c.g);b.strokeStyle=f?k.T:k.ha;b.lineWidth=c.ya;b.stroke();b.fillStyle=f?g||h?k.T:k.Jc:k.ha;b.fillRect(.1*c.g,.8*c.g,.8*c.g,.1*c.g);b.restore()},"sim:pen":function(){var a=c.g;b.save();b.fillStyle=h&&f?k.xa:g?k.Gc:k.sa;b.fillRect(0,0,a,a);b.fillStyle=f?g||h?k.T:k.Jc:k.ha;b.fillRect(.1*a,.8*a,.8*a,.1*a);b.translate(.5*
a,a*(.4+(g?.13:0)));b.beginPath();b.moveTo(-.015/.22*a,.07*a);b.lineTo(0,.22*a);b.lineTo(.015/.22*a,.07*a);b.fillStyle=f?k.T:k.ha;b.fill();b.beginPath();b.moveTo(-.1*a,-.22*a);b.lineTo(-.1*a,0);b.lineTo(0,.22*a);b.lineTo(.1*a,0);b.lineTo(.1*a,-.22*a);b.strokeStyle=f?k.T:k.ha;b.lineWidth=c.ya;b.stroke();b.restore()},"sim:clear":function(){var a=c.g;b.save();b.fillStyle=h&&f?k.xa:k.sa;b.fillRect(0,0,a,a);b.strokeStyle=f?k.T:k.ha;b.lineWidth=c.ya;b.strokeRect(.15*a,.25*a,.7*a,.5*a);b.translate(.5*a,
.4*a);b.rotate(.4);b.fillStyle=f?k.T:k.ha;b.fillRect(0,0,.3*a,.2*a);b.restore()},"sim:map-kind":function(){var a=c.g,d=c.ya;b.save();b.fillStyle=h&&f?k.xa:k.sa;b.fillRect(0,0,c.g,c.g);b.lineWidth=d;b.strokeStyle=f?k.T:k.ha;b.fillStyle=f?k.T:k.ha;for(var e=["ground","height","obstacles"].indexOf(m),g=0;3>g;g++){var l=2*(g+.25)/3*Math.PI;g===e?b.fillRect(a*(.35+.25*Math.cos(l)),a*(.39+.25*Math.sin(l)),.3*a,.22*a):b.strokeRect(a*(.35+.25*Math.cos(l)),a*(.39+.25*Math.sin(l)),.3*a,.22*a);hc(b,.5*a,.5*
a,.36*a,l-.42*Math.PI,l-.22*Math.PI,{od:!1,Fc:3*d,style:k.T})}b.restore()},"sim:map":function(){var a=c.g;b.save();b.fillStyle=h&&f?k.xa:g?k.Gc:k.sa;b.fillRect(0,0,c.g,c.g);b.fillStyle=f?g||h?k.T:k.Jc:k.ha;b.fillRect(.1*a,.8*a,.8*a,.1*a);b.lineWidth=c.ya;b.strokeStyle=f?k.T:k.ha;b.strokeRect(.15*a,.15*a,.7*a,.5*a);switch(m){case "ground":b.lineWidth=.08*a;b.beginPath();b.arc(.6*a,.4*a,.15*a,-.5*Math.PI,.5*Math.PI);b.lineTo(.4*a,.55*a);b.arc(.4*a,.4*a,.15*a,.5*Math.PI,1.5*Math.PI);b.closePath();b.stroke();
break;case "height":for(var d=0;.75>=d;d+=.25)for(var e=0;1>=e;e+=.1){var l=a*(.2+.5*e+.15*d),n=a*(.5-.3*d-.2*(.2*Math.cos(5*e+2*d-3)-(d-.9)*(d-.9)/3));0===e?b.moveTo(l,n):b.lineTo(l,n)}b.stroke();break;case "obstacles":b.strokeRect(.2*a,.2*a,.6*a,.4*a),b.beginPath(),b.moveTo(.4*a,.2*a),b.lineTo(.4*a,.43*a),b.moveTo(.6*a,.6*a),b.lineTo(.6*a,.37*a),b.stroke()}b.restore()},"sim-event:forward":function(){r(0,0,1)},"sim-event:backward":function(){r(0,0,3)},"sim-event:left":function(){r(0,0,2)},"sim-event:right":function(){r(0,
0,0)},"sim-event:center":function(){b.save();b.fillStyle=h?k.xa:k.sa;b.fillRect(0,0,q.width,q.height);b.beginPath();b.arc(.5*q.width,.5*q.width,.25*q.width,0,2*Math.PI);b.strokeStyle=k.T;b.lineWidth=c.ya;b.stroke();b.restore()},"sim-event:clap":function(){b.save();b.fillStyle=h?k.xa:k.sa;b.fillRect(0,0,q.width,q.height);b.beginPath();b.strokeStyle=k.T;b.lineWidth=c.ya;b.translate(.5*q.width,.5*q.width);b.rotate(.1);for(var a=0;9>a;a++)b.beginPath(),b.moveTo(.12*q.width,0),b.lineTo(.24*q.width,0),
b.moveTo(.28*q.width,0),b.lineTo(.36*q.width,0),b.stroke(),b.rotate(Math.PI/4.5);b.restore()},"sim-event:tap":function(){b.save();b.fillStyle=h?k.xa:k.sa;b.fillRect(0,0,q.width,q.height);b.beginPath();b.strokeStyle=k.T;b.lineWidth=c.ya;b.translate(.6*q.width,.6*q.width);for(var a=1;3>=a;a++)b.beginPath(),b.arc(0,0,.15*q.width*a,.9*Math.PI,1.7*Math.PI),b.stroke();b.moveTo(.3*q.width,0);b.lineTo(0,0);b.lineTo(0,.3*q.width);b.stroke();b.restore()}};d["vpl:message-warning"]=d["vpl:message-error"];d["src:close"]=
d["vpl:close"];d["src:new"]=d["vpl:new"];d["src:save"]=d["vpl:save"];d["src:load"]=d["vpl:load"];d["src:run"]=d["vpl:run"];d["src:stop"]=d["vpl:stop"];d["src:connected"]=d["vpl:connected"];d["src:sim"]=d["vpl:sim"];d["src:teacher"]=d["vpl:teacher"];d["src:teacher-reset"]=d["vpl:teacher-reset"];d["sim:close"]=d["vpl:close"];d["sim:vpl"]=d["src:vpl"];d["sim:text"]=d["vpl:text"];d["sim:teacher"]=d["vpl:teacher"];d["sim:teacher-reset"]=d["vpl:teacher-reset"];(a=d[a])&&a()}
function ic(a,b){switch(a){case "vpl:close":case "src:close":case "sim:close":return{Y:0,oa:b.g/2,aa:0,ma:b.g};case "vpl:message-error":case "vpl:message-warning":case "vpl:message-empty":return{Y:0,oa:5*b.g,aa:0,ma:b.g};case "vpl:filename":return{Y:0,oa:3*b.g,aa:0,ma:b.g}}return{Y:0,oa:b.g,aa:0,ma:b.g}};function jc(a,b,c,d,e,f){var g=0<=b.Ba.b.indexOf(c);if((b.m?b.m.ba:b.b.ba(c))&&(b.Ba.Ua||!g)){var h=a.h,m=b.b.find(c).xc;Yb(a,function(a,f,m){b.m?e(c,a,h.A,h.ea,d,b.m.isEnabled,b.m.Za,b.m.Cg,b.m.state):e(c,a,h.A,h.ea,d,b.b.isEnabled(c),b.b.Za(c),m,b.b.getState(c));(b.m?b.m.disabled:g)&&kc(h,0,0,f.width,f.height,["button"],["button"])},f,b.Ba.Ua&&!m?function(){b.Ba.toggle(c);return 1}:pb(b.b,c)?function(a){var d=b.b;a=a.Dg;var e=d.find(c);e&&(rb(e,a),qb(d,c))}:null,b.Ba.Ua&&!m?null:function(a,d){b.b.hb(c,
d)},b.Ba.Ua&&!m?null:function(a,d){return b.b.gb(c,d)},c)}}function lc(a,b,c,d,e,f){a.controls=[];a.b="";for(var g=0;g<c.length;g++)switch(c[g]){case "!space":a.b+=" ";break;case "!!space":a.b+="_";break;case "!stretch":a.b+="s";break;case "!!stretch":a.b+="S";break;default:jc(a,b,c[g],d,e,f(c[g],a.h.A,b.b.find(c[g]).mc))}}function mc(a,b){for(var c=0;c<b.length;c++)if("!"!==b[c][0]&&a.b.ba(b[c]))return!0;return!1}
function nc(a,b,c){for(var d={},e=0;e<b.length;e++)if("!"!==b[e][0]&&(a.m?a.m.ba:a.b.find(b[e]).ba())){var f=F(a.ea,{tag:"button",id:b[e].replace(/:/g,"-"),da:c});d[b[e]]=f}return d}function oc(a){var b=0,c;for(c in a)a.hasOwnProperty(c)&&(b=Math.max(b,a[c].va()));return b};var pc={"vpl:then":function(a,b,c,d){b=Math.min(d.width,d.height);a.strokeStyle=c.rf;a.lineWidth=.2*b;a.beginPath();a.moveTo(-.25*b,-.5*b);a.lineTo(.25*b,0);a.lineTo(-.25*b,.5*b);a.stroke()},"vpl:error":function(a,b,c,d){b=Math.min(d.width,d.height);a.fillStyle="white";a.strokeStyle=c.$e;a.lineWidth=.07*b;a.beginPath();a.arc(0,0,.5*b,0,2*Math.PI);a.fill();a.stroke();a.fillStyle=c.$e;a.font="bold "+Math.round(.75*b).toString()+"px sans-serif";a.textAlign="center";a.textBaseline="middle";a.fillText("?",
0,.05*b)},"vpl:warning":function(a,b,c,d){b=Math.min(d.width,d.height);a.fillStyle="white";a.strokeStyle=c.Bf;a.lineWidth=.07*b;a.beginPath();a.arc(0,0,.5*b,0,2*Math.PI);a.fill();a.stroke();a.fillStyle=c.Bf;a.font="bold "+Math.round(.75*b).toString()+"px sans-serif";a.textAlign="center";a.textBaseline="middle";a.fillText("!",0,.05*b)},"vpl:moreHigh":function(a,b,c,d){b=Math.min(d.width,d.height);a.beginPath();a.moveTo(-.2*b,.1*b);a.lineTo(0,-.1*b);a.lineTo(.2*b,.1*b);a.lineWidth=.1*b;a.strokeStyle=
"black";a.shadowColor="white";a.shadowBlur=.2*b;a.stroke()},"vpl:moreLow":function(a,b,c,d){b=Math.min(d.width,d.height);a.beginPath();a.moveTo(-.2*b,-.1*b);a.lineTo(0,.1*b);a.lineTo(.2*b,-.1*b);a.lineWidth=.1*b;a.strokeStyle="black";a.shadowColor="white";a.shadowBlur=.2*b;a.stroke()},"vpl:customize":function(a,b,c,d){b=Math.min(d.width,d.height);a.fillStyle=c.rf;gc(a,0,0,b)}};function xb(){this.m=new qc;this.b=new qc;this.b.ca=!0;this.h=new qc}
function rc(a,b,c,d,e,f,g){function h(a){return"a"===a||"c"===a}var m=Math.min(d.width,d.height),l=m/b.A.j;e=new sc(c,d.width,d.height,e,f,function(a,b,e,f){var h=a.N;h.save();var k=a.A;a.A=tc(m,a.A.g*l);bc(d,h,b.x+e,b.y+f);var n=c.Z,q=b.data,A=b.x+e,J=b.y+f;a.N.save();a.N.translate(A,J);n.J(a,q,d);a.N.restore();c.locked&&uc(a,b.x+e,b.y+f,m,m,!0);(c.disabled||g.disabled)&&kc(a,b.x+e,b.y+f,m,m,["block"],["block"],!g.yg);a.A=k;h.restore()},g&&g.Je||c.disabled||c.locked||c.wb&&c.wb.locked||!c.Z.ga?g&&
g.ga?{ga:g.ga}:null:{ga:c.Z.ga,Ra:c.Z.Ra},g&&g.Ie?null:function(c,d){c.data.wb&&(a.yb(),ua(c.data.wb,d.data,c.data.Vd,function(){a.yb()}));b.na&&b.na()},g&&g.Ie?null:function(a,b){return b.data instanceof y&&(h(a.data.Z.type)===h(b.data.Z.type)||"c"===b.data.Z.type)&&a.data!==b.data});g&&g.Je||!c.Z.ga||!a.F||(e.F=function(a){return Wb(b,a)});e.qa=!(g&&g.He);e.m=!(g&&g.le);vc(b,e,wc(b,c));return e}
function xc(a,b,c,d,e,f){var g=new y(c,null,null);c.zb&&(g.c=c.zb());var h=0>("b"===a.mode?a.jc:a.ic).indexOf(c.name);b=rc(a,b,g,d,e,f,{Je:!0,Ie:!0,le:a.ia||a.readOnly,disabled:h||a.readOnly,yg:h,ga:!a.Ba.Ua||a.ia||a.readOnly?null:function(){var b="b"===a.mode?a.jc:a.ic;0<=b.indexOf(c.name)?b.splice(b.indexOf(c.name),1):b.push(c.name);return 1}});c.zb&&(b.ca=function(a){a=a.clone();a.data=new y(c,null,null);return a})}
function yc(a,b,c){var d=[],e=0;d=a.W.map(function(b,f){var g=a.error&&a.error.h&&(0===a.error.m.length||0<=a.error.m.indexOf(f))?a.error.Eb?c.Zc:c.Yc:c.Qa;g.width=null==b?E(1===d.length?c.ue:c.te):E(zc(b,0===f,c));e+=E(g);return c.Qa.width});if(0===a.W.length||!b&&null!==a.W[a.W.length-1])c.Qa.width=E(0===a.W.length?c.ue:c.te),d.push(c.Qa.width),e+=E(c.Qa);b=E(c.Nc);var f=[],g=0;f=a.actions.map(function(b,d){var e=a.error&&!a.error.h&&(0===a.error.b.length||0<=a.error.b.indexOf(d))?a.error.Eb?c.Zc:
c.Yc:c.Qa;e.width=null==b?E(1===f.length?c.se:c.re):E(zc(b,0===d,c));g+=E(e);return E(e)});if(0===a.actions.length||null!==a.actions[a.actions.length-1])c.Qa.width=E(0===a.actions.length?c.se:c.re),f.push(c.Qa.width),g+=E(c.Qa);return{total:e+b+g,W:d,wf:e,Ug:b,actions:f,Jg:g}}function zc(a,b,c){switch(a.Z.type){case "e":return b?c.Ld:c.Jf;case "a":return c.Ue;case "s":return c.vg;case "c":return c.tg;default:throw"internal";}}
function Bc(a,b,c,d,e,f,g,h,m){var l=f,r=yc(c,d,m),n=0<c.W.length&&"e"===c.W[0].Z.type?m.Ld:m.Jf,k=new sc(c,Cc(m.Sa),Dc(m.Sa),l-m.Sa.paddingLeft-m.Qa.offsetLeft()-n.offsetLeft(),h-m.Sa.paddingTop-m.Qa.offsetTop()-n.offsetTop(),function(a,b,d,h){var l=a.N;bc(m.Sa,l,b.x+d,b.y+h,!0);bc(m.Nc,l,g-m.Nc.width-m.Nc.marginRight-m.Nc.paddingRight-m.Qa.offsetLeft()-m.Ue.offsetLeft()+d,b.y+(Dc(m.Sa)-m.Nc.height)/2+h);Ec(a,"vpl:then",g-E(m.Nc)/2-m.Qa.offsetLeft()-m.Ue.offsetLeft()+d,b.y+Dc(m.Sa)/2+h,m.Nc);c.locked&&
uc(a,b.x,b.y,b.width,b.height,!1,c.disabled?"#ddd":"");var k=b.x+d+m.Sa.paddingLeft;0<e&&(k+=e-r.wf);p.forEach(function(a,d){var e=c.error&&c.error.h&&(0===c.error.m.length||0<=c.error.m.indexOf(d))?c.error.Eb?m.Zc:m.Yc:m.Qa;e.width=null==a?E(1===p.length?m.ue:m.te):E(zc(a,0===d,m));bc(e,l,k+e.marginLeft,b.y+h+m.Sa.paddingTop+m.Qa.marginTop,!0);k+=E(e)});k=b.x+d+m.Sa.paddingLeft+g-f;u.forEach(function(a,d){var e=c.error&&!c.error.h&&(0===c.error.b.length||0<=c.error.b.indexOf(d))?c.error.Eb?m.Zc:
m.Yc:m.Qa;e.width=null==a?E(1===u.length?m.se:m.re):E(zc(a,0===d,m));bc(e,l,k+e.marginLeft,b.y+h+m.Sa.paddingTop+m.Qa.marginTop,!0);k+=E(e)})},null,function(c,d){if(d.data instanceof sa){c=a.i.indexOf(c.data);var e=a.i.indexOf(d.data);0<=c&&0<=e&&(a.yb(),a.i.splice(e,1),a.i.splice(c,0,d.data))}else d.data instanceof y&&(a.yb(),ua(c.data,d.data,null,function(){a.yb()}));b.na&&b.na()},function(b,c){return c.data instanceof sa?c.data!==b.data:c.data.wb!==b.data&&("a"===a.mode||0===b.data.W.length||c.data instanceof
y&&"a"===c.data.Z.type)});c.disabled&&(k.h=function(a,c,d,e){kc(b,c.x+d,c.y+e,c.width,c.height,["rule"],["rule"])});if(a.ia||a.readOnly)k.m=!1;vc(b,k);var q,p=c.W;if(0===p.length||!d&&null!==p[p.length-1])p=p.concat(null);l=f;0<e&&(l+=e-r.wf);p.forEach(function(a,d){var e=a?zc(a,0===d,m):1===p.length?m.ue:m.te,f=c.error&&c.error.h&&(0===c.error.m.length||0<=c.error.m.indexOf(d))?c.error.Eb?m.Zc:m.Yc:m.Qa,g=0;switch(e.verticalAlign){case "middle":g=(f.height-e.va())/2;break;case "bottom":g=f.height-
e.va();break;case "top":break;default:g=f.height-e.va()-e.verticalAlign}a?(f.width=E(e),q=rc(this,b,a,e,l,h+g,{Je:c.disabled||this.ia||this.readOnly,He:c.disabled||this.ia||this.readOnly,le:this.ia||this.readOnly})):(f.width=E(e),q=rc(this,b,new oa("e",c,{Hc:!0,index:d}),e,l,h+g,{Ie:c.disabled||this.readOnly,He:!0,le:!0}));k.P.push(q);l+=E(f)},a);var u=c.actions;if(0===u.length||null!==u[u.length-1])u=u.concat(null);l=g;u.forEach(function(a,d){var e=a?zc(a,0==d,m):1===u.length?m.se:m.re,f=c.error&&
!c.error.h&&(0===c.error.b.length||0<=c.error.b.indexOf(d))?c.error.Eb?m.Zc:m.Yc:m.Qa,g=0;switch(e.verticalAlign){case "middle":g=(m.Sa.height-f.va())/2;break;case "bottom":g=m.Sa.height-f.va()}a?(f.width=E(e),q=rc(this,b,a,zc(a,0===d,m),l,h+g,{Je:c.disabled||this.ia||this.readOnly,He:c.disabled||this.ia||this.readOnly,le:this.ia||this.readOnly})):(f.width=E(e),q=rc(this,b,new oa("a",c,{Hc:!1,index:d}),e,l,h,{Ie:this.readOnly,He:!0,le:!0}));k.P.push(q);l+=E(f)},a);ac(b,function(){if(null!==c.error){var a=
c.error.Eb?m.qg:m.ze;Ec(b,c.error.Eb?"vpl:warning":"vpl:error",f-m.Sa.paddingLeft-m.Sa.marginLeft-m.Qa.offsetLeft()-n.offsetLeft()-a.width/2-a.marginRight-a.paddingRight,h+.5*n.height,a)}})}
function Fc(a,b,c,d,e,f){var g=f?e.qg:e.ze;ac(a,function(h){var m=Gc(a.ea,{tag:"conflict-line",da:[f?"warning":"error"]}),l=b-e.Sa.paddingLeft-e.Sa.marginLeft-e.Qa.offsetLeft()-e.Ld.offsetLeft()-g.width/2-g.marginRight-g.paddingRight,r=c+(e.Qa.height+g.height)/2,n=d+(e.Qa.height-g.height)/2;h.beginPath();h.moveTo(l,r);h.lineTo(l,n);m.stroke(h);h.beginPath();h.arc(l,r,m.lineWidth,0,Math.PI);m.stroke(h);h.beginPath();h.arc(l,n,m.lineWidth,-Math.PI,0);m.stroke(h)})}
function Hc(a,b){var c={};a=a.i.F;c.Fa=F(b,{tag:"view",da:["vpl"]});c.pg=F(b,{tag:"separator",da:["vpl","top"]});c.og=F(b,{tag:"separator",da:["vpl","bottom"]});c.ec=F(b,{tag:"toolbar",da:["vpl","top"]});c.ld=F(b,{tag:"toolbar",da:["vpl","bottom"]});c.Ja=F(b,{tag:"vpl",id:"scrolling-vpl"});c.Ld=F(b,{tag:"block",da:["event","event-main"],ib:a?["small"]:[]});c.Jf=F(b,{tag:"block",da:["event","event-aux"],ib:a?["small"]:[]});c.Ue=F(b,{tag:"block",da:["action"],ib:a?["small"]:[]});c.vg=F(b,{tag:"block",
da:["state"],ib:a?["small"]:[]});c.tg=F(b,{tag:"block",da:["comment"],ib:a?["small"]:[]});c.Mg=F(b,{tag:"block",da:["event","empty"],ib:a?["small"]:[]});c.re=F(b,{tag:"block",da:["action","empty"],ib:a?["small"]:[]});c.ue=F(b,{tag:"block",da:["event","empty"],ib:a?["only-child","small"]:["only-child"]});c.te=F(b,{tag:"block",da:["event","event-aux","empty"],ib:a?["small"]:[]});c.se=F(b,{tag:"block",da:["action","empty"],ib:a?["only-child","small"]:["only-child"]});c.Qa=F(b,{tag:"block-container"});
c.Yc=F(b,{tag:"block-container",da:["error"]});c.Zc=F(b,{tag:"block-container",da:["warning"]});c.Sa=F(b,{tag:"rule",ib:a?["small"]:[]});c.Nc=F(b,{tag:"widget",id:"widget-then",ib:a?["small"]:[]});c.ee=F(b,{tag:"block",da:["library","event"]});c.Kd=F(b,{tag:"block",da:["library","action"]});c.wg=F(b,{tag:"block",da:["library","state"]});c.ug=F(b,{tag:"block",da:["library","comment"]});c.Ka=F(b,{tag:"block-library",da:["event"]});c.Pa=F(b,{tag:"block-library",da:["action"]});c.ze=F(b,{tag:"widget",
id:"widget-error",ib:a?["small"]:[]});c.qg=F(b,{tag:"widget",id:"widget-warning",ib:a?["small"]:[]});return c}function Ob(a){var b=a.Ba,c=a.i;c.Qb(c.Bb);a.Vb="";a.Ed=!1;if(!b.Ua)for(b=0;b<c.i.length;b++)if(c.i[b].error)if(c.i[b].error.Eb)a.Vb||(a.Vb=c.i[b].error.F,a.Ed=!0);else{a.Vb=c.i[b].error.F;a.Ed=!1;break}}function Ic(a,b,c,d,e,f){var g=new Xb(a.ja);lc(g,a,b,c,a.i.fc||dc,a.i.pe||ic);Zb(g,d,f,e);return g}
function Fb(a){function b(a,b){switch(b.type){case "e":return a.ee;case "a":return a.Kd;case "s":return a.wg;case "c":return a.ug;default:throw"internal";}}var c=a.Ba,d=a.ja,e=a.i,f=Hc(a,d.ea);Jc(d);Ob(a);e.F=d.A.j<d.A.Wf;var g=Kc(d),h=d.state.Lg,m=mc(a,a.o),l=Pa(e),r=0,n=0;e.i.forEach(function(a){a=yc(a,l,f);r=Math.max(r,a.wf);n=Math.max(n,a.Jg)});var k=0,q=0;Na.forEach(function(a){if(c.Ua||0<=("b"===e.mode?e.jc:e.ic).indexOf(a.name))switch(a.type){case "e":case "s":k++;break;case "a":case "c":q++}},
a);Lc(d,function(b,c,d){if(a.b.gb("vpl:trashcan",c)){b=D-f.Sa.offsetLeft()-f.Qa.offsetLeft()-f.Ld.offsetLeft();var e=E(f.Sa);if(d<b||d>b+e)return a.b.hb("vpl:trashcan",c),!0}return!1});var p=nc(a,a.P,["vpl","top"]),u=oc(p),t=nc(a,a.o,["vpl","bottom"]),B=oc(p);f.Fa.cc(g.width);f.Fa.Rb(g.height);f.Fa.setPosition(0,0);f.ec.cc(f.Fa.width);f.ec.height=u;f.ec.setPosition(f.Fa.x,f.Fa.y);f.Ka.Rb(f.Fa.height-f.ec.va());var A=Math.max(Math.floor(f.Ka.height/f.ee.va()),1);u=f.Ka.scroll?1:Math.ceil(k/A);f.Ka.width=
u*E(f.ee);f.Ka.setPosition(f.Fa.x,f.Fa.y+f.ec.va());f.Pa.Rb(f.Fa.height-f.ec.va());var J=f.Pa.scroll?1:Math.ceil(q/A);f.Pa.width=J*E(f.Kd);f.Pa.setPosition(f.Fa.x+f.Fa.width-E(f.Pa),f.Fa.y+f.ec.va());f.ld.cc(f.Fa.width-E(f.Ka)-E(f.Pa));f.ld.height=B;f.ld.setPosition(f.Fa.x+E(f.Ka),f.Fa.y+f.Fa.height-f.ld.va());f.Ja.cc(f.Fa.width-E(f.Ka)-E(f.Pa));f.Ja.Rb(f.Fa.height-f.ec.va()-(m?f.ld.va():0));f.Ja.setPosition(f.Fa.x+E(f.Ka),f.Fa.y+f.ec.va());f.Qa.width=f.Yc.width=f.Zc.width=E(f.Ld);f.Qa.height=f.Yc.height=
f.Zc.height=f.Ld.va();B=E(f.Nc);A=r+n+B;var D=f.Fa.x+(f.Fa.width-A+E(f.ze))/2,fb=D+r+B;f.Sa.width=A;f.Sa.height=f.Qa.va();d.ab=[];ac(d,function(a){f.Fa.J(a)});$b(Ic(a,a.P,["vpl","top"],f.ec,f.pg,p),f.ec,p);0<m&&$b(Ic(a,a.o,["vpl","bottom"],f.ld,f.og,t),f.ld,t);var gb=f.ee.va(),ta=f.Kd.va();p=m=0;if(f.Ka.scroll){m=E(f.ee);h.b.Rb(k*gb);f.Ka.width=m;f.Ka.height=f.Ka.height;h.b.resize(f.Ka.x,f.Ka.y,f.Ka.width,f.Ka.height);ac(d,function(a){f.Ka.J(a)});h.b.qd(d);var qa=0;Na.forEach(function(a){if(("e"===
a.type||"s"===a.type)&&(c.Ua||0<=("b"===e.mode?e.jc:e.ic).indexOf(a.name))){var g=b(f,a);xc(e,d,a,g,f.Ka.x+g.offsetLeft(),f.Ka.y+g.offsetTop()+qa*gb);qa++}},a);h.b.end();ac(d,function(){var a=F(d.ea,{tag:"widget",id:"widget-moreHigh"}),b=F(d.ea,{tag:"widget",id:"widget-moreLow"});Mc(h.b)||Ec(d,"vpl:moreHigh",f.Ka.x+f.Ka.width/2,f.Ka.y+a.va()/2,a);Nc(h.b)||Ec(d,"vpl:moreLow",f.Ka.x+f.Ka.width/2,f.Ka.y+f.Ka.height-b.va()/2,b)})}else{ac(d,function(a){f.Ka.J(a)});m=u*gb+Oc(f.Ka);var Ka=Math.ceil(k/u);
qa=0;Na.forEach(function(a){if(("e"===a.type||"s"===a.type)&&(c.Ua||0<=("b"===e.mode?e.jc:e.ic).indexOf(a.name))){var g=b(f,a),h=f.Ka.x+g.offsetLeft()+Math.floor(qa/Ka)*gb,l=f.Ka.y+g.offsetTop()+qa%Ka*gb;xc(e,d,a,g,h,l);qa++}},a)}f.Pa.scroll?(p=E(f.Kd),h.h.Rb(q*ta),f.Pa.width=p,f.Pa.height=f.Pa.height,h.h.resize(f.Pa.x,f.Pa.y,f.Pa.width,f.Pa.height),ac(d,function(a){f.Pa.J(a)}),h.h.qd(d),qa=0,Na.forEach(function(a){if(("a"===a.type||"c"===a.type)&&(c.Ua||0<=("b"===e.mode?e.jc:e.ic).indexOf(a.name))){var g=
b(f,a);xc(e,d,a,g,f.Pa.x+f.Kd.offsetLeft(),f.Pa.y+f.Kd.offsetTop()+qa*ta);qa++}},a),h.h.end(),ac(d,function(){var a=F(d.ea,{tag:"widget",id:"widget-moreHigh"}),b=F(d.ea,{tag:"widget",id:"widget-moreLow"});Mc(h.h)||Ec(d,"vpl:moreHigh",f.Pa.x+f.Pa.width/2,f.Pa.y+a.va()/2,a);Nc(h.h)||Ec(d,"vpl:moreLow",f.Pa.x+f.Pa.width/2,f.Pa.y+f.Pa.height-b.va()/2,b)})):(ac(d,function(a){f.Pa.J(a)}),p=J*ta+Oc(f.Pa),Ka=Math.ceil(q/J),qa=0,Na.forEach(function(a){if(("a"===a.type||"c"===a.type)&&(c.Ua||0<=("b"===e.mode?
e.jc:e.ic).indexOf(a.name))){var g=b(f,a),h=f.Pa.x+g.offsetLeft()+f.Pa.width-(J-Math.floor(qa/Ka))*ta,l=f.Pa.y+g.offsetTop()+qa%Ka*ta;xc(e,d,a,g,h,l);qa++}},a));if(c.Ua){var La=F(d.ea,{tag:"widget",id:"vpl-customize"});La.width=f.Ja.width/4;La.height=f.Ja.height/4;ac(d,function(){Ec(d,"vpl:customize",f.Ja.x+f.Ja.width/2,f.Ja.y+f.Ja.height/2,La)})}else if(e.message)ac(d,function(a){var b=e.message.split("\n"),c=Math.min(14,g.height/b.length);a.font=c+"px sans-serif";a.textAlign="start";a.textBaseline=
"top";var d=f.Ja.x+c,h=f.Ja.y+c;b.forEach(function(b,e){a.fillText(b,d,h+1.2*c*e)})});else{u=E(f.Sa)+f.Ja.paddingLeft+f.Ja.paddingRight+E(f.ze);h.m.cc(u);h.m.Rb(e.i.length*f.Sa.va());h.m.resize(f.Ja.x,f.Ja.y,f.Ja.width,f.Ja.height);ac(d,function(a){f.Ja.J(a)});h.m.qd(d);D+=(m-p)/2-d.A.Oc/2;fb+=(m-p)/2-d.A.Oc/2;u>f.Ja.width&&(D+=(u-f.Ja.width)/2+f.Ja.paddingLeft+f.Ja.marginLeft,fb+=(u-f.Ja.width)/2+f.Ja.paddingLeft+f.Ja.marginLeft);var N="";e.i.forEach(function(a,b){Bc(e,d,a,l,d.A.Rf?r:0,D,fb,f.Ja.y+
f.Sa.va()*b+f.Sa.offsetTop()+f.Qa.offsetTop(),f);if(null!==a.error&&""===N&&(N=a.error.F,null!==a.error.o))for(var c=b+1;c<e.i.length;c++)if(e.i[c]===a.error.o){Fc(d,D,f.Ja.y+f.Sa.va()*b+f.Sa.offsetTop()+f.Qa.offsetTop(),f.Ja.y+f.Sa.va()*c+f.Sa.offsetTop()+f.Qa.offsetTop(),f,a.error.Eb);break}});h.m.end();e.ia&&ac(d,function(){kc(d,f.Ja.x,f.Ja.y,f.Ja.width,f.Ja.height,["vpl"],["vpl"])})}ac(d,function(a){a.save();a.font="9px sans-serif";a.textAlign="start";a.textBaseline="bottom";a.rotate(-Math.PI/
2);a.fillText("EPFL 2018-2019",-g.height+d.A.pa,g.width-d.A.pa);a.restore()});e.na&&e.na();C(d)};function Pc(){this.Da={};this.m=[];this.P={px:1,cm:96/2.54,mm:96/25.4,"in":96,pc:16,pt:96/72};this.b=null}
function Qc(a,b,c){function d(){return b+" line "+r+" col "+n}function e(){for(;l<c.length;)if(" "===c[l]||"\t"===c[l])l++,n++;else if("\n"===c[l])l++,n=1,r++;else if("\r"===c[l])l++;else if("/*"===c.slice(l,l+2))for(l+=2,n+=2;l<c.length;)if("*/"===c.slice(l,l+2)){l+=2;n+=2;break}else l++,n++;else break}function f(){"\n"===c[l]?(n=1,r++):"\r"!==c[l]&&n++;l++}function g(){for(var a=0;l+a<c.length&&/[-_a-z0-9]/i.test(c[l+a]);)a++;l+=a;n+=a;return c.slice(l-a,l)}function h(){var a=new Rc;if(!/[a-z_.#*:]/i.test(c[l]))throw"Syntax error "+
d();for(/[a-z_]/i.test(c[l])?a.tag=g():"*"===c[l]&&f();;)if("#"===c[l]){if(a.id)throw"Multiple ids in selector "+d();f();a.id=g()}else if("."===c[l])f(),a.da.push(g());else if(":"===c[l])f(),a.ib.push(g());else break;return a}function m(){for(var a=0;l+a<c.length&&";"!==c[l+a]&&"}"!==c[l+a];)"\n"===c[l]?(r++,n=1):"\r"!==c[l]&&n++,a++;l+=a;return c.slice(l-a,l).trim()}a.Da[b]=c;for(var l=0,r=1,n=1;l<c.length;){e();if(l>=c.length)break;for(var k=[];;){k.push(h());e();if(","!==c[l])break;l++;n++;e()}if("{"!==
c[l])throw"Syntax error "+d();l++;n++;for(var q={};;){for(;;){e();if(";"!==c[l])break;l++}if(l>=c.length)throw"Unclosed block "+d();if("}"===c[l]){l++;n++;break}else if(!/[a-z_]/i.test(c[l]))throw"Syntax error "+d();var p=g();e();if(":"!==c[l])throw"Missing colon "+d();l++;n++;var u=m();q[p]=a.qa(p,u)}for(p=0;p<k.length;p++)a.m.push({uf:k[p],yc:q})}}Pc.prototype.qa=function(a,b){return b};
function Sc(a,b){b=/^(-?([0-9]+\.?|[0-9]*\.[0-9]+))([a-z]*|%)$/.exec(b);var c=1,d=Tc;if(null==b)throw"Illegal length";if("%"===b[3])d=Uc;else if(a.P.hasOwnProperty(b[3]))c=a.P[b[3]];else if("vw"===b[3])d=Vc;else if("vh"===b[3])d=Wc;else if("vmin"===b[3])d=Xc;else if("vmax"===b[3])d=Yc;else if("ww"===b[3])d=Zc;else if("wh"===b[3])d=$c;else if("wmin"===b[3])d=ad;else if("wmax"===b[3])d=bd;else if(0==parseFloat(b[1]))c=0;else throw"Unknown length unit";return new cd(parseFloat(b[1])*c,d)}
var dd={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgreen:"#006400",
darkgrey:"#A9A9A9",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",
ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",green:"#008000",greenyellow:"#ADFF2F",grey:"#808080",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgreen:"#90EE90",lightgrey:"#D3D3D3",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",
lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",
moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",
seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32",transparent:"rgba(0,0,0,0)"};function cd(a,b){this.V=a;this.type=b?b:Tc}
var Tc="abs",Uc="%",Vc="vw",Wc="vh",Xc="vmin",Yc="vmax",Zc="ww",$c="wh",ad="wmin",bd="wmax";function G(a,b){switch(a.type){case Tc:return a.V;case Uc:return a.V*(b?b.F/100:1);case Vc:return a.V*(b?b.h:1);case Wc:return a.V*(b?b.b:1);case Xc:return a.V*(b?Math.min(b.h,b.b):1);case Yc:return a.V*(b?Math.max(b.h,b.b):1);case Zc:return a.V*(b?b.o:1);case $c:return a.V*(b?b.m:1);case ad:return a.V*(b?Math.min(b.o,b.m):1);case bd:return a.V*(b?Math.max(b.o,b.m):1);default:throw"internal";}}
function ed(a,b,c,d,e){this.F=a;this.h=b;this.b=c;this.o=d;this.m=e}function Rc(){this.id=this.tag=null;this.da=[];this.ib=[]}function fd(a,b){a=a.id?"#"+a.id:(a.tag||"")+(a.da&&0<a.da.length?"."+a.da.join("."):"")+(a.ib&&0<a.ib.length?":"+a.ib.join("."):"")||"*";b&&(a+="/"+Math.round(b.F).toString(10)+","+Math.round(b.h).toString(10)+","+Math.round(b.b).toString(10)+","+Math.round(b.o).toString(10)+","+Math.round(b.m).toString(10));return a}
Rc.prototype.match=function(a){if(a.tag&&this.tag&&a.tag!==this.tag||this.id&&this.id!==a.id)return!1;for(var b=0;b<this.da.length;b++)if(void 0==a.da||0>a.da.indexOf(this.da[b]))return!1;for(b=0;b<this.ib.length;b++)if(void 0==a.ib||0>a.ib.indexOf(this.ib[b]))return!1;return!0};function vb(){Pc.call(this);this.h=[];this.o={};this.F={};this.ca="none hidden dotted dashed solid double".split(" ");this.cb=["normal","italic","oblique"];this.ub=["normal","bold"]}vb.prototype=Object.create(Pc.prototype);vb.prototype.constructor=vb;vb.prototype.defineProperties=function(){for(var a=0;a<this.m.length;a++){var b=new gd;hd(b,this.m[a].yc);this.h.push({uf:this.m[a].uf,hg:b})}};
vb.prototype.qa=function(a,b){function c(a){try{Sc(e,a)}catch(q){return!1}return!0}function d(a){return dd.hasOwnProperty(a)||/^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(a)||/^rgba\([^()]*\)$/.test(a)}var e=this;switch(a){case "margin-left":case "margin-right":case "margin-top":case "margin-bottom":case "padding-left":case "padding-right":case "padding-top":case "padding-bottom":case "border-left-width":case "border-right-width":case "border-top-width":case "border-bottom-width":case "line-width":case "width":case "height":case "min-width":case "min-height":case "max-width":case "max-height":case "font-size":return Sc(this,
b);case "margin":case "padding":case "border-width":switch(a=b.replace(/ +/g," ").split(" ").map(function(a){return Sc(e,a)}),a.length){case 1:return[a[0],a[0],a[0],a[0]];case 2:return[a[0],a[1],a[0],a[1]];case 3:return[a[0],a[1],a[2],a[1]];case 4:return a;default:throw"Wrong number of lengths";}case "border-style":case "border-left-style":case "border-right-style":case "border-top-style":case "border-bottom-style":case "line-style":if(!(0<=e.ca.indexOf(b)))throw"Unknown border style";return b;case "line-cap":if(!(0<=
["butt","round","square"].indexOf(b)))throw"Unknown line cap";return b;case "border-color":case "border-left-color":case "border-right-color":case "border-top-color":case "border-bottom-color":case "color":case "background-color":case "background":if(!d(b))throw"Unknown border color";return b;case "border-left":case "border-right":case "border-top":case "border-bottom":case "border":case "line":var f=null,g=null,h=null;b.replace(/ +/g," ").split(" ").forEach(function(a){if(d(a))f=a;else if(0<=e.ca.indexOf(a))g=
a;else if(c(a))h=Sc(e,a);else throw"Illegal border property";});return{color:f,style:null===g&&(f||h)?"solid":g,width:null===h&&(f||g)?new cd(1):h};case "border-top-left-radius":case "border-top-right-radius":case "border-bottom-right-radius":case "border-bottom-left-radius":switch(a=b.replace(/ +/g," ").split(" ").map(function(a){return Sc(e,a)}),a.length){case 1:return[a[0],a[0]];case 2:return a;default:throw"Wrong number of radii";}case "border-radius":switch(a=b.split("/").map(function(a){a=a.replace(/ +/g,
" ").split(" ").map(function(a){return"/"===a?"/":Sc(e,a)});switch(a.length){case 1:return[a[0],a[0],a[0],a[0]];case 2:return[a[0],a[1],a[0],a[1]];case 3:return[a[0],a[1],a[2],a[1]];case 4:return a;default:throw"Wrong number of radii";}}),a.length){case 1:return a[0].concat(a[0]);case 2:return a[0].concat(a[1]);default:throw"Wrong number of radius dimensions";}case "font":var m="",l="",r=null,n="";b.replace(/ +/g," ").split(" ").forEach(function(a){if(null===r)if(c(a))r=Sc(e,a);else if(0<=e.cb.indexOf(a))m=
a;else if(0<=e.ub.indexOf(a))l=a;else throw"Unknown font style "+a;else{if(""!==n)throw"Unexpected font style after font-family";n=a}});return{fontFamily:n,fontSize:r,fontStyle:m,fontWeight:l};case "box-shadow":case "line-shadow":return b=b.split(",")[0],a=b.replace(/ +/g," ").split(" "),"inset"===a[0]&&(a=a.slice(1)),3<=a.length&&5>=a.length?{offset:[Sc(this,a[0]),Sc(this,a[1])],color:a[a.length-1],ve:4<=a.length?Sc(this,a[2]):null,Me:5<=a.length?Sc(this,a[3]):null}:{};case "overflow":if(0>["wrap",
"scroll"].indexOf(b))throw"Unknown overflow mode";return b;case "vertical-align":return 0<=["top","middle","bottom"].indexOf(b)?b:Sc(this,b);default:return b}};function id(a,b){for(var c=null,d=0;d<a.h.length;d++)if(a.h[d].uf.match(b)){if(c){var e=void 0;var f=a.h[d].hg;c=c.Ab();for(e in f.yc)f.yc.hasOwnProperty(e)&&(c.yc[e]=f.yc[e]);e=c}else e=a.h[d].hg.Ab();c=e}for(var g in c)c.hasOwnProperty(g)&&c[g]instanceof cd&&(c[g]=G(c[g],a.b));return c}
function F(a,b){var c=fd(b,a.b);if(a.o[c])return a.o[c];b=id(a,b);b=new jd(b,a.b);return a.o[c]=b}function Gc(a,b){var c=fd(b,a.b);if(a.F[c])return a.F[c];b=id(a,b);b=new kd(b,a.b);return a.F[c]=b}function gd(){this.yc={}}function hd(a,b){for(var c in b)b.hasOwnProperty(c)&&(a.yc[c]=b[c])}gd.prototype.Ab=function(){var a=new gd;hd(a,this.yc);return a};
function jd(a,b){this.marginBottom=this.marginTop=this.marginRight=this.marginLeft=this.y=this.x=this.height=this.width=0;this.ob=!0;this.hd=!1;this.borderBottomWidth=this.borderTopWidth=this.borderRightWidth=this.borderLeftWidth=0;this.borderBottomStyle=this.borderTopStyle=this.borderRightStyle=this.borderLeftStyle="none";this.borderBottomColor=this.borderTopColor=this.borderRightColor=this.borderLeftColor="black";this.borderTopLeftRadius=[0,0];this.borderTopRightRadius=[0,0];this.borderBottomRightRadius=
[0,0];this.borderBottomLeftRadius=[0,0];this.paddingBottom=this.paddingTop=this.paddingRight=this.paddingLeft=0;this.backgroundColor="transparent";this.color="black";this.fontFamily="sans-serif";this.fontSize=10;this.fontWeight=this.fontStyle="";this.scroll=!1;this.verticalAlign="middle";this.Fb=null;this.Cd=this.Pc=0;this.shadowColor=null;a&&ld(this,a.yc,b)}jd.prototype=Object.create(gd.prototype);v=jd.prototype;v.constructor=jd;
function ld(a,b,c){var d=-1,e=-1,f=-1,g=-1,h=1E9,m=1E9,l;for(l in b)switch(l){case "margin-left":a.marginLeft=G(b[l],c);break;case "margin-right":a.marginRight=G(b[l],c);break;case "margin-top":a.marginTop=G(b[l],c);break;case "margin-bottom":a.marginBottom=G(b[l],c);break;case "border-left-width":a.borderLeftWidth=G(b[l],c);a.ob=!1;break;case "border-right-width":a.borderRightWidth=G(b[l],c);a.ob=!1;break;case "border-top-width":a.borderTopWidth=G(b[l],c);a.ob=!1;break;case "border-bottom-width":a.borderBottomWidth=
G(b[l],c);a.ob=!1;break;case "padding-left":a.paddingLeft=G(b[l],c);break;case "padding-right":a.paddingRight=G(b[l],c);break;case "padding-top":a.paddingTop=G(b[l],c);break;case "padding-bottom":a.paddingBottom=G(b[l],c);break;case "margin":a.marginTop=G(b[l][0],c);a.marginRight=G(b[l][1],c);a.marginBottom=G(b[l][2],c);a.marginLeft=G(b[l][3],c);break;case "border-width":a.borderTopWidth=G(b[l][0],c);"none"===a.borderTopStyle&&0<a.borderTopWidth&&(a.borderTopStyle=null);a.borderRightWidth=G(b[l][1],
c);"none"===a.borderRightStyle&&0<a.borderRightWidth&&(a.borderRightStyle=null);a.borderBottomWidth=G(b[l][2],c);"none"===a.borderBottomStyle&&0<a.borderBottomWidth&&(a.borderBottomStyle=null);a.borderLeftWidth=G(b[l][3],c);"none"===a.borderLeftStyle&&0<a.borderLeftWidth&&(a.borderLeftStyle=null);break;case "padding":a.paddingTop=G(b[l][0],c);a.paddingRight=G(b[l][1],c);a.paddingBottom=G(b[l][2],c);a.paddingLeft=G(b[l][3],c);break;case "border-style":a.borderLeftStyle=b[l];a.borderRightStyle=b[l];
a.borderTopStyle=b[l];a.borderBottomStyle=b[l];break;case "border-left-style":a.borderLeftStyle=b[l];a.ob=!1;break;case "border-right-style":a.borderRightStyle=b[l];a.ob=!1;break;case "border-top-style":a.borderTopStyle=b[l];a.ob=!1;break;case "border-bottom-style":a.borderBottomStyle=b[l];a.ob=!1;break;case "border-color":a.borderLeftColor=b[l];a.borderRightColor=b[l];a.borderTopColor=b[l];a.borderBottomColor=b[l];break;case "border-left-color":a.borderLeftColor=b[l];a.ob=!1;break;case "border-right-color":a.borderRightColor=
b[l];a.ob=!1;break;case "border-top-color":a.borderTopColor=b[l];a.ob=!1;break;case "border-bottom-color":a.borderBottomColor=b[l];a.ob=!1;break;case "border-left":null!==b[l].color&&(a.borderLeftColor=b[l].color);null!==b[l].style&&(a.borderLeftStyle=b[l].style);null!==b[l].width&&(a.borderLeftWidth=G(b[l].width,c));a.ob=!1;break;case "border-right":null!==b[l].color&&(a.borderRightColor=b[l].color);null!==b[l].style&&(a.borderRightStyle=b[l].style);null!==b[l].width&&(a.borderRightWidth=G(b[l].width,
c));a.ob=!1;break;case "border-top":null!==b[l].color&&(a.borderTopColor=b[l].color);null!==b[l].style&&(a.borderTopStyle=b[l].style);null!==b[l].width&&(a.borderTopWidth=G(b[l].width,c));a.ob=!1;break;case "border-bottom":null!==b[l].color&&(a.borderBottomColor=b[l].color);null!==b[l].style&&(a.borderBottomStyle=b[l].style);null!==b[l].width&&(a.borderBottomWidth=G(b[l].width,c));a.ob=!1;break;case "border":null!==b[l].color&&(a.borderLeftColor=a.borderRightColor=a.borderTopColor=a.borderBottomColor=
b[l].color);null!==b[l].style&&(a.borderLeftStyle=a.borderRightStyle=a.borderTopStyle=a.borderBottomStyle=b[l].style);null!==b[l].width&&(a.borderLeftWidth=a.borderRightWidth=a.borderTopWidth=a.borderBottomWidth=G(b[l].width,c));a.ob=!0;break;case "border-top-left-radius":a.borderTopLeftRadius=b[l].map(function(a){return G(a,c)});a.hd=!0;break;case "border-top-right-radius":a.borderTopRightRadius=b[l].map(function(a){return G(a,c)});a.hd=!0;break;case "border-bottom-right-radius":a.borderBottomRightRadius=
b[l].map(function(a){return G(a,c)});a.hd=!0;break;case "border-bottom-left-radius":a.borderBottomLeftRadius=b[l].map(function(a){return G(a,c)});a.hd=!0;break;case "border-radius":a.borderTopLeftRadius=[G(b[l][0],c),G(b[l][4],c)];a.borderTopRightRadius=[G(b[l][1],c),G(b[l][5],c)];a.borderBottomRightRadius=[G(b[l][2],c),G(b[l][6],c)];a.borderBottomLeftRadius=[G(b[l][3],c),G(b[l][7],c)];a.hd=!0;break;case "background-color":case "background":a.backgroundColor=b[l];break;case "color":a.color=b[l];break;
case "font":a.fontFamily=b[l].fontFamily;a.fontSize=G(b[l].fontSize,c);a.fontStyle=b[l].fontStyle;a.fontWeight=b[l].fontWeight;break;case "font-family":a.fontFamily=b[l];break;case "font-size":a.fontSize=G(b[l],c);break;case "font-style":a.fontStyle=b[l];break;case "font-weight":a.fontWeight=b[l];break;case "overflow":a.scroll="scroll"===b[l];break;case "vertical-align":a.verticalAlign=b[l]instanceof cd?G(b[l],c):b[l];break;case "box-shadow":null!==b[l].Fb&&(a.Fb=b[l].offset.map(function(a){return a?
G(a,c):0}),a.Pc=b[l].ve?G(b[l].ve,c):0,a.Cd=b[l].Me?G(b[l].Me,c):0,a.shadowColor=b[l].color);break;case "width":d=G(b[l],c);break;case "min-width":f=G(b[l],c);break;case "max-width":h=G(b[l],c);break;case "height":e=G(b[l],c);break;case "min-height":g=G(b[l],c);break;case "max-height":m=G(b[l],c)}d=Math.max(Math.min(d,h),f);e=Math.max(Math.min(e,m),g);0<=d&&(a.width=d);0<=e&&(a.height=e)}v.setPosition=function(a,b){this.x=a+this.offsetLeft();this.y=b+this.offsetTop()};
function E(a){return a.width+Oc(a)}v.va=function(){return this.height+(this.marginTop+this.borderTopWidth+this.paddingTop+this.paddingBottom+this.borderBottomWidth+this.marginBottom)};v.cc=function(a){this.width=a-(this.marginLeft+this.borderLeftWidth+this.paddingLeft+this.paddingRight+this.borderRightWidth+this.marginRight)};v.Rb=function(a){this.height=a-(this.marginTop+this.borderTopWidth+this.paddingTop+this.paddingBottom+this.borderBottomWidth+this.marginBottom)};
v.Ab=function(){var a=new jd;a.width=this.width;a.height=this.height;a.x=this.x;a.y=this.y;a.marginLeft=this.marginLeft;a.marginRight=this.marginRight;a.marginTop=this.marginTop;a.marginBottom=this.marginBottom;a.ob=this.ob;a.hd=this.hd;a.borderLeftWidth=this.borderLeftWidth;a.borderRightWidth=this.borderRightWidth;a.borderTopWidth=this.borderTopWidth;a.borderBottomWidth=this.borderBottomWidth;a.borderLeftStyle=this.borderLeftStyle;a.borderRightStyle=this.borderRightStyle;a.borderTopStyle=this.borderTopStyle;
a.borderBottomStyle=this.borderBottomStyle;a.borderLeftColor=this.borderLeftColor;a.borderRightColor=this.borderRightColor;a.borderTopColor=this.borderTopColor;a.borderBottomColor=this.borderBottomColor;a.borderTopLeftRadius=this.borderTopLeftRadius;a.borderTopRightRadius=this.borderTopRightRadius;a.borderBottomRightRadius=this.borderBottomRightRadius;a.borderBottomLeftRadius=this.borderBottomLeftRadius;a.paddingLeft=this.paddingLeft;a.paddingRight=this.paddingRight;a.paddingTop=this.paddingTop;a.paddingBottom=
this.paddingBottom;a.backgroundColor=this.backgroundColor;a.color=this.color;a.fontFamily=this.fontFamily;a.fontSize=this.fontSize;a.fontStyle=this.fontStyle;a.fontWeight=this.fontWeight;a.scroll=this.scroll;a.verticalAlign=this.verticalAlign;a.Fb=this.Fb;a.Pc=this.Pc;a.Cd=this.Cd;a.shadowColor=this.shadowColor;return a};v.offsetLeft=function(){return this.marginLeft+this.borderLeftWidth+this.paddingLeft};
function Oc(a){return a.marginLeft+a.borderLeftWidth+a.paddingLeft+a.paddingRight+a.borderRightWidth+a.marginRight}v.offsetTop=function(){return this.marginTop+this.borderTopWidth+this.paddingTop};function Cc(a){return a.width+a.paddingLeft+a.paddingRight}function Dc(a){return a.height+a.paddingTop+a.paddingBottom}function ec(a){return(a.fontStyle?a.fontStyle+" ":"")+(a.fontWeight?a.fontWeight+" ":"")+a.fontSize.toFixed(1)+"px "+a.fontFamily}
function kd(a,b){this.margin=0;this.Od=this.style=this.width=null;this.color="black";this.Fb=null;this.Cd=this.Pc=0;this.shadowColor=null;a&&md(this,a.yc,b);null===this.width&&(this.width=null!==this.style&&"none"!==this.style?1:0);null===this.style&&(this.style=0<this.width?"solid":"none");null===this.Od&&(this.Od="butt")}kd.prototype=Object.create(gd.prototype);kd.prototype.constructor=kd;
function md(a,b,c){for(var d in b)switch(d){case "margin":a.margin=G(b[d],c);break;case "line-width":a.width=G(b[d],c);break;case "line-style":a.style=b[d];break;case "line-cap":a.Od=b[d];break;case "color":a.color=b[d];break;case "line":null!==b[d].color&&(a.color=b[d].color);null!==b[d].style&&(a.style=b[d].style);null!==b[d].width&&(a.width=G(b[d].width,c));break;case "line-shadow":null!==b[d].Fb&&(a.Fb=b[d].offset.map(function(a){return a?G(a,c):0}),a.Pc=b[d].ve?G(b[d].ve,c):0,a.Cd=b[d].Me?G(b[d].Me,
c):0,a.shadowColor=b[d].color)}}kd.prototype.Ab=function(){var a=new kd;a.margin=this.margin;a.width=this.width;a.style=this.style;a.Od=this.Od;a.color=this.color;a.Fb=this.Fb;a.Pc=this.Pc;a.Cd=this.Cd;a.shadowColor=this.shadowColor;return a};var nd=!1;function od(a,b,c,d){a.strokeStyle=c||"black";switch(d){case "dotted":a.setLineDash([2*b,3*b]);a.lineDashOffset=0;break;case "dashed":a.setLineDash([3*b,3*b]),a.lineDashOffset=0}a.lineWidth=b||0}
function bc(a,b,c,d,e){function f(){var a=Math.min(g.borderTopLeftRadius[0],h/2),e=Math.min(g.borderTopLeftRadius[1],m/2);b.moveTo(c,d+e);b.bezierCurveTo(c,d+e/2,c+a/2,d,c+a,d);a=Math.min(g.borderTopRightRadius[0],h/2);e=Math.min(g.borderTopRightRadius[1],m/2);b.lineTo(c+h-a,d);b.bezierCurveTo(c+h-a/2,d,c+h,d+e/2,c+h,d+e);a=Math.min(g.borderBottomRightRadius[0],h/2);e=Math.min(g.borderBottomRightRadius[1],m/2);b.lineTo(c+h,d+m-e);b.bezierCurveTo(c+h,d+m-e/2,c+h-a/2,d+m,c+h-a,d+m);a=Math.min(g.borderBottomLeftRadius[0],
h/2);e=Math.min(g.borderBottomLeftRadius[1],m/2);b.lineTo(c+a,d+m);b.bezierCurveTo(c+a/2,d+m,c,d+m-e/2,c,d+m-e);b.closePath()}e||(c-=a.paddingLeft,d-=a.paddingTop);var g=a,h=a.width+a.paddingLeft+a.paddingRight,m=a.height+a.paddingTop+a.paddingBottom;nd&&(b.save(),b.strokeStyle="black",b.lineWidth=1,b.strokeRect(c,d,h,m),b.strokeRect(c+a.paddingLeft,d+a.paddingTop,a.width,a.height),b.strokeRect(c-a.marginLeft,d-a.marginTop,h+a.marginLeft+a.marginRight,m+a.marginTop+a.marginBottom),b.restore());b.save();
b.beginPath();a.hd?(b.beginPath(),f()):b.rect(c,d,h,m);b.save();a.Fb&&(b.shadowOffsetX=a.Fb[0],b.shadowOffsetY=a.Fb[1],b.shadowColor=a.shadowColor,b.shadowBlur=a.Pc);a.backgroundColor?b.fillStyle=a.backgroundColor:a.Fb&&(b.fillStyle="transparent");b.fill();b.restore();a.ob?0<a.borderLeftWidth&&a.borderLeftColor&&"none"!==a.borderLeftStyle&&"hidden"!==a.borderLeftStyle&&(od(b,a.borderLeftWidth,a.borderLeftColor,a.borderLeftStyle),"double"===a.borderLeftStyle&&(b.save(),b.translate(c+h/2,d+m/2),b.scale((h-
3*a.borderLeftWidth)/h,(m-3*a.borderLeftWidth)/m),b.translate(-c-h/2,-d-m/2),f(),b.restore()),b.stroke()):(0<a.borderLeftWidth&&a.borderLeftColor&&"none"!==a.borderLeftStyle&&"hidden"!==a.borderLeftStyle&&(od(b,a.borderLeftWidth,a.borderLeftColor,a.borderLeftStyle),b.beginPath(),b.moveTo(c,d),b.lineTo(c,d+m),b.stroke()),0<a.borderRightWidth&&a.borderRightColor&&"none"!==a.borderRightStyle&&"hidden"!==a.borderRightStyle&&(od(b,a.borderRightWidth,a.borderRightColor,a.borderRightStyle),b.beginPath(),
b.moveTo(c+h,d),b.lineTo(c+h,d+m),b.stroke()),0<a.borderTopWidth&&a.borderTopColor&&"none"!==a.borderTopStyle&&"hidden"!==a.borderTopStyle&&(od(b,a.borderTopWidth,a.borderTopColor,a.borderTopStyle),b.beginPath(),b.moveTo(c,d),b.lineTo(c+h,d),b.stroke()),0<a.borderBottomWidth&&a.borderBottomColor&&"none"!==a.borderBottomStyle&&"hidden"!==a.borderBottomStyle&&(od(b,a.borderBottomWidth,a.borderBottomColor,a.borderBottomStyle),b.beginPath(),b.moveTo(c,d+m),b.lineTo(c+h,d+m),b.stroke()));b.restore()}
jd.prototype.J=function(a){bc(this,a,this.x,this.y)};kd.prototype.stroke=function(a){a.save();this.Fb&&(a.shadowOffsetX=this.Fb[0],a.shadowOffsetY=this.Fb[1],a.shadowColor=this.shadowColor,a.shadowBlur=this.Pc);0<this.width&&this.color&&"none"!==this.style&&"hidden"!==this.style&&(od(a,this.width,this.color,this.style),a.lineCap=this.Od,a.stroke());a.restore()};function sc(a,b,c,d,e,f,g,h,m,l){this.data=a;this.width=b;this.height=c;this.x=d;this.y=e;this.b=null;this.P=[];this.o=f;this.h=null;this.m=this.qa=!0;this.ca=null;this.uc=g||null;this.hb=h||null;this.gb=m||null;this.Ze=this.Da=!1;this.doScroll=null;this.id=l||"";this.Rd=this.na=this.F=null}sc.prototype.clone=function(){var a=new sc(this.data,this.width,this.height,this.x,this.y,this.o,this.uc,this.hb,this.gb,this.id);a.h=this.h;return a};
sc.prototype.J=function(a,b,c,d){var e=a.N,f=this.b&&void 0===b;f&&(e.save(),e.beginPath(),e.rect(this.b.x,this.b.y,this.b.Bc,this.b.tc),e.clip(),b=this.b.Cf,c=this.b.Df);d?this.h&&this.h(a,this,b||0,c||0):this.o&&this.o(a,this,b||0,c||0);f&&e.restore()};sc.prototype.toDataURL=function(a,b,c){var d=document.createElement("canvas");b=b||1;d.width=b*this.width;d.height=b*this.height;b=new wb(d,{ag:b});b.A=a;this.J(b);this.J(b,0,0,!0);return d.toDataURL(c||"image/png")};
function pd(a){return a.b?{Cb:a.b.Cf,Db:a.b.Df}:{Cb:0,Db:0}}
function wb(a,b){function c(a){function b(a){var b=e.b.getBoundingClientRect(),d=pd(a);a.Rd=a.uc.ga(e,a.data,a.width,a.height,b.left+a.x+d.Cb,b.top+a.y+d.Db,c);return null!==a.Rd?(a.uc.Ra&&a.uc.Ra(e,a.data,a.Rd,a.width,a.height,b.left+a.x+d.Cb,b.top+a.y+d.Db,c),e.na&&e.na(),e.kb?e.kb():C(e),qd=a.uc.Ra?function(c,f){f?a.uc.kf&&(a.uc.kf(e,a.data,a.Rd),e.na&&e.na(),e.kb?e.kb():C(e)):(a.uc.Ra(e,a.data,a.Rd,a.width,a.height,b.left+a.x+d.Cb,b.top+a.y+d.Db,rd(e,c)),e.na&&e.na(),e.kb?e.kb():C(e))}:null,e.na&&
e.na(),e.kb?e.kb():C(e),!0):!1}if(e.qa){var c=rd(e,a);if(sd(e,c)){var d=e.tb;d.uc&&b(d)}else if(e.tb)e.F=-1,e.tb=null,e.na&&e.na(),e.kb?e.kb():C(e);else{var f=td(e,c,!0);if(0<f.length){if(d=e.ab[f[0]],0<=e.F&&e.F!==f[0]&&(e.F=-1,e.tb=null),e.Mb=Date.now(),(!d.uc||d.F&&e.F!==f[0]||!b(d))&&d.m){var r=d.ca?d.ca(d):d,n=null;a=pd(r);var k=c.x-a.Cb,q=c.y-a.Db;qd=function(a,b){var c=rd(e,a);if(b){if(d.F&&d===e.ab[td(e,c,!1)[0]])e.F=f[0],e.tb=d.F(d);else if(n&&n.hb&&(!n.gb||n.gb(n,r)))n.hb(n,r);else if(null==
n||null==n.hb||n.gb&&!n.gb(n,r))for(b=0;b<e.Da.length&&!e.Da[b].hb(n,r,c.x,c.y);b++);C(e);e.b.style.cursor="default"}else{var g=td(e,c,!1);n=null;a=!1;for(b=0;!a&&b<g.length;b++)n=e.ab[g[b]],a=n.hb&&(!n.gb||n.gb(n,r));a&&null!=n?(n.Ze=!0,C(e),n.Ze=!1):C(e);b=e.N;a&&!n.Da&&(g=pd(n),ud(e,n.x+g.Cb,n.y+g.Db,n.width,n.height,["drop-target"]));b.save();vd(e);e.transform&&(b.translate(e.width/2,e.height/2),CanvasRenderingContext2D.prototype.transform.apply(b,e.transform),b.translate(-e.width/2,-e.height/
2));b.translate(e.m*e.ua.Y,e.h*e.ua.aa);b.globalAlpha=.5;r.J(e,c.x-k,c.y-q);r.P.forEach(function(a){a.J(e,c.x-k,c.y-q);a.J(e,c.x-k,c.y-q,!0)});r.J(e,c.x-k,c.y-q,!0);b.restore();e.b.style.cursor=a?"copy":"default"}}}}else 0<=e.F&&(e.F=-1,e.tb=null,C(e))}}}var d=b&&b.ag||("devicePixelRatio"in window?window.devicePixelRatio:1);this.b=a;this.m=a.width/d;this.h=a.height/d;this.ua=b&&b.ua||{Y:0,oa:1,aa:0,ma:1};this.width=this.m*(this.ua.oa-this.ua.Y);this.height=this.h*(this.ua.ma-this.ua.aa);this.qa=!0;
this.transform=this.ub=null;this.N=this.b.getContext("2d");this.state=null;this.Da=[];this.Mb=0;this.F=-1;this.tb=null;this.o={};this.clientData={};this.ea=b&&b.ea||new vb;this.A=null;this.resize(this.width,this.height,b&&b.ag);this.ca={};var e=this;a.addEventListener("mousedown",c,!1);a.addEventListener("touchstart",function(a){var b=a.targetTouches;1===b.length&&(a.preventDefault(),c(b[0]),wd=b[0])},!1);a.addEventListener("wheel",function(a){function b(b){b.doScroll&&(a.preventDefault(),b.doScroll(0===
a.deltaMode?a.deltaX:1===a.deltaMode?10*a.deltaX:30*a.deltaX,0===a.deltaMode?a.deltaY:1===a.deltaMode?10*a.deltaY:30*a.deltaY))}if(e.qa){var c=rd(e,a);if(sd(e,c))e.tb&&b(e.tb);else if(0>e.F){c=td(e,c,!0);for(var d=0;d<c.length;d++)if(null!=e.ab[c[d]].doScroll){b(e.ab[c[d]]);break}}}},!1);this.ab=[];this.P=[];this.kb=this.na=null}function Jb(a,b){a.ua=b||{Y:0,oa:1,aa:0,ma:1};a.width=a.m*(a.ua.oa-a.ua.Y);a.height=a.h*(a.ua.ma-a.ua.aa)}
function Lc(a,b){for(var c=0;c<a.Da.length;c++)if("delete"===a.Da[c].tag){a.Da[c].hb=b;return}a.Da.push({tag:"delete",hb:b})}wb.prototype.show=function(){this.qa=!0};wb.prototype.lc=function(){this.qa=!1};function xd(a,b){a.b.style.filter=b}function yd(a,b){a.ub=b&&b.slice();a.transform=a.ub}
function rd(a,b){b={x:b.clientX,y:b.clientY,Dg:b.altKey};var c=[b.x,b.y];c=[c[0]-a.m*a.ua.Y,c[1]-a.h*a.ua.aa];var d=a.transform;if(d){var e=a.width/2;a=a.height/2;d=d.slice(0,4).concat(d[4]-e*d[0]-a*d[2]+e,d[5]-e*d[1]-a*d[3]+a);a=d[0]*d[3]-d[1]*d[2];c=[(d[3]*c[0]-d[2]*c[1]+d[2]*d[5]-d[3]*d[4])/a,(-d[1]*c[0]+d[0]*c[1]+d[1]*d[4]-d[0]*d[5])/a]}b.x=c[0];b.y=c[1];return b}function zd(a){a.na&&a.na();a.kb?a.kb():C(a)}
function tc(a,b){return{j:a,Wf:60,Rf:!1,pa:Math.max(1,Math.min(3,Math.round(a/40))),Kf:Math.round(a/4).toString(10)+"px sans-serif",Og:"navy",Pg:"#37f",Ng:"#06f",g:b,ya:Math.max(1,Math.min(3,b/30)),xg:"bold 15px sans-serif",tf:"navy",sf:"#ccc",Oc:5,$e:"#e44",Bf:"#f88",rf:"#bbb"}}
function Jc(a,b){a.width=a.m*(a.ua.oa-a.ua.Y);a.height=a.h*(a.ua.ma-a.ua.aa);a.N=a.b.getContext("2d");b=b||("devicePixelRatio"in window?window.devicePixelRatio:1);1!=b&&(a.N.resetTransform(),a.N.scale(b,b));a.ea.b=new ed(a.width,a.width/100,a.height/100,a.m/100,a.h/100);b=F(a.ea,{tag:"block"}).width;var c=F(a.ea,{tag:"button"}).width;a.A=tc(b,c)}
wb.prototype.resize=function(a,b,c){var d=c||("devicePixelRatio"in window?window.devicePixelRatio:1);this.b.width=a*d;this.b.height=b*d;this.m=a;this.h=b;Jc(this,c)};function wc(a,b){for(var c=0;c<a.ab.length;c++)if(a.ab[c].data===b)return c;return-1}
function td(a,b,c){var d=a.b.getBoundingClientRect(),e=b.x-d.left;b=b.y-d.top;d=[];for(var f=a.ab.length-1;0<=f;f--){var g=pd(a.ab[f]);if(g=(!c||a.ab[f].qa)&&e>=a.ab[f].x+g.Cb&&e<=a.ab[f].x+g.Cb+a.ab[f].width&&b>=a.ab[f].y+g.Db&&b<=a.ab[f].y+g.Db+a.ab[f].height)g=a.ab[f],g=!g.b||e>=g.b.x&&e<g.b.x+g.b.Bc&&b>=g.b.y&&b<g.b.y+g.b.tc;g&&d.push(f)}return d}
function Wb(a,b){var c=b.clone();a=Kc(a);var d=Math.min(a.width,a.height)/1.5/c.width;c.width*=d;c.height*=d;c.x=(a.width-c.width)/2;c.y=(a.height-c.height)/2;c.F=null;c.o=function(a,f){var e=a.N;e.save();e.translate(f.x,f.y);e.scale(d,d);e.translate(-f.x,-f.y);b.o(a,c,f.x-c.x,f.y-c.y);e.restore()};b.h&&(c.h=function(a,f){var e=a.N;e.save();e.translate(f.x,f.y);e.scale(d,d);e.translate(-f.x,-f.y);b.h(a,c,f.x-c.x,f.y-c.y);e.restore()});return c}
function sd(a,b){if(null==a.tb)return!1;var c=a.b.getBoundingClientRect(),d=b.x-c.left;b=b.y-c.top;return d>=a.tb.x&&d<=a.tb.x+a.tb.width&&b>=a.tb.y&&b<=a.tb.y+a.tb.height}function Kc(a){return{width:a.width,height:a.height}}function vd(a){a.N.beginPath();a.N.rect(a.m*a.ua.Y,a.h*a.ua.aa,a.m*(a.ua.oa-a.ua.Y),a.h*(a.ua.ma-a.ua.aa));a.N.clip()}
function Ad(a,b,c,d,e,f,g){f=f||0;g=g||0;if(0<a.P.length){var h=a.P[a.P.length-1];h.x>b&&(d-=h.x-b,b=h.x);h.x+h.Bc<b+d&&(d=h.x+h.Bc-b);h.y>c&&(e-=h.y-c,c=h.y);h.y+h.tc<c+e&&(e=h.y+h.tc-c);f+=h.Cf;g+=h.Df}a.P.push({x:b,y:c,Bc:d,tc:e,Cf:f,Df:g})}function vc(a,b,c){0<a.P.length&&(b.b=a.P[a.P.length-1]);0<=c?a.ab[c]=b:a.ab.push(b)}function ac(a,b){var c=new sc(null,-1,-1,0,0,function(a,c,f,g){a=a.N;a.save();a.translate(c.x+f,c.y+g);b(a);a.restore()});vc(a,c);return c}
function cc(a,b,c,d,e,f,g,h,m){var l,r=new sc(null,d.width,d.height,b,c,function(b,c,f,g){b=b.N;b.save();bc(d,b,c.x+f,c.y+g);b.translate(c.x+f,c.y+g);e(b,d,a.o.id===m&&a.o.cd||c.Ze);b.restore()},f?{ga:function(b,c,d,e,f,g,h){a.o={id:m,rect:{x:r.x,y:r.y,Bc:d,tc:e},cd:!0};l=h;C(a);return 0},Ra:function(b,c,d,e,f,g,h,l){d=b.b.getBoundingClientRect();c=l.x-d.left;l=l.y-d.top;a.o.cd=c>=a.o.rect.x&&c<a.o.rect.x+a.o.rect.Bc&&l>=a.o.rect.y&&l<a.o.rect.y+a.o.rect.tc;C(b)},kf:function(){a.o.cd&&f(l);a.o={};
C(a)}}:null,g,h,m);r.m=!1;r.Da=!0;vc(a,r);return r}function Ec(a,b,c,d,e){bc(e,a.N,c-e.width/2,d-e.height/2);var f=a.ca[b];void 0!=f&&(a.N.save(),a.N.translate(c,d),f(a.N,b,a.A,e),a.N.restore())}
function C(a){a.qa&&(a.N.clearRect(a.m*a.ua.Y,a.h*a.ua.aa,a.m*(a.ua.oa-a.ua.Y),a.h*(a.ua.ma-a.ua.aa)),a.N.save(),a.transform&&(a.N.translate(a.width/2,a.height/2),CanvasRenderingContext2D.prototype.transform.apply(a.N,a.transform),a.N.translate(-a.width/2,-a.height/2)),a.N.translate(a.m*a.ua.Y,a.h*a.ua.aa),a.ab.forEach(function(a){a.J(this)},a),a.ab.forEach(function(a){a.J(this,void 0,void 0,!0)},a),a.tb&&(a.N.save(),a.N.globalAlpha=.5,a.N.fillStyle="black",a.N.fillRect(a.m*a.ua.Y,a.h*a.ua.aa,a.m*
(a.ua.oa-a.ua.Y),a.h*(a.ua.ma-a.ua.aa)),a.N.restore(),a.tb.J(a),a.tb.J(a,0,0,!0)),a.N.restore())};function qc(){this.F=this.P=1;this.b=this.h=this.y=this.x=0;this.ca=!1;this.Da="";this.Gd=this.m=this.Fd=this.o=0;this.qa=null}v=qc.prototype;v.cc=function(a){this.P=a;this.o=Math.max(0,Math.min(this.o,this.P-this.h))};v.Rb=function(a){this.F=a;this.m=Math.max(0,Math.min(this.m,this.F-this.b))};v.resize=function(a,b,c,d){this.x=a;this.y=b;this.h=c;this.b=d;this.o=Math.max(0,Math.min(this.o,this.P-this.h));this.m=Math.max(0,Math.min(this.m,this.F-this.b))};
v.qd=function(a){this.qa=a;var b=this,c=new sc(null,this.h,this.b,this.x,this.y,null,this.P>this.h||this.F>this.b?{ga:function(a,c,f,g,h,m,l){b.Fd=l.x;b.Gd=l.y;return 0},Ra:function(a,c,f,g,h,m,l,r){a=Math.max(Math.min(r.x-b.Fd,b.o),b.o-b.P+b.h);b.o-=a;b.Fd+=a;r=Math.max(Math.min(r.y-b.Gd,b.m),b.m-b.F+b.b);b.m-=r;b.Gd+=r}}:null,null,null);c.m=!1;c.doScroll=function(c,e){b.o+=c;b.m+=e;a.na()};vc(a,c);this.Da&&ac(a,function(a){a.save();a.fillStyle=b.Da;a.fillRect(b.x,b.y,b.h,b.b);a.restore()});(this.P>
this.h||this.F>this.b)&&ac(a,function(c){c.save();if(b.P>b.h){var d=b.h/b.P;d=Math.max(d*b.h,Math.min(20,b.h));var f=b.h-d,g=b.o/(b.P-b.h);f*=g;c.fillStyle=a.A.sf;c.fillRect(b.x,b.y+b.b+2,b.h,a.A.Oc);c.fillStyle=a.A.tf;c.fillRect(b.x+f,b.y+b.b+2,d,a.A.Oc)}b.F>b.b&&(d=b.b/b.F,d=Math.max(d*b.b,Math.min(20,b.b)),f=b.b-d,g=b.m/(b.F-b.b),f*=g,c.save(),c.fillStyle=a.A.sf,c.fillRect(b.ca?b.x-2-a.A.Oc:b.x+b.h+2,b.y,a.A.Oc,b.b),c.fillStyle=a.A.tf,c.fillRect(b.ca?b.x-2-a.A.Oc:b.x+b.h+2,b.y+f,a.A.Oc,d));c.restore()});
Ad(a,this.x,this.y,this.h,this.b,-this.o,-this.m)};v.end=function(){this.qa.P.pop()};function Mc(a){return a.m<=.001*a.b}function Nc(a){return a.m>=a.F-1.001*a.b};function ud(a,b,c,d,e,f){f=F(a.ea,{tag:"overlay-rectangle",da:f||[]});f.x=b;f.y=c;f.width=d;f.height=e;f.J(a.N)}function kc(a,b,c,d,e,f,g,h){ud(a,b,c,d,e,(f||[]).concat("disabled"));F(a.ea,{tag:"overlay-rectangle",da:f||[]});h||(a.N.save(),f=Gc(a.ea,{tag:"crossout-line",da:g||[]}),a.N.beginPath(),a.N.moveTo(b-.1*a.A.j,c+.7*e),a.N.lineTo(b+d+.1*a.A.j,c+.3*e),f.stroke(a.N),a.N.restore())}
function fc(a,b,c,d,e,f){a.save();a.strokeStyle=e;a.fillStyle=e;a.lineWidth=d;a.fillRect(b-2.5*d,c-d,5*d,4*d);a.beginPath();a.moveTo(b-1.7*d,c);a.lineTo(b-1.7*d,c);f?(a.arc(b-3.4*d,c-2*d,1.7*d,0,Math.PI,!0),a.lineTo(b-5.1*d,c)):(a.arc(b,c-2*d,1.7*d,-Math.PI,0),a.lineTo(b+1.7*d,c));a.stroke();a.restore()}function uc(a,b,c,d,e,f,g){var h=.03*a.A.j;fc(a.N,b+d+(f?-5:5)*h,c+.15*e,h,g||"#333")}
function hc(a,b,c,d,e,f,g){a.save();g&&(g.style&&(a.strokeStyle=g.style,a.fillStyle=g.style),void 0!==g.lineWidth&&(a.lineWidth=g.lineWidth),void 0!==g.alpha&&(a.globalAlpha=g.alpha));var h=g&&void 0!==g.Fc?g.Fc:5*a.lineWidth;a.beginPath();var m=e+(g&&g.od?h/d:0),l=f-(g&&g.od?0:h/d);a.arc(b,c,d,m,l);a.stroke();g&&g.od?(a.translate(b+d*Math.cos(e),c+d*Math.sin(e)),a.rotate((e+m)/2+Math.PI)):(a.translate(b+d*Math.cos(f),c+d*Math.sin(f)),a.rotate((f+l)/2));a.beginPath();a.moveTo(0,0);a.lineTo(h/2,1.2*
-h);a.lineTo(-h/2,1.2*-h);a.fill();a.restore()}wb.prototype.text=function(a,b){var c=this.N,d=this.A;c.save();c.fillStyle=b&&b.fillStyle||"white";c.font=d.Kf;c.textAlign="center";c.textBaseline="middle";c.translate(.5*d.j+(b&&b.x||0),.5*d.j-(b&&b.y||0));b&&b.Fg&&c.rotate(-b.Fg);c.translate(-.5*d.j,-.5*d.j);c.fillText(a,.5*d.j,.5*d.j);c.restore()};
function I(a,b){var c=a.N,d=a.A;c.save();c.beginPath();c.rect(0,0,a.A.j,a.A.j);c.clip();b&&(b.scale||b.rotation)&&(b.Ne&&c.translate(-b.Ne[0],-b.Ne[1]),c.translate(.5*d.j,.5*d.j),b.scale&&c.scale(b.scale,b.scale),b.rotation&&c.rotate(-b.rotation),c.translate(-.5*d.j,-.5*d.j));c.beginPath();c.moveTo(.5*d.j,d.j-d.pa);b&&"left"===b.oe||(c.lineTo(d.j-d.pa,d.j-d.pa),c.lineTo(d.j-d.pa,.25*d.j),c.bezierCurveTo(.8*d.j,d.pa,.52*d.j,d.pa,.5*d.j,d.pa));b&&"right"===b.oe||(c.lineTo(.5*d.j,d.pa),c.bezierCurveTo(.48*
d.j,d.pa,.2*d.j,d.pa,d.pa,.25*d.j),c.lineTo(d.pa,d.j-d.pa));c.closePath();if(b&&b.Kb){a=[b.Kb[0],Math.max(.2+.8*b.Kb[1],b.Kb[2]/2),b.Kb[2]];var e=Math.max(a[0],Math.max(a[1],a[2]));c.fillStyle="rgb("+a.map(function(a){return Math.round(225*(1-e)+(30+225*e)*a)}).join(",")+")"}else c.fillStyle="white";c.fill();b&&b.Kb&&(c.strokeStyle="white",c.lineWidth=d.pa,c.stroke());b&&b.Wb&&(c.fillStyle="black",c.fillRect(0,.6*d.j,.1*d.j,.35*d.j),c.fillRect(.9*d.j,.6*d.j,.1*d.j,.35*d.j));c.restore()}
function Bd(a,b){var c=(b-a)/2,d=b===a?Infinity:(b+a)/(2*c);return{Ya:c,Pe:d,x:Math.abs(d)>1E3*Math.abs(a+b)?0:d*(.01>c?c*c/2:1-Math.cos(c)),y:Math.abs(d)>1E3*Math.abs(a+b)?(a+b)/2:d*Math.sin(c)}}
function Cd(a,b,c,d,e){var f=a.N;a=a.A;d*=a.j;var g=e&&e.r||[-1,0,1],h=e&&e.color||"black";e=e&&void 0!==e.je?e.je:1;var m=Bd(b,c);f.save();f.translate(.5*a.j,.5*a.j);f.strokeStyle=h;f.lineWidth=a.pa*e;20<Math.abs(m.Pe)?(f.beginPath(),g.forEach(function(a){f.moveTo(a*d,0);f.lineTo((m.x+a)*d,-m.y*d)}),f.stroke()):g.forEach(function(a){f.beginPath();var b=-m.Pe*d;a=(m.Pe+a)*d;var c=m.Ya;0<a?f.arc(b,0,a,0,-c,0<c):0>a&&f.arc(b,0,-a,Math.PI,Math.PI-c,0<c);f.stroke()});f.restore();return m}
function Dd(a,b,c,d,e,f,g){a=a.A;e*=a.j;f*=a.j;a=.21*a.j;c=g.x-c-b/2;b=d+b/2-g.y;e=Bd(e,f);return(c-e.x)*(c-e.x)+(b-e.y)*(b-e.y)<a*a}
function Fd(a){var b=a.N;a=a.A;b.save();b.translate(.5*a.j,.5*a.j);b.scale(.7,.7);b.translate(-.5*a.j,-.5*a.j);b.fillStyle="white";b.fillRect(a.pa,.45*a.j,a.j-2*a.pa,.35*a.j);b.fillStyle="black";b.beginPath();b.arc(.27*a.j,.72*a.j,.2*a.j,0,2*Math.PI);b.fill();b.fillStyle="white";b.beginPath();b.arc(.27*a.j,.72*a.j,.12*a.j,0,2*Math.PI);b.fill();b.beginPath();b.arc(.8*a.j,.8*a.j-a.pa,.1*a.j,0,2*Math.PI);b.fill();b.restore()}
wb.prototype.cb=function(){var a=this.N,b=this.A;a.save();a.lineWidth=b.pa;a.strokeStyle="white";for(var c=1;3>=c;c++)a.beginPath(),a.arc(.185*b.j,.48*b.j,.05*b.j*c,.9*Math.PI,1.7*Math.PI),a.stroke();a.restore()};
wb.prototype.buttons=function(a,b,c){var d=this.N,e=this.A;a.forEach(function(a,g){d.save();d.translate(e.j*(.5+a.x),e.j*(.5-a.y));d.rotate(a.r||0);d.fillStyle=a.fillStyle?a.fillStyle:b&&!0===b[g]?"red":b&&1===b[g]?"#f66":b&&-1===b[g]?"#333":"white";d.strokeStyle=a.strokeStyle?a.strokeStyle:!b||1!==b[g]&&!0!==b[g]?b&&0>b[g]?"black":"#aaa":"#700";d.lineWidth=e.pa;d.lineJoin="round";var f=a.size||1;switch(a.L){case "r":d.fillRect(.08*-e.j*f,.08*-e.j*f,.16*e.j*f,.16*e.j*f);d.strokeRect(.08*-e.j*f,.08*
-e.j*f,.16*e.j*f,.16*e.j*f);break;case "t":d.beginPath();d.moveTo(0,-.122*e.j*f);d.lineTo(.106*e.j*f,.062*e.j*f);d.lineTo(-.106*e.j*f,.062*e.j*f);d.closePath();d.fill();d.stroke();break;case "c":d.beginPath(),d.arc(0,0,.112*e.j*f,0,2*Math.PI),d.fill(),d.stroke()}b&&-1===b[g]&&c&&c.Pd&&(d.strokeStyle="white",d.beginPath(),d.moveTo(.06*-e.j*f,.06*-e.j*f),d.lineTo(.06*e.j*f,.06*e.j*f),d.moveTo(.06*-e.j*f,.06*e.j*f),d.lineTo(.06*e.j*f,.06*-e.j*f),d.stroke());d.restore()})};
function Gd(a,b,c,d,e,f,g,h,m){var l=a.N;a=a.A;l.save();l.strokeStyle="black";l.lineWidth=a.pa*m;m=b.length/2;for(var r=0;r<m;r++)0<b[2*r+1]&&(l.fillStyle=2===b[2*r+1]?"white":"black",l.beginPath(),l.arc(a.j*(c+(d-c)/m*(r+.5)),a.j*(e+(f-e)/g*(b[2*r]+.5)),a.j*h/2,0,2*Math.PI),l.fill(),l.stroke());l.restore()}wb.prototype.Pb=function(a){var b=this.N,c=this.A;b.save();b.fillStyle="#eee";for(var d=0;5>d;d++)b.fillRect(.1*c.j,c.j*(.1+.16*d),.8*c.j,.16*c.j-c.pa);Gd(this,a,.1,.9,.9,.1,5,.14,1);b.restore()};
function Hd(a){var b=a.N;a=a.A;b.beginPath();b.arc(0,0,.4*a.j,0,2*Math.PI,!0);b.moveTo(0,0);b.lineTo(0,.4*-a.j);b.strokeStyle="#666";b.lineWidth=a.pa;b.stroke();b.beginPath();b.arc(0,.4*-a.j,.1*a.j,0,2*Math.PI);b.fillStyle="white";b.fill();b.strokeStyle="black";b.stroke()}
function Id(a,b,c){var d=a.N,e=a.A;c=c*Math.PI/12;d.save();d.translate(.5*e.j,.5*e.j);d.rotate(c);Hd(a);d.fillRect(-.28*e.j,-.1*e.j,.56*e.j,.2*e.j);d.fillStyle="black";b?(d.beginPath(),d.arc(-.15*e.j,.03*e.j,.11*e.j,0,2*Math.PI),d.fill(),d.fillStyle="white",d.beginPath(),d.arc(-.15*e.j,.03*e.j,.07*e.j,0,2*Math.PI),d.fill(),d.beginPath(),d.arc(.15*e.j,.07*e.j,.06*e.j,0,2*Math.PI)):(d.fillRect(-.28*e.j,.1*e.j,.08*e.j,.04*e.j),d.fillRect(.2*e.j,.1*e.j,.08*e.j,.04*e.j),d.fillStyle="white",d.beginPath(),
d.arc(0,.06*e.j,.06*e.j,0,2*Math.PI));d.fill();d.restore()}function Jd(a,b,c,d,e){b=d.x-b-a/2;c=c+a/2-d.y;a=(b*b+c*c)/(a*a/4);return 1>a&&.4<a&&(e||0<=c)}function Kd(a,b,c,d,e){a=Math.round(12*Math.atan2(d.x-b-a/2,c+a/2-d.y)/Math.PI);return e?12===a?-12:a:Math.max(-6,Math.min(6,a))}
function Ld(a,b,c,d,e,f,g,h,m){var l=m?0>=g?0:Math.max(Math.log(10*g)/Math.log(100),0):g/4;a.save();!h&&f&&f(g);a.beginPath();a.arc(b,c,d,0,2*Math.PI);a.fillStyle="white";a.fill();f=.9*d;g=m?.8*d:.6*d;var r=2*Math.PI*(h?.2:l),n=h?"#ddd":"red";m=(g-(m?.5*d:.6*d))/4;a.save();a.beginPath();a.arc(b,c,f,-Math.PI/2,3*Math.PI/2-.05);a.arc(b,c,g-4*m,3*Math.PI/2-.05,Math.PI,!0);a.arc(b+m,c,g-3*m,Math.PI,Math.PI/2,!0);a.arc(b+m,c-m,g-2*m,Math.PI/2,0,!0);a.arc(b,c-m,g-m,0,-Math.PI/2,!0);a.clip();a.fillStyle=
n;a.beginPath();a.arc(b,c,f,-Math.PI/2,-Math.PI/2+r);a.lineTo(b,c);a.fill();a.restore();a.beginPath();a.arc(b,c,d/2,0,2*Math.PI);a.fill();a.beginPath();a.arc(b,c,d,0,2*Math.PI);a.strokeStyle="black";a.lineWidth=e;a.stroke();a.beginPath();a.moveTo(b-.1*d*Math.sin(2*l*Math.PI),c+.1*d*Math.cos(2*l*Math.PI));a.lineTo(b+.9*d*Math.sin(2*l*Math.PI),c-.9*d*Math.cos(2*l*Math.PI));a.lineWidth=2*e;a.stroke();h&&hc(a,b,c,1.25*d,.5*-Math.PI,.1*-Math.PI,{od:!0,Fc:5*e,style:"black"});a.restore()}
function Md(a,b,c,d){var e=a.N,f=a.A.j;Ld(e,f/2+(c?-.05*f:.05*f),f/2+(c?.07*f:.03*f),.4*f,a.A.pa,function(a){e.textAlign="start";e.textBaseline="top";e.font=Math.round(f/6).toString(10)+"px sans-serif";e.fillStyle="white";e.fillText(a.toFixed(1>a?2:1),f/20,f/40)},b,c,d)}
function Nd(a,b,c,d,e,f,g,h,m,l){var r=(d+e)/2,n=(e-d)/2;a.save();a.beginPath();a.arc(b,c,d,-g,-f);a.arc(b+r*Math.cos(f),c-r*Math.sin(f),n,-f-Math.PI,-f,!0);a.arc(b,c,e,-f,-g,!0);a.arc(b+r*Math.cos(g),c-r*Math.sin(g),n,-g,-g+Math.PI,!0);a.fillStyle=h;a.strokeStyle=m;a.lineWidth=l;a.fill();a.stroke();a.restore()}function Od(a,b,c,d){var e=a.A;Nd(a.N,e.j/2,e.j/2,.3*e.j,.45*e.j,b,c,0>d?"white":2===d?"red":0<d?"#f70":"#ddd",0===d?"#bbb":"black",e.pa)}
function Pd(a,b){var c=a.N;c.save();Od(a,.65*Math.PI,.85*Math.PI,b[0]);Od(a,.15*Math.PI,.35*Math.PI,b[1]);Od(a,1.15*Math.PI,1.35*Math.PI,b[2]);Od(a,1.65*Math.PI,1.85*Math.PI,b[3]);c.restore()}function Qd(a,b){var c=a.N;c.save();for(var d=0;8>d;d++)Od(a,Math.PI*(.46-.25*d),Math.PI*(.54-.25*d),d===b?1:-1);c.restore()}function Rd(a,b,c,d,e,f){b=(f.x-d)/b-.5;c=.5-(f.y-e)/c;for(e=0;e<a.length;e++)if(Math.max(Math.abs(b-a[e].x),Math.abs(c-a[e].y))<.11*(a[e].size||1))return e;return null}
function Sd(a,b,c,d,e,f){function g(a,b){h.beginPath();h.moveTo(m.j*(.1+.8*a),m.j*(.46-c));h.lineTo(m.j*(.1+.8*b),m.j*(.46-c));h.arc(m.j*(.1+.8*b),m.j*(.5-c),.04*m.j,-Math.PI/2,Math.PI/2);h.lineTo(m.j*(.1+.8*b),m.j*(.54-c));h.lineTo(m.j*(.1+.8*a),m.j*(.54-c));h.arc(m.j*(.1+.8*a),m.j*(.5-c),.04*m.j,Math.PI/2,-Math.PI/2)}var h=a.N,m=a.A;h.save();d&&(h.translate(.5*m.j,.5*m.j),h.rotate(-Math.PI/2),h.scale(1,-1),h.translate(-.5*m.j,-.5*m.j));h.lineWidth=m.pa;h.fillStyle="white";h.strokeStyle="black";
g(0,1);h.fill();h.stroke();h.fillStyle=e;switch(f||0){case 1:g(0,b);h.fill();h.stroke();break;case 2:g(b,1),h.fill(),h.stroke()}h.fillStyle=e;h.strokeStyle="black";h.lineWidth=m.pa;h.beginPath();h.arc(m.j*(.1+.8*b),m.j*(.5-c),.1*m.j,0,2*Math.PI);h.fill();h.stroke();h.restore()}function Td(a,b,c,d,e,f,g){c=(g.x-e)/c-.5;d=.5-(g.y-f)/d;return.1>Math.abs((b?c:d)-a)}function Ud(a,b,c,d,e,f){b=(f.x-d)/b-.5;c=.5-(f.y-e)/c;return.5+(a?c:b)/.8}
function Vd(a,b,c,d,e,f,g,h,m,l,r){a=Math.floor(((r.x-m)/g-a)/((b-a)/e));c=Math.floor((c-(r.y-l)/h)/((c-d)/f));return 0<=a&&a<e&&0<=c&&c<f?{index:a,tone:c}:null}function Wd(a,b,c,d,e){var f=.4*a;a=e.x-c-.55*a;b=d+.53*b-e.y;return a*a+b*b<=f*f}function Xd(a,b,c,d,e,f){a=(Math.PI-Math.atan2(f.x-c-.55*a,-(d+.53*b-f.y)))/(2*Math.PI);return e?Math.exp(a*Math.log(100))/10:4*a}function Yd(a,b,c,d,e){c=e.x-c-a/2;b=b/2-(e.y-d);return Math.abs(Math.sqrt(c*c+b*b)-.375*a)<=.15*a?0<=b?0>c?0:1:0>c?2:3:null}
function Zd(a,b,c,d,e){c=e.x-c-a/2;b=b/2-(e.y-d);return Math.abs(Math.sqrt(c*c+b*b)-.375*a)<=.15*a?(a=Math.atan2(c,b)+Math.PI/8,Math.floor((0>a?a+2*Math.PI:a)/(Math.PI/4))):null}function gc(a,b,c,d){a.beginPath();a.moveTo(b+d*Math.cos(.1),c+d*Math.sin(.2));for(var e=1;6>e;e++)a.lineTo(b+d*Math.cos(e*Math.PI/3+.2),c+d*Math.sin(e*Math.PI/3+.2));a.closePath();a.arc(b,c,.5*d,0,2*Math.PI,!0);a.fill()};function ra(a){for(var b=0;b<Na.length;b++)if(Na[b].name===a)return Na[b];return null}function Ja(a){var b=[];(Na||[]).forEach(function(c){"h"!==c.type&&0<=c.ta.indexOf(a)&&b.push(c)});return b};var Na=[new w({name:"!stop",type:"h",X:{aseba:function(){return{u:"motor.left.target = 0\nmotor.right.target = 0\ncall sound.system(-1)\ncall leds.circle(32,32,32,32,32,32,32,32)\ntimer.period[0] = 100\nonevent timer0\ncall leds.circle(0,0,0,0,0,0,0,0)\n"}}}}),new w(function(){var a=[{L:"c",x:0,y:0,r:0},{L:"t",x:0,y:.3,r:0},{L:"t",x:0,y:-.3,r:Math.PI},{L:"t",x:.3,y:0,r:Math.PI/2},{L:"t",x:-.3,y:0,r:-Math.PI/2}];return{name:"button 1",type:"e",ka:function(){return[0]},J:function(b,c){I(b);c=c.c[0];
b.buttons(a,[0==c,1==c,2==c,3==c,4==c])},ga:function(b,c,d,e,f,g,h){b=Rd(a,d,e,f,g,h);null!==b&&(z(c),c.c[0]=b);return b},X:{aseba:function(a){return{B:"onevent buttons\n",I:"button."+["center","forward","backward","right","left"][a.c[0]]+" != 0"}}}}}()),new w(function(){var a=[{L:"r",x:0,y:.4,r:0,w:"2"},{L:"r",x:-.22,y:.35,r:-.45,w:"1"},{L:"r",x:.22,y:.35,r:.45,w:"3"},{L:"r",x:-.4,y:.22,r:-.8,w:"0"},{L:"r",x:.4,y:.22,r:.8,w:"4"},{L:"r",x:-.2,y:-.4,w:"5"},{L:"r",x:.2,y:-.4,w:"6"}];return{name:"horiz prox",
ta:["b"],type:"e",ka:function(){return[0,0,0,0,0,0,0]},zb:function(){return[0,1,-1,1,-1,0,0]},J:function(b,c){I(b);b.buttons(a,c.c,{Pd:!0})},ga:function(b,c,d,e,f,g,h){b=Rd(a,d,e,f,g,h);null!==b&&(z(c),c.c[b]=(c.c[b]+2)%3-1);return b},oc:function(a){for(var b=0;7>b;b++)if(a.c[b])return null;return new za("No proximity sensor specified",!0)},sc:function(a,c){switch(c){case "a":return c=new y(ra("horiz prox adv"),null,null),c.c=a.c.concat(c.c.slice(7)),c;default:return a}},X:{aseba:function(b){for(var c=
"",d=0;7>d;d++)b.c[d]&&(c+=(0===c.length?"":" and ")+"prox.horizontal["+a[d].w+"] "+(0<b.c[d]?">= 2":"<= 1")+"000");if(""===c){for(d=0;7>d;d++)c+=" or prox.horizontal["+a[d].w+"] >= 2000";c=c.slice(4)}return{B:"onevent prox\n",I:c}}}}}()),new w(function(){var a=[{L:"r",x:0,y:.4,r:0,w:"2"},{L:"r",x:-.22,y:.35,r:-.45,w:"1"},{L:"r",x:.22,y:.35,r:.45,w:"3"},{L:"r",x:-.4,y:.22,r:-.8,w:"0"},{L:"r",x:.4,y:.22,r:.8,w:"4"},{L:"r",x:-.2,y:-.4,w:"5"},{L:"r",x:.2,y:-.4,w:"6"}];return{name:"horiz prox adv",ta:["c"],
type:"e",ka:function(){return[0,0,0,0,0,0,0,.4,.1]},zb:function(){return[0,1,-1,1,-1,0,0,.4,.1]},J:function(b,c){I(b);b.buttons(a,c.c,{Pd:!0});Sd(b,c.c[7],.02,!1,"red",2);Sd(b,c.c[8],-.2,!1,"black",1)},ga:function(b,c,d,e,f,g,h){b=Rd(a,d,e,f,g,h);return null!==b?(z(c),c.c[b]=(c.c[b]+2)%3-1,b):Td(.02,!1,d,e,f,g,h)?(z(c),7):Td(-.2,!1,d,e,f,g,h)?(z(c),8):null},Ra:function(a,c,d,e,f,g,h,m){7<=d&&(c.c[d]=Math.max(0,Math.min(1,Ud(!1,e,f,g,h,m))))},oc:function(a){for(var b=0;7>b;b++)if(a.c[b])return null;
return new za("No sensor specified",!0)},sc:function(a,c){switch(c){case "b":if(c=a.Z.ka(),a.c[7]===c[7]&&a.c[8]===c[8])return c=new y(ra("horiz prox"),null,null),c.c=a.c.slice(0,7),c;default:return a}},X:{aseba:function(b){for(var c="",d=0;7>d;d++)b.c[d]&&(c+=(0===c.length?"":" and ")+"prox.horizontal["+a[d].w+"] "+(0<b.c[d]?">= "+Math.round(7+33*b.c[7]):"<= "+Math.round(7+33*b.c[8]))+"00");if(""===c){for(d=0;7>d;d++)c+=" or prox.horizontal["+a[d].w+"] >= 2000";c=c.slice(5)}return{B:"onevent prox\n",
I:c}}}}}()),new w(function(){var a=[{L:"r",x:0,y:.4,r:0,w:"2"},{L:"r",x:-.22,y:.35,r:-.45,w:"1"},{L:"r",x:.22,y:.35,r:.45,w:"3"},{L:"r",x:-.4,y:.22,r:-.8,w:"0"},{L:"r",x:.4,y:.22,r:.8,w:"4"},{L:"r",x:-.2,y:-.4,w:"5"},{L:"r",x:.2,y:-.4,w:"6"}];return{name:"horiz prox 1",ta:["a"],type:"e",ka:function(){return[0,0,0,0,0,0,0,.25]},zb:function(){return[0,1,-1,1,-1,0,0,.25]},J:function(b,c){I(b);b.buttons(a,c.c,{Pd:!0});Sd(b,c.c[7],-.1,!1,"black",1)},ga:function(b,c,d,e,f,g,h){b=Rd(a,d,e,f,g,h);return null!==
b?(z(c),c.c[b]=(c.c[b]+2)%3-1,b):Td(-.1,!1,d,e,f,g,h)?(z(c),7):null},Ra:function(a,c,d,e,f,g,h,m){7<=d&&(c.c[d]=Math.max(.25,Math.min(.75,Math.round(4*Ud(!1,e,f,g,h,m))/4)))},oc:function(a){for(var b=0;7>b;b++)if(a.c[b])return null;return new za("No sensor specified",!0)},sc:function(a,c){switch(c){case "b":if(c=a.Z.ka(),a.c[7]===c[7])return c=new y(ra("horiz prox"),null,null),c.c=a.c.slice(0,7),c;default:return a}},X:{aseba:function(b){for(var c="",d=0;7>d;d++)b.c[d]&&(c+=(0===c.length?"":" and ")+
"prox.horizontal["+a[d].w+"] "+(0<b.c[d]?">=":"<")+" "+Math.round(4E3*b.c[7]));if(""===c){for(d=0;7>d;d++)c+=" or prox.horizontal["+a[d].w+"] >= 2000";c=c.slice(5)}return{B:"onevent prox\n",I:c}}}}}()),new w(function(){var a=[{L:"r",x:-.15,y:.35,w:"0"},{L:"r",x:.15,y:.35,w:"1"}];return{name:"ground",ta:["b"],type:"e",ka:function(){return[0,0]},zb:function(){return[1,-1]},J:function(b,c){I(b,{Wb:!0});b.buttons(a,c.c,{Pd:!0})},ga:function(b,c,d,e,f,g,h){b=Rd(a,d,e,f,g,h);null!==b&&(z(c),c.c[b]=(c.c[b]+
2)%3-1);return b},oc:function(a){return a.c[0]||a.c[1]?null:new za("No ground sensor specified",!0)},sc:function(a,c){switch(c){case "a":return c=new y(ra("ground adv"),null,null),c.c=a.c.concat(c.c.slice(2)),c;default:return a}},X:{aseba:function(b){for(var c="",d=0;2>d;d++)b.c[d]&&(c+=(0===c.length?"":" and ")+"prox.ground.delta["+a[d].w+"] "+(0<b.c[d]?">= 450":"<= 400"));if(""===c){for(d=0;2>d;d++)c+=" or prox.ground.delta["+a[d].w+"] >= 450";c=c.slice(4)}return{B:"onevent prox\n",I:c}}}}}()),
new w(function(){var a=[{L:"r",x:-.15,y:.35,w:"0"},{L:"r",x:.15,y:.35,w:"1"}];return{name:"ground adv",ta:["c"],type:"e",ka:function(){return[0,0,.6,.4]},zb:function(){return[1,-1,.6,.4]},J:function(b,c){I(b,{Wb:!0});b.buttons(a,c.c,{Pd:!0});Sd(b,c.c[2],.02,!1,"red",2);Sd(b,c.c[3],-.2,!1,"black",1)},ga:function(b,c,d,e,f,g,h){b=Rd(a,d,e,f,g,h);return null!==b?(z(c),c.c[b]=(c.c[b]+2)%3-1,b):Td(.02,!1,d,e,f,g,h)?(z(c),2):Td(-.2,!1,d,e,f,g,h)?(z(c),3):null},Ra:function(a,c,d,e,f,g,h,m){2<=d&&(c.c[d]=
Math.max(0,Math.min(1,Ud(!1,e,f,g,h,m))))},oc:function(a){return a.c[0]||a.c[1]?null:new za("No ground sensor specified",!0)},sc:function(a,c){switch(c){case "b":if(c=a.Z.ka(),a.c[2]===c[2]&&a.c[3]===c[3])return c=new y(ra("ground"),null,null),c.c=a.c.slice(0,2),c;default:return a}},X:{aseba:function(b){for(var c="",d=0;2>d;d++)b.c[d]&&(c+=(0===c.length?"":" and ")+"prox.ground.delta["+a[d].w+"] "+(0<b.c[d]?">= "+25*Math.round(40*b.c[2]):"<= "+25*Math.round(40*b.c[3])));if(""===c){for(d=0;2>d;d++)c+=
" or prox.ground.delta["+a[d].w+"] >= 450";c=c.slice(4)}return{B:"onevent prox\n",I:c}}}}}()),new w(function(){var a=[{L:"r",x:-.15,y:.35,w:"0"},{L:"r",x:.15,y:.35,w:"1"}];return{name:"ground 1",ta:["a"],type:"e",ka:function(){return[0,0,.5]},zb:function(){return[1,-1,.5]},J:function(b,c){I(b,{Wb:!0});b.buttons(a,c.c,{Pd:!0});Sd(b,c.c[2],0,!1,"black",1)},ga:function(b,c,d,e,f,g,h){b=Rd(a,d,e,f,g,h);return null!==b?(z(c),c.c[b]=(c.c[b]+2)%3-1,b):Td(0,!1,d,e,f,g,h)?(z(c),2):null},Ra:function(a,c,d,
e,f,g,h,m){2<=d&&(c.c[d]=Math.max(.25,Math.min(.75,Math.round(4*Ud(!1,e,f,g,h,m))/4)))},oc:function(a){return a.c[0]||a.c[1]?null:new za("No ground sensor specified",!0)},sc:function(a,c){switch(c){case "b":if(c=a.Z.ka(),a.c[2]===c[2])return c=new y(ra("ground"),null,null),c.c=a.c.slice(0,2),c;default:return a}},X:{aseba:function(b){for(var c="",d=0;2>d;d++)b.c[d]&&(c+=(0===c.length?"":" and ")+"prox.ground.delta["+a[d].w+"] "+(0<b.c[d]?">= ":"< ")+Math.round(1E3*b.c[2]));if(""===c){for(d=0;2>d;d++)c+=
" or prox.ground.delta["+a[d].w+"] >= 450";c=c.slice(4)}return{B:"onevent prox\n",I:c}}}}}()),new w({name:"tap",ta:["b","a"],type:"e",J:function(a){a.N.translate(.05*a.A.j,0);Fd(a);a.cb()},sc:function(a,b){switch(b){case "a":return new y(ra("accelerometer"),null,null);default:return a}},X:{aseba:function(){return{S:["var tapped\n"],C:["tapped = 0\n"],B:"onevent tap\n",bb:"tapped = 1\n",I:"tapped != 0"}}}}),new w(function(){var a=[{L:"c",x:-.33,y:-.3,r:0},{L:"c",x:0,y:-.3,r:0},{L:"c",x:.33,y:-.3,r:0}];
return{name:"accelerometer",ta:["c"],type:"e",ka:function(){return[0,0]},J:function(b,c){var d=c.c[0];c=c.c[1];0===d?(b.N.save(),b.N.translate(.08*b.A.j,-.2*b.A.j),Fd(b),b.cb(),b.N.restore()):Id(b,2===d,c);b.buttons(a,[0===d,1===d,2===d])},ga:function(b,c,d,e,f,g,h){if(0!==c.c[0]&&Jd(d,f,g,h))return z(c),1;b=Rd(a,d,e,f,g,h);return null!==b?(z(c),c.c[0]=b,2):null},Ra:function(a,c,d,e,f,g,h,m){1===d&&(c.c[1]=Kd(e,g,h,m))},sc:function(a,c){switch(c){case "b":if(0===a.c[0])return new y(ra("tap"),null,
null);default:return a}},X:{aseba:function(a){var b=a.c[0];if(0===b)return{S:["var tapped\n"],C:["tapped = 0\n"],B:"onevent tap\n",bb:"tapped = 1\n",I:"tapped != 0"};a=(2===b?-1:1)*a.c[1];var d=1===b?"roll":"pitch";return{S:["# "+d+" angle from accelerometer\nvar "+d+"Angle\n"],B:"onevent acc\n",R:"call math.atan2("+d+"Angle, acc["+(2===b?"1":"0")+"], acc[2])\n",I:-6>=a?d+"Angle < "+Math.round(2730.67*a+1365.33):6<=a?d+"Angle >= "+Math.round(2730.67*a-1365.33):d+"Angle >= "+Math.round(2730.67*a-1365.33)+
" and "+d+"Angle < "+Math.round(2730.67*a+1365.33)}}}}}()),new w({name:"roll",ta:["a"],type:"e",ka:function(){return[0]},zb:function(){return[2]},J:function(a,b){Id(a,!1,b.c[0])},ga:function(a,b,c,d,e,f,g){return Jd(c,e,f,g,!0)?(z(b),1):null},Ra:function(a,b,c,d,e,f,g,h){b.c[0]=Kd(d,f,g,h,!0)},X:{aseba:function(a){a=a.c[0];return{S:["# roll angle from accelerometer\nvar rollAngle\n"],B:"onevent acc\n",R:"call math.atan2(rollAngle, -acc[0], acc[2])\n",I:-12===a?"rollAngle >= 31403 or rollAngle < "+
Math.round(2730.67*a+1365.33):"rollAngle >= "+Math.round(2730.67*a-1365.33)+" and rollAngle < "+Math.round(2730.67*a+1365.33)}}}}),new w({name:"pitch",ta:["a"],type:"e",ka:function(){return[0]},zb:function(){return[2]},J:function(a,b){Id(a,!0,b.c[0])},ga:function(a,b,c,d,e,f,g){return Jd(c,e,f,g,!0)?(z(b),1):null},Ra:function(a,b,c,d,e,f,g,h){b.c[0]=Kd(d,f,g,h,!0)},X:{aseba:function(a){a=-a.c[0];return{S:["# pitch angle from accelerometer\nvar pitchAngle\n"],B:"onevent acc\n",R:"call math.atan2(pitchAngle, acc[1], acc[2])\n",
I:-12===a?"pitchAngle >= 31403 or pitchAngle < "+Math.round(2730.67*a+1365.33):"pitchAngle >= "+Math.round(2730.67*a-1365.33)+" and pitchAngle < "+Math.round(2730.67*a+1365.33)}}}}),new w({name:"yaw",ta:["a"],type:"e",ka:function(){return[0]},zb:function(){return[2]},J:function(a,b){var c=a.N,d=a.A;b=b.c[0]*Math.PI/12;c.save();c.translate(.5*d.j,.5*d.j);c.rotate(b);Hd(a);c.translate(-d.j/2,-d.j/2);I(a,{Wb:!0,scale:.45});c.restore()},ga:function(a,b,c,d,e,f,g){return Jd(c,e,f,g,!0)?(z(b),1):null},
Ra:function(a,b,c,d,e,f,g,h){b.c[0]=Kd(d,f,g,h,!0)},X:{aseba:function(a){a=-a.c[0];return{S:["# yaw angle from accelerometer\nvar yawAngle\n"],B:"onevent acc\n",R:"call math.atan2(yawAngle, acc[0], acc[1])\n",I:-12===a?"yawAngle >= 31403 or yawAngle < "+Math.round(2730.67*a+1365.33):"yawAngle >= "+Math.round(2730.67*a-1365.33)+" and yawAngle < "+Math.round(2730.67*a+1365.33)}}}}),new w({name:"clap",type:"e",J:function(a){var b=a.N;a=a.A;b.save();b.beginPath();b.arc(.7*a.j,.6*a.j,.15*a.j,0,2*Math.PI);
b.fillStyle="white";b.fill();b.beginPath();b.moveTo(.7*a.j,.6*a.j);b.lineTo(.8*a.j,.95*a.j);b.strokeStyle="white";b.lineWidth=.13*a.j;b.stroke();b.lineWidth=1.5*a.pa;b.translate(.3*a.j,.3*a.j);b.rotate(.1);for(var c=0;9>c;c++)b.beginPath(),b.moveTo(.07*a.j,0),b.lineTo(.14*a.j,0),b.moveTo(.17*a.j,0),b.lineTo(.22*a.j,0),b.stroke(),b.rotate(Math.PI/4.5);b.restore()},X:{aseba:function(){return{C:["# setup threshold for detecting claps\nmic.threshold = 250\n"],B:"onevent mic\n",I:"mic.intensity > mic.threshold",
Of:!0}}}}),new w({name:"init",ta:["b","a"],type:"e",J:function(a){var b=a.N;a=a.A;var c=.4*a.j;b.save();b.fillStyle="black";b.strokeStyle="black";b.lineWidth=a.pa;b.beginPath();b.arc(.3*a.j,.5*a.j,.08*a.j,0,2*Math.PI);b.fill();b.beginPath();b.moveTo(.42*a.j,.5*a.j);b.lineTo(.7*a.j,.5*a.j);b.stroke();c*=.4;b.beginPath();b.moveTo(.8*a.j,.5*a.j);b.lineTo(.8*a.j-c*Math.sqrt(3)/2,.5*a.j+c/2);b.lineTo(.8*a.j-c*Math.sqrt(3)/2,.5*a.j-c/2);b.fill();b.restore()},Yf:!0,X:{aseba:function(){return{B:"# initialization\n"}}}}),
new w({name:"timer",ta:["a"],type:"e",J:function(a){Md(a,0,!0,!1)},X:{aseba:function(){return{S:["var timerElapsed\n"],C:["# stop timer 0\ntimer.period[0] = 0\n","timerElapsed = 0\n"],B:"onevent timer0\n",bb:"timerElapsed = 1\ntimer.period[0] = 0\n",I:"timerElapsed"}}}}),new w({name:"state",ta:["a"],type:"s",ka:function(){return[0,0,0,0]},zb:function(){return[1,0,0,-1]},J:function(a,b){I(a);Pd(a,b.c)},ga:function(a,b,c,d,e,f,g){a=Yd(c,d,e,f,g);null!==a&&(z(b),b.c[a]=(b.c[a]+2)%3-1);return a},sc:function(a,
b){return"b"===b&&0===a.c[0]&&0===a.c[1]&&0===a.c[2]&&0===a.c[3]?null:a},X:{aseba:function(a){for(var b="",c=0;4>c;c++)a.c[c]&&(b+=(0===b.length?"":" and ")+"state["+c+"] == "+(0<a.c[c]?"1":"0"));return{S:["var state[4]\n"],C:["state = [0, 0, 0, 0]\n"],I:b}}}}),new w({name:"state 8",ta:["c"],type:"s",ka:function(){return[0]},J:function(a,b){I(a);Qd(a,b.c[0])},ga:function(a,b,c,d,e,f,g){a=Zd(c,d,e,f,g);null!==a&&(z(b),b.c[0]=a);return a},X:{aseba:function(a){return{S:["var state8\n"],C:["state8 = 0\n"],
I:"state8 == "+a.c[0].toString(10)}}}}),new w(function(){var a=[{L:"t",x:-.3,y:.3,r:0},{L:"t",x:-.3,y:-.3,r:Math.PI},{L:"t",x:.1,y:.3,r:0},{L:"t",x:.1,y:-.3,r:Math.PI},{L:"c",x:.35,y:-.3,r:0}];return{name:"counter comparison",ta:["a"],type:"s",ka:function(){return[0,0]},J:function(b,c){b.text(0===c.c[0]?"=":0<c.c[0]?"\u2265":"\u2264",{x:-.3*b.A.j,fillStyle:"black"});b.text(c.c[1].toString(10),{x:.1*b.A.j,fillStyle:"black"});b.buttons(a,[1>c.c[0]?-2:0,-1<c.c[0]?-2:0,255>c.c[1]?-2:0,0<c.c[1]?-2:0,0!==
c.c[1]?-2:0])},ga:function(b,c,d,e,f,g,h){b=Rd(a,d,e,f,g,h);if(null!==b)switch(z(c),b){case 0:c.c[0]=Math.min(1,c.c[0]+1);break;case 1:c.c[0]=Math.max(-1,c.c[0]-1);break;case 2:c.c[1]=Math.min(255,c.c[1]+1);break;case 3:c.c[1]=Math.max(0,c.c[1]-1);break;case 4:c.c[1]=0}return b},X:{aseba:function(a){return{S:["var counter\n"],C:["counter = 0\n"],I:"counter "+(0===a.c[0]?"==":0<a.c[0]?">=":"<=")+" "+a.c[1]}}}}}()),new w({name:"color state",ta:["c"],type:"s",ka:function(){return[0,0,0]},J:function(a,
b){I(a,{Kb:b.c});Sd(a,b.c[0],.3,!1,"red");Sd(a,b.c[1],0,!1,"#0c0");Sd(a,b.c[2],-.3,!1,"#08f")},ga:function(a,b,c,d,e,f,g){return Td(.3,!1,c,d,e,f,g)?(z(b),0):Td(0,!1,c,d,e,f,g)?(z(b),1):Td(-.3,!1,c,d,e,f,g)?(z(b),2):null},Ra:function(a,b,c,d,e,f,g,h){b.c[c]=Math.max(0,Math.min(1,Math.round(Ud(!1,d,e,f,g,h))))},X:{aseba:function(a){return{S:["var topColor[3]\n"],C:["topColor = [0, 0, 0]\n"],I:a.c.map(function(a,c){return"topColor["+c+"] / 11 == "+Math.floor(2.99*a)}).join(" and ")}}}}),new w(function(){var a=
[{L:"r",x:-.15,y:.3,size:1.4,w:"black",fillStyle:"#666",strokeStyle:"white"},{L:"r",x:-.3,y:0,size:1.4,w:"red",fillStyle:"red",strokeStyle:"white"},{L:"r",x:0,y:0,size:1.4,w:"green",fillStyle:"#0c0",strokeStyle:"white"},{L:"r",x:.3,y:0,size:1.4,w:"yellow",fillStyle:"yellow",strokeStyle:"silver"},{L:"r",x:-.3,y:-.3,size:1.4,w:"blue",fillStyle:"blue",strokeStyle:"white"},{L:"r",x:0,y:-.3,size:1.4,w:"magenta",fillStyle:"magenta",strokeStyle:"white"},{L:"r",x:.3,y:-.3,size:1.4,w:"cyan",fillStyle:"cyan",
strokeStyle:"white"},{L:"r",x:.15,y:.3,size:1.4,w:"white",fillStyle:"white",strokeStyle:"silver"}];return{name:"color 8 state",ta:["a"],type:"s",ka:function(){return[0]},J:function(b,c){I(b,{Kb:[c.c&1,(c.c&2)/2,(c.c&4)/4]});b.buttons(a,[1>c.c[0]?-2:0,-1<c.c[0]?-2:0])},ga:function(b,c,d,e,f,g,h){b=Rd(a,d,e,f,g,h);null!==b&&(z(c),c.c=[b]);return b},X:{aseba:function(a){return{S:["var topColor[3]\n"],C:["topColor = [0, 0, 0]\n"],I:"topColor[0] "+(a.c[0]%2?">=":"<")+" 16 and topColor[1] "+(2<=a.c[0]%
4?">=":"<")+" 16 and topColor[2] "+(4<=a.c[0]?">=":"<")+" 16"}}}}}()),new w({name:"motor state",ta:["c"],type:"s",ka:function(){return[0,0]},J:function(a,b){var c=Cd(a,2.4*b.c[0],2.4*b.c[1],.19);I(a,{Wb:!0,scale:.45,rotation:c.Ya,Ne:[.19*c.x*a.A.j+.13*a.A.j*Math.sin(c.Ya),.19*c.y*a.A.j+.13*a.A.j*Math.cos(c.Ya)]});a.N.save();a.N.globalAlpha=.2;Cd(a,2.4*b.c[0],2.4*b.c[1],.19);a.N.restore();Sd(a,.5+.5*b.c[0],-.4,!0,0===b.c[0]?"white":b.c[0]===b.c[1]?"#0c0":b.c[0]===-b.c[1]?"#f70":"#fd0");Sd(a,.5+.5*
b.c[1],.4,!0,0===b.c[1]?"white":b.c[0]===b.c[1]?"#0c0":b.c[0]===-b.c[1]?"#f70":"#fd0")},ga:function(a,b,c,d,e,f,g){return Td(-.4,!0,c,d,e,f,g)?(z(b),0):Td(.4,!0,c,d,e,f,g)?(z(b),1):Dd(a,c,e,f,.5*b.c[0],.5*b.c[1],g)?(z(b),2):null},Ra:function(a,b,c,d,e,f,g,h){2>c?(a=Ud(!0,d,e,f,g,h),b.c[c]=.25>a?-1:.75<a?1:0):(a=Ud(!0,d,e,f,g,h),a=.25>a?-1:.75<a?1:0,b.c[0]=a,b.c[1]=a)},X:{aseba:function(a){function b(a,b){return 0<b?"motor."+a+".target > 250":0>b?"motor."+a+".target < -250":"abs(motor."+a+".target) < 250"}
return{I:b("left",a.c[0])+" and "+b("right",a.c[1])}}}}),new w({name:"motor",type:"a",ka:function(){return[0,0]},zb:function(){return[.5,.2]},J:function(a,b){var c=Cd(a,2.4*b.c[0],2.4*b.c[1],.19);I(a,{Wb:!0,scale:.45,rotation:c.Ya,Ne:[.19*c.x*a.A.j+.13*a.A.j*Math.sin(c.Ya),.19*c.y*a.A.j+.13*a.A.j*Math.cos(c.Ya)]});a.N.save();a.N.globalAlpha=.2;Cd(a,2.4*b.c[0],2.4*b.c[1],.19);a.N.restore();Sd(a,.5+.5*b.c[0],-.4,!0,0===b.c[0]?"white":b.c[0]===b.c[1]?"#0c0":b.c[0]===-b.c[1]?"#f70":"#fd0");Sd(a,.5+.5*
b.c[1],.4,!0,0===b.c[1]?"white":b.c[0]===b.c[1]?"#0c0":b.c[0]===-b.c[1]?"#f70":"#fd0")},ga:function(a,b,c,d,e,f,g){return Td(-.4,!0,c,d,e,f,g)?(z(b),0):Td(.4,!0,c,d,e,f,g)?(z(b),1):Dd(a,c,e,f,.5*b.c[0],.5*b.c[1],g)?(z(b),2):null},Ra:function(a,b,c,d,e,f,g,h){2>c?(a=2*Ud(!0,d,e,f,g,h)-1,d=b.c[1-c],.1>Math.abs(a)?a=0:.1>Math.abs(a-d)?a=d:.1>Math.abs(a+d)&&(a=-d),b.c[c]=Math.max(-1,Math.min(1,a))):(a=2*Ud(!0,d,e,f,g,h)-1,a=.1>Math.abs(a)?0:Math.max(-1,Math.min(1,a)),.05>Math.abs(b.c[0]-b.c[1])?(b.c[0]=
a,b.c[1]=a):Math.abs(b.c[0])>Math.abs(b.c[1])?(b.c[1]*=a/b.c[0],b.c[0]=a):(b.c[0]*=a/b.c[1],b.c[1]=a))},X:{aseba:function(a){return{C:["call leds.top(0, 0, 0)\ncall leds.bottom.left(0, 0, 0)\ncall leds.bottom.right(0, 0, 0)\ncall leds.circle(0, 0, 0, 0, 0, 0, 0, 0)\n"],u:"motor.left.target = "+Math.round(500*a.c[0])+"\nmotor.right.target = "+Math.round(500*a.c[1])+"\n"}}}}),new w(function(){var a=[{L:"c",x:0,y:0,r:0},{L:"t",x:0,y:.35,r:0},{L:"t",x:0,y:-.35,r:Math.PI},{L:"t",x:-.3,y:.32,r:-.4},{L:"t",
x:.3,y:.32,r:.4},{L:"t",x:-.35,y:.05,r:-Math.PI/2},{L:"t",x:.35,y:.05,r:Math.PI/2}];return{name:"move",ta:["c"],type:"a",ka:function(){return[0]},J:function(b,c){I(b,{Wb:!0,scale:.45});b.buttons(a,[0===c.c[0]?1:-2,1===c.c[0]?1:-2,2===c.c[0]?1:-2,3===c.c[0]?1:-2,4===c.c[0]?1:-2,5===c.c[0]?1:-2,6===c.c[0]?1:-2])},ga:function(b,c,d,e,f,g,h){b=Rd(a,d,e,f,g,h);null!==b&&(z(c),c.c[0]=b);return b},X:{aseba:function(a){return{C:["call leds.top(0, 0, 0)\ncall leds.bottom.left(0, 0, 0)\ncall leds.bottom.right(0, 0, 0)\ncall leds.circle(0, 0, 0, 0, 0, 0, 0, 0)\n"],
u:"motor.left.target = "+[0,100,-100,75,125,-100,100][a.c[0]]+"\nmotor.right.target = "+[0,100,-100,125,75,100,-100][a.c[0]]+"\n"}}}}}()),new w({name:"top color",ta:["a"],type:"a",ka:function(){return[0,0,0]},J:function(a,b){I(a,{Kb:b.c});Sd(a,b.c[0],.3,!1,"red");Sd(a,b.c[1],0,!1,"#0c0");Sd(a,b.c[2],-.3,!1,"#08f")},ga:function(a,b,c,d,e,f,g){return Td(.3,!1,c,d,e,f,g)?(z(b),0):Td(0,!1,c,d,e,f,g)?(z(b),1):Td(-.3,!1,c,d,e,f,g)?(z(b),2):null},Ra:function(a,b,c,d,e,f,g,h){b.c[c]=Math.max(0,Math.min(1,
Ud(!1,d,e,f,g,h)))},X:{aseba:function(a){return{S:["var topColor[3]\n"],C:["topColor = [0, 0, 0]\n","call leds.top(0, 0, 0)\ncall leds.bottom.left(0, 0, 0)\ncall leds.bottom.right(0, 0, 0)\ncall leds.circle(0, 0, 0, 0, 0, 0, 0, 0)\n"],u:"call leds.top("+a.c.map(function(a){return Math.round(32*a)}).join(", ")+")\ntopColor = ["+a.c.map(function(a){return Math.round(32*a)}).join(", ")+"]\n",Ob:"call leds.top("+a.c.map(function(a){return Math.round(32*a)}).join(", ")+")\n"}}}}),new w(function(){var a=
[{L:"r",x:-.15,y:.3,size:1.4,w:"black",fillStyle:"#666",strokeStyle:"white"},{L:"r",x:-.3,y:0,size:1.4,w:"red",fillStyle:"red",strokeStyle:"white"},{L:"r",x:0,y:0,size:1.4,w:"green",fillStyle:"#0c0",strokeStyle:"white"},{L:"r",x:.3,y:0,size:1.4,w:"yellow",fillStyle:"yellow",strokeStyle:"silver"},{L:"r",x:-.3,y:-.3,size:1.4,w:"blue",fillStyle:"blue",strokeStyle:"white"},{L:"r",x:0,y:-.3,size:1.4,w:"magenta",fillStyle:"magenta",strokeStyle:"white"},{L:"r",x:.3,y:-.3,size:1.4,w:"cyan",fillStyle:"cyan",
strokeStyle:"white"},{L:"r",x:.15,y:.3,size:1.4,w:"white",fillStyle:"white",strokeStyle:"silver"}];return{name:"top color 8",ta:["b"],type:"a",ka:function(){return[0]},J:function(b,c){I(b,{Kb:[c.c&1,(c.c&2)/2,(c.c&4)/4]});b.buttons(a,[1>c.c[0]?-2:0,-1<c.c[0]?-2:0])},ga:function(b,c,d,e,f,g,h){b=Rd(a,d,e,f,g,h);null!==b&&(z(c),c.c=[b]);return b},X:{aseba:function(a){a=[32*(a.c&1),16*(a.c&2),8*(a.c&4)].join(", ");return{S:["var topColor[3]\n"],C:["topColor = [0, 0, 0]\n","call leds.top(0, 0, 0)\ncall leds.bottom.left(0, 0, 0)\ncall leds.bottom.right(0, 0, 0)\ncall leds.circle(0, 0, 0, 0, 0, 0, 0, 0)\n"],
u:"call leds.top("+a+")\ntopColor = ["+a+"]\n",Ob:"call leds.top("+a+")\n"}}}}}()),new w({name:"bottom color",ta:["a"],type:"a",ka:function(){return[0,0,0]},J:function(a,b){I(a,{Wb:!0,Kb:b.c});Sd(a,b.c[0],.3,!1,"red");Sd(a,b.c[1],0,!1,"#0c0");Sd(a,b.c[2],-.3,!1,"#08f")},ga:function(a,b,c,d,e,f,g){return Td(.3,!1,c,d,e,f,g)?(z(b),0):Td(0,!1,c,d,e,f,g)?(z(b),1):Td(-.3,!1,c,d,e,f,g)?(z(b),2):null},Ra:function(a,b,c,d,e,f,g,h){b.c[c]=Math.max(0,Math.min(1,Ud(!1,d,e,f,g,h)))},X:{aseba:function(a){return{C:["call leds.top(0, 0, 0)\ncall leds.bottom.left(0, 0, 0)\ncall leds.bottom.right(0, 0, 0)\ncall leds.circle(0, 0, 0, 0, 0, 0, 0, 0)\n"],
u:"call leds.bottom.left("+a.c.map(function(a){return Math.round(32*a)}).join(", ")+")\ncall leds.bottom.right("+a.c.map(function(a){return Math.round(32*a)}).join(", ")+")\n"}}}}),new w({name:"bottom-left color",ta:["c"],type:"a",ka:function(){return[0,0,0]},J:function(a,b){I(a,{Wb:!0,Kb:b.c,oe:"left"});Sd(a,b.c[0],.3,!1,"red");Sd(a,b.c[1],0,!1,"#0c0");Sd(a,b.c[2],-.3,!1,"#08f")},ga:function(a,b,c,d,e,f,g){return Td(.3,!1,c,d,e,f,g)?(z(b),0):Td(0,!1,c,d,e,f,g)?(z(b),1):Td(-.3,!1,c,d,e,f,g)?(z(b),
2):null},Ra:function(a,b,c,d,e,f,g,h){b.c[c]=Math.max(0,Math.min(1,Ud(!1,d,e,f,g,h)))},X:{aseba:function(a){return{C:["call leds.top(0, 0, 0)\ncall leds.bottom.left(0, 0, 0)\ncall leds.bottom.right(0, 0, 0)\ncall leds.circle(0, 0, 0, 0, 0, 0, 0, 0)\n"],u:"call leds.bottom.left("+a.c.map(function(a){return Math.round(32*a)}).join(", ")+")\n"}}}}),new w({name:"bottom-right color",ta:["c"],type:"a",ka:function(){return[0,0,0]},J:function(a,b){I(a,{Wb:!0,Kb:b.c,oe:"right"});Sd(a,b.c[0],.3,!1,"red");Sd(a,
b.c[1],0,!1,"#0c0");Sd(a,b.c[2],-.3,!1,"#08f")},ga:function(a,b,c,d,e,f,g){return Td(.3,!1,c,d,e,f,g)?(z(b),0):Td(0,!1,c,d,e,f,g)?(z(b),1):Td(-.3,!1,c,d,e,f,g)?(z(b),2):null},Ra:function(a,b,c,d,e,f,g,h){b.c[c]=Math.max(0,Math.min(1,Ud(!1,d,e,f,g,h)))},X:{aseba:function(a){return{C:["call leds.top(0, 0, 0)\ncall leds.bottom.left(0, 0, 0)\ncall leds.bottom.right(0, 0, 0)\ncall leds.circle(0, 0, 0, 0, 0, 0, 0, 0)\n"],u:"call leds.bottom.right("+a.c.map(function(a){return Math.round(32*a)}).join(", ")+
")\n"}}}}),new w(function(){var a=[{L:"r",x:-.15,y:.3,size:1.4,w:"black",fillStyle:"#666",strokeStyle:"white"},{L:"r",x:-.3,y:0,size:1.4,w:"red",fillStyle:"red",strokeStyle:"white"},{L:"r",x:0,y:0,size:1.4,w:"green",fillStyle:"#0c0",strokeStyle:"white"},{L:"r",x:.3,y:0,size:1.4,w:"yellow",fillStyle:"yellow",strokeStyle:"silver"},{L:"r",x:-.3,y:-.3,size:1.4,w:"blue",fillStyle:"blue",strokeStyle:"white"},{L:"r",x:0,y:-.3,size:1.4,w:"magenta",fillStyle:"magenta",strokeStyle:"white"},{L:"r",x:.3,y:-.3,
size:1.4,w:"cyan",fillStyle:"cyan",strokeStyle:"white"},{L:"r",x:.15,y:.3,size:1.4,w:"white",fillStyle:"white",strokeStyle:"silver"}];return{name:"bottom color 8",ta:["b"],type:"a",ka:function(){return[0]},J:function(b,c){I(b,{Wb:!0,Kb:[c.c&1,(c.c&2)/2,(c.c&4)/4]});b.buttons(a,[1>c.c[0]?-2:0,-1<c.c[0]?-2:0])},ga:function(b,c,d,e,f,g,h){b=Rd(a,d,e,f,g,h);null!==b&&(z(c),c.c=[b]);return b},X:{aseba:function(a){a=[32*(a.c&1),16*(a.c&2),8*(a.c&4)].join(", ");return{C:["call leds.top(0, 0, 0)\ncall leds.bottom.left(0, 0, 0)\ncall leds.bottom.right(0, 0, 0)\ncall leds.circle(0, 0, 0, 0, 0, 0, 0, 0)\n"],
u:"call leds.bottom.left("+a+")\ncall leds.bottom.right("+a+")\n"}}}}}()),new w(function(){var a=[{L:"r",x:-.15,y:.3,size:1.4,w:"black",fillStyle:"#666",strokeStyle:"white"},{L:"r",x:-.3,y:0,size:1.4,w:"red",fillStyle:"red",strokeStyle:"white"},{L:"r",x:0,y:0,size:1.4,w:"green",fillStyle:"#0c0",strokeStyle:"white"},{L:"r",x:.3,y:0,size:1.4,w:"yellow",fillStyle:"yellow",strokeStyle:"silver"},{L:"r",x:-.3,y:-.3,size:1.4,w:"blue",fillStyle:"blue",strokeStyle:"white"},{L:"r",x:0,y:-.3,size:1.4,w:"magenta",
fillStyle:"magenta",strokeStyle:"white"},{L:"r",x:.3,y:-.3,size:1.4,w:"cyan",fillStyle:"cyan",strokeStyle:"white"},{L:"r",x:.15,y:.3,size:1.4,w:"white",fillStyle:"white",strokeStyle:"silver"}];return{name:"bottom-left color 8",ta:["c"],type:"a",ka:function(){return[0]},J:function(b,c){I(b,{Wb:!0,Kb:[c.c&1,(c.c&2)/2,(c.c&4)/4],oe:"left"});b.buttons(a,[1>c.c[0]?-2:0,-1<c.c[0]?-2:0])},ga:function(b,c,d,e,f,g,h){b=Rd(a,d,e,f,g,h);null!==b&&(z(c),c.c=[b]);return b},X:{aseba:function(a){return{C:["call leds.top(0, 0, 0)\ncall leds.bottom.left(0, 0, 0)\ncall leds.bottom.right(0, 0, 0)\ncall leds.circle(0, 0, 0, 0, 0, 0, 0, 0)\n"],
u:"call leds.bottom.left("+[32*(a.c&1),16*(a.c&2),8*(a.c&4)].join(", ")+")\n"}}}}}()),new w(function(){var a=[{L:"r",x:-.15,y:.3,size:1.4,w:"black",fillStyle:"#666",strokeStyle:"white"},{L:"r",x:-.3,y:0,size:1.4,w:"red",fillStyle:"red",strokeStyle:"white"},{L:"r",x:0,y:0,size:1.4,w:"green",fillStyle:"#0c0",strokeStyle:"white"},{L:"r",x:.3,y:0,size:1.4,w:"yellow",fillStyle:"yellow",strokeStyle:"silver"},{L:"r",x:-.3,y:-.3,size:1.4,w:"blue",fillStyle:"blue",strokeStyle:"white"},{L:"r",x:0,y:-.3,size:1.4,
w:"magenta",fillStyle:"magenta",strokeStyle:"white"},{L:"r",x:.3,y:-.3,size:1.4,w:"cyan",fillStyle:"cyan",strokeStyle:"white"},{L:"r",x:.15,y:.3,size:1.4,w:"white",fillStyle:"white",strokeStyle:"silver"}];return{name:"bottom-right color 8",ta:["c"],type:"a",ka:function(){return[0]},J:function(b,c){I(b,{Wb:!0,Kb:[c.c&1,(c.c&2)/2,(c.c&4)/4],oe:"right"});b.buttons(a,[1>c.c[0]?-2:0,-1<c.c[0]?-2:0])},ga:function(b,c,d,e,f,g,h){b=Rd(a,d,e,f,g,h);null!==b&&(z(c),c.c=[b]);return b},X:{aseba:function(a){return{C:["call leds.top(0, 0, 0)\ncall leds.bottom.left(0, 0, 0)\ncall leds.bottom.right(0, 0, 0)\ncall leds.circle(0, 0, 0, 0, 0, 0, 0, 0)\n"],
u:"call leds.bottom.right("+[32*(a.c&1),16*(a.c&2),8*(a.c&4)].join(", ")+")\n"}}}}}()),new w({name:"notes",type:"a",ka:function(){return[0,1,1,1,2,1,0,1,2,1,4,2]},J:function(a,b){a.Pb(b.c)},ga:function(a,b,c,d,e,f,g){return(a=Vd(.1,.9,.9,.1,6,5,c,d,e,f,g))?(z(b),b.c[2*a.index]===a.tone?b.c[2*a.index+1]=(b.c[2*a.index+1]+1)%3:(b.c[2*a.index]=a.tone,b.c[2*a.index+1]=1),0):null},X:{aseba:function(a){for(var b=[],c=[],d=0;6>d;d++)0<a.c[2*d+1]?(b.push([262,311,370,440,524,370][a.c[2*d]]),c.push(7*a.c[2*
d+1])):(b.push(0),c.push(28));return{S:["# variables for notes\nvar notes[6]\nvar durations[6]\nvar note_index\nvar note_count\nvar wave[142]\nvar i\nvar wave_phase\nvar wave_intensity\n"],C:["# init. variables for notes\nnote_index = 6\nnote_count = 6\n","# compute a sinus wave for sound\nfor i in 0 : 141 do\nwave_phase = (i - 70) * 468\ncall math.cos(wave_intensity, wave_phase)\nwave[i] = wave_intensity / 256\nend\ncall sound.wave(wave)\n","call sound.system(-1)\n"],Xa:["# when a note is finished, play the next one\nonevent sound.finished\nif note_index != note_count then\ncall sound.freq(notes[note_index], durations[note_index])\nnote_index++\nend\n"],
u:"notes = ["+b.join(", ")+"]\ndurations = ["+c.join(", ")+"]\nnote_index = 1\nnote_count = 6\ncall sound.freq(notes[0], durations[0])\n"}}}}),new w({name:"set state",ta:["a"],type:"a",ka:function(){return[0,0,0,0]},zb:function(){return[0,1,-1,0]},J:function(a,b){I(a);Pd(a,b.c)},ga:function(a,b,c,d,e,f,g){a=Yd(c,d,e,f,g);null!==a&&(z(b),b.c[a]=(b.c[a]+2)%3-1);return a},X:{aseba:function(a){for(var b="",c=0;4>c;c++)a.c[c]&&(b+="state["+c+"] = "+(0<a.c[c]?"1":"0")+"\n");return{S:["var state[4]\n"],
C:["state = [0, 0, 0, 0]\n"],Xa:["sub display_state\ncall leds.circle(0,state[1]*32,0,state[3]*32,0,state[2]*32,0,state[0]*32)\n"],u:0<b.length?b+"callsub display_state\n":"",Ob:"call leds.circle(0,"+(a.c[1]?"32":"0")+",0,"+(a.c[3]?"32":"0")+",0,"+(a.c[2]?"32":"0")+",0,"+(a.c[0]?"32":"0")+")\n"}}}}),new w({name:"toggle state",ta:["c"],type:"a",ka:function(){return[!1,!1,!1,!1]},J:function(a,b){I(a);Pd(a,b.c.map(function(a){return a?2:0}));hc(a.N,a.A.j/2,a.A.j/2,.2*a.A.j,-1.4,1.4,{style:"black",lineWidth:a.A.pa,
Fc:5*a.A.pa});hc(a.N,a.A.j/2,a.A.j/2,.2*a.A.j,Math.PI-1.4,Math.PI+1.4,{style:"black",lineWidth:a.A.pa,Fc:5*a.A.pa})},ga:function(a,b,c,d,e,f,g){a=Yd(c,d,e,f,g);null!==a&&(z(b),b.c[a]=!b.c[a]);return a},X:{aseba:function(a){for(var b="",c=0;4>c;c++)a.c[c]&&(b+="state["+c+"] = 1 - state["+c+"]\n");return{S:["var state[4]\n"],C:["state = [0, 0, 0, 0]\n"],Xa:["sub display_state\ncall leds.circle(0,state[1]*32,0,state[3]*32,0,state[2]*32,0,state[0]*32)\n"],u:0<b.length?b+"callsub display_state\n":"",Ob:"call leds.circle(0,"+
(a.c[1]?"32":"0")+",0,"+(a.c[3]?"32":"0")+",0,"+(a.c[2]?"32":"0")+",0,"+(a.c[0]?"32":"0")+")\n"}}}}),new w({name:"set state 8",ta:["c"],type:"a",ka:function(){return[0]},J:function(a,b){I(a);Qd(a,b.c[0])},ga:function(a,b,c,d,e,f,g){a=Zd(c,d,e,f,g);null!==a&&(z(b),b.c[0]=a);return a},X:{aseba:function(a){return{S:["var state8\n"],C:["state8 = 0\n"],Xa:["sub display_state8\ncall leds.circle((state8==0)*32, (state8==1)*32, (state8==2)*32, (state8==3)*32, (state8==4)*32, (state8==5)*32, (state8==6)*32, (state8==7)*32)\n"],
u:"state8 = "+a.c[0].toString(10)+"\ncallsub display_state8\n",Ob:"call leds.circle("+(0===a.c[0]?"32":"0")+","+(1===a.c[0]?"32":"0")+","+(2===a.c[0]?"32":"0")+","+(3===a.c[0]?"32":"0")+","+(4===a.c[0]?"32":"0")+","+(5===a.c[0]?"32":"0")+","+(6===a.c[0]?"32":"0")+","+(7===a.c[0]?"32":"0")+")\n"}}}}),new w(function(){var a=[{L:"c",x:-.2,y:0},{L:"c",x:.2,y:0}];return{name:"change state 8",ta:["c"],type:"a",ka:function(){return[1]},J:function(b,c){I(b);var d=b.N;d.save();for(var e=0;8>e;e++)Od(b,Math.PI*
(.46-.25*e),Math.PI*(.54-.25*e),0);d.restore();hc(b.N,b.A.j/2,b.A.j/2,.375*b.A.j,-.8,.8,{style:"black",lineWidth:b.A.pa,Fc:5*b.A.pa});hc(b.N,b.A.j/2,b.A.j/2,.375*b.A.j,Math.PI-.8,Math.PI+.8,{od:!0,style:"black",lineWidth:b.A.pa,Fc:5*b.A.pa});b.buttons(a,[0>c.c[0],0<c.c[0]])},ga:function(b,c,d,e,f,g,h){b=Rd(a,d,e,f,g,h);null!==b&&(z(c),c.c[0]=0===b?-1:1);return b},X:{aseba:function(a){return{S:["var state8\n"],C:["state8 = 0\n"],Xa:["sub display_state8\ncall leds.circle((state8==0)*32, (state8==1)*32, (state8==2)*32, (state8==3)*32, (state8==4)*32, (state8==5)*32, (state8==6)*32, (state8==7)*32)\n"],
u:"state8 = (state8 + "+(0<a.c[0]?"1":"7")+") % 8\ncallsub display_state8\n",Ob:"call leds.circle("+(0===a.c[0]?"32":"0")+","+(1===a.c[0]?"32":"0")+","+(2===a.c[0]?"32":"0")+","+(3===a.c[0]?"32":"0")+","+(4===a.c[0]?"32":"0")+","+(5===a.c[0]?"32":"0")+","+(6===a.c[0]?"32":"0")+","+(7===a.c[0]?"32":"0")+")\n"}}}}}()),new w(function(){var a=[{L:"t",x:0,y:.3,r:0},{L:"t",x:0,y:-.3,r:Math.PI}];return{name:"set counter",ta:["a"],type:"a",ka:function(){return[0]},J:function(b,c){b.text(0===c.c[0]?"= 0":
0<c.c[0]?"+1":"\u22121");b.buttons(a,[1>c.c[0]?-2:0,-1<c.c[0]?-2:0])},ga:function(b,c,d,e,f,g,h){b=Rd(a,d,e,f,g,h);if(null!==b)switch(z(c),b){case 0:c.c[0]=Math.min(1,c.c[0]+1);break;case 1:c.c[0]=Math.max(-1,c.c[0]-1)}return b},X:{aseba:function(a){return{S:["var counter\n"],C:["counter = 0\n"],Xa:["sub display_counter\ncall leds.circle((counter&1)<<5,(counter&2)<<4,(counter&4)<<3,(counter&8)<<2,(counter&16)<<1,counter&32,(counter&64)>>1,(counter&128)>>2)\n"],u:(0===a.c[0]?"counter = 0":0<a.c[0]?
"if counter < 255 then\ncounter++\nend":"if counter > 0 then\ncounter--\nend")+"\ncallsub display_counter\n",Ob:"call leds.circle("+(0<a.c[0]?"1":"0")+",0,0,0,0,0,0,0)\n"}}}}}()),new w({name:"set timer",ta:["a"],type:"a",ka:function(){return[1]},J:function(a,b){Md(a,b.c[0],!1,!1)},ga:function(a,b,c,d,e,f,g){return Wd(c,d,e,f,g)?(z(b),1):null},Ra:function(a,b,c,d,e,f,g,h){b.c[0]=Xd(d,e,f,g,!1,h)},X:{aseba:function(a){return{S:["var timerElapsed\n"],C:["# stop timer 0\ntimer.period[0] = 0\n","timerElapsed = 0\n"],
u:"timer.period[0] = "+Math.round(1E3*a.c[0])+"\ntimerElapsed = 0\n"}}}}),new w({name:"set timer log",ta:["c"],type:"a",ka:function(){return[1]},J:function(a,b){Md(a,b.c[0],!1,!0)},ga:function(a,b,c,d,e,f,g){return Wd(c,d,e,f,g)?(z(b),1):null},Ra:function(a,b,c,d,e,f,g,h){b.c[0]=Xd(d,e,f,g,!0,h)},X:{aseba:function(a){return{S:["var timerElapsed\n"],C:["# stop timer 0\ntimer.period[0] = 0\n","timerElapsed = 0\n"],u:"timer.period[0] = "+Math.round(1E3*a.c[0])+"\ntimerElapsed = 0\n"}}}}),new w(function(){function a(a,
b){if(a.c[1]){var c=new Image;c.src=a.c[1];c.addEventListener("load",function(){a.c[2]=c;b&&b()},!1)}}var b=[{L:"c",x:-.33,y:-.3,r:0}];return{name:"picture comment",ta:["a"],type:"c",ka:function(){return[!1,"",null]},Be:function(a){return 2<=a.c.length?[!1,a.c[1]]:[!1,""]},Td:function(b,d,e){b.c=2<=d.length?[!1,d[1]]:[!1,""];a(b,e)},J:function(a,d){d.c[2]&&a.N.drawImage(d.c[2],0,0,240,240,0,0,a.A.j,a.A.j);a.buttons(b,[d.c[0]])},ga:function(c,d,e,f,g,h,m){e=Rd(b,e,f,g,h,m);0===e&&(d.c[0]?aa&&(aa.pause&&
aa.pause(),ba.getTracks().forEach(function(a){a.stop()}),aa=null):(z(d),navigator.mediaDevices.getUserMedia({audio:!1,video:{width:320,height:240}}).then(function(b){ba=b;aa=document.createElement("video");aa.srcObject=b;aa.addEventListener("loadedmetadata",function(){aa.play();var b=setInterval(function(){aa?(da||(da=document.createElement("canvas"),da.width=240,da.height=240),da.getContext("2d").drawImage(aa,0,0,240,240,0,0,240,240),d.c[1]=da.toDataURL("image/png"),a(d,function(){c.na&&c.na();C(c)})):
clearInterval(b)},100)},!1)})),d.c[0]=!d.c[0]);return e},X:{aseba:function(){return{}}}}}())];function $d(a){this.ca=new DOMParser;this.b=this.ca.parseFromString(a,"text/xml");this.h=this.b.documentElement;this.Fa=(this.h.getAttribute("viewBox")||"0 0 1 1").split(" ").map(function(a){return parseFloat(a)});this.F={}}
var ae={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgreen:"#006400",
darkgrey:"#A9A9A9",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",
ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",green:"#008000",greenyellow:"#ADFF2F",grey:"#808080",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgreen:"#90EE90",lightgrey:"#D3D3D3",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",
lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",
moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",
seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"};function be(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}function ce(a){var b={};be(b,a);return b}
function de(a,b){b.split(";").forEach(function(b){b=b.trim().split(":").map(function(a){return a.trim()});2===b.length&&(a[b[0]]=b[1])})}
function ee(a,b,c,d,e){a&&(a=a.replace(/\s*\(\s*/g,"(").replace(/\s*\)\s*/g,")").replace(/ +,/g,",").replace(/, +/g,",").replace(/ +/g,","),a.split(")").slice(0,-1).forEach(function(a){var f=a.split("(")[0];a=a.split("(")[1].split(",").map(function(a){return parseFloat(a)});switch(f){case "translate":b(a[0]||0,a[1]||0);break;case "rotate":f=(a[0]||0)*Math.PI/180;var h=a[1]||0;a=a[2]||0;0!==h||0!==a?(b(-h,-a),c(f),b(h,a)):c(f);break;case "scale":f=a[0]||1;d(f,a[1]||f);break;case "matrix":e(a[0],a[1],
a[2],a[3],a[4],a[5]);break;default:throw"transform not implemented: "+f;}}))}function fe(a,b){ee(a,function(a,d){b.translate(a,d)},function(a){b.rotate(a)},function(a,d){b.scale(a,d)},function(a,d,e,f,g,h){b.ke(a,d,e,f,g,h)})}
$d.prototype.J=function(a,b){function c(e,l,p){function J(){for(var a=0;a<e.childElementCount;a++)c(e.children[a],l,p)}function t(a,b){a=e.getAttribute(a);return null===a?b||0:parseFloat(a)}function D(a,b){a=n.apply(new ge(a,b));k.push(a.x);q.push(a.y)}function A(a,b,c){if(null==a||""==a)return b;a=/^\s*(-?[0-9.]+)\s*([a-z%]*)\s*$/i.exec(a);b=parseFloat(a[1]);switch(a[2]||"px"){case "pt":return 25.4*b/72*3;case "pc":return 25.4*b/6*3;case "in":return 25.4*b*3;case "mm":return 3*b;case "cm":return 30*
b;case "em":return 18*b;case "ex":return 9*b;case "%":return b*c/100;default:return b}}function u(c){c=c.replace(/\.([0-9]+)(?=\.)/g,".$1 ").replace(/([.0-9])-/g,"$1 -").replace(/\s*([a-z])\s*/gi,";$1").replace(/\s*,\s*/g,",").replace(/\s+/g,",");var e=0,f=0,g=0,h=0,l=[],m=[],n=!0;a&&a.beginPath();c.slice(1).split(";").forEach(function(c){var p=c[0];c=1<c.length?c.slice(1).split(",").map(function(a){return parseFloat(a)}):[];switch(p){case "M":if(2<=c.length){e=c[0];f=c[1];a&&a.moveTo(e,f);D(e,f);
n&&1<l.length&&b&&b.wa&&b.wa.line&&b.wa.line(l,m,!1);n=!0;l=k.slice(-1);m=q.slice(-1);for(p=2;p+1<c.length;p+=2)e=c[p],f=c[p+1],a&&a.lineTo(e,f),D(e,f),l.push(k[k.length-1]),m.push(q[q.length-1]);g=e;h=f}break;case "m":if(2<=c.length)for(e+=c[0],f+=c[1],a&&a.moveTo(e,f),D(e,f),n&&1<l.length&&b&&b.wa&&b.wa.line&&b.wa.line(l,m,!1),n=!0,l=k.slice(-1),m=q.slice(-1),p=2;p+1<c.length;p+=2)e+=c[p],f+=c[p+1],a&&a.lineTo(e,f),D(e,f),l.push(k[k.length-1]),m.push(q[q.length-1]);g=e;h=f;break;case "L":for(p=
0;p+1<c.length;p+=2)e=c[p],f=c[p+1],a&&a.lineTo(e,f),D(e,f),l.push(k[k.length-1]),m.push(q[q.length-1]);g=e;h=f;break;case "l":for(p=0;p+1<c.length;p+=2)e+=c[p],f+=c[p+1],a&&a.lineTo(e,f),D(e,f),l.push(k[k.length-1]),m.push(q[q.length-1]);g=e;h=f;break;case "H":for(p=0;p<c.length;p++)e=c[p],a&&a.lineTo(e,f),D(e,f),l.push(k[k.length-1]),m.push(q[q.length-1]);g=e;h=f;break;case "h":for(p=0;p<c.length;p++)e+=c[p],a&&a.lineTo(e,f),D(e,f),l.push(k[k.length-1]),m.push(q[q.length-1]);g=e;h=f;break;case "V":for(p=
0;p<c.length;p++)f=c[p],a&&a.lineTo(e,f),D(e,f),l.push(k[k.length-1]),m.push(q[q.length-1]);g=e;h=f;break;case "v":for(p=0;p<c.length;p++)f+=c[p],a&&a.lineTo(e,f),D(e,f),l.push(k[k.length-1]),m.push(q[q.length-1]);g=e;h=f;break;case "A":for(p=0;p+6<c.length;p+=7){var t=c[p+5],J=c[p+6],H=d(c[p],c[p+1],c[p+2]*Math.PI/180,0!=c[p+3],0==c[p+4],e,f,t,J);e=t;f=J;D(H.x,H.y);D(e,f);n=!1}g=e;h=f;break;case "a":for(p=0;p+6<c.length;p+=7)t=e+c[p+5],J=f+c[p+6],H=d(c[p],c[p+1],c[p+2]*Math.PI/180,0!=c[p+3],0==c[p+
4],e,f,t,J),e=t,f=J,D(H.x,H.y),D(e,f),n=!1;g=e;h=f;break;case "C":for(p=0;p+5<c.length;p+=6)a&&a.bezierCurveTo(c[p],c[p+1],c[p+2],c[p+3],c[p+4],c[p+5]),e=c[p+4],f=c[p+5],g=2*e-c[p+2],h=2*f-c[p+3],D(e,f),n=!1;break;case "c":for(p=0;p+5<c.length;p+=6)a&&a.bezierCurveTo(e+c[p],f+c[p+1],e+c[p+2],f+c[p+3],e+c[p+4],f+c[p+5]),g=e+2*c[p+4]-c[p+2],h=f+2*c[p+5]-c[p+3],e+=c[p+4],f+=c[p+5],D(e,f),n=!1;break;case "S":for(p=0;p+3<c.length;p+=4)a&&a.bezierCurveTo(g,h,c[p],c[p+1],c[p+2],c[p+3]),e=c[p+2],f=c[p+3],
g=2*e-c[p],h=2*f-c[p+1],D(e,f),n=!1;break;case "s":for(p=0;p+3<c.length;p+=4)a&&a.bezierCurveTo(g,h,e+c[p],f+c[p+1],e+c[p+2],f+c[p+3]),g=e-c[p],h=f-c[p+1],e+=c[p+2],f+=c[p+3],D(e,f),n=!1;break;case "Q":for(p=0;p+3<c.length;p+=4)a&&a.quadraticCurveTo(c[p],c[p+1],c[p+2],c[p+3]),e=c[p+2],f=c[p+3],g=2*e-c[p],h=2*f-c[p+1],D(e,f),n=!1;break;case "q":for(p=0;p+3<c.length;p+=4)a&&a.quadraticCurveTo(e+c[p],f+c[p+1],e+c[p+2],f+c[p+3]),g=e+2*c[p+2]-c[p],h=f+2*c[p+3]-c[p+1],e+=c[p+2],f+=c[p+3],D(e,f),n=!1;break;
case "T":for(p=0;p+1<c.length;p+=2)a&&a.quadraticCurveTo(g,h,c[p],c[p+1]),e=c[p],f=c[p+1],g=2*e-g,h=2*f-h,D(e,f),n=!1;break;case "t":for(p=0;p+1<c.length;p+=2)a&&a.quadraticCurveTo(g,h,e+c[p],f+c[p+1]),e+=c[p],f+=c[p+1],g=2*e-g,h=2*f-h,D(e,f),n=!1;break;case "Z":case "z":a&&a.closePath();n&&1<l.length&&b&&b.wa&&b.wa.line&&b.wa.line(l,m,!0);n=!0;l=[];m=[];break;default:throw"unimplemented path command: "+p;}});n&&1<l.length&&b&&b.wa&&b.wa.line&&b.wa.line(l,m,!1)}function B(b){function c(a,b){if(0<
b.length){a.splice(0,a.length);for(var c=0;c<b.length&&1>c;c++){var d=(b[c].getAttribute("offset")||"0").trim(),e=/%$/.test(d)?parseFloat(d.slice(0,-1))/100:parseFloat(d),f=b[c].getAttribute("style");d={};f&&de(d,f);isNaN(e)||(f=b[c].getAttribute("stop-color")||d["stop-color"]||"#000",ae.hasOwnProperty(f)&&(f=ae[f]),d=(b[c].getAttribute("stop-opacity")||d["stop-opacity"]||"1").trim(),d=/%$/.test(d)?parseFloat(d.slice(0,-1))/100:parseFloat(d),1!==d&&(/^#[0-9a-f]{3}$/i.test(f)?f="rgba("+f.slice(1).split("").map(function(a){return 17*
parseInt(a,16)}).map(function(a){return a.toString(10)}).join(",")+","+d.toFixed(2)+")":/^#[0-9a-f]{6}$/i.test(f)?f="rgba("+[f.slice(1,3),f.slice(3,5),f.slice(5)].map(function(a){return parseInt(a,16)}).map(function(a){return a.toString(10)}).join(",")+","+d.toFixed(2)+")":/^rgb(\d+%?(,|\s+)\d+%?(,|\s+)\d+%?)$/i.test(f)?f=f.slice(0,-1).replace(/\s+/g,",")+","+d.toFixed(2)+")":/^hsl(\d+%?(,|\s+)\d+%?(,|\s+)\d+%?)$/i.test(f)&&(f=f.slice(0,-1).replace(/\s+/g,",")+","+d.toFixed(2)+")")),a.push({offset:e,
color:f}))}}}function d(a,b){if(a.attributes["xlink:href"]){var e=a.getAttribute("xlink:href");"#"===e[0]&&(e=m.b.getElementById(e.slice(1)))&&(b=d(e,b))}b.Uc=a.attributes.x1?parseFloat(a.getAttribute("x1")):b.Uc||0;b.Wc=a.attributes.y1?parseFloat(a.getAttribute("y1")):b.Wc||0;b.Vc=a.attributes.x2?parseFloat(a.getAttribute("x2")):b.Vc||0;b.Xc=a.attributes.y2?parseFloat(a.getAttribute("y2")):b.Xc||0;b.kc=a.attributes.gradientUnits?a.getAttribute("gradientUnits"):b.kc||"objectBoundingBox";b.Hb=a.attributes.gradientTransform?
a.getAttribute("gradientTransform"):b.Hb||"";b.eb=b.eb||[];c(b.eb,a.getElementsByTagName("stop"));return b}function e(a,b){if(a.attributes["xlink:href"]){var d=a.getAttribute("xlink:href");"#"===d[0]&&(d=m.b.getElementById(d.slice(1)))&&(b=e(d,b))}b.gc=a.attributes.cx?parseFloat(a.getAttribute("cx")):b.gc||0;b.hc=a.attributes.cy?parseFloat(a.getAttribute("cy")):b.hc||0;b.r=a.attributes.r?parseFloat(a.getAttribute("r")):b.r||0;b.kc=a.attributes.gradientUnits?a.getAttribute("gradientUnits"):b.kc||"objectBoundingBox";
b.Hb=a.attributes.gradientTransform?a.getAttribute("gradientTransform"):b.Hb||"";b.eb=b.eb||[];c(b.eb,a.getElementsByTagName("stop"));return b}var f=/^url\(#(.+)\)$/.exec(b);if(f&&f[1]&&(f=m.b.getElementById(f[1])))switch(f.tagName){case "linearGradient":b=d(f,{});if("objectBoundingBox"===b.kc)throw"objectBoundingBox not supported";if(b.Hb)throw f=new he,fe(b.Hb,f),"gradientTransform not supported";var g=a.createLinearGradient(b.Uc,b.Wc,b.Vc,b.Xc);for(f=0;f<b.eb.length;f++)g.addColorStop(b.eb[f].offset,
b.eb[f].color);return g;case "radialGradient":b=e(f,{});if("objectBoundingBox"===b.kc)throw"objectBoundingBox not supported";b.Hb&&(f=new he,fe(b.Hb,f),g=ie(f,{x:b.gc,y:b.hc}),f=b.r/Math.sqrt(Math.abs(f.b[0]*f.b[4])),b.gc=g.x,b.hc=g.y,b.r=f);g=a.createRadialGradient(b.gc,b.hc,0,b.gc,b.hc,b.r);for(f=0;f<b.eb.length;f++)g.addColorStop(b.eb[f].offset,b.eb[f].color);return g}return b}function N(b,c,d,e,f,g){0>=f||0>=g?a.rect(b,c,d,e):(f=Math.min((f+g)/2,Math.min(d,e)/2),a.moveTo(b+d-f,c),a.arc(b+d-f,
c+f,f,1.5*Math.PI,2*Math.PI),a.lineTo(b+d,c+e-f),a.arc(b+d-f,c+e-f,f,0,.5*Math.PI),a.lineTo(b+f,c+e),a.arc(b+f,c+e-f,f,.5*Math.PI,Math.PI),a.lineTo(b,c+f),a.arc(b+f,c+f,f,Math.PI,1.5*Math.PI),a.closePath())}function T(){if(a){var b=(l||"")+";"+(p||""),c={};b&&de(c,b);"hidden"!==c.visibility&&(c.opacity&&(a.globalAlpha*=parseFloat(c.opacity)),c.fill&&"none"===c.fill||(a.fillStyle="white"===c.fill||"#fff"===c.fill||"#ffffff"===c.fill?"white":B(c.fill)||"none",a.fill()),c.stroke&&"none"!==c.stroke&&
(a.lineWidth=A(c["stroke-width"]||"1px",1,100),a.strokeStyle=c.stroke||"none",a.miterLimit=c["stroke-miterlimit"]||4,a.lineJoin=c["stroke-linejoin"]||"miter",a.lineCap=c["stroke-linecap"]||"butt",c["stroke-dasharray"]&&(a.setLineDash(c["stroke-dasharray"].split(" ").map(function(a){return parseFloat(a)})),a.lineDashOffset=c["stroke-dashoffset"]?parseFloat(c["stroke-dashoffset"]):0),a.stroke()))}}function W(c,d,e){if(a){var f=(l||"")+";"+(p||""),g={};f&&de(g,f);"hidden"!==g.visibility&&(a.font=(g["font-size"]||
"12px")+" "+(g["font-family"]||"helvetica"),g.fill&&"none"!==g.fill&&(a.fillStyle="white"===g.fill||"#fff"===g.fill||"#ffffff"===g.fill?"white":b&&b.fill||"silver",a.fillText(c,d,e)),g.stroke&&"none"!==g.stroke&&(a.strokeStyle=b&&b.stroke||"black",a.strokeText(c,d,e)))}}function Ac(b,c){b=je({x:b,y:c});a.save();a.strokeStyle="black";a.lineWidth=1;a.strokeRect(b.Y,b.aa,b.oa-b.Y,b.ma-b.aa);a.restore()}var x=e.getAttribute("id"),ob=x&&b&&b.$c&&b.$c[x];x=x&&b&&b.xe&&b.xe[x];a&&a.save();n.save();ob&&a&&
f(e,ob);x&&a&&g(e,x);(function(){var a=(b&&b.Qf||"")+";"+(e.getAttribute("style")||""),c=e.getAttribute("class");c&&r.hasOwnProperty(c)&&(a=r[c]+";"+a);l=(l||"")+";"+a;(a=e.getAttribute("stroke-dasharray"))&&(l+=";stroke-dasharray:"+a.split(",").join(" "));(a=e.getAttribute("stroke-dashoffset"))&&(l+=";stroke-dashoffset:"+a);(a=e.getAttribute("id"))&&b&&b.style&&b.style.hasOwnProperty(a)&&(p=(p||"")+";"+b.style[a])})();ob=k.length;switch(e.tagName){case "svg":n.save();h(e.getAttribute("transform"));
J();n.restore();break;case "g":n.save();h(e.getAttribute("transform"));J();n.restore();break;case "path":a&&a.save();n.save();h(e.getAttribute("transform"));u(e.getAttribute("d")||"");T();a&&a.restore();n.restore();break;case "line":x=t("x1");var H=t("y1"),P=t("x2"),ca=t("y2");a&&a.save();n.save();h(e.getAttribute("transform"));a&&a.beginPath();a&&a.moveTo(x,H);a&&a.lineTo(P,ca);T();D(x,H);D(P,ca);b&&b.wa&&b.wa.line&&b.wa.line([x,P],[H,ca],!1);a&&a.restore();n.restore();break;case "polygon":case "polyline":x=
e.getAttribute("points").trim().replace(/\s+/g," ").split(" ").map(function(a){return parseFloat(a)});if(4<=x.length){a&&a.save();n.save();h(e.getAttribute("transform"));a&&a.beginPath();a&&a.moveTo(x[0],x[1]);D(x[0],x[1]);for(H=2;H+1<x.length;H+=2)a&&a.lineTo(x[H],x[H+1]),D(x[H],x[H+1]);"polygon"===e.tagName&&a.closePath();T();b&&b.wa&&b.wa.line&&b.wa.line(k.slice(-x.length/2),q.slice(-x.length/2),"polygon"===e.tagName);a&&a.restore();n.restore()}break;case "circle":x=t("cx");H=t("cy");P=t("r");
a&&a.save();n.save();h(e.getAttribute("transform"));a&&a.beginPath();a&&a.arc(x,H,P,0,2*Math.PI);T();D(x-P,H-P);D(x-P,H+P);D(x+P,H-P);D(x+P,H+P);b&&b.wa&&b.wa.we&&(x=k.slice(-4),H=q.slice(-4),P=(x[3]-x[0])*(x[3]-x[0])+(H[3]-H[0])*(H[3]-H[0]),ca=(x[2]-x[1])*(x[2]-x[1])+(H[2]-H[1])*(H[2]-H[1]),.001>Math.abs(P-ca)/(P+ca)&&.001>((x[3]-x[0])*(x[2]-x[1])+(H[3]-H[0])*(H[2]-H[1]))/P&&b.wa.we((x[0]+x[2])/2,(H[0]+H[2])/2,Math.sqrt(P/8)));a&&a.restore();n.restore();break;case "rect":x=t("x");H=t("y");P=t("width");
ca=t("height");var Ed=t("rx"),pe=t("ry",Ed);Ed=t("rx",pe);a&&a.save();n.save();h(e.getAttribute("transform"));a&&(a.beginPath(),0<Ed||0<pe?N(x,H,P,ca,Ed,pe):a.rect(x,H,P,ca));T();D(x,H);D(x,H+ca);D(x+P,H);D(x+P,H+ca);a&&a.restore();n.restore();break;case "text":x=t("x"),H=t("y"),a&&a.save(),n.save(),h(e.getAttribute("transform")),W(e.textContent,x,H),D(x,H),a&&a.restore(),n.restore()}a&&a.restore();n.restore();a&&b&&b.Pf&&Ac(k.slice(ob),q.slice(ob))}function d(b,c,d,e,f,g,h,l,m){if(0===b||0===c)return a&&
a.lineTo(l,m),new ge(l,m);var k=Math.cos(d),p=Math.sin(d),n=(k*g+p*h)/b;h=(-p*g+k*h)/c;g=(k*l+p*m)/b;l=(-p*l+k*m)/c;m=(g-n)/2;k=(l-h)/2;p=m*m+k*k;p=Math.sqrt((1-p)/p);isNaN(p)?p=0:e===f&&(p=-p);e=(n+g)/2+p*k;m=(h+l)/2-p*m;n=Math.atan2((h-m)/b,(n-e)/c);h=Math.atan2((l-m)/b,(g-e)/c);a&&(a.rotate(d),a.scale(b,c),f?a.arc(e,m,1,n,h,!0):a.arc(e,m,1,n,h),a.scale(1/b,1/c),a.rotate(-d));g=new he;g.rotate(d);g.scale(b,c);b=f?n<h?(n+h)/2+Math.PI:(n+h)/2:n<h?(n+h)/2:(n+h)/2+Math.PI;return g.apply(new ge(e+Math.cos(b),
m+Math.sin(b)))}function e(a){switch(a.tagName){case "svg":case "defs":for(var b=0;b<a.childElementCount;b++)e(a.children[b]);break;case "style":l+=a.textContent}}function f(b,c){if(c.Ya&&0!=c.Ya){var d=c.Fd,e=c.Gd;if(void 0==d||void 0==e)d=m.J(null,{element:b}),b=je(d),d=(b.Y+b.oa)/2,e=(b.aa+b.ma)/2;a.translate(d+(c.Cb||0),e+(c.Db||0));a.rotate(c.Ya);a.translate(-d,-e)}else(c.Cb||c.Db)&&a.translate(c.Cb,c.Db)}function g(b,c){a.beginPath();a.rect(c.x,c.y,c.Bc,c.tc);a.clip()}function h(b){ee(b,function(b,
c){a&&a.translate(b,c);n.translate(b,c)},function(b){a&&a.rotate(b);n.rotate(b)},function(b,c){a&&a.scale(b,c);n.scale(b,c)},function(b,c,d,e,f,g){a&&a.transform(b,c,d,e,f,g);n.ke(b,c,d,e,f,g)})}var m=this,l="",r={},n=new ke,k=[],q=[];e(this.h);(function(){l.split("}").forEach(function(a){var b=a.split("{");b[0].split(",").forEach(function(a){a=a.trim();/^\.[-a-z0-9]+/i.test(a)&&(a=a.slice(1),r[a]=r[a]?r[a]+";"+b[1]:b[1])})})})();var p=this.h;b&&b.rd?p=this.b.getElementById(b.rd):b&&b.element&&(p=
b.element);if(p){b&&b.Ee&&b.Ee(a,this.Fa);if(a){for(var u=[],t=p.parentElement;null!=t;t=t.parentElement)u.push(t);for(t=u.length-1;0<=t;t--){var B=u[t].getAttribute("id");(B=B&&b&&b.$c&&b.$c[B])&&f(u[t],B);B=u[t].getAttribute("transform");h(B)}}c(p)}return{x:k,y:q}};
function je(a){if(0===a.x.length)return{Y:0,oa:0,aa:0,ma:0};for(var b=a.x[0],c=a.x[0],d=a.y[0],e=a.y[0],f=1;f<a.x.length;f++)b=Math.min(b,a.x[f]),c=Math.max(c,a.x[f]),d=Math.min(d,a.y[f]),e=Math.max(e,a.y[f]);return{Y:b,oa:c,aa:d,ma:e}}function le(a,b){if(a.F[b])return a.F[b];var c=a.J(null,{rd:b});c=je(c);return a.F[b]=c}$d.prototype.cd=function(a,b,c){a=le(this,a);return b>=a.Y&&b<=a.oa&&c>=a.aa&&c<=a.ma};$d.prototype.$b=function(a){return null!=this.b.getElementById(a)};
$d.prototype.ff=function(a,b){a=this.b.getElementById(a);b=this.b.getElementById(b);return null!=b&&null!=a&&b.contains(a)};function me(a){$d.call(this,a);this.m={};this.P={};this.o={};ne(this)}me.prototype=Object.create($d.prototype);me.prototype.constructor=me;
function ne(a){function b(a){switch(a.tagName){case "svg":case "defs":for(var c=0;c<a.childElementCount;c++)b(a.children[c]);break;case "style":f+=a.textContent}}function c(a){return a?(a=a.replace(/\s*\(\s*/g,"(").replace(/\s*\)\s*/g,")").replace(/ +,/g,",").replace(/, +/g,",").replace(/ +/g,","),a.split(")").slice(0,-1).map(function(a){var b=a.split("(")[0];a=a.split("(")[1].split(",").map(function(a){return parseFloat(a)});switch(b){case "translate":return{Wa:b,D:[a[0]||0,a[1]||0]};case "rotate":return{Wa:b,
D:[(a[0]||0)*Math.PI/180,a[1]||0,a[2]||0]};case "scale":var c=a[0]||1;return{Wa:b,D:[c,a[1]||c]};case "matrix":return{Wa:b,D:a};default:throw"transform not implemented: "+b;}})):null}function d(a,b){function f(b){for(var c=[],e=0;e<a.childElementCount;e++){var f=d(a.children[e],b);f&&c.push(f)}return c}function g(b,c){b=a.getAttribute(b);return null===b?c||0:parseFloat(b)}function h(a){a=a.replace(/\.([0-9]+)(?=\.)/g,".$1 ").replace(/([.0-9])-/g,"$1 -").replace(/\s*([a-z])\s*/gi,";$1").replace(/\s*,\s*/g,
",").replace(/\s+/g,",");var b=[],c=0,d=0,e=0,f=0;a.slice(1).split(";").forEach(function(a){var g=a[0];a=1<a.length?a.slice(1).split(",").map(function(a){return parseFloat(a)}):[];switch(g){case "M":if(2<=a.length){c=a[0];d=a[1];b.push({Wa:"M",D:[c,d]});for(g=2;g+1<a.length;g+=2)c=a[g],d=a[g+1],b.push({Wa:"L",D:[c,d]});e=c;f=d}break;case "m":if(2<=a.length)for(c+=a[0],d+=a[1],b.push({Wa:"M",D:[c,d]}),g=2;g+1<a.length;g+=2)c+=a[g],d+=a[g+1],b.push({Wa:"L",D:[c,d]});e=c;f=d;break;case "L":for(g=0;g+
1<a.length;g+=2)c=a[g],d=a[g+1],b.push({Wa:"L",D:[c,d]});e=c;f=d;break;case "l":for(g=0;g+1<a.length;g+=2)c+=a[g],d+=a[g+1],b.push({Wa:"L",D:[c,d]});e=c;f=d;break;case "H":for(g=0;g<a.length;g++)c=a[g],b.push({Wa:"L",D:[c,d]});e=c;f=d;break;case "h":for(g=0;g<a.length;g++)c+=a[g],b.push({Wa:"L",D:[c,d]});e=c;f=d;break;case "V":for(g=0;g<a.length;g++)d=a[g],b.push({Wa:"L",D:[c,d]});e=c;f=d;break;case "v":for(g=0;g<a.length;g++)d+=a[g],b.push({Wa:"L",D:[c,d]});e=c;f=d;break;case "A":for(g=0;g+6<a.length;g+=
7){var h=a[g+5],l=a[g+6];b.push({Wa:"A",D:[a[g],a[g+1],a[g+2]*Math.PI/180,0!=a[g+3]?1:0,0==a[g+4]?1:0,c,d,h,l]});c=h;d=l}e=c;f=d;break;case "a":for(g=0;g+6<a.length;g+=7)h=c+a[g+5],l=d+a[g+6],b.push({Wa:"A",D:[a[g],a[g+1],a[g+2]*Math.PI/180,0!=a[g+3],0==a[g+4],c,d,h,l]}),c=h,d=l;e=c;f=d;break;case "C":for(g=0;g+5<a.length;g+=6)b.push({Wa:"C",D:a.slice(g,g+6)}),c=a[g+4],d=a[g+5],e=2*c-a[g+2],f=2*d-a[g+3];break;case "c":for(g=0;g+5<a.length;g+=6)b.push({Wa:"C",D:[c+a[g],d+a[g+1],c+a[g+2],d+a[g+3],c+
a[g+4],d+a[g+5]]}),e=c+2*a[g+4]-a[g+2],f=d+2*a[g+5]-a[g+3],c+=a[g+4],d+=a[g+5];break;case "S":for(g=0;g+3<a.length;g+=4)b.push({Wa:"S",D:[e,f,a[g],a[g+1],a[g+2],a[g+3]]}),c=a[g+2],d=a[g+3],e=2*c-a[g],f=2*d-a[g+1];break;case "s":for(g=0;g+3<a.length;g+=4)b.push({Wa:"S",D:[e,f,c+a[g],d+a[g+1],c+a[g+2],d+a[g+3]]}),e=c-a[g],f=d-a[g+1],c+=a[g+2],d+=a[g+3];break;case "Q":for(g=0;g+3<a.length;g+=4)b.push({Wa:"Q",D:[a[g],a[g+1],a[g+2],a[g+3]]}),c=a[g+2],d=a[g+3],e=2*c-a[g],f=2*d-a[g+1];break;case "q":for(g=
0;g+3<a.length;g+=4)b.push({Wa:"Q",D:[c+a[g],d+a[g+1],c+a[g+2],d+a[g+3]]}),e=c+2*a[g+2]-a[g],f=d+2*a[g+3]-a[g+1],c+=a[g+2],d+=a[g+3];break;case "T":for(g=0;g+1<a.length;g+=2)b.push({Wa:"Q",D:[e,f,a[g],a[g+1]]}),c=a[g],d=a[g+1],e=2*c-e,f=2*d-f;break;case "t":for(g=0;g+1<a.length;g+=2)b.push({Wa:"Q",D:[e,f,c+a[g],d+a[g+1]]}),c+=a[g],d+=a[g+1],e=2*c-e,f=2*d-f;break;case "Z":case "z":b.push({Wa:"Z",D:[]});break;default:throw"unimplemented path command: "+g;}});return b}var n=a.getAttribute("id"),k=function(){var b=
a.getAttribute("style")||"",c=a.getAttribute("class");c&&e.o.hasOwnProperty(c)&&(b=e.o[c]+";"+b);c={};de(c,b);(b=a.getAttribute("stroke-dasharray"))&&(c["stroke-dasharray"]=b.split(","));(b=a.getAttribute("stroke-dashoffset"))&&(c["stroke-dashoffset"]=b);(b=a.getAttribute("id"))&&(c.id=b);return c}();b={name:a.tagName,id:n,style:k,parent:b};switch(a.tagName){case "svg":b.children=f(b);break;case "g":b.children=f(b);b.transform=c(a.getAttribute("transform"));break;case "path":b.path=h(a.getAttribute("d")||
"");b.transform=c(a.getAttribute("transform"));break;case "line":b.Uc=g("x1");b.Wc=g("y1");b.Vc=g("x2");b.Xc=g("y2");b.transform=c(a.getAttribute("transform"));break;case "polygon":case "polyline":b.ac=a.getAttribute("points").trim().replace(/\s+/g," ").split(" ").map(function(a){return parseFloat(a)});b.transform=c(a.getAttribute("transform"));break;case "circle":b.x=g("cx");b.y=g("cy");b.r=g("r");b.transform=c(a.getAttribute("transform"));break;case "rect":b.x=g("x");b.y=g("y");b.width=g("width");
b.height=g("height");n=g("rx");k=g("ry",n);n=g("rx",k);b.ig=n;b.jg=k;b.transform=c(a.getAttribute("transform"));break;case "text":b.x=g("x");b.y=g("y");b.text=a.textContent;b.transform=c(a.getAttribute("transform"));break;default:return null}return b}var e=a,f="";b(a.h);a.o=function(){var a={};f.split("}").forEach(function(b){var c=b.split("{");c[0].split(",").forEach(function(b){b=b.trim();/^\.[-a-z0-9]+/i.test(b)&&(b=b.slice(1),a[b]=a[b]?a[b]+";"+c[1]:c[1])})});return a}();a.h&&(a.m=d(a.h,null))}
function oe(a,b){function c(a,b){if(a.id===b)return a;if(a.children)for(var d=0;d<a.children.length;d++){var e=c(a.children[d],b);if(e)return e}return null}if(a.P[b])return a.P[b];var d=c(a.m,b);d&&(a.P[b]=d);return d}
function qe(a,b,c,d,e){a&&a.forEach(function(a){switch(a.Wa){case "translate":b(a.D[0],a.D[1]);break;case "rotate":0!==a.D[1]||0!==a.D[2]?(b(-a.D[1],-a.D[2]),c(a.D[0]),b(a.D[1],a.D[2])):c(a.D[0]);break;case "scale":d(a.D[0],a.D[1]);break;case "matrix":e(a.D[0],a.D[1],a.D[2],a.D[3],a.D[4],a.D[5])}})}
me.prototype.J=function(a,b){function c(k,n,q){function p(){for(var a=0;a<k.children.length;a++)c(k.children[a],n,q)}function r(a,b){a=h.apply(new ge(a,b));m.push(a.x);l.push(a.y)}function t(a,b,c){if(null==a||""==a)return b;a=/^\s*(-?[0-9.]+)\s*([a-z%]*)\s*$/i.exec(a);b=parseFloat(a[1]);switch(a[2]||"px"){case "pt":return 25.4*b/72*3;case "pc":return 25.4*b/6*3;case "in":return 25.4*b*3;case "mm":return 3*b;case "cm":return 30*b;case "em":return 18*b;case "ex":return 9*b;case "%":return b*c/100;
default:return b}}function u(c){var d=0,e=0,f=[],g=[],h=!0;a&&a.beginPath();c.forEach(function(c){switch(c.Wa){case "M":2<=c.D.length&&(d=c.D[0],e=c.D[1],a&&a.moveTo(d,e),r(d,e),h&&1<f.length&&b&&b.wa&&b.wa.line&&b.wa.line(f,g,!1),h=!0,f=m.slice(-1),g=l.slice(-1));break;case "L":d=c.D[0];e=c.D[1];a&&a.lineTo(d,e);r(d,e);f.push(m[m.length-1]);g.push(l[l.length-1]);break;case "A":var k=c.D[5],n=c.D[6];var p=c.D[0];var q=c.D[1],H=c.D[2],t=0!=c.D[3],x=0!=c.D[4],A=c.D[5],u=c.D[6],J=c.D[7],ca=c.D[8];if(0===
p||0===q)a&&a.lineTo(J,ca),p=new ge(J,ca);else{var P=Math.cos(H),D=Math.sin(H);c=(P*A+D*u)/p;u=(-D*A+P*u)/q;A=(P*J+D*ca)/p;J=(-D*J+P*ca)/q;ca=(A-c)/2;P=(J-u)/2;D=ca*ca+P*P;D=Math.sqrt((1-D)/D);isNaN(D)?D=0:t===x&&(D=-D);t=(c+A)/2+D*P;ca=(u+J)/2-D*ca;c=Math.atan2((u-ca)/p,(c-t)/q);u=Math.atan2((J-ca)/p,(A-t)/q);a&&(a.rotate(H),a.scale(p,q),x?a.arc(t,ca,1,c,u,!0):a.arc(t,ca,1,c,u),a.scale(1/p,1/q),a.rotate(-H));A=new he;A.rotate(H);A.scale(p,q);p=x?c<u?(c+u)/2+Math.PI:(c+u)/2:c<u?(c+u)/2:(c+u)/2+Math.PI;
p=A.apply(new ge(t+Math.cos(p),ca+Math.sin(p)))}d=k;e=n;r(p.x,p.y);r(d,e);h=!1;break;case "C":a&&a.bezierCurveTo(c.D[0],c.D[1],c.D[2],c.D[3],c.D[4],c.D[5]);d=c.D[4];e=c.D[5];r(d,e);h=!1;break;case "S":a&&a.bezierCurveTo(c.D[0],c.D[1],c.D[2],c.D[3],c.D[4],c.D[5]);d=c.D[4];e=c.D[5];r(d,e);h=!1;break;case "Q":a&&a.quadraticCurveTo(c.D[0],c.D[1],c.D[2],c.D[3]);d=c.D[2];e=c.D[3];r(d,e);h=!1;break;case "Z":a&&a.closePath(),h&&1<f.length&&b&&b.wa&&b.wa.line&&b.wa.line(f,g,!0),h=!0,f=[],g=[]}});h&&1<f.length&&
b&&b.wa&&b.wa.line&&b.wa.line(f,g,!1)}function fb(b){function c(a,b){if(0<b.length){a.splice(0,a.length);for(var c=0;c<b.length&&1>c;c++){var d=(b[c].getAttribute("offset")||"0").trim(),e=/%$/.test(d)?parseFloat(d.slice(0,-1))/100:parseFloat(d),f=b[c].getAttribute("style");d={};f&&de(d,f);isNaN(e)||(f=b[c].getAttribute("stop-color")||d["stop-color"]||"#000",ae.hasOwnProperty(f)&&(f=ae[f]),d=(b[c].getAttribute("stop-opacity")||d["stop-opacity"]||"1").trim(),d=/%$/.test(d)?parseFloat(d.slice(0,-1))/
100:parseFloat(d),1!==d&&(/^#[0-9a-f]{3}$/i.test(f)?f="rgba("+f.slice(1).split("").map(function(a){return 17*parseInt(a,16)}).map(function(a){return a.toString(10)}).join(",")+","+d.toFixed(2)+")":/^#[0-9a-f]{6}$/i.test(f)?f="rgba("+[f.slice(1,3),f.slice(3,5),f.slice(5)].map(function(a){return parseInt(a,16)}).map(function(a){return a.toString(10)}).join(",")+","+d.toFixed(2)+")":/^rgb(\d+%?(,|\s+)\d+%?(,|\s+)\d+%?)$/i.test(f)?f=f.slice(0,-1).replace(/\s+/g,",")+","+d.toFixed(2)+")":/^hsl(\d+%?(,|\s+)\d+%?(,|\s+)\d+%?)$/i.test(f)&&
(f=f.slice(0,-1).replace(/\s+/g,",")+","+d.toFixed(2)+")")),a.push({offset:e,color:f}))}}}function d(a,b){if(a.attributes["xlink:href"]){var e=a.getAttribute("xlink:href");"#"===e[0]&&(e=g.b.getElementById(e.slice(1)))&&(b=d(e,b))}b.Uc=a.attributes.x1?parseFloat(a.getAttribute("x1")):b.Uc||0;b.Wc=a.attributes.y1?parseFloat(a.getAttribute("y1")):b.Wc||0;b.Vc=a.attributes.x2?parseFloat(a.getAttribute("x2")):b.Vc||0;b.Xc=a.attributes.y2?parseFloat(a.getAttribute("y2")):b.Xc||0;b.kc=a.attributes.gradientUnits?
a.getAttribute("gradientUnits"):b.kc||"objectBoundingBox";b.Hb=a.attributes.gradientTransform?a.getAttribute("gradientTransform"):b.Hb||"";b.eb=b.eb||[];c(b.eb,a.getElementsByTagName("stop"));return b}function e(a,b){if(a.attributes["xlink:href"]){var d=a.getAttribute("xlink:href");"#"===d[0]&&(d=g.b.getElementById(d.slice(1)))&&(b=e(d,b))}b.gc=a.attributes.cx?parseFloat(a.getAttribute("cx")):b.gc||0;b.hc=a.attributes.cy?parseFloat(a.getAttribute("cy")):b.hc||0;b.r=a.attributes.r?parseFloat(a.getAttribute("r")):
b.r||0;b.kc=a.attributes.gradientUnits?a.getAttribute("gradientUnits"):b.kc||"objectBoundingBox";b.Hb=a.attributes.gradientTransform?a.getAttribute("gradientTransform"):b.Hb||"";b.eb=b.eb||[];c(b.eb,a.getElementsByTagName("stop"));return b}var f=/^url\(#(.+)\)$/.exec(b);if(f&&f[1]&&(f=g.b.getElementById(f[1])))switch(f.tagName){case "linearGradient":b=d(f,{});if("objectBoundingBox"===b.kc)throw"objectBoundingBox not supported";if(b.Hb)throw f=new he,fe(b.Hb,f),"gradientTransform not supported";var h=
a.createLinearGradient(b.Uc,b.Wc,b.Vc,b.Xc);for(f=0;f<b.eb.length;f++)h.addColorStop(b.eb[f].offset,b.eb[f].color);return h;case "radialGradient":b=e(f,{});if("objectBoundingBox"===b.kc)throw"objectBoundingBox not supported";b.Hb&&(f=new he,fe(b.Hb,f),h=ie(f,{x:b.gc,y:b.hc}),f=b.r/Math.sqrt(Math.abs(f.b[0]*f.b[4])),b.gc=h.x,b.hc=h.y,b.r=f);h=a.createRadialGradient(b.gc,b.hc,0,b.gc,b.hc,b.r);for(f=0;f<b.eb.length;f++)h.addColorStop(b.eb[f].offset,b.eb[f].color);return h}return b}function gb(b,c,d,
e,f,g){0>=f||0>=g?a.rect(b,c,d,e):(f=Math.min((f+g)/2,Math.min(d,e)/2),a.moveTo(b+d-f,c),a.arc(b+d-f,c+f,f,1.5*Math.PI,2*Math.PI),a.lineTo(b+d,c+e-f),a.arc(b+d-f,c+e-f,f,0,.5*Math.PI),a.lineTo(b+f,c+e),a.arc(b+f,c+e-f,f,.5*Math.PI,Math.PI),a.lineTo(b,c+f),a.arc(b+f,c+f,f,Math.PI,1.5*Math.PI),a.closePath())}function ta(){if(a){var b={};n&&be(b,n);q&&be(b,q);"hidden"!==b.visibility&&(b.opacity&&(a.globalAlpha*=parseFloat(b.opacity)),b.fill&&"none"===b.fill||(a.fillStyle="white"===b.fill||"#fff"===b.fill||
"#ffffff"===b.fill?"white":fb(b.fill)||"none",a.fill()),b.stroke&&"none"!==b.stroke&&(a.lineWidth=t(b["stroke-width"]||"1px",1,100),a.strokeStyle=b.stroke||"none",a.miterLimit=b["stroke-miterlimit"]||4,a.lineJoin=b["stroke-linejoin"]||"miter",a.lineCap=b["stroke-linecap"]||"butt",b["stroke-dasharray"]&&(a.setLineDash(b["stroke-dasharray"].split(" ").map(function(a){return parseFloat(a)})),a.lineDashOffset=b["stroke-dashoffset"]?parseFloat(b["stroke-dashoffset"]):0),a.stroke()))}}function qa(c,d,e){if(a){var f=
{};n&&be(f,n);q&&be(f,q);"hidden"!==f.visibility&&(a.font=(f["font-size"]||"12px")+" "+(f["font-family"]||"helvetica"),f.fill&&"none"!==f.fill&&(a.fillStyle="white"===f.fill||"#fff"===f.fill||"#ffffff"===f.fill?"white":b&&b.fill||"silver",a.fillText(c,d,e)),f.stroke&&"none"!==f.stroke&&(a.strokeStyle=b&&b.stroke||"black",a.strokeText(c,d,e)))}}function Ka(b,c){b=je({x:b,y:c});a.save();a.strokeStyle="black";a.lineWidth=1;a.strokeRect(b.Y,b.aa,b.oa-b.Y,b.ma-b.aa);a.restore()}var La=k.id&&b&&b.$c&&b.$c[k.id],
N=k.id&&b&&b.xe&&b.xe[k.id];a&&a.save();h.save();La&&a&&d(k,La);N&&a&&e(N);n=ce(n);q=ce(q);k.style&&be(n,k.style);b&&b.Qf&&de(n,b.Qf);k.id&&b&&b.style&&b.style.hasOwnProperty(k.id)&&de(q,b.style[k.id]);La=m.length;switch(k.name){case "svg":h.save();f(k.transform);p();h.restore();break;case "g":h.save();f(k.transform);p();h.restore();break;case "path":a&&a.save();h.save();f(k.transform);u(k.path);ta();a&&a.restore();h.restore();break;case "line":a&&a.save();h.save();f(k.transform);a&&a.beginPath();
a&&a.moveTo(k.Uc,k.Wc);a&&a.lineTo(k.Vc,k.Xc);ta();r(k.Uc,k.Wc);r(k.Vc,k.Xc);b&&b.wa&&b.wa.line&&b.wa.line([k.Uc,k.Vc],[k.Wc,k.Xc],!1);a&&a.restore();h.restore();break;case "polygon":case "polyline":if(4<=k.ac.length){a&&a.save();h.save();f(k.transform);a&&a.beginPath();a&&a.moveTo(k.ac[0],k.ac[1]);r(k.ac[0],k.ac[1]);for(N=2;N+1<k.ac.length;N+=2)a&&a.lineTo(k.ac[N],k.ac[N+1]),r(k.ac[N],k.ac[N+1]);"polygon"===k.name&&a&&a.closePath();ta();b&&b.wa&&b.wa.line&&b.wa.line(m.slice(-k.ac.length/2),l.slice(-k.ac.length/
2),"polygon"===k.name);a&&a.restore();h.restore()}break;case "circle":a&&a.save();h.save();f(k.transform);a&&a.beginPath();a&&a.arc(k.x,k.y,k.r,0,2*Math.PI);ta();r(k.x-k.r,k.y-k.r);r(k.x-k.r,k.y+k.r);r(k.x+k.r,k.y-k.r);r(k.x+k.r,k.y+k.r);if(b&&b.wa&&b.wa.we){N=m.slice(-4);var T=l.slice(-4),W=(N[3]-N[0])*(N[3]-N[0])+(T[3]-T[0])*(T[3]-T[0]),Ac=(N[2]-N[1])*(N[2]-N[1])+(T[2]-T[1])*(T[2]-T[1]);.001>Math.abs(W-Ac)/(W+Ac)&&.001>((N[3]-N[0])*(N[2]-N[1])+(T[3]-T[0])*(T[2]-T[1]))/W&&b.wa.we((N[0]+N[2])/2,(T[0]+
T[2])/2,Math.sqrt(W/8))}a&&a.restore();h.restore();break;case "rect":a&&a.save();h.save();f(k.transform);a&&(a.beginPath(),0<k.ig||0<k.jg?gb(k.x,k.y,k.width,k.height,k.ig,k.jg):a.rect(k.x,k.y,k.width,k.height));ta();r(k.x,k.y);r(k.x,k.y+k.height);r(k.x+k.width,k.y);r(k.x+k.width,k.y+k.height);a&&a.restore();h.restore();break;case "text":a&&a.save(),h.save(),f(k.transform),qa(k.text,k.x,k.y),r(k.x,k.y),a&&a.restore(),h.restore()}a&&a.restore();h.restore();a&&b&&b.Pf&&Ka(m.slice(La),l.slice(La))}function d(b,
c){if(c.Ya&&0!=c.Ya){var d=c.Fd,e=c.Gd;if(void 0==d||void 0==e)d=g.J(null,{mc:b}),b=je(d),d=(b.Y+b.oa)/2,e=(b.aa+b.ma)/2;a.translate(d+(c.Cb||0),e+(c.Db||0));a.rotate(c.Ya);a.translate(-d,-e)}else(c.Cb||c.Db)&&a.translate(c.Cb,c.Db)}function e(b){a.beginPath();a.rect(b.x,b.y,b.Bc,b.tc);a.clip()}function f(b){qe(b,function(b,c){a&&a.translate(b,c);h.translate(b,c)},function(b){a&&a.rotate(b);h.rotate(b)},function(b,c){a&&a.scale(b,c);h.scale(b,c)},function(b,c,d,e,f,g){a&&a.transform(b,c,d,e,f,g);
h.ke(b,c,d,e,f,g)})}var g=this,h=new ke,m=[],l=[],r=this.m;b&&b.rd?r=oe(this,b.rd):b&&b.mc&&(r=b.mc);if(r){b&&b.Ee&&b.Ee(a,this.Fa);if(a){for(var n=[],k=r.parentElement;null!=k;k=k.parentElement)n.push(k);for(k=n.length-1;0<=k;k--){var q=n[k].id;(q=q&&b&&b.$c&&b.$c[q])&&d(n[k],q);f(n[k].transform)}}c(r,{},{})}return{x:m,y:l}};function re(a,b){if(a.id===b)return a;if(a.children)for(var c=0;c<a.children.length;c++){var d=re(a.children[c],b);if(d)return d}return null}
me.prototype.$b=function(a){return null!=re(this.m,a)};me.prototype.ff=function(a,b){return null!=re(re(this.m,b),a)};function he(a){this.b=a||[1,0,0,0,1,0]}v=he.prototype;v.Ab=function(){return new he(this.b)};v.apply=function(a){return new ge(this.b[0]*a.x+this.b[1]*a.y+this.b[2],this.b[3]*a.x+this.b[4]*a.y+this.b[5])};function ie(a,b){var c=a.b[0]*a.b[4]-a.b[3]*a.b[1];return new ge((a.b[4]*b.x-a.b[1]*b.y+a.b[1]*a.b[5]-a.b[4]*a.b[2])/c,(-a.b[3]*b.x+a.b[0]*b.y+a.b[3]*a.b[2]-a.b[0]*a.b[5])/c)}
v.translate=function(a,b){this.b=[this.b[0],this.b[1],this.b[0]*a+this.b[1]*b+this.b[2],this.b[3],this.b[4],this.b[3]*a+this.b[4]*b+this.b[5]]};v.scale=function(a,b){this.b=[this.b[0]*a,this.b[1]*b,this.b[2],this.b[3]*a,this.b[4]*b,this.b[5]]};v.rotate=function(a){var b=Math.cos(a);a=Math.sin(a);this.b=[b*this.b[0]+a*this.b[1],-a*this.b[0]+b*this.b[1],this.b[2],b*this.b[3]+a*this.b[4],-a*this.b[3]+b*this.b[4],this.b[5]]};
v.ke=function(a,b,c,d,e,f){this.b=[a*this.b[0]+c*this.b[1],b*this.b[0]+d*this.b[1],a*this.b[2]+c*this.b[3],b*this.b[2]+d*this.b[3],a*this.b[4]+c*this.b[5]+e,b*this.b[4]+d*this.b[5]+f]};function ge(a,b){this.x=a||0;this.y=b||0}function ke(){this.stack=[new he]}v=ke.prototype;v.apply=function(a){return this.stack[this.stack.length-1].apply(a)};v.save=function(){this.stack.push(this.stack[this.stack.length-1].Ab())};v.restore=function(){if(2>this.stack.length)throw"restore doesn't match save";this.stack.pop()};
v.translate=function(a,b){this.stack[this.stack.length-1].translate(a,b)};v.scale=function(a,b){this.stack[this.stack.length-1].scale(a,b)};v.rotate=function(a){this.stack[this.stack.length-1].rotate(a)};v.ke=function(a,b,c,d,e,f){this.stack[this.stack.length-1].ke(a,b,c,d,e,f)};function Qb(a){a=a.split("#");return{Ic:a[0],id:a[1]}}function se(a,b,c){a.N.save();c.Ee=function(a,b){this.clientData.Md=b;a.translate(-b[0],-b[1]);a.scale(this.A.j/(b[2]-b[0]),this.A.j/(b[3]-b[1]))}.bind(a);b.J(a.N,c);a.N.restore()}function te(a,b,c,d,e){return{x:(a.clientData.Md[2]-a.clientData.Md[0])/d*(b+a.clientData.Md[0]),y:(a.clientData.Md[3]-a.clientData.Md[1])/e*(c+a.clientData.Md[1])}}
function ue(a,b,c){var d={},e=(a.buttons?a.buttons.length:0)+(a.radiobuttons?1:0);if(void 0!=a.sliders){for(var f=0;f<a.sliders.length;f++){var g=a.sliders[f],h=le(b,g.id),m=le(b,g.thumbId),l=(m.Y+m.oa)/2,r=(m.aa+m.ma)/2;h.oa-h.Y<h.ma-h.aa?(h.Y=h.oa=(h.Y+h.oa)/2,l=h.Y):(h.aa=h.ma=(h.aa+h.ma)/2,r=h.aa);m=(c[e+f]-g.min)/(g.max-g.min);d[g.thumbId]={Cb:m*(h.oa-h.Y)-(l-h.Y),Db:m*(h.aa-h.ma)-(r-h.ma)}}e+=a.sliders.length}if(void 0!=a.rotating)for(f=0;f<a.rotating.length;f++)g=a.rotating[f],m=g.numSteps?
2*Math.PI/g.numSteps:1,h=le(b,g.centerId),d[g.id]={Ya:c[e+f]*m,Fd:(h.Y+h.oa)/2,Gd:(h.aa+h.ma)/2};return d}function ve(a,b,c){return Math.min(Math.max((c-a)/(b-a),0),1)}
function we(a,b,c,d,e,f,g,h,m){e=te(a,m.x-g,m.y-h,e,f);var l=a.clientData.Qc.min+(a.clientData.Qc.max-a.clientData.Qc.min)*ve(a.clientData.min,a.clientData.max,a.clientData.$d?e.y:e.x),r=a.clientData.Qc.min,n=a.clientData.Qc.max;(e=a.clientData.Qc.discrete)&&0<e.length?l=e.reduce(function(a,b){return Math.abs(l-b)<Math.abs(l-a)?b:a},e[0]):(a=a.clientData.Qc.snap)&&a.forEach(function(a,c){"string"===typeof a&&/^`.+`$/.test(a)&&(a=ma(a,b,c,!0));Math.abs(l-a)<Math.abs(n-r)/10&&(l=a)});b.c[(d.buttons?
d.buttons.length:0)+(d.radiobuttons?1:0)+c]=Math.max(Math.min(r,n),Math.min(Math.max(r,n),l))}
function xe(a,b,c,d){if(0!==c.draw.length){for(var e=null,f=0;f<c.draw.length;f++)if(c.draw[f].uri){e=Qb(c.draw[f].uri).Ic;break}var g=e?ue(c,b.rb[e],d.c):{};f=null;if(c.diffwheelmotion&&c.diffwheelmotion.id){f=c.diffwheelmotion;var h=f.id,m=f.dx||0,l=f.dy||0,r=f.adjscale||1,n=f.color||"black",k=void 0===f.linewidth?1:f.linewidth;f=le(b.rb[e],h);var q=(c.buttons?c.buttons.length:0)+(c.radiobuttons?1:0),p=2.4*d.c[q];q=2.4*d.c[q+1];var u=a.A.j;f=(.5+m)*(f.oa-f.Y)*r/u;m=Cd(a,p,q,f,{color:n,je:k});g[h]=
{Cb:-(m.x*f*u+l*u*Math.sin(m.Ya)),Db:-(m.y*f*u+l*u*Math.cos(m.Ya)),Ya:-m.Ya};f={Ag:p,Bg:q,Gg:f,color:n,je:k}}c.draw.forEach(function(a){if(a.uri){var f=Qb(a.uri),h=b.rb[f.Ic];f=f.id;for(var k={},l=c.buttons?c.buttons.length:0,m=c.radiobuttons?c.radiobuttons.length:0,n=c.styles?c.styles.length:0,p=0;p<l;p++){var q=c.buttons[p].val,r=c.buttons[p].st;q=q.indexOf(d.c[p]);0<=q&&(k[c.buttons[p].id]=r[q])}for(p=0;p<m;p++)q=c.radiobuttons[p].val,r=c.radiobuttons[p].st,k[c.radiobuttons[p].id]=r[d.c[l]===q?
1:0];for(p=0;p<n;p++)k[c.styles[p].id]=ma(c.styles[p].st,d);l=b.rb[e];m=d.c;n={};if(void 0!=c.sliders)for(p=0;p<c.sliders.length;p++){r=c.sliders[p];q=le(l,r.id);var t=r.lowerPartId&&le(l,r.lowerPartId);if(t){var u=(m[p]-r.min)/(r.max-r.min),T=t.oa-t.Y,W=t.ma-t.aa;n[r.lowerPartId]=q.oa-q.Y<q.ma-q.aa?{x:t.Y-W,y:t.aa,Bc:T+2*W,tc:W*u}:{x:t.Y,y:t.aa-W,Bc:T*u,tc:W+2*T}}}se(this,h,{rd:f,style:k,$c:g,xe:n,Pf:!1})}a.js&&(a=new Function("ctx","$",a.js),this.N.save(),this.N.scale(this.A.j/1E3,this.A.j/1E3),
this.N.beginPath(),a(this.N,d.c),this.N.restore())},a);f&&Cd(a,f.Ag,f.Bg,f.Gg,{color:f.color,je:f.je});c.score&&c.score.id&&(h=(c.buttons?c.buttons.length:0)+(c.radiobuttons?1:0)+(c.sliders?c.sliders.length:0),l=c.score,n=l.numHeights||5,f=le(b.rb[e],l.id),k=b.rb[e].Fa,Gd(a,d.c.slice(h),(f.Y-k[0])/(k[2]-k[0]),(f.oa-k[0])/(k[2]-k[0]),(f.ma-k[1])/(k[3]-k[1]),(f.aa-k[1])/(k[3]-k[1]),n,(f.ma-f.aa)/(k[3]-k[1])/n*(l.noteSize||1),void 0===l.linewidth?1:l.linewidth))}}
function ye(a,b,c){function d(a){for(var b=0;b<c.length;b++)if(c[b].name===a)return b;return-1}function e(a){return a instanceof Array?a.join(""):a}function f(a,b){return a.map(function(a){return ma(a,b)})}b.forEach(function(b){var g=b.name;if(!g)throw"Missing block name";var m=d(g),l=0<=m?c[m]:null,r=l?l.type:"?";if(b.type||!l)switch(b.type){case "event":r="e";break;case "action":r="a";break;case "state":r="s";break;case "comment":r="c";break;case "hidden":r="h";break;default:throw"Unknown block type "+
b.type+" for block "+g;}var n=l?l.ta:[];b.modes&&!l&&b.modes.forEach(function(a){switch(a){case "basic":n.push("b");break;case "advanced":n.push("a");break;default:throw"Unknown block mode "+a;}});var k=l?l.oc:null,q=b.validation;q&&(k=function(a){for(var b=0;b<q.length;b++){var c=q[b].assert;if("string"===typeof c&&/^`.+`$/.test(c)?!ma(c,a,void 0,!0):!c)return(a=q[b].warning)?new za(a,!0):new za(q[b].error||"Error")}});var p=l?l.J:function(c,d){xe(c,a,b,d)},u=l?l.ga:function(c,d,e,f,g,h,k){a:{var l=
Qb(b.draw[0].uri).Ic,m=0,n=b.buttons;if(n){var p;b:{var q=a.rb[l],r=te(c,k.x-g,k.y-h,e,f);for(p=0;p<n.length;p++)if(q.cd(n[p].id,r.x,r.y)){q=n[p].val.indexOf(d.c[p]);0<=q&&(z(d),d.c[p]=n[p].val[(q+1)%n[p].val.length]);break b}p=null}if(null!==p){d=m+p;break a}m+=n.length}if(p=b.radiobuttons){b:{q=a.rb[l];n=n||0;r=te(c,k.x-g,k.y-h,e,f);for(var t=0;t<p.length;t++)if(q.cd(p[t].id,r.x,r.y)){z(d);d.c[n]=p[t].val;p=0;break b}p=null}if(null!==p){d=m+p;break a}m++}if(p=n=b.pushbuttons){b:{p=a.rb[l];q=te(c,
k.x-g,k.y-h,e,f);for(r=0;r<n.length;r++)if(p.cd(n[r].id,q.x,q.y)){z(d);n=n[r].newParameters;"string"===typeof n&&/^`.+`$/.test(n)&&(n=ma(n,d,void 0,!0));d.c=n;n=!0;break b}n=null}p=null!==n}if(p)d=-1;else{if(n=b.sliders){b:{p=a.rb[l];q=te(c,k.x-g,k.y-h,e,f);for(r=0;r<n.length;r++){c.clientData.Qc=n[r];var u=le(p,c.clientData.Qc.id);c.clientData.$d=u.oa-u.Y<u.ma-u.aa;c.clientData.min=c.clientData.$d?u.ma:u.Y;c.clientData.max=c.clientData.$d?u.aa:u.oa;t=(u.Y+u.oa)/2;u=(u.aa+u.ma)/2;var H=le(p,c.clientData.Qc.thumbId);
if(Math.abs((c.clientData.$d?q.x:q.y)-(c.clientData.$d?t:u))<(c.clientData.$d?H.oa-H.Y:H.ma-H.aa)){z(d);p=r;break b}}p=null}if(null!==p){d=m+p;break a}m+=n.length}if(n=b.rotating){b:{p=a.rb[l];q=d.c.slice(m,m+n.length);r=te(c,k.x-g,k.y-h,e,f);for(t=0;t<n.length;t++){u=le(p,n[t].centerId);u={x:(u.Y+u.oa)/2,y:(u.aa+u.ma)/2};var A=n[t].numSteps?2*Math.PI/n[t].numSteps:1;H=u.x+(r.x-u.x)*Math.cos(q[t]*A)+(r.y-u.y)*Math.sin(q[t]*A);A=u.y-(r.x-u.x)*Math.sin(q[t]*A)+(r.y-u.y)*Math.cos(q[t]*A);if(p.cd(n[t].thumbId,
H,A)){c.clientData.Tg=n[t];c.clientData.Lf=u;c.clientData.Eg=Math.atan2(A-u.y,H-u.x);z(d);p=t;break b}}p=null}if(null!==p){d=m+p;break a}m+=n.length}if(b.score&&(q=a.rb[l],c=(b.buttons?b.buttons.length:0)+(b.radiobuttons?1:0)+(b.sliders?b.sliders.length:0),l=d.c.slice(c).length/2,n=b.score.numHeights||5,p=le(q,b.score.id),q=q.Fa,(e=Vd((p.Y-q[0])/(q[2]-q[0]),(p.oa-q[0])/(q[2]-q[0]),(p.ma-q[1])/(q[3]-q[1]),(p.aa-q[1])/(q[3]-q[1]),l,n,e,f,g,h,k))?(z(d),d.c[c+2*e.index]===e.tone?d.c[c+2*e.index+1]=(d.c[c+
2*e.index+1]+1)%3:(d.c[c+2*e.index]=e.tone,d.c[c+2*e.index+1]=1),p=0):p=null,null!==p)){d=m+p;break a}d=null}}return d},t=l?l.Ra:function(a,c,d,e,f,g,h,k){var l=(b.buttons?b.buttons.length:0)+(b.radiobuttons?1:0),m=b.sliders?b.sliders.length:0;d>=l&&d<l+m?we(a,c,d-l,b,e,f,g,h,k):(l+=m,m=b.rotating?b.rotating.length:0,d>=l&&d<l+m&&(d-=l,e=te(a,k.x-g,k.y-h,e,f),c.c[(b.buttons?b.buttons.length:0)+(b.radiobuttons?1:0)+(b.sliders?b.sliders.length:0)+d]=Math.round(((Math.atan2(e.y-a.clientData.Lf.y,e.x-
a.clientData.Lf.x)-a.clientData.Eg+Math.PI)%(2*Math.PI)-Math.PI)/(b.rotating[d].numSteps?2*Math.PI/b.rotating[d].numSteps:1))))},B=l?l.X:{};["aseba","l2","js","python"].forEach(function(a){b[a]&&(B[a]=function(c){var d={};b[a].initVarDecl&&(d.S=f(b[a].initVarDecl.map(e),c));b[a].initCodeDecl&&(d.Xa=f(b[a].initCodeDecl.map(e),c));b[a].initCodeExec&&(d.C=f(b[a].initCodeExec.map(e),c));b[a].sectionBegin&&(d.B=ma(e(b[a].sectionBegin),c));b[a].sectionEnd&&(d.U=ma(e(b[a].sectionEnd),c));b[a].sectionPreamble&&
(d.bb=ma(e(b[a].sectionPreamble),c));b[a].clauseInit&&(d.R=ma(e(b[a].clauseInit),c));if(b[a].clauseAnd){var g="";c.c.forEach(function(d,f){(d=ma(e(b[a].clauseAnd),c,f))&&(g+=(0<g.length?" "+na[a].o+" ":"")+d)});d.I=g||na[a].F}else b[a].clause&&(d.I=ma(e(b[a].clause),c));d.Of=b[a].clauseOptional||!1;b[a].statement1?d.u=c.c.map(function(d,f){return ma(e(b[a].statement1),c,f)}).join(""):b[a].statement&&(d.u=ma(e(b[a].statement),c));b[a].error&&(d.I=ma(e(b.error.error),c));return d})});g={name:g,type:r,
ta:n,ka:l?l.ka:function(){return b.defaultParameters||[]},zb:l?l.zb:function(){return b.typicalParameters||b.defaultParameters||[]},J:p,ga:u,Ra:t,X:B,oc:k};0<=m?c[m]=new w(g):c.push(new w(g))})}
function ze(a){tc=function(b,d){return{j:b,Wf:void 0===a.styles.minInteractiveBlockSize?60:a.styles.minInteractiveBlockSize,Rf:void 0===a.styles.eventRightAlign?!1:a.styles.eventRightAlign,pa:void 0===a.styles.blockLineWidth?Math.max(1,Math.min(3,b/40)):a.styles.blockLineWidth,Kf:Math.round(b/4).toString(10)+"px sans-serif",g:d,ya:void 0===a.styles.controlLineWidth?Math.max(1,Math.min(3,b/40)):a.styles.controlLineWidth,xg:"bold 15px sans-serif",$e:a.styles.errorColor||"#f88",Bf:a.styles.warningColor||
"#f88",background:a.styles.background||"white",rf:a.styles.ruleMarks||"#bbb",tf:a.styles.scrollbarThumbColor||"navy",sf:a.styles.scrollbarBackgroundColor||"#ccc",Oc:a.styles.scrollbarWidth||5}};var b=[];ye(a,a.blocks||[],b);Na=b};function Ae(){(function(){var a={"!stop":function(){return{u:"motor.left.target = 0;\nmotor.right.target = 0;\nsound.system(-1);\nleds.circle(32,32,32,32,32,32,32,32);\ntimer.period[0] = 100;\nonevent timer0 {\nleds.circle(0,0,0,0,0,0,0,0);\n}\n"}},"button 1":function(a){return{B:"onevent buttons {\n",U:"}\n",I:"button."+["center","forward","backward","right","left"][a.c[0]]}},"horiz prox":function(a){for(var b="",c=0;7>c;c++)a.c[c]&&(b+=(0===b.length?"":" && ")+"prox.horizontal["+[2,1,3,0,4,5,6][c]+
"] "+(0<a.c[c]?">= 2":"<= 1")+"000");if(""===b){for(c=0;7>c;c++)b+=" || prox.horizontal["+[2,1,3,0,4,5,6][c]+"] >= 2000";b=b.slice(4)}return{B:"onevent prox {\n",U:"}\n",I:b}},"horiz prox adv":function(a){for(var b="",c=0;7>c;c++)a.c[c]&&(b+=(0===b.length?"":" && ")+"prox.horizontal["+[2,1,3,0,4,5,6][c]+"] "+(0<a.c[c]?">= "+Math.round(7+33*a.c[7]):"<= "+Math.round(7+33*a.c[8]))+"00");if(""===b){for(c=0;7>c;c++)b+=" || prox.horizontal["+[2,1,3,0,4,5,6][c]+"] >= 2000";b=b.slice(4)}return{B:"onevent prox {\n",
U:"}\n",I:b}},"horiz prox 1":function(a){for(var b="",c=0;7>c;c++)a.c[c]&&(b+=(0===b.length?"":" && ")+"prox.horizontal["+[2,1,3,0,4,5,6][c]+"] "+(0<a.c[c]?">= ":"< ")+Math.round(7+33*a.c[7])+"00");if(""===b){for(c=0;7>c;c++)b+=" || prox.horizontal["+[2,1,3,0,4,5,6][c]+"] >= 2000";b=b.slice(4)}return{B:"onevent prox {\n",U:"}\n",I:b}},ground:function(a){for(var b="",c=0;2>c;c++)a.c[c]&&(b+=(0===b.length?"":" && ")+"prox.ground.delta["+c+"] "+(0<a.c[c]?">= 450":"<= 400"));if(""===b){for(c=0;2>c;c++)b+=
" || prox.ground.delta["+c+"] >= 450";b=b.slice(4)}return{B:"onevent prox {\n",U:"}\n",I:b}},"ground adv":function(a){for(var b="",c=0;2>c;c++)a.c[c]&&(b+=(0===b.length?"":" && ")+"prox.ground.delta["+c+"] "+(0<a.c[c]?">= "+25*Math.round(40*a.c[2]):"<= "+25*Math.round(40*a.c[3])));if(""===b){for(c=0;2>c;c++)b+=" || prox.ground.delta["+c+"] >= 450";b=b.slice(4)}return{B:"onevent prox {\n",U:"}\n",I:b}},"ground 1":function(a){for(var b="",c=0;2>c;c++)a.c[c]&&(b+=(0===b.length?"":" && ")+"prox.ground.delta["+
c+"] "+(0<a.c[c]?">= ":"< ")+25*Math.round(40*a.c[2]));if(""===b){for(c=0;2>c;c++)b+=" || prox.ground.delta["+c+"] >= 450";b=b.slice(4)}return{B:"onevent prox {\n",U:"}\n",I:b}},tap:function(){return{S:["bool tapped;\n"],C:["tapped = false;\n"],B:"onevent tap {\n",U:"}\n",bb:"tapped = true;\n",I:"tapped"}},accelerometer:function(a){var b=a.c[0];if(0===b)return{S:["bool tapped;\n"],C:["tapped = false;\n"],B:"onevent tap {\n",U:"}\n",bb:"tapped = true;\n",I:"tapped"};a=(2===b?-1:1)*a.c[1];var c=1===
b?"roll":"pitch";return{B:"onevent acc {\n",U:"}\n",R:2===b?"fixed pitchAngle = atan2(acc[1], acc[2]);\n":"fixed rollAngle = atan2(acc[0], acc[2]);\n",I:-6>=a?c+"Angle < "+(Math.PI/12*(a+.5)).toFixed(2):6<=a?c+"Angle >= "+(Math.PI/12*(a-.5)).toFixed(2):c+"Angle >= "+(Math.PI/12*(a-.5)).toFixed(2)+" && "+c+"Angle < "+(Math.PI/12*(a+.5)).toFixed(2)}},roll:function(a){a=a.c[0];return{B:"onevent acc {\n",U:"}\n",R:"fixed rollAngle = atan2(acc[0], acc[2]);\n",I:"rollAngle >= "+(Math.PI/12*(a-.5)).toFixed(2)+
" && rollAngle < "+(Math.PI/12*(a+.5)).toFixed(2)}},pitch:function(a){a=-a.c[0];return{B:"onevent acc {\n",U:"}\n",R:"fixed pitchAngle = atan2(acc[1], acc[2]);\n",I:"pitchAngle >= "+(Math.PI/12*(a-.5)).toFixed(2)+" && pitchAngle < "+(Math.PI/12*(a+.5)).toFixed(2)}},yaw:function(a){a=a.c[0];return{B:"onevent acc {\n",U:"}\n",R:"fixed yawAngle = atan2(acc[0], acc[1]);\n",I:"yawAngle >= "+(Math.PI/12*(a-.5)).toFixed(2)+" && yawAngle < "+(Math.PI/12*(a+.5)).toFixed(2)}},clap:function(){return{C:["// setup threshold for detecting claps\nmic.threshold = 250\n"],
B:"onevent mic {\n",U:"}\n",I:"mic.intensity > mic.threshold",Of:!0}},init:function(){return{B:"// initialization\n"}},timer:function(){return{S:["bool timerElapsed;\n"],C:["// stop timer 0\ntimer.period[0] = 0;\n","timerElapsed = false;\n"],B:"onevent timer0 {\n",U:"}\n",bb:"timerElapsed = true;\ntimer.period[0] = 0;\n",I:"timerElapsed"}},state:function(a){for(var b="",c=0;4>c;c++)a.c[c]&&(b+=(0===b.length?"":" && ")+(0<a.c[c]?"":"!")+"state["+c+"]");return{S:["// variables for state\nbool state[4];\n"],
C:["state = [false, false, false, false];\n"],I:b}},"state 8":function(a){return{S:["// variables for exclusive state\nint state8;\n"],C:["state8 = 0;\n"],I:"state8 == "+a.c[0].toString(10)}},"counter comparison":function(a){return{S:["int counter;\n"],C:["counter = 0;\n"],I:"counter "+(0===a.c[0]?"==":0<a.c[0]?">=":"<=")+" "+a.c[1]}},"color state":function(a){return{S:["int topColor[3];\n"],C:["topColor = [0, 0, 0];\n"],I:a.c.map(function(a,b){return"topColor["+b+"] / 11 == "+Math.floor(2.99*a)}).join(" && ")}},
"color 8 state":function(a){return{S:["int topColor[3];\n"],C:["topColor = [0, 0, 0];\n"],I:"topColor[0] "+(a.c[0]%2?">=":"<")+" 16 && topColor[1] "+(2<=a.c[0]%4?">=":"<")+" 16 && topColor[2] "+(4<=a.c[0]?">=":"<")+" 16"}},"motor state":function(a){function b(a,b){return 0<b?"motor."+a+".target > 250":0>b?"motor."+a+".target < -250":"abs(motor."+a+".target) < 250"}return{I:b("left",a.c[0])+" && "+b("right",a.c[1])}},motor:function(a){return{C:["// reset outputs\nleds.top(0, 0, 0);\nleds.bottom.left(0, 0, 0);\nleds.bottom.right(0, 0, 0);\nleds.circle(0, 0, 0, 0, 0, 0, 0, 0);\n"],
u:"motor.left.target = "+Math.round(500*a.c[0])+";\nmotor.right.target = "+Math.round(500*a.c[1])+";\n"}},move:function(a){return{C:["// reset outputs\nleds.top(0, 0, 0);\nleds.bottom.left(0, 0, 0);\nleds.bottom.right(0, 0, 0);\nleds.circle(0, 0, 0, 0, 0, 0, 0, 0);\n"],u:"motor.left.target = "+[0,100,-100,85,115,-100,100][a.c[0]]+";\nmotor.right.target = "+[0,100,-100,115,85,100,-100][a.c[0]]+";\n"}},"top color":function(a){return{S:["int topColor[3];\n"],C:["topColor = [0, 0, 0];\n","// reset outputs\nleds.top(0, 0, 0);\nleds.bottom.left(0, 0, 0);\nleds.bottom.right(0, 0, 0);\nleds.circle(0, 0, 0, 0, 0, 0, 0, 0);\n"],
u:"leds.top("+a.c.map(function(a){return Math.round(32*a)}).join(", ")+");\ntopColor = ["+a.c.map(function(a){return Math.round(32*a)}).join(", ")+"];\n"}},"top color 8":function(a){a=[32*(a.c&1),16*(a.c&2),8*(a.c&4)].join(", ");return{S:["int topColor[3];\n"],C:["topColor = [0, 0, 0];\n","// reset outputs\nleds.top(0, 0, 0);\nleds.bottom.left(0, 0, 0);\nleds.bottom.right(0, 0, 0);\nleds.circle(0, 0, 0, 0, 0, 0, 0, 0);\n"],u:"leds.top("+a+");\ntopColor = ["+a+"];\n"}},"bottom color":function(a){return{C:["// reset outputs\nleds.top(0, 0, 0);\nleds.bottom.left(0, 0, 0);\nleds.bottom.right(0, 0, 0);\nleds.circle(0, 0, 0, 0, 0, 0, 0, 0);\n"],
u:"leds.bottom.left("+a.c.map(function(a){return Math.round(32*a)}).join(", ")+");\nleds.bottom.right("+a.c.map(function(a){return Math.round(32*a)}).join(", ")+");\n"}},"bottom-left color":function(a){return{C:["// reset outputs\nleds.top(0, 0, 0);\nleds.bottom.left(0, 0, 0);\nleds.bottom.right(0, 0, 0);\nleds.circle(0, 0, 0, 0, 0, 0, 0, 0);\n"],u:"leds.bottom.left("+a.c.map(function(a){return Math.round(32*a)}).join(", ")+");\n"}},"bottom-right color":function(a){return{C:["// reset outputs\nleds.top(0, 0, 0);\nleds.bottom.left(0, 0, 0);\nleds.bottom.right(0, 0, 0);\nleds.circle(0, 0, 0, 0, 0, 0, 0, 0);\n"],
u:"leds.bottom.right("+a.c.map(function(a){return Math.round(32*a)}).join(", ")+");\n"}},"bottom color 8":function(a){a=[32*(a.c&1),16*(a.c&2),8*(a.c&4)].join(", ");return{C:["// reset outputs\nleds.top(0, 0, 0);\nleds.bottom.left(0, 0, 0);\nleds.bottom.right(0, 0, 0);\nleds.circle(0, 0, 0, 0, 0, 0, 0, 0);\n"],u:"leds.bottom.left("+a+");\nleds.bottom.right("+a+");\n"}},"bottom-left color 8":function(a){return{C:["// reset outputs\nleds.top(0, 0, 0);\nleds.bottom.left(0, 0, 0);\nleds.bottom.right(0, 0, 0);\nleds.circle(0, 0, 0, 0, 0, 0, 0, 0);\n"],
u:"leds.bottom.left("+[32*(a.c&1),16*(a.c&2),8*(a.c&4)].join(", ")+");\n"}},"bottom-right color 8":function(a){return{C:["// reset outputs\nleds.top(0, 0, 0);\nleds.bottom.left(0, 0, 0);\nleds.bottom.right(0, 0, 0);\nleds.circle(0, 0, 0, 0, 0, 0, 0, 0);\n"],u:"leds.bottom.right("+[32*(a.c&1),16*(a.c&2),8*(a.c&4)].join(", ")+");\n"}},notes:function(a){for(var b=[],c=[],d=0;6>d;d++)0<a.c[2*d+1]?(b.push([262,311,370,440,524,370][a.c[2*d]]),c.push(7*a.c[2*d+1])):(b.push(0),c.push(28));return{S:["const pi = 3.14;\n",
"// variables for notes\nint notes[6];\nint durations[6];\nint note_index;\nint wave[142];\n"],C:["// init notes\nfor (int i = 0; i < size(wave); i++) {\nwave[i] = 128 * sin(fixed(i) / size(wave) * 2 * pi);\n}\nsound.wave(wave);\nnote_index = 6;\nsound.system(-1);\n","// reset outputs\nleds.top(0, 0, 0);\nleds.bottom.left(0, 0, 0);\nleds.bottom.right(0, 0, 0);\nleds.circle(0, 0, 0, 0, 0, 0, 0, 0);\n"],Xa:["// when a note is finished, play the next one\nonevent sound.finished {\nif (note_index < size(notes)) {\nsound.freq(notes[note_index], durations[note_index]);\nnote_index++;\n}\n}\n"],
u:"notes = ["+b.join(", ")+"];\ndurations = ["+c.join(", ")+"];\nsound.freq(notes[0], durations[0]);\nnote_index = 1;\n"}},"set state":function(a){for(var b="",c=0;4>c;c++)a.c[c]&&(b+="state["+c+"] = "+(0<a.c[c]?"true":"false")+";\n");return{S:["// variables for state\nbool state[4];\n"],C:["state = [false, false, false, false];\n"],Xa:["// display the current state\nvoid display_state() {\nleds.circle(0,state[1]?32:0,0,state[3]?32:0,0,state[2]?32:0,0,state[0]?32:0);\n}\n"],u:0<b.length?b+"display_state();\n":
""}},"toggle state":function(a){for(var b="",c=0;4>c;c++)a.c[c]&&(b+="state["+c+"] = !state["+c+"];\n");return{S:["// variables for state\nbool state[4];\n"],C:["state = [false, false, false, false];\n"],Xa:["// display the current state\nvoid display_state() {\nleds.circle(0,state[1]?32:0,0,state[3]?32:0,0,state[2]?32:0,0,state[0]?32:0);\n}\n"],u:0<b.length?b+"display_state();\n":""}},"set state 8":function(a){var b="state8 = "+a.c[0].toString(10)+";\n";return{S:["// variables for exclusive state\nint state8;\n"],
C:["state8 = 0;\n"],Xa:["// display the current exclusive state\nvoid display_state8() {\nleds.circle(state8==0?32:0, state8==1?32:0, state8==2?32:0, state8==3?32:0, state8==4?32:0, state8==5?32:0, state8==6?32:0, state8==7?32:0);\n}\n"],u:0<b.length?b+"display_state8();\n":"",Ob:"leds.circle("+(0===a.c[0]?"32":"0")+","+(1===a.c[0]?"32":"0")+","+(2===a.c[0]?"32":"0")+","+(3===a.c[0]?"32":"0")+","+(4===a.c[0]?"32":"0")+","+(5===a.c[0]?"32":"0")+","+(6===a.c[0]?"32":"0")+","+(7===a.c[0]?"32":"0")+");\n"}},
"change state 8":function(a){return{S:["// variables for exclusive state\nint state8;\n"],C:["state8 = 0;\n"],Xa:["// display the current exclusive state\nvoid display_state8() {\nleds.circle(state8==0?32:0, state8==1?32:0, state8==2?32:0, state8==3?32:0, state8==4?32:0, state8==5?32:0, state8==6?32:0, state8==7?32:0);\n}\n"],u:"state8 = (state8 + "+(0<a.c[0]?"1":"7")+") % 8;\ndisplay_state8();\n",Ob:"call leds.circle("+(0===a.c[0]?"32":"0")+","+(1===a.c[0]?"32":"0")+","+(2===a.c[0]?"32":"0")+","+
(3===a.c[0]?"32":"0")+","+(4===a.c[0]?"32":"0")+","+(5===a.c[0]?"32":"0")+","+(6===a.c[0]?"32":"0")+","+(7===a.c[0]?"32":"0")+")\n"}},"set counter":function(a){return{S:["int counter;\n"],C:["counter = 0;\n"],Xa:["// display the current counter\nvoid display_counter(int c) {\nleds.circle((c&1)<<5,(c&2)<<4,(c&4)<<3,(c&8)<<2,\n(c&16)<<1,c&32,(c&64)>>1,(c&128)>>2);\n}\n"],u:(0===a.c[0]?"counter = 0;":0<a.c[0]?"if (counter < 255) {\ncounter++;\n}":"if (counter > 0) {\ncounter--;\n}")+"\ndisplay_counter(counter);\n"}},
"set timer":function(a){return{C:["// stop timer 0\ntimer.period[0] = 0;\n"],u:"timer.period[0] = "+Math.round(1E3*a.c[0])+";\n"}},"set timer log":function(a){return{C:["// stop timer 0\ntimer.period[0] = 0;\n"],u:"timer.period[0] = "+Math.round(1E3*a.c[0])+";\n"}},"picture comment":function(){return{}}},b;for(b in a)if(a.hasOwnProperty(b)){var c=ra(b);c&&(c.X.l2=a[b])}})()};function Be(){(function(){function a(a){return parseFloat(a.toFixed(2)).toString()}var b={"!stop":function(){return{u:'this.set("motor.left", 0);\nthis.set("motor.right", 0);\n'}},"button 1":function(a){return{B:'this.addEventListener("buttons", function (name, param) {\n',U:"});\n",I:'this.get("button.'+["center","forward","backward","right","left"][a.c[0]]+'")'}},"horiz prox":function(a){for(var b="",c=0;7>c;c++)a.c[c]&&(b+=(0===b.length?"":" && ")+'this.get("prox.horizontal")['+[2,1,3,0,4,5,6][c]+
"] "+(0<a.c[c]?">= 0.6":"<= 0.4"));if(""===b){for(c=0;7>c;c++)b+=' || this.get("prox.horizontal")['+[2,1,3,0,4,5,6][c]+"] >= 0.5";b=b.slice(4)}return{B:'this.addEventListener("prox", function (name, param) {\n',U:"});\n",I:b}},"horiz prox adv":function(b){for(var c="",d=0;7>d;d++)b.c[d]&&(c+=(0===c.length?"":" && ")+'this.get("prox.horizontal")['+[2,1,3,0,4,5,6][d]+"] "+(0<b.c[d]?">= "+a(b.c[7]):"<= "+a(b.c[8])));if(""===c){for(d=0;7>d;d++)c+=' || this.get("prox.horizontal")['+[2,1,3,0,4,5,6][d]+
"] >= 0.5";c=c.slice(4)}return{B:'this.addEventListener("prox", function (name, param) {\n',U:"});\n",I:c}},"horiz prox 1":function(b){for(var c="",d=0;7>d;d++)b.c[d]&&(c+=(0===c.length?"":" && ")+'this.get("prox.horizontal")['+[2,1,3,0,4,5,6][d]+"] "+(0<b.c[d]?">= ":"< ")+a(b.c[7]));if(""===c){for(d=0;7>d;d++)c+=' || this.get("prox.horizontal")['+[2,1,3,0,4,5,6][d]+"] >= 0.5";c=c.slice(4)}return{B:'this.addEventListener("prox", function (name, param) {\n',U:"});\n",I:c}},ground:function(a){for(var b=
"",c=0;2>c;c++)a.c[c]&&(b+=(0===b.length?"":" && ")+'this.get("prox.ground.delta")['+c+"] "+(0<a.c[c]?">= 0.6":"<= 0.4"));if(""===b){for(c=0;2>c;c++)b+=' || this.get("prox.ground.delta")['+c+"] >= 0.5";b=b.slice(4)}return{B:'this.addEventListener("prox", function (name, param) {\n',U:"});\n",I:b}},"ground adv":function(b){for(var c="",d=0;2>d;d++)b.c[d]&&(c+=(0===c.length?"":" && ")+'this.get("prox.ground.delta")['+d+"] "+(0<b.c[d]?">= "+a(b.c[2]):"<= "+a(b.c[3])));if(""===c){for(d=0;2>d;d++)c+=' || this.get("prox.ground.delta")['+
d+"] >= 0.5";c=c.slice(4)}return{B:'this.addEventListener("prox", function (name, param) {\n',U:"});\n",I:c}},"ground 1":function(b){for(var c="",d=0;2>d;d++)b.c[d]&&(c+=(0===c.length?"":" && ")+'this.get("prox.ground.delta")['+d+"] "+(0<b.c[d]?">= ":"< ")+a(b.c[2]));if(""===c){for(d=0;2>d;d++)c+=' || this.get("prox.ground.delta")['+d+"] >= 0.5";c=c.slice(4)}return{B:'this.addEventListener("prox", function (name, param) {\n',U:"});\n",I:c}},tap:function(){return{B:'this.addEventListener("tap", function (name, param) {\n',
U:"});\n"}},accelerometer:function(b){var c=b.c[0];if(0===c)return{B:'this.addEventListener("tap", function (name, param) {\n',U:"});\n"};b=(2===c?-1:1)*b.c[1];var d=1===c?"roll":"pitch";return{B:'this.addEventListener("acc", function (name, param) {\n',U:"});\n",R:2===c?"var pitchAngle = Math.atan2(acc[1], acc[2]);\n":"var rollAngle = Math.atan2(acc[0], acc[2]);\n",I:-6>=b?d+"Angle < "+a(Math.PI/12*(b+.5)):6<=b?d+"Angle >= "+a(Math.PI/12*(b-.5)):d+"Angle >= "+a(Math.PI/12*(b-.5))+" && "+d+"Angle < "+
a(Math.PI/12*(b+.5))}},roll:function(b){b=b.c[0];return{B:'this.addEventListener("acc", function (name, param) {\n',U:"});\n",R:"var rollAngle = Math.atan2(acc[0], acc[2]);\n",I:"rollAngle >= "+a(Math.PI/12*(b-.5))+" && rollAngle < "+a(Math.PI/12*(b+.5))}},pitch:function(b){b=-b.c[0];return{B:'this.addEventListener("acc", function (name, param) {\n',U:"});\n",R:"var pitchAngle = Math.atan2(acc[1], acc[2]);\n",I:"pitchAngle >= "+a(Math.PI/12*(b-.5))+" && pitchAngle < "+a(Math.PI/12*(b+.5))}},yaw:function(b){b=
b.c[0];return{B:'this.addEventListener("acc", function (name, param) {\n',U:"});\n",R:"var yawAngle = Math.atan2(acc[0], acc[1]);\n",I:"yawAngle >= "+a(Math.PI/12*(b-.5))+" && yawAngle < "+a(Math.PI/12*(b+.5))}},clap:function(){return{B:'this.addEventListener("mic", function (name, param) {\n',U:"});\n"}},init:function(){return{B:"// init block\n"}},timer:function(){return{C:["// stop timer 0\nthis.setTimer(0, -1);\n"],B:'this.addEventListener("timer0", function (name, param) {\n',U:"});\n"}},state:function(a){for(var b=
"",c=0;4>c;c++)a.c[c]&&(b+=(0===b.length?"":" && ")+(0<a.c[c]?"":"!")+"state0["+c+"]");return{S:['// variables for state\nthis.setClientState("state", []);\n'],C:['this.setClientState("state", [false, false, false, false]);\n'],R:'var state0 = this.getClientState("state");\n',I:b}},"state 8":function(a){return{S:['// variable for exclusive state\nthis.setClientState("state8", 0);\n'],C:['this.setClientState("state8", 0);\n'],R:'var state80 = this.getClientState("state8");\n',I:"state80 == "+a.c[0].toString(10)}},
"counter comparison":function(a){return{S:['// variable for counter\nthis.setClientState("counter", 0);\n'],C:['this.setClientState("counter", 0);\n'],R:'var counter0 = this.getClientState("counter");\n',I:"counter0 "+(0===a.c[0]?"==":0<a.c[0]?">=":"<=")+" "+a.c[1]}},"color state":function(a){return{I:a.c.map(function(a,b){return"topColor["+b+"] / 11 == "+Math.floor(2.99*a)}).join(" && ")}},"color 8 state":function(a){return{I:a.c.map(function(a,b){return"topColor["+b+"] / 11 == "+Math.floor(2.99*
a)}).join(" && ")}},"motor state":function(a){function b(a,b){return 0<b?'this.get("motor.'+a+'") > 0.1':0>b?'this.get("motor.'+a+'") > 0.1':'Math.abs(this.get("motor.'+a+'")) < 0.1'}return{I:b("left",a.c[0])+" && "+b("right",a.c[1])}},motor:function(b){return{C:['this.set("leds.top", [0, 0, 0]);\n'],u:'this.set("motor.left", '+a(b.c[0])+');\nthis.set("motor.right", '+a(b.c[1])+");\n"}},move:function(b){return{C:['this.set("leds.top", [0, 0, 0]);\n'],u:'this.set("motor.left", '+a([0,.2,-.2,.2-.05,
.25,-.2,.2][b.c[0]])+');\nthis.set("motor.right", '+a([0,.2,-.2,.25,.2-.05,.2,-.2][b.c[0]])+");\n"}},"top color":function(b){return{C:['this.set("leds.top", [0, 0, 0]);\n'],u:'this.set("leds.top", ['+b.c.map(a).join(", ")+"]);\n"}},"top color 8":function(a){return{C:['this.set("leds.top", [0, 0, 0]);\n'],u:'this.set("leds.top", ['+"0,0,0 1,0,0 0,1,0 1,1,0 0,0,1 1,0,1 0,1,1 1,1,1".split(" ")[a.c[0]]+"]);\n"}},"bottom color":function(b){return{C:['this.set("leds.top", [0, 0, 0]);\n'],u:'this.set("leds.bottom.left", ['+
b.c.map(a).join(", ")+']);\nthis.set("leds.bottom.right", ['+b.c.map(a).join(", ")+"]);\n"}},"bottom-left color":function(b){return{C:['this.set("leds.top", [0, 0, 0]);\n'],u:'this.set("leds.bottom.left", ['+b.c.map(a).join(", ")+"]);\n"}},"bottom-right color":function(b){return{C:['this.set("leds.top", [0, 0, 0]);\n'],u:'this.set("leds.bottom.right", ['+b.c.map(a).join(", ")+"]);\n"}},"bottom color 8":function(a){return{C:['this.set("leds.top", [0, 0, 0]);\n'],u:'this.set("leds.bottom.left", ['+
"0,0,0 1,0,0 0,1,0 1,1,0 0,0,1 1,0,1 0,1,1 1,1,1".split(" ")[a.c[0]]+']);\nthis.set("leds.bottom.right", ['+"0,0,0 1,0,0 0,1,0 1,1,0 0,0,1 1,0,1 0,1,1 1,1,1".split(" ")[a.c[0]]+"]);\n"}},"bottom-left color 8":function(a){return{C:['this.set("leds.top", [0, 0, 0]);\n'],u:'this.set("leds.bottom.left", ['+"0,0,0 1,0,0 0,1,0 1,1,0 0,0,1 1,0,1 0,1,1 1,1,1".split(" ")[a.c[0]]+"]);\n"}},"bottom-right color 8":function(a){return{C:['this.set("leds.top", [0, 0, 0]);\n'],u:'this.set("leds.bottom.right", ['+
"0,0,0 1,0,0 0,1,0 1,1,0 0,0,1 1,0,1 0,1,1 1,1,1".split(" ")[a.c[0]]+"]);\n"}},notes:function(a){for(var b=[],c=[],d=0;6>d;d++)0<a.c[2*d+1]?(b.push([262,311,370,440,524,370][a.c[2*d]]),c.push(7*a.c[2*d+1])):(b.push(0),c.push(28));return{C:['// init notes\nthis.set("sound", {});\n','this.set("leds.top", [0, 0, 0]);\n'],u:'this.set("sound", {"f": ['+b.join(", ")+'], "d": ['+c.join(", ")+"]});\n"}},"set state":function(a){for(var b="",c=0;4>c;c++)a.c[c]&&(b+="state["+c+"] = "+(0<a.c[c]?"true":"false")+
";\n");return{S:['// variables for state\nthis.setClientState("state", []);\n'],C:['this.setClientState("state", [false, false, false, false]);\n'],u:0<b.length?'var state = this.getClientState("state");\n'+b+'this.setClientState("state", state);\nthis.set("leds.circle", [0,state[1]?1:0,0,state[3]?1:0,0,state[2]?1:0,0,state[0]?1:0]);\n':""}},"toggle state":function(a){for(var b="",c=0;4>c;c++)a.c[c]&&(b+="state["+c+"] = !state["+c+"];\n");return{S:['// variables for state\nthis.setClientState("state", []);\n'],
C:['this.setClientState("state", [false, false, false, false]);\n'],u:0<b.length?'var state = this.getClientState("state");\n'+b+'this.setClientState("state", state);\nthis.set("leds.circle", [0,state[1]?1:0,0,state[3]?1:0,0,state[2]?1:0,0,state[0]?1:0]);\n':""}},"set state 8":function(a){a=a.c[0];for(var b=[],c=0;8>c;c++)b.push(a===c);return{S:['// variable for exclusive state\nthis.setClientState("state8", 0);\n'],C:['this.setClientState("state8", 0);\n'],u:'this.setClientState("state8", '+a.toString(10)+
');\nthis.set("leds.circle", ['+b.join(", ")+"]);\n",Ob:'this.set("leds.circle", ['+b.join(", ")+"]);\n"}},"change state 8":function(a){return{S:['// variable for exclusive state\nthis.setClientState("state8", 0);\n'],C:['this.setClientState("state8", 0);\n'],u:'var state8 = (this.getClientState("state8") + '+(0<a.c[0]?"1":"7")+') % 8;\nthis.setClientState("state8", state8);\nthis.set("leds.circle", [state8==0?1:0, state8==1?1:0, state8==2?1:0, state8==3?1:0, state8==4?1:0, state8==5?1:0, state8==6?1:0, state8==7?1:0]);\n',
Ob:'this.set("leds.circle", ['+(0===a.c[0]?"1":"0")+","+(1===a.c[0]?"1":"0")+","+(2===a.c[0]?"1":"0")+","+(3===a.c[0]?"1":"0")+","+(4===a.c[0]?"1":"0")+","+(5===a.c[0]?"1":"0")+","+(6===a.c[0]?"1":"0")+","+(7===a.c[0]?"1":"0")+"]);\n"}},"set counter":function(a){return{S:['// variable for counter\nthis.setClientState("counter", 0);\n'],C:['this.setClientState("counter", 0);\n'],u:"var counter = "+(0===a.c[0]?"0":0<a.c[0]?'Math.min(this.getClientState("counter") + 1, 255)':'Math.max(this.getClientState("counter") - 1, 0)')+
';\nthis.setClientState("counter", counter);\nthis.set("leds.circle", [counter&1?1:0,counter&2?1:0,counter&4?1:0,counter&8?1:0,\ncounter&16?1:0,counter&32?1:0,counter&64?1:0,counter&128?1:0]);\n'}},"set timer":function(a){return{C:["// stop timer 0\nthis.setTimer(0, -1);\n"],u:"this.setTimer(0, "+a.c[0].toFixed(3)+");\n"}},"set timer log":function(a){return{C:["// stop timer 0\nthis.setTimer(0, -1);\n"],u:"this.setTimer(0, "+a.c[0].toFixed(3)+");\n"}},"picture comment":function(){return{}}},c;for(c in b)if(b.hasOwnProperty(c)){var d=
ra(c);d&&(d.X.js=b[c])}})()};function Ce(){(function(){function a(a){return parseFloat(a.toFixed(2)).toString()}var b={"!stop":function(){return{u:'self.set("motor.left", 0)\nself.set("motor.right", 0)\n'}},"button 1":function(a){return{B:"def event_buttons(self):\n",U:"<\n",Lb:30,I:'self.get("button.'+["center","forward","backward","right","left"][a.c[0]]+'")'}},"horiz prox":function(a){for(var b="",c=0;7>c;c++)a.c[c]&&(b+=(0===b.length?"":" and ")+'self.get("prox.horizontal")['+[2,1,3,0,4,5,6][c]+"] "+(0<a.c[c]?">= 0.6":"<= 0.4"));
if(""===b){for(c=0;7>c;c++)b+=' || self.get("prox.horizontal")['+[2,1,3,0,4,5,6][c]+"] >= 0.5";b=b.slice(5)}return{B:"def event_prox(self):\n",U:"<\n",Lb:20,I:b}},"horiz prox adv":function(b){for(var c="",d=0;7>d;d++)b.c[d]&&(c+=(0===c.length?"":" and ")+'self.get("prox.horizontal")['+[2,1,3,0,4,5,6][d]+"] "+(0<b.c[d]?">= "+a(b.c[7]):"<= "+a(b.c[8])));if(""===c){for(d=0;7>d;d++)c+=' || self.get("prox.horizontal")['+[2,1,3,0,4,5,6][d]+"] >= 0.5";c=c.slice(4)}return{B:"def event_prox(self):\n",U:"<\n",
Lb:20,I:c}},"horiz prox 1":function(b){for(var c="",d=0;7>d;d++)b.c[d]&&(c+=(0===c.length?"":" and ")+'self.get("prox.horizontal")['+[2,1,3,0,4,5,6][d]+"] "+(0<b.c[d]?">= ":"< ")+a(b.c[7]));if(""===c){for(d=0;7>d;d++)c+=' or self.get("prox.horizontal")['+[2,1,3,0,4,5,6][d]+"] >= 0.5";c=c.slice(4)}return{B:"def event_prox(self):\n",U:"<\n",Lb:20,I:c}},ground:function(a){for(var b="",c=0;2>c;c++)a.c[c]&&(b+=(0===b.length?"":" and ")+'self.get("prox.ground.delta")['+c+"] "+(0<a.c[c]?">= 0.6":"<= 0.4"));
if(""===b){for(c=0;2>c;c++)b+=' or self.get("prox.ground.delta")['+c+"] >= 0.5";b=b.slice(4)}return{B:"def event_prox(self):\n",U:"<\n",Lb:10,I:b}},"ground adv":function(b){for(var c="",d=0;2>d;d++)b.c[d]&&(c+=(0===c.length?"":" and ")+'self.get("prox.ground.delta")['+d+"] "+(0<b.c[d]?">= "+a(b.c[2]):"<= "+a(b.c[3])));if(""===c){for(d=0;2>d;d++)c+=' or self.get("prox.ground.delta")['+d+"] >= 0.5";c=c.slice(4)}return{B:"def event_prox(self):\n",U:"<\n",Lb:10,I:c}},"ground 1":function(b){for(var c=
"",d=0;2>d;d++)b.c[d]&&(c+=(0===c.length?"":" and ")+'self.get("prox.ground.delta")['+d+"] "+(0<b.c[d]?">= ":"< ")+a(b.c[2]));if(""===c){for(d=0;2>d;d++)c+=' or self.get("prox.ground.delta")['+d+"] >= 0.5";c=c.slice(4)}return{B:"def event_prox(self):\n",U:"<\n",Lb:10,I:c}},tap:function(){return{B:"def event_tap(self):\n",U:"<\n",Lb:50}},accelerometer:function(b){var c=b.c[0];if(0===c)return{B:"def event_tap(self):\n",U:"<\n",Lb:50};b=(2===c?-1:1)*b.c[1];var d=1===c?"roll":"pitch";return{B:"def event_acc(self):\n",
U:"<\n",Lb:40,R:2===c?"pitchAngle = math.atan2(acc[1], acc[2])\n":"rollAngle = math.atan2(acc[0], acc[2])\n",I:-6>=b?d+"Angle < "+a(Math.PI/12*(b+.5)):6<=b?d+"Angle >= "+a(Math.PI/12*(b-.5)):d+"Angle >= "+a(Math.PI/12*(b-.5))+" and "+d+"Angle < "+a(Math.PI/12*(b+.5))}},roll:function(b){b=b.c[0];return{B:"def event_acc(self):\n",U:"<\n",Lb:40,R:"rollAngle = math.atan2(acc[0], acc[2])\n",I:"rollAngle >= "+a(Math.PI/12*(b-.5))+" and rollAngle < "+a(Math.PI/12*(b+.5))}},pitch:function(b){b=-b.c[0];return{B:"def event_acc(self):\n",
U:"<\n",Lb:40,R:"pitchAngle = math.atan2(acc[1], acc[2])\n",I:"pitchAngle >= "+a(Math.PI/12*(b-.5))+" and pitchAngle < "+a(Math.PI/12*(b+.5))}},yaw:function(b){b=b.c[0];return{B:"def event_acc(self):\n",U:"<\n",Lb:40,R:"yawAngle = math.atan2(acc[0], acc[1])\n",I:"yawAngle >= "+a(Math.PI/12*(b-.5))+" and yawAngle < "+a(Math.PI/12*(b+.5))}},clap:function(){return{B:"def event_mic(self):\n",U:"<\n",Lb:50}},init:function(){return{B:"# init block\n",Lb:300}},timer:function(){return{C:["# stop timer 0\nself.setTimer(0, -1)\n"],
B:"def event_timer0(self):\n",U:"<\n",Lb:200}},state:function(a){for(var b="",c=0;4>c;c++)a.c[c]&&(b+=(0===b.length?"":" and ")+(0<a.c[c]?"":"!")+"state0["+c+"]");return{S:['# variables for state\nself.setClientState("state", [])\n'],C:['self.setClientState("state", [False, False, False, False])\n'],R:'state0 = self.getClientState("state")\n',I:b}},"state 8":function(a){return{S:['# variable for exclusive state\nself.setClientState("state8", 0)\n'],C:['self.setClientState("state8", 0)\n'],R:'state80 = self.getClientState("state8")\n',
I:"state80 == "+a.c[0].toString(10)}},"counter comparison":function(a){return{S:['# variable for counter\nself.setClientState("counter", 0)\n'],C:['self.setClientState("counter", 0)\n'],R:'counter0 = self.getClientState("counter")\n',I:"counter0 "+(0===a.c[0]?"==":0<a.c[0]?">=":"<=")+" "+a.c[1]}},"color state":function(a){return{I:a.c.map(function(a,b){return"topColor["+b+"] / 11 == "+Math.floor(2.99*a)}).join(" and ")}},"color state 8":function(a){return{I:a.c.map(function(a,b){return"topColor["+
b+"] / 11 == "+Math.floor(2.99*a)}).join(" and ")}},"motor state":function(a){function b(a,b){return 0<b?'self.get("motor.'+a+'") > 0.1':0>b?'self.get("motor.'+a+'") > 0.1':'abs(self.get("motor.'+a+'")) < 0.1'}return{I:b("left",a.c[0])+" and "+b("right",a.c[1])}},motor:function(b){return{C:['self.set("leds.top", [0, 0, 0])\n'],u:'self.set("motor.left", '+a(b.c[0])+')\nself.set("motor.right", '+a(b.c[1])+")\n"}},move:function(b){return{C:['self.set("leds.top", [0, 0, 0])\n'],u:'self.set("motor.left", '+
a([0,.2,-.2,.2-.05,.25,-.2,.2][b.c[0]])+')\nself.set("motor.right", '+a([0,.2,-.2,.25,.2-.05,.2,-.2][b.c[0]])+")\n"}},"top color":function(b){return{C:['self.set("leds.top", [0, 0, 0])\n'],u:'self.set("leds.top", ['+b.c.map(a).join(", ")+"])\n"}},"top color 8":function(a){return{C:['self.set("leds.top", [0, 0, 0])\n'],u:'self.set("leds.top", ['+a.c.map(function(a){return a.toString(10)}).join(", ")+"])\n"}},"bottom color":function(b){return{C:['self.set("leds.top", [0, 0, 0])\n'],u:'self.set("leds.bottom.left", ['+
b.c.map(a).join(", ")+'])\nself.set("leds.bottom.right", ['+b.c.map(a).join(", ")+"])\n"}},"bottom-left color":function(b){return{C:['self.set("leds.top", [0, 0, 0])\n'],u:'self.set("leds.bottom.left", ['+b.c.map(a).join(", ")+"])\n"}},"bottom-right color":function(b){return{C:['self.set("leds.top", [0, 0, 0])\n'],u:'self.set("leds.bottom.right", ['+b.c.map(a).join(", ")+"])\n"}},"bottom color 8":function(a){return{C:['self.set("leds.top", [0, 0, 0])\n'],u:'self.set("leds.bottom.left", ['+a.c.map(function(a){return a.toString(10)}).join(", ")+
'])\nself.set("leds.bottom.right", ['+a.c.map(function(a){return a.toString(10)}).join(", ")+"])\n"}},"bottom-left color 8":function(a){return{C:['self.set("leds.top", [0, 0, 0])\n'],u:'self.set("leds.bottom.left", ['+a.c.map(function(a){return a.toString(10)}).join(", ")+"])\n"}},"bottom-right color 8":function(a){return{C:['self.set("leds.top", [0, 0, 0])\n'],u:'self.set("leds.bottom.right", ['+a.c.map(function(a){return a.toString(10)}).join(", ")+"])\n"}},notes:function(a){for(var b=[],c=[],d=
0;6>d;d++)0<a.c[2*d+1]?(b.push([262,311,370,440,524,370][a.c[2*d]]),c.push(7*a.c[2*d+1])):(b.push(0),c.push(28));return{C:['# init notes\nself.set("sound", {})\n','self.set("leds.top", [0, 0, 0])\n'],u:'self.set("sound", {"f": ['+b.join(", ")+'], "d": ['+c.join(", ")+"]})\n"}},"set state":function(a){for(var b="",c=0;4>c;c++)a.c[c]&&(b+="state["+c+"] = "+(0<a.c[c]?"true":"false")+"\n");return{S:['# variables for state\nself.setClientState("state", [])\n'],C:['self.setClientState("state", [False, False, False, False])\n'],
u:0<b.length?'state = self.getClientState("state")\n'+b+'self.setClientState("state", state)\nself.set("leds.circle", [0, 1 if state[1] else 0, 0, 1 if state[3] else 0, 0, 1 if state[2] else 0, 0, 1 if state[0] else 0])\n':""}},"toggle state":function(a){for(var b="",c=0;4>c;c++)a.c[c]&&(b+="state["+c+"] = !state["+c+"]\n");return{S:['# variables for state\nself.setClientState("state", [])\n'],C:['self.setClientState("state", [False, False, False, False])\n'],u:0<b.length?'state = self.getClientState("state")\n'+
b+'self.setClientState("state", state)\nself.set("leds.circle", [0, 1 if state[1] else 0, 0, 1 if state[3] else 0, 0, 1 if state[2] else 0, 0, 1 if state[0] else 0])\n':""}},"set state 8":function(a){a=a.c[0];for(var b=[],c=0;8>c;c++)b.push(a===c);return{S:['# variable for exclusive state\nself.setClientState("state8", 0)\n'],C:['self.setClientState("state8", 0)\n'],u:'self.setClientState("state8", '+a.toString(10)+')\nself.set("leds.circle", ['+b.join(", ")+"])\n",Ob:'self.set("leds.circle", ['+
b.join(", ")+"])\n"}},"change state 8":function(a){return{S:['# variable for exclusive state\nself.setClientState("state8", 0)\n'],C:['self.setClientState("state8", 0)\n'],u:'state8 = (self.getClientState("state8") + '+(0<a.c[0]?"1":"7")+') % 8\nself.setClientState("state8", state8)\nself.set("leds.circle", [1 if state8 == 0 else 0, 1 if state8 == 1 else 0, 1 if state8 == 2 else 0, 1 if state8 == 3 else 0, 1 if state8 == 4 else 0, 1 if state8 == 5 else 0, 1 if state8 == 6 else 0, 1 if state8 == 7 else 0])\n',
Ob:'self.set("leds.circle", ['+(0===a.c[0]?"1":"0")+","+(1===a.c[0]?"1":"0")+","+(2===a.c[0]?"1":"0")+","+(3===a.c[0]?"1":"0")+","+(4===a.c[0]?"1":"0")+","+(5===a.c[0]?"1":"0")+","+(6===a.c[0]?"1":"0")+","+(7===a.c[0]?"1":"0")+"])\n"}},"set counter":function(a){return{S:['# variable for counter\nself.setClientState("counter", 0)\n'],C:['self.setClientState("counter", 0)\n'],u:"counter = "+(0===a.c[0]?"0":0<a.c[0]?'min(self.getClientState("counter") + 1, 255)':'max(self.getClientState("counter") - 1, 0)')+
'\nself.setClientState("counter", counter)\nself.set("leds.circle", [1 if counter & 1 else 0, 1 if counter & 2 else 0, 1 if counter & 4 else 0, 1 if counter & 8 else 0, 1 if counter & 16 else 0, 1 if counter & 32 else 0, 1 if counter & 64 else 0, 1 if counter & 128 else 0])\n'}},"set timer":function(a){return{C:["# stop timer 0\nself.setTimer(0, -1)\n"],u:"self.setTimer(0, "+a.c[0].toFixed(3)+")\n"}},"set timer log":function(a){return{C:["# stop timer 0\nself.setTimer(0, -1)\n"],u:"self.setTimer(0, "+
a.c[0].toFixed(3)+")\n"}},"picture comment":function(){return{}}},c;for(c in b)if(b.hasOwnProperty(c)){var d=ra(c);d&&(d.X.python=b[c])}})()};function za(a,b){this.F=a;this.Eb=b||!1;this.h=!1;this.m=[];this.b=[];this.o=null}function hb(a,b){a.h=!0;a.m=b}function Aa(a,b){a.h=!0;a.o=b};function Ea(){this.Ub=[];this.Mc=[]}function De(a,b){this.state=a;this.b=b||!1}function Ee(a){a.Ub.forEach(function(a){a.b=!1});a.Mc.forEach(function(a){a.b=!1})}Ea.prototype.yb=function(a,b){b&&Ee(this);this.Ub.push(new De(a,b));20<this.Ub.length&&(this.Ub=this.Ub.slice(-20));this.Mc=[]};Ea.prototype.xf=function(a,b){b&&Ee(this);return 0<this.Ub.length?(this.Mc.push(new De(a,b)),this.Ub.pop()):new De(a,b)};
Ea.prototype.qf=function(a,b){b&&Ee(this);return 0<this.Mc.length?(this.Ub.push(new De(a,b)),this.Mc.pop()):new De(a,b)};y.prototype.toDataURL=function(a,b,c){var d=this;switch(this.Z.type){case "e":var e=F(a,{tag:"block",da:["event","html"]});break;case "a":e=F(a,{tag:"block",da:["action","html"]});break;case "s":e=F(a,{tag:"block",da:["state","html"]});break;case "c":e=F(a,{tag:"block",da:["comment","html"]});break;default:throw"internal";}e.width=b.j;e.height=b.j;return(new sc(this,E(e),e.va(),0,0,function(a,b,c,m){c=b.x+e.offsetLeft()+c;m=b.y+e.offsetTop()+m;bc(e,a.N,c,m);var f=d.Z;b=b.data;var g=e;a.N.save();a.N.translate(c,
m);f.J(a,b,g);a.N.restore()})).toDataURL(b,c||1)};function Fe(a,b,c,d){a=a.toDataURL(b,c,5);c="<img width='"+c.j.toString(10)+"' height='"+c.j.toString(10)+"' src='"+a+"'>";return d?"<a href='"+a+"' download='"+d+"'>"+c+"</a>":c}function Ge(a,b,c,d){var e=F(c,{tag:"widget",id:"widget-"+b.replace(/^.*:/g,"")}),f=E(e),g=e.va();return{url:(new sc(null,f,g,0,0,function(c,d,l,r){c.ca=a.ca;Ec(c,b,f/2+l,g/2+r,e)})).toDataURL(d,5),width:f,height:g}}
function He(a,b,c,d,e){a=Ge(a,b,c,d);b="<img width='"+a.width.toString(10)+"' height='"+a.height.toString(10)+"' src='"+a.url+"'>";return e?"<a href='"+a.url+"' download='"+e+"'>"+b+"</a>":b}function Ie(a,b,c,d){for(var e=0;e<a.controls.length;e++){var f=a.controls[e];if(f.id===b)return a=f.rc.oa-f.rc.Y,b=f.rc.ma-f.rc.aa,{url:(new sc(null,a,b,0,0,function(a){f.J(a.N,c,!1)})).toDataURL(d,5),width:a,height:b}}throw"button id not found";}
function Je(a,b,c,d,e){a=Ie(a,b,c,d);b="<img width='"+a.width.toString(10)+"' height='"+a.height.toString(10)+"' src='"+a.url+"'>";return e?"<a href='"+a.url+"' download='"+e+"'>"+b+"</a>":b}
function Tb(a,b){var c=tc(100,100),d=He(a.ja,"vpl:then",b,c);return"<!DOCTYPE html>\n<html>\n"+(a.F?"<head>\n<style>\n"+a.F+"</style>\n</head>\n":"")+"<body>\n<table class='program'>\n"+a.i.i.map(function(a){return a.Jb()?"":"<tr class='rule'>\n<td class='events'>\n<table class='events'>\n<tr class='events'>\n"+a.W.map(function(a,d){var e="block";switch(a.Z.type){case "e":e=e+" event"+(0===d?" event-main":" event-aux");break;case "s":e+=" state";break;case "c":e+=" comment"}return"<td class='"+e+
"'>"+Fe(a,b,c)+"</td>\n"}).join("")+"</tr>\n</table>\n</td>\n<td class='then'>"+d+"</td>\n<td class='actions'>\n<table class='actions'>\n<tr class='actions'>\n"+a.actions.map(function(a){var d="block";switch(a.Z.type){case "a":d+=" action";break;case "c":d+=" comment"}return"<td class='"+d+"'>"+Fe(a,b,c)+"</td>\n"}).join("")+"</tr>\n</table>\n</td>\n</tr>\n"}).join("")+"</table>\n</body>\n</html>\n"}
function Vb(a,b){var c=tc(100,100),d=Hc(a,b);a.m={disabled:!1,ba:!0,Cg:!1,isEnabled:!0,Za:!1,state:null};var e=nc(a,a.P,["vpl","top"]),f=Ic(a,a.P,["vpl","top"],d.ec,d.pg,e),g=nc(a,a.o,["vpl","bottom"]),h=Ic(a,a.o,["vpl","bottom"],d.ld,d.og,g);d="<!DOCTYPE html>\n<html>\n"+(a.F?"<head>\n<style>\n"+a.F+"</style>\n</head>\n":"")+"<body>\n<table>\n"+Na.map(function(a){switch(a.type){case "e":var d="event";break;case "s":d="state";break;case "a":d="action";break;case "c":d="comment";break;default:return""}var e=
new y(a,null,null);return"<tr class='"+d+"'>\n<td>\n"+Fe(e,b,c,a.name.replace(/ /g,"_")+".png")+"</td>\n<td>"+a.name+"</td>\n</tr>\n"}).join("")+"</table>\n<table>\n"+Object.keys(a.ja.ca).map(function(a){return"<tr><td>"+He(this.ja,a,b,c,a+".png")+"</td><td>"+a+"</td></tr>\n"},a).join("")+"</table>\n<table>\n"+f.controls.map(function(a){return"<tr><td>"+Je(f,a.id,e[a.id],c,a.id+".png")+"</td><td>"+a.id+"</td></tr>\n"},a).join("")+h.controls.map(function(a){return"<tr><td>"+Je(h,a.id,g[a.id],c,a.id+
".png")+"</td><td>"+a.id+"</td></tr>\n"},a).join("")+"</table>\n</body>\n</html>\n";a.m=null;return d};function Ke(a,b){b=(new DOMParser).parseFromString(b,"text/xml").getElementsByTagName("node");if(1>b.length)throw"empty";b=b[0].getElementsByTagName("program");if(1!==b.length)throw"program";var c="0"!==b[0].getAttribute("advanced_mode");b=b[0].getElementsByTagName("set");Oa(a);a.mode=c?"a":"b";for(var d=0;d<b.length;d++){var e=Le(b[d],c,function(){a.yb()});a.i.push(e)}}
function Le(a,b,c){a=a.getElementsByTagName("block");for(var d=new sa,e=0;e<a.length;e++){var f=a[e],g=b;f.getAttribute("type");var h=f.getAttribute("name"),m=Me[h],l=Ne[m];if(void 0===l)throw"unknown AESL block "+h;h=[];for(var r=0;1E3>r;r++){var n=f.getAttribute("value"+r);if(null===n)break;h.push(l.Ig?n:parseInt(n,10))}g&&l.be&&(m=l.be,l=Ne[m]);f=ra(m);g=new y(f,null,null);l=l.fb?l.fb(h):h;f.Td?f.Td(g,l):g.c=l;ua(d,g,null,c,!0)}return d}
var Ub=function(){var a=null;return function(b,c,d){null===a&&(a=document.createElement("a"),document.body.appendChild(a),a.style.display="none");d=d||"application/xml";if("function"===typeof window.Blob&&window.URL){var e=new window.Blob([b],{type:d});e=window.URL.createObjectURL(e)}else e="data:"+d+";base64,"+window.btoa(b);var f=a;d=d||"application/xml";"function"===typeof window.Blob&&window.URL?(b=new window.Blob([b],{type:d}),b=window.URL.createObjectURL(b)):b="data:"+d+";base64,"+window.btoa(b);
f.href=b;f.download=c||"untitled.xml";a.click();"string"!==typeof e&&window.URL.revokeObjectURL(e)}}();function Oe(){return[]}
var Ne={accelerometer:{name:"acc",lb:function(a){return[[0,2,1][a[0]],-a[1]]},fb:function(a){return[[0,2,1][a[0]],-a[1]]}},"bottom color":{name:"colorbottom",lb:function(a){return a.map(function(a){return Math.round(32*a)})},fb:function(a){return a.map(function(a){return a/32})}},button:{name:"button",lb:function(a){return[1,4,2,3,0].map(function(b){return a[b]?1:0}).concat(0,0)},fb:function(a){return[4,0,2,3,1].map(function(b){return 0!==a[b]})}},clap:{name:"clap",lb:Oe,fb:Oe},"color state":{name:"colorstate",
he:!0,lb:function(a){return a.map(function(a){return Math.floor(2.99*a)})},fb:function(a){return a.map(function(a){return a/2})}},"counter comparison":{name:"countercmp",he:!0,lb:function(a){return a},fb:function(a){return a}},ground:{name:"proxground",be:"ground adv",lb:function(a){return a.map(function(a){return 0<a?1:0>a?2:0}).concat(400,450)},fb:function(a){return a.slice(0,2).map(function(a){return 2===a?-1:a})}},"ground adv":{name:"proxground",lb:function(a){return a.slice(0,2).map(function(a){return 0<
a?1:0>a?2:0}).concat(a.slice(2).map(function(a){return Math.round(1E3*a)}))},fb:function(a){return a.slice(0,2).map(function(a){return 2===a?-1:a}).concat(a.slice(2).map(function(a){return Math.max(0,Math.min(1,a/1E3))}))}},"horiz prox":{name:"prox",be:"horiz prox adv",lb:function(a){return a.map(function(a){return 0<a?1:0>a?2:0}).concat(1E3,2E3)},fb:function(a){return a.slice(0,7).map(function(a){return 2===a?-1:a})}},"horiz prox adv":{name:"prox",lb:function(a){return a.slice(0,7).map(function(a){return 0<
a?1:0>a?2:0}).concat(a.slice(7).map(function(a){return Math.round(700+3300*a)}))},fb:function(a){return a.slice(0,7).map(function(a){return 2===a?-1:a}).concat(a.slice(7).map(function(a){return Math.max(0,Math.min(1,(a-700)/3300))}))}},init:{name:"init",he:!0,lb:Oe,fb:Oe},motor:{name:"move",lb:function(a){return a.map(function(a){return Math.round(500*a)})},fb:function(a){return a.map(function(a){return a/500})}},move:{name:"move2"},notes:{name:"sound",lb:function(a){for(var b=[],c=0;6>c;c++)b.push(0===
a[2*c+1]?517:a[2*c]+256*a[2*c+1]);return b},fb:function(a){for(var b=[],c=0;6>c;c++)b.push(a[c]%256),b.push(517<=a[c]?0:Math.floor(a[c]/256));return b}},"set counter":{name:"setcounter",he:!0,lb:function(a){return a},fb:function(a){return a}},"set state":{name:"setstate",lb:function(a){return a.map(function(a){return 0<a?1:0>a?2:0})},fb:function(a){return a.map(function(a){return 2===a?-1:a})}},"set timer":{name:"timer",lb:function(a){return[Math.round(1E3*a[0])]},fb:function(a){return[a[0]/1E3]}},
"set timer log":{name:"timerlog",he:!0,lb:function(a){return[Math.round(1E3*a[0])]},fb:function(a){return[a[0]/1E3]}},state:{name:"statefilter",lb:function(a){return a.map(function(a){return 0<a?1:0>a?2:0})},fb:function(a){return a.map(function(a){return 2===a?-1:a})}},"top color":{name:"colortop",lb:function(a){return a.map(function(a){return Math.round(32*a)})},fb:function(a){return a.map(function(a){return a/32})}},tap:{name:"acc",be:"accelerometer",lb:function(){return[0,0]},fb:Oe},timer:{name:"timeout",
lb:Oe,fb:Oe},"picture comment":{name:"commentpict",he:!0,Ig:!0,lb:function(a){return[a[1]]},fb:function(a){return[!1,a[0]]}}},Pe={},Qe;for(Qe in Ne)if(Ne.hasOwnProperty(Qe)){var Re=Ne[Qe].name;Pe[Re]&&Ne[Pe[Re]].be||(Pe[Re]=Qe)}var Me=Pe;function Se(){this.sb=document.getElementById("editor");this.sb.value="";this.b=this.sb.parentElement;var a=window.innerWidth,b=window.getComputedStyle(this.sb);this.sb.style.width=a-10-parseInt(b.paddingLeft,10)-parseInt(b.paddingRight,10)+"px";this.sb.style.border="0px";this.sb.style.outline="none";this.sb.style.resize="none";this.sb.style.whiteSpace="pre";this.sb.setAttribute("wrap","off");this.h=null}Se.prototype.Le=function(a,b){this.sb.setSelectionRange(a,b)};
Se.prototype.resize=function(){var a=this.b.getBoundingClientRect().width,b=window.getComputedStyle(this.sb);this.sb.style.width=a-10-parseInt(b.paddingLeft,10)-parseInt(b.paddingRight,10)+"px"};function Te(a,b){a.sb.value=b;window.getComputedStyle(a.sb)};function Ue(a,b,c){this.ia=b;this.language=c||"aseba";this.b="";this.vc=!0;this.Sc=this.Qd=this.zf=null;this.Gb=!1;this.Ba=a.Ba||new Ba;this.Tb=new Se;this.Tb.sb.readOnly=this.vc;this.Tb.h=function(a){window.vplBreakpointsFunction&&window.vplBreakpointsFunction(a)};var d=this;this.Ha=new wb(a.ca,{ea:a.ea});document.getElementById("editor").addEventListener("input",function(){Ib(a);Ve(d)===a.i.ia&&(a.i.ia=!a.i.ia,Fb(a))},!1);var e=document.getElementById("editor");e&&document.getElementById("editor").addEventListener("keydown",
function(a){if(9===a.keyCode){a.preventDefault();a.b=!0;a=e.value;var b=this.selectionStart;a=a.slice(0,b)+"\t"+a.slice(this.selectionEnd);Te(d.Tb,a);this.selectionStart=this.selectionEnd=b+1;return!1}return!0},!1)}function We(a,b){a.zf=b}v=Ue.prototype;v.Wd=function(){this.Ba.b=[]};function Xe(a){var b="teacher"===Ua("role");a.Gb=b}function Eb(a,b,c){null===b?Te(a.Tb,a.b):(a.b=b,Te(a.Tb,b));c||(a.Sc=null)}v.Qb=function(){return document.getElementById("editor").value.trim()};
function Ve(a){return a.Qb()===a.b.trim()}v.Le=function(a,b){this.Tb.Le(a,b)};function Ye(a){var b=F(a.Ha.ea,{tag:"button",da:["src","top"]});b.height=a.Ha.A.g;a=F(a.Ha.ea,{tag:"toolbar",da:["src","top"]});a.height=b.va();return{height:a.height,va:a.va()}}
function Ib(a){var b=a.K;b.Ha.ab=[];var c=b.vf||"src:close !space src:new src:save !space src:language src:disass !stretch src:run src:stop !stretch src:sim src:vpl !space src:locked !stretch src:teacher-reset src:teacher".split(" "),d=nc(a,c,["src","top"]),e=Ye(b).height,f=Kc(b.Ha);Jc(b.Ha);var g=F(b.Ha.ea,{tag:"view",da:["src"]});F(b.Ha.ea,{tag:"button",da:["src","top"]});var h=F(b.Ha.ea,{tag:"separator",da:["src","top"]}),m=F(b.Ha.ea,{tag:"toolbar",da:["src","top"]});g.cc(f.width);g.Rb(f.height);
g.setPosition(0,0);m.cc(g.width);m.height=e;m.setPosition(g.x,g.y);ac(b.Ha,function(a){g.J(a)});e=new Xb(b.Ha);lc(e,a,c,["src","top"],b.fc||dc,b.pe||ic);Zb(e,m,d,h);$b(e,m,d);C(b.Ha)}function Cb(a,b){(a.vc=b)&&Te(a.Tb,a.b);a.Tb.sb.readOnly=b;Ib(window.vplApp)}
v.resize=function(a,b){this.Ha.resize(a,b);a=this.Ha.b.getBoundingClientRect();b=document.getElementById("src-editor");var c=Kc(this.Ha);var d=F(this.Ha.ea,{tag:"view",da:["src"]});d.cc(c.width);d.Rb(c.height);d.setPosition(0,0);var e=Ye(this);c=d.x;var f=d.y+e.va;var g=d.width;d=d.height-e.va;b.style.left=a.left+a.width*this.Ha.ua.Y+c+"px";b.style.width=g+"px";b.style.top=a.top+a.height*this.Ha.ua.aa+f+"px";b.style.height=d+"px";this.Tb.resize();Ib(window.vplApp)};
v.focus=function(){document.getElementById("editor").focus();C(this.Ha)};function Ze(a){a.b.add("src:close",{action:function(a){Bb(a,["src"],{ye:!0})},object:a,ba:function(a){return 1<a.za.length&&0<=a.za.indexOf("src")}});a.b.add("src:new",{action:function(a){Te(a.K.Tb,"");C(a.K.Ha)},isEnabled:function(a){return!a.K.vc&&0<a.K.Qb().length},object:a});a.b.add("src:save",{action:function(a){var b=Va(a.i,{ed:!1,gd:!0});Ub(b,a.i.filename||"vpl.json","application/json")},isEnabled:function(a){return 0<a.K.Qb().length},object:a});a.b.add("src:vpl",{action:function(a){a.vd?Bb(a,
["vpl"],{yd:!0}):Bb(a,["vpl"],{td:"src"})},isEnabled:function(a){return Ve(a.K)},object:a,ba:function(a){return!a.K.ia&&0>a.za.indexOf("vpl")}});a.b.add("src:locked",{action:function(a){Cb(a.K,!a.K.vc);C(a.K.Ha);a.K.vc&&(a.i.ia=!1,Fb(a))},isEnabled:function(a){return null===a.K.Sc},Za:function(a){return a.K.vc},object:a,ba:function(a){return!a.K.ia}});a.b.add("src:language",{action:function(a){var b=a.K.zf();a.K.language=b.language;a.K.vc&&Eb(a.K,b.code)},isEnabled:function(a){return null===a.K.Sc},
getState:function(a){return a.K.language},object:a,ba:function(a){return null!=a.K.zf}});a.b.add("src:disass",{action:function(a){if(null!==a.K.Sc)Eb(a.K,a.K.Sc),a.K.Tb.sb.readOnly=a.K.vc;else{var b=a.K.Qb(),d=a.K.Qd(a.K.language,b);null!==d&&(Eb(a.K,d,!0),a.K.Tb.sb.readOnly=!0,a.K.Sc=b)}Ib(a)},isEnabled:function(a){return null!=a.K.Qd&&null!==a.K.Qd(a.K.language,"")},Za:function(a){return null!==a.K.Sc},getState:function(a){return a.K.language},object:a,ba:function(a){return null!==a.K.Qd}});a.b.add("src:run",
{action:function(a){var b=a.K.Qb();a.$a[a.Ma].xb.nc(b,a.K.language)},getState:function(a){return 0===a.K.Qb().length?"empty":"canLoad"},object:a,ba:function(a){return 0<=a.Ma}});a.b.add("src:stop",{action:function(a){Lb(a)},isEnabled:function(a){return Mb(a)},object:a,ba:function(a){return 0<=a.Ma}});a.b.add("src:connected",{isEnabled:function(a){return!a.i.ia&&0<=a.Ma&&a.$a[a.Ma].xb.isConnected()},object:a,ba:function(a){return 0<a.$a.length}});a.b.add("src:sim",{action:function(a){a.vd?Bb(a,["sim"],
{yd:!0}):Bb(a,["sim"],{td:"src"})},object:a,ba:function(a){return null!=a.$a.find(function(a){return"sim"===a.name})&&null!=a.O&&0>a.za.indexOf("sim")}});a.b.add("src:teacher-reset",{action:function(a){a.K.Wd();Ib(a)},object:a,xc:!0,ba:function(a){return a.K.Gb&&a.K.Ba.Ua}});a.b.add("src:teacher",{action:function(a){a.K.Ba.Ua=!a.K.Ba.Ua;Ib(a)},Za:function(a){return a.K.Ba.Ua},object:a,xc:!0,ba:function(a){return a.K.Gb}})};function $e(a){var b=["vpl:message-error","vpl:message-warning"];return function(c,d,e,f,g,h,m,l,r){function n(a){if(void 0==a)return!0;for(var b=0;b<a.length;b++)switch(a[b]){case "pressed":if(!l||!h)return!1;break;case "unpressed":if(l&&h)return!1;break;case "selected":if(!m)return!1;break;case "unselected":if(m)return!1;break;case "disabled":if(h)return!1;break;case "enabled":if(!h)return!1;break;default:if("="===a[b][0]&&r.toString()!==a[b].slice(1))return!1}return!0}var k=F(f,{tag:"button",da:g,
id:c.replace(/:/g,"-")});if(a.buttons)for(var q=0;q<a.buttons.length;q++)if(a.buttons[q].name===c&&n(a.buttons[q].state)){a.buttons[q].draw.forEach(function(b){if(b.uri){var c=Qb(b.uri);d.save();b.alpha&&(d.globalAlpha=b.alpha);a.rb[c.Ic].J(d,{rd:c.id});b.debug&&(d.fillStyle="black",d.textAlign="center",d.textBaseline="middle",d.fillText(b.debug,k.width/2,k.height/2));d.restore()}b.js&&(b=new Function("ctx",b.js),d.save(),d.scale(k.width,k.height),d.beginPath(),b(d),d.restore())});return}0<=b.indexOf(c)?
dc(c,d,e,f,g,h,m,l,r):(d.fillStyle="brown",d.fillRect(0,0,k.width,k.height),d.fillStyle="white",d.textAlign="left",d.textBaseline="top",d.font=Math.round(k.height/6).toString(10)+"px sans-serif",d.fillText(c,.02*k.width,.02*k.height),d.fillText((l?"pr ":"")+(m?"sel ":"")+(h?"":"dis"),.02*k.width,.22*k.height),r&&d.fillText("="+r,.02*k.width,.42*k.height))}}
function af(a){return function(b,c){if(a.buttons)for(var d=0;d<a.buttons.length;d++){var e=a.buttons[d];if(e.name===b&&(void 0==e.state||0>e.state.indexOf("pressed")&&0>e.state.indexOf("selected")&&0>e.state.indexOf("disabled")))return b=Qb(e.draw[0].uri),le(a.rb[b.Ic],b.id)}return{Y:0,oa:c.g,aa:0,ma:c.g}}}
function bf(a){function b(b){for(var c=0;c<a.widgets.length;c++)if(a.widgets[c].name===b)return a.widgets[c];return null}if(void 0==a.widgets)return{};var c={};["vpl:then","vpl:error","vpl:warning","vpl:moreHigh","vpl:moreLow"].forEach(function(d){var e=b(d);if(e){var f=Qb(e.draw[0].uri),g=le(a.rb[f.Ic],f.id);c[d]=function(b,c,d,f){e.draw.forEach(function(c){if(c.uri){var d=Qb(c.uri);c.alpha&&(b.globalAlpha=c.alpha);b.save();var e=Math.min(f.width/(g.oa-g.Y),f.height/(g.ma-g.aa));b.scale(e,e);b.translate(-(g.Y+
g.oa)/2,-(g.aa+g.ma)/2);a.rb[d.Ic].J(b,{rd:d.id});b.restore();c.debug&&(b.fillStyle="black",b.textAlign="center",b.textBaseline="middle",b.fillText(c.debug,0,0))}c.js&&(c=new Function("ctx",c.js),b.save(),b.scale(f.width,f.height),b.beginPath(),c(b),b.restore())})}}});return c};function cf(a){this.o=a&&a.nc?a.nc:null;this.h=a&&a.bd?a.bd:null;this.m=a&&a.isConnected?a.isConnected:null;this.b=a&&a.isEnabled?a.isEnabled:null;this.Ad=a&&a.Ad?a.Ad:"aseba";this.languages=a&&a.languages?a.languages:[this.Ad];this.state=a&&a.state?a.state:null}cf.prototype.isConnected=function(){return null==this.m||this.m()};cf.prototype.isEnabled=function(a){return null!=this.o&&0<=this.languages.indexOf(a)&&(null==this.b||this.b(a))};cf.prototype.bd=function(a){this.h&&this.h(a)};
cf.prototype.nc=function(a,b){this.isEnabled(b)&&this.o(b,a)};function zb(a,b){this.o=a;this.m=document.createElement("div");this.m.style.width="100%";this.m.style.height="100%";this.m.style.position="fixed";this.m.style.top="0";this.m.style.left="0";this.m.style.zIndex="1000";this.m.style.backgroundColor="rgba(1,1,1,0.5)";this.m.style.display="none";this.h=document.createElement("div");this.h.style.width="80%";this.h.style.height="80%";this.h.style.position="fixed";this.h.style.top="50%";this.h.style.left="50%";this.h.style.backgroundColor="white";this.h.style.padding=
"2em";this.m.appendChild(this.h);document.body.appendChild(this.m);this.b=null;if(!b){this.b=document.createElement("div");this.b.style.position="absolute";this.b.style.width="32px";this.b.style.height="32px";this.b.style.top="0";this.b.style.left="0";this.b.textContent="\u00d7";this.b.style.font="bold 30px sans-serif";this.b.style.textAlign="left";this.b.style.padding="5px";this.b.style.paddingLeft="10px";var c=this;this.b.addEventListener("click",function(){c.lc()},!1)}}
zb.prototype.show=function(){this.h.innerHTML=this.o;this.b&&this.h.appendChild(this.b);this.m.style.display="block";Kb(this)};zb.prototype.lc=function(){this.m.style.display="none"};function Kb(a){var b=a.h.getBoundingClientRect();a.h.style.marginLeft=-b.width/2+"px";a.h.style.marginTop=-b.height/2+"px"};function Sb(a,b){try{Wa(a.i,b,function(a){if(0>this.za.indexOf(a))if(1===this.za.length)Bb(this,[a]);else{var b=this.za.slice();b[0<=b.indexOf("vpl")?b.indexOf("vpl"):0<=b.indexOf("src")?b.indexOf("src"):0]=a;Bb(this,b)}0<=this.za.indexOf("vpl")&&this.ja.na()})}catch(c){}}
function df(a,b){var c=/^[^.]+\.(.*)$/.exec(b.name);c=c?c[1]:"";var d=new window.FileReader;switch(c.toLowerCase()){case "aesl":case "json":return d.onload=function(c){c=c.target.result;var d=b.name;try{Ke(a.i,c)}catch(g){Sb(a,c)}a.i.filename=d;a.ja.na()},d.readAsText(b),!0}return!1}
function ef(a,b){var c=/^[^.]+\.(.*)$/.exec(b.name);c=c?c[1]:"";var d=new window.FileReader;switch(c.toLowerCase()){case "svg":case "png":case "jpg":case "gif":a.O&&("obstacle"===a.O.Yb?(d.onload=function(b){ff(a,b.target.result)},d.readAsText(b)):(d.onload=function(b){b=b.target.result;var c=new Image;c.addEventListener("load",function(){gf(a,c)});c.src=b},d.readAsDataURL(b)))}};function hf(a){var b=this;this.b=document.createElement("div");this.b.style.width="100%";this.b.style.height="100%";this.b.style.position="fixed";this.b.style.top="0";this.b.style.left="0";this.b.style.zIndex="1000";this.b.style.backgroundColor="rgba(1,1,1,0.5)";this.b.style.display="none";this.h=document.createElement("div");this.h.style.width="40em";this.h.style.position="fixed";this.h.style.top="50%";this.h.style.left="50%";this.h.style.backgroundColor="white";this.h.style.padding="2em";this.b.appendChild(this.h);
document.body.appendChild(this.b);var c=document.createElement("p");c.textContent="Open program file";this.h.appendChild(c);c=document.createElement("table");c.style.width="100%";this.h.appendChild(c);var d=document.createElement("tr");c.appendChild(d);var e=document.createElement("td");d.appendChild(e);this.input=document.createElement("input");this.input.setAttribute("type","file");this.input.setAttribute("accept",".aesl,.json");this.input.style.width="35em";e.appendChild(this.input);e=document.createElement("td");
e.align="right";d.appendChild(e);d=document.createElement("input");d.setAttribute("type","button");d.setAttribute("value","OK");d.addEventListener("click",function(){var c=b.input.files[0];c&&df(a,c);b.lc()},!1);e.appendChild(d);e.appendChild(document.createTextNode("\u00a0\u00a0"));d=document.createElement("input");d.setAttribute("type","button");d.setAttribute("value","Cancel");d.addEventListener("click",function(){b.lc()},!1);e.appendChild(d);e=document.createElement("div");e.style.position="absolute";
e.style.width="32px";e.style.height="32px";e.style.top="0";e.style.left="0";e.textContent="\u00d7";e.style.font="bold 30px sans-serif";e.style.textAlign="left";e.style.padding="5px";e.style.paddingLeft="10px";e.addEventListener("click",function(){b.lc()},!1);c.appendChild(e)}hf.prototype.show=function(){this.b.style.display="block";var a=this.h.getBoundingClientRect();this.h.style.marginLeft=-a.width/2+"px";this.h.style.marginTop=-a.height/2+"px"};hf.prototype.lc=function(){this.b.style.display="none"};function jf(a,b,c){this.b=a;this.o=b;this.h=null;this.m=c}
jf.prototype.connect=function(){var a=this;this.h=new WebSocket(this.o);this.h.addEventListener("open",function(){a.h.send(JSON.stringify({sender:{type:"vpl",sessionid:a.m,role:a.b.i.Gb?"teacher":"student"},type:"hello"}));window.addEventListener("unload",function(){a.h.send(JSON.stringify({sender:{type:"vpl",sessionid:a.m,role:a.b.i.Gb?"teacher":"student"},type:"bye"}))})});this.h.addEventListener("message",function(b){try{var c=JSON.parse(b.data);switch(c.type){case "cmd":var d=c.data.cmd,e=c.data.selected,
f=c.data.state,g=a.b.b;if(g.ba(d)&&pb(g,d)&&g.isEnabled(d))if(void 0!==e){var h=g.find(d),m;if(m=h)h.h?e===h.Za()?m=!0:(rb(h,void 0),m=e===h.Za()):m=!1;m&&qb(g,d)}else if(void 0!==f){var l=g.find(d);l&&sb(l,f)&&qb(g,d)}else{var r=g.find(d);r&&(rb(r,void 0),qb(g,d))}zd(a.b.ja);break;case "file":var n=c.data.content;switch(c.data.kind){case "vpl":/^[\s]*{/.test(n)?Sb(a.b,n):(Ke(a.b.i,n),a.b.ja.na());a.b.i.filename=c.data.name||null;zd(a.b.ja);break;case "about":yb(a.b,n);break;case "help":Ab(a.b,n);
break;case "suspend":var k=a.b,q=k.dc;q&&k.Dd&&k.Dd.lc();k.Dd=n?new zb(n,!0):null;n&&q&&k.Dd.show()}}}catch(p){console.info(p)}});Nb(this.b,function(b){a.log(b)})};jf.prototype.log=function(a){if("cmd"===a.type&&a.data&&0<=["vpl:run"].indexOf(a.data.cmd)){var b=Va(this.b.i,{ed:!1,gd:!0});this.h.send(JSON.stringify({sender:{type:"vpl",sessionid:this.m},type:"file",data:{name:this.b.i.filename,content:b}}))}this.h.send(JSON.stringify({sender:{type:"vpl",sessionid:this.m},type:"log",data:a||null}))};var qd=null;document.addEventListener("mousemove",function(a){null!==qd&&(qd(a,!1),a.preventDefault())},!1);document.addEventListener("mouseup",function(a){null!==qd&&(qd(a,!0),qd=null,a.preventDefault())},!1);var wd=null;document.addEventListener("touchmove",function(a){a.preventDefault();null!==qd&&(wd=a.targetTouches[0],qd(wd,!1));return!1},{capture:!1,passive:!1});document.addEventListener("touchend",function(a){null!==qd&&(qd(wd,!0),qd=null,a.preventDefault());return!1},!1);
function kf(a,b,c,d){var e=0<=a.indexOf("/")?a.replace(/\/[^/]*$/,"/"):"",f={},g=new XMLHttpRequest;g.addEventListener("load",function(){if(200===g.status){f[a]=g.responseText;var h=JSON.parse(g.responseText),m=b(h),l=m.length,r=!1;m.forEach(function(b){var g=new XMLHttpRequest;g.addEventListener("load",function(){200===g.status?(f[b]=g.responseText,l--,r||0!==l||c(h,f)):r||(r=!0,d("HTTP error "+g.status))});g.addEventListener("error",function(){r||(r=!0,d("XMLHttpRequest error for "+a))});g.open("GET",
e+b);g.send()})}else d("HTTP error "+g.status)});g.addEventListener("error",d);g.open("GET",a);g.send()}
function lf(a,b,c,d){try{var e=document.getElementById(a).textContent,f=JSON.parse(e),g={};f.svgFilenames&&f.svgFilenames.forEach(function(a){e=document.getElementById(a).textContent;g[a]=e});f.overlays&&f.overlays.forEach(function(a){e=document.getElementById(a).textContent;g[a]=e});f.css&&f.css.forEach(function(a){e=document.getElementById(a).textContent.trim();g[a]=e});c(f,g)}catch(h){d(h)}}
function Ua(a){var b=/^[^?]*\?([^#]*)/.exec(document.location.href);if(b=b&&b[1]){b=b.split("&").map(function(a){return a.split("=").map(function(a){return decodeURIComponent(a)})});for(var c=0;c<b.length;c++)if(b[c][0]===a)return b[c][1]}return""}function mf(a){return(document.location.hash||"#").slice(1).split("&").map(function(a){return a.split("=")}).reduce(function(a,c){a[c[0]]=c[1];return a},{})[a]||null}
function nf(a){a&&a.overlays&&(a.blocks=a.blocks||[],a.buttons=a.buttons||[],a.widgets=a.widgets||[],a.overlays.forEach(function(b){b=JSON.parse(a.ne[b]);for(var c in b)if(b.hasOwnProperty(c))switch(c){case "blocks":case "buttons":case "widgets":a[c]=a[c].concat(b[c]);break;case "toolbars":for(var d in b[c])b[c].hasOwnProperty(d)&&(a[c]=a[c]||{},a[c][d]=b[c][d])}}));var b=new tb;window.vplApp=b;b.username=Ua("user")||window.vplUsername||b.username;a&&Pb&&(b.i.message=Pb(a),b.i.message&&window.console.info(b.i.message));
a&&a.css&&(a.css.forEach(function(c){Qc(b.ea,c,a.ne[c])}),b.ea.defineProperties());b.Uf=new hf(b);var c=void 0==a||"classic"===Ua("appearance");b.Af="local"===Ua("storage");b.vd="false"!==Ua("multiview");var d=Ua("language");nd="true"===Ua("cssdebug");var e=dc,f=ic,g=pc;Ae&&Ae();Be&&Be();Ce&&Ce();if(a&&!c&&(null!==a.buttons&&(e=$e(a),f=af(a)),null!==a.widgets&&(g=bf(a)),null!==a.blocks))try{ze(a)}catch(fb){window.console&&window.console.error(fb)}a.miscSettings&&void 0!=a.miscSettings.basicMultiEvent&&
(Ga=1==a.miscSettings.basicMultiEvent);if(a.miscSettings&&a.miscSettings.viewRelativeSizes){var h=a.miscSettings.viewRelativeSizes;b.cb={vpl:h.vpl||1,src:h.src||1,sim:h.sim||1}}h=Ua("server");var m=Ua("session"),l="true"===Ua("adv"),r="true"===Ua("exp"),n=0,k=0,q="",p=Ua("blur").trim()||"";/^\d+$/.test(p)&&(n=parseInt(p,10)/10);p=Ua("grayscale")||"";/^\d+$/.test(p)&&(k=parseInt(p,10)/100);if(0<n||0<k)q="blur("+n.toFixed(1)+"px) grayscale("+k.toFixed(2)+")";n=1;k=0;p=!1;var u=null;p=Ua("scale").trim()||
"";/^\d+(\.\d*)?$/.test(p)&&(n=parseFloat(p));p=Ua("rotation").trim()||"";/^-?\d+(\.\d*)?$/.test(p)&&(k=parseFloat(p)*Math.PI/180);p=Ua("mirror").trim()||"";p="true"===p;if(1!==n||0!==k||p)u=[n*Math.cos(k)*(p?-1:1),n*Math.sin(k)*(p?-1:1),-n*Math.sin(k),n*Math.cos(k),0,0];d||(d=0<=b.Ma?b.$a[b.Ma].xb.Ad:"aseba");Ia();Oa(b.i,!0);b.i.Wd();n=Ua("view");p=0===n.length?["vpl"]:n.split("+");k=Ua("robot");if(0<=p.indexOf("sim")||"sim"===k)k="sim";k.replace(/[+;]/g,",").split(",").forEach(function(a){var c=
null;switch(a){case "thymio":c=of(b);c.bd(d);break;case "thymio-tdm":c=pf(b);c.bd(d);break;case "sim":c=qf(b,{Mf:q,Nf:u}),c.bd(d)}c&&b.$a.push({name:a,xb:c})});b.Ma=0<b.$a.length?0:-1;if(!na[d])throw"Unsupported language "+d;Ca(b.Ba,l?[]:["src:language"]);b.i.Bb=d;b.ja.ca=g;b.i.i.push(new sa);null!=b.h&&(b.h.ca=g);Rb(b);!c&&a&&a.toolbars&&(a.toolbars.vpl&&(b.P=a.toolbars.vpl),a.toolbars.vpl2&&(b.o=a.toolbars.vpl2));b.i.fc=e;b.i.pe=f;Ue&&document.getElementById("editor")&&(b.K=new Ue(b,b.i.ia,d),xd(b.K.Ha,
q),b.i.m=function(){return Ve(b.K)?null:b.K.Qb()},b.i.o=function(a){Eb(b.K,a)},b.K.Ha.ca=g,Ze(b),!c&&a&&a.toolbars&&a.toolbars.editor&&(b.K.vf=a.toolbars.editor),b.K.fc=e,b.K.pe=f,Xe(b.K));null!=b.O&&(rf(b),!c&&a&&a.toolbars&&a.toolbars.simulator&&(b.O.vf=a.toolbars.simulator),b.O.fc=e,b.O.pe=f);q&&xd(b.ja,q);yd(b.ja,u);document.getElementsByTagName("body")[0].addEventListener("dragover",function(a){a.stopPropagation();a.preventDefault();a.dataTransfer.dropEffect="copy"},!1);document.getElementsByTagName("body")[0].addEventListener("drop",
function(a){a.stopPropagation();a.preventDefault();a=a.dataTransfer.files;1===a.length&&(a=a[0],df(b,a)||ef(b,a))},!1);if(b.O){b.O.Ba=b.Ba;var t=new Image;t.addEventListener("load",function(){b.O.We=t});t.src="data:image/svg+xml;base64,"+btoa('<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="297mm" height="210mm" viewBox="0 0 1052 744" version="1.1"><defs><linearGradient id="gradient" x1="-1000" y1="0" x2="-800" y2="0" gradientUnits="userSpaceOnUse"><stop style="stop-color:#000;stop-opacity:1;" offset="0" /><stop style="stop-color:#000;stop-opacity:0;" offset="1" /></linearGradient></defs><g transform="translate(0,-308)"><rect style="fill:url(#gradient);stroke:none" width="319" height="687" x="-1027" y="336" transform="scale(-1,1)" /><path style="fill:none;stroke:#000;stroke-width:30;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none" d="M 114,592 C 102,417 750,306 778,532 806,757 674,675 559,622 444,568 259,567 278,664 296,762 726,730 778,808 829,887 725,955 616,936 507,917 144,1083 129,837 Z" /></g></svg>');
var B=new Image;B.addEventListener("load",function(){b.O.Xe=B});B.src="data:image/svg+xml;base64,"+btoa('<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" width="297mm" height="210mm" viewBox="0 0 1052 744" version="1.1"><defs><radialGradient id="gradient" cx="400" cy="650" fx="400" fy="650" r="230" gradientTransform="matrix(1.6,0,0,1.16,-113,-75)" gradientUnits="userSpaceOnUse"><stop style="stop-color:#000;stop-opacity:1;" offset="0" /><stop style="stop-color:#000;stop-opacity:0;" offset="1" /></radialGradient></defs><g transform="translate(0,-308)"><rect style="fill:url(#gradient);fill-opacity:1;stroke:none" width="939" height="650" x="54" y="357" /></g></svg>');
b.O.Ye='<?xml version="1.0" encoding="UTF-8"?><svg xmlns="http://www.w3.org/2000/svg" width="297mm" height="210mm" viewBox="0 0 1052 744" version="1.1"><g transform="translate(0,-308)"><path style="fill:none;stroke:#000;stroke-width:6;stroke-linecap:butt;stroke-linejoin:miter" d="M 172,928 137,420 763,371 905,688 708,981 Z" /><path style="fill:none;stroke:#949494;stroke-width:6;stroke-linecap:butt;stroke-linejoin:miter" d="m 402,754 168,91 101,-142" /><circle style="fill:none;stroke:#000;stroke-width:6" cx="531" cy="550" r="59" /></g></svg>'}if(window.vplStorageGetFunction)window.vplStorageGetFunction("vpl.json",
function(a,c){try{a&&(Wa(b.i,a,function(){Fb(b)}),b.i.filename=c&&c.filename||"vpl.json",b.i.readOnly=void 0!=c&&1==c.readOnly)}catch(ta){}});else if(b.Af)try{var A=window.localStorage.getItem("vpl.json");A&&Wa(b.i,A,function(){Fb(b)})}catch(fb){}"text"===Ua("view")?Bb(b,["src"],{ia:!0}):(Bb(b,["vpl"]),b.i.Sf=r,Ta(b.i),Fb(b),b.K&&(document.getElementById("editor").textContent=b.i.Qb(b.i.Bb)));var J=["aseba","l2","js","python"];b.K&&0<=J.indexOf(d)&&We(b.K,function(){d=J[(J.indexOf(d)+1)%J.length];
b.i.Bb=d;var a=b.i.Qb(d);return{language:d,code:a}});if(l&&b.K){var D=new sf;b.K.Qd=function(a,b){try{switch(a){case "aseba":var c=new tf(D,b);c.Mb=uf;break;case "l2":c=new vf(D,b);c.Mb=wf;break;default:return null}var d=xf(c);return yf(d)}catch(Ka){return"; "+Ka}}}a&&a.fragments&&a.fragments["about.html"]&&yb(b,a.fragments["about.html"]);a&&a.fragments&&a.fragments["help.html"]&&Ab(b,a.fragments["help.html"]);a&&a.fragments&&a.fragments["vpl-export-html.css"]&&(b.F=a.fragments["vpl-export-html.css"]);
Hb(b);zd(b.ja);window.addEventListener("resize",function(){Hb(b)},!1);b.O&&zf(b.O);if("text"===n)Bb(b,["src"],{ia:!0});else{c=["vpl","src","sim"];if(1>p.length||3<p.length||""===n)n="vpl";else for(e=0;e<p.length;e++){if(0>!c.indexOf(p[e])){n="vpl";break}for(f=0;f<e;f++)if(p[e]===p[f]){n="vpl";break}}Bb(b,p)}Hb(b);h&&(window.vplCommandServer=new jf(b,h,m),window.vplCommandServer.connect())}
window.addEventListener("load",function(){(/^https?:\/\//.test(document.location.href)?kf:lf)(Ua("ui")||"ui.json",function(a){return(a.svgFilenames||[]).concat(a.overlays||[]).concat(a.css||[])},function(a,b){a.ne={};a.rb={};a.svgFilenames&&a.svgFilenames.forEach(function(c){a.ne[c]=b[c];a.rb[c]=new me(b[c])});a.overlays&&a.overlays.forEach(function(c){a.ne[c]=b[c]});a.css&&a.css.forEach(function(c){a.ne[c]=b[c]});nf(a)},function(a){window.console&&window.console.error(a);nf()})},!1);
window.vplIsProgramChanged=function(){return 0<window.vplApp.i.zc.Ub.length};window.vplGetProgramAsJSON=function(){return Va(window.vplApp.i)};window.vplGetUIAsJSON=function(){return Va(window.vplApp.i,{ed:!0,gd:!1})};window.addEventListener("unload",function(){var a=Va(window.vplApp.i);try{window.vplStorageSetFunction?window.vplStorageSetFunction("vpl.json",a):window.vplApp.Af&&window.localStorage.setItem("vpl.json",a)}catch(b){}},!1);function Af(){this.jd=1}Af.prototype.reset=function(){};Af.prototype.resetEventListeners=function(){};Af.prototype.set=function(){};Af.prototype.get=function(){return null};Af.prototype.setClientState=function(){};Af.prototype.getClientState=function(){return null};Af.prototype.addEventListener=function(){};Af.prototype.sendEvent=function(){};Af.prototype.start=function(){this.sendEvent("init",null)};Af.prototype.setTimer=function(){};Af.prototype.getTimer=function(){return-1};
Af.prototype.loadCode=function(){};Af.prototype.shouldRunContinuously=function(){return!1};Af.prototype.run=function(){};Af.prototype.suspend=function(){};Af.prototype.resume=function(){};function K(){this.jd=1;this.cb={Y:-Infinity,oa:Infinity,aa:-Infinity,ma:Infinity};this.F=this.P=0;this.r=70;this.b=[0,0];this.h=0;this.Fe=!1;this.Mb=120;this.Cc=80;this.Hd=20;this.state={};this.qa={};this.ub=null;this.nd={};this.o=[];this.Da={};this.Dc=!1;this.ca=null;K.prototype.reset.call(this,0);K.prototype.resetEventListeners.call(this)}K.prototype=Object.create(Af.prototype);K.prototype.constructor=K;K.prototype.setPositionLimits=function(a,b,c,d){this.cb={Y:a,oa:b,aa:c,ma:d}};
K.prototype.reset=function(a){this.F=this.P=a;this.b=[0,0];this.h=0;this.state={"button.center":!1,"button.left":!1,"button.right":!1,"button.forward":!1,"button.backward":!1,"prox.ground.delta":[1,1],"prox.horizontal":[0,0,0,0,0,0,0],acc:[0,0,1],"motor.left":0,"motor.right":0,"leds.top":[0,0,0],"leds.bottom.left":[0,0,0],"leds.bottom.right":[0,0,0],"leds.circle":[0,0,0,0,0,0,0,0],sound:{}};this.Dc=!1;var b=this;this.qa={"leds.circle":function(){b.Dc=!0},sound:function(a,d){function c(){if(!(f>=d.f.length)){b.ca||
(b.ca=new (window.AudioContext||window.webkitAudioContext));var a=b.ca.createOscillator();a.type="sawtooth";a.frequency.value=d.f[f];var e=b.ca.createGain();e.connect(b.ca.destination);a.connect(e);a.start(0);var m=d.d[f]/50;e.gain.exponentialRampToValueAtTime(.01,b.ca.currentTime+m);a.stop(b.ca.currentTime+m);a.addEventListener("ended",c);f++}}if(d.f){var f=0;c()}}};this.o=[];this.dc=!1};K.prototype.resetEventListeners=function(){this.Da={}};
K.prototype.enforcePositionLimits=function(){this.b=[Math.max(this.cb.Y,Math.min(this.cb.oa,this.b[0])),Math.max(this.cb.aa,Math.min(this.cb.ma,this.b[1]))]};K.prototype.setPosition=function(a,b){this.b=a;this.h=b;this.enforcePositionLimits();this.ub&&this.ub.call(this)};K.prototype.set=function(a,b){this.state[a]=b;this.qa[a]&&this.qa[a](a,b)};K.prototype.get=function(a){return this.state[a]};K.prototype.setClientState=function(a,b){this.nd[a]=b};
K.prototype.getClientState=function(a){a=this.nd[a];a instanceof Array&&(a=a.slice());return a};K.prototype.addEventListener=function(a,b){this.Da[a]=b};K.prototype.sendEvent=function(a,b){this.Da[a]&&this.Da[a].call(this,a,b);for(var c in this.Da)if(0===c.indexOf(a+"."))this.Da[c](a,b)};K.prototype.setTimer=function(a,b,c){this.o[a]={next:this.F-this.P+b,$f:c?b:-1}};K.prototype.getTimer=function(a){return void 0===this.o[a]||0>this.o[a].next?-1:this.P+this.o[a]-this.F};
K.prototype.loadCode=function(a,b){if("js"!==a)throw"unsupported language "+a;(new Function(b)).call(this)};K.prototype.shouldRunContinuously=function(){if(this.dc)return!1;if(0!==this.get("motor.left")||0!==this.get("motor.right"))return!0;for(var a=0;a<this.o.length;a++)if(this.o[a]&&0<this.o[a].next)return!0;return!1};function Bf(a,b){return a.Fe?b*Math.sqrt(-2*Math.log(Math.random()))*Math.sin(2*Math.PI*Math.random()):0}
K.prototype.run=function(a,b){0===this.P&&this.reset(a);1!==this.jd&&(this.P-=(this.jd-1)*(a-this.F),this.F=this.jd*(this.F-a)+a);for(var c=Math.max(.01,(a-this.F)/10),d=this.b;!this.dc&&this.F<a;){c=Math.min(c,a-this.F);var e=(100*this.get("motor.left")+Bf(this,1))*c,f=(100*this.get("motor.right")+Bf(this,1))*c;if(0!==e||0!=f){if(1E-6>Math.abs(e-f)||Math.abs(e-f)<1E-4*(Math.abs(e)+Math.abs(f)))this.b=[this.b[0]+.5*(e+f)*Math.cos(this.h),this.b[1]+.5*(e+f)*Math.sin(this.h)];else{var g=(e+f)*this.r/
(e-f);e=(f-e)/(2*this.r);this.b=[this.b[0]+g*(Math.sin(this.h)-Math.sin(this.h+e)),this.b[1]-g*(Math.cos(this.h)-Math.cos(this.h+e))];this.h+=e}this.enforcePositionLimits();this.ub&&this.ub.call(this)}this.F+=c;this.sendEvent("prox",null);for(g=0;g<this.o.length;g++)this.o[g]&&0<this.o[g].next&&this.F>=this.P+this.o[g].next+Bf(this,.01)&&(this.o[g].next=0<=this.o[g].$f?this.o[g].next+this.o[g].$f:-1,this.sendEvent("timer"+g.toString(10),null))}b&&b("l",d.concat(this.b))};
K.prototype.suspend=function(){this.dc=!0};K.prototype.resume=function(a){this.dc&&(this.P+=a-this.F,this.F=a,this.dc=!1)};var Cf="shift left;shift right;add;sub;mult;div;mod;bitor;bitxor;bitand;eq;ne;gt;ge;lt;le;or;and".split(";");function Df(a){function b(a){return 32784<=a?a-65536:a}function c(a){return 2048<=a?a-4096:a}var d=[],e=a[0];d.push({Ec:0,xd:a.slice(0,1),Ge:-1,w:"dc "+a[0]});for(var f=[],g=1;g<e;g+=2)f.push({id:a[g],Ec:a[g+1]}),d.push({Ec:g,xd:a.slice(g,g+2),Ge:-1,w:"dc 0x"+a[g].toString(16)+", "+a[g+1]});for(g=e;g<a.length;g++){e={Ec:g,xd:a.slice(g,g+1),Ge:a[g]>>>12};for(var h=0;h<f.length;h++)if(f[h].Ec===g){e.id="@onevent_"+f[h].id.toString(16);break}h=a[g];switch(h>>>12){case 0:e.w="stop";break;case 1:e.w="push.s "+
((h&4095)-(h&2048?4096:0));break;case 2:e.xd=a.slice(g,g+2);e.w="push "+b(a[++g]);break;case 3:e.w="load "+(h&4095);break;case 4:e.w="store "+(h&4095);break;case 5:e.xd=a.slice(g,g+2);e.w="load "+(h&4095)+"+ind size="+a[++g];break;case 6:e.xd=a.slice(g,g+2);e.w="store "+(h&4095)+"+ind size="+a[++g];break;case 7:case 8:switch(h){case 28672:e.w="neg";break;case 28673:e.w="abs";break;case 28674:e.w="bitnot";break;case 28675:e.w="not ; not implemented";break;case 32768:e.w="sl";break;case 32769:e.w="asr";
break;case 32770:e.w="add";break;case 32771:e.w="sub";break;case 32772:e.w="mult";break;case 32773:e.w="div";break;case 32774:e.w="mod";break;case 32775:e.w="bitor";break;case 32776:e.w="bitxor";break;case 32777:e.w="bitand";break;case 32778:e.w="eq";break;case 32779:e.w="ne";break;case 32780:e.w="gt";break;case 32781:e.w="ge";break;case 32782:e.w="lt";break;case 32783:e.w="le";break;case 32784:e.w="or";break;case 32785:e.w="and";break;default:throw"Unknown instruction "+h.toString(16);}break;case 9:e.w=
"jump "+(g+c(h&4095));break;case 10:e.xd=a.slice(g,g+2);e.w="jump "+(h&256?"when":"if")+" not "+Cf[h&31]+" "+(g+b(a[g+1]))+(h&256?h&512?" (prev=true)":" (prev=false)":"");g++;break;case 11:e.w="emit id="+(h&4095)+" data="+b(a[g+1])+" count="+b(a[g+2]);break;case 12:e.w="callnat "+(h&4095);break;case 13:e.w="callsub "+(h&4095);break;case 14:e.w="ret";break;default:throw"Unknown instruction "+h.toString(16);}d.push(e)}return d}
function yf(a){return Df(a).map(function(b){var c=b.Ec.toString(10);c="    ".slice(c.length-1)+c;var d=b.xd.map(function(a){a=a.toString(16);return"000".slice(a.length-1)+a}).join(" ");d+="     ".slice(d.length-4);return(b.id?b.id+":\n":"")+c+"  "+d+"  "+b.w+(b.Ec===a[0]-2||0===b.Ge||14===b.Ge?"\n":"")}).join("\n")};function sf(){var a=Ef;this.name=a.name;this.b=a.maxVarSize;this.Ta=[];for(var b=this.Oa=0;b<a.variables.length;b++)this.Ta.push(new Ff(a.variables[b].name,a.variables[b].size,[1],this.Oa,Gf)),this.Oa+=a.variables[b].size;this.Nb=a.nativeFunctions.map(function(a,b){return{id:b,name:a.name,D:a.args}});this.ud=a.localEvents.map(function(a){return{name:a.name}})}function Hf(a,b){for(var c=0;c<a.Nb.length;c++)if(a.Nb[c].name===b)return a.Nb[c];return null}
function If(a,b){for(var c=0;c<a.Ta.length;c++)if(a.Ta[c].name===b)return a.Ta[c];return null}function Jf(a,b){if("init"===b)return 65535;for(var c=0;c<a.ud.length;c++)if(a.ud[c].name===b)return 65534-c;throw"unknown local event "+b;}function tf(a,b){this.Pb=Kf;this.Ef=!1;this.Aa=a;this.m=b;this.P=b.length;this.b=0;this.line=1;this.Ga=0;this.G=[];this.l=0;this.h=[];this.Hf=[];this.Mb=[];this.ca={};this.Va=[];this.cb=[];this.Cc=this.Dc=this.Aa.b;this.jf=!1;this.Ia=0;this.Sb=[]}
function Ff(a,b,c,d,e){this.name=a;this.size=b;this.A=c;this.offset=d;this.resultType=e}Ff.prototype.ad=function(a,b){return[12288|this.offset+(b||0)]};Ff.prototype.De=function(a,b){return[16384|this.offset+(b||0)]};Ff.prototype.ge=function(){return[20480|this.offset,this.size]};Ff.prototype.df=function(){return[24576|this.offset,this.size]};
tf.prototype.lg=function(){for(;this.b<this.P;)if(" "===this.m[this.b]||"\t"===this.m[this.b])this.b++,this.Ga++;else if("\n"===this.m[this.b])this.b++,this.Ga=0,this.line++;else if("\r"===this.m[this.b])this.b++;else if("#*"===this.m.slice(this.b,this.b+2))for(this.b+=2,this.Ga+=2;this.b<this.P&&"*#"!==this.m.slice(this.b-2,this.b);)"\n"===this.m[this.b]?(this.Ga=0,this.line++):"\r"!==this.m[this.b]&&this.Ga++,this.b++;else if("#"===this.m[this.b])for(;this.b<this.P&&"\n"!==this.m[this.b];)this.b++,
this.Ga++;else break};function Lf(a,b){a.cb.push(b.length-1)}function Mf(a,b,c){if(0===a.cb.length)throw"internal";void 0===c&&(c=b.length);a=a.cb.pop();b[a]=36864===b[a]?b[a]+(c-a&4095):c-a+1&65535}tf.prototype.nd=function(a,b,c,d,e){var f;a:{for(f=0;f<this.Va.length;f++)if(this.Va[f].name===a){f=!0;break a}for(f=0;f<this.Aa.Ta.length;f++)if(this.Aa.Ta[f].name===a){f=!0;break a}f=!1}if(f)throw'duplicate variable declaration "'+a+'"';this.Va.push(new Ff(a,b,c,d,e))};
function Nf(a,b){for(var c=a.Va.length-1;0<=c;c--)if(a.Va[c].name===b.name)return a.Va[c];for(c=0;c<a.Aa.Ta.length;c++)if(a.Aa.Ta[c].name===b.name)return a.Aa.Ta[c];throw"unknown variable "+b.name+" "+L(b.head);}function Of(a,b){for(var c=0;c<a.Mb.length;c++)if(a.Mb[c].name===b)return a.Mb[c];return null}function Pf(a,b){a.Cc-=b;return a.Cc}tf.prototype.ub=function(){return[]};var Qf="== != <= >= |= ^= &= *= /= %= += -= <<= >>= ++ -- ( ) [ ] - ~ * / % + << >> & ^ | > < = , : abs and callsub call const do elseif else emit end for if in not onevent or return step sub then var when while".split(" ");
function Rf(a,b,c){this.kd=a;this.Tc=b;this.Rc=c}function L(a){return"line "+a.Tc.toString()+" col "+a.Rc.toString()}function Sf(a,b,c,d){Rf.call(this,a,b,c);this.n=d}Sf.prototype=Object.create(Rf.prototype);Sf.prototype.constructor=Sf;function Tf(a,b,c,d){Rf.call(this,a,b,c);this.n=d}Tf.prototype=Object.create(Sf.prototype);Tf.prototype.constructor=Tf;function Uf(a,b,c,d){Rf.call(this,a,b,c);this.name=d}Uf.prototype=Object.create(Rf.prototype);Uf.prototype.constructor=Uf;
function Vf(a,b,c,d){Rf.call(this,a,b,c);this.name=d}Vf.prototype=Object.create(Rf.prototype);Vf.prototype.constructor=Vf;
tf.prototype.Ve=function(a){for(;;){a:{var b=(b=a)||Qf;this.lg();if(this.b>=this.P)var c=null;else{for(var d=0;d<b.length;d++)if(c=b[d].length,this.m.slice(this.b,this.b+c)===b[d]&&!/[a-zA-Z0-9_.]{2}/.test(this.m.slice(this.b+c-1,this.b+c+1))){b=new Vf(this.b,this.line,this.Ga,b[d]);this.b+=c;this.Ga+=c;c=b;break a}c=0;if("0x"===this.m.slice(this.b,this.b+2)){for(this.b+=2;this.b+c<this.P&&/[0-9a-fA-F]/.test(this.m[this.b+c]);)c++;if(0===c)throw"hexadecimal number syntax error";b=parseInt(this.m.slice(this.b,
this.b+c),16);b=new Sf(this.b,this.line,this.Ga,b);this.b+=c;this.Ga+=2+c}else if("0b"===this.m.slice(this.b,this.b+2)){for(this.b+=2;this.b+c<this.P&&/[01]/.test(this.m[this.b+c]);)c++;if(0===c)throw"binary number syntax error";b=parseInt(this.m.slice(this.b,this.b+c),2);b=new Sf(this.b,this.line,this.Ga,b);this.b+=c;this.Ga+=2+c}else if(/[0-9]/.test(this.m[this.b])){for(;this.b+c<this.P&&/[0-9]/.test(this.m[this.b+c]);)c++;if(this.Ef&&this.b+c<this.P&&"."===this.m[this.b+c]){for(c++;this.b+c<this.P&&
/[0-9]/.test(this.m[this.b+c]);c++);b=parseFloat(this.m.slice(this.b,this.b+c));b=new Tf(this.b,this.line,this.Ga,b)}else b=parseInt(this.m.slice(this.b,this.b+c),10),b=new Sf(this.b,this.line,this.Ga,b);this.b+=c;this.Ga+=c}else if(/[a-zA-Z_]/.test(this.m[this.b])){for(;this.b+c<this.P&&/[a-zA-Z0-9_.]/.test(this.m[this.b+c]);)c++;if(0===c)throw"name syntax error";b=new Uf(this.b,this.line,this.Ga,this.m.slice(this.b,this.b+c));this.b+=c;this.Ga+=c}else throw"syntax error line "+this.line.toString()+
" col "+this.Ga.toString();c=b}}if(null===c)break;this.G.push(c)}};function Wf(a,b,c,d){this.mg=a;this.line=b;this.Ga=c;this.Ec=d}function Xf(a,b,c){(b=b.head||b.children[0]&&b.children[0].head)&&a.Sb.push(new Wf(b.kd,b.Tc,b.Rc,void 0===c?a.Ia:c))}function M(a){this.head=a;this.children=[];this.jb=0;this.resultType=Yf;this.qb=!0}function Zf(a,b){for(var c=0;c<a.length;c++)a[c]=a[c].H(b)}M.prototype.H=function(){return this};M.prototype.Na=function(a){this.children.forEach(function(b){b.Na(a)})};
M.prototype.F=function(a){this.Na(a);for(var b=0;b<this.children.length;b++)this.children[b]=this.children[b].F(a);return this};function O(a,b){M.call(this,a);this.n=void 0===b?this.head.n:b;this.resultType=Gf}O.prototype=Object.create(M.prototype);O.prototype.constructor=O;O.prototype.Na=function(){this.jb=1};function $f(a){a&=65535;return 32768<=a?a-65536:a}function ag(a,b){O.call(this,a,b);this.resultType=Q}ag.prototype=Object.create(O.prototype);ag.prototype.constructor=ag;
function R(a){M.call(this,a);this.name=a.name;this.b=!1}R.prototype=Object.create(M.prototype);R.prototype.constructor=R;R.prototype.Na=function(a){a.ca.hasOwnProperty(this.name)?(this.jb=1,this.resultType=a.ca[this.name].resultType):(a=Nf(a,this),this.jb=a.size,this.resultType=a.resultType)};R.prototype.H=function(a){return a.ca.hasOwnProperty(this.name)?a.ca[this.name].resultType===Q?new ag(this.head,a.ca[this.name].V):new O(this.head,a.ca[this.name].V):this};
function bg(a){var b=new R(a.head);b.resultType=a.resultType;b.b=!0;return b}var Yf="?",Gf="n",Q="fx";function S(a,b,c,d){M.call(this,a);this.type=b;this.resultType=c?c.resultType:Yf;this.Ca=c;this.children=d||[]}S.prototype=Object.create(M.prototype);S.prototype.constructor=S;
S.prototype.Na=function(a){M.prototype.Na.call(this,a);for(var b=1,c=0;c<this.children.length;c++)if(1===b)b=this.children[c].jb;else if(1!==this.children[c].jb&&this.children[c].jb!==b)throw"incompatible sizes "+L(this.head);this.jb=b;this.Ca&&this.Ca.la&&(this.resultType=this.Ca.la(a,this,this.children.map(function(a){return a.resultType})))};S.prototype.H=function(a){this.children=this.children.map(function(b){return b.H(a)});return this.Ca&&this.Ca.H?this.Ca.H(this,a):this};
S.prototype.F=function(a){var b=M.prototype.F.call(this,a);if(b.type===U&&b.Ca.priority===cg&&(b.children[1]instanceof dg||b.children[1]instanceof R&&1!==b.children[1].jb)){var c=b.children[0];if(!(c instanceof R)||b.qb)throw"bad array assignment "+L(b.head);for(var d=b.children[1],e=new eg(b.head),f=0;f<d.jb;f++){var g=c;1<d.jb&&(g=new fg(c.head,[new O(c.head,f)]),g.resultType=c.resultType);if(d instanceof dg)var h=d.children[f];else h=new fg(d.head,[new O(c.head,f)]),h.resultType=d.resultType;g=
new S(b.head,b.type,b.Ca,[g,h]);g.resultType=c.resultType;g.qb=!1;g=g.H(a);e.children.push(g)}return e}return b};function fg(a,b){R.call(this,a);this.children=b}fg.prototype=Object.create(R.prototype);fg.prototype.constructor=fg;fg.prototype.Na=function(a){M.prototype.Na.call(this,a);a=Nf(a,this);this.jb=1;this.resultType=a.resultType};function gg(a){for(var b=0;b<a.children.length;b++)if(!(a.children[b]instanceof O))return!1;return!0}
function hg(a,b){for(var c=0,d=1,e=0;e<a.children.length;e++){if(!(a.children[e]instanceof O))throw"internal";c+=d*a.children[e].n;d*=b.A[e]}return c}function dg(a){M.call(this,a);this.A=[]}dg.prototype=Object.create(M.prototype);dg.prototype.constructor=dg;dg.prototype.Na=function(a){this.jb=this.children.length;this.children[0]&&(this.children.forEach(function(b){b.Na(a)}),this.resultType=this.children[0].resultType)};function V(a,b){M.call(this,a);this.type=b||ig;this.Da=!1;this.La=[null]}
V.prototype=Object.create(M.prototype);v=V.prototype;v.constructor=V;v.lf=function(){throw"internal";};v.bg=function(){};v.dg=function(){throw"internal";};v.cg=function(){};v.zd=function(){};function jg(a,b){b.Cc=b.Dc;Xf(b,a)}var ig=1;function kg(a,b){this.b=a;this.u=b}kg.prototype.v=function(){return"internal"};function lg(a,b){V.call(this,a,2);this.Ae=b}lg.prototype=Object.create(V.prototype);lg.prototype.constructor=lg;lg.prototype.H=function(a){Zf(this.children,a);return this};
lg.prototype.lf=function(){return this};function mg(a,b){V.call(this,a,2);this.ng=b}mg.prototype=Object.create(V.prototype);mg.prototype.constructor=mg;mg.prototype.H=function(a){Zf(this.children,a);return this};mg.prototype.lf=function(){return this};function ng(a){V.call(this,a)}ng.prototype=Object.create(V.prototype);ng.prototype.constructor=ng;function og(a,b,c){V.call(this,a);this.b=b;this.V=c;this.resultType=c.resultType}og.prototype=Object.create(V.prototype);og.prototype.constructor=og;
function pg(a,b,c,d,e){V.call(this,a);this.ca=b.name;this.resultType=c;this.b=d||null;this.size=-1;this.A=[];this.offset=-1;e&&this.children.push(e)}pg.prototype=Object.create(V.prototype);pg.prototype.constructor=pg;pg.prototype.Na=function(a){this.children[0]&&(M.prototype.Na.call(this,a),this.resultType=this.children[0].children[1].resultType)};pg.prototype.H=function(a){Zf(this.children,a);return this};function qg(a){V.call(this,a.head);this.children.push(a)}qg.prototype=Object.create(V.prototype);
qg.prototype.constructor=qg;qg.prototype.H=function(a){Zf(this.children,a);return this};function eg(a){V.call(this,a)}eg.prototype=Object.create(V.prototype);eg.prototype.constructor=eg;eg.prototype.H=function(a){Zf(this.children,a);return this};function rg(a,b){V.call(this,a,3);this.b=[b];this.h=[];this.m=[]}rg.prototype=Object.create(V.prototype);v=rg.prototype;v.constructor=rg;v.Na=function(a){this.b.forEach(function(b){b.Na(a)});this.h.forEach(function(b){b.forEach(function(b){b.Na(a)})})};
v.H=function(a){Zf(this.b,a);this.h.forEach(function(b){Zf(b,a)});return this};v.dg=function(a){if(this.h.length>=this.b.length)throw"multiple else "+L(a.head);a instanceof sg&&this.b.push(a.b);this.h.push(this.children);this.m.push(a);this.children=[];this.La.push(a.La[0])};
v.zd=function(a,b){this.h.push(this.children);this.children=[];this.m.push(b);for(a=0;a<this.b.length;)if(this.b[a]instanceof O)if(0===this.b[a].n)this.b.splice(a,1),this.h.splice(a,1);else{this.b.splice(a);this.h.splice(a+1);break}else a++};function sg(a,b){V.call(this,a,4);this.b=b}sg.prototype=Object.create(V.prototype);sg.prototype.constructor=sg;sg.prototype.H=function(a){this.b=this.b.H(a);Zf(this.children,a);return this};function tg(a){V.call(this,a,4)}tg.prototype=Object.create(V.prototype);
tg.prototype.constructor=tg;function ug(a,b){V.call(this,a,3);this.b=b}ug.prototype=Object.create(V.prototype);ug.prototype.constructor=ug;ug.prototype.Na=function(a){M.prototype.Na.call(this,a);this.b.Na(a)};ug.prototype.H=function(a){this.b=this.b.H(a);Zf(this.children,a);return this};function vg(a,b){V.call(this,a,3);this.b=b;this.h=[]}vg.prototype=Object.create(V.prototype);vg.prototype.constructor=vg;vg.prototype.Na=function(a){M.prototype.Na.call(this,a);this.b.Na(a)};
vg.prototype.H=function(a){this.b=this.b.H(a);Zf(this.children,a);return this};vg.prototype.zd=function(a,b){this.b instanceof O&&(0===this.b.n&&(this.children=[]),this.b=null);this.h.push(b)};function wg(a,b,c,d,e){V.call(this,a,3);this.m=new R(b);this.children.push(c);this.children.push(d);this.b=e||null;this.h=[]}wg.prototype=Object.create(V.prototype);wg.prototype.constructor=wg;wg.prototype.Na=function(a){M.prototype.Na.call(this,a);this.b&&this.b.Na(a)};
wg.prototype.H=function(a){this.b&&(this.b=this.b.H(a));Zf(this.children,a);return this};wg.prototype.zd=function(a,b){this.h.push(b)};function xg(a,b,c){V.call(this,a);this.name=b;this.children=c}xg.prototype=Object.create(V.prototype);xg.prototype.constructor=xg;xg.prototype.H=function(a){Zf(this.children,a);return this};function yg(a,b){V.call(this,a);this.name=b}yg.prototype=Object.create(V.prototype);yg.prototype.constructor=yg;function zg(a){V.call(this,a,5)}zg.prototype=Object.create(V.prototype);
zg.prototype.constructor=zg;var cg=30,U=1;function X(a,b,c){this.name=a;this.type=b;this.priority=c&&c.priority||0;this.resultType=c&&c.resultType||(c&&c.la?Yf:Gf);this.la=c&&c.la||null;this.H=c&&c.H||null;this.M=c&&c.M||[];this.v=c&&c.v||null}function Ag(a,b){for(var c=[],d=0;d<a.children.length;d++){if(!(a.children[d]instanceof O))return a;c.push(a.children[d].n)}return new O(a.head,$f(b(c)))}
var Kf=[new X("--",0,{priority:150}),new X("++",0,{priority:150}),new X("-",0,{priority:150,H:function(a){return Ag(a,function(a){return-a[0]})},M:[28672]}),new X("~",0,{priority:150,H:function(a){return Ag(a,function(a){return~a[0]})},M:[28674]}),new X("abs",0,{priority:150,H:function(a){return Ag(a,function(a){return Math.abs(a[0])})},M:[28673]}),new X("not",0,{priority:150,resultType:"b",H:function(a){return Ag(a,function(a){return 0==a[0]?1:0})},M:[4096,32778]}),new X("size",0,{priority:150,H:function(a,
b){var c=0<a.children[0].jb?a.children[0].jb:a.children[0]instanceof dg?a.children[0].children.length:-1;if(0>c&&a.children[0]instanceof R)for(var d=b.Va.length-1;0<=d;d--)if(b.Va[d].name===a.children[0].name){c=b.Va[d].size;break}return 0<c?new O(a.head,c):a}}),new X("--",2,{priority:150}),new X("++",2,{priority:150}),new X("+=",U,{priority:cg}),new X("-=",U,{priority:cg}),new X("*=",U,{priority:cg}),new X("/=",U,{priority:cg}),new X("%=",U,{priority:cg}),new X("<<=",U,{priority:cg}),new X(">>=",
U,{priority:cg}),new X("&=",U,{priority:cg}),new X("|=",U,{priority:cg}),new X("^=",U,{priority:cg}),new X("*",U,{priority:140,H:function(a){return Ag(a,function(a){return a[0]*a[1]})},M:[32772]}),new X("/",U,{priority:140,H:function(a){return Ag(a,function(a){return Math.trunc(a[0]/a[1])})},M:[32773]}),new X("%",U,{priority:140,H:function(a){return Ag(a,function(a){return a[0]%a[1]})},M:[32774]}),new X("+",U,{priority:130,H:function(a){return Ag(a,function(a){return a[0]+a[1]})},M:[32770]}),new X("-",
U,{priority:130,H:function(a){return Ag(a,function(a){return a[0]-a[1]})},M:[32771]}),new X("<<",U,{priority:120,H:function(a){return Ag(a,function(a){return a[0]<<a[1]})},M:[32768]}),new X(">>",U,{priority:120,H:function(a){return Ag(a,function(a){return a[0]>>a[1]})},M:[32769]}),new X("==",U,{priority:80,resultType:"b",H:function(a){return Ag(a,function(a){return a[0]===a[1]?1:0})},M:[32778]}),new X("!=",U,{priority:80,resultType:"b",H:function(a){return Ag(a,function(a){return a[0]!==a[1]?1:0})},
M:[32779]}),new X("<",U,{priority:80,resultType:"b",H:function(a){return Ag(a,function(a){return a[0]<a[1]?1:0})},M:[32782]}),new X("<=",U,{priority:80,resultType:"b",H:function(a){return Ag(a,function(a){return a[0]<=a[1]?1:0})},M:[32783]}),new X(">",U,{priority:80,resultType:"b",H:function(a){return Ag(a,function(a){return a[0]>a[1]?1:0})},M:[32780]}),new X(">=",U,{priority:80,resultType:"b",H:function(a){return Ag(a,function(a){return a[0]>=a[1]?1:0})},M:[32781]}),new X("&",U,{priority:110,H:function(a){return Ag(a,
function(a){return a[0]&a[1]})},M:[32777]}),new X("|",U,{priority:90,H:function(a){return Ag(a,function(a){return a[0]|a[1]})},M:[32775]}),new X("^",U,{priority:100,H:function(a){return Ag(a,function(a){return a[0]^a[1]})},M:[32776]}),new X("and",U,{priority:60,resultType:"b",H:function(a){return Ag(a,function(a){return a[0]&&a[1]?1:0})},M:[32785]}),new X("or",U,{priority:50,resultType:"b",H:function(a){return Ag(a,function(a){return a[0]||a[1]?1:0})},M:[32784]}),new X("=",U,{priority:cg})];
function Bg(a,b,c){for(var d=0;d<a.Pb.length;d++)if(a.Pb[d].type===c&&a.Pb[d].name===b)return a.Pb[d];return null}function Y(a,b,c){return a.G[a.l+b]instanceof c}function Z(a,b,c){return a.G[a.l+b]instanceof Vf&&a.G[a.l+b].name===c}v=tf.prototype;v.Vf=function(a){return new S(a,4,null)};
function Cg(a,b){b=b||10;if(Y(a,0,Tf)){var c=new ag(a.G[a.l]);a.l++}else if(Y(a,0,Sf))c=new O(a.G[a.l]),a.l++;else if(Y(a,0,Uf))Z(a,1,"(")?(c=a.Vf(a.G[a.l]),a.l++,Z(a,1,")")?a.l+=2:c.children=Dg(a)):(c=new R(a.G[a.l]),a.l++);else if(Z(a,0,"(")){a.l++;c=Cg(a,20);if(!Z(a,0,")"))throw"subexpression in expression "+L(a.G[a.l]);a.l++}else if(Z(a,0,"[")){c=new dg(a.G[a.l]);a.l++;var d=[];for(var e=0,f=0,g=0;;){d.push(Cg(a,25));0===g&&f++;g++;if(1<f&&g>e)throw"non-rectangular array "+L(a.G[a.l]);g>e&&(e=
g);if(Y(a,0,Vf))if(a.l++,"]"===a.G[a.l-1].name)break;else if(","===a.G[a.l-1].name)continue;else if(";"===a.G[a.l-1].name){e=g;g=0;continue}throw"array "+L(a.G[a.l-1]);}for(g=0;g<e;g++)for(var h=0;h<f;h++)c.children.push(d[h*e+g])}else if(Y(a,0,Vf)&&(d=Bg(a,a.G[a.l].name,0)))c=new S(a.G[a.l],0,d),a.l++,c.children.push(Cg(a,150)),d.la&&(c.resultType=d.la(a,c,[c.children[0].resultType]));else if(Y(a,0,Vf)&&(d=Bg(a,a.G[a.l].name,3)))c=new S(a.G[a.l],3,d),a.l++;else{if(a.l<a.G.length)throw"unexpected token in expression "+
L(a.G[a.l]);throw"unexpected end of file";}for(;Y(a,0,Vf);)if((d=Bg(a,a.G[a.l].name,2))&&d.priority>=b)c=new S(a.G[a.l],2,d,[c]),a.l++;else if((d=Bg(a,a.G[a.l].name,U))&&(b===cg?d.priority>=b:d.priority>b))c=new S(a.G[a.l],U,d,[c]),a.l++,c.children.push(Cg(a,d.priority)),d.la&&(c.resultType=d.la(a,c,c.children.map(function(a){return a.resultType})));else if("["===a.G[a.l].name){if(!(c instanceof R))throw"unexpected indexing";d=c.resultType;e=Dg(a,!0);c=new fg(c.head,e);c.resultType=d}else break;return c}
function Dg(a,b){var c=[];if(!Z(a,0,b?"[":"("))throw"left "+(b?"bracket":"parenthesis")+" expected";for(a.l++;;){var d=Cg(a,25);c.push(d);if(!Y(a,0,Vf))throw"syntax error in arguments";if(Z(a,0,b?"]":")")){a.l++;break}else if(Z(a,0,","))a.l++;else throw"syntax error in arguments "+L(a.G[a.l]);}return c}
v.Zf=function(){if(this.l>=this.G.length)throw"no more tokens";if(this.G[this.l]instanceof Vf){var a=this.G[this.l];switch(a.name){case "const":if(!Y(this,1,Uf)||!Z(this,2,"="))throw'syntax error for "const" '+L(a);var b=this.G[this.l+1];this.l+=3;var c=Cg(this);c=c.H(this);if(!(c instanceof O))throw"non-constant expression in constant definition "+L(this.G[this.l]);return[new og(a,b.name,c)];case "var":if(!Y(this,1,Uf))throw'unexpected token after "var" '+L(a);b=this.G[this.l+1];this.l+=2;if(Y(this,
0,Vf))switch(this.G[this.l].name){case "[":if(Z(this,1,"]")){this.l+=2;if(!Z(this,0,"="))throw"missing size or initial value in array declaration"+L(this.G[this.l-2]);c=new S(this.G[this.l],U,Bg(this,"=",U),[new R(b)]);this.l++;c.children.push(Cg(this));c.resultType=c.children[1].resultType;c.qb=!1;var d=new S(new Vf(c.head.kd,c.head.Tc,c.head.Rc,"size"),0,Bg(this,"size",0),[c.children[1]]);return[new pg(a,b,c.resultType,[d],c)]}this.l++;d=Cg(this);if(!Z(this,0,"]"))throw"array size syntax error"+
L(this.G[this.l]);this.l++;return Z(this,0,"=")?(c=new S(this.G[this.l],U,Bg(this,"=",U),[new R(b)]),this.l++,c.children.push(Cg(this)),c.resultType=c.children[1].resultType,c.qb=!1,c=c.H(this),[new pg(a,b,c.resultType,[d],c)]):[new pg(a,b,Yf,[d])];case "=":return c=new S(this.G[this.l],U,Bg(this,"=",U),[new R(b)]),this.l++,c.children.push(Cg(this)),c.resultType=c.children[1].resultType,c.qb=!1,c=c.H(this),[new pg(a,b,c.resultType,null,c)]}return[new pg(a,b,Yf)];case "if":case "elseif":this.l++;c=
Cg(this);if(!Z(this,0,"then"))throw'"then" expected after "if" statement '+L(this.G[this.l]);this.l++;return["if"===a.name?new rg(a,c):new sg(a,c)];case "when":this.l++;c=Cg(this);if(!Z(this,0,"do"))throw'"do" expected after "when" statement '+L(this.G[this.l]);this.l++;return[new ug(a,c)];case "while":this.l++;c=Cg(this);if(!Z(this,0,"do"))throw'"do" expected after "while" statement '+L(this.G[this.l]);this.l++;return[new vg(a,c)];case "for":if(!Y(this,1,Uf)||!Z(this,2,"in"))throw'"for" syntax error '+
L(a);b=this.G[this.l+1];this.l+=3;c=Cg(this);if(!Z(this,0,":"))throw'range expected in "for" statement '+L(this.G[this.l]);this.l++;d=Cg(this);var e=null;Z(this,0,"step")&&(this.l++,e=Cg(this));if(!Z(this,0,"do"))throw'"do" expected after "for" statement '+L(this.G[this.l]);this.l++;return[new wg(a,b,c,d,e)];case "end":return this.l++,[new zg(a)];case "call":if(!Y(this,1,Uf))throw'"call" syntax error '+L(a);b=this.G[this.l+1];this.l+=2;return Z(this,0,"(")?[new xg(a,b.name,Dg(this))]:[new xg(a,b.name,
[])];case "callsub":if(!Y(this,1,Uf))throw'"callsub" syntax error '+L(a);b=this.G[this.l+1];this.l+=2;return[new yg(a,b.name)];case "else":return this.l++,[new tg(a)];case "onevent":if(!Y(this,1,Uf))throw'unexpected token after "onevent" '+L(a);b=this.G[this.l+1];this.l+=2;return[new lg(a,b.name)];case "return":return this.l++,[new ng(a)];case "sub":if(!Y(this,1,Uf))throw'unexpected token after "sub" '+L(a);b=this.G[this.l+1];this.l+=2;return[new mg(a,b.name)]}}c=Cg(this);c instanceof S&&(c.qb=!1);
c=c.H(this);return[new qg(c)]};v.fg=function(){};v.eg=function(){};
v.qe=function(a){if(a instanceof og){a.V=a.V.H(this);if(!(a.V instanceof O))throw"constant definition "+L(a.head);this.ca[a.b]={V:a.V.n,resultType:a.V.resultType}}else a instanceof pg&&(a.size=1,a.A=[],a.b&&(a.b=a.b.map(function(b){b=b.H(this);if(!(b instanceof O)||0>=b.n)throw"array variable size "+L(a.head);a.size*=b.n;a.A.push(b.n);return b},this)),a.offset=this.Oa,a.children[0]&&(a.resultType=a.children[0].resultType),this.Oa+=a.size,this.nd(a.ca,a.size,a.A,a.offset,a.resultType))};v.Bd=function(){};
v.ra=function(){};v.getContext=function(){return null};v.If=function(){this.Oa=this.Aa.Oa;for(var a=0;a<this.h.length;a++)this.qe(this.h[a])};function Eg(a,b,c){switch(b.type){case 3:c.push(a.getContext());a.ra(b.La[0]);break;case 4:a.ra(b.La[0]);break;case 5:a.ra(c.pop())}}
function Fg(a){function b(){if(1<f.length){var a=f[f.length-1].head;throw"unterminated "+a.name+" "+L(a);}c.o.push(f[0])}var c=a,d=[];a.If();a.Bd();d=[];a.h.forEach(function(a){Eg(this,a,d);a.Na(this)},a);a.Bd();d=[];for(var e=0;e<a.h.length;e++)Eg(a,a.h[e],d),a.h[e]=a.h[e].H(a);a.Bd();d=[];for(e=0;e<a.h.length;e++)Eg(a,a.h[e],d),a.h[e]=a.h[e].F(a);a.o=[];var f=[new lg(null,"init")];a.Bd();for(e=0;e<a.h.length;e++)switch(a.h[e].type){case ig:a.h[e].zd(a,a.h[e]);f[f.length-1].children.push(a.h[e]);
break;case 2:a.ra(a.h[e].La[0]);b();f=[a.h[e].lf()];break;case 3:a.ra(a.h[e].La[0]);a.h[e].bg(a);f.push(a.h[e]);break;case 4:a.ra(a.h[e].La[0]);f[f.length-1].dg(a.h[e]);break;case 5:if(2>f.length)throw"unexpected end "+L(a.h[e].head);a.ra(a.h[e].La[0]);f[f.length-1].cg(a.h[e]);var g=f.pop();a.ra(a.h[e].La[a.h[e].La.length-1]);g.zd(a,a.h[e]);f[f.length-1].children.push(g);break;default:throw"not implemented "+a.h[e].type;}b()}v.gg=function(){};v.Tf=function(){return null};
M.prototype.v=function(a){for(var b=[],c=a.Ia,d=0;d<this.children.length;d++)b=b.concat(this.children[d].v(a)),a.Ia=c+b.length;return b};function Gg(a){return-2048<=a&&2048>a?[4096|a&4095]:[8192,a&65535]}O.prototype.v=function(){return this.qb?Gg(this.n):[]};R.prototype.v=function(a){return this.b?[]:a.ca.hasOwnProperty(this.name)?Gg(a.ca[this.name].V):Nf(a,this).ad(a)};
S.prototype.v=function(a){function b(b,d,e,f){function g(b,g){f===c.pf&&(h=h.concat(b.ad(a,g)));e&&(h=h.concat(b.ad(a,g)));h=h.concat(d.v(a)).concat(a.ub(d.resultType,b.resultType)).concat(b.De(a,g));f===c.me&&(h=h.concat(b.ad(a,g)))}var h=[];if(b instanceof fg){var l=Nf(a,b);if(gg(b)){b=hg(b,l);if(b>=l.size)throw"index out of range";g(l,b)}else if(f!==c.Oe||e){var m=Pf(a,1);h=h.concat(Hg(b,a)).concat(16384|m);f===c.pf&&(h=h.concat(12288|m).concat(l.ge(a)));e&&(h=h.concat(12288|m).concat(l.ge(a)));
h=h.concat(d.v(a)).concat(a.ub(d.resultType,l.resultType)).concat(12288|m).concat(l.df(a));f===c.me&&(h=h.concat(12288|m).concat(l.ge(a)))}else h=h.concat(d.v(a)).concat(a.ub(d.resultType,l.resultType)).concat(Hg(b,a)).concat(l.df(a))}else if(b instanceof R)l=Nf(a,b),g(l);else throw"bad assignment";return h}var c={Oe:0,me:1,pf:2},d=this.head.name;switch(d){case "=":return b(this.children[0],this.children[1],!1,this.qb?c.me:c.Oe);case "++":case "--":if(!(this.children[0]instanceof R))throw"invalid operand "+
L(this.head);var e=d[0],f=Bg(a,e,U);e=new S(new Vf(this.head.kd,this.head.Tc,this.head.Rc,e),U,f,[bg(this.children[0]),new O(new Sf(this.head.kd,this.head.Tc,this.head.Rc,1))]);f.la&&(d=Nf(a,this.children[0]),e.resultType=f.la(a,e,[d.resultType,Gf]));return b(this.children[0],e,!0,this.qb?0===this.type?c.me:c.pf:c.Oe);default:if(this.type===U&&this.Ca.priority===cg){if(!(this.children[0]instanceof R))throw"invalid operand "+L(this.head);e=d.slice(0,-1);f=Bg(a,e,U);e=new S(new Vf(this.head.kd,this.head.Tc,
this.head.Rc,e),U,f,[bg(this.children[0]),this.children[1]]);f.la&&(d=Nf(a,this.children[0]),e.resultType=f.la(a,e,[d.resultType,this.children[1].resultType]));return b(this.children[0],e,!0,this.qb?c.me:c.Oe)}if(this.Ca&&this.Ca.v)return this.Ca.v(this,a);switch(this.type){case 0:return M.prototype.v.call(this,a).concat(this.Ca.M);case U:return M.prototype.v.call(this,a).concat(this.Ca.M);case 3:return this.Ca.M;case 4:f=a.Tf(this);if(null!==f)return f;e=Of(a,d);if(null!=e){if(e.Kc!==this.children.length)throw"wrong number of arguments";
f=[];d=Pf(a,e.Kc+(e.Ud||0));for(var g=0;g<this.children.length;g++)f=f.concat(this.children[g].v(a)),f=f.concat(16384|d+g);return f=f.concat(e.X(a,a.Aa,this.children.map(function(a){return a.resultType}),d))}throw"unknown function "+d+" "+L(this.head);default:throw"internal";}}};function Ig(a,b,c){return a instanceof S&&2===a.children.length?a.children[0].v(b).concat(a.children[1].v(b)).concat([40960|(c?256:0)|a.Ca.M[0]&255,0]):a.v(b).concat(4096,40960|(c?256:0)|Cf.indexOf("ne"),0)}
function Hg(a,b){var c=Nf(b,a);if(a.children.length>c.A.length)throw"too many indices"+L(a.head);for(var d=[],e=1,f=0;f<a.children.length;f++)d=d.concat(a.children[f].v(b)),0<f&&(d=d.concat(4096|e,32772,32770)),e*=c.A[f];return d}fg.prototype.v=function(a){if(this.b)return[];var b=Nf(a,this);if(gg(this)){var c=hg(this,b);if(c>=b.size)throw"index out of range "+L(this.head);return b.ad(a,c)}return Hg(this,a).concat(b.ge(a))};dg.prototype.v=function(){throw"internal";};
V.prototype.v=function(){throw"internal";};lg.prototype.v=function(a){var b=a.getContext();jg(this,a);a.ra(this.La[0]);var c="init"===this.Ae?a.Hf:[];a.Ia+=c.length;c=c.concat(M.prototype.v.call(this,a)).concat(0);a.ra(b);return c};mg.prototype.v=function(a){var b=a.getContext();jg(this,a);a.ra(this.La[0]);var c=M.prototype.v.call(this,a).concat(57344);a.ra(b);return c};og.prototype.v=function(a){jg(this,a);return[]};
pg.prototype.v=function(a){jg(this,a);return 0===this.children.length?[]:M.prototype.v.call(this,a)};qg.prototype.v=function(a){jg(this,a);return this.children[0].v(a)};eg.prototype.v=function(a,b){jg(this,a);var c=[];this.children.forEach(function(d){c=c.concat(d.v(a,b))});return c};
rg.prototype.v=function(a){var b=a.getContext();jg(this,a);for(var c=a.Ia,d=[],e=0,f=0;f<this.b.length;f++)a.Ia=c+d.length,0<f&&Xf(a,this.m[f-1]),d=d.concat(Ig(this.b[f],a)),a.Ia=c+d.length,Lf(a,d),a.ra(this.La[f]),this.h[f].forEach(function(b){d=d.concat(b.v(a));a.Ia=c+d.length}),a.ra(b),f+1<this.h.length?(d=d.concat(36864),Mf(a,d),Lf(a,d),e++):Mf(a,d);a.Ia=c+d.length;this.h.length>this.b.length&&(Xf(a,this.m[this.b.length-1],a.Ia+d.length),a.ra(this.La[this.b.length]),this.h[this.b.length].forEach(function(b){d=
d.concat(b.v(a));a.Ia=c+d.length}));for(;0<e--;)Mf(a,d);a.ra(b);return d};ug.prototype.v=function(a){var b=a.getContext();jg(this,a);var c=a.Ia,d=Ig(this.b,a,!0);Lf(a,d);a.ra(this.La[0]);this.children.forEach(function(b){a.Ia=c+d.length;d=d.concat(b.v(a))});Mf(a,d);a.ra(b);return d};
vg.prototype.v=function(a){if(null==this.b&&0===this.children.length)return[];var b=a.getContext();jg(this,a);var c=a.Ia,d=[];null!=this.b&&(d=Ig(this.b,a));Lf(a,d);a.ra(this.La[0]);this.children.forEach(function(b){a.Ia=c+d.length;d=d.concat(b.v(a))});a.Ia=c+d.length;Xf(a,this.h[0]);d=d.concat(36864|-d.length&4095);Mf(a,d);a.ra(b);return d};
wg.prototype.v=function(a){var b=a.getContext();jg(this,a);var c=a.Ia,d=this.children[0].v(a),e=Nf(a,this.m);d=d.concat(e.De(a));var f=d.length;d=d.concat(e.ad(a)).concat(this.children[1].v(a)).concat(40975,0);Lf(a,d);a.ra(this.La[0]);for(var g=2;g<this.children.length;g++)a.Ia=c+d.length,d=d.concat(this.children[g].v(a));a.Ia=c+d.length;Xf(a,this.h[0]);d=d.concat(e.ad(a));d=this.b?d.concat(this.b.v(a)):d.concat(Gg(1));d=d.concat(32770,e.De(a),36864|f-d.length-2&4095);Mf(a,d);a.ra(b);return d};
xg.prototype.v=function(a){jg(this,a);var b=Hf(a.Aa,this.name);if(!b)throw'native function "'+this.name+'" not found';if(this.children.length!==b.D.length)throw'wrong number of arguments for native function "'+this.name+'"';for(var c=[],d=[],e=[],f=this.children.length-1;0<=f;f--){var g=this.children[f];if(0>b.D[f])if(void 0==d[-b.D[f]-1])d[-b.D[f]-1]=g.jb;else{if(d[-b.D[f]-1]!==g.jb)throw'argument size mismatch in native function "'+this.name+'"';}else 0===b.D[f]&&e.push(g.jb);if(g instanceof fg)c=
c.concat(Gg(Nf(a,g).offset)).concat(Hg(g,a)).concat(32770);else if(g instanceof R)c=c.concat(Gg(Nf(a,g).offset));else{for(var h=Pf(a,g.jb),m=0;m<g.jb;m++)c=c.concat((g instanceof dg?g.children[m]:g).v(a)),c=c.concat(16384|h+m);c=c.concat(Gg(h))}}for(f=e.length-1;0<=f;f--)c=Gg(e[f]).concat(c);for(f=d.length-1;0<=f;f--)void 0!==d[f]&&(c=Gg(d[f]).concat(c));return c=c.concat(49152|b.id)};ng.prototype.v=function(a){jg(this,a);return[(a.jf?14:0)<<12]};function Jg(a,b){kg.call(this,a,b)}Jg.prototype=Object.create(kg.prototype);
Jg.prototype.constructor=Jg;Jg.prototype.v=function(){var a=this.u.name;if(void 0===this.b.Hd[a])throw'unknown function "'+a+'" '+L(this.u.head);return 53248|this.b.Hd[a]};yg.prototype.v=function(a){jg(this,a);return[new Jg(a,this)]};function Kg(a,b){b=b||0;for(var c=0;c<a.length;c++)a[c]instanceof kg&&(a[c]=a[c].v(b+c))}
tf.prototype.v=function(){this.cb=[];this.Bd();this.Sb=[];var a=this.o.map(function(a){this.Ia=0;this.ra(a.La[0]);this.jf=a instanceof mg;this.Sb=[];return{pd:a.v(this,!0),mapping:this.Sb}},this);if(0<this.cb.length)throw"internal";for(var b=0,c=0;c<this.o.length;c++)this.o[c]instanceof lg&&b++;this.Hd={};var d=[],e=[1+2*b];this.Sb=[];for(c=0;c<this.o.length;c++)this.Sb=this.Sb.concat(a[c].mapping.map(function(a){return new Wf(a.mg,a.line,a.Ga,a.Ec+1+2*b+d.length)})),this.o[c]instanceof lg?(e=e.concat(Jf(this.Aa,
this.o[c].Ae),1+2*b+d.length),d=d.concat(a[c].pd)):this.o[c]instanceof mg&&(this.Hd[this.o[c].ng]=1+2*b+d.length,d=d.concat(a[c].pd));Kg(d,1+2*b);return e.concat(d)};function xf(a){a.Ve();a.fg();a.l=0;for(a.h=[];a.l<a.G.length;)a.h=a.h.concat(a.Zf());a.eg();Fg(a);a.gg();return a.v()};function Lg(a,b,c){void 0===c&&(c=1);return{name:a,Kc:c,Ud:1,fe:function(a){return null!=Hf(a,b)},X:function(a,e,f,g){a=Hf(e,b);e=[4097];for(f=0;f<c;f++)e=e.concat([4096|g+c-1-f]);return e=e.concat([4096|g+c,49152|a.id,12288|g+c])}}}var uf=[Lg("min","math.min",2),Lg("max","math.max",2),Lg("clamp","math.clamp",3),Lg("muldiv","math.muldiv",3),Lg("atan2","math.atan2",2),Lg("sin","math.sin"),Lg("cos","math.cos"),Lg("sqrt","math.sqrt"),Lg("rand","math.rand",0)];function vf(a,b){tf.call(this,a,b);this.Ef=!0;this.Pb=Mg;this.nb=100;this.rg=[];this.Ce=[];this.Gf=[];this.labels=[[]];this.Ff=[];this.vb=!1;this.label=null;this.qa=Yf;this.Da=[]}vf.prototype=Object.create(tf.prototype);vf.prototype.constructor=vf;var Ng="== != <= >= |= ^= &= *= /= %= += -= <<= >>= ++ -- ( ) [ ] - ~ ! * / % + << >> && || & ^ | > < = , ? : { } ; bool break case const continue default do else emit false fixed for goto if int onevent return size switch true void when while".split(" ");
function Og(a,b,c){return c[0]}function Pg(a,b,c){for(a=0;a<c.length;a++)switch(c[a]){case Yf:case Q:return c[a];case "v":throw"cannot use void result in expression";}return Gf}function Qg(a,b,c){if(!(a instanceof dg)&&a.resultType!==b&&a.resultType!==Yf){if("v"===a.resultType)throw"cannot use void result "+L(a.head);if(b=Rg(b))a=new S(new Vf(a.head.kd,a.head.Tc,a.head.Rc,b),0,Bg(c,b,0),[a]),a=a.H(c)}return a}function Sg(a,b){a.children[1]=Qg(a.children[1],a.resultType,b);return a}
vf.prototype.ub=function(a,b){if(a===Yf||b===Yf)throw"internal";if("v"===a)throw"bad conversion from void";switch(a){case Gf:case "b":switch(b){case Q:return[4196,32772]}break;case Q:switch(b){case Gf:case "b":return[4196,32773]}}return[]};function Tg(a,b,c){var d=[];a.forEach(function(a){d=a instanceof ag&&b===Gf?d.concat(Gg(Math.trunc(a.n))):a instanceof O&&a.resultType===Gf&&b===Q?d.concat(Gg(a.n*c.nb)):d.concat(a.v(c)).concat(c.ub(a.resultType,b))});return d}
function Ug(a,b,c,d){var e=Pf(a,4);return(b instanceof M?b.v(a):Gg(b)).concat(16384|e).concat(c instanceof M?c.v(a):Gg(c)).concat(16384|e+1).concat(d instanceof M?d.v(a):Gg(d)).concat([16384|e+2,4097,4096|e+2,4096|e+1,4096|e,4096|e+3,49152|Hf(a.Aa,"math.muldiv").id,12288|e+3])}
function Vg(a,b,c,d){for(var e=!1,f=[],g=0;g<a.children.length;g++){if(a.children[g]instanceof ag)e=!0;else if(!(a.children[g]instanceof O))return a;f.push(a.children[g].n)}c=(e&&d?d:c)(f);d=a.Ca.resultType;a.Ca.la&&(d=a.Ca.la(b,a,a.children.map(function(a){return a.resultType})));switch(d){case Gf:case "b":return new O(a.head,$f(c));case Q:return new ag(a.head,c);default:throw"internal";}}
var Mg=[new X("--",0,{priority:150,la:Og}),new X("++",0,{priority:150,la:Og}),new X("-",0,{priority:150,la:Og,H:function(a,b){return Vg(a,b,function(a){return-a[0]})},M:[28672]}),new X("~",0,{priority:150,H:function(a,b){return Vg(a,b,function(a){return~a[0]})},M:[28674]}),new X("!",0,{priority:150,resultType:"b",H:function(a,b){return Vg(a,b,function(a){return 0==a[0]?1:0})},M:[4096,32778]}),new X("bool",0,{priority:150,resultType:"b",H:function(a,b){return Vg(a,b,function(a){return 0!=a[0]?1:0})},
M:[],v:function(a,b){b=a.children[0].v(b);"b"!==a.children[0].resultType&&(b=b.concat(4096,32779));return b}}),new X("fixed",0,{priority:150,resultType:Q,H:function(a,b){return Vg(a,b,function(a){return a[0]})},M:[],v:function(a,b){var c=a.children[0].v(b);a.children[0].resultType!==Q&&(c=c.concat(4096|b.nb,32772));return c}}),new X("int",0,{priority:150,H:function(a,b){return Vg(a,b,function(a){return a[0]})},M:[],v:function(a,b){var c=a.children[0].v(b);a.children[0].resultType===Q&&(c=c.concat(4096|
b.nb,32773));return c}}),new X("size",0,{priority:150,H:function(a,b){var c=0<a.children[0].jb?a.children[0].jb:a.children[0]instanceof dg?a.children[0].children.length:-1;if(0>c&&a.children[0]instanceof R)for(var d=b.Va.length-1;0<=d;d--)if(b.Va[d].name===a.children[0].name){c=b.Va[d].size;break}return 0<c?new O(a.head,c):a}}),new X("--",2,{priority:150,la:Og}),new X("++",2,{priority:150,la:Og}),new X("+=",U,{priority:cg,la:Og,H:Sg}),new X("-=",U,{priority:cg,la:Og}),new X("*=",U,{priority:cg,la:Og}),
new X("/=",U,{priority:cg,la:Og}),new X("%=",U,{priority:cg,la:Og}),new X("<<=",U,{priority:cg}),new X(">>=",U,{priority:cg}),new X("&=",U,{priority:cg}),new X("|=",U,{priority:cg}),new X("^=",U,{priority:cg}),new X("*",U,{priority:140,la:Pg,M:[32772],H:function(a,b){return Vg(a,b,function(a){return a[0]*a[1]})},v:function(a,b){var c=a.children[1].resultType===Q,d=[];a.children[0].resultType===Q&&c?d=d.concat(Ug(b,a.children[0],a.children[1],b.nb)):(a.children.forEach(function(a){d=d.concat(a.v(b))}),
d=d.concat(a.Ca.M));return d}}),new X("/",U,{priority:140,la:Pg,M:[32773],H:function(a,b){return Vg(a,b,function(b){if(0===b[1])throw"division by 0 "+L(a.head);return Math.trunc(b[0]/b[1])},function(b){if(0===b[1])throw"division by 0 "+L(a.head);return b[0]/b[1]})},v:function(a,b){var c=a.children[1].resultType===Q,d=[];a.children[0].resultType===Q?c?d=d.concat(Ug(b,a.children[0],b.nb,a.children[1])):(a.children.forEach(function(a){d=d.concat(a.v(b))}),d=d.concat(a.Ca.M)):c?d=d.concat(Ug(b,a.children[0],
b.nb*b.nb,a.children[1])):(a.children.forEach(function(a){d=d.concat(a.v(b))}),d=d.concat(a.Ca.M));return d}}),new X("%",U,{priority:140,la:Pg,H:function(a,b){return Vg(a,b,function(b){if(0===b[1])throw"division by 0 "+L(a.head);return b[0]%b[1]})},M:[32774],v:function(a,b){return Tg(a.children,a.resultType,b).concat(a.Ca.M)}}),new X("+",U,{priority:130,la:Pg,H:function(a,b){return Vg(a,b,function(a){return a[0]+a[1]})},M:[32770],v:function(a,b){return Tg(a.children,a.resultType,b).concat(a.Ca.M)}}),
new X("-",U,{priority:130,la:Pg,H:function(a,b){return Vg(a,b,function(a){return a[0]-a[1]})},M:[32771],v:function(a,b){return Tg(a.children,a.resultType,b).concat(a.Ca.M)}}),new X("<<",U,{priority:120,H:function(a,b){return Vg(a,b,function(a){return a[0]<<a[1]})},M:[32768],v:function(a,b){return a.children[0].v(b).concat(Tg(a.children.slice(1),Gf,b)).concat(a.Ca.M)}}),new X(">>",U,{priority:120,H:function(a,b){return Vg(a,b,function(a){return a[0]>>a[1]})},M:[32769],v:function(a,b){return a.children[0].v(b).concat(Tg(a.children.slice(1),
Gf,b)).concat(a.Ca.M)}}),new X("==",U,{priority:80,resultType:"b",H:function(a,b){return Vg(a,b,function(a){return a[0]===a[1]?1:0})},M:[32778],v:function(a,b){var c=a.children.map(function(a){return a.resultType});return Tg(a.children,Pg(b,a,c),b).concat(a.Ca.M)}}),new X("!=",U,{priority:80,resultType:"b",H:function(a,b){return Vg(a,b,function(a){return a[0]!==a[1]?1:0})},M:[32779],v:function(a,b){var c=a.children.map(function(a){return a.resultType});return Tg(a.children,Pg(b,a,c),b).concat(a.Ca.M)}}),
new X("<",U,{priority:80,resultType:"b",H:function(a,b){return Vg(a,b,function(a){return a[0]<a[1]?1:0})},M:[32782],v:function(a,b){var c=a.children.map(function(a){return a.resultType});return Tg(a.children,Pg(b,a,c),b).concat(a.Ca.M)}}),new X("<=",U,{priority:80,resultType:"b",H:function(a,b){return Vg(a,b,function(a){return a[0]<=a[1]?1:0})},M:[32783],v:function(a,b){var c=a.children.map(function(a){return a.resultType});return Tg(a.children,Pg(b,a,c),b).concat(a.Ca.M)}}),new X(">",U,{priority:80,
resultType:"b",H:function(a,b){return Vg(a,b,function(a){return a[0]>a[1]?1:0})},M:[32780],v:function(a,b){var c=a.children.map(function(a){return a.resultType});return Tg(a.children,Pg(b,a,c),b).concat(a.Ca.M)}}),new X(">=",U,{priority:80,resultType:"b",H:function(a,b){return Vg(a,b,function(a){return a[0]>=a[1]?1:0})},M:[32781],v:function(a,b){var c=a.children.map(function(a){return a.resultType});return Tg(a.children,Pg(b,a,c),b).concat(a.Ca.M)}}),new X("&",U,{priority:110,H:function(a,b){return Vg(a,
b,function(a){return a[0]&a[1]})},M:[32777]}),new X("|",U,{priority:90,H:function(a,b){return Vg(a,b,function(a){return a[0]|a[1]})},M:[32775]}),new X("^",U,{priority:100,H:function(a,b){return Vg(a,b,function(a){return a[0]^a[1]})},M:[32776]}),new X("&&",U,{priority:60,la:Og,H:function(a,b){return Vg(a,b,function(a){return a[0]&&a[1]?1:0})},M:[32785],v:function(a,b){var c=a.children[0].v(b).concat([16384|b.bc,12288|b.bc,4096,40960|Cf.indexOf("eq"),4,12288|b.bc,36864]);Lf(b,c);a=Qg(a.children[1],
a.children[0].resultType,b).H(b);c=c.concat(a.v(b));Mf(b,c);return c}}),new X("||",U,{priority:50,la:Og,H:function(a,b){return Vg(a,b,function(a){return a[0]||a[1]?1:0})},M:[32784],v:function(a,b){var c=a.children[0].v(b).concat([16384|b.bc,12288|b.bc,4096,40960|Cf.indexOf("ne"),4,12288|b.bc,36864]);Lf(b,c);a=Qg(a.children[1],a.children[0].resultType,b).H(b);c=c.concat(a.v(b));Mf(b,c);return c}}),new X("?",U,{priority:40,la:function(a,b,c){return c[1]},H:function(a){if(!(a.children[1]instanceof S)||
0==a.children[1].Ca||":"!==a.children[1].Ca.name)throw"missing else part in conditional expression "+L(a.head);return a.children[0]instanceof O?a.children[1].children[a.children[0].n?0:1]:a},v:function(a,b){var c=Ig(a.children[0],b);Lf(b,c);c=c.concat(a.children[1].children[0].v(b)).concat(36864);Mf(b,c);Lf(b,c);c=c.concat(a.children[1].children[1].v(b));Mf(b,c);return c}}),new X(":",U,{priority:41,la:Og,H:function(a,b){a.children[1]=Qg(a.children[1],a.children[0].resultType,b);return a},v:function(a){throw"unexpected colon outside conditional expression "+
L(a.head);}}),new X("=",U,{priority:cg,la:Og,H:Sg}),new X(",",U,{priority:25,la:function(a,b){return b[1]},H:function(a){a.children[0].qb=!1;return a}}),new X("false",3,{resultType:"b",H:function(a,b){return Vg(a,b,function(){return 0})},M:[4096]}),new X("true",3,{resultType:"b",H:function(a,b){return Vg(a,b,function(){return 1})},M:[4097]})];v=vf.prototype;
v.lg=function(){for(;this.b<this.P;)if(" "===this.m[this.b]||"\t"===this.m[this.b])this.b++,this.Ga++;else if("\n"===this.m[this.b])this.b++,this.Ga=0,this.line++;else if("\r"===this.m[this.b])this.b++;else if("/*"===this.m.slice(this.b,this.b+2))for(this.b+=2,this.Ga+=2;this.b<this.P&&"*/"!==this.m.slice(this.b-2,this.b);)"\n"===this.m[this.b]?(this.Ga=0,this.line++):"\r"!==this.m[this.b]&&this.Ga++,this.b++;else if("//"===this.m.slice(this.b,this.b+2))for(;this.b<this.P&&"\n"!==this.m[this.b];)this.b++,
this.Ga++;else break};v.Ve=function(a){return tf.prototype.Ve.call(this,a||Ng)};v.fg=function(){this.G.forEach(function(a,b){a instanceof Vf&&("def"===a.name||0<=["int","bool","fixed","void"].indexOf(a.name))&&this.G[b+1]instanceof Uf&&this.G[b+2]instanceof Vf&&"("===this.G[b+2].name&&this.rg.push(this.G[b+1].name)},this)};
function Wg(a,b){switch(a.name){case "var":case "def":return b||Gf;case "void":return"v";case "int":return Gf;case "bool":return"b";case "fixed":return Q;default:throw"internal";}}function Rg(a){switch(a){case Gf:return"int";case Q:return"fixed";case "b":return"bool";default:return""}}function Xg(a){return Z(a,0,"int")||Z(a,0,"bool")||Z(a,0,"fixed")}
v.Zf=function(){function a(){var a=[];for(this.l++;;){d=this.G[this.l];this.l++;if(!Y(this,0,Vf))throw"syntax error "+L(c);switch(this.G[this.l].name){case "[":if(Z(this,1,"]")){this.l+=2;if(!Z(this,0,"="))throw"missing size or initial value in array declaration"+L(this.G[this.l-2]);e=new S(this.G[this.l],U,Bg(this,"=",U),[new R(d)]);this.l++;e.children.push(Cg(this,25));e.resultType=Wg(c,e.children[1].resultType);e.children[1].Na(this);e.qb=!1;var b=new S(new Vf(this.G[this.l].kd,this.G[this.l].Tc,
this.G[this.l].Rc,"size"),0,Bg(this,"size",0),[e.children[1]]);a.push(new pg(c,d,e.resultType,[b],e))}else b=Dg(this,!0),Z(this,0,"=")?(e=new S(this.G[this.l],U,Bg(this,"=",U),[new R(d)]),this.l++,e.children.push(Cg(this,25)),e.resultType=Wg(c,e.children[1].resultType),e.qb=!1,a.push(new pg(c,d,e.resultType,b,e))):a.push(new pg(c,d,Wg(c),b));break;case "=":e=new S(this.G[this.l],U,Bg(this,"=",U),[new R(d)]);this.l++;e.children.push(Cg(this,25));e.resultType=Wg(c,e.children[1].resultType);e.qb=!1;
e=e.H(this);a.push(new pg(c,d,e.resultType,null,e));break;default:a.push(new pg(c,d,Wg(c)))}if(Z(this,0,","))this.l++;else{if(Z(this,0,";"))return this.l++,a;throw"missing semicolon "+L(this.G[this.l]);}}}function b(){var a=Wg(c);d=this.G[this.l+1];this.l+=3;var b=[];if(!Z(this,0,")"))for(;;){var e=Gf;Xg(this)&&(e=Wg(this.G[this.l]),this.l++);if(!Y(this,0,Uf))throw"bad function definition argument "+L(this.G[this.l]);var f=this.G[this.l].name,g=[],h=!1;this.l++;Z(this,0,"[")&&(h=!0,g=Dg(this,!0));
b.push({name:f,type:e,zg:g,size:1,A:[],wc:h});if(Z(this,0,","))this.l++;else if(Z(this,0,")"))break;else throw"syntax error in function definition "+L(this.G[this.l]);}this.l++;if(!Z(this,0,"{"))throw"block expected after function header "+L(this.G[this.l]);this.l++;return new Yg(c,d.name,a,b)}if(this.l>=this.G.length)throw"no more tokens";var c=this.G[this.l];if(this.G[this.l]instanceof Vf)switch(c.name){case "const":if(!Y(this,1,Uf)||!Z(this,2,"="))throw'syntax error for "const" '+L(c);var d=this.G[this.l+
1];this.l+=3;var e=Cg(this,25);e=e.H(this);if(!(e instanceof O))throw"non-constant expression in constant definition "+L(this.G[this.l]);if(!Z(this,0,";"))throw"missing semicolon "+L(c);this.l++;return[new og(c,d.name,e)];case "int":case "bool":case "fixed":if(!Y(this,1,Uf))throw'unexpected token after "'+c.name+'" '+L(c);return Z(this,2,"(")?[b.call(this)]:a.call(this);case "void":return[b.call(this)];case "if":this.l++;var f=Dg(this);if(1!==f.length)throw'bad condition in "if" statement '+L(this.G[this.l]);
var g=new rg(c,f[0]);Z(this,0,"{")?this.l++:g.Da=!0;return[g];case "when":this.l++;f=Dg(this);if(1!==f.length)throw'bad condition in "when" statement '+L(this.G[this.l]);if(!Z(this,0,"{"))throw'block expected after "when" statement '+L(this.G[this.l]);this.l++;return[new ug(c,f[0])];case "switch":this.l++;f=Dg(this);if(1!==f.length)throw'bad expression in "switch" statement '+L(this.G[this.l]);if(!Z(this,0,"{"))throw'block expected after "switch" statement '+L(this.G[this.l]);this.l++;return[new Zg(c,
f[0])];case "case":this.l++;e=Cg(this);if(!Z(this,0,":"))throw'missing colon after "case" '+L(this.G[this.l]);this.l++;return[new $g(c,e)];case "default":if(!Z(this,1,":"))throw'missing colon after "default" '+L(this.G[this.l]);this.l+=2;return[new $g(c,null)];case "goto":if(!Y(this,1,Uf))throw'missing label after "goto" '+L(this.G[this.l]);d=this.G[this.l+1];this.l+=2;return[new ah(c,d.name)];case "while":this.l++;f=Dg(this);if(1!==f.length)throw'bad condition in "while" statement '+L(this.G[this.l]);
if(Z(this,0,";"))return this.l++,[new bh(c,f[0])];if(!Z(this,0,"{"))throw'block expected after "while" statement '+L(this.G[this.l]);this.l++;return[new ch(c,f[0])];case "do":if(!Z(this,1,"{"))throw'block expected after "do" statement '+L(this.G[this.l]);this.l+=2;return[new dh(c)];case "for":if(!Z(this,1,"("))throw'"for" syntax error '+L(c);this.l+=2;d=null;var h=Gf;if(Z(this,0,";"))e=null;else{if(Z(this,0,"var")||Xg(this)){if(!Y(this,1,Uf))throw'bad variable declaration in "for" statement '+L(this.G[this.l]);
h=Wg(this.G[this.l]);this.l++;d=this.G[this.l]}e=Cg(this);if(!Z(this,0,";"))throw'semicolon expected in "for" statement '+L(this.G[this.l]);}this.l++;if(Z(this,0,";"))g=null;else if(g=Cg(this),!Z(this,0,";"))throw'semicolon expected in "for" statement '+L(this.G[this.l]);this.l++;if(Z(this,0,")"))f=null;else if(f=Cg(this),!Z(this,0,")"))throw'semicolon expected in "for" statement '+L(this.G[this.l]);this.l++;if(!Z(this,0,"{"))throw'block expected after "for" statement '+L(this.G[this.l]);this.l++;
return[new eh(c,d,h,e,g,f)];case ";":return this.l++,[new fh(c)];case "{":return this.l++,[new gh(c)];case "}":this.l++;if(Z(this,0,"else")){this.l++;if(Z(this,0,"if")){this.l++;f=Dg(this);if(1>f.length)throw'empty condition in "if" statement '+L(this.G[this.l]);1<f.length&&(g=new eg(c),g.children=f.slice(0,-1).map(function(a){a instanceof S&&(a.qb=!1);return a}),f=f.slice(-1));if(!Z(this,0,"{"))throw'block expected after "if" statement '+L(this.G[this.l]);this.l++;return[new sg(c,f[0])]}if(!Z(this,
0,"{"))throw'block expected after "else" statement '+L(this.G[this.l]);this.l++;return[new tg(c)]}return[new zg(c)];case "else":throw'unexpected "else" '+L(this.G[this.l]);case "onevent":if(!Y(this,1,Uf))throw'unexpected token after "onevent" '+L(c);if(!Z(this,2,"{"))throw'block expected after "onevent" statement '+L(this.G[this.l]);d=this.G[this.l+1];this.l+=3;return[new hh(c,d.name)];case "return":this.l++;Z(this,0,";")?e=null:e=Cg(this);if(!Z(this,0,";"))throw"missing semicolon "+L(c);this.l++;
return[new ih(c,e)];case "break":d=null;Y(this,1,Uf)&&(d=this.G[this.l+1],this.l++);if(!Z(this,1,";"))throw"missing semicolon "+L(c);this.l+=2;return[new jh(c,!1,d?d.name:null)];case "continue":d=null;Y(this,1,Uf)&&(d=this.G[this.l+1],this.l++);if(!Z(this,1,";"))throw"missing semicolon "+L(c);this.l+=2;return[new jh(c,!0,d?d.name:null)]}if(Y(this,0,Uf)&&Z(this,1,"(")&&(d=this.G[this.l],Hf(this.Aa,d.name)))return this.l++,[new xg(c,d.name,Dg(this))];if(Y(this,0,Uf)&&Z(this,1,":"))return d=this.G[this.l],
this.l+=2,[new kh(c,d.name)];e=Cg(this);e.qb=!1;if(!Z(this,0,";"))throw"missing semicolon "+(this.l<this.G.length?L(this.G[this.l]):"eof");this.l++;e=e.H(this);return[new qg(e)]};
v.qe=function(a){if(a instanceof Yg){for(var b=0;b<a.D.length;b++)a.D[b].size=1,a.D[b].A=a.D[b].zg.map(function(c){c=c.H(this);if(!(c instanceof O))throw"non-constant expression in argument dimension "+L(c.head);if(0>=c.n||Math.round(c.n)!==c.n)throw"bad value for argument dimension "+L(c.head);a.D[b].size*=c.n;return c.n},this),this.nd(a.D[b].name,a.D[b].size,a.D[b].A,this.Oa,a.D[b].type,a.D[b].wc),this.Oa+=a.D[b].wc?1:a.D[b].size;a.La[1]={Va:this.Va.slice(),labels:this.labels.slice()}}else a instanceof
eh?a.qa&&(this.nd(a.qa.name,1,[1],this.Oa,a.cb),this.Oa+=1,a.La[1]={Va:this.Va.slice(),labels:this.labels.slice()}):tf.prototype.qe.call(this,a)};v.Bd=function(){this.Va=this.Gf;this.labels=this.Ff};v.ra=function(a){a&&(this.Va=a.Va,this.labels=a.labels)};v.getContext=function(){return{Va:this.Va,labels:this.labels.slice()}};function lh(a,b,c,d,e,f,g){Ff.call(this,a,b,c,d,e);this.vb=f;this.wc=g||!1}lh.prototype=Object.create(Ff.prototype);v=lh.prototype;v.constructor=lh;
v.ad=function(a,b){return this.vb?this.wc?[12288|a.F,20480|this.offset,a.Aa.b,20480|(b||0),a.Aa.b]:[12288|a.F,20480|this.offset+(b||0),a.Aa.b]:[12288|this.offset+(b||0)]};v.De=function(a,b){return this.vb?this.wc?[12288|a.F,20480|this.offset,a.Aa.b,24576|(b||0),a.Aa.b]:[12288|a.F,24576|this.offset+(b||0),a.Aa.b]:[16384|this.offset+(b||0)]};v.ge=function(a){return this.vb?this.wc?[12288|a.F,20480|this.offset,a.Aa.b,32770,20480,a.Aa.b]:[12288|a.F,32770,20480|this.offset,a.Aa.b]:[20480|this.offset,this.size]};
v.df=function(a){return this.vb?this.wc?[12288|a.F,20480|this.offset,a.Aa.b,32770,24576,a.Aa.b]:[12288|a.F,32770,24576|this.offset,a.Aa.b]:[24576|this.offset,this.size]};vf.prototype.nd=function(a,b,c,d,e,f){this.Va.push(new lh(a,b,c,d,e,this.vb,f))};function mh(a){S.call(this,a,4,null)}mh.prototype=Object.create(S.prototype);mh.prototype.constructor=mh;v=vf.prototype;
v.Vf=function(a){var b=new mh(a,this.vb,this.Oa);b.Ca={la:function(b,d){var c;a:{for(c=0;c<b.Ce.length;c++)if(b.Ce[c].cf===a.name){c=b.Ce[c];break a}c=null}return c?c.resultType:(c=Of(b,a.name))&&c.la?c.la(b,c,d):Gf}};return b};
v.If=function(){this.Oa=this.Aa.Oa;this.vb=!1;for(var a=[],b=0;b<this.h.length;b++){if(0<=[zg,sg,tg].indexOf(this.h[b].constructor)){if(0===a.length)throw"unexpected end of block "+L(this.h[b].head);var c=a.pop();this.Oa=c.Oa;this.vb=c.vb;c.Hg.La[0]={Va:this.Va.slice(),labels:this.labels.slice()};this.Va.splice(c.Kg);this.labels.pop();0===a.length&&(this.qa=Yf)}0<=[rg,ug,Zg,ch,gh,eh,hh,Yg,sg,tg].indexOf(this.h[b].constructor)&&(a.push({Oa:this.Oa,vb:this.vb,Kg:this.Va.length,Hg:this.h[b]}),this.labels.push([]),
this.h[b]instanceof Yg&&(this.vb=!0,this.qa=this.h[b].resultType,this.Oa=0));this.qe(this.h[b]);if(this.h[b]instanceof kh){c=this.h[b].label;for(var d=this.labels.length-1,e=0;e<this.labels[d].length;e++)if(this.labels[d][e].label===c)throw'duplicate label "'+c+'"';this.labels[d].push({label:c})}}this.Gf=this.Va.slice();this.Ff=this.labels};
v.eg=function(){for(var a=1;a<this.h.length;)this.h[a]instanceof bh&&this.h[a-1]instanceof zg?this.h.splice(a-1,1):a++;this.h.forEach(function(a){a instanceof Yg&&(this.Ce.push(a),this.qa=a.resultType)},this);for(a=0;a<this.h.length-1;a++)this.h[a]instanceof kh&&(this.h[a+1]instanceof ch?this.h[a+1].label=this.h[a].label:this.h[a+1]instanceof dh?this.h[a+1].label=this.h[a].label:this.h[a+1]instanceof eh?this.h[a+1].label=this.h[a].label:this.h[a+1]instanceof Zg&&(this.h[a+1].label=this.h[a].label))};
v.gg=function(){for(var a=0;a<this.h.length;a++)(this.h[a]instanceof hh||this.h[a]instanceof Yg)&&this.o.push(this.h[a])};function nh(a,b){for(var c=a.length-1;0<=c;c--)for(var d=a[c].length-1;0<=d;d--)if(a[c][d].label===b)return a[c][d];return null}
v.v=function(){this.cb=[];this.Bd();this.Sb=[];this.bc=this.Cc=this.Dc=this.Aa.b-2;this.F=this.bc+1;this.Hf=[];var a=this.o.map(function(a){this.Ia=0;this.ra(a.La[0]);this.jf=a instanceof mg||a instanceof Yg;this.vb=a instanceof Yg;this.Sb=[];a=a.v(this,!0);Kg(a);return{pd:a,mapping:this.Sb}},this);if(0<this.cb.length)throw"internal";for(var b=0,c=0;c<this.o.length;c++)this.o[c]instanceof lg&&b++;var d=[],e={},f=[];this.Sb=[];for(c=0;c<this.o.length;c++){var g=1+2*b+f.length;this.o[c]instanceof hh||
this.o[c]instanceof lg?(d.push({id:Jf(this.Aa,this.o[c].Ae),offset:f.length}),f=f.concat(a[c].pd)):this.o[c]instanceof mg?(e[this.o[c].ng]=f.length,f=f.concat(a[c].pd)):this.o[c]instanceof Yg&&(e[this.o[c].cf]=f.length,f=f.concat(a[c].pd));this.Sb=this.Sb.concat(a[c].mapping.map(function(a){return new Wf(a.mg,a.line,a.Ga,a.Ec+g)}))}a=[1+2*d.length];for(c=0;c<d.length;c++)a=a.concat(d[c].id,1+2*d.length+d[c].offset);for(c=0;c<f.length;c++)if("string"===typeof f[c]){if(void 0===e[f[c]])throw oh(f[c]),
'unknown function "'+f[c]+'"';f[c]=53248|e[f[c]]+a.length}return a.concat(f)};
v.Tf=function(a){for(var b=a.head.name,c=0;c<this.o.length;c++)if(this.o[c]instanceof Yg&&this.o[c].cf===b){if(a.children.length!==this.o[c].D.length)throw"wrong number of arguments "+L(a.head);b=a.qb?[b,12288|this.bc]:[b];this.vb?0<this.Oa&&(b=[12288|this.F,4096|this.Oa,32770,16384|this.F].concat(b).concat(12288|this.F,4096|this.Oa,32771,16384|this.F)):b=[4096|this.Oa,16384|this.F].concat(b);for(var d=[],e=0;e<a.children.length;e++){if(this.o[c].D[e].size!==a.children[e].jb)throw"incompatible size "+
L(a.children[e].head);if(this.o[c].D[e].wc){if(!(a.children[e]instanceof R))throw"variable reference expected "+L(a.children[e].head);if(this.o[c].D[e].type!==a.children[e].resultType)throw"variable reference type mismatch "+L(a.children[e].head);}if(this.o[c].D[e].wc){var f=Nf(this,a.children[e]);d=d.concat(f.vb?f.wc?[12288|this.F,20480|f.offset,this.Aa.b]:[12288|this.F,4096|f.offset,32770]:[4096|f.offset]).concat(this.vb?[12288|this.F,24576|e+this.Oa,this.Aa.b]:16384|e+this.Oa)}else a.children[e]=
Qg(a.children[e],this.o[c].D[e].type,this).H(this),d=d.concat(a.children[e].v(this)).concat(this.ub(a.children[e].resultType,this.o[c].D[e].type)).concat(this.vb?[12288|this.F,24576|e+this.Oa,this.Aa.b]:16384|e+this.Oa)}return d.concat(b)}return null};function ph(a){a=a.trim();if(""===a)return!1;var b=["#","//","/*"].map(function(b){b=a.indexOf(b);return 0>b?a.length:b}).sort(function(a,b){return a-b})[0];return b<a.length?"#"!==a[b]:/[;{]/.test(a)}
ag.prototype.v=function(a){return Gg(Math.round(this.n*a.nb))};function gh(a){V.call(this,a,3)}gh.prototype=Object.create(V.prototype);gh.prototype.constructor=gh;gh.prototype.H=function(a){Zf(this.children,a);return this};gh.prototype.v=function(a){var b=a.getContext();jg(this,a);a.ra(this.La[0]);var c=M.prototype.v.call(this,a);a.ra(b);return c};function fh(a){V.call(this,a)}fh.prototype=Object.create(V.prototype);fh.prototype.constructor=fh;fh.prototype.v=function(){return[]};
function ch(a,b){vg.call(this,a,b);this.label=null}ch.prototype=Object.create(vg.prototype);ch.prototype.constructor=ch;ch.prototype.v=function(a){if(null==this.b&&0===this.children.length)return[];var b=a.getContext();jg(this,a);var c=[],d=a.Ia;a.Da.push({});null!=this.b&&(c=Ig(this.b,a));Lf(a,c);a.ra(this.La[0]);this.children.forEach(function(b){a.Ia=d+c.length;c=c.concat(b.v(a))});c=c.concat(36864|-c.length&4095);Mf(a,c);qh(c,0,c.length,this.label);a.Da.pop();a.ra(b);return c};
function dh(a){V.call(this,a,3);this.label=this.b=null}dh.prototype=Object.create(V.prototype);dh.prototype.constructor=dh;dh.prototype.cg=function(a){if(!(a instanceof bh))throw'unexpected closing statement for "do"';this.b=a.b};
dh.prototype.v=function(a){if(null==this.b&&0===this.children.length)return[];var b=a.getContext();jg(this,a);var c=[],d=a.Ia;a.Da.push({});a.ra(this.La[0]);this.children.forEach(function(b){a.Ia=d+c.length;c=c.concat(b.v(a))});null!=this.b&&(c=c.concat(Ig(new S(new Vf(this.b.head.kd,this.b.head.Tc,this.b.head.Rc,"not"),0,Bg(a,"!",0),[this.b]),a)),Lf(a,c),Mf(a,c,0));qh(c,0,c.length,this.label);a.Da.pop();a.ra(b);return c};function bh(a,b){V.call(this,a,5);this.b=b}bh.prototype=Object.create(V.prototype);
bh.prototype.constructor=bh;function eh(a,b,c,d,e,f){V.call(this,a,3);d&&(d.qb=!1);f&&(f.qb=!1);this.qa=b;this.cb=c;this.h=d;this.b=e;this.m=f;this.label=null;this.ca=[]}eh.prototype=Object.create(V.prototype);v=eh.prototype;v.constructor=eh;v.Na=function(a){M.prototype.Na.call(this,a);this.h&&this.h.Na(a);this.b&&this.b.Na(a);this.m&&this.m.Na(a)};v.H=function(a){this.h&&(this.h=this.h.H(a));this.b&&(this.b=this.b.H(a));this.m&&(this.m=this.m.H(a));Zf(this.children,a);return this};
v.zd=function(a,b){this.ca.push(b)};
v.v=function(a){var b=a.getContext();jg(this,a);a.ra(this.La[1]);var c=a.Ia,d=this.h?this.h.v(a):[];a.Da.push({});var e=d.length;this.b&&(d=d.concat(Ig(this.b,a)),Lf(a,d));a.ra(this.La[0]);for(var f=0;f<this.children.length;f++)a.Ia=c+d.length,d=d.concat(this.children[f].v(a));a.ra(this.La[1]);f=d.length;a.Ia=c+d.length;Xf(a,this.ca[0]);this.m&&(d=d.concat(this.m.v(a)));d=d.concat(36864|e-d.length&4095);this.b&&Mf(a,d);qh(d,f,d.length,this.label);a.Da.pop();a.ra(b);return d};
function jh(a,b,c){V.call(this,a);this.P=b;this.label=c}jh.prototype=Object.create(V.prototype);jh.prototype.constructor=jh;function rh(a,b){kg.call(this,a,b)}rh.prototype=Object.create(kg.prototype);rh.prototype.constructor=rh;function qh(a,b,c,d){for(var e=0;e<a.length;e++)if(a[e]instanceof rh){var f=a[e].u.label;if(null==f||f===d)a[e]=a[e].u.P?36864|b-e&4095:36864|c-e&4095}}
function oh(a){if(a instanceof rh){var b=a.u.label;if(null!=b)throw"unknown "+(a.u.P?"continue":"break")+' label "'+b+'"'+L(a.u.head);throw'unexpected "'+(a.u.P?"continue":"break")+'" '+L(a.u.head);}}jh.prototype.v=function(a){if(0===a.Da.length)throw(this.P?'"continue"':'"break"')+" outside loop "+L(this.head);jg(this,a);return[new rh(a,this)]};function Zg(a,b){V.call(this,a,3);this.o=b;this.label=null}Zg.prototype=Object.create(V.prototype);Zg.prototype.constructor=Zg;
Zg.prototype.v=function(a){var b=a.Ia,c=this.o.v(a).concat(16384|a.bc),d=a.getContext();a.ra(this.La[0]);var e=!(this.children[0]instanceof $g);e&&(c=c.concat(36864),Lf(a,c));a.Da.push({});for(var f=!1,g=0;g<this.children.length;)if(a.Ia=b+c.length,this.children[g]instanceof $g){for(var h=[],m=!1;g<this.children.length&&this.children[g]instanceof $g;){if(null!=this.children[g].o){var l=this.children[g].o.H(a);if(!(l instanceof O))throw'non-constant expression in "case" '+L(this.children[g].head);
h.push(l.n)}else m=!0;g++}m?e&&(Mf(a,c),e=!1):(1===h.length?(f&&(c=c.concat(36869)),e&&Mf(a,c),c=c.concat(12288|a.bc).concat(Gg(h[0])).concat(40960|Cf.indexOf("eq"),0)):(f&&(c=c.concat(36864|4*h.length+1)),e&&Mf(a,c),h.forEach(function(b,d){c=c.concat(12288|a.bc).concat(Gg(b)).concat(40960|Cf.indexOf("ne"),4*(h.length-d)-1)}),c=c.concat(36864)),Lf(a,c),e=!0);f=!0}else c=c.concat(this.children[g].v(a)),f=!(this.children[g]instanceof jh)&&!(this.children[g]instanceof ih),g++;qh(c,-1,c.length,this.label);
a.Da.pop();a.ra(d);return c};function $g(a,b){V.call(this,a);this.o=b}$g.prototype=Object.create(V.prototype);$g.prototype.constructor=$g;$g.prototype.v=function(){throw(this.o?'"case"':'"default"')+" outside switch "+L(this.head);};function kh(a,b){V.call(this,a);this.label=b}kh.prototype=Object.create(V.prototype);kh.prototype.constructor=kh;kh.prototype.v=function(a){a.label=this.label;nh(a.labels,this.label).sg=a.Ia;return[]};function ah(a,b){V.call(this,a);this.label=b}ah.prototype=Object.create(V.prototype);
ah.prototype.constructor=ah;function sh(a,b,c){kg.call(this,a,b);this.labels=c}sh.prototype=Object.create(kg.prototype);sh.prototype.constructor=sh;sh.prototype.v=function(a){var b=nh(this.labels,this.u.label);if(null===b)throw'unknown label "'+this.u.label+'" '+L(this.u.head);return 36864|b.sg-a&4095};ah.prototype.v=function(a){return[new sh(a,this,a.labels.slice())]};function hh(a,b){V.call(this,a,3);this.Ae=b}hh.prototype=Object.create(V.prototype);hh.prototype.constructor=hh;
hh.prototype.H=function(a){Zf(this.children,a);return this};hh.prototype.v=function(a,b){if(b){b=a.getContext();jg(this,a);a.ra(this.La[0]);var c=M.prototype.v.call(this,a).concat(0);a.ra(b);return c}return[]};function Yg(a,b,c,d){V.call(this,a,3);this.cf=b;this.resultType=c;this.D=d}Yg.prototype=Object.create(V.prototype);Yg.prototype.constructor=Yg;Yg.prototype.bg=function(a){a.qa=this.resultType};Yg.prototype.H=function(a){Zf(this.children,a);return this};
Yg.prototype.v=function(a,b){if(b){b=a.getContext();jg(this,a);a.ra(this.La[0]);var c=M.prototype.v.call(this,a).concat(57344);a.ra(b);return c}return[]};function ih(a,b){V.call(this,a);b&&this.children.push(b)}ih.prototype=Object.create(V.prototype);ih.prototype.constructor=ih;
ih.prototype.zd=function(a){if(a.qa===Yf)throw'"return" outside function definition '+L(this.head);if("v"===a.qa&&0<this.children.length)throw"unexpected return value in void function "+L(this.head);if("v"!==a.qa&&0===this.children.length)throw"missing return value in non-void function "+L(this.head);0<this.children.length&&(this.children[0]=Qg(this.children[0],a.qa,a).H(a))};
ih.prototype.v=function(a){jg(this,a);var b=[];0<this.children.length&&(b=this.children[0].v(a).concat(a.ub(this.children[0].resultType,a.qa)).concat(16384|a.bc));return b.concat(57344)};var wf=[{name:"abs",Kc:1,la:function(a,b){return b[0]},fe:function(){return!0},X:function(a,b,c,d){return[12288|d,28673]}},{name:"atan2",Kc:2,Ud:1,la:function(){return Q},fe:function(a){return null!=Hf(a,"math.atan2")},X:function(a,b,c,d){return(c[0]===Q&&c[1]!==Q?[12288|d+1,4096|a.nb,32772,16384|d+1]:c[0]!==Q&&c[1]===Q?[12288|d,4096|a.nb,32772,16384|d]:[]).concat([4097,4096|d+1,4096|d,4096|d+2,49152|Hf(b,"math.atan2").id,12288|d+2,4096|Math.floor(32768/(a.nb*Math.PI)),32773])}},{name:"cos",Kc:1,
Ud:1,la:function(){return Q},fe:function(a){return null!=Hf(a,"math.cos")},X:function(a,b,c,d){return[12288|d,4096|Math.round(32767/((c[0]===Q?a.nb:1)*Math.PI)),32772,16384|d,4097,4096|d,4096|d+1,49152|Hf(b,"math.cos").id,12288|d+1,4096|Math.floor(32768/a.nb),32773]}},Lg("rand","math.rand",0),{name:"random",Kc:0,Ud:1,la:function(){return Q},fe:function(a){return null!=Hf(a,"math.rand")},X:function(a,b,c,d){return[4097,4096|d,49152|Hf(b,"math.rand").id,12288|d,28673,4096|Math.floor(32768/a.nb),32773]}},
{name:"stop",Kc:0,la:function(){return"v"},X:function(){return[0]}},{name:"sin",Kc:1,Ud:1,la:function(){return Q},fe:function(a){return null!=Hf(a,"math.sin")},X:function(a,b,c,d){return[12288|d,4096|Math.round(32767/((c[0]===Q?a.nb:1)*Math.PI)),32772,16384|d,4097,4096|d,4096|d+1,49152|Hf(b,"math.sin").id,12288|d+1,4096|Math.floor(32768/a.nb),32773]}},{name:"sqrt",Kc:1,Ud:6,la:function(){return Q},X:function(a,b,c,d){b=Gg(c[0]===Q?a.nb:a.nb*a.nb);return[4096|a.nb,16384|d+1,4106,16384|d+2,12288|d,
16384|d+4].concat(b).concat([16384|d+5,12288|d+1,16384|d+6,4097,4096|d+6,4096|d+5,4096|d+4,4096|d+3,49152|Hf(a.Aa,"math.muldiv").id,12288|d+3,12288|d+1,32770,4098,32773,16384|d+1,12288|d+2,4097,32771,16384|d+2,12288|d+2,4096,40960|Cf.indexOf("le"),-(23+b.length)&65535,12288|d+1])}}];var Ef={name:"thymio-II",maxVarSize:620,variables:[{name:"_id",size:1},{name:"event.source",size:1},{name:"event.args",size:32},{name:"_fwversion",size:2},{name:"_productId",size:1},{name:"buttons._raw",size:5},{name:"button.backward",size:1},{name:"button.left",size:1},{name:"button.center",size:1},{name:"button.forward",size:1},{name:"button.right",size:1},{name:"buttons._mean",size:5},{name:"buttons._noise",size:5},{name:"prox.horizontal",size:7},{name:"prox.comm.rx._payloads",size:7},{name:"prox.comm.rx._intensities",
size:7},{name:"prox.comm.rx",size:1},{name:"prox.comm.tx",size:1},{name:"prox.ground.ambiant",size:2},{name:"prox.ground.reflected",size:2},{name:"prox.ground.delta",size:2},{name:"motor.left.target",size:1},{name:"motor.right.target",size:1},{name:"_vbat",size:2},{name:"_imot",size:2},{name:"motor.left.speed",size:1},{name:"motor.right.speed",size:1},{name:"motor.left.pwm",size:1},{name:"motor.right.pwm",size:1},{name:"acc",size:3},{name:"temperature",size:1},{name:"rc5.address",size:1},{name:"rc5.command",
size:1},{name:"mic.intensity",size:1},{name:"mic.threshold",size:1},{name:"mic._mean",size:1},{name:"timer.period",size:2},{name:"acc._tap",size:1}],localEvents:[{name:"button.backward"},{name:"button.left"},{name:"button.center"},{name:"button.forward"},{name:"button.right"},{name:"buttons"},{name:"prox"},{name:"prox.comm"},{name:"tap"},{name:"acc"},{name:"mic"},{name:"sound.finished"},{name:"temperature"},{name:"rc5"},{name:"motor"},{name:"timer0"},{name:"timer1"}],nativeFunctions:[{name:"_system_reboot",
args:[]},{name:"_system_settings_read",args:[1,1]},{name:"_system_settings_write",args:[1,1]},{name:"_system_settings_flash",args:[]},{name:"math.copy",args:[-1,-1]},{name:"math.fill",args:[-1,1]},{name:"math.addscalar",args:[-1,-1,1]},{name:"math.add",args:[-1,-1,-1]},{name:"math.sub",args:[-1,-1,-1]},{name:"math.mul",args:[-1,-1,-1]},{name:"math.div",args:[-1,-1,-1]},{name:"math.min",args:[-1,-1,-1]},{name:"math.max",args:[-1,-1,-1]},{name:"math.clamp",args:[-1,-1,-1,-1]},{name:"math.dot",args:[1,
-1,-1,1]},{name:"math.stat",args:[-1,1,1,1]},{name:"math.argbounds",args:[-1,1,1]},{name:"math.sort",args:[-1]},{name:"math.muldiv",args:[-1,-1,-1,-1]},{name:"math.atan2",args:[-1,-1,-1]},{name:"math.sin",args:[-1,-1]},{name:"math.cos",args:[-1,-1]},{name:"math.rot2",args:[2,2,1]},{name:"math.sqrt",args:[-1,-1]},{name:"math.rand",args:[-1]},{name:"_leds.set",args:[1,1]},{name:"sound.record",args:[1]},{name:"sound.play",args:[1]},{name:"sound.replay",args:[1]},{name:"sound.system",args:[1]},{name:"leds.circle",
args:[1,1,1,1,1,1,1,1]},{name:"leds.top",args:[1,1,1]},{name:"leds.bottom.left",args:[1,1,1]},{name:"leds.bottom.right",args:[1,1,1]},{name:"sound.freq",args:[1,1]},{name:"leds.buttons",args:[1,1,1,1]},{name:"leds.prox.h",args:[1,1,1,1,1,1,1,1]},{name:"leds.prox.v",args:[1,1]},{name:"leds.rc",args:[1]},{name:"leds.sound",args:[1]},{name:"leds.temperature",args:[1,1]},{name:"sound.wave",args:[142]},{name:"prox.comm.enable",args:[1]},{name:"sd.open",args:[1,1]},{name:"sd.write",args:[-1,1]},{name:"sd.read",
args:[-1,1]},{name:"sd.seek",args:[1,1]},{name:"_rf.nodeid",args:[1]},{name:"_poweroff",args:[]}]};function th(a,b,c){this.id=a;this.o=b;if(c instanceof ArrayBuffer)this.h=c;else if(c){for(a=b=0;a<c.length;a++)b="string"===typeof c[a]?b+(1+c[a].length):b+2;b=new ArrayBuffer(b);for(var d=new DataView(b),e=a=0;a<c.length;a++)if("string"===typeof c[a]){d.setUint8(e++,c[a].length);for(var f=0;f<c[a].length;f++)d.setUint8(e++,c[a].charCodeAt(f))}else 32768>c[a]?d.setInt16(e,c[a],!0):d.setUint16(e,c[a],!0),e+=2;this.h=b}else this.h=new ArrayBuffer(0)}
function uh(a){function b(a){for(var b=[],d=0,e=0;e<a.length;e++)if(a[e]){for(var f=c.getUint8(d),g="",k=0;k<f;k++)g+=String.fromCharCode(c.getUint8(d+1+k));b.push(g);d+=1+f}else b.push(c.getUint16(d,!0)),d+=2;return b}var c=new DataView(a.h);switch(a.id){case vh:var d=b([!0,!1,!1,!1,!1,!1,!1,!1]);a.nodeName=d[0];a.Nd=d[2];a.Yd=d[3];a.md=d[4];break;case wh:d=b([!1,!0]);a.Oa=d[0];a.ca=d[1];break;case xh:d=b([!0,!0]);break;case yh:var e=[!0,!0,!1];d=b(e);a.functionName=d[0];a.F=d[2];for(var f=0;f<a.F;f++)e.push(!1),
e.push(!0);d=b(e);a.fa=[];for(f=0;f<a.F;f++)a.fa.push({size:d[3+2*f]-(d[3+2*f]&32768?65536:0),name:d[4+2*f]});break;case zh:c.getUint16(0,!0);a.qc=[];for(f=2;f<c.byteLength;f+=2)a.qc.push(c.getUint16(f,!0));break;case Ah:a.b=c.getUint16(0,!0);f=c.getUint16(2,!0);a.flags={flags:f,Qg:0!==(f&1),Vg:0!==(f&2),Rg:0!==(f&4)};break;case Bh:a.b=c.getUint16(2,!0);a.result=c.getUint16(4,!0);break;case Ch:a.m=c.getUint16(0,!0);c.getUint16(2,!0);d=[];for(f=4;f<c.byteLength;f+=2)d.push(c.getUint16(f,!0));a.pd=
d;break;case Dh:case Eh:case Fh:case Gh:case Hh:case Ih:case Jh:a.m=c.getUint16(0,!0);break;case Kh:case Lh:a.m=c.getUint16(0,!0);a.b=c.getUint16(2,!0);break;case Mh:a.m=c.getUint16(0,!0);c.getUint16(2,!0);c.getUint16(4,!0);break;case Nh:a.m=c.getUint16(0,!0);c.getUint16(2,!0);d=[];for(f=4;f<c.byteLength;f+=2)d.push(c.getUint16(f,!0));break;case Oh:a.version=c.getUint16(0,!0)}}
function Ph(a){var b=new ArrayBuffer(6+a.h.byteLength),c=new DataView(b);c.setUint16(0,a.h.byteLength,!0);c.setUint16(2,a.o,!0);c.setUint16(4,a.id,!0);(new Uint8Array(b)).set(new Uint8Array(a.h),6);return b}th.prototype.Ab=function(){var a=new th(this.id,this.o,this.h);uh(a);return a};th.prototype.toString=function(){var a=Qh[this.id]||"0x"+this.id.toString(16);a+=" from "+this.o.toString(10);0<=this.m&&(a+=" to "+this.m.toString());return a};
var vh=36864,wh=36865,xh=36866,yh=36867,zh=36869,Ah=36874,Bh=36875,Ch=40961,Eh=40962,Fh=40963,Gh=40964,Hh=40965,Ih=40966,Jh=40967,Kh=40968,Lh=40969,Dh=40970,Mh=40971,Nh=40972,Oh=40977,Qh={36864:"description",36865:"namedVariableDescription",36866:"localEventDescription",36867:"nativeFunctionDescription",36869:"variables",36874:"executionStateChanged",36876:"nodePresent",40960:"getDescription",40961:"setBytecode",40962:"reset",40963:"run",40964:"pause",40965:"step",40966:"stop",40967:"getExecutionState",
40968:"breakpointSet",40969:"breakpointClear",40970:"breakpointClearAll",40971:"getVariables",40972:"setVariables",40976:"getNodeDescription",40977:"listNodes"};function Rh(a){this.wd=a&&a.wd||54321;this.Ta=a&&a.Ta||[];this.ud=a&&a.ud||[];this.Nb=a&&a.Nb||[];this.Nd=a&&a.Nd||500;this.Yd=a&&a.Yd||200;this.md=a&&a.md||200;a=[];for(var b=0,c=0;c<this.Ta.length;c++)this.Ta[c].offset=b,a=a.concat(this.Ta[c].V),b+=this.Ta[c].V.length;for(;a.length<this.md;)a.push(0);this.qc=a;this.M=[];this.b=0;this.h=!1;this.m=!0;this.o=!1;this.stack=[];this.P=[];this.write=this.F=null}
Rh.prototype.Ab=function(){var a=new Rh({wd:this.wd,Ta:this.Ta,ud:this.ud,Nb:this.Nb,Nd:this.Nd,Yd:this.Yd,md:this.md});a.Nd=this.Nd;a.Yd=this.Yd;a.md=this.md;a.M=this.M.slice();a.b=this.b;a.h=this.h;a.m=this.m;a.o=this.o;a.stack=this.stack.slice();a.P=this.P.slice();return a};
function Sh(a,b,c){if(a.F)for(var d=0;d<a.Ta.length;d++)if(a.Ta[d].offset+a.Ta[d].V.length>b&&a.Ta[d].offset<b+c.length)for(var e=0;e<a.Ta[d].V.length;e++)0<=a.Ta[d].offset+e-b&&a.Ta[d].offset+e-b<c.length&&a.F(a.Ta[d].name,e,c[a.Ta[d].offset+e-b],a.qc[a.Ta[d].offset+e]);c.forEach(function(a,c){this.qc[b+c]=a},a)}function Th(a,b){a:{if(0<a.M.length)for(var c=1;c<a.M[0];c+=2)if(a.M[c]==b){b=a.M[c+1];break a}b=null}null!==b&&(a.h&&(c=new th(36872,a.wd,[a.b]),a.write&&a.write(Ph(c))),a.b=b,a.h=!0)}
function Uh(a){a.h=!1;a.m=!0;a.o=!1;if(0<a.M.length)for(var b=a.M[0];b<a.M.length;){var c=a.M[b];10==c>>>12&&(a.M[b]&=-513);b+=[1,1,2,1,1,2,2,1,1,1,2,3,1,1,1,1][c>>>12]}a.stack=[];for(b=0;b<a.qc.length;b++)a.qc[b]=0;a.ca&&a.ca();Th(a,65535)}
function Vh(a){function b(a){return 32768<=a?a-65536:a}function c(a){switch(a){case 28672:d.stack.push(-d.stack.pop());break;case 28673:d.stack.push(Math.abs(d.stack.pop()));break;case 28674:d.stack.push(~d.stack.pop());break;case 32768:a=d.stack.pop();d.stack.push(b(d.stack.pop()<<a&65535));break;case 32769:a=d.stack.pop();d.stack.push(d.stack.pop()>>a);break;case 32770:d.stack.push(b(d.stack.pop()+d.stack.pop()&65535));break;case 32771:a=d.stack.pop();d.stack.push(b(d.stack.pop()-a&65535));break;
case 32772:d.stack.push(b(d.stack.pop()*d.stack.pop()&65535));break;case 32773:a=d.stack.pop();d.stack.push(b(Math.trunc(d.stack.pop()/a)&65535));break;case 32774:a=d.stack.pop();d.stack.push(b(d.stack.pop()%a&65535));break;case 32775:d.stack.push(b((d.stack.pop()|d.stack.pop())&65535));break;case 32776:d.stack.push(b((d.stack.pop()^d.stack.pop())&65535));break;case 32777:d.stack.push(b(d.stack.pop()&d.stack.pop()&65535));break;case 32778:d.stack.push(d.stack.pop()===d.stack.pop()?1:0);break;case 32779:d.stack.push(d.stack.pop()!==
d.stack.pop()?1:0);break;case 32780:a=d.stack.pop();d.stack.push(d.stack.pop()>a?1:0);break;case 32781:a=d.stack.pop();d.stack.push(d.stack.pop()>=a?1:0);break;case 32782:a=d.stack.pop();d.stack.push(d.stack.pop()<a?1:0);break;case 32783:a=d.stack.pop();d.stack.push(d.stack.pop()<=a?1:0);break;case 32784:a=d.stack.pop();d.stack.push(d.stack.pop()||a?1:0);break;case 32785:a=d.stack.pop();d.stack.push(d.stack.pop()&&a?1:0);break;default:throw"unknown op 0x"+a.toString(16);}}var d=a,e=a.M[a.b],f=e&4095;
switch(e>>>12){case 0:a.h=!1;break;case 1:a.stack.push(2048<=f?f-4096:f);break;case 2:a.b++;a.stack.push(b(a.M[a.b]));break;case 3:a.stack.push(a.qc[f]);break;case 4:Sh(a,f,[a.stack.pop()]);break;case 5:a.b++;e=a.M[a.b];var g=a.stack.pop();if(g>=e)throw"out of bounds";a.stack.push(a.qc[f+g]);break;case 6:a.b++;e=a.M[a.b];g=a.stack.pop();if(g>=e)throw"Index out of bounds";Sh(a,f+g,[a.stack.pop()]);break;case 9:a.b+=(2048<=f?f-4096:f)-1;break;case 10:var h=e&256;c(32768|e&255);f=0!=a.stack.pop();a.b++;
g=b(a.M[a.b]);if(h){h=a.b-1;if(e&512||!f)a.b+=g-2;a.M[h]=f?a.M[h]|512:a.M[h]&-513}else f||(a.b+=g-2);break;case 11:null(f);break;case 12:if(0>f||f>=a.Nb.length)throw"Native call index out of bounds";var m=a.Nb[f].fa.map(function(){return{p:this.stack.pop()}},a),l=[];a.Nb[f].fa.forEach(function(a,b){m[b].kg=0===a.size?this.stack.pop():a.size},a);a.Nb[f].fa.forEach(function(a){0>a.size&&void 0===l[-a.size]&&(l[-a.size]=0)},a);l=l.map(function(a){return void 0!==a?this.stack.pop():a},a);a.Nb[f].fa.forEach(function(a,
b){0>a.size&&(m[b].kg=l[-a.size])},a);var r=m.map(function(a){return this.qc.slice(a.p,a.p+a.kg)},a);a.Nb[f].Ea(a,r);m.forEach(function(a,b){Sh(this,a.p,r[b])},a);break;case 13:a.stack.push(a.b+1);a.b=f-1;break;case 14:a.b=a.stack.pop()-1;break;case 15:throw"op 0x"+e.toString(16)+" (reserved) not implemented";default:c(e)}a.b++}Rh.prototype.nc=function(){for(;this.h&&(Vh(this),!this.m););};function Wh(a){function b(a){a&=65535;return 32768<=a?a-65536:a}Rh.call(this,{wd:a,Ta:[{name:"_id",V:[0]},{name:"event.source",V:[0]},{name:"event.args",V:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{name:"_fwversion",V:[0,0]},{name:"_productId",V:[0]},{name:"buttons._raw",V:[0,0,0,0,0]},{name:"button.backward",V:[0]},{name:"button.left",V:[0]},{name:"button.center",V:[0]},{name:"button.forward",V:[0]},{name:"button.right",V:[0]},{name:"buttons._mean",V:[0,0,0,0,0]},{name:"buttons._noise",
V:[0,0,0,0,0]},{name:"prox.horizontal",V:[0,0,0,0,0,0,0]},{name:"prox.comm.rx._payloads",V:[0,0,0,0,0,0,0]},{name:"prox.comm.rx._intensities",V:[0,0,0,0,0,0,0]},{name:"prox.comm.rx",V:[0]},{name:"prox.comm.tx",V:[0]},{name:"prox.ground.ambiant",V:[0,0]},{name:"prox.ground.reflected",V:[0,0]},{name:"prox.ground.delta",V:[0,0]},{name:"motor.left.target",V:[0]},{name:"motor.right.target",V:[0]},{name:"_vbat",V:[0,0]},{name:"_imot",V:[0,0]},{name:"motor.left.speed",V:[0]},{name:"motor.right.speed",V:[0]},
{name:"motor.left.pwm",V:[0]},{name:"motor.right.pwm",V:[0]},{name:"acc",V:[0,0,0]},{name:"temperature",V:[0]},{name:"rc5.address",V:[0]},{name:"rc5.command",V:[0]},{name:"mic.intensity",V:[0]},{name:"mic.threshold",V:[0]},{name:"mic._mean",V:[0]},{name:"timer.period",V:[0,0]},{name:"acc._tap",V:[0]},{name:"sd.present",V:[0]}],ud:[{name:"button.backward",description:"Backward button state changed"},{name:"button.left",description:"Left button state changed"},{name:"button.center",description:"Center button state changed"},
{name:"button.forward",description:"Forward button state changed"},{name:"button.right",description:"Right button state changed"},{name:"buttons",description:"Buttons values updated"},{name:"prox",description:"Proximity values updated"},{name:"prox.comm",description:"Data received on the proximity communication"},{name:"tap",description:"Tap detected"},{name:"acc",description:"Accelerometer values updated"},{name:"mic",description:"Microphone above threshold"},{name:"sound.finished",description:"Sound playback finished"},
{name:"temperature",description:"Temperature value updated"},{name:"rc5",description:"RC5 message received"},{name:"motor",description:"Motor timer"},{name:"timer0",description:"Timer 0"},{name:"timer1",description:"Timer 1"}],Nb:[{name:"_system_reboot",fa:[],Ea:function(){}},{name:"_system_settings_read",fa:[],Ea:function(){}},{name:"_system_settings_write",fa:[],Ea:function(){}},{name:"_system_settings_flash",fa:[],Ea:function(){}},{name:"math.copy",fa:[],Ea:function(a,b){for(a=0;a<b[0].length;a++)b[0][a]=
b[1][a]}},{name:"math.fill",fa:[],Ea:function(a,b){for(a=0;a<b[0].length;a++)b[0][a]=b[1][0]}},{name:"math.addscalar",fa:[{name:"r",size:-1},{name:"a",size:-1},{name:"b",size:1}],Ea:function(a,d){for(a=0;a<d[0].length;a++)d[0][a]=b(d[1][a]+d[2][0])}},{name:"math.add",fa:[{name:"r",size:-1},{name:"a",size:-1},{name:"b",size:-1}],Ea:function(a,d){for(a=0;a<d[0].length;a++)d[0][a]=b(d[1][a]+d[2][a])}},{name:"math.sub",fa:[{name:"r",size:-1},{name:"a",size:-1},{name:"b",size:-1}],Ea:function(a,d){for(a=
0;a<d[0].length;a++)d[0][a]=b(d[1][a]-d[2][a])}},{name:"math.mul",fa:[{name:"r",size:-1},{name:"a",size:-1},{name:"b",size:-1}],Ea:function(a,d){for(a=0;a<d[0].length;a++)d[0][a]=b(d[1][a]*d[2][a])}},{name:"math.div",fa:[{name:"r",size:-1},{name:"a",size:-1},{name:"b",size:-1}],Ea:function(a,d){for(a=0;a<d[0].length;a++)d[0][a]=b(Math.trunc(d[1][a]/d[2][a]))}},{name:"math.min",fa:[{name:"r",size:-1},{name:"a",size:-1},{name:"b",size:-1}],Ea:function(a,b){for(a=0;a<b[0].length;a++)b[0][a]=Math.min(b[1][a],
b[2][a])}},{name:"math.max",fa:[{name:"r",size:-1},{name:"a",size:-1},{name:"b",size:-1}],Ea:function(a,b){for(a=0;a<b[0].length;a++)b[0][a]=Math.max(b[1][a],b[2][a])}},{name:"math.clamp",fa:[{name:"r",size:-1},{name:"x",size:-1},{name:"low",size:-1},{name:"high",size:-1}],Ea:function(a,b){for(a=0;a<b[0].length;a++)b[0][a]=Math.min(Math.max(b[1][a],b[2][a]),b[3][a])}},{name:"math.dot",fa:[{name:"r",size:-1},{name:"a",size:-1},{name:"b",size:-1},{name:"shift",size:1}],Ea:function(a,b){for(var c=a=
0;c<b[0].length;c++)a+=b[1][c]*b[2][c];b[0][0]=a/Math.pow(2,b[3][0])}},{name:"math.stat",fa:[{name:"x",size:-1},{name:"min",size:1},{name:"max",size:1},{name:"mean",size:1}],Ea:function(a,b){a=0;b[1][0]=32767;b[2][0]=-32768;for(var c=0;c<b[0].length;c++)b[1][0]=Math.min(b[1][0],b[0][c]),b[2][0]=Math.max(b[2][0],b[0][c]),a+=b[0][c];b[3][0]=a/b[0].length}},{name:"math.argbounds",fa:[{name:"x",size:-1},{name:"argmin",size:1},{name:"argmax",size:1}],Ea:function(a,b){a=-Infinity;for(var c=Infinity,d=0;d<
b[0].length;d++)b[0][d]<c&&(c=b[0][d],b[1][0]=d),b[0][d]>a&&(a=b[0][d],b[2][0]=d)}},{name:"math.sort",fa:[{name:"x",size:-1}],Ea:function(a,b){b[0].sort(function(a,b){return a-b})}},{name:"math.muldiv",fa:[{name:"r",size:-1},{name:"a",size:-1},{name:"b",size:-1},{name:"c",size:-1}],Ea:function(a,d){for(a=0;a<d[0].length;a++)d[0][a]=b(d[1][a]*d[2][a]/d[3][a])}},{name:"math.atan2",description:"Atan2",fa:[{name:"r",size:-1},{name:"y",size:-1},{name:"x",size:-1}],Ea:function(a,b){b[2].forEach(function(a,
c){b[0][c]=Math.round(32767*Math.atan2(b[1][c],a)/Math.PI)})}},{name:"math.sin",description:"Sine",fa:[{name:"r",size:-1},{name:"theta",size:-1}],Ea:function(a,b){b[1].forEach(function(a,c){b[0][c]=Math.round(32767*Math.sin(a*Math.PI/32768))})}},{name:"math.cos",description:"Cosine",fa:[{name:"r",size:-1},{name:"theta",size:-1}],Ea:function(a,b){b[1].forEach(function(a,c){b[0][c]=Math.round(32767*Math.cos(a*Math.PI/32768))})}},{name:"math.rot2",fa:[{name:"r",size:2},{name:"v",size:2},{name:"theta",
size:1}]},{name:"math.sqrt",description:"Square root",fa:[{name:"r",size:-1},{name:"x",size:-1}],Ea:function(a,b){b[1].forEach(function(a,c){b[0][c]=0<a?Math.floor(Math.sqrt(a)):0})}},{name:"math.rand",description:"Pseudo-random number",fa:[{name:"r",size:-1}],Ea:function(a,b){for(a=0;a<b[0].length;a++)b[0][a]=Math.floor(65535.9999*Math.random())-32768}},{name:"_leds.set",fa:[{name:"led",size:1},{name:"br",size:1}],Ea:function(){}},{name:"sound.record",fa:[{name:"n",size:1}],Ea:function(){}},{name:"sound.play",
fa:[{name:"n",size:1}],Ea:function(){}},{name:"sound.replay",fa:[{name:"n",size:1}],Ea:function(){}},{name:"sound.system",description:"Start playing system sound",fa:[{name:"n",size:1}],Ea:function(){}},{name:"leds.circle",description:"Set circular leds",fa:[{name:"l0",size:1},{name:"l1",size:1},{name:"l2",size:1},{name:"l3",size:1},{name:"l4",size:1},{name:"l5",size:1},{name:"l6",size:1},{name:"l7",size:1}],Ea:function(a,b){a.state["leds.circle"]=b.map(function(a){return a[0]});a.Lc&&a.Lc("leds.circle")}},
{name:"leds.top",description:"Set top RGB led",fa:[{name:"r",size:1},{name:"g",size:1},{name:"b",size:1}],Ea:function(a,b){a.state["leds.top"]=b.map(function(a){return a[0]});a.Lc&&a.Lc("leds.top")}},{name:"leds.bottom.left",description:"Set bottom-left RGB led",fa:[{name:"r",size:1},{name:"g",size:1},{name:"b",size:1}],Ea:function(a,b){a.state["leds.bottom.left"]=b.map(function(a){return a[0]});a.Lc&&a.Lc("leds.bottom.left")}},{name:"leds.bottom.right",description:"Set bottom-right RGB led",fa:[{name:"r",
size:1},{name:"g",size:1},{name:"b",size:1}],Ea:function(a,b){a.state["leds.bottom.right"]=b.map(function(a){return a[0]});a.Lc&&a.Lc("leds.bottom.right")}},{name:"sound.freq",description:"Play frequency",fa:[{name:"Hz",size:1},{name:"ds",size:1}],Ea:function(a,b){console.info(b)}},{name:"leds.buttons",description:"Set buttons leds",fa:[{name:"led 0",size:1},{name:"led 1",size:1},{name:"led 2",size:1},{name:"led 3",size:1}]},{name:"leds.prox.h",description:"Set horizontal proximity leds",fa:[{name:"led 0",
size:1},{name:"led 1",size:1},{name:"led 2",size:1},{name:"led 3",size:1},{name:"led 4",size:1},{name:"led 5",size:1},{name:"led 6",size:1},{name:"led 7",size:1}]},{name:"leds.prox.v",description:"Set vertical proximity leds",fa:[{name:"led 0",size:1},{name:"led 1",size:1}]},{name:"leds.rc",description:"Set rc led",fa:[{name:"led",size:1}]},{name:"leds.sound",description:"Set sound led",fa:[{name:"led",size:1}]},{name:"leds.temperature",description:"Set ntc led",fa:[{name:"red",size:1},{name:"blue",
size:1}]},{name:"sound.wave",description:"Set the primary wave of the tone generator",fa:[{name:"wave",size:142}],Ea:function(){}},{name:"prox.comm.enable",description:"Enable or disable the proximity communication",fa:[{name:"state",size:1}]},{name:"sd.open",description:"Open a file on the SD card",fa:[{name:"number",size:1},{name:"status",size:1}]},{name:"sd.write",description:"Write data to the opened file",fa:[{name:"data",size:-1},{name:"written",size:1}]},{name:"sd.read",description:"Read data from the opened file",
fa:[{name:"data",size:-1},{name:"read",size:1}]},{name:"sd.seek",description:"Seek the opened file",fa:[{name:"position",size:1},{name:"status",size:1}]},{name:"_rf.nodeid"},{name:"_poweroff"}],md:620});this.state={};this.Lc=null}Wh.prototype=Object.create(Rh.prototype);Wh.prototype.constructor=Wh;function Xh(){K.call(this);this.Pb=!0;this.m=new Wh(9999);var a=this;this.m.Lc=function(b){a.qa[b]&&a.qa[b](b,a.m.state[b])};this.m.F=function(b,c,d){switch(b){case "timer.period":a.setTimer(c,.001*d,!0)}};this.Aa=new sf}Xh.prototype=Object.create(K.prototype);Xh.prototype.constructor=Xh;Xh.prototype.reset=function(a){K.prototype.reset.call(this,a);Uh(this.m)};function Yh(a,b){b=If(a.Aa,b);return null==b?null:a.m.qc.slice(b.offset,b.offset+b.size)}
function Zh(a,b,c){var d=If(a.Aa,b);if(null==d)throw"Unknown VM variable "+b;if(c.length!==d.size)throw"Bad size for variable "+b;Array.prototype.splice.apply(a.m.qc,[d.offset,d.size].concat(c))}
Xh.prototype.set=function(a,b){if(this.Pb){K.prototype.set.call(this,a,b);switch(a){case "button.backward":case "button.left":case "button.center":case "button.forward":case "button.right":Zh(this,a,[b?1:0]);break;case "prox.ground.delta":Zh(this,"prox.ground.delta",b.map(function(a){return 2E3*a}));break;case "prox.horizontal":Zh(this,"prox.horizontal",b.map(function(a){return 2E3*a}));break;case "acc":Zh(this,"acc",b.map(function(a){return 22*a}));break;default:throw"Unknown variable "+a;}this.qa[a]&&
this.qa[a](a,b)}else K.prototype.set.call(this,a,b)};
Xh.prototype.get=function(a){if(this.Pb)switch(a){case "leds.top":return(this.m.state&&this.m.state["leds.top"]||[0,0,0]).map(function(a){return 32<=a?1:0>=a?0:a/32});case "leds.bottom.left":return(this.m.state&&this.m.state["leds.bottom.left"]||[0,0,0]).map(function(a){return 32<=a?1:0>=a?0:a/32});case "leds.bottom.right":return(this.m.state&&this.m.state["leds.bottom.right"]||[0,0,0]).map(function(a){return 32<=a?1:0>=a?0:a/32});case "leds.circle":return(this.m.state&&this.m.state["leds.circle"]||
[0,0,0,0,0,0,0,0]).map(function(a){return 16<=a?1:0});case "motor.left":return Yh(this,"motor.left.target")[0]/200;case "motor.right":return Yh(this,"motor.right.target")[0]/200;default:return K.prototype.get.call(this,a)}else return K.prototype.get.call(this,a)};Xh.prototype.sendEvent=function(a,b){if(this.Pb){if(null!=b)throw"Event arguments not implemented";a=Jf(this.Aa,a);Th(this.m,a);$h(this)}else K.prototype.sendEvent.call(this,a,b)};
Xh.prototype.loadCode=function(a,b){"js"===a?(K.prototype.loadCode.call(this,a,b),this.Pb=!1):(b=(a=ph(b))?new vf(this.Aa,b):new tf(this.Aa,b),b.Mb=a?wf:uf,b=xf(b),a=this.m,a.M.splice.apply(a.M,[0,b.length].concat(b)),Uh(this.m),$h(this),this.Pb=!0)};function $h(a){for(var b=0;2E3>b&&a.m.h;b++)Vh(a.m)};function qf(a,b){a.h=new wb(a.ca,{ea:a.ea});var c=null;return new cf({nc:function(b,e){var d=a.O;d.$.loadCode(b,e);null!==c&&clearInterval(c);d.$.start(ai());c=setInterval(function(){d.$.run(ai(),function(a,b){bi(d,a,b)})},10);d.$.dc=d.paused;ci(a)},bd:function(){var c=new Xh;c=new di(a.h,c);b&&b.Mf&&xd(a.h,b.Mf);b&&b.Nf&&(a.h.transform=b.Nf);a.O=c},Ad:"js",languages:["js","aseba","l2","python"]})};function ei(){this.b=[]}ei.prototype.add=function(a){this.b.push(a)};ei.prototype.J=function(a){this.b.forEach(function(b){b.J(a)})};function fi(){}fi.prototype.b=function(){throw"internal";};fi.prototype.J=function(){};function gi(a,b,c){this.x=a;this.y=b;this.h=c}gi.prototype=Object.create(fi.prototype);gi.prototype.constructor=gi;
gi.prototype.b=function(a,b,c){for(var d=Infinity,e=this.x.length,f=0;f<(this.h?this.x.length:this.x.length-1);f++){var g=this.x[(f+1)%e],h=this.y[(f+1)%e],m=[Math.cos(c),g-this.x[f],Math.sin(c),h-this.y[f]];g=[g-a,h-b];h=m[0]*m[3]-m[1]*m[2];m=[(m[3]*g[0]-m[1]*g[1])/h,(m[0]*g[1]-m[2]*g[0])/h];d=Math.min(d,0<=m[1]&&1>=m[1]&&0<m[0]?m[0]:Infinity)}return d};
gi.prototype.J=function(a){a.save();a.beginPath();a.moveTo(this.x[0],this.y[0]);for(var b=1;b<this.x.length;b++)a.lineTo(this.x[b],this.y[b]);this.h&&a.closePath();a.stroke();a.restore()};function hi(a,b,c){this.x=a;this.y=b;this.r=c}hi.prototype=Object.create(fi.prototype);hi.prototype.constructor=hi;
hi.prototype.b=function(a,b,c){var d=(this.x-a)*Math.cos(c)+(this.y-b)*Math.sin(c);a=(a-this.x)*Math.sin(c)+(this.y-b)*Math.cos(c);a=this.r*this.r-a*a;if(0>a)return Infinity;a=Math.sqrt(a);return 0>d+a?Infinity:0>d-a?d+a:d-a};hi.prototype.J=function(a){a.save();a.beginPath();a.arc(this.x,this.y,this.r,0,2*Math.PI);a.stroke();a.restore()};function ii(a,b){this.width=a;this.height=b}
function di(a,b){var c=this;this.Ba=new Ba;this.$=b;this.P=this.Ke=this.paused=this.Xd=!1;this.Yb=ji;this.b=new ii(10*this.$.Mb,7.07*this.$.Mb);b=this.$.Mb;this.$.setPositionLimits(-this.b.width/2+b,this.b.width/2-b,-this.b.height/2+b,this.b.height/2-b);this.We=this.Zb=null;this.h=document.createElement("canvas");this.ef=!1;this.Xe=this.Ib=null;this.m=document.createElement("canvas");this.F=new ei;this.gf=!1;this.Ye=this.ca=null;ki(this);this.$.ub=function(){li(c);mi(c);ni(c)};this.o=a;this.o.state=
{};this.qa=!1}var ji="ground";di.prototype.Wd=function(){this.Ba.b=[]};function zf(a){var b="teacher"===Ua("role");a.Gb=b}function oi(a){var b=a.O;if(b.Zb){b.h.width=b.Zb.width;b.h.height=b.Zb.height;var c=b.h.getContext("2d");c.fillStyle="white";c.fillRect(0,0,b.Zb.width,b.Zb.height);c.drawImage(b.Zb,0,0,b.Zb.width,b.Zb.height)}else b.h.width=b.o?b.o.width:800,b.h.height=b.h.width*b.b.height/b.b.width,c=b.h.getContext("2d"),c.fillStyle="white",c.fillRect(0,0,b.h.width,b.h.height);b.ef=!1;Gb(a)}
function bi(a,b,c){if(a.Ke){var d=a.h.getContext("2d");d.save();d.translate(a.h.width/2,a.h.height/2);d.scale(a.h.width/a.b.width,-a.h.height/a.b.height);d.beginPath();switch(b){case "l":d.moveTo(c[0],c[1]);d.lineTo(c[2],c[3]);break;case "a":d.arc(c[0],c[1],Math.abs(c[2]),c[3],c[4],0>c[2])}d.strokeStyle="#060";d.lineCap="round";d.lineWidth=.1*a.$.Mb;d.stroke();d.restore();a.ef=!0}}
function ki(a){a.F.b=[];a.F.add(new gi([-a.b.width/2,a.b.width/2,a.b.width/2,-a.b.width/2],[-a.b.height/2,-a.b.height/2,a.b.height/2,a.b.height/2],!0))}
function pi(a,b){var c=a.O;ki(c);if(c.ca=b){var d=new $d(b),e=c.b.width/d.Fa[2],f=-c.b.width*(.5+d.Fa[0]/d.Fa[2]),g=-c.b.height/d.Fa[3],h=c.b.height*(.5+d.Fa[1]/d.Fa[3]);d.J(null,{wa:{line:function(a,b,d){c.F.add(new gi(a.map(function(a){return f+e*a}),b.map(function(a){return h+g*a}),d))},we:function(a,b,d){c.F.add(new hi(f+e*a,h+g*b,(e-g)/2*d))}}})}c.gf=null!=b;mi(c);Gb(a)}
function qi(a,b,c){b=Math.round(a.h.width*(b+a.b.width/2)/a.b.width);c=Math.round(a.h.height*(a.b.height/2-c)/a.b.height);return a.h.getContext("2d").getImageData(b,c,1,1).data[0]/255}function ri(a,b,c){if(null==a.Ib)return 0;b=Math.round(a.m.width*(b+a.b.width/2)/a.b.width);c=Math.round(a.m.height*(a.b.height/2-c)/a.b.height);a=a.m.getContext("2d").getImageData(b,c,1,1).data;return-(a[0]+a[1]+a[2])/765}
function li(a){for(var b=[],c=0;2>c;c++)b.push(qi(a,a.$.b[0]+a.$.Cc*Math.cos(a.$.h)+(0===c?-1:1)*a.$.Hd*Math.sin(a.$.h),a.$.b[1]+a.$.Cc*Math.sin(a.$.h)-(0===c?-1:1)*a.$.Hd*Math.cos(a.$.h))+Bf(a.$,.05));a.$.set("prox.ground.delta",b)}
function mi(a){var b=Math.cos(a.$.h),c=Math.sin(a.$.h),d=[{fd:70,dd:60,Ya:.7},{fd:85,dd:30,Ya:.35},{fd:95,dd:0,Ya:0},{fd:85,dd:-30,Ya:-.35},{fd:70,dd:-60,Ya:-.7},{fd:-25,dd:35,Ya:2.8},{fd:-25,dd:-35,Ya:-2.8}].map(function(a){var d=this.F,e=this.$.b[0]+a.fd*b-a.dd*c,h=this.$.b[1]+a.fd*c+a.dd*b;a=this.$.h+a.Ya;for(var m=Infinity,l=0;l<d.b.length;l++)m=Math.min(m,d.b[l].b(e,h,a));d=m+Bf(this.$,.01*this.$.r);return 100>d?1:300<d?0:(d-300)*(d-300)/4E4},a);a.$.set("prox.horizontal",d)}
function ni(a){for(var b=[0,0,a.$.r],c=[-a.$.r,a.$.r,0],d=[],e=0;3>e;e++)d.push(ri(a,a.$.b[0]+b[e]*Math.cos(a.$.h)+c[e]*Math.sin(a.$.h),a.$.b[1]+b[e]*Math.sin(a.$.h)-c[e]*Math.cos(a.$.h)));b=200*(d[1]-d[0])/(2*a.$.r);d=200*(d[2]-(d[0]+d[1])/2)/a.$.Cc;a.$.set("acc",[b+Bf(a.$,.02),d+Bf(a.$,.02),Math.sqrt(1-b*b-d*d)+Bf(a.$,.02)])}
function gf(a,b){switch(a.O.Yb){case ji:a.O.We=null==b?a.O.Zb:null;a.O.Zb=b;oi(a);li(a.O);Gb(a);break;case "height":a.O.Xe=null==b?a.O.Ib:null;var c=a.O;c.Ib=b;c.Ib?(c.m.width=c.Ib.width,c.m.height=c.Ib.height,b=c.m.getContext("2d"),b.fillStyle="white",b.fillRect(0,0,c.Ib.width,c.Ib.height),b.drawImage(c.Ib,0,0,c.Ib.width,c.Ib.height)):(c.m.width=1,c.m.height=1);ni(c);Gb(a)}}function ff(a,b){switch(a.O.Yb){case "obstacle":a.O.Ye=null==b?a.O.ca:null,pi(a,b)}}
tb.prototype.start=function(a){this.O.paused=a;this.O.Xd=!a;Gb(this)};function si(a){a=[a[0],Math.max(.2+.8*a[1],a[2]/2),a[2]];var b=Math.max(a[0],Math.max(a[1],a[2]));return"rgb("+a.map(function(a){return Math.round(225*(1-b)+(30+225*b)*a)}).join(",")+")"}
function Gb(a){var b=a.O,c=b.$,d=a.h;if(d.qa){b.qa||(b.qa=!0,b.resize(a),oi(a));d.ab=[];var e=b.vf||"sim:close !stretch sim:restart sim:pause !space sim:speedup sim:noise !stretch sim:pen sim:clear !space sim:map-kind sim:map !stretch sim:vpl sim:text !stretch sim:teacher-reset sim:teacher".split(" "),f=nc(a,e,["sim","top"]),g=oc(f),h=Kc(d);Jc(d);var m=F(d.ea,{tag:"view",da:["sim"]}),l=F(d.ea,{tag:"button",da:["sim","event"]}),r=F(d.ea,{tag:"sim-controller"}),n=F(d.ea,{tag:"separator",id:"sim-controller-separator"}),
k=F(d.ea,{tag:"separator",da:["sim","top"]}),q=F(d.ea,{tag:"toolbar",da:["sim","top"]}),p=F(d.ea,{tag:"sim-playground-area"}),u=F(d.ea,{tag:"sim-playground"});m.cc(h.width);m.Rb(h.height);m.setPosition(0,0);var t=Math.max(l.width,l.height);r.width=3*E(l);r.Rb(m.height);r.setPosition(m.x+m.width-E(r),m.y);q.cc(m.width-E(r));q.height=g;q.setPosition(m.x,m.y);p.cc(m.width-E(r));p.Rb(m.height-q.va());p.setPosition(m.x,m.y+q.va());ac(d,function(a){m.J(a)});g=new Xb(d);lc(g,a,e,["sim","top"],b.fc||dc,b.pe||
ic);Zb(g,q,f,k);$b(g,q,f);ac(d,function(a){r.J(a)});e=[];f=r.y+l.offsetTop();e.push(cc(d,r.x+E(l)+l.offsetLeft(),f,l,function(a,c,e){(b.fc||dc)("sim-event:forward",a,d.A,d.ea,["sim","event"],!0,!1,e)},function(){c.set("button.forward",!0);c.sendEvent("buttons",null);c.set("button.forward",!1);c.sendEvent("buttons",null)},null,null,"button.forward"));f+=l.va();e.push(cc(d,r.x+l.offsetLeft(),f,l,function(a,c,e){(b.fc||dc)("sim-event:left",a,d.A,d.ea,["sim","event"],!0,!1,e)},function(){c.set("button.left",
!0);c.sendEvent("buttons",null);c.set("button.left",!1);c.sendEvent("buttons",null)},null,null,"button.left"));e.push(cc(d,r.x+E(l)+l.offsetLeft(),f,l,function(a,c,e){(b.fc||dc)("sim-event:center",a,d.A,d.ea,["sim","event"],!0,!1,e)},function(){c.set("button.center",!0);c.sendEvent("buttons",null);c.set("button.center",!1);c.sendEvent("buttons",null)},null,null,"button.center"));e.push(cc(d,r.x+2*E(l)+l.offsetLeft(),f,l,function(a,c,e){(b.fc||dc)("sim-event:right",a,d.A,d.ea,["sim","event"],!0,!1,
e)},function(){c.set("button.right",!0);c.sendEvent("buttons",null);c.set("button.right",!1);c.sendEvent("buttons",null)},null,null,"button.right"));f+=l.va();e.push(cc(d,r.x+E(l)+l.offsetLeft(),f,l,function(a,c,e){(b.fc||dc)("sim-event:backward",a,d.A,d.ea,["sim","event"],!0,!1,e)},function(){c.set("button.backward",!0);c.sendEvent("buttons",null);c.set("button.backward",!1);c.sendEvent("buttons",null)},null,null,"button.backward"));f+=l.va()+n.va();e.push(cc(d,r.x+.5*E(l)+l.offsetLeft(),f,l,function(a,
c,e){(b.fc||dc)("sim-event:tap",a,d.A,d.ea,["sim","event"],!0,!1,e)},function(){c.sendEvent("tap",null)},null,null,"tap"));e.push(cc(d,r.x+1.5*E(l)+l.offsetLeft(),f,l,function(a,c,e){(b.fc||dc)("sim-event:clap",a,d.A,d.ea,["sim","event"],!0,!1,e)},function(){c.sendEvent("mic",null)},null,null,"clap"));f+=2*t;var B=r.x+1.5*E(l),A=f+3.5*t;e.push(ac(d,function(a){function b(b,c,d,e,f,g){a.save();a.translate(b,c);a.beginPath();a.arc(0,0,d,0,2*Math.PI);a.arc(0,0,d/2,2*Math.PI,0,!0);a.fillStyle=f||"#bbb";
a.fill();a.beginPath();a.arc(0,0,d,(-.5+2*e)*Math.PI,-.5*Math.PI,!0);a.arc(0,0,d/2,-.5*Math.PI,(-.5+2*e)*Math.PI,!1);a.fillStyle=g||"#222";a.fill();a.restore()}a.save();a.beginPath();a.moveTo(B-1.2*t,A);a.lineTo(B-1.2*t,A-1.8*t);a.bezierCurveTo(B-.72*t,A-2.4*t,B-.05*t,A-2.4*t,B,A-2.4*t);a.bezierCurveTo(B+.05*t,A-2.4*t,B+.72*t,A-2.4*t,B+1.2*t,A-1.8*t);a.lineTo(B+1.2*t,A);a.closePath();a.lineWidth=2;a.strokeStyle="black";a.stroke();var d=c.get("prox.ground.delta");b(B-.45*t,A-1.8*t,.4*t,d[0],"#afa",
"#060");b(B+.45*t,A-1.8*t,.4*t,d[1],"#9f9","#060");d=c.get("prox.horizontal");b(B-1.45*t,A-2.3*t,.4*t,d[0],"#fcc","#d00");b(B-.8*t,A-2.8*t,.4*t,d[1],"#fcc","#d00");b(B,A-3*t,.4*t,d[2],"#fcc","#d00");b(B+.8*t,A-2.8*t,.4*t,d[3],"#fcc","#d00");b(B+1.45*t,A-2.3*t,.4*t,d[4],"#fcc","#d00");b(B-.8*t,A+.5*t,.4*t,d[5],"#fcc","#d00");b(B+.8*t,A+.5*t,.4*t,d[6],"#fcc","#d00");a.restore()}));var J=f+=5*t;e.push(ac(d,function(a){a.save();a.fillStyle="black";a.fillRect(B-1.15*t,J+.5*t,.3*t,.6*t);a.fillRect(B+.85*
t,J+.5*t,.3*t,.6*t);a.fillStyle=si(c.get("leds.top"));a.fillRect(B-1.2*t,J,2.4*t,.5*t);a.fillStyle=si(c.get("leds.bottom.left"));a.fillRect(B-1.2*t,J+.5*t,1.2*t,.5*t);a.fillStyle=si(c.get("leds.bottom.right"));a.fillRect(B,J+.5*t,1.2*t,.5*t);a.lineWidth=1;a.beginPath();a.moveTo(B-1.2*t,J+.5*t);a.lineTo(B+1.2*t,J+.5*t);a.moveTo(B,J+.5*t);a.lineTo(B,J+t);a.strokeStyle="white";a.stroke();a.lineJoin="round";a.strokeStyle="black";a.strokeRect(B-1.2*t,J,2.4*t,t);a.restore()}));f+=1.5*t;if(null!=b.Ib){var D=
f+1.5*t;e.push(ac(d,function(a){var b=c.get("acc");b=[Math.atan2(b[0],b[1]),Math.atan2(b[1],b[2]),Math.atan2(b[0],b[2])];a.save();a.strokeStyle="black";a.lineWidth=.7*d.A.pa;for(var e=0;3>e;e++){a.save();a.translate(B+(e-1)*t,D);a.save();a.strokeStyle="silver";a.beginPath();a.moveTo(-.4*t,0);a.lineTo(.4*t,0);a.moveTo(0,-.4*t);a.lineTo(0,.4*t);a.stroke();a.restore();a.rotate(-b[e]);switch(e){case 0:var f=.25*t;a.translate(0,1.2*f);a.beginPath();a.moveTo(-1.2*f,0);a.lineTo(-1.2*f,-1.8*f);a.bezierCurveTo(-.72*
f,-2.4*f,-.05*f,-2.4*f,0,-2.4*f);a.bezierCurveTo(.05*f,-2.4*f,.72*f,-2.4*f,1.2*f,-1.8*f);a.lineTo(1.2*f,0);a.closePath();a.lineWidth=2;a.strokeStyle="black";a.stroke();break;case 1:a.strokeRect(-.4*t,-.15*t,.8*t,.3*t);a.beginPath();a.arc(-.2*t,.05*t,.15*t,0,2*Math.PI);a.fillStyle="white";a.fill();a.lineWidth=.07*t;a.stroke();break;case 2:a.strokeRect(-.4*t,-.15*t,.8*t,.3*t),a.fillStyle="black",a.fillRect(-.35*t,.15*t,.15*t,.08*t),a.fillRect(.2*t,.15*t,.15*t,.08*t)}a.restore()}a.restore()}));f+=2.5*
t}if(c.Dc){var fb=f+2*t;e.push(ac(d,function(a){for(var b=c.get("leds.circle"),e=0;8>e;e++)Nd(a,B,fb,.9*t,1.2*t,Math.PI*(.44-.25*e),Math.PI*(.56-.25*e),b[e]?"#fa0":"white","black",d.A.pa)}));f+=3.5*t}var gb=f+1.5*t,ta=c.getTimer(0);0<=ta?(e.push(ac(d,function(a){d.state.Zd?"lin"===d.state.Zd&&4<ta&&(d.state.Zd="log"):d.state.Zd=4<ta?"log":"lin";Ld(a,B,gb,t,d.A.pa,function(b){a.textAlign="start";a.textBaseline="top";a.font=(t/2).toFixed(1)+"px sans-serif";a.fillStyle="black";a.fillText(b.toFixed(1),
r.x,gb-t)},Math.min(ta,"log"===d.state.Zd?9.9:3.95),!1,"log"===d.state.Zd)})),f+=2.5*t):d.state.Zd=!1;var qa=Math.min((p.y-r.y+r.y+r.height-f)/2,r.y+r.height-f);0<qa&&e.forEach(function(a){a.y+=qa});var Ka=p.x,La=p.y,N=p.width,T=p.height;var W=Math.min(N/b.b.width,T/b.b.height);l=(N-b.b.width*W)/2;n=(T-b.b.height*W)/2;u.width=b.b.width*W;u.height=b.b.height*W;u.x=Ka+l;u.y=La+n;if(a.Ba.Ua){var Ac=F(d.ea,{tag:"widget",id:"vpl-customize"});ac(d,function(){Ec(d,"vpl:customize",Ka+N/2,La+T/2,Ac)})}else{var x=
c.Mb,ob=!1;l=new sc(null,b.b.width*W,b.b.height*W,Ka+l,La+n,function(a,e,f,g){a=a.N;a.save();p.J(a);u.J(a);switch(b.Yb){case ji:a.drawImage(b.h,e.x+f,e.y+g,e.width,e.height);break;case "height":null!=b.Ib&&a.drawImage(b.m,e.x+f,e.y+g,e.width,e.height);break;case "obstacle":a.save(),a.translate(e.x+f+e.width/2,e.y+g+e.height/2),a.scale(W,-W),b.F.J(a),a.restore()}a.translate(e.x+f+e.width/2,e.y+g+e.height/2);a.scale(W,W);a.translate(c.b[0],-c.b[1]);a.rotate(.5*Math.PI-c.h);a.beginPath();a.moveTo(0,
.2*x);a.lineTo(.5*x,.2*x);a.lineTo(.5*x,-.55*x);a.bezierCurveTo(.3*x,-.8*x,.02*x,-.8*x,0,-.8*x);a.bezierCurveTo(-.02*x,-.8*x,-.3*x,-.8*x,-.5*x,-.55*x);a.lineTo(-.5*x,.2*x);a.closePath();a.fillStyle=si(c.get("leds.top"));a.strokeStyle="black";a.lineJoin="round";a.lineWidth=2;a.moveTo(.05*x,0);a.arc(0,0,.05*x,0,2*Math.PI);a.fill();a.stroke();if(!b.Xd||b.paused)a.beginPath(),a.arc(0,0,x,0,2*Math.PI),a.strokeStyle=d.state.Xf?"navy":"#3cf",a.lineWidth=.1*x,a.stroke(),a.beginPath(),a.arc(0,-x,.15*x,0,2*
Math.PI),a.fillStyle=d.state.nf?"navy":"white",a.strokeStyle=d.state.nf?"navy":"#3cf",a.lineWidth=.06*x,a.fill(),a.stroke();a.restore()},{ga:function(a,e,f,g,h,k,l){a=(l.x-h-f/2)/W;g=(g/2-(l.y-k))/W;k=a-c.b[0];l=g-c.b[1];e=x*Math.cos(c.h);f=x*Math.sin(c.h);return(!b.Xd||b.paused)&&(k-e)*(k-e)+(l-f)*(l-f)<.1*x*x?(d.state.x=a,d.state.y=g,d.state.nf=!0,1):k*k+l*l<x*x?(b.paused?ob=!1:(c.suspend(),ob=!0),d.state.x=a,d.state.y=g,d.state.Xf=!0,0):null},Ra:function(a,e,f,g,h,k,l,m){a=(m.x-k-g/2)/W;h=(h/2-
(m.y-l))/W;switch(f){case 0:f=c.b;c.setPosition([c.b[0]+a-d.state.x,c.b[1]+h-d.state.y],c.h);bi(b,"l",[f[0],f[1],c.b[0],c.b[1]]);break;case 1:c.setPosition(c.b,c.h+(Math.atan2(h-c.b[1],a-c.b[0])-Math.atan2(d.state.y-c.b[1],d.state.x-c.b[0])))}d.state.x=a;d.state.y=h},kf:function(){d.state.Xf=!1;d.state.nf=!1;ob&&c.resume(ai())}});l.m=!1;vc(d,l)}C(d);!b.paused&&c.shouldRunContinuously()&&ci(a)}}function ci(a){a.O.P||(a.O.P=!0,window.requestAnimationFrame(function(){a.O.P=!1;Gb(a)}))}
function ai(){return.001*(new Date).getTime()}di.prototype.resize=function(a){var b=window.innerWidth,c=window.innerHeight;window.vplDisableResize&&(c=this.o.b.getBoundingClientRect(),b=c.width,c=c.height);this.o.A=this.o.A;this.o.resize(b,c);Gb(a)};function rf(a){a.b.add("sim:close",{action:function(a){Bb(a,["sim"],{ye:!0})},object:a,ba:function(a){return 1<a.za.length&&0<=a.za.indexOf("sim")}});a.b.add("sim:restart",{action:function(a){oi(a);a.O.$.reset(ai());a.O.$.start();a.O.Xd=!0;a.O.paused=!1;Gb(a)},object:a});a.b.add("sim:pause",{action:function(a){a.O.Xd&&(a.O.paused=!a.O.paused,a.O.paused?a.O.$.suspend():(a.O.$.resume(ai()),Gb(a)))},isEnabled:function(a){return a.O.Xd},Za:function(a){return a.O.paused},object:a});a.b.add("sim:speedup",
{action:function(a){var b=[.5,1,2,5,10];a.O.$.jd=b[(b.indexOf(a.O.$.jd)+1)%b.length]},Za:function(a){return 1!==a.O.$.jd},getState:function(a){return a.O.$.jd},object:a});a.b.add("sim:noise",{action:function(a){a.O.$.Fe=!a.O.$.Fe},Za:function(a){return a.O.$.Fe},object:a});a.b.add("sim:pen",{action:function(a){a.O.Ke=!a.O.Ke},Za:function(a){return a.O.Ke},object:a});a.b.add("sim:clear",{action:function(a){oi(a)},isEnabled:function(a){return a.O.ef},object:a});a.b.add("sim:map-kind",{action:function(a){switch(a.O.Yb){case ji:a.O.Yb=
"height";break;case "height":a.O.Yb="obstacle";break;case "obstacle":a.O.Yb=ji}},getState:function(a){switch(a.O.Yb){case ji:return"ground";case "height":return"height";case "obstacle":return"obstacles";default:return"ground"}},object:a});a.b.add("sim:map",{action:function(a){switch(a.O.Yb){case ji:gf(a,null==a.O.Zb?a.O.We:null);break;case "height":gf(a,null==a.O.Ib?a.O.Xe:null);break;case "obstacle":ff(a,a.O.gf?null:a.O.Ye)}},Za:function(a){switch(a.O.Yb){case ji:return null!=a.O.Zb;case "height":return null!=
a.O.Ib;case "obstacle":return a.O.gf}throw"internal";},getState:function(a){switch(a.O.Yb){case ji:return"ground";case "height":return"height";case "obstacle":return"obstacles";default:return"ground"}},object:a});a.b.add("sim:vpl",{action:function(a){a.vd?Bb(a,["vpl"],{yd:!0}):Bb(a,["vpl"],{td:"sim"})},isEnabled:function(a){return null==a.K||Ve(a.K)},object:a,ba:function(a){return(null==a.K||!a.K.ia)&&0>a.za.indexOf("vpl")}});a.b.add("sim:text",{action:function(a){a.vd?Bb(a,["src"],{yd:!0,yf:!a.K.vc}):
Bb(a,["src"],{td:"sim",yf:!a.K.vc})},object:a,ba:function(a){return 0>a.za.indexOf("src")}});a.b.add("sim:teacher-reset",{action:function(a){a.O.Wd();Gb(a)},object:a,xc:!0,ba:function(a){return a.O.Gb&&a.O.Ba.Ua}});a.b.add("sim:teacher",{action:function(a){a.O.Ba.Ua=!a.O.Ba.Ua;Gb(a)},Za:function(a){return a.O.Ba.Ua},object:a,xc:!0,ba:function(a){return a.O.Gb}})};function of(a){return new cf({nc:function(b,c){a.$a[a.Ma].xb.state.b(c)},bd:function(){try{ka("http:"!==document.location.origin.slice(0,5)?"http://127.0.0.1:3000":document.location.origin,function(){a.$a[a.Ma].xb.state=fa[0];zd(a.ja)})}catch(b){console.info(b),zd(a.ja)}},isConnected:function(){return null!=a.$a[a.Ma].xb.state},isEnabled:function(b){return"aseba"===b&&null!=a.$a[a.Ma].xb.state},Ad:"aseba",languages:["aseba","l2"],state:null})};function pf(a){var b=null;return new cf({nc:function(a,d){b.run(d)},bd:function(){try{b=new window.TDM(mf("w"),{uuid:mf("uuid")||"auto",change:function(b){a.$a[a.Ma].xb.state=b?{}:null;zd(a.ja)}})}catch(c){console.info(c),zd(a.ja)}},isConnected:function(){return null!=a.$a[a.Ma].xb.state&&b.isConnected()},isEnabled:function(c){return"aseba"===c&&null!=a.$a[a.Ma].xb.state&&b.canRun()},Ad:"aseba",languages:["aseba"],state:null})};
}).call(this);
