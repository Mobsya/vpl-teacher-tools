/* Copyright 2018-2020 ECOLE POLYTECHNIQUE FEDERALE DE LAUSANNE - author Yves Piguet */
(function(){
var v,ba,ca,da;function ea(a,b){this.name=a;this.Bd=b}var fa=[];function ha(){var a=ia;if(a)for(var b=fa.length-1;0<=b;b--)fa[b]instanceof a&&fa.splice(b,1);else fa=[]}ea.prototype.b=function(){throw"not implemented";};ea.prototype.addEventListener=function(){throw"not implemented";};function ia(a,b,c){ea.call(this,a,b);this.url=c}ia.prototype=Object.create(ea.prototype);ia.prototype.constructor=ia;function ka(a,b,c,d){var e=new XMLHttpRequest;e.timeout=200;e.onerror=function(){c(null)};c&&(e.onreadystatechange=function(){if(4===e.readyState)switch(e.status){case 200:c(e.responseText);break;default:c(null)}});e.open(a,b,!0);e.send(d)}
function la(a,b){a=a||"";ka("GET",a+"/nodes",function(c){null!==c&&(c=JSON.parse(c),0===c.length?la(a,b):(ha(),c.forEach(function(b){var c=new ia(b.name,b.aeslId,a+"/nodes/"+b.name,b.protocolVersion);ka("GET",a+"/nodes/"+b.name,function(a){c.description=a?JSON.parse(a):""});fa.push(c)}),b&&b()))})}
function ma(a,b){return"<!DOCTYPE aesl-source>\n<network>\n"+[].map(function(a){return"<event size='"+(a.size||0).toString(10)+"' name='"+a.name+"'/>\n"}).join("")+"<keywords flag='true'/>\n<node nodeId='"+(a.Bd||1).toString(10)+"' name='"+a.name+"'><![CDATA["+b+"]]\x3e</node>\n</network>\n"}ia.prototype.b=function(a){a=ma(this,a);ka("PUT",this.url,void 0,a)};
ia.prototype.addEventListener=function(a,b){a=a.toString();var c=this.url+"/events";a&&(c+="/"+a);c=new EventSource(c);c.onmessage=function(c){b(c.data.split(" ").slice(1).map(function(a){return parseInt(a,10)}),a)};return c};function x(a){this.name=a.name;this.type=a.type;this.oa=a.oa||["b","a"];this.$f=a.$f||!1;this.ha=a.ha||null;this.ub=a.ub||null;this.Fe=a.Fe||null;this.Wd=a.Wd||null;this.kc=a.kc||null;this.Eb=a.Eb||{aseba:"e"===this.type?function(a){return{vd:"# onevent "+a.S.name+"\n"}}:function(a){return{$:"# "+a.S.name+"\n"}}};this.G=a.G||function(a,c){a.text(c.S.name)};this.Z=a.Z||null;this.Oa=a.Oa||null;this.yc=a.yc||null}
function na(a,b,c,d){for(var e=null;;){var f=/`([^`]*)`/.exec(a);if(null==f)break;e=(new Function("$","i","rgb","toFixed","return "+f[1]+";"))(b.h,c,function(a){a=[a[0],Math.max(.2+.8*a[1],a[2]/2),a[2]];var b=Math.max(a[0],Math.max(a[1],a[2]));return a.map(function(a){return.88*(1-b)+(.12+.88*b)*a})},function(a,b){return parseFloat(a.toFixed(void 0===b?2:b)).toString()});a=a.slice(0,f.index)+e+a.slice(f.index+f[0].length)}return d?e:a};function z(a,b,c){this.S=a;this.yb=b;this.Yd=c;this.locked=this.disabled=!1;this.h=a.ha?a.ha():null;this.Ud=this.b=null}z.prototype.kb=function(a,b,c){a=new z(this.S,a,b);a.disabled=this.disabled;a.b=c;this.h&&(a.h=this.h.slice());return a};function B(a){a.b&&a.b()}z.prototype.g=function(a){return this.disabled?{}:this.S.Eb[a]?this.S.Eb[a](this):oa[a].l(this)};function pa(a,b,c){z.call(this,ra[a],b,c)}pa.prototype=Object.create(z.prototype);pa.prototype.constructor=pa;var ra={e:new x({name:"empty e",type:"e",G:function(a,b,c){var d=ta("!empty event");d&&d.G(a,b,c)}}),a:new x({name:"empty a",type:"a",G:function(a,b,c){var d=ta("!empty action");d&&d.G(a,b,c)}}),s:new x({name:"empty s",type:"s",G:function(a,b,c){var d=ta("!empty state")||ta("!empty event");d&&d.G(a,b,c)}})};pa.prototype.g=function(){return{}};function ua(){this.R=[];this.actions=[];this.error=null;this.locked=this.disabled=!1}ua.prototype.kb=function(){for(var a=new ua,b=0;b<this.R.length;b++)va(a,this.R[b],null,null);for(b=0;b<this.actions.length;b++)va(a,this.actions[b],null,null);return a};ua.prototype.Kb=function(){return 0===this.R.length&&0===this.actions.length};function wa(a){for(var b=0;b<a.R.length;b++)if("init"===a.R[b].S.name)return a.R[b];return null}
function va(a,b,c,d,e){if(b){switch(b.S.type){case "e":case "s":if(b.yb===a)c&&(a.R.splice(b.Yd.index,1),e?b.b=d:b=b.kb(a,c,d),a.R.splice(c.index,0,b));else if(c){if(a.R[c.index]===b)return;e?b.b=d:b=b.kb(a,c,d);a.R[c.index]=b}else e?b.b=d:b=b.kb(a,{Oc:!0,index:a.R.length},d),a.R.push(b);break;case "a":case "c":if(b.yb===a)c&&(xa(a,b.Yd),e?b.b=d:b=b.kb(a,c,d),(c.Oc?a.R:a.actions).splice(c.index,0,b));else if(c){if((c.Oc?a.R:a.actions)[c.index]===b)return;e?b.b=d:b=b.kb(a,c,d);(c.Oc?a.R:a.actions)[c.index]=
b}else e?b.b=d:b=b.kb(a,{Oc:!1,index:a.actions.length},d),a.actions.push(b)}ya(a)}}function xa(a,b){b.Oc?a.R[b.index]&&a.R.splice(b.index,1):a.actions[b.index]&&a.actions.splice(b.index,1)}function ya(a){a.R.forEach(function(a,c){a.yb=this;a.Yd={Oc:!0,index:c}},a);a.actions.forEach(function(a,c){a.yb=this;a.Yd={Oc:!1,index:c}},a)}
function za(a,b){function c(a,b){if(a.disabled)return b.disabled?0:1;if(b.disabled)return-1;a=a.S.name;b=b.S.name;return a>b?1:a<b?-1:0}function d(a,b){if(null===a.h&&null===b.h)return!0;if(null===a.h||null===b.h||a.h.length!==b.h.length)return!1;for(var c=0;c<a.h.length;c++)if(a.h[c]!==b.h[c])return!1;return!0}function e(a){for(var b=0;b<a.R.length;b++)if(!a.R[b].disabled)return!1;return!0}if(!(a.disabled||b.disabled||e(a)||e(b)||0===a.R.length||b.R.length!==a.R.length)){for(var f=a.R.slice(0,1).concat(a.R.slice(1).sort(c)),
g=b.R.slice(0,1).concat(b.R.slice(1).sort(c)),h=0;h<f.length&&!f[h].disabled&&!g[h].disabled;h++)if(f[h].S!==g[h].S||!d(f[h],g[h]))return;if(null==a.error||a.error.Fb)f=new Ba("Rules with same events"),Ca(f,b),a.error=f;if(null==b.error||b.error.Fb)f=new Ba("Rules with same events"),Ca(f,a),b.error=f}};function Da(){this.b=[];this.Ra=!1}function Fa(a,b){a.b=b.slice()}Da.prototype.toggle=function(a){var b=this.b.indexOf(a);0<=b?this.b.splice(b,1):this.b.push(a)};function Ga(){this.b={};this.language="en"}function Ha(a,b,c){a.b[b]||(a.b[b]={});a=a.b[b];for(var d in c)c.hasOwnProperty(d)&&(a[d]=c[d])}Ga.prototype.translate=function(a){var b=this.b[this.language];return b&&b[a]||a};function Ia(a){this.filename=null;this.readOnly=!1;this.mode="b";this.ga=!1;this.Hb=!0;this.Uf=!1;this.i=[];this.uc=!1;this.qf=!0;this.w=this.o=this.la=null;this.Hc=new Ja;this.code={};this.Ab="aseba";this.message=null;this.qc=Ka;this.g=La;this.oc=Ma;this.b=Na;this.wa=a||new Da;this.l=null}var oa={},Ka=[],La=!1,Na=!0,Ma=[];function Oa(){Ka=Pa("b").map(function(a){return a.name});Ma=Pa("a").map(function(a){return a.name})}
function Qa(a){var b=Ra.map(function(a){return a.name});switch(a){case "b":Ka=b;break;case "a":Ma=b}}v=Ia.prototype;v.Zd=function(){this.wa.b=[]};function Sa(a,b){b?(b=a.Hc,b.Wb=[],b.Vc=[]):a.zb();a.mode="b";a.qc=Ka;a.g=La;a.oc=Ma;a.b=Na;a.i=[];a.code={};a.qf=!0}v.Kb=function(){for(var a=0;a<this.i.length;a++)if(!this.i[a].Kb())return!1;return!0};v.getError=function(){for(var a=0;a<this.i.length;a++)if(null!==this.i[a].error)return this.i[a].error;return null};
function Ta(a){if("b"===a.mode?a.g:a.b)return!1;for(var b=0;b<a.i.length;b++)if(1<a.i[b].R.length||0<a.i[b].R.length&&"s"===a.i[b].R[0].S.type)return!1;return!0}v.zb=function(){this.Hc.zb(Va(this),this.uc);this.code={};this.uc=!1};v.Af=function(a){if(0<this.Hc.Wb.length){var b=this.Hc.Af(Va(this),this.uc);Wa(this,b.state,a);this.uc=b.b;this.code={}}};v.tf=function(a){if(0<this.Hc.Vc.length){var b=this.Hc.tf(Va(this),this.uc);Wa(this,b.state,a);this.uc=b.b;this.code={}}};
function Xa(a,b){b!==a.mode&&(a.zb(),a.mode=b,a.i.forEach(function(a){a.R.forEach(function(b,c){a.R[c]=b});a.actions.forEach(function(b,c){a.actions[c]=b})}))}function Ya(a){var b="teacher"===$a("role");a.Hb=b}
function Va(a,b){var c={};b&&!1===b.Rc||(c.advanced="a"===a.mode,c.basicBlocks=a.qc,c.basicMultiEvent=a.g,c.advancedBlocks=a.oc,c.advancedMultiEvent=a.b,c.disabledUI=a.wa.b);if(b&&!1===b.Uc)return c;b=a.o?a.o():null;var d=null;null==b&&(d=a.i.map(function(a){function b(a){a&&c.push({name:a.S.name,disabled:a.disabled,locked:a.locked,param:a.S.Fe?a.S.Fe(a):a.h?a.h.slice():null})}var c=[];a.R.forEach(function(a){b(a)});a.actions.forEach(function(a){b(a)});return{blocks:c,disabled:a.disabled,locked:a.locked}}));
c.program=d;c.code=b;return c}function ab(a,b){return JSON.stringify(Va(a,b),null,"\t")}
function Wa(a,b,c,d){var e=!1,f="vpl";try{if(b&&(!b.disabledUI||d&&d.Vg||Fa(a.wa,b.disabledUI),d&&d.Ug||(a.mode=b.advanced?"a":"b",a.qc=b.basicBlocks||Ka,a.g=void 0!==b.basicMultiEvent?b.basicMultiEvent:La,a.oc=b.advancedBlocks||Ma,a.b=void 0!==b.advancedMultiEvent?b.advancedMultiEvent:Na),!d||!d.Qf)&&(b.program?a.i=b.program.map(function(b){var d=new ua;b.blocks.forEach(function(b){var f=ta(b.name);if(f){var g=new z(f,null,null);g.disabled=b.disabled||!1;g.locked=b.locked||!1;f.Wd?f.Wd(g,b.param,
function(){e&&c&&c("vpl")}):g.h=b.param;va(d,g,null,function(){a.zb()},!0)}},this);d.disabled=b.disabled||!1;d.locked=b.locked||!1;return d},a):a.i=[],a.w)){var g=b.code;a.w(void 0==b.code?null:g);null!=g&&(f="src")}}catch(h){}a.ga="src"===f;c&&c(f);e=!0}function bb(a,b,c,d){try{var e=JSON.parse(b);Wa(a,e,c,d);var f=a.Hc;f.Wb=[];f.Vc=[]}catch(g){}}v.Rb=function(a){"string"!==typeof this.code[a]&&(this.code[a]=oa[a].g(this));return this.code[a]};
function cb(a,b){var c=oa[a];a=db(c,b,!0);b=db(c,b,!1);return 0<=a&&0<=b?{vd:a,end:b}:null}function eb(a,b){a.l=b}v.log=function(a){this.l&&this.l(a)};function fb(a,b,c){this.language=a;this.o=b;this.w=c;this.b=[]}function gb(a,b,c){this.id=a;this.l=b;this.g=c;if(0>a||6399<a)throw"internal";this.A=String.fromCharCode(57344+a);this.b=-1}
function hb(a,b){a.forEach(function(a){a.b=b.indexOf(a.A)});a.sort(function(a,b){return a.b-b.b});for(var c=0;c<a.length;c++)a[c].b-=c,b=b.replace(a[c].A,"");a.forEach(function(a){var c;if(a.g){for(;;){for(c=a.b;" "===b[c]||"\t"===b[c];c++);if("\n"===b[c])a.b=c+1;else break}if(" "===b[a.b-1]||"\t"===b[a.b-1]){for(c=a.b-1;" "===b[c]||"\t"===b[c];c--);"\n"===b[c]&&(a.b=c+1)}}else if(" "===b[a.b-1]||"\t"===b[a.b-1]){for(c=a.b-1;" "===b[c]||"\t"===b[c];c--);"\n"===b[c]&&(a.b=c+1)}});return b}
function ib(a){return a.replace(/[\ue000-\uf8ff]/g,"")}function jb(a,b,c){var d=a.b.length,e=new gb(d,c,!0);a.b.push(e);c=new gb(d+1,c,!1);a.b.push(c);return e.A+b+c.A}function db(a,b,c){for(var d=0;d<a.b.length;d++)if(a.b[d].l===b&&a.b[d].g===c)return a.b[d].b;return-1}
function kb(a,b){if(b.disabled||b.Kb())return{};b.error=null;for(var c=!1,d=!1,e=0;e<b.R.length;e++)if(!b.R[e].disabled)if("e"===b.R[e].S.type){if(c=!0,b.R[e].S.kc){var f=b.R[e].S.kc(b.R[e]);if(f&&(lb(f,[e]),!f.Fb||!b.error)&&(b.error=f,!f.Fb))return{error:f}}}else"s"===b.R[e].S.type&&(d=!0);f=!1;for(e=0;e<b.actions.length;e++)if(!b.actions[e].disabled&&"a"===b.actions[e].S.type){f=!0;break}if(!c&&!f)return b.error?{error:b.error}:{};if(!c&&!d)return f=new Ba("Missing event block"),lb(f,[]),b.error=
f,{error:f};if(!f)return f=new Ba("Missing action block"),f.b.push(0),b.error=f,{error:f};if(!b.error)for(e=0;e<b.actions.length;e++)for(c=e+1;c<b.actions.length;c++)"a"===b.actions[c].S.type&&b.actions[c].S===b.actions[e].S&&(f=new Ba("Duplicate action blocks",!0),f.b.push(e),f.b.push(c),b.error=f);var g=[],h=[],l=[],m="",r=[],k="",q=[],n="";b.R.forEach(function(a,b){var c=a.g(this.language);c.Va&&(0===b&&c.X?(m=jb(this,c.Va,a),c.da&&(k+=c.da)):(r.push(jb(this,c.Va,a)),c.da&&(q=q.concat(c.da))));
c.Pb&&(g=g.concat(c.Pb));c.Sb&&(h=h.concat(c.Sb));c.Ob&&(l=l.concat(c.Ob));c.$&&(n+=jb(this,c.$,a))},a);for(e=0;e<b.actions.length;e++)c=b.actions[e].g(a.language),n+=c.$?jb(a,c.$,b.actions[e]):"",c.Pb&&c.Pb.forEach(function(a){0>g.indexOf(a)&&g.push(a)}),c.Sb&&c.Sb.forEach(function(a){0>h.indexOf(a)&&h.push(a)}),c.Ob&&c.Ob.forEach(function(a){0>l.indexOf(a)&&l.push(a)});return 0<n.length?(e="e"===b.R[0].S.type?b.R[0].g(a.language):null,c=b.R.slice(1).filter(function(a){return"e"===a.S.type}).map(function(a){return a.g(this.language)},
a),{Yg:b.R[0]?b.R[0].S.name:"",Pb:g,Sb:h,Ob:l,X:e?e.X:"",qb:e?e.qb:"",hb:e?e.hb:"",Nd:c.map(function(a){return a.X||""}),Ve:c.map(function(a){return a.qb||""}),We:c.map(function(a){return a.hb||""}),da:k,Md:q,Va:m,Zb:r.join(" "+a.o+" "),$:(e&&e.$||"")+n}):{}}fb.prototype.g=function(){throw"internal";};fb.prototype.l=function(){throw"internal";};function nb(){fb.call(this,"aseba","and","1 == 1")}nb.prototype=Object.create(fb.prototype);nb.prototype.constructor=nb;
nb.prototype.g=function(a,b){this.b=[];var c=a.i.map(function(a){return kb(this,a)},this),d={},e=[];c.forEach(function(a){a.X&&(d[a.X]={X:a.X,qb:a.qb,hb:a.hb,da:"",$a:""},0>e.indexOf(a.X)&&e.push(a.X));a.Nd&&a.Nd.forEach(function(b,c){d[b]={X:b,qb:a.Ve[c],hb:a.We[c],da:"",$a:""};0>e.indexOf(b)&&e.push(b)})});var f=[],g=[],h=[],l=[];c.forEach(function(b,c){b.Pb&&b.Pb.forEach(function(a){0>f.indexOf(a)&&f.push(a)});b.Sb&&b.Sb.forEach(function(a){0>g.indexOf(a)&&g.push(a)});b.Ob&&b.Ob.forEach(function(a){0>
h.indexOf(a)&&h.push(a)});if(b.X&&(b.nb=l.indexOf(ib(b.Va||b.X)),0>b.nb)){b.nb=l.length;l.push(ib(b.Va||b.X));var e=d[b.X];b.da&&0>e.da.indexOf(b.da)&&(e.da+=b.da);e.$a+=b.Va?"when "+b.Va+" do\neventCache["+b.nb+"] = 1\nend\n":"eventCache["+b.nb+"] = 1\n"}b.X||(b.$=jb(this,b.$||"",a.i[c]))},this);var m="";if(b){var r=new ua,k=new z(ta("init"),null,null);va(r,k,null,null);b.forEach(function(a){va(r,a,null,null)});k=kb(this,r);var q=!0;k.Pb.forEach(function(a){0>f.indexOf(a)&&(q=!1)});k.Ob.forEach(function(a){0>
h.indexOf(a)&&(q=!1)});q?m=k.$:k.Kg&&(m=k.Kg)}var n=[],p="",u="",y=0;for(k=0;k<a.i.length;k++)0<=c[k].nb?(c[k].Md&&c[k].Md.forEach(function(a){0>n.indexOf(a)&&n.push(a)}),p+="if eventCache["+c[k].nb+"] != 0"+(c[k].Zb?" and "+c[k].Zb:"")+" then\ntodo["+y+"] = 1\nend\n",u+="if todo["+y+"] != 0 then\n"+c[k].$+"end\n",y++):c[k].Zb&&(p+="when "+c[k].Zb+" do\ntodo["+y+"] = 1\nend\n",u+="if todo["+y+"] != 0 then\n"+c[k].$+"end\n",y++);c=0<f.length?"\n"+f.join("\n"):"";0<l.length&&(c+="var eventCache[] = ["+
l.map(function(){return"0"}).join(", ")+"]\n");if(0<y){c+="var todo[] = [";for(k=0;k<y;k++)c+=0<k?", 0":"0";c+="]\n"}b?c+="\n"+m:(0<g.length&&(c+="\n"+g.join("\n")),p&&(c+=(0<c.length?"\n":"")+"timer.period[1] = 50\n"));for(k=0;k<e.length;k++)!/onevent/.test(d[e[k]].X)&&(d[e[k]].hb||d[e[k]].da||d[e[k]].$a)&&(c+="\n"+(d[e[k]].X||"")+(d[e[k]].hb||"")+(d[e[k]].da||"")+(d[e[k]].$a||"")+(d[e[k]].qb||""));0<h.length&&(c+="\n"+h.join("\n"));for(k=0;k<e.length;k++)/onevent/.test(d[e[k]].X)&&(d[e[k]].hb||
d[e[k]].da||d[e[k]].$a)&&(c+="\n"+(d[e[k]].X||"")+(d[e[k]].hb||"")+(d[e[k]].da||"")+(d[e[k]].$a||"")+(d[e[k]].qb||""));if(p){c+="\nonevent timer1\n"+n.join("")+p+u;for(k=0;k<l.length;k++)c+="eventCache["+k+"] = 0\n";for(k=0;k<y;k++)c+="todo["+k+"] = 0\n"}"\n"===c[0]&&(c=c.slice(1));var I=0;b=c.split("\n").map(function(a){return a.trim()}).map(function(a){function b(b){for(var c=ib(a),d=0;d<b.length;d++)if(c.slice(0,b[d].length)===b[d]&&!/^\w/.test(c.slice(b[d].length)))return!0;return!1}if(0<a.length){var c=
b("if else elseif for onevent sub when while".split(" "));b(["else","elseif","end","onevent","sub"])&&(I=Math.max(I-1,0));a="\t\t\t\t\t".slice(0,I)+a;c&&I++}return a});for(k=b.length-2;0<=k;k--)/^\s*#/.test(b[k])&&(m=b[k+1].replace(/^(\s*).*$/,"$1"),b[k]=m+b[k].replace(/^\s*/,""));c=b.join("\n");for(k=0;k<a.i.length;k++)for(b=k+1;b<a.i.length;b++)za(a.i[k],a.i[b]);return c=hb(this.b,c)};
nb.prototype.l=function(a){var b="# missing Aseba implementation for block "+a.S.name+"\n";switch(a.S.type){case "e":case "s":return{da:b,Va:"1 == 1"};case "a":return{$:b};default:return{}}};oa.aseba=new nb;function ob(){fb.call(this,"l2","&&","true")}ob.prototype=Object.create(fb.prototype);ob.prototype.constructor=ob;
ob.prototype.g=function(a,b){this.b=[];var c=a.i.map(function(a){return kb(this,a)},this),d={},e=[];c.forEach(function(a){a.X&&(d[a.X]={X:a.X,qb:a.qb,hb:a.hb,da:"",$a:""},0>e.indexOf(a.X)&&e.push(a.X));a.Nd&&a.Nd.forEach(function(b,c){d[b]={X:b,qb:a.Ve[c],hb:a.We[c],da:"",$a:""};0>e.indexOf(b)&&e.push(b)})});var f=[],g=[],h=[],l=[];c.forEach(function(b,c){b.Pb&&b.Pb.forEach(function(a){0>f.indexOf(a)&&f.push(a)});b.Sb&&b.Sb.forEach(function(a){0>g.indexOf(a)&&g.push(a)});b.Ob&&b.Ob.forEach(function(a){0>
h.indexOf(a)&&h.push(a)});if(b.X&&(b.nb=l.indexOf(ib(b.Va||b.X)),0>b.nb)){b.nb=l.length;l.push(ib(b.Va||b.X));var e=d[b.X];b.da&&0>e.da.indexOf(b.da)&&(e.da+=b.da);e.$a+=b.Va?"when ("+b.Va+") {\neventCache["+b.nb+"] = true;\n}\n":"eventCache["+b.nb+"] = true;\n"}b.X||(b.$=jb(this,b.$||"",a.i[c]))},this);var m="";if(b){var r=new ua,k=new z(ta("init"),null,null);va(r,k,null,null);b.forEach(function(a){va(r,a,null,null)});m=kb(this,r).$}var q=[],n="",p="",u=0;for(k=0;k<a.i.length;k++)0<=c[k].nb?(c[k].Md&&
c[k].Md.forEach(function(a){0>q.indexOf(a)&&q.push(a)}),n+="if (eventCache["+c[k].nb+"]"+(c[k].Zb?" && "+c[k].Zb:"")+") {\ntodo["+u+"] = true;\n}\n",p+="if (todo["+u+"]) {\n"+c[k].$+"}\n",u++):c[k].Zb&&(n+="when ("+c[k].Zb+") {\ntodo["+u+"] = true;\n}\n",p+="if (todo["+u+"]) {\n"+c[k].$+"}\n",u++);c=0<f.length?"\n"+f.join("\n"):"";0<l.length&&(c+="bool eventCache["+l.length+"] = false;\n");b?c+="\n"+m:(k="",0<g.length&&(k+="\n"+g.join("\n")),k&&(c+=(0<c.length?"\n":"")+k.slice(1)),n&&(c+=(0<c.length?
"\n":"")+"timer.period[1] = 50;\n"));for(k=0;k<e.length;k++)!/onevent/.test(d[e[k]].X)&&(d[e[k]].hb||d[e[k]].da||d[e[k]].$a)&&(c+="\n"+(d[e[k]].X||"")+(d[e[k]].hb||"")+(d[e[k]].da||"")+(d[e[k]].$a||"")+(d[e[k]].qb||""));0<h.length&&(c+="\n"+h.join("\n"));for(k=0;k<e.length;k++)/onevent/.test(d[e[k]].X)&&(d[e[k]].hb||d[e[k]].da||d[e[k]].$a)&&(c+="\n"+(d[e[k]].X||"")+(d[e[k]].hb||"")+(d[e[k]].da||"")+(d[e[k]].$a||"")+(d[e[k]].qb||""));n&&(c+="\nonevent timer1 {\n",0<u&&(c+="bool todo["+u+"] = false;\n"),
c+=q.join("")+n+p+"eventCache = false;\n}\n");"\n"===c[0]&&(c=c.slice(1));var y=0;b=c.split("\n").map(function(a){return a.trim()}).map(function(a){var b=ib(a);if(0<b.length){var c="{"===b.slice(-1);"}"===b[0]&&(y=Math.max(y-1,0));a="\t\t\t\t\t".slice(0,y)+a;c&&y++}return a});for(k=b.length-2;0<=k;k--)/^\s*#/.test(b[k])&&(n=b[k+1].replace(/^(\s*).*$/,"$1"),b[k]=n+b[k].replace(/^\s*/,""));c=b.join("\n");for(k=0;k<a.i.length;k++)for(b=k+1;b<a.i.length;b++)za(a.i[k],a.i[b]);return c=hb(this.b,c)};
ob.prototype.l=function(a){var b="// missing L2 implementation for block "+a.S.name+"\n";switch(a.S.type){case "e":case "s":return{da:b,Va:"true"};case "a":return{$:b};default:return{}}};oa.l2=new ob;function pb(){fb.call(this,"js","&&","true")}pb.prototype=Object.create(fb.prototype);pb.prototype.constructor=pb;
pb.prototype.g=function(a,b){this.b=[];var c=a.i.map(function(a){return kb(this,a)},this),d={},e=[];c.forEach(function(a){a.X&&(d[a.X]={X:a.X,qb:a.qb,hb:a.hb,da:"",$a:""},0>e.indexOf(a.X)&&e.push(a.X));a.Nd&&a.Nd.forEach(function(b,c){d[b]={X:b,qb:a.Ve[c],hb:a.We[c],da:"",$a:""};0>e.indexOf(b)&&e.push(b)})});var f=[],g=[],h=[],l=[],m=[],r=0;c.forEach(function(b,c){b.Pb&&b.Pb.forEach(function(a){0>f.indexOf(a)&&f.push(a)});b.Sb&&b.Sb.forEach(function(a){0>g.indexOf(a)&&g.push(a)});b.Ob&&b.Ob.forEach(function(a){0>
h.indexOf(a)&&h.push(a)});var e=b.$||"";b.Va&&(e="cond = "+b.Va+";\nif (cond && !cond0["+r+"]) {\n"+e+"}\ncond0["+r+"] = cond;\n",r++);if(b.X&&(b.nb=l.indexOf(ib(b.Va||b.X)),0>b.nb)){b.nb=l.length;l.push(ib(b.Va||b.X));var k=d[b.X];b.da&&0>k.da.indexOf(b.da)&&(k.da+=b.da);b.Va?(k.$a+="cond = "+b.Va+";\nif (cond && !cond0["+r+"]) {\neventCache["+b.nb+"] = true;\n}\ncond0["+r+"] = cond;\n",r++):k.$a+="eventCache["+b.nb+"] = true;\n"}b.X||(b.$=jb(this,e,a.i[c]));wa(a.i[c])&&m.push(c)},this);var k="";
if(b){var q=new ua,n=new z(ta("init"),null,null);va(q,n,null,null);b.forEach(function(a){va(q,a,null,null)});k=kb(this,q).$}var p=[],u="",y="",I=0;for(n=0;n<a.i.length;n++)0<=c[n].nb?(c[n].Md&&c[n].Md.forEach(function(a){0>p.indexOf(a)&&p.push(a)}),u+="if (eventCache["+c[n].nb+"]"+(c[n].Zb?" && "+c[n].Zb:"")+") {\ntodo["+I+"] = true;\n}\n",y+="if (todo["+I+"]) {\n"+c[n].$+"}\n",I++):c[n].Zb&&(u+="cond = "+c[n].Zb+";\nif (cond && !cond0["+r+"]) {\ntodo["+I+"] = true;\n}\ncond0["+r+"] = cond;\n",r++,
y+="if (todo["+I+"]) {\n"+c[n].$+"}\n",I++);0<r&&(f.unshift("var cond0;\nvar cond;\n"),g.unshift("cond0 = [];\n"));var t=0<f.length?"\n"+f.join("\n"):"";0<l.length&&(t+="var eventCache = [];\n");0<I&&(t+="var todo = [];\n");if(b)t+="\n"+k;else{b="";0<g.length&&(b+="\n"+g.join("\n"));u&&(b+="this.setTimer(1, 0.1, true);\n");for(n=0;n<a.i.length;n++)0<=m.indexOf(n)&&c[n].$&&(b+=(0<b.length?"\n":"")+(c[n].X||"")+(c[n].$||"")+(c[n].qb||""));b&&(t+=(0<t.length?"\n":"")+'this.addEventListener("init", function (name, param) {\n'+
b.slice(1)+"});\n")}if(0<h.length)throw"internal error, unsupported sub/onevent in js";for(n=0;n<e.length;n++)if(d[e[n]].hb||d[e[n]].da||d[e[n]].$a)t+="\n"+(d[e[n]].X||"")+(d[e[n]].hb||"")+(d[e[n]].da||"")+(d[e[n]].$a||"")+(d[e[n]].qb||"");if(u){t+='\nthis.addEventListener("timer1", function (name, param) {\n'+p.join("")+u+y;for(n=0;n<l.length;n++)t+="eventCache["+n+"] = false;\n";for(n=0;n<I;n++)t+="todo["+n+"] = false;\n"}t+="});";"\n"===t[0]&&(t=t.slice(1));var w=0;c=t.split("\n").map(function(a){return a.trim()}).map(function(a){var b=
ib(a);if(0<b.length){var c="{"===b.slice(-1);"}"===b[0]&&(w=Math.max(w-1,0));a="\t\t\t\t\t".slice(0,w)+a;c&&w++}return a});for(n=c.length-2;0<=n;n--)/^\s*#/.test(c[n])&&(t=c[n+1].replace(/^(\s*).*$/,"$1"),c[n]=t+c[n].replace(/^\s*/,""));t=c.join("\n");for(n=0;n<a.i.length;n++)for(c=n+1;c<a.i.length;c++)za(a.i[n],a.i[c]);return t=hb(this.b,t)};
pb.prototype.l=function(a){var b="// missing JavaScript implementation for block "+a.S.name+"\n";switch(a.S.type){case "e":case "s":return{da:b,Va:"true"};case "a":return{$:b};default:return{}}};oa.js=new pb;function qb(){fb.call(this,"python","and","True")}qb.prototype=Object.create(fb.prototype);qb.prototype.constructor=qb;
qb.prototype.g=function(a,b){this.b=[];var c=a.i.map(function(a){return kb(this,a)},this),d=[],e=[],f=[],g={},h=[],l=!1;c.forEach(function(b,m){b.Pb&&b.Pb.forEach(function(a){0>d.indexOf(a)&&d.push(a)});b.Sb&&b.Sb.forEach(function(a){0>e.indexOf(a)&&e.push(a)});b.Ob&&b.Ob.forEach(function(a){0>f.indexOf(a)&&f.push(a)});var k=b.$||"";b.Va&&(k="cond = "+b.Va+"\nif self.cond and not self.cond0["+m+"]:\n"+k+"<\nself.cond0["+m+"] = cond\n",l=!0);k=jb(this,k,a.i[m]);if(b.X)if(void 0!==g[b.X]){var n=c[g[b.X]];
b.da&&(!n.da||0>n.da.indexOf(b.da))&&(n.da=(n.da||"")+b.da);n.$+=k;b.$=void 0}else g[b.X]=m,b.$=k;else b.$=k;wa(a.i[m])&&h.push(m)},this);var m="";if(b){var r=new ua,k=new z(ta("init"),null,null);va(r,k,null,null);b.forEach(function(a){va(r,a,null,null)});m=kb(this,r).$}l&&(d.unshift("self.cond0 = {}\n"),e.unshift("self.cond0 = {}\n"));k=0<d.length?d.join("\n"):"";b&&(k+="\n"+m);k&&(k="def __init__(self):\n"+k+"<\n");if(!b){m="";0<e.length&&(m+="\n"+e.join("\n"));for(b=0;b<a.i.length;b++)0<=h.indexOf(b)&&
c[b].$&&(m+=(0<m.length?"\n":"")+(c[b].X||"")+(c[b].$||"")+(c[b].qb||""));m&&(k+=(0<k.length?"\n":"")+"def event_init(self):\n"+m.slice(1)+"<\n")}if(0<f.length)throw"internal error, unsupported sub/onevent in js";for(b=0;b<a.i.length;b++)0>h.indexOf(b)&&c[b].$&&(k+="\n",k+=(c[b].X||"")+(c[b].da||"")+(c[b].$||"")+(c[b].qb||""));"\n"===k[0]&&(k=k.slice(1));k="class Robot(RobotBase):\n"+(ib(k)?k:"pass\n")+"<\n";k=ib(k);k=k.replace(/\n[ \t]+/g,"\n").replace(/\n<\n\n<\n/g,"\n<\n<\n");var q=0,n="";k.split("\n").map(function(a){return a.trim()}).forEach(function(a){var b=
ib(a);if(0<b.length){var c=":"===b.slice(-1);"<"===b&&(q=Math.max(q-1,0));"<"!==b&&(a="\t\t\t\t\t".slice(0,q)+a,c&&q++)}"<"!==b&&(n+=a+"\n")});k=n;for(b=0;b<a.i.length;b++)for(m=b+1;m<a.i.length;m++)za(a.i[b],a.i[m]);return k=hb(this.b,k)};qb.prototype.l=function(a){var b="# missing Python implementation for block "+a.S.name+"\n";switch(a.S.type){case "e":case "s":return{da:b,Va:"True"};case "a":return{$:b};default:return{}}};oa.python=new qb;function rb(a){this.b=[];this.g=a||null}v=rb.prototype;v.add=function(a,b){this.b.push(new sb(a,b))};v.find=function(a){for(var b=0;b<this.b.length;b++)if(this.b[b].name===a)return this.b[b];return null};function tb(a,b){a=a.find(b);return null!=a&&null!=a.l}function ub(a,b){if(a.g){var c=a.find(b);b={cmd:b};c.g&&(b.selected=c.Ya());c.b&&(b.state=c.getState());a.g({type:"cmd",data:b})}}v.fb=function(a,b){this.g&&this.g({type:"drop",data:{cmd:a}});(a=this.find(a))&&a.fb(b)};
v.eb=function(a,b){a=this.find(a);return null!=a&&a.eb(b)};v.W=function(a){a=this.find(a);return null!=a&&a.W()};v.isEnabled=function(a){a=this.find(a);return null!=a&&a.isEnabled()};v.Ya=function(a){a=this.find(a);return null!=a&&a.Ya()};v.getState=function(a){a=this.find(a);return null!=a?a.getState():null};
function sb(a,b){this.name=a;this.o=b.isEnabled||null;this.g=b.Ya||null;this.b=b.getState||null;this.l=b.action||null;this.L=b.fb||null;this.w=b.eb||null;this.tc=b.object||null;this.Ec=b.Ec||!1;this.P=b.W||null}function vb(a,b){a.isEnabled()&&a.l&&a.l(a.tc,b)}function wb(a,b){if(!a.b)return!1;var c=a.getState();if(b===c)return!0;for(var d=0;100>d;d++){vb(a,void 0);var e=a.getState();if(e===b)return!0;if(e===c)break}return!1}v=sb.prototype;v.fb=function(a){this.eb(a)&&this.L&&this.L(this.tc,a)};
v.eb=function(a){return null!=this.w&&this.w(this.tc,a)};v.isEnabled=function(){return null==this.o||this.o(this.tc)};v.Ya=function(){return null!=this.g&&this.g(this.tc)};v.getState=function(){return null!=this.b?this.b(this.tc):null};v.W=function(){return null==this.P||this.P(this.tc)};function xb(){var a=document.getElementById("programCanvas");yb||(Oa(),yb=!0);this.Qa=a;this.Y=new zb;this.o=new Ga;this.wa=new Da;var b=this;this.b=new rb(function(a){b.log(a)});this.l=null;this.va="vpl:close !space vpl:about vpl:help !space vpl:new vpl:save vpl:load vpl:upload vpl:filename vpl:exportToHTML !space vpl:advanced !stretch vpl:readonly !stretch vpl:undo vpl:redo !stretch vpl:connected !stretch vpl:run vpl:stop vpl:robot !stretch vpl:sim vpl:text !stretch vpl:teacher-reset vpl:teacher-save vpl:teacher-setasnew vpl:teacher".split(" ");
this.P="!!stretch vpl:message-error vpl:message-warning !!stretch vpl:duplicate vpl:disable vpl:lock vpl:trashcan".split(" ");this.xa=["vpl"];this.Nb={vpl:1,src:1,sim:1};this.Hd=this.mf=this.Wf=this.de=this.le=null;this.hc=!1;this.username=null;this.i=new Ia(this.wa);eb(this.i,function(a){b.log(a)});this.Xb="";this.Id=!1;this.ba=new Ab(a,{Y:this.Y});this.ba.state={Og:new Bb};this.fa="";this.K=this.g=null;this.Pa=[];this.Ba=-1;this.Df=this.Ad=!1;this.L=null;this.ba.Qa=function(){b.L=null;Db(b)};this.w=
null;this.wb=[];this.se=this.jb=null}var yb=!1;xb.prototype.translate=function(a){return this.o.translate(a)};function Eb(a,b){a.de=b?new Fb(b):null}function Gb(a,b){a.mf=b?new Fb(b):null}
xb.prototype.Za=function(a,b){function c(){0<=a.indexOf("vpl")&&E(d.ba);0<=a.indexOf("src")&&E(d.H.Fa);0<=a.indexOf("sim")&&E(d.g)}var d=this;b&&(b.ga||b.Bf)&&(this.i.ga=!0,this.H.ga=!0,Hb(this.H,!1));if(1===a.length&&b&&b.yd&&1<this.xa.length){if(0<=this.xa.indexOf(a[0]))return;var e=this.xa.slice();e[this.xa[0]===b.yd?1:0]=a[0];a=e}else b&&b.Dd?0>this.xa.indexOf(a[0])&&(a=this.xa.concat(a)):1===a.length&&b&&b.Ce&&1<this.xa.length&&0<=this.xa.indexOf(a[0])?(this.xa.splice(this.xa.indexOf(a[0]),1),
a=this.xa):1===a.length&&b&&b.toggle&&(0<=this.xa.indexOf(a[0])?(this.xa.splice(this.xa.indexOf(a[0]),1),a=this.xa):a=this.xa.concat(a));this.xa=a;null!=this.K&&this.g.sc();this.ba.sc();null!=this.H&&(document.getElementById("src-editor").style.display=0<=a.indexOf("src")?"block":"none",this.H.Fa.sc());0<=a.indexOf("vpl")&&this.ba.show();0<=a.indexOf("src")&&this.H.Fa.show();null!=this.K&&0<=a.indexOf("sim")&&this.g.show();Ib(this,window.innerWidth<window.innerHeight);for(e=0;e<a.length;e++)switch(a[e]){case "vpl":this.ba.la=
function(){if(!d.i.ga){d.i.code={};var a=d.i;if(0!==a.i.length&&a.i[a.i.length-1].Kb())for(;1<a.i.length&&a.i[a.i.length-2].Kb();)a.i.splice(-2,1);else a.i.push(new ua);if(d.H){a=d.H;var b=d.i.Rb(d.i.Ab);if(a.Zc){var c=a.Td(a.language,b);null!==c&&(Jb(a,c,!0),a.Vb.tb.readOnly=!0,a.Zc=b)}else Jb(a,b)}d.log()}Db(d)};break;case "src":Hb(this.H,!(b&&(b.ga||b.Bf)));this.H.focus();this.H.resize(window.innerWidth,window.innerHeight);break;case "sim":this.g.la=function(){Kb(d)}}b&&(b.Ce||b.Dd)&&Lb(d);this.ba&&
(this.ba.lb=c);this.H&&this.H.Fa&&(this.H.Fa.lb=c);this.g&&(this.g.lb=c);0<=a.indexOf("vpl")&&(this.ba.la(),this.ba.lb?this.ba.lb():E(this.ba));0<=a.indexOf("src")&&(Mb(this),this.H.Fa.lb?this.H.Fa.lb():E(this.H.Fa));0<=a.indexOf("sim")&&(this.start(!1),this.g.la(),this.g.lb?this.g.lb():E(this.g))};xb.prototype.setView=xb.prototype.Za;
function Ib(a,b){for(var c=a.xa.map(function(a){return this.Nb[a]},a),d=c.reduce(function(a,b){return a+b},0),e=0,f=0;f<a.xa.length;f++){var g=b?{U:0,na:1,V:e,ka:e+c[f]/d}:{U:e,na:e+c[f]/d,V:0,ka:1};e+=c[f]/d;switch(a.xa[f]){case "vpl":Nb(a.ba,g);break;case "src":Nb(a.H.Fa,g);break;case "sim":Nb(a.g,g)}}}
function Lb(a){var b=a.ba.b.parentElement.getBoundingClientRect(),c=b.width;b=window.innerHeight-b.top;Ib(a,c<b);window.vplDisableResize&&(b=a.ba.b.getBoundingClientRect(),c=b.width,b=b.height);a.ba.resize(c,b);a.H&&a.H.resize(c,b);a.K&&a.g.resize(c,b);a.xa.forEach(function(a){switch(a){case "vpl":Db(this);break;case "src":E(this.H.Fa);break;case "sim":this.K&&Kb(this)}},a);a.de&&Ob(a.de)}function Pb(a){if(0<=a.Ba){var b=ta("!stop"),c=a.i.Ab;(b=b&&b.Eb[c])&&a.Pa[a.Ba].ab.Qb(b(null).$,c)}}
function Qb(a){return!a.i.ga&&a.Pa[a.Ba].ab.isEnabled(a.i.Ab)}function Sb(a,b){a.wb.push(b)}xb.prototype.log=function(a){if(null==a){Tb(this);a={type:"vpl-changed",data:{nrules:this.i.i.reduce(function(a,b){return 0<b.R.length+b.actions.length?a+1:a},0),nblocks:this.i.i.reduce(function(a,b){return a+b.R.length+b.actions.length},0),error:this.Xb&&!this.Id?this.Xb:null,warning:this.Xb&&this.Id?this.Xb:null}};var b=JSON.stringify(a);if(b===this.jb)return;this.jb=b}this.wb.forEach(function(b){try{b(a)}catch(d){}})};function Ub(a){function b(b){function d(b){for(var c=0;c<I.length;c++)if(I[c].uri&&a.sb[t].kf(b,Vb(I[c].uri).id))return!0;return!1}var e=b.name;if("!"===e[0])return 0;var h=0;/^\w/.test(e)||(c+='Bad block name "'+e+'"\n',h++);var l=b.defaultParameters,m=b.typicalParameters,r=b.buttons,k=b.radiobuttons,q=b.sliders,n=b.rotating,p=b.diffwheelmotion,u=b.score,y=b.otherParameters?parseInt(b.otherParameters,10):0,I=b.draw;if(I){var t=null;for(b=0;b<I.length;b++)if(I[b].uri)if(null==t){t=Vb(I[b].uri).Pc;
var w=a.sb[t]}else{var A=Vb(I[b].uri);A.Pc!==t?(c+='In block "'+e+'", multiple svg\n',h++):w.dc(A.id)||(c+='In block "'+e+'", uri "'+I[b].uri+'" not found\n',h++)}}r&&r.forEach(function(a){w.dc(a.id)?d(a.id)||(c+='In block "'+e+'", button id "'+a.id+'" not displayed\n',h++):(c+='In block "'+e+'", button id "'+a.id+'" not found\n',h++);void 0==a.val?(c+='In block "'+e+'", missing property "val"\n',h++):void 0==a.st?(c+='In block "'+e+'", missing property "st"\n',h++):a.val.length!==a.st.length&&(c+=
'In block "'+e+'", properties "val" and "st" have different lengths\n',h++)});k&&k.forEach(function(a){w.dc(a.id)?d(a.id)?void 0==a.val?(c+='In block "'+e+'", missing property "val"\n',h++):a.val instanceof Array?(c+='In block "'+e+'", illegal array in property "val"\n',h++):void 0==a.st?(c+='In block "'+e+'", missing property "st"\n',h++):2!==a.st.length&&(c+='In block "'+e+'", property "st" must have length 2\n',h++):(c+='In block "'+e+'", radiobutton id "'+a.id+'" not displayed\n',h++):(c+='In block "'+
e+'", radiobutton id "'+a.id+'" not found\n',h++)});q&&q.forEach(function(a){w.dc(a.id)?d(a.id)||(c+='In block "'+e+'", slider id "'+a.id+'" not displayed\n',h++):(c+='In block "'+e+'", slider id "'+a.id+'" not found\n',h++);w.dc(a.thumbId)?d(a.thumbId)||(c+='In block "'+e+'", slider thumbId "'+a.thumbId+'" not displayed\n',h++):(c+='In block "'+e+'", slider thumbId "'+a.thumbId+'" not found\n',h++);void 0==a.min&&(c+='In block "'+e+'", slider min undefined\n',h++);void 0==a.max&&(c+='In block "'+
e+'", slider max undefined\n',h++);a.lowerPartId&&!w.dc(a.lowerPartId)&&(c+='In block "'+e+'", slider lowerPartId "'+a.lowerPartId+'" not found\n',h++);if(a.snap&&(a=a.snap,a instanceof Array))for(var b=0;b<a.length;b++)"string"===typeof a[b]?/^`.+`$/.test(a[b])||(c+='In block "'+e+'", invalid slider snap expression\n',h++):"number"!==typeof a[b]&&(c+='In block "'+e+'", slider snap must be a number or a string\n',h++)});n&&n.forEach(function(a){var b=a.id,f=a.centerId;a=a.thumbId;w.dc(b)?d(b)||(c+=
'In block "'+e+'", rotating id "'+b+'" not displayed\n',h++):(c+='In block "'+e+'", rotating id "'+b+'" not found\n',h++);w.dc(f)||(c+='In block "'+e+'", rotating centerId "'+f+'" not found\n',h++);w.dc(a)?d(a)||(c+='In block "'+e+'", rotating thumbId "'+a+'" not displayed\n',h++):(c+='In block "'+e+'", rotating thumbId "'+a+'" not found\n',h++);w.kf(a,b)||(c+='In block "'+e+'", rotating thumbId "'+a+'" not a descendent of id "'+b+'"\n',h++)});p&&(w.dc(p.id)?d(p.id)||(c+='In block "'+e+'", diffwheelmotion id "'+
p.id+'" not displayed\n',h++):(c+='In block "'+e+'", diffwheelmotion id "'+p.id+'" not found\n',h++));u&&(w.dc(u.id)?d(u.id)||(c+='In block "'+e+'", score id "'+u.id+'" not displayed\n',h++):(c+='In block "'+e+'", score id "'+u.id+'" not found\n',h++),"number"!==typeof u.numHeights||u.numHeights!==Math.round(u.numHeights)||0>=u.numHeights)&&(c+='In block "'+e+'", score numHeights must be a strictly positive integer\n',h++);(r||k||q||n||u||0<y)&&!l&&(c+='In block "'+e+'", missing defaultParameters\n',
h++);l&&(p=0,r&&(p+=r.length),k&&(p+=1),q&&(p+=q.length),n&&(p+=n.length),u&&(p+=2*Math.floor((l.length-p)/2)),p+=y,p!==l.length?(c+='In block "'+e+'", defaultParameters.length='+l.length+", needs "+p+" parameters\n",h++):m&&m.length!=p&&(c+='In block "'+e+'", typicalParameters.length='+m.length+", needs "+p+" parameters\n",h++));return h}var c="",d=0;a.blocks&&a.blocks.forEach(function(a){d+=b(a)});0<d&&(c+=d+" error"+(1<d?"s":"")+"\n");return c||null};function Wb(a){a.b.add("vpl:close",{action:function(a){a.Za(["vpl"],{Ce:!0})},object:a,W:function(a){return 1<a.xa.length&&0<=a.xa.indexOf("vpl")}});a.b.add("vpl:about",{action:function(a){a.de.show()},object:a,W:function(a){return null!=a.de}});a.b.add("vpl:help",{action:function(a){a.mf.show()},object:a,W:function(a){return null!=a.mf}});a.b.add("vpl:readonly",{isEnabled:function(){return!1},object:a,W:function(a){return a.i.readOnly}});a.b.add("vpl:suspend",{action:function(a){a.hc=!a.hc;a.hc?
(Qb(a)&&(Pb(a),a.i.uc=!1),a.Hd.show()):a.Hd.sc()},Ya:function(a){return a.hc},object:a,W:function(a){return!a.i.Hb&&null!=a.Hd}});a.b.add("vpl:new",{action:function(a){Sa(a.i);a.le&&Xb(a,a.le)},isEnabled:function(a){return!a.i.ga&&!a.i.readOnly&&!a.i.Kb()},object:a,W:function(a){return!a.i.readOnly}});a.b.add("vpl:save",{action:function(a,c){c?(a=Yb(a,a.Y),Zb(a,"vpl-program.html","text/html")):(c=ab(a.i,{Rc:!0,Uc:!0}),Zb(c,a.i.filename||"program.vpl3","application/x-vpl3"))},isEnabled:function(a){return!a.i.ga&&
!a.i.Kb()},object:a,W:function(a){return!a.i.readOnly}});a.b.add("vpl:load",{action:function(a){a.Wf.show()},isEnabled:function(a){return!a.i.ga&&!a.i.readOnly},object:a,W:function(a){return!a.i.readOnly}});a.b.add("vpl:upload",{action:function(a){var b=ab(a.i,{Rc:!1,Uc:!0});window.vplUpload(a.i.filename,b)},isEnabled:function(a){return!a.i.ga&&!a.i.readOnly&&!a.i.Kb()},object:a,W:function(a){return null!=window.vplUpload&&!a.i.readOnly}});a.b.add("vpl:exportToHTML",{action:function(a,c){c?(a=$b(a,
a.Y),Zb(a,"vpl-ui.html","text/html")):(a=Yb(a,a.Y),Zb(a,"vpl-program.html","text/html"))},isEnabled:function(a){return!a.i.ga&&!a.i.Kb()},object:a});a.b.add("vpl:text",{action:function(a){a.Ad?a.Za(["src"],{Dd:!0}):a.Za(["src"],{yd:"vpl"})},isEnabled:function(a){return!a.i.ga},fb:function(a,c){if(c.data instanceof z&&c.data.yb){if(c=cb(a.i.Ab,c.data))a.Za(["src"]),a.H.Qe(c.vd,c.end)}else c.data instanceof ua&&(c=cb(a.i.Ab,c.data))&&(a.Za(["src"]),a.H.Qe(c.vd,c.end))},eb:function(a,c){return c.data instanceof
z&&null!=c.data.yb||c.data instanceof ua},object:a,W:function(a){return a.H&&0>a.xa.indexOf("src")}});a.b.add("vpl:text-toggle",{action:function(a){a.Za(["src"],{toggle:!0})},isEnabled:function(a){return!a.i.ga},Ya:function(a){return 0<=a.xa.indexOf("src")},object:a});a.b.add("vpl:advanced",{action:function(a){Xa(a.i,"b"===a.i.mode?"a":"b")},isEnabled:function(a){return!a.i.ga&&!a.i.readOnly},Ya:function(a){return"a"===a.i.mode},object:a,W:function(a){return!a.i.readOnly}});a.b.add("vpl:undo",{action:function(a){a.i.Af(function(){Db(a)})},
isEnabled:function(a){return!a.i.ga&&0<a.i.Hc.Wb.length},object:a,W:function(a){return!a.i.readOnly}});a.b.add("vpl:redo",{action:function(a){a.i.tf(function(){Db(a)})},isEnabled:function(a){return!a.i.ga&&0<a.i.Hc.Vc.length},object:a,W:function(a){return!a.i.readOnly}});a.b.add("vpl:run",{action:function(a){var b=a.i.Rb(a.i.Ab);a.Pa[a.Ba].ab.Qb(b,a.i.Ab);a.i.uc=!0;a.i.qf=!1},isEnabled:function(a){if(a.i.ga||!a.Pa[a.Ba].ab.isEnabled(a.i.Ab))return!1;a=a.i.getError();return null==a||a.Fb},Ya:function(a){return a.i.uc},
getState:function(a){if(a.i.Kb())return"empty";if(a.i.uc)return"running";var b=a.i.getError();return b&&!b.Fb?"error":a.i.qf?"canLoad":"canReload"},fb:function(a,c){c.data instanceof z?c.data.yb?(c=oa[a.i.Ab].g(a.i,[c.data]),a.Pa[a.Ba].ab.Qb(c,a.i.Ab)):a.ba.vb=ac(a.ba,c):c.data instanceof ua&&(c=oa[a.i.Ab].g(a.i,c.data.actions),a.Pa[a.Ba].ab.Qb(c,a.i.Ab))},eb:function(a,c){if(a=a.Pa[a.Ba].ab.isEnabled(a.i.Ab)&&c.data instanceof ua)a:{a=c.data;for(var b=0;b<a.R.length;b++)if("a"===a.R[b].S.type){a=
!0;break a}for(b=0;b<a.actions.length;b++)if("a"===a.actions[b].S.type){a=!0;break a}a=!1}return a||c.data instanceof z&&null!=c.data.yb&&"a"===c.data.S.type},object:a,W:function(a){return 0<=a.Ba}});a.b.add("vpl:stop",{action:function(a){Pb(a);a.i.uc=!1},isEnabled:function(a){return Qb(a)},object:a,W:function(a){return 0<=a.Ba}});a.b.add("vpl:connected",{isEnabled:function(){return!1},Ya:function(a){return!a.i.ga&&a.Pa[a.Ba].ab.isConnected()},getState:function(a){return a.se?"monitored":!1===a.se?
"nonmonitored":""},object:a,W:function(a){return 0<=a.Ba}});a.b.add("vpl:robot",{action:function(a){a.Ba=(a.Ba+1)%a.Pa.length},getState:function(a){return a.Pa[a.Ba].name},object:a,W:function(a){return 1<a.Pa.length}});a.b.add("vpl:sim",{action:function(a){a.Ad?a.Za(["sim"],{Dd:!0}):a.Za(["sim"],{yd:"vpl"})},isEnabled:function(a){return!a.i.ga},object:a,W:function(a){return 0<=a.Ba&&null!=a.K&&0>a.xa.indexOf("sim")}});a.b.add("vpl:duplicate",{isEnabled:function(a){return!a.i.ga},fb:function(a,c){var b=
a.i.i.indexOf(c.data);0<=b&&(a.i.zb(),a.i.i.splice(b+1,0,c.data.kb()),a.ba.la&&a.ba.la(),a.log())},eb:function(a,c){return c.data instanceof ua&&!c.data.Kb()},object:a,W:function(a){return!a.i.readOnly}});a.b.add("vpl:disable",{isEnabled:function(a){return!a.i.ga},fb:function(a,c){c.data instanceof z?(a.i.zb(),c.data.disabled=!c.data.disabled,a.ba.la&&a.ba.la(),a.log()):c.data instanceof ua&&(a.i.zb(),c=c.data,c.disabled=!c.disabled,c.disabled&&(c.error=null),a.ba.la&&a.ba.la(),a.log())},eb:function(a,
c){return c.data instanceof ua?!c.data.Kb():c.data instanceof z&&null!==c.data.yb},object:a,W:function(a){return!a.i.readOnly}});a.b.add("vpl:lock",{isEnabled:function(a){return!a.i.ga},fb:function(a,c){c.data instanceof z?(a.i.zb(),c.data.locked=!c.data.locked,a.ba.la&&a.ba.la(),a.log()):c.data instanceof ua&&(a.i.zb(),c.data.locked=!c.data.locked,a.ba.la&&a.ba.la(),a.log())},eb:function(a,c){return c.data instanceof ua?!c.data.Kb():c.data instanceof z&&null!==c.data.yb},object:a,W:function(a){return a.i.Uf&&
a.i.Hb&&!a.i.readOnly}});a.b.add("vpl:trashcan",{isEnabled:function(a){return!a.i.ga},fb:function(a,c){c.data instanceof z?null!==c.data.yb&&(a.i.zb(),xa(c.data.yb,c.data.Yd),a.ba.la&&a.ba.la(),a.log()):c.data instanceof ua&&(c=a.i.i.indexOf(c.data),0<=c&&(a.i.zb(),a.i.i.splice(c,1),a.ba.la&&a.ba.la(),a.log()))},eb:function(a,c){return c.data instanceof z?null!==c.data.yb&&!c.data.locked:c.data instanceof ua&&(!c.data.Kb()||a.i.i.indexOf(c.data)+1<a.i.i.length)&&!c.data.locked},object:a,W:function(a){return!a.i.readOnly}});
a.b.add("vpl:message-error",{isEnabled:function(){return!1},getState:function(a){return a.Xb},object:a,W:function(a){return a.Xb&&!a.Id}});a.b.add("vpl:message-warning",{isEnabled:function(){return!1},getState:function(a){return a.Xb},object:a,W:function(a){return a.Xb&&a.Id}});a.b.add("vpl:message-empty",{isEnabled:function(){return!1},object:a,W:function(a){return!a.Xb}});a.b.add("vpl:filename",{isEnabled:function(){return!1},getState:function(a){return(a.i.filename||"")+(a.username?"\n"+a.username:
"")},object:a,W:function(a){return a.i.filename||a.username?!0:!1}});a.b.add("vpl:teacher",{action:function(a){a.i.wa.Ra=!a.i.wa.Ra},isEnabled:function(a){return!a.i.ga&&!a.i.readOnly},Ya:function(a){return a.i.wa.Ra},object:a,Ec:!0,W:function(a){return a.i.Hb&&!a.i.readOnly}});a.b.add("vpl:teacher-reset",{action:function(a,c){c?(Qa(a.i.mode),a.i.qc=Ka,a.i.oc=Ma):(Oa(),Sa(a.i),a.i.Zd())},isEnabled:function(a){return!a.i.ga},object:a,Ec:!0,W:function(a){return a.i.Hb&&a.i.wa.Ra&&!a.i.readOnly}});a.b.add("vpl:teacher-save",
{action:function(a){a=ab(a.i,{Rc:!0,Uc:!1});Zb(a,"ui.vpl3ui","application/x-vpl3-ui")},isEnabled:function(a){return!a.i.ga},object:a,Ec:!0,W:function(a){return a.i.Hb&&a.i.wa.Ra&&!a.i.readOnly}});a.b.add("vpl:teacher-setasnew",{action:function(a){var b=ab(a.i,{Rc:!0,Uc:!1});a.le=a.le===b?null:b},Ya:function(a){return a.le===ab(a.i,{Rc:!0,Uc:!1})},object:a,Ec:!0,W:function(a){return a.i.Hb&&a.i.wa.Ra&&!a.i.readOnly}})};function bc(a){this.g=a;this.controls=[];this.b="";this.y=this.x=0}function cc(a,b,c,d,e,f,g){a.controls.push({G:b,action:d||null,fb:e||null,eb:f||null,id:g||"",xc:c,x:0,y:0});a.b+="X"}
function dc(a,b,c,d){a.x=b.x;a.y=b.y;for(var e=a.b.replace(/^[s ]+/,"").replace(/[s ]+$/,"").replace(/ +/g," ").replace(/s +/g,"s").replace(/ +s/g,"s").replace(/s+/g,"s"),f=0,g=0,h=0,l=0,m=0;m<e.length;m++)switch(e[m]){case "X":f+=F(c[a.controls[l].id]);l++;break;case " ":case "_":g++;break;case "s":case "S":h++}d=d?F(d):0;var r=0;if(f>=b.width)d=0;else for(;;){r=(b.width-(f+d*g))/h;if(r>=d||!(0<d))break;d/=2}l=0;f=b.x;for(m=0;m<e.length;m++)switch(e[m]){case "X":g=a.controls[l];g.x=f+c[g.id].offsetLeft();
f+=F(c[g.id]);g.y=b.y+c[g.id].offsetTop();l++;break;case " ":case "_":f+=d;break;case "s":case "S":f+=r}}function ec(a,b,c,d){G(a.g,function(c){fc(b,c,a.x,a.y)});a.controls.forEach(function(a){gc(this.g,a.x,a.y,c[a.id],function(b,c,d){var e=Math.min(c.width/(a.xc.na-a.xc.U),c.height/(a.xc.ka-a.xc.V));b.save();b.translate(-a.xc.U,-a.xc.V);b.scale(e,e);a.G(b,c,d);b.restore()},a.action,a.fb,a.eb,d?function(){d(a.id)}:null,a.id)},a)};function hc(a,b,c,d,e,f,g,h,l,m){function r(a,d,e){b.save();e&&(b.scale(-1,1),b.translate(-2*a-c.c,0));b.fillStyle=l&&g?n.ta:n.pa;b.fillRect(a,d,c.c,c.c);b.fillStyle=g?n.M:n.ea;b.beginPath();b.moveTo(a+.1*c.c,d+.6*c.c);b.lineTo(a+.4*c.c,d+.6*c.c);b.lineTo(a+.25*c.c,d+.34*c.c);b.closePath();b.fill();b.beginPath();b.arc(a+.5*c.c,d+.83*c.c,.4*c.c,4.2,5.6);b.strokeStyle=b.fillStyle;b.lineWidth=.08*c.c;b.stroke();b.restore()}function k(a,d,e){b.save();b.fillStyle=l?n.ta:n.pa;b.fillRect(a,d,p.width,p.height);
b.translate(a+p.width/2,d+p.width/2);b.rotate(-e*Math.PI/2);b.translate(-a-p.width/2,-d-p.width/2);b.beginPath();b.moveTo(a+.3557*p.width,d+.25*p.width);b.lineTo(a+.3557*p.width,d+.75*p.width);b.lineTo(a+.7887*p.width,d+.5*p.width);b.closePath();b.strokeStyle=n.M;b.lineWidth=c.ra;b.stroke();b.restore()}function q(){b.beginPath();b.moveTo(0,.5*c.c);b.lineTo(.5*c.c,.5*c.c);b.lineTo(.5*c.c,-.25*c.c);b.bezierCurveTo(.3*c.c,-.5*c.c,.02*c.c,-.5*c.c,0,-.5*c.c);b.lineTo(0,-.5*c.c);b.bezierCurveTo(-.02*c.c,
-.5*c.c,-.3*c.c,-.5*c.c,-.5*c.c,-.25*c.c);b.lineTo(-.5*c.c,.5*c.c);b.closePath();b.fillStyle=g?n.M:n.ea;b.fill()}var n={pa:"navy",ta:"#37f",Nc:"#06f",M:"white",ea:"#777",Qc:"#44a",ef:"#ddf",Vd:"#99a",fe:"#a00",Xe:"#d10",ge:"#d00",Ye:"#f50",xd:"#c66",ff:"#800"};n={pa:"white",ta:"#ddd",Nc:"white",M:"#333",ea:"#999",Qc:"#ddd",ef:"#555",Vd:"#666",fe:"#fcc",Xe:"#fcc",ge:"#faa",Ye:"#faa",xd:"#866",ff:"#faa"};var p=H(d,{tag:"button",aa:e,id:a.replace(/:/g,"-")});d={"vpl:close":function(){b.fillStyle=l&&
g?n.ta:n.pa;b.fillRect(0,0,.5*c.c,c.c);b.beginPath();b.moveTo(.1*c.c,.1*c.c);b.lineTo(.4*c.c,.4*c.c);b.moveTo(.1*c.c,.4*c.c);b.lineTo(.4*c.c,.1*c.c);b.strokeStyle=g?n.M:n.ea;b.lineWidth=c.ra;b.stroke()},"vpl:about":function(){b.fillStyle=l&&g?n.ta:n.pa;b.fillRect(0,0,c.c,c.c);b.textAlign="center";b.textBaseline="middle";b.font="bold "+Math.round(.7*c.c).toString(10)+"px times";b.fillStyle=g?n.M:n.ea;b.fillText("i",.5*c.c,.5*c.c)},"vpl:help":function(){b.fillStyle=l&&g?n.ta:n.pa;b.fillRect(0,0,c.c,
c.c);b.textAlign="center";b.textBaseline="middle";b.font="bold "+Math.round(.7*c.c).toString(10)+"px times";b.fillStyle=g?n.M:n.ea;b.fillText("?",.5*c.c,.5*c.c)},"vpl:readonly":function(){var a=c.c;b.save();b.fillStyle=n.Vd;b.strokeStyle=n.Vd;b.lineWidth=c.ra;b.translate(.5*a,.7*a);b.save();b.rotate(.6);b.beginPath();b.moveTo(-.015/.22*a,.07*a);b.lineTo(0,.22*a);b.lineTo(.015/.22*a,.07*a);b.fill();b.beginPath();b.moveTo(-.1*a,-.4*a);b.lineTo(-.1*a,0);b.lineTo(0,.22*a);b.lineTo(.1*a,0);b.lineTo(.1*
a,-.4*a);b.restore();b.moveTo(-.2*a,-.4*a);b.lineTo(.4*a,.2*a);b.stroke();b.restore()},"vpl:new":function(){b.fillStyle=l&&g?n.ta:n.pa;b.fillRect(0,0,c.c,c.c);b.beginPath();b.moveTo(.25*c.c,.2*c.c);b.lineTo(.25*c.c,.8*c.c);b.lineTo(.75*c.c,.8*c.c);b.lineTo(.75*c.c,.3*c.c);b.lineTo(.65*c.c,.2*c.c);b.closePath();b.moveTo(.65*c.c,.2*c.c);b.lineTo(.65*c.c,.3*c.c);b.lineTo(.75*c.c,.3*c.c);b.strokeStyle=g?n.M:n.ea;b.lineWidth=c.ra;b.stroke()},"vpl:save":function(){b.fillStyle=l&&g?n.ta:n.pa;b.fillRect(0,
0,c.c,c.c);b.beginPath();b.moveTo(.25*c.c,.2*c.c);b.lineTo(.25*c.c,.7*c.c);b.lineTo(.67*c.c,.7*c.c);b.lineTo(.67*c.c,.27*c.c);b.lineTo(.6*c.c,.2*c.c);b.closePath();b.moveTo(.6*c.c,.2*c.c);b.lineTo(.6*c.c,.27*c.c);b.lineTo(.67*c.c,.27*c.c);b.strokeStyle=g?n.M:n.ea;b.lineWidth=c.ra;b.stroke();b.lineWidth=2*c.ra;b.beginPath();b.moveTo(.8*c.c,.5*c.c);b.lineTo(.8*c.c,.8*c.c);b.moveTo(.7*c.c,.7*c.c);b.lineTo(.8*c.c,.8*c.c);b.lineTo(.9*c.c,.7*c.c);b.stroke()},"vpl:exportToHTML":function(){b.fillStyle=l&&
g?n.ta:n.pa;b.fillRect(0,0,c.c,c.c);b.strokeStyle=g?n.M:n.ea;b.lineWidth=2*c.ra;b.beginPath();b.moveTo(.8*c.c,.2*c.c);b.lineTo(.8*c.c,.5*c.c);b.moveTo(.7*c.c,.4*c.c);b.lineTo(.8*c.c,.5*c.c);b.lineTo(.9*c.c,.4*c.c);b.textAlign="center";b.textBaseline="middle";b.font="bold "+Math.round(.3*c.c).toString(10)+"px sans-serif";b.fillStyle=g?n.M:n.ea;b.fillText("HTML",.5*c.c,.7*c.c);b.stroke()},"vpl:load":function(){b.fillStyle=l&&g?n.ta:n.pa;b.fillRect(0,0,c.c,c.c);b.beginPath();b.moveTo(.25*c.c,.2*c.c);
b.lineTo(.25*c.c,.7*c.c);b.lineTo(.67*c.c,.7*c.c);b.lineTo(.67*c.c,.27*c.c);b.lineTo(.6*c.c,.2*c.c);b.closePath();b.moveTo(.6*c.c,.2*c.c);b.lineTo(.6*c.c,.27*c.c);b.lineTo(.67*c.c,.27*c.c);b.strokeStyle=g?n.M:n.ea;b.lineWidth=c.ra;b.stroke();b.lineWidth=2*c.ra;b.beginPath();b.moveTo(.8*c.c,.55*c.c);b.lineTo(.8*c.c,.85*c.c);b.moveTo(.7*c.c,.65*c.c);b.lineTo(.8*c.c,.55*c.c);b.lineTo(.9*c.c,.65*c.c);b.stroke()},"vpl:upload":function(){b.fillStyle=l&&g?n.ta:n.pa;b.fillRect(0,0,c.c,c.c);b.beginPath();
b.moveTo(.25*c.c,.3*c.c);b.lineTo(.25*c.c,.8*c.c);b.lineTo(.67*c.c,.8*c.c);b.lineTo(.67*c.c,.37*c.c);b.lineTo(.6*c.c,.3*c.c);b.closePath();b.moveTo(.6*c.c,.3*c.c);b.lineTo(.6*c.c,.37*c.c);b.lineTo(.67*c.c,.37*c.c);b.strokeStyle=g?n.M:n.ea;b.lineWidth=c.ra;b.stroke();b.lineWidth=2*c.ra;b.beginPath();b.moveTo(.8*c.c,.5*c.c);b.lineTo(.8*c.c,.2*c.c);b.moveTo(.7*c.c,.3*c.c);b.lineTo(.8*c.c,.2*c.c);b.lineTo(.9*c.c,.3*c.c);b.stroke()},"vpl:text":function(){b.fillStyle=l&&g?n.ta:n.pa;b.fillRect(0,0,c.c,c.c);
b.beginPath();b.moveTo(.25*c.c,.2*c.c);b.lineTo(.25*c.c,.8*c.c);b.lineTo(.75*c.c,.8*c.c);b.lineTo(.75*c.c,.3*c.c);b.lineTo(.65*c.c,.2*c.c);b.closePath();b.moveTo(.65*c.c,.2*c.c);b.lineTo(.65*c.c,.3*c.c);b.lineTo(.75*c.c,.3*c.c);for(var a=.2;.6>a;a+=.1)b.moveTo(.3*c.c,c.c*(.2+a)),b.lineTo(.7*c.c,c.c*(.2+a));b.strokeStyle=g?n.M:n.ea;b.lineWidth=c.ra;b.stroke()},"vpl:text-toggle":function(){b.fillStyle=l&&g?n.ta:n.pa;b.fillRect(0,0,c.c,c.c);b.beginPath();b.moveTo(.28*c.c,.2*c.c);b.lineTo(.28*c.c,.7*
c.c);b.lineTo(.7*c.c,.7*c.c);b.lineTo(.7*c.c,.27*c.c);b.lineTo(.63*c.c,.2*c.c);b.closePath();b.moveTo(.63*c.c,.2*c.c);b.lineTo(.63*c.c,.27*c.c);b.lineTo(.7*c.c,.27*c.c);for(var a=.1;.5>a;a+=.1)b.moveTo(.33*c.c,c.c*(.2+a)),b.lineTo(.63*c.c,c.c*(.2+a));b.strokeStyle=g?n.M:n.ea;b.lineWidth=c.ra;b.stroke();b.fillStyle=g?h||l?n.M:n.Qc:n.ea;b.fillRect(.1*c.c,.8*c.c,.8*c.c,.1*c.c)},"vpl:advanced":function(){b.fillStyle=l&&g?n.ta:h?n.Nc:n.pa;b.fillRect(0,0,c.c,c.c);b.fillStyle=g?n.M:n.ea;for(var a=0;4>a;a++)for(var d=
0;5>d;d++)b.fillRect(.1*c.c*(1+a)+(2>a?0:.43*c.c),.1*c.c*(2+d),.07*c.c,.07*c.c);b.fillStyle=g?h||l?n.M:n.Qc:n.ea;b.fillRect(.1*c.c,.8*c.c,.8*c.c,.1*c.c)},"vpl:undo":function(){r(0,0,!1)},"vpl:redo":function(){r(0,0,!0)},"vpl:run":function(){b.fillStyle=l&&g?n.ta:n.pa;b.fillRect(0,0,c.c,c.c);b.beginPath();b.moveTo(.3*c.c,.25*c.c);b.lineTo(.3*c.c,.75*c.c);b.lineTo(.8*c.c,.5*c.c);b.closePath();b.fillStyle=g?n.M:n.ea;b.fill();b.fillStyle=g?h||l?n.M:n.Qc:n.ea;b.fillRect(.1*c.c,.8*c.c,.8*c.c,.1*c.c)},"vpl:stop":function(){b.fillStyle=
l&&g?n.ta:n.pa;b.fillRect(0,0,c.c,c.c);b.fillStyle=g?n.M:n.ea;b.fillRect(.28*c.c,.28*c.c,.44*c.c,.44*c.c)},"vpl:connected":function(){function a(a,d){var e=.08*c.c;b.save();b.fillStyle=g?n.ta:n.pa;b.fillRect(a-e,d-e,2*e,2*e);b.beginPath();b.moveTo(a-e,d-e);b.lineTo(a+e,d+e);b.moveTo(a+e,d-e);b.lineTo(a-e,d+e);b.stroke();b.restore()}b.translate(0,.1*c.c);b.fillStyle=g?n.ta:n.pa;b.fillRect(0,0,c.c,c.c);b.save();b.translate(.8*c.c,.2*c.c);b.scale(.35,.35);q();b.restore();b.fillStyle=g?n.M:n.ea;b.strokeStyle=
g?n.M:n.ea;b.lineWidth=1.5*c.ra;m&&b.strokeRect(0,.05*c.c,.3*c.c,.3*c.c);b.strokeRect(.3*c.c,.55*c.c,.4*c.c,.3*c.c);b.lineWidth=c.ra;b.beginPath();b.moveTo(.7*c.c,.7*c.c);b.bezierCurveTo(.9*c.c,.7*c.c,.9*c.c,.7*c.c,.85*c.c,.35*c.c);m&&(b.moveTo(.3*c.c,.7*c.c),b.bezierCurveTo(.1*c.c,.7*c.c,.1*c.c,.7*c.c,.15*c.c,.35*c.c));b.stroke();h||a(.86*c.c,.55*c.c);"nonmonitored"===m&&a(.14*c.c,.55*c.c)},"vpl:robot":function(){b.fillStyle=l?n.ta:n.pa;b.fillRect(0,0,c.c,c.c);switch(m){case "thymio":b.save();b.translate(c.c/
2,.35*c.c);b.scale(.3,.3);b.rotate(.2);q();b.restore();break;case "thymio-tdm":b.save();b.translate(c.c/2,.35*c.c);b.scale(.3,.3);b.rotate(.2);q();b.restore();b.fillStyle=n.M;b.fillRect(.4*c.c,.65*c.c,.2*c.c,.2*c.c);break;case "sim":b.save(),b.translate(c.c/2,.35*c.c),b.scale(.3,.3),b.rotate(.2),q(),b.beginPath(),b.strokeStyle=n.M,b.lineWidth=c.ra/.3,b.strokeRect(-c.c,-.8*c.c,2*c.c,1.6*c.c),b.restore()}b.beginPath();b.moveTo(.2*c.c,.75*c.c);b.lineTo(.5*c.c,.75*c.c);b.lineTo(.5*c.c,c.c*("sim"===m?
.6:.3));b.strokeStyle=n.M;b.lineWidth=c.ra;b.stroke()},"vpl:sim":function(){b.fillStyle=l&&g?n.ta:n.pa;b.fillRect(0,0,c.c,c.c);b.save();b.translate(c.c/2,.35*c.c);b.scale(.4,.4);b.rotate(.2);q();b.beginPath();b.arc(c.c,.5*c.c,1.4*c.c,-3.2,-3.8,!0);b.strokeStyle=l&&g?n.ef:n.Vd;b.lineWidth=.2*c.c;b.stroke();b.beginPath();b.arc(c.c,.5*c.c,.6*c.c,-3.3,-3.8,!0);b.stroke();b.restore()},"vpl:message-empty":function(){},"vpl:message-error":function(){if(m){b.fillStyle=p.color;b.font=ic(p);b.textAlign="center";
b.textBaseline="middle";var a=f.translate(m);b.fillText(a,p.width/2,p.height/2)}},"vpl:filename":function(){if(m){b.beginPath();var a=3*c.c;b.rect(0,0,a,c.c);b.clip();b.fillStyle=p.color;b.font=ic(p);b.textAlign="center";b.textBaseline="middle";var d=m.trim().split("\n").slice(0,2).map(function(c){c=c.slice(0,80);if(1<c.length&&b.measureText(c).width>a){for(;1<c.length&&b.measureText(c+"\u2026").width>a;)c=c.slice(0,-1);c+="\u2026"}return c});1<d.length?(b.fillText(d[0],p.width/2,.25*p.height),b.fillText(d[1],
p.width/2,.75*p.height)):b.fillText(d[0],p.width/2,p.height/2)}},"vpl:duplicate":function(){b.fillStyle=l&&g?n.ta:n.pa;b.fillRect(0,0,c.c,c.c);b.strokeStyle=g?n.M:n.ea;b.lineWidth=c.ra;b.strokeRect(.3*c.c,.3*c.c,.4*c.c,.15*c.c);b.strokeRect(.3*c.c,.55*c.c,.4*c.c,.15*c.c)},"vpl:disable":function(){b.fillStyle=l&&g?n.ta:n.pa;b.fillRect(0,0,c.c,c.c);b.strokeStyle=g?n.M:n.ea;b.lineWidth=c.ra;b.strokeRect(.3*c.c,.3*c.c,.4*c.c,.4*c.c);b.beginPath();b.moveTo(.2*c.c,.6*c.c);b.lineTo(.8*c.c,.4*c.c);b.stroke()},
"vpl:lock":function(){b.fillStyle=l&&g?n.ta:n.pa;b.fillRect(0,0,c.c,c.c);b.strokeStyle=g?n.M:n.ea;b.fillStyle=g?n.M:n.ea;b.lineWidth=c.ra;b.strokeRect(.3*c.c,.3*c.c,.4*c.c,.4*c.c);jc(b,.5*c.c,.52*c.c,.04*c.c,n.M)},"vpl:trashcan":function(){b.fillStyle=l&&g?n.ta:n.pa;b.fillRect(0,0,c.c,c.c);b.beginPath();b.moveTo(.25*c.c,.2*c.c);b.lineTo(.32*c.c,.8*c.c);b.lineTo(.68*c.c,.8*c.c);b.lineTo(.75*c.c,.2*c.c);b.closePath();b.strokeStyle=g?n.M:n.ea;b.lineWidth=c.ra;b.stroke()},"vpl:teacher-reset":function(){b.fillStyle=
l&&g?n.ge:n.fe;b.fillRect(0,0,c.c,c.c);b.beginPath();b.moveTo(.25*c.c,.2*c.c);b.lineTo(.25*c.c,.8*c.c);b.lineTo(.75*c.c,.8*c.c);b.lineTo(.75*c.c,.3*c.c);b.lineTo(.65*c.c,.2*c.c);b.closePath();b.moveTo(.65*c.c,.2*c.c);b.lineTo(.65*c.c,.3*c.c);b.lineTo(.75*c.c,.3*c.c);b.strokeStyle=g?n.M:n.xd;b.lineWidth=c.ra;b.stroke();b.fillStyle=g?n.M:n.xd;kc(b,.63*c.c,.7*c.c,.2*c.c)},"vpl:teacher-save":function(){b.fillStyle=l&&g?n.ge:n.fe;b.fillRect(0,0,c.c,c.c);b.strokeStyle=g?n.M:n.xd;b.beginPath();b.moveTo(.25*
c.c,.2*c.c);b.lineTo(.25*c.c,.7*c.c);b.lineTo(.67*c.c,.7*c.c);b.lineTo(.67*c.c,.27*c.c);b.lineTo(.6*c.c,.2*c.c);b.closePath();b.moveTo(.6*c.c,.2*c.c);b.lineTo(.6*c.c,.27*c.c);b.lineTo(.67*c.c,.27*c.c);b.lineWidth=c.ra;b.stroke();b.lineWidth=2*c.ra;b.beginPath();b.moveTo(.8*c.c,.5*c.c);b.lineTo(.8*c.c,.8*c.c);b.moveTo(.7*c.c,.7*c.c);b.lineTo(.8*c.c,.8*c.c);b.lineTo(.9*c.c,.7*c.c);b.stroke();b.fillStyle=g?n.M:n.xd;kc(b,.46*c.c,.45*c.c,.2*c.c)},"vpl:teacher-setasnew":function(){b.fillStyle=l&&g?h?n.Ye:
n.ge:h&&g?n.Xe:n.fe;b.fillRect(0,0,c.c,c.c);b.strokeStyle=g?n.M:n.xd;b.beginPath();b.moveTo(.25*c.c,.2*c.c);b.lineTo(.25*c.c,.7*c.c);b.lineTo(.67*c.c,.7*c.c);b.lineTo(.67*c.c,.27*c.c);b.lineTo(.6*c.c,.2*c.c);b.closePath();b.moveTo(.6*c.c,.2*c.c);b.lineTo(.6*c.c,.27*c.c);b.lineTo(.67*c.c,.27*c.c);b.lineWidth=c.ra;b.stroke();b.lineWidth=2*c.ra;b.beginPath();b.moveTo(.8*c.c,.5*c.c);b.lineTo(.5*c.c,.5*c.c);b.moveTo(.6*c.c,.4*c.c);b.lineTo(.5*c.c,.5*c.c);b.lineTo(.6*c.c,.6*c.c);b.stroke();b.fillStyle=
g?h||l?n.M:n.ff:n.ea;b.fillRect(.1*c.c,.8*c.c,.8*c.c,.1*c.c)},"vpl:teacher":function(){b.fillStyle=l&&g?h?n.Ye:n.ge:h&&g?n.Xe:n.fe;b.fillRect(0,0,c.c,c.c);b.fillStyle=g?n.M:n.xd;kc(b,.5*c.c,.4*c.c,.27*c.c);b.fillStyle=g?h||l?n.M:n.ff:n.ea;b.fillRect(.1*c.c,.8*c.c,.8*c.c,.1*c.c)},"src:vpl":function(){b.save();b.fillStyle=l&&g?n.ta:n.pa;b.fillRect(0,0,c.c,c.c);b.beginPath();b.moveTo(.25*c.c,.2*c.c);b.lineTo(.25*c.c,.8*c.c);b.lineTo(.75*c.c,.8*c.c);b.lineTo(.75*c.c,.3*c.c);b.lineTo(.65*c.c,.2*c.c);b.closePath();
b.moveTo(.65*c.c,.2*c.c);b.lineTo(.65*c.c,.3*c.c);b.lineTo(.75*c.c,.3*c.c);b.strokeStyle=g?n.M:n.ea;b.lineWidth=c.ra;b.stroke();b.fillStyle=l&&g?n.M:n.Vd;for(var a=.15;.6>a;a+=.15)b.fillRect(.3*c.c,c.c*(.2+a),.4*c.c,.1*c.c);b.restore()},"src:locked":function(){b.save();b.fillStyle=g?l?n.ta:h?n.Nc:n.pa:n.pa;b.fillRect(0,0,c.c,c.c);b.strokeStyle=g?n.M:n.ea;b.lineWidth=c.ra;b.fillStyle=g?h?n.ef:n.Vd:n.ea;for(var a=.15;.6>a;a+=.15)b.fillRect(.15*c.c,c.c*a,.4*c.c,.1*c.c);jc(b,.77*c.c,.36*c.c,.06*c.c,g?
n.M:n.ea,!h);b.fillStyle=g?h||l?n.M:n.Qc:n.ea;b.fillRect(.1*c.c,.8*c.c,.8*c.c,.1*c.c);b.restore()},"src:language":function(){var a=c.c;b.save();b.fillStyle=g?l?n.ta:n.pa:n.pa;b.fillRect(0,0,a,a);b.beginPath();for(var d=0;3>d;d++)b.moveTo(.2*a,a*(.2+.1*d)),b.lineTo(.5*a,a*(.2+.1*d));b.strokeStyle=g?n.M:n.ea;b.lineWidth=c.ra;b.stroke();for(d=0;3>d;d++){var e=2*(d+.25)/3*Math.PI;lc(b,.75*a,.3*a,.15*a,e-.3*Math.PI,e+.3*Math.PI,{td:!1,Mc:3*c.ra,style:g?n.M:n.ea})}b.textAlign="center";b.textBaseline="middle";
b.font="bold "+Math.round(a/3).toString(10)+"px sans-serif";b.fillStyle=g?n.M:n.ea;b.fillText({aseba:"Aa",l2:"l2",js:"js",python:"py"}[m],.5*a,.7*a);b.restore()},"src:disass":function(){var a=c.c;b.save();b.fillStyle=g&&l?n.ta:h?n.Nc:n.pa;b.fillRect(0,0,a,a);b.beginPath();b.moveTo(.2*a,.2*a);b.lineTo(.3*a,.2*a);for(var d=0;5>d;d++)b.moveTo(.4*a,a*(.2+.1*d)),b.lineTo(.45*a,a*(.2+.1*d)),b.moveTo(.55*a,a*(.2+.1*d)),b.lineTo(.65*a,a*(.2+.1*d));b.strokeStyle=g?n.M:n.ea;b.lineWidth=c.ra;b.stroke();b.fillStyle=
g&&(h||l)?n.M:n.Qc;b.fillRect(.1*c.c,.8*c.c,.8*c.c,.1*c.c);b.restore()},"sim:restart":function(){b.save();b.fillStyle=l?n.ta:n.pa;b.fillRect(0,0,p.width,p.height);var a=c.c;b.lineWidth=.05*a;lc(b,.5*a,.5*a,.25*a,1.56,0,{td:!1,Mc:.2*a,style:n.M});b.restore()},"sim:pause":function(){b.save();b.fillStyle=l?n.ta:h?n.Nc:n.pa;b.fillRect(0,0,c.c,c.c);b.fillStyle=g?n.M:n.ea;b.fillRect(.28*c.c,.28*c.c,.15*c.c,.44*c.c);h?(b.beginPath(),b.moveTo(.54*c.c,.28*c.c),b.lineTo(.62*c.c,.28*c.c),b.lineTo(.75*c.c,.5*
c.c),b.lineTo(.62*c.c,.72*c.c),b.lineTo(.54*c.c,.72*c.c),b.fill()):b.fillRect(.57*c.c,.28*c.c,.15*c.c,.44*c.c);b.restore()},"sim:speedup":function(){b.save();b.fillStyle=l&&g?n.ta:h?n.Nc:n.pa;b.fillRect(0,0,c.c,c.c);b.fillStyle=g?n.M:n.ea;b.beginPath();for(var a=0;2>a;a++)b.moveTo(c.c*(.3+.22*a),.25*c.c/2),b.lineTo(c.c*(.3+.22*a),.75*c.c/2),b.lineTo(c.c*(.5+.22*a),.5*c.c/2),b.closePath();b.fill();b.textAlign="center";b.textBaseline="middle";b.font="bold "+Math.round(c.c/3).toString(10)+"px sans-serif";
b.fillText(1<=m?"\u00d7"+m.toString(10):"\u00f7"+Math.round(1/m).toString(10),.5*c.c,.7*c.c);b.restore()},"sim:noise":function(){b.save();b.fillStyle=l&&g?n.ta:h?n.Nc:n.pa;b.fillRect(0,0,c.c,c.c);b.beginPath();var a=[.58,1.48,.96,.39,1.36,.09,-.75,-1.58,-.32,-1.36,-1.39,-.94,-1.1,-1.04,-.1,.93,1.22,.6,.89,.61];b.moveTo(.1*c.c,(.4+.1*a[0])*c.c);for(var d=1;d<a.length;d++)b.lineTo((.1+.8/(a.length-1)*d)*c.c,(.4+.1*a[d])*c.c);b.strokeStyle=g?n.M:n.ea;b.lineWidth=c.ra;b.stroke();b.fillStyle=g?h||l?n.M:
n.Qc:n.ea;b.fillRect(.1*c.c,.8*c.c,.8*c.c,.1*c.c);b.restore()},"sim:pen":function(){var a=c.c;b.save();b.fillStyle=l&&g?n.ta:h?n.Nc:n.pa;b.fillRect(0,0,a,a);b.fillStyle=g?h||l?n.M:n.Qc:n.ea;b.fillRect(.1*a,.8*a,.8*a,.1*a);b.translate(.5*a,a*(.4+(h?.13:0)));b.beginPath();b.moveTo(-.015/.22*a,.07*a);b.lineTo(0,.22*a);b.lineTo(.015/.22*a,.07*a);b.fillStyle=g?n.M:n.ea;b.fill();b.beginPath();b.moveTo(-.1*a,-.22*a);b.lineTo(-.1*a,0);b.lineTo(0,.22*a);b.lineTo(.1*a,0);b.lineTo(.1*a,-.22*a);b.strokeStyle=
g?n.M:n.ea;b.lineWidth=c.ra;b.stroke();b.restore()},"sim:clear":function(){var a=c.c;b.save();b.fillStyle=l&&g?n.ta:n.pa;b.fillRect(0,0,a,a);b.strokeStyle=g?n.M:n.ea;b.lineWidth=c.ra;b.strokeRect(.15*a,.25*a,.7*a,.5*a);b.translate(.5*a,.4*a);b.rotate(.4);b.fillStyle=g?n.M:n.ea;b.fillRect(0,0,.3*a,.2*a);b.restore()},"sim:map-kind":function(){var a=c.c,d=c.ra;b.save();b.fillStyle=l&&g?n.ta:n.pa;b.fillRect(0,0,c.c,c.c);b.lineWidth=d;b.strokeStyle=g?n.M:n.ea;b.fillStyle=g?n.M:n.ea;for(var e=["ground",
"height","obstacles"].indexOf(m),f=0;3>f;f++){var h=2*(f+.25)/3*Math.PI;f===e?b.fillRect(a*(.35+.25*Math.cos(h)),a*(.39+.25*Math.sin(h)),.3*a,.22*a):b.strokeRect(a*(.35+.25*Math.cos(h)),a*(.39+.25*Math.sin(h)),.3*a,.22*a);lc(b,.5*a,.5*a,.36*a,h-.42*Math.PI,h-.22*Math.PI,{td:!1,Mc:3*d,style:n.M})}b.restore()},"sim:map":function(){var a=c.c;b.save();b.fillStyle=l&&g?n.ta:h?n.Nc:n.pa;b.fillRect(0,0,c.c,c.c);b.fillStyle=g?h||l?n.M:n.Qc:n.ea;b.fillRect(.1*a,.8*a,.8*a,.1*a);b.lineWidth=c.ra;b.strokeStyle=
g?n.M:n.ea;b.strokeRect(.15*a,.15*a,.7*a,.5*a);switch(m){case "ground":b.lineWidth=.08*a;b.beginPath();b.arc(.6*a,.4*a,.15*a,-.5*Math.PI,.5*Math.PI);b.lineTo(.4*a,.55*a);b.arc(.4*a,.4*a,.15*a,.5*Math.PI,1.5*Math.PI);b.closePath();b.stroke();break;case "height":for(var d=0;.75>=d;d+=.25)for(var e=0;1>=e;e+=.1){var f=a*(.2+.5*e+.15*d),k=a*(.5-.3*d-.2*(.2*Math.cos(5*e+2*d-3)-(d-.9)*(d-.9)/3));0===e?b.moveTo(f,k):b.lineTo(f,k)}b.stroke();break;case "obstacles":b.strokeRect(.2*a,.2*a,.6*a,.4*a),b.beginPath(),
b.moveTo(.4*a,.2*a),b.lineTo(.4*a,.43*a),b.moveTo(.6*a,.6*a),b.lineTo(.6*a,.37*a),b.stroke()}b.restore()},"sim-event:forward":function(){k(0,0,1)},"sim-event:backward":function(){k(0,0,3)},"sim-event:left":function(){k(0,0,2)},"sim-event:right":function(){k(0,0,0)},"sim-event:center":function(){b.save();b.fillStyle=l?n.ta:n.pa;b.fillRect(0,0,p.width,p.height);b.beginPath();b.arc(.5*p.width,.5*p.width,.25*p.width,0,2*Math.PI);b.strokeStyle=n.M;b.lineWidth=c.ra;b.stroke();b.restore()},"sim-event:clap":function(){b.save();
b.fillStyle=l?n.ta:n.pa;b.fillRect(0,0,p.width,p.height);b.beginPath();b.strokeStyle=n.M;b.lineWidth=c.ra;b.translate(.5*p.width,.5*p.width);b.rotate(.1);for(var a=0;9>a;a++)b.beginPath(),b.moveTo(.12*p.width,0),b.lineTo(.24*p.width,0),b.moveTo(.28*p.width,0),b.lineTo(.36*p.width,0),b.stroke(),b.rotate(Math.PI/4.5);b.restore()},"sim-event:tap":function(){b.save();b.fillStyle=l?n.ta:n.pa;b.fillRect(0,0,p.width,p.height);b.beginPath();b.strokeStyle=n.M;b.lineWidth=c.ra;b.translate(.6*p.width,.6*p.width);
for(var a=1;3>=a;a++)b.beginPath(),b.arc(0,0,.15*p.width*a,.9*Math.PI,1.7*Math.PI),b.stroke();b.moveTo(.3*p.width,0);b.lineTo(0,0);b.lineTo(0,.3*p.width);b.stroke();b.restore()}};d["vpl:message-warning"]=d["vpl:message-error"];d["src:close"]=d["vpl:close"];d["src:new"]=d["vpl:new"];d["src:save"]=d["vpl:save"];d["src:load"]=d["vpl:load"];d["src:run"]=d["vpl:run"];d["src:stop"]=d["vpl:stop"];d["src:connected"]=d["vpl:connected"];d["src:sim"]=d["vpl:sim"];d["src:teacher"]=d["vpl:teacher"];d["src:teacher-reset"]=
d["vpl:teacher-reset"];d["sim:close"]=d["vpl:close"];d["sim:vpl"]=d["src:vpl"];d["sim:text"]=d["vpl:text"];d["sim:teacher"]=d["vpl:teacher"];d["sim:teacher-reset"]=d["vpl:teacher-reset"];(a=d[a])&&a()}
function mc(a,b){switch(a){case "vpl:close":case "src:close":case "sim:close":return{U:0,na:b.c/2,V:0,ka:b.c};case "vpl:message-error":case "vpl:message-warning":case "vpl:message-empty":return{U:0,na:5*b.c,V:0,ka:b.c};case "vpl:filename":return{U:0,na:3*b.c,V:0,ka:b.c}}return{U:0,na:b.c,V:0,ka:b.c}};function nc(a,b,c,d,e,f){var g=0<=b.wa.b.indexOf(c);if((b.l?b.l.W:b.b.W(c))&&(b.wa.Ra||!g)){var h=a.g,l=b.b.find(c).Ec;cc(a,function(a,f,l){b.l?e(c,a,h.v,h.Y,d,b.o,b.l.isEnabled,b.l.Ya,b.l.Eg,b.l.state):e(c,a,h.v,h.Y,d,b.o,b.b.isEnabled(c),b.b.Ya(c),l,b.b.getState(c));(b.l?b.l.disabled:g)&&oc(h,0,0,f.width,f.height,["button"],["button"])},f,b.wa.Ra&&!l?function(){b.wa.toggle(c);return 1}:tb(b.b,c)?function(a){var d=b.b;a=a.Fg;var e=d.find(c);e&&(vb(e,a),ub(d,c))}:null,b.wa.Ra&&!l?null:function(a,
d){b.b.fb(c,d)},b.wa.Ra&&!l?null:function(a,d){return b.b.eb(c,d)},c)}}function pc(a,b,c,d,e,f){a.controls=[];a.b="";for(var g=0;g<c.length;g++)switch(c[g]){case "!space":a.b+=" ";break;case "!!space":a.b+="_";break;case "!stretch":a.b+="s";break;case "!!stretch":a.b+="S";break;default:nc(a,b,c[g],d,e,f(c[g],a.g.v,b.b.find(c[g]).tc))}}function qc(a,b){for(var c=0;c<b.length;c++)if("!"!==b[c][0]&&a.b.W(b[c]))return!0;return!1}
function rc(a,b,c){for(var d={},e=0;e<b.length;e++)if("!"!==b[e][0]&&(a.l?a.l.W:a.b.find(b[e]).W())){var f=H(a.Y,{tag:"button",id:b[e].replace(/:/g,"-"),aa:c});d[b[e]]=f}return d}function sc(a){var b=0,c;for(c in a)a.hasOwnProperty(c)&&(b=Math.max(b,a[c].ma()));return b};var tc={"vpl:then":function(a,b,c,d){b=Math.min(d.width,d.height);a.strokeStyle=c.uf;a.lineWidth=.2*b;a.beginPath();a.moveTo(-.25*b,-.5*b);a.lineTo(.25*b,0);a.lineTo(-.25*b,.5*b);a.stroke()},"vpl:error":function(a,b,c,d){b=Math.min(d.width,d.height);a.fillStyle="white";a.strokeStyle=c.df;a.lineWidth=.07*b;a.beginPath();a.arc(0,0,.5*b,0,2*Math.PI);a.fill();a.stroke();a.fillStyle=c.df;a.font="bold "+Math.round(.75*b).toString()+"px sans-serif";a.textAlign="center";a.textBaseline="middle";a.fillText("?",
0,.05*b)},"vpl:warning":function(a,b,c,d){b=Math.min(d.width,d.height);a.fillStyle="white";a.strokeStyle=c.Ef;a.lineWidth=.07*b;a.beginPath();a.arc(0,0,.5*b,0,2*Math.PI);a.fill();a.stroke();a.fillStyle=c.Ef;a.font="bold "+Math.round(.75*b).toString()+"px sans-serif";a.textAlign="center";a.textBaseline="middle";a.fillText("!",0,.05*b)},"vpl:moreHigh":function(a,b,c,d){b=Math.min(d.width,d.height);a.beginPath();a.moveTo(-.2*b,.1*b);a.lineTo(0,-.1*b);a.lineTo(.2*b,.1*b);a.lineWidth=.1*b;a.strokeStyle=
"black";a.shadowColor="white";a.shadowBlur=.2*b;a.stroke()},"vpl:moreLow":function(a,b,c,d){b=Math.min(d.width,d.height);a.beginPath();a.moveTo(-.2*b,-.1*b);a.lineTo(0,.1*b);a.lineTo(.2*b,-.1*b);a.lineWidth=.1*b;a.strokeStyle="black";a.shadowColor="white";a.shadowBlur=.2*b;a.stroke()},"vpl:customize":function(a,b,c,d){b=Math.min(d.width,d.height);a.fillStyle=c.uf;kc(a,0,0,b)}};function Bb(){this.l=new uc;this.b=new uc;this.b.P=!0;this.g=new uc}function vc(a,b){return function(){a.L!==b&&(a.L=b,Db(a))}}function wc(a){return function(b){a.L!==b&&(a.L=b,Db(a))}}
function xc(a,b,c,d,e,f,g){function h(a){return"a"===a||"c"===a}var l=a.i,m=Math.min(d.width,d.height),r=m/b.v.j;e=new yc(c,d.width,d.height,e,f,function(a,b,e,f){var h=a.I;h.save();var l=a.v;a.v=zc(m,a.v.c*r);fc(d,h,b.x+e,b.y+f);var k=c.S,n=b.data,p=b.x+e,q=b.y+f;a.I.save();a.I.translate(p,q);k.G(a,n,d);a.I.restore();c.locked&&Ac(a,b.x+e,b.y+f,m,m,!0);(c.disabled||g.disabled)&&oc(a,b.x+e,b.y+f,m,m,["block"],["block"],!g.Ag);a.v=l;h.restore()},g&&g.Oe||c.disabled||c.locked||c.yb&&c.yb.locked||!c.S.Z?
g&&g.Z?{Z:g.Z}:null:{Z:c.S.Z,Oa:c.S.Oa},g&&g.Ne?null:function(a,c){a.data.yb&&(l.zb(),va(a.data.yb,c.data,a.data.Yd,function(){l.zb()}));b.la&&b.la()},g&&g.Ne?null:function(a,b){return b.data instanceof z&&(h(a.data.S.type)===h(b.data.S.type)||"c"===b.data.S.type)&&a.data!==b.data});g&&g.Oe||!c.S.Z||!l.L||(e.w=function(a){return ac(b,a)});e.va=!(g&&g.Me);e.l=!(g&&g.oe);e.L=vc(a,c.S.name);Bc(b,e,Cc(b,c));return e}
function Dc(a,b,c,d,e,f){var g=new z(c,null,null);c.ub&&(g.h=c.ub());var h=a.i,l=0>("b"===h.mode?h.qc:h.oc).indexOf(c.name);a=xc(a,b,g,d,e,f,{Oe:!0,Ne:!0,oe:a.ga||a.readOnly,disabled:l||a.readOnly,Ag:l,Z:!a.wa.Ra||a.ga||h.readOnly?null:function(){var a="b"===h.mode?h.qc:h.oc;0<=a.indexOf(c.name)?a.splice(a.indexOf(c.name),1):a.push(c.name);return 1}});c.ub&&(a.fa=function(a){a=a.clone();a.data=new z(c,null,null);return a})}
function Ec(a,b,c){var d=[],e=0;d=a.R.map(function(b,f){var g=a.error&&a.error.g&&(0===a.error.l.length||0<=a.error.l.indexOf(f))?a.error.Fb?c.fd:c.ed:c.Da;g.width=null==b?F(1===d.length?c.ye:c.xe):F(Fc(b,0===f,c));e+=F(g);return c.Da.width});if(0===a.R.length||!b&&null!==a.R[a.R.length-1])c.Da.width=F(0===a.R.length?c.ye:c.xe),d.push(c.Da.width),e+=F(c.Da);b=F(c.Bb);var f=[],g=0;f=a.actions.map(function(b,d){var e=a.error&&!a.error.g&&(0===a.error.b.length||0<=a.error.b.indexOf(d))?a.error.Fb?c.fd:
c.ed:c.Da;e.width=null==b?F(1===f.length?c.we:c.ve):F(Fc(b,0===d,c));g+=F(e);return F(e)});if(0===a.actions.length||null!==a.actions[a.actions.length-1])c.Da.width=F(0===a.actions.length?c.we:c.ve),f.push(c.Da.width),g+=F(c.Da);return{total:e+b+g,R:d,zf:e,$g:b,actions:f,Mg:g}}function Fc(a,b,c){switch(a.S.type){case "e":return b?c.lc:c.$b;case "a":return c.wc;case "s":return c.xg;case "c":return c.vg;default:throw"internal";}}
function Gc(a,b){switch(a.verticalAlign){case "middle":return(b.height-a.ma())/2;case "bottom":return b.height-a.ma();case "top":return 0;default:return b.height-a.ma()-a.verticalAlign}}
function Hc(a,b,c,d,e,f,g,h,l){var m=f,r=Ec(c,d,l),k=a.i,q=0<c.R.length&&"e"===c.R[0].S.type?l.lc:l.$b,n=new yc(c,Ic(l.Ga),Jc(l.Ga),m-l.Ga.paddingLeft-l.Da.offsetLeft()-q.offsetLeft(),h-l.Ga.paddingTop-l.Da.offsetTop()-q.offsetTop(),function(a,b,d,h){var n=a.I;fc(l.Ga,n,b.x+d,b.y+h,!0);fc(l.Bb,n,g-l.Bb.width-l.Bb.marginRight-l.Bb.paddingRight-l.Da.offsetLeft()-l.wc.offsetLeft()+d,b.y+(Jc(l.Ga)-l.Bb.height)/2+h);Kc(a,"vpl:then",g-F(l.Bb)/2-l.Da.offsetLeft()-l.wc.offsetLeft()+d,b.y+Jc(l.Ga)/2+h,l.Bb);
c.locked&&Ac(a,b.x,b.y,b.width,b.height,!1,c.disabled?"#ddd":"");var m=b.x+d+l.Ga.paddingLeft;0<e&&(m+=e-r.zf);u.forEach(function(a,d){var e=c.error&&c.error.g&&(0===c.error.l.length||0<=c.error.l.indexOf(d))?c.error.Fb?l.fd:l.ed:l.Da;e.width=null==a?F(1===u.length?l.ye:l.xe):F(Fc(a,0===d,l));fc(e,n,m+e.marginLeft,b.y+h+l.Ga.paddingTop+l.Da.marginTop,!0);m+=F(e)});m=b.x+d+l.Ga.paddingLeft+g-f;y.forEach(function(a,d){var e=c.error&&!c.error.g&&(0===c.error.b.length||0<=c.error.b.indexOf(d))?c.error.Fb?
l.fd:l.ed:l.Da;e.width=null==a?F(1===y.length?l.we:l.ve):F(Fc(a,0===d,l));fc(e,n,m+e.marginLeft,b.y+h+l.Ga.paddingTop+l.Da.marginTop,!0);m+=F(e)})},null,function(a,c){if(c.data instanceof ua){a=k.i.indexOf(a.data);var d=k.i.indexOf(c.data);0<=a&&0<=d&&(k.zb(),k.i.splice(d,1),k.i.splice(a,0,c.data))}else c.data instanceof z&&(k.zb(),va(a.data,c.data,null,function(){k.zb()}));b.la&&b.la()},function(a,b){return b.data instanceof ua?b.data!==a.data:b.data.yb!==a.data&&("a"===k.mode||0===a.data.R.length||
b.data instanceof z&&"a"===b.data.S.type)});c.disabled&&(n.g=function(a,c,d,e){oc(b,c.x+d,c.y+e,c.width,c.height,["rule"],["rule"])});if(a.ga||a.readOnly)n.l=!1;Bc(b,n);var p,u=c.R;if(0===u.length||!d&&null!==u[u.length-1])u=u.concat(null);m=f;0<e&&(m+=e-r.zf);u.forEach(function(a,d){var e=a?Fc(a,0===d,l):1===u.length?l.ye:l.xe,f=c.error&&c.error.g&&(0===c.error.l.length||0<=c.error.l.indexOf(d))?c.error.Fb?l.fd:l.ed:l.Da,g=Gc(e,f);a?(f.width=F(e),p=xc(this,b,a,e,m,h+g,{Oe:c.disabled||this.ga||this.readOnly,
Me:c.disabled||this.ga||this.readOnly,oe:this.ga||this.readOnly})):(f.width=F(e),p=xc(this,b,new pa("e",c,{Oc:!0,index:d}),e,m,h+g,{Ne:c.disabled||this.readOnly,Me:!0,oe:!0}));n.P.push(p);m+=F(f)},a);var y=c.actions;if(0===y.length||null!==y[y.length-1])y=y.concat(null);m=g;y.forEach(function(a,d){var e=a?Fc(a,0==d,l):1===y.length?l.we:l.ve,f=c.error&&!c.error.g&&(0===c.error.b.length||0<=c.error.b.indexOf(d))?c.error.Fb?l.fd:l.ed:l.Da,g=Gc(e,f);a?(f.width=F(e),p=xc(this,b,a,Fc(a,0===d,l),m,h+g,{Oe:c.disabled||
this.ga||this.readOnly,Me:c.disabled||this.ga||this.readOnly,oe:this.ga||this.readOnly})):(f.width=F(e),p=xc(this,b,new pa("a",c,{Oc:!1,index:d}),e,m,h,{Ne:k.readOnly,Me:!0,oe:!0}));n.P.push(p);m+=F(f)},a);G(b,function(){if(null!==c.error){var a=c.error.Fb?l.sg:l.De;Kc(b,c.error.Fb?"vpl:warning":"vpl:error",f-l.Ga.paddingLeft-l.Ga.marginLeft-l.Da.offsetLeft()-q.offsetLeft()-a.width/2-a.marginRight-a.paddingRight,h+.5*q.height,a)}})}
function Lc(a,b,c,d,e,f){var g=f?e.sg:e.De;G(a,function(h){var l=Mc(a.Y,{tag:"conflict-line",aa:[f?"warning":"error"]}),m=b-e.Ga.paddingLeft-e.Ga.marginLeft-e.Da.offsetLeft()-e.lc.offsetLeft()-g.width/2-g.marginRight-g.paddingRight,r=c+(e.Da.height+g.height)/2,k=d+(e.Da.height-g.height)/2;h.beginPath();h.moveTo(m,r);h.lineTo(m,k);l.stroke(h);h.beginPath();h.arc(m,r,l.lineWidth,0,Math.PI);l.stroke(h);h.beginPath();h.arc(m,k,l.lineWidth,-Math.PI,0);l.stroke(h)})}
function Nc(a,b){var c={};a=a.i.L;c.Aa=H(b,{tag:"view",aa:["vpl"]});c.rg=H(b,{tag:"separator",aa:["vpl","top"]});c.qg=H(b,{tag:"separator",aa:["vpl","bottom"]});c.ic=H(b,{tag:"toolbar",aa:["vpl","top"]});c.qd=H(b,{tag:"toolbar",aa:["vpl","bottom"]});c.Ha=H(b,{tag:"vpl",id:"scrolling-vpl"});c.lc=H(b,{tag:"block",aa:["event","event-main"],gb:a?["small"]:[]});c.$b=H(b,{tag:"block",aa:["event","event-aux"],gb:a?["small"]:[]});c.wc=H(b,{tag:"block",aa:["action"],gb:a?["small"]:[]});c.xg=H(b,{tag:"block",
aa:["state"],gb:a?["small"]:[]});c.vg=H(b,{tag:"block",aa:["comment"],gb:a?["small"]:[]});c.Pg=H(b,{tag:"block",aa:["event","empty"],gb:a?["small"]:[]});c.ve=H(b,{tag:"block",aa:["action","empty"],gb:a?["small"]:[]});c.ye=H(b,{tag:"block",aa:["event","empty"],gb:a?["only-child","small"]:["only-child"]});c.xe=H(b,{tag:"block",aa:["event","event-aux","empty"],gb:a?["small"]:[]});c.we=H(b,{tag:"block",aa:["action","empty"],gb:a?["only-child","small"]:["only-child"]});c.Da=H(b,{tag:"block-container"});
c.ed=H(b,{tag:"block-container",aa:["error"]});c.fd=H(b,{tag:"block-container",aa:["warning"]});c.Ga=H(b,{tag:"rule",gb:a?["small"]:[]});c.Bb=H(b,{tag:"widget",id:"widget-then",gb:a?["small"]:[]});c.he=H(b,{tag:"block",aa:["library","event"]});c.Od=H(b,{tag:"block",aa:["library","action"]});c.yg=H(b,{tag:"block",aa:["library","state"]});c.wg=H(b,{tag:"block",aa:["library","comment"]});c.Ja=H(b,{tag:"block-library",aa:["event"]});c.Na=H(b,{tag:"block-library",aa:["action"]});c.De=H(b,{tag:"widget",
id:"widget-error",gb:a?["small"]:[]});c.sg=H(b,{tag:"widget",id:"widget-warning",gb:a?["small"]:[]});return c}function Tb(a){var b=a.wa,c=a.i;c.Rb(c.Ab);a.Xb="";a.Id=!1;if(!b.Ra)for(b=0;b<c.i.length;b++)if(c.i[b].error)if(c.i[b].error.Fb)a.Xb||(a.Xb=c.i[b].error.w,a.Id=!0);else{a.Xb=c.i[b].error.w;a.Id=!1;break}}function Oc(a,b,c,d,e,f){var g=new bc(a.ba);pc(g,a,b,c,a.i.jc||hc,a.i.te||mc);dc(g,d,f,e);return g}
function Db(a){function b(a,b){switch(b.type){case "e":return a.he;case "a":return a.Od;case "s":return a.yg;case "c":return a.wg;default:throw"internal";}}var c=a.wa,d=a.ba,e=a.i,f=Nc(a,d.Y);Pc(d);Tb(a);e.L=d.v.j<d.v.Yf;var g=Qc(d),h=d.state.Og,l=qc(a,a.P),m=Ta(e),r=0,k=0;e.i.forEach(function(a){a=Ec(a,m,f);r=Math.max(r,a.zf);k=Math.max(k,a.Mg)});var q=0,n=0;Ra.forEach(function(a){if(c.Ra||0<=("b"===e.mode?e.qc:e.oc).indexOf(a.name))switch(a.type){case "e":case "s":q++;break;case "a":case "c":n++}},
a);Rc(d,function(b,c,d){if(a.b.eb("vpl:trashcan",c)){b=A-f.Ga.offsetLeft()-f.Da.offsetLeft()-f.lc.offsetLeft();var e=F(f.Ga);if(d<b||d>b+e)return a.b.fb("vpl:trashcan",c),!0}return!1});var p=rc(a,a.va,["vpl","top"]),u=sc(p),y=rc(a,a.P,["vpl","bottom"]),I=sc(p);f.Aa.gc(g.width);f.Aa.Tb(g.height);f.Aa.setPosition(0,0);f.ic.gc(f.Aa.width);f.ic.height=u;f.ic.setPosition(f.Aa.x,f.Aa.y);f.Ja.Tb(f.Aa.height-f.ic.ma());var t=Math.max(Math.floor(f.Ja.height/f.he.ma()),1);u=f.Ja.scroll?1:Math.ceil(q/t);f.Ja.width=
u*F(f.he);f.Ja.setPosition(f.Aa.x,f.Aa.y+f.ic.ma());f.Na.Tb(f.Aa.height-f.ic.ma());var w=f.Na.scroll?1:Math.ceil(n/t);f.Na.width=w*F(f.Od);f.Na.setPosition(f.Aa.x+f.Aa.width-F(f.Na),f.Aa.y+f.ic.ma());f.qd.gc(f.Aa.width-F(f.Ja)-F(f.Na));f.qd.height=I;f.qd.setPosition(f.Aa.x+F(f.Ja),f.Aa.y+f.Aa.height-f.qd.ma());f.Ha.gc(f.Aa.width-F(f.Ja)-F(f.Na));f.Ha.Tb(f.Aa.height-f.ic.ma()-(l?f.qd.ma():0));f.Ha.setPosition(f.Aa.x+F(f.Ja),f.Aa.y+f.ic.ma());f.Da.width=f.ed.width=f.fd.width=F(f.lc);f.Da.height=f.ed.height=
f.fd.height=f.lc.ma();I=F(f.Bb);t=r+k+I;var A=f.Aa.x+(f.Aa.width-t+F(f.De))/2,sa=A+r+I;f.Ga.width=t;f.Ga.height=f.Da.ma();d.Ua=[];G(d,function(a){f.Aa.G(a)});ec(Oc(a,a.va,["vpl","top"],f.ic,f.rg,p),f.ic,p,wc(a));0<l&&ec(Oc(a,a.P,["vpl","bottom"],f.qd,f.qg,y),f.qd,y,wc(a));var mb=f.he.ma(),Ea=f.Od.ma(),Za=0,Aa=0;if(f.Ja.scroll){Za=F(f.he);h.b.Tb(q*mb);f.Ja.width=Za;f.Ja.height=f.Ja.height;h.b.resize(f.Ja.x,f.Ja.y,f.Ja.width,f.Ja.height);G(d,function(a){f.Ja.G(a)});h.b.vd(d);var ja=0;Ra.forEach(function(a){if(("e"===
a.type||"s"===a.type)&&(c.Ra||0<=("b"===e.mode?e.qc:e.oc).indexOf(a.name))){var g=b(f,a);Dc(this,d,a,g,f.Ja.x+g.offsetLeft(),f.Ja.y+g.offsetTop()+ja*mb);ja++}},a);h.b.end();G(d,function(){var a=H(d.Y,{tag:"widget",id:"widget-moreHigh"}),b=H(d.Y,{tag:"widget",id:"widget-moreLow"});Sc(h.b)||Kc(d,"vpl:moreHigh",f.Ja.x+f.Ja.width/2,f.Ja.y+a.ma()/2,a);Tc(h.b)||Kc(d,"vpl:moreLow",f.Ja.x+f.Ja.width/2,f.Ja.y+f.Ja.height-b.ma()/2,b)})}else{G(d,function(a){f.Ja.G(a)});Za=u*mb+Uc(f.Ja);var M=Math.ceil(q/u);
ja=0;Ra.forEach(function(g){if(("e"===g.type||"s"===g.type)&&(c.Ra||0<=("b"===e.mode?e.qc:e.oc).indexOf(g.name))){var h=b(f,g),l=f.Ja.x+h.offsetLeft()+Math.floor(ja/M)*mb,m=f.Ja.y+h.offsetTop()+ja%M*mb;Dc(a,d,g,h,l,m);ja++}},a)}f.Na.scroll?(Aa=F(f.Od),h.g.Tb(n*Ea),f.Na.width=Aa,f.Na.height=f.Na.height,h.g.resize(f.Na.x,f.Na.y,f.Na.width,f.Na.height),G(d,function(a){f.Na.G(a)}),h.g.vd(d),ja=0,Ra.forEach(function(a){if(("a"===a.type||"c"===a.type)&&(c.Ra||0<=("b"===e.mode?e.qc:e.oc).indexOf(a.name))){var g=
b(f,a);Dc(this,d,a,g,f.Na.x+f.Od.offsetLeft(),f.Na.y+f.Od.offsetTop()+ja*Ea);ja++}},a),h.g.end(),G(d,function(){var a=H(d.Y,{tag:"widget",id:"widget-moreHigh"}),b=H(d.Y,{tag:"widget",id:"widget-moreLow"});Sc(h.g)||Kc(d,"vpl:moreHigh",f.Na.x+f.Na.width/2,f.Na.y+a.ma()/2,a);Tc(h.g)||Kc(d,"vpl:moreLow",f.Na.x+f.Na.width/2,f.Na.y+f.Na.height-b.ma()/2,b)})):(G(d,function(a){f.Na.G(a)}),Aa=w*Ea+Uc(f.Na),M=Math.ceil(n/w),ja=0,Ra.forEach(function(g){if(("a"===g.type||"c"===g.type)&&(c.Ra||0<=("b"===e.mode?
e.qc:e.oc).indexOf(g.name))){var h=b(f,g),l=f.Na.x+h.offsetLeft()+f.Na.width-(w-Math.floor(ja/M))*Ea,m=f.Na.y+h.offsetTop()+ja%M*Ea;Dc(a,d,g,h,l,m);ja++}},a));if(c.Ra){(function(){var b=f.Da.kb();b.width=F(f.lc);var c=f.Da.kb();c.width=F(f.$b);var e=f.Da.kb();e.width=F(f.wc);var g=F(b)+F(c)+F(f.Bb)+F(e),h=f.Ga.kb();h.width=g;var l=f.Aa.x+(f.Aa.width-g)/2+(Za-Aa)/2-d.v.Gc/2,m=l+g-F(e);g=f.Ha.y+h.offsetTop()+b.offsetTop();var n=!1;g=new yc(a,Ic(h),Jc(h),l-h.paddingLeft-b.offsetLeft(),g-h.paddingTop-
b.offsetTop(),function(d,g,k,p){var t=d.I;fc(h,t,g.x+k,g.y+p,!0);fc(f.Bb,t,m-f.Bb.width-f.Bb.marginRight-f.Bb.paddingRight-f.Da.offsetLeft()-f.wc.offsetLeft()+k,g.y+(Jc(f.Ga)-f.Bb.height)/2+p);Kc(d,"vpl:then",m-F(f.Bb)/2-f.Da.offsetLeft()-f.wc.offsetLeft()+k,g.y+Jc(f.Ga)/2+p,f.Bb);var q=g.x+k+h.paddingLeft;fc(b,t,q+b.marginLeft,g.y+p+h.paddingTop+b.marginTop,!0);fc(f.lc,t,q+b.offsetLeft()+f.lc.marginLeft,g.y+p+h.paddingTop+b.offsetTop()+f.lc.marginTop+Gc(f.lc,b),!0);q+=F(b);fc(c,t,q+c.marginLeft,
g.y+p+h.paddingTop+c.marginTop,!0);fc(f.$b,t,q+b.offsetLeft()+f.$b.marginLeft,g.y+p+h.paddingTop+c.offsetTop()+f.$b.marginTop+Gc(f.$b,c),!0);!("a"===a.i.mode?a.i.b:a.i.g)^n&&oc(d,q+b.offsetLeft()+f.$b.marginLeft,g.y+p+h.paddingTop+c.offsetTop()+f.$b.marginTop+Gc(f.$b,c),f.$b.width,f.$b.height,["block"],["block"],!1);q=g.x+k+f.Ga.paddingLeft+m-l;fc(e,t,q+e.marginLeft,g.y+p+h.paddingTop+e.marginTop,!0);fc(f.wc,t,q+e.offsetLeft()+f.wc.marginLeft,g.y+p+h.paddingTop+e.offsetTop()+f.wc.marginTop+Gc(f.wc,
e),!0)},{Z:function(a){n=!0;E(a);return 0},Oa:function(a,b,c,d,e,f,g,h){c=a.b.getBoundingClientRect();b=h.x-c.left;h=h.y-c.top;n=b>=f&&b<f+d&&h>=g&&h<g+e;E(a)},Le:function(b){n&&("a"===a.i.mode?a.i.b=!a.i.b:a.i.g=!a.i.g);E(b)}},null,null);g.l=!1;Bc(d,g)})();var P=H(d.Y,{tag:"widget",id:"vpl-customize"});P.width=f.Ha.width/4;P.height=(f.Ha.height-f.Ga.ma())/4;G(d,function(){Kc(d,"vpl:customize",f.Ha.x+f.Ha.width/2,f.Ha.y+(f.Ha.height+f.Ga.ma())/2,P)})}else if(e.message)G(d,function(a){var b=e.message.split("\n"),
c=Math.min(14,g.height/b.length);a.font=c+"px sans-serif";a.textAlign="start";a.textBaseline="top";var d=f.Ha.x+c,h=f.Ha.y+c;b.forEach(function(b,e){a.fillText(b,d,h+1.2*c*e)})});else{l=F(f.Ga)+f.Ha.paddingLeft+f.Ha.paddingRight+F(f.De);h.l.gc(l);h.l.Tb(e.i.length*f.Ga.ma());h.l.resize(f.Ha.x,f.Ha.y,f.Ha.width,f.Ha.height);G(d,function(a){f.Ha.G(a)});h.l.vd(d);A+=(Za-Aa)/2-d.v.Gc/2;sa+=(Za-Aa)/2-d.v.Gc/2;l>f.Ha.width&&(A+=(l-f.Ha.width)/2+f.Ha.paddingLeft+f.Ha.marginLeft,sa+=(l-f.Ha.width)/2+f.Ha.paddingLeft+
f.Ha.marginLeft);var qa="";e.i.forEach(function(a,b){Hc(this,d,a,m,d.v.Tf?r:0,A,sa,f.Ha.y+f.Ga.ma()*b+f.Ga.offsetTop()+f.Da.offsetTop(),f);if(null!==a.error&&""===qa&&(qa=a.error.w,null!==a.error.o))for(var c=b+1;c<e.i.length;c++)if(e.i[c]===a.error.o){Lc(d,A,f.Ha.y+f.Ga.ma()*b+f.Ga.offsetTop()+f.Da.offsetTop(),f.Ha.y+f.Ga.ma()*c+f.Ga.offsetTop()+f.Da.offsetTop(),f,a.error.Fb);break}},a);h.l.end();e.ga&&G(d,function(){oc(d,f.Ha.x,f.Ha.y,f.Ha.width,f.Ha.height,["vpl"],["vpl"])})}a.L&&G(d,function(b){var c=
H(d.Y,{tag:"hint"});b.fillStyle=c.color;b.font=ic(c);b.textAlign="start";b.textBaseline="middle";var e=a.o.translate(a.L);c.width=b.measureText(e).width;c.height=1.2*c.fontSize;fc(c,b,c.marginLeft,g.height-c.ma()+c.marginTop,!0);b.fillText(e,c.offsetLeft(),g.height-c.ma()+c.offsetTop()+c.height/2)});G(d,function(a){a.font="9px sans-serif";a.textAlign="start";a.textBaseline="bottom";a.rotate(-Math.PI/2);a.fillText("EPFL 2018-2019",-g.height+d.v.ia,g.width-d.v.ia)});e.la&&e.la();E(d)};function Vc(){this.va={};this.l=[];this.L={px:1,cm:96/2.54,mm:96/25.4,"in":96,pc:16,pt:96/72};this.b=null}
function Wc(a,b,c){function d(){return b+" line "+r+" col "+k}function e(){for(;m<c.length;)if(" "===c[m]||"\t"===c[m])m++,k++;else if("\n"===c[m])m++,k=1,r++;else if("\r"===c[m])m++;else if("/*"===c.slice(m,m+2))for(m+=2,k+=2;m<c.length;)if("*/"===c.slice(m,m+2)){m+=2;k+=2;break}else m++,k++;else break}function f(){"\n"===c[m]?(k=1,r++):"\r"!==c[m]&&k++;m++}function g(){for(var a=0;m+a<c.length&&/[-_a-z0-9]/i.test(c[m+a]);)a++;m+=a;k+=a;return c.slice(m-a,m)}function h(){var a=new Xc;if(!/[a-z_.#*:]/i.test(c[m]))throw"Syntax error "+
d();for(/[a-z_]/i.test(c[m])?a.tag=g():"*"===c[m]&&f();;)if("#"===c[m]){if(a.id)throw"Multiple ids in selector "+d();f();a.id=g()}else if("."===c[m])f(),a.aa.push(g());else if(":"===c[m])f(),a.gb.push(g());else break;return a}function l(){for(var a=0;m+a<c.length&&";"!==c[m+a]&&"}"!==c[m+a];)"\n"===c[m]?(r++,k=1):"\r"!==c[m]&&k++,a++;m+=a;return c.slice(m-a,m).trim()}a.va[b]=c;for(var m=0,r=1,k=1;m<c.length;){e();if(m>=c.length)break;for(var q=[];;){q.push(h());e();if(","!==c[m])break;m++;k++;e()}if("{"!==
c[m])throw"Syntax error "+d();m++;k++;for(var n={};;){for(;;){e();if(";"!==c[m])break;m++}if(m>=c.length)throw"Unclosed block "+d();if("}"===c[m]){m++;k++;break}else if(!/[a-z_]/i.test(c[m]))throw"Syntax error "+d();var p=g();e();if(":"!==c[m])throw"Missing colon "+d();m++;k++;var u=l();n[p]=a.fa(p,u)}for(p=0;p<q.length;p++)a.l.push({xf:q[p],Fc:n})}}Vc.prototype.fa=function(a,b){return b};
function Yc(a,b){if(/^(max|min)\(.*\)$/.test(b))return a=b.slice(4,-1).split(",").map(function(a){return Yc(this,a)},a),new Zc(b.slice(0,3),a);b=/^(-?([0-9]+\.?|[0-9]*\.[0-9]+))([a-z]*|%)$/.exec(b);var c=1,d=$c;if(null==b)throw"Illegal length";if("%"===b[3])d=ad;else if(a.L.hasOwnProperty(b[3]))c=a.L[b[3]];else if("vw"===b[3])d=bd;else if("vh"===b[3])d=cd;else if("vmin"===b[3])d=dd;else if("vmax"===b[3])d=ed;else if("ww"===b[3])d=fd;else if("wh"===b[3])d=gd;else if("wmin"===b[3])d=hd;else if("wmax"===
b[3])d=id;else if(0==parseFloat(b[1]))c=0;else throw"Unknown length unit";return new jd(parseFloat(b[1])*c,d)}
var kd={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgreen:"#006400",
darkgrey:"#A9A9A9",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",
ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",green:"#008000",greenyellow:"#ADFF2F",grey:"#808080",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgreen:"#90EE90",lightgrey:"#D3D3D3",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",
lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",
moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",
seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32",transparent:"rgba(0,0,0,0)"};function jd(a,b){this.O=a;this.type=b?b:$c}
var $c="abs",ad="%",bd="vw",cd="vh",dd="vmin",ed="vmax",fd="ww",gd="wh",hd="wmin",id="wmax";
jd.prototype.N=function(a){switch(this.type){case $c:return this.O;case ad:return this.O*(a?a.w/100:1);case bd:return this.O*(a?a.g:1);case cd:return this.O*(a?a.b:1);case dd:return this.O*(a?Math.min(a.g,a.b):1);case ed:return this.O*(a?Math.max(a.g,a.b):1);case fd:return this.O*(a?a.o:1);case gd:return this.O*(a?a.l:1);case hd:return this.O*(a?Math.min(a.o,a.l):1);case id:return this.O*(a?Math.max(a.o,a.l):1);default:throw"internal";}};function Zc(a,b){jd.call(this,0);this.za=a;this.values=b}
Zc.prototype=Object.create(jd.prototype);Zc.prototype.constructor=Zc;Zc.prototype.N=function(a){switch(this.za){case "max":return this.values.reduce(function(b,c){return Math.max(b,c.N(a))},-Infinity);case "min":return this.values.reduce(function(b,c){return Math.min(b,c.N(a))},Infinity);default:throw"internal";}};function ld(a,b,c,d,e){this.w=a;this.g=b;this.b=c;this.o=d;this.l=e}function Xc(){this.id=this.tag=null;this.aa=[];this.gb=[]}
function md(a,b){a=a.id?"#"+a.id:(a.tag||"")+(a.aa&&0<a.aa.length?"."+a.aa.join("."):"")+(a.gb&&0<a.gb.length?":"+a.gb.join("."):"")||"*";b&&(a+="/"+Math.round(b.w).toString(10)+","+Math.round(b.g).toString(10)+","+Math.round(b.b).toString(10)+","+Math.round(b.o).toString(10)+","+Math.round(b.l).toString(10));return a}
Xc.prototype.match=function(a){if(a.tag&&this.tag&&a.tag!==this.tag||this.id&&this.id!==a.id)return!1;for(var b=0;b<this.aa.length;b++)if(void 0==a.aa||0>a.aa.indexOf(this.aa[b]))return!1;for(b=0;b<this.gb.length;b++)if(void 0==a.gb||0>a.gb.indexOf(this.gb[b]))return!1;return!0};function zb(){Vc.call(this);this.g=[];this.o={};this.w={};this.P="none hidden dotted dashed solid double".split(" ");this.Qa=["normal","italic","oblique"];this.jb=["normal","bold"]}zb.prototype=Object.create(Vc.prototype);zb.prototype.constructor=zb;zb.prototype.defineProperties=function(){for(var a=0;a<this.l.length;a++){var b=new nd;od(b,this.l[a].Fc);this.g.push({xf:this.l[a].xf,jg:b})}};
zb.prototype.fa=function(a,b){function c(a){try{Yc(e,a)}catch(n){return!1}return!0}function d(a){return kd.hasOwnProperty(a)||/^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(a)||/^rgba\([^()]*\)$/.test(a)}var e=this;b=b.replace(/\s+(?=[^()]*\))/g,"");switch(a){case "margin-left":case "margin-right":case "margin-top":case "margin-bottom":case "padding-left":case "padding-right":case "padding-top":case "padding-bottom":case "border-left-width":case "border-right-width":case "border-top-width":case "border-bottom-width":case "line-width":case "width":case "height":case "min-width":case "min-height":case "max-width":case "max-height":case "font-size":return Yc(this,
b);case "margin":case "padding":case "border-width":switch(a=b.replace(/ +/g," ").split(" ").map(function(a){return Yc(e,a)}),a.length){case 1:return[a[0],a[0],a[0],a[0]];case 2:return[a[0],a[1],a[0],a[1]];case 3:return[a[0],a[1],a[2],a[1]];case 4:return a;default:throw"Wrong number of lengths";}case "border-style":case "border-left-style":case "border-right-style":case "border-top-style":case "border-bottom-style":case "line-style":if(!(0<=e.P.indexOf(b)))throw"Unknown border style";return b;case "line-cap":if(!(0<=
["butt","round","square"].indexOf(b)))throw"Unknown line cap";return b;case "border-color":case "border-left-color":case "border-right-color":case "border-top-color":case "border-bottom-color":case "color":case "background-color":case "background":if(!d(b))throw"Unknown border color";return b;case "border-left":case "border-right":case "border-top":case "border-bottom":case "border":case "line":var f=null,g=null,h=null;b.replace(/ +/g," ").split(" ").forEach(function(a){if(d(a))f=a;else if(0<=e.P.indexOf(a))g=
a;else if(c(a))h=Yc(e,a);else throw"Illegal border property";});return{color:f,style:null===g&&(f||h)?"solid":g,width:null===h&&(f||g)?new jd(1):h};case "border-top-left-radius":case "border-top-right-radius":case "border-bottom-right-radius":case "border-bottom-left-radius":switch(a=b.replace(/ +/g," ").split(" ").map(function(a){return Yc(e,a)}),a.length){case 1:return[a[0],a[0]];case 2:return a;default:throw"Wrong number of radii";}case "border-radius":switch(a=b.split("/").map(function(a){a=a.replace(/ +/g,
" ").split(" ").map(function(a){return"/"===a?"/":Yc(e,a)});switch(a.length){case 1:return[a[0],a[0],a[0],a[0]];case 2:return[a[0],a[1],a[0],a[1]];case 3:return[a[0],a[1],a[2],a[1]];case 4:return a;default:throw"Wrong number of radii";}}),a.length){case 1:return a[0].concat(a[0]);case 2:return a[0].concat(a[1]);default:throw"Wrong number of radius dimensions";}case "font":var l="",m="",r=null,k="";b.replace(/ +/g," ").split(" ").forEach(function(a){if(null===r)if(c(a))r=Yc(e,a);else if(0<=e.Qa.indexOf(a))l=
a;else if(0<=e.jb.indexOf(a))m=a;else throw"Unknown font style "+a;else{if(""!==k)throw"Unexpected font style after font-family";k=a}});return{fontFamily:k,fontSize:r,fontStyle:l,fontWeight:m};case "box-shadow":case "line-shadow":return b=b.split(",")[0],a=b.replace(/ +/g," ").split(" "),"inset"===a[0]&&(a=a.slice(1)),3<=a.length&&5>=a.length?{offset:[Yc(this,a[0]),Yc(this,a[1])],color:a[a.length-1],ze:4<=a.length?Yc(this,a[2]):null,Re:5<=a.length?Yc(this,a[3]):null}:{};case "overflow":if(0>["wrap",
"scroll"].indexOf(b))throw"Unknown overflow mode";return b;case "vertical-align":return 0<=["top","middle","bottom"].indexOf(b)?b:Yc(this,b);default:return b}};function pd(a,b){for(var c=null,d=0;d<a.g.length;d++)if(a.g[d].xf.match(b)){if(c){var e=void 0;var f=a.g[d].jg;c=c.kb();for(e in f.Fc)f.Fc.hasOwnProperty(e)&&(c.Fc[e]=f.Fc[e]);e=c}else e=a.g[d].jg.kb();c=e}for(var g in c)c.hasOwnProperty(g)&&c[g]instanceof jd&&(c[g]=c[g].N(a.b));return c}
function H(a,b){var c=md(b,a.b);if(a.o[c])return a.o[c];b=pd(a,b);b=new qd(b,a.b);return a.o[c]=b}function Mc(a,b){var c=md(b,a.b);if(a.w[c])return a.w[c];b=pd(a,b);b=new rd(b,a.b);return a.w[c]=b}function nd(){this.Fc={}}function od(a,b){for(var c in b)b.hasOwnProperty(c)&&(a.Fc[c]=b[c])}nd.prototype.kb=function(){var a=new nd;od(a,this.Fc);return a};
function qd(a,b){this.marginBottom=this.marginTop=this.marginRight=this.marginLeft=this.y=this.x=this.height=this.width=0;this.pb=!0;this.nd=!1;this.borderBottomWidth=this.borderTopWidth=this.borderRightWidth=this.borderLeftWidth=0;this.borderBottomStyle=this.borderTopStyle=this.borderRightStyle=this.borderLeftStyle="none";this.borderBottomColor=this.borderTopColor=this.borderRightColor=this.borderLeftColor="black";this.borderTopLeftRadius=[0,0];this.borderTopRightRadius=[0,0];this.borderBottomRightRadius=
[0,0];this.borderBottomLeftRadius=[0,0];this.paddingBottom=this.paddingTop=this.paddingRight=this.paddingLeft=0;this.backgroundColor="transparent";this.color="black";this.fontFamily="sans-serif";this.fontSize=10;this.fontWeight=this.fontStyle="";this.scroll=!1;this.verticalAlign="middle";this.Gb=null;this.Gd=this.Wc=0;this.shadowColor=null;a&&sd(this,a.Fc,b)}qd.prototype=Object.create(nd.prototype);v=qd.prototype;v.constructor=qd;
function sd(a,b,c){var d=-1,e=-1,f=-1,g=-1,h=1E9,l=1E9,m;for(m in b)switch(m){case "margin-left":a.marginLeft=b[m].N(c);break;case "margin-right":a.marginRight=b[m].N(c);break;case "margin-top":a.marginTop=b[m].N(c);break;case "margin-bottom":a.marginBottom=b[m].N(c);break;case "border-left-width":a.borderLeftWidth=b[m].N(c);a.pb=!1;break;case "border-right-width":a.borderRightWidth=b[m].N(c);a.pb=!1;break;case "border-top-width":a.borderTopWidth=b[m].N(c);a.pb=!1;break;case "border-bottom-width":a.borderBottomWidth=
b[m].N(c);a.pb=!1;break;case "padding-left":a.paddingLeft=b[m].N(c);break;case "padding-right":a.paddingRight=b[m].N(c);break;case "padding-top":a.paddingTop=b[m].N(c);break;case "padding-bottom":a.paddingBottom=b[m].N(c);break;case "margin":a.marginTop=b[m][0].N(c);a.marginRight=b[m][1].N(c);a.marginBottom=b[m][2].N(c);a.marginLeft=b[m][3].N(c);break;case "border-width":a.borderTopWidth=b[m][0].N(c);"none"===a.borderTopStyle&&0<a.borderTopWidth&&(a.borderTopStyle=null);a.borderRightWidth=b[m][1].N(c);
"none"===a.borderRightStyle&&0<a.borderRightWidth&&(a.borderRightStyle=null);a.borderBottomWidth=b[m][2].N(c);"none"===a.borderBottomStyle&&0<a.borderBottomWidth&&(a.borderBottomStyle=null);a.borderLeftWidth=b[m][3].N(c);"none"===a.borderLeftStyle&&0<a.borderLeftWidth&&(a.borderLeftStyle=null);break;case "padding":a.paddingTop=b[m][0].N(c);a.paddingRight=b[m][1].N(c);a.paddingBottom=b[m][2].N(c);a.paddingLeft=b[m][3].N(c);break;case "border-style":a.borderLeftStyle=b[m];a.borderRightStyle=b[m];a.borderTopStyle=
b[m];a.borderBottomStyle=b[m];break;case "border-left-style":a.borderLeftStyle=b[m];a.pb=!1;break;case "border-right-style":a.borderRightStyle=b[m];a.pb=!1;break;case "border-top-style":a.borderTopStyle=b[m];a.pb=!1;break;case "border-bottom-style":a.borderBottomStyle=b[m];a.pb=!1;break;case "border-color":a.borderLeftColor=b[m];a.borderRightColor=b[m];a.borderTopColor=b[m];a.borderBottomColor=b[m];break;case "border-left-color":a.borderLeftColor=b[m];a.pb=!1;break;case "border-right-color":a.borderRightColor=
b[m];a.pb=!1;break;case "border-top-color":a.borderTopColor=b[m];a.pb=!1;break;case "border-bottom-color":a.borderBottomColor=b[m];a.pb=!1;break;case "border-left":null!==b[m].color&&(a.borderLeftColor=b[m].color);null!==b[m].style&&(a.borderLeftStyle=b[m].style);null!==b[m].width&&(a.borderLeftWidth=b[m].width.N(c));a.pb=!1;break;case "border-right":null!==b[m].color&&(a.borderRightColor=b[m].color);null!==b[m].style&&(a.borderRightStyle=b[m].style);null!==b[m].width&&(a.borderRightWidth=b[m].width.N(c));
a.pb=!1;break;case "border-top":null!==b[m].color&&(a.borderTopColor=b[m].color);null!==b[m].style&&(a.borderTopStyle=b[m].style);null!==b[m].width&&(a.borderTopWidth=b[m].width.N(c));a.pb=!1;break;case "border-bottom":null!==b[m].color&&(a.borderBottomColor=b[m].color);null!==b[m].style&&(a.borderBottomStyle=b[m].style);null!==b[m].width&&(a.borderBottomWidth=b[m].width.N(c));a.pb=!1;break;case "border":null!==b[m].color&&(a.borderLeftColor=a.borderRightColor=a.borderTopColor=a.borderBottomColor=
b[m].color);null!==b[m].style&&(a.borderLeftStyle=a.borderRightStyle=a.borderTopStyle=a.borderBottomStyle=b[m].style);null!==b[m].width&&(a.borderLeftWidth=a.borderRightWidth=a.borderTopWidth=a.borderBottomWidth=b[m].width.N(c));a.pb=!0;break;case "border-top-left-radius":a.borderTopLeftRadius=b[m].map(function(a){return a.N(c)});a.nd=!0;break;case "border-top-right-radius":a.borderTopRightRadius=b[m].map(function(a){return a.N(c)});a.nd=!0;break;case "border-bottom-right-radius":a.borderBottomRightRadius=
b[m].map(function(a){return a.N(c)});a.nd=!0;break;case "border-bottom-left-radius":a.borderBottomLeftRadius=b[m].map(function(a){return a.N(c)});a.nd=!0;break;case "border-radius":a.borderTopLeftRadius=[b[m][0].N(c),b[m][4].N(c)];a.borderTopRightRadius=[b[m][1].N(c),b[m][5].N(c)];a.borderBottomRightRadius=[b[m][2].N(c),b[m][6].N(c)];a.borderBottomLeftRadius=[b[m][3].N(c),b[m][7].N(c)];a.nd=!0;break;case "background-color":case "background":a.backgroundColor=b[m];break;case "color":a.color=b[m];break;
case "font":a.fontFamily=b[m].fontFamily;a.fontSize=b[m].fontSize.N(c);a.fontStyle=b[m].fontStyle;a.fontWeight=b[m].fontWeight;break;case "font-family":a.fontFamily=b[m];break;case "font-size":a.fontSize=b[m].N(c);break;case "font-style":a.fontStyle=b[m];break;case "font-weight":a.fontWeight=b[m];break;case "overflow":a.scroll="scroll"===b[m];break;case "vertical-align":a.verticalAlign=b[m]instanceof jd?b[m].N(c):b[m];break;case "box-shadow":null!==b[m].Gb&&(a.Gb=b[m].offset.map(function(a){return a?
a.N(c):0}),a.Wc=b[m].ze?b[m].ze.N(c):0,a.Gd=b[m].Re?b[m].Re.N(c):0,a.shadowColor=b[m].color);break;case "width":d=b[m].N(c);break;case "min-width":f=b[m].N(c);break;case "max-width":h=b[m].N(c);break;case "height":e=b[m].N(c);break;case "min-height":g=b[m].N(c);break;case "max-height":l=b[m].N(c)}d=Math.max(Math.min(d,h),f);e=Math.max(Math.min(e,l),g);0<=d&&(a.width=d);0<=e&&(a.height=e)}v.setPosition=function(a,b){this.x=a+this.offsetLeft();this.y=b+this.offsetTop()};
function F(a){return a.width+Uc(a)}v.ma=function(){return this.height+(this.marginTop+this.borderTopWidth+this.paddingTop+this.paddingBottom+this.borderBottomWidth+this.marginBottom)};v.gc=function(a){this.width=a-(this.marginLeft+this.borderLeftWidth+this.paddingLeft+this.paddingRight+this.borderRightWidth+this.marginRight)};v.Tb=function(a){this.height=a-(this.marginTop+this.borderTopWidth+this.paddingTop+this.paddingBottom+this.borderBottomWidth+this.marginBottom)};
v.kb=function(){var a=new qd;a.width=this.width;a.height=this.height;a.x=this.x;a.y=this.y;a.marginLeft=this.marginLeft;a.marginRight=this.marginRight;a.marginTop=this.marginTop;a.marginBottom=this.marginBottom;a.pb=this.pb;a.nd=this.nd;a.borderLeftWidth=this.borderLeftWidth;a.borderRightWidth=this.borderRightWidth;a.borderTopWidth=this.borderTopWidth;a.borderBottomWidth=this.borderBottomWidth;a.borderLeftStyle=this.borderLeftStyle;a.borderRightStyle=this.borderRightStyle;a.borderTopStyle=this.borderTopStyle;
a.borderBottomStyle=this.borderBottomStyle;a.borderLeftColor=this.borderLeftColor;a.borderRightColor=this.borderRightColor;a.borderTopColor=this.borderTopColor;a.borderBottomColor=this.borderBottomColor;a.borderTopLeftRadius=this.borderTopLeftRadius;a.borderTopRightRadius=this.borderTopRightRadius;a.borderBottomRightRadius=this.borderBottomRightRadius;a.borderBottomLeftRadius=this.borderBottomLeftRadius;a.paddingLeft=this.paddingLeft;a.paddingRight=this.paddingRight;a.paddingTop=this.paddingTop;a.paddingBottom=
this.paddingBottom;a.backgroundColor=this.backgroundColor;a.color=this.color;a.fontFamily=this.fontFamily;a.fontSize=this.fontSize;a.fontStyle=this.fontStyle;a.fontWeight=this.fontWeight;a.scroll=this.scroll;a.verticalAlign=this.verticalAlign;a.Gb=this.Gb;a.Wc=this.Wc;a.Gd=this.Gd;a.shadowColor=this.shadowColor;return a};v.offsetLeft=function(){return this.marginLeft+this.borderLeftWidth+this.paddingLeft};
function Uc(a){return a.marginLeft+a.borderLeftWidth+a.paddingLeft+a.paddingRight+a.borderRightWidth+a.marginRight}v.offsetTop=function(){return this.marginTop+this.borderTopWidth+this.paddingTop};function Ic(a){return a.width+a.paddingLeft+a.paddingRight}function Jc(a){return a.height+a.paddingTop+a.paddingBottom}function ic(a){return(a.fontStyle?a.fontStyle+" ":"")+(a.fontWeight?a.fontWeight+" ":"")+a.fontSize.toFixed(1)+"px "+a.fontFamily}
function rd(a,b){this.margin=0;this.Rd=this.style=this.width=null;this.color="black";this.Gb=null;this.Gd=this.Wc=0;this.shadowColor=null;a&&td(this,a.Fc,b);null===this.width&&(this.width=null!==this.style&&"none"!==this.style?1:0);null===this.style&&(this.style=0<this.width?"solid":"none");null===this.Rd&&(this.Rd="butt")}rd.prototype=Object.create(nd.prototype);rd.prototype.constructor=rd;
function td(a,b,c){for(var d in b)switch(d){case "margin":a.margin=b[d].N(c);break;case "line-width":a.width=b[d].N(c);break;case "line-style":a.style=b[d];break;case "line-cap":a.Rd=b[d];break;case "color":a.color=b[d];break;case "line":null!==b[d].color&&(a.color=b[d].color);null!==b[d].style&&(a.style=b[d].style);null!==b[d].width&&(a.width=b[d].width.N(c));break;case "line-shadow":null!==b[d].Gb&&(a.Gb=b[d].offset.map(function(a){return a?a.N(c):0}),a.Wc=b[d].ze?b[d].ze.N(c):0,a.Gd=b[d].Re?b[d].Re.N(c):
0,a.shadowColor=b[d].color)}}rd.prototype.kb=function(){var a=new rd;a.margin=this.margin;a.width=this.width;a.style=this.style;a.Rd=this.Rd;a.color=this.color;a.Gb=this.Gb;a.Wc=this.Wc;a.Gd=this.Gd;a.shadowColor=this.shadowColor;return a};var ud=!1;function vd(a,b,c,d){a.strokeStyle=c||"black";switch(d){case "dotted":a.setLineDash([2*b,3*b]);a.lineDashOffset=0;break;case "dashed":a.setLineDash([3*b,3*b]),a.lineDashOffset=0}a.lineWidth=b||0}
function fc(a,b,c,d,e){function f(){var a=Math.min(g.borderTopLeftRadius[0],h/2),e=Math.min(g.borderTopLeftRadius[1],l/2);b.moveTo(c,d+e);b.bezierCurveTo(c,d+e/2,c+a/2,d,c+a,d);a=Math.min(g.borderTopRightRadius[0],h/2);e=Math.min(g.borderTopRightRadius[1],l/2);b.lineTo(c+h-a,d);b.bezierCurveTo(c+h-a/2,d,c+h,d+e/2,c+h,d+e);a=Math.min(g.borderBottomRightRadius[0],h/2);e=Math.min(g.borderBottomRightRadius[1],l/2);b.lineTo(c+h,d+l-e);b.bezierCurveTo(c+h,d+l-e/2,c+h-a/2,d+l,c+h-a,d+l);a=Math.min(g.borderBottomLeftRadius[0],
h/2);e=Math.min(g.borderBottomLeftRadius[1],l/2);b.lineTo(c+a,d+l);b.bezierCurveTo(c+a/2,d+l,c,d+l-e/2,c,d+l-e);b.closePath()}e||(c-=a.paddingLeft,d-=a.paddingTop);var g=a,h=a.width+a.paddingLeft+a.paddingRight,l=a.height+a.paddingTop+a.paddingBottom;ud&&(b.save(),b.strokeStyle="black",b.lineWidth=1,b.strokeRect(c,d,h,l),b.strokeRect(c+a.paddingLeft,d+a.paddingTop,a.width,a.height),b.strokeRect(c-a.marginLeft,d-a.marginTop,h+a.marginLeft+a.marginRight,l+a.marginTop+a.marginBottom),b.restore());b.save();
b.beginPath();a.nd?(b.beginPath(),f()):b.rect(c,d,h,l);b.save();a.Gb&&(b.shadowOffsetX=a.Gb[0],b.shadowOffsetY=a.Gb[1],b.shadowColor=a.shadowColor,b.shadowBlur=a.Wc);a.backgroundColor?b.fillStyle=a.backgroundColor:a.Gb&&(b.fillStyle="transparent");b.fill();b.restore();a.pb?0<a.borderLeftWidth&&a.borderLeftColor&&"none"!==a.borderLeftStyle&&"hidden"!==a.borderLeftStyle&&(vd(b,a.borderLeftWidth,a.borderLeftColor,a.borderLeftStyle),"double"===a.borderLeftStyle&&(b.save(),b.translate(c+h/2,d+l/2),b.scale((h-
3*a.borderLeftWidth)/h,(l-3*a.borderLeftWidth)/l),b.translate(-c-h/2,-d-l/2),f(),b.restore()),b.stroke()):(0<a.borderLeftWidth&&a.borderLeftColor&&"none"!==a.borderLeftStyle&&"hidden"!==a.borderLeftStyle&&(vd(b,a.borderLeftWidth,a.borderLeftColor,a.borderLeftStyle),b.beginPath(),b.moveTo(c,d),b.lineTo(c,d+l),b.stroke()),0<a.borderRightWidth&&a.borderRightColor&&"none"!==a.borderRightStyle&&"hidden"!==a.borderRightStyle&&(vd(b,a.borderRightWidth,a.borderRightColor,a.borderRightStyle),b.beginPath(),
b.moveTo(c+h,d),b.lineTo(c+h,d+l),b.stroke()),0<a.borderTopWidth&&a.borderTopColor&&"none"!==a.borderTopStyle&&"hidden"!==a.borderTopStyle&&(vd(b,a.borderTopWidth,a.borderTopColor,a.borderTopStyle),b.beginPath(),b.moveTo(c,d),b.lineTo(c+h,d),b.stroke()),0<a.borderBottomWidth&&a.borderBottomColor&&"none"!==a.borderBottomStyle&&"hidden"!==a.borderBottomStyle&&(vd(b,a.borderBottomWidth,a.borderBottomColor,a.borderBottomStyle),b.beginPath(),b.moveTo(c,d+l),b.lineTo(c+h,d+l),b.stroke()));b.restore()}
qd.prototype.G=function(a){fc(this,a,this.x,this.y)};rd.prototype.stroke=function(a){a.save();this.Gb&&(a.shadowOffsetX=this.Gb[0],a.shadowOffsetY=this.Gb[1],a.shadowColor=this.shadowColor,a.shadowBlur=this.Wc);0<this.width&&this.color&&"none"!==this.style&&"hidden"!==this.style&&(vd(a,this.width,this.color,this.style),a.lineCap=this.Rd,a.stroke());a.restore()};function yc(a,b,c,d,e,f,g,h,l,m){this.data=a;this.width=b;this.height=c;this.x=d;this.y=e;this.b=null;this.P=[];this.o=f;this.g=null;this.l=this.va=!0;this.fa=null;this.Bc=g||null;this.fb=h||null;this.eb=l||null;this.cf=this.Qa=!1;this.L=this.doScroll=null;this.id=m||"";this.Ud=this.la=this.w=null}yc.prototype.clone=function(){var a=new yc(this.data,this.width,this.height,this.x,this.y,this.o,this.Bc,this.fb,this.eb,this.id);a.g=this.g;return a};
yc.prototype.G=function(a,b,c,d){var e=a.I,f=this.b&&void 0===b;f&&(e.save(),e.beginPath(),e.rect(this.b.x,this.b.y,this.b.Ic,this.b.zc),e.clip(),b=this.b.Ff,c=this.b.Gf);d?this.g&&this.g(a,this,b||0,c||0):this.o&&this.o(a,this,b||0,c||0);f&&e.restore()};yc.prototype.toDataURL=function(a,b,c){var d=document.createElement("canvas");b=b||1;d.width=b*this.width;d.height=b*this.height;b=new Ab(d,{cg:b});b.v=a;this.G(b);this.G(b,0,0,!0);return d.toDataURL(c||"image/png")};
function wd(a){return a.b?{Cb:a.b.Ff,Db:a.b.Gf}:{Cb:0,Db:0}}
function Ab(a,b){function c(a){function b(a){var b=e.b.getBoundingClientRect(),f=wd(a);a.Ud=a.Bc.Z(e,a.data,a.width,a.height,b.left+a.x+f.Cb,b.top+a.y+f.Db,c);return null!==a.Ud?(a.Bc.Oa&&a.Bc.Oa(e,a.data,a.Ud,a.width,a.height,b.left+a.x+f.Cb,b.top+a.y+f.Db,c),e.la&&e.la(),e.lb?e.lb():E(e),xd=a.Bc.Oa?function(c,g){g?a.Bc.Le&&(a.Bc.Le(e,a.data,a.Ud),e.la&&e.la(),e.lb?e.lb():E(e)):(a.Bc.Oa(e,a.data,a.Ud,a.width,a.height,b.left+a.x+f.Cb,b.top+a.y+f.Db,yd(e,c,d)),e.la&&e.la(),e.lb?e.lb():E(e))}:null,
e.la&&e.la(),e.lb?e.lb():E(e),!0):!1}if(e.P){var c=yd(e,a,d);if(zd(e,c)){var f=e.vb;f.Bc&&b(f)}else if(e.vb)e.w=-1,e.vb=null,e.la&&e.la(),e.lb?e.lb():E(e);else{var m=Ad(e,c,!0);if(0<m.length){if(f=e.Ua[m[0]],0<=e.w&&e.w!==m[0]&&(e.w=-1,e.vb=null),e.wb=Date.now(),(!f.Bc||f.w&&e.w!==m[0]||!b(f))&&f.l){var r=f.fa?f.fa(f):f,k=null;a=wd(r);var q=c.x-a.Cb,n=c.y-a.Db;xd=function(a,b){var c=yd(e,a,d);if(b){if(f.w&&f===e.Ua[Ad(e,c,!1)[0]])e.w=m[0],e.vb=f.w(f);else if(k&&k.fb&&(!k.eb||k.eb(k,r)))k.fb(k,r);
else if(null==k||null==k.fb||k.eb&&!k.eb(k,r))for(b=0;b<e.va.length&&!e.va[b].fb(k,r,c.x,c.y);b++);E(e);e.b.style.cursor="default"}else{var g=Ad(e,c,!1);k=null;a=!1;for(b=0;!a&&b<g.length;b++)k=e.Ua[g[b]],a=k.fb&&(!k.eb||k.eb(k,r));a&&null!=k?(k.cf=!0,E(e),k.cf=!1):E(e);b=e.I;a&&!k.Qa&&(g=wd(k),Bd(e,k.x+g.Cb,k.y+g.Db,k.width,k.height,["drop-target"]));b.save();Cd(e);e.transform&&(b.translate(e.width/2,e.height/2),CanvasRenderingContext2D.prototype.transform.apply(b,e.transform),b.translate(-e.width/
2,-e.height/2));b.translate(e.l*e.sa.U,e.g*e.sa.V);b.globalAlpha=.5;r.G(e,c.x-q,c.y-n);r.P.forEach(function(a){a.G(e,c.x-q,c.y-n);a.G(e,c.x-q,c.y-n,!0)});r.G(e,c.x-q,c.y-n,!0);b.restore();e.b.style.cursor=a?"copy":"default"}}}}else 0<=e.w&&(e.w=-1,e.vb=null,E(e))}}}var d=b&&b.cg||("devicePixelRatio"in window?window.devicePixelRatio:1);this.b=a;this.l=a.width/d;this.g=a.height/d;this.sa=b&&b.sa||{U:0,na:1,V:0,ka:1};this.width=this.l*(this.sa.na-this.sa.U);this.height=this.g*(this.sa.ka-this.sa.V);
this.P=!0;this.transform=this.jb=null;this.I=this.b.getContext("2d");this.Qa=this.state=null;this.va=[];this.wb=0;this.w=-1;this.vb=null;this.o={};this.clientData={};this.Y=b&&b.Y||new zb;this.v=null;this.resize(this.width,this.height,b&&b.cg);this.fa={};var e=this;a.addEventListener("mousedown",c,!1);a.addEventListener("touchstart",function(a){var b=a.targetTouches;1===b.length&&(a.preventDefault(),c(b[0]),Dd=b[0])},!1);a.addEventListener("wheel",function(a){function b(b){b.doScroll&&(a.preventDefault(),
b.doScroll(0===a.deltaMode?a.deltaX:1===a.deltaMode?10*a.deltaX:30*a.deltaX,0===a.deltaMode?a.deltaY:1===a.deltaMode?10*a.deltaY:30*a.deltaY))}if(e.P){var c=yd(e,a,d);if(zd(e,c))e.vb&&b(e.vb);else if(0>e.w){c=Ad(e,c,!0);for(var f=0;f<c.length;f++)if(null!=e.Ua[c[f]].doScroll){b(e.Ua[c[f]]);break}}}},!1);a.addEventListener("mousemove",function(a){if(e.P){var b=yd(e,a,d);b=Ad(e,b,!0);for(var c=0;c<b.length;c++)if(null!=e.Ua[b[c]].L){a.preventDefault();e.Ua[b[c]].L();return}e.Qa&&e.Qa()}},!1);this.Ua=
[];this.L=[];this.lb=this.la=null}function Nb(a,b){a.sa=b||{U:0,na:1,V:0,ka:1};a.width=a.l*(a.sa.na-a.sa.U);a.height=a.g*(a.sa.ka-a.sa.V)}function Rc(a,b){for(var c=0;c<a.va.length;c++)if("delete"===a.va[c].tag){a.va[c].fb=b;return}a.va.push({tag:"delete",fb:b})}Ab.prototype.show=function(){this.P=!0};Ab.prototype.sc=function(){this.P=!1};function Ed(a,b){a.b.style.filter=b}function Gd(a,b){a.jb=b&&b.slice();a.transform=a.jb}
function yd(a,b,c){var d=a.b.getBoundingClientRect();b={x:b.clientX*a.b.width/c/d.width,y:b.clientY*a.b.height/c/d.height,Fg:b.altKey};c=[b.x,b.y];c=[c[0]-a.l*a.sa.U,c[1]-a.g*a.sa.V];if(d=a.transform){var e=a.width/2;a=a.height/2;d=d.slice(0,4).concat(d[4]-e*d[0]-a*d[2]+e,d[5]-e*d[1]-a*d[3]+a);a=d[0]*d[3]-d[1]*d[2];a=[(d[3]*c[0]-d[2]*c[1]+d[2]*d[5]-d[3]*d[4])/a,(-d[1]*c[0]+d[0]*c[1]+d[1]*d[4]-d[0]*d[5])/a]}else a=c;b.x=a[0];b.y=a[1];return b}function Hd(a){a.la&&a.la();a.lb?a.lb():E(a)}
function zc(a,b){return{j:a,Yf:60,Tf:!1,ia:Math.max(1,Math.min(3,Math.round(a/40))),Mf:Math.round(a/4).toString(10)+"px sans-serif",Sg:"navy",Tg:"#37f",Rg:"#06f",c:b,ra:Math.max(1,Math.min(3,b/30)),zg:"bold 15px sans-serif",wf:"navy",vf:"#ccc",Gc:5,df:"#e44",Ef:"#f88",uf:"#bbb"}}
function Pc(a,b){a.width=a.l*(a.sa.na-a.sa.U);a.height=a.g*(a.sa.ka-a.sa.V);a.I=a.b.getContext("2d");b=b||("devicePixelRatio"in window?window.devicePixelRatio:1);1!=b&&(a.I.resetTransform(),a.I.scale(b,b));a.Y.b=new ld(a.width,a.width/100,a.height/100,a.l/100,a.g/100);b=H(a.Y,{tag:"block"}).width;var c=H(a.Y,{tag:"button"}).width;a.v=zc(b,c)}
Ab.prototype.resize=function(a,b,c){var d=c||("devicePixelRatio"in window?window.devicePixelRatio:1);this.b.width=a*d;this.b.height=b*d;this.l=a;this.g=b;Pc(this,c)};function Cc(a,b){for(var c=0;c<a.Ua.length;c++)if(a.Ua[c].data===b)return c;return-1}
function Ad(a,b,c){var d=a.b.getBoundingClientRect(),e=b.x-d.left;b=b.y-d.top;d=[];for(var f=a.Ua.length-1;0<=f;f--){var g=wd(a.Ua[f]);if(g=(!c||a.Ua[f].va)&&e>=a.Ua[f].x+g.Cb&&e<=a.Ua[f].x+g.Cb+a.Ua[f].width&&b>=a.Ua[f].y+g.Db&&b<=a.Ua[f].y+g.Db+a.Ua[f].height)g=a.Ua[f],g=!g.b||e>=g.b.x&&e<g.b.x+g.b.Ic&&b>=g.b.y&&b<g.b.y+g.b.zc;g&&d.push(f)}return d}
function ac(a,b){var c=b.clone();a=Qc(a);var d=Math.min(a.width,a.height)/1.5/c.width;c.width*=d;c.height*=d;c.x=(a.width-c.width)/2;c.y=(a.height-c.height)/2;c.w=null;c.o=function(a,f){var e=a.I;e.save();e.translate(f.x,f.y);e.scale(d,d);e.translate(-f.x,-f.y);b.o(a,c,f.x-c.x,f.y-c.y);e.restore()};b.g&&(c.g=function(a,f){var e=a.I;e.save();e.translate(f.x,f.y);e.scale(d,d);e.translate(-f.x,-f.y);b.g(a,c,f.x-c.x,f.y-c.y);e.restore()});return c}
function zd(a,b){if(null==a.vb)return!1;var c=a.b.getBoundingClientRect(),d=b.x-c.left;b=b.y-c.top;return d>=a.vb.x&&d<=a.vb.x+a.vb.width&&b>=a.vb.y&&b<=a.vb.y+a.vb.height}function Qc(a){return{width:a.width,height:a.height}}function Cd(a){a.I.beginPath();a.I.rect(a.l*a.sa.U,a.g*a.sa.V,a.l*(a.sa.na-a.sa.U),a.g*(a.sa.ka-a.sa.V));a.I.clip()}
function Id(a,b,c,d,e,f,g){f=f||0;g=g||0;if(0<a.L.length){var h=a.L[a.L.length-1];h.x>b&&(d-=h.x-b,b=h.x);h.x+h.Ic<b+d&&(d=h.x+h.Ic-b);h.y>c&&(e-=h.y-c,c=h.y);h.y+h.zc<c+e&&(e=h.y+h.zc-c);f+=h.Ff;g+=h.Gf}a.L.push({x:b,y:c,Ic:d,zc:e,Ff:f,Gf:g})}function Bc(a,b,c){0<a.L.length&&(b.b=a.L[a.L.length-1]);0<=c?a.Ua[c]=b:a.Ua.push(b)}function G(a,b){var c=new yc(null,-1,-1,0,0,function(a,c,f,g){a=a.I;a.save();a.translate(c.x+f,c.y+g);b(a);a.restore()});Bc(a,c);return c}
function gc(a,b,c,d,e,f,g,h,l,m){var r,k=new yc(null,d.width,d.height,b,c,function(b,c,f,g){b=b.I;b.save();fc(d,b,c.x+f,c.y+g);b.translate(c.x+f,c.y+g);e(b,d,a.o.id===m&&a.o.jd||c.cf);b.restore()},f?{Z:function(b,c,d,e,f,g,h){a.o={id:m,rect:{x:k.x,y:k.y,Ic:d,zc:e},jd:!0};r=h;E(a);return 0},Oa:function(b,c,d,e,f,g,h,l){d=b.b.getBoundingClientRect();c=l.x-d.left;l=l.y-d.top;a.o.jd=c>=a.o.rect.x&&c<a.o.rect.x+a.o.rect.Ic&&l>=a.o.rect.y&&l<a.o.rect.y+a.o.rect.zc;E(b)},Le:function(){a.o.jd&&f(r);a.o={};
E(a)}}:null,g,h,m);k.L=l||null;k.l=!1;k.Qa=!0;Bc(a,k);return k}function Kc(a,b,c,d,e){fc(e,a.I,c-e.width/2,d-e.height/2);var f=a.fa[b];void 0!=f&&(a.I.save(),a.I.translate(c,d),f(a.I,b,a.v,e),a.I.restore())}
function E(a){a.P&&(a.I.clearRect(a.l*a.sa.U,a.g*a.sa.V,a.l*(a.sa.na-a.sa.U),a.g*(a.sa.ka-a.sa.V)),a.I.save(),a.transform&&(a.I.translate(a.width/2,a.height/2),CanvasRenderingContext2D.prototype.transform.apply(a.I,a.transform),a.I.translate(-a.width/2,-a.height/2)),a.I.translate(a.l*a.sa.U,a.g*a.sa.V),a.Ua.forEach(function(a){a.G(this)},a),a.Ua.forEach(function(a){a.G(this,void 0,void 0,!0)},a),a.vb&&(a.I.save(),a.I.globalAlpha=.5,a.I.fillStyle="black",a.I.fillRect(a.l*a.sa.U,a.g*a.sa.V,a.l*(a.sa.na-
a.sa.U),a.g*(a.sa.ka-a.sa.V)),a.I.restore(),a.vb.G(a),a.vb.G(a,0,0,!0)),a.I.restore())};function uc(){this.w=this.L=1;this.b=this.g=this.y=this.x=0;this.P=!1;this.va="";this.Kd=this.l=this.Jd=this.o=0;this.fa=null}v=uc.prototype;v.gc=function(a){this.L=a;this.o=Math.max(0,Math.min(this.o,this.L-this.g))};v.Tb=function(a){this.w=a;this.l=Math.max(0,Math.min(this.l,this.w-this.b))};v.resize=function(a,b,c,d){this.x=a;this.y=b;this.g=c;this.b=d;this.o=Math.max(0,Math.min(this.o,this.L-this.g));this.l=Math.max(0,Math.min(this.l,this.w-this.b))};
v.vd=function(a){this.fa=a;var b=this,c=new yc(null,this.g,this.b,this.x,this.y,null,this.L>this.g||this.w>this.b?{Z:function(a,c,f,g,h,l,m){b.Jd=m.x;b.Kd=m.y;return 0},Oa:function(a,c,f,g,h,l,m,r){a=Math.max(Math.min(r.x-b.Jd,b.o),b.o-b.L+b.g);b.o-=a;b.Jd+=a;r=Math.max(Math.min(r.y-b.Kd,b.l),b.l-b.w+b.b);b.l-=r;b.Kd+=r}}:null,null,null);c.l=!1;c.doScroll=function(c,e){b.o+=c;b.l+=e;a.la()};Bc(a,c);this.va&&G(a,function(a){a.save();a.fillStyle=b.va;a.fillRect(b.x,b.y,b.g,b.b);a.restore()});(this.L>
this.g||this.w>this.b)&&G(a,function(c){c.save();if(b.L>b.g){var d=b.g/b.L;d=Math.max(d*b.g,Math.min(20,b.g));var f=b.g-d,g=b.o/(b.L-b.g);f*=g;c.fillStyle=a.v.vf;c.fillRect(b.x,b.y+b.b+2,b.g,a.v.Gc);c.fillStyle=a.v.wf;c.fillRect(b.x+f,b.y+b.b+2,d,a.v.Gc)}b.w>b.b&&(d=b.b/b.w,d=Math.max(d*b.b,Math.min(20,b.b)),f=b.b-d,g=b.l/(b.w-b.b),f*=g,c.save(),c.fillStyle=a.v.vf,c.fillRect(b.P?b.x-2-a.v.Gc:b.x+b.g+2,b.y,a.v.Gc,b.b),c.fillStyle=a.v.wf,c.fillRect(b.P?b.x-2-a.v.Gc:b.x+b.g+2,b.y+f,a.v.Gc,d));c.restore()});
Id(a,this.x,this.y,this.g,this.b,-this.o,-this.l)};v.end=function(){this.fa.L.pop()};function Sc(a){return a.l<=.001*a.b}function Tc(a){return a.l>=a.w-1.001*a.b};function Bd(a,b,c,d,e,f){f=H(a.Y,{tag:"overlay-rectangle",aa:f||[]});f.x=b;f.y=c;f.width=d;f.height=e;f.G(a.I)}function oc(a,b,c,d,e,f,g,h){Bd(a,b,c,d,e,(f||[]).concat("disabled"));H(a.Y,{tag:"overlay-rectangle",aa:f||[]});h||(a.I.save(),f=Mc(a.Y,{tag:"crossout-line",aa:g||[]}),g=.1*Math.min(d,a.v.j),a.I.beginPath(),a.I.moveTo(b-g,c+.7*e),a.I.lineTo(b+d+g,c+.3*e),f.stroke(a.I),a.I.restore())}
function jc(a,b,c,d,e,f){a.save();a.strokeStyle=e;a.fillStyle=e;a.lineWidth=d;a.fillRect(b-2.5*d,c-d,5*d,4*d);a.beginPath();a.moveTo(b-1.7*d,c);a.lineTo(b-1.7*d,c);f?(a.arc(b-3.4*d,c-2*d,1.7*d,0,Math.PI,!0),a.lineTo(b-5.1*d,c)):(a.arc(b,c-2*d,1.7*d,-Math.PI,0),a.lineTo(b+1.7*d,c));a.stroke();a.restore()}function Ac(a,b,c,d,e,f,g){var h=.03*a.v.j;jc(a.I,b+d+(f?-5:5)*h,c+.15*e,h,g||"#333")}
function lc(a,b,c,d,e,f,g){a.save();g&&(g.style&&(a.strokeStyle=g.style,a.fillStyle=g.style),void 0!==g.lineWidth&&(a.lineWidth=g.lineWidth),void 0!==g.alpha&&(a.globalAlpha=g.alpha));var h=g&&void 0!==g.Mc?g.Mc:5*a.lineWidth;a.beginPath();var l=e+(g&&g.td?h/d:0),m=f-(g&&g.td?0:h/d);a.arc(b,c,d,l,m);a.stroke();g&&g.td?(a.translate(b+d*Math.cos(e),c+d*Math.sin(e)),a.rotate((e+l)/2+Math.PI)):(a.translate(b+d*Math.cos(f),c+d*Math.sin(f)),a.rotate((f+m)/2));a.beginPath();a.moveTo(0,0);a.lineTo(h/2,1.2*
-h);a.lineTo(-h/2,1.2*-h);a.fill();a.restore()}Ab.prototype.text=function(a,b){var c=this.I,d=this.v;c.save();c.fillStyle=b&&b.fillStyle||"white";c.font=d.Mf;c.textAlign="center";c.textBaseline="middle";c.translate(.5*d.j+(b&&b.x||0),.5*d.j-(b&&b.y||0));b&&b.Hg&&c.rotate(-b.Hg);c.translate(-.5*d.j,-.5*d.j);c.fillText(a,.5*d.j,.5*d.j);c.restore()};
function J(a,b){var c=a.I,d=a.v;c.save();c.beginPath();c.rect(0,0,a.v.j,a.v.j);c.clip();b&&(b.scale||b.rotation)&&(b.Se&&c.translate(-b.Se[0],-b.Se[1]),c.translate(.5*d.j,.5*d.j),b.scale&&c.scale(b.scale,b.scale),b.rotation&&c.rotate(-b.rotation),c.translate(-.5*d.j,-.5*d.j));c.beginPath();c.moveTo(.5*d.j,d.j-d.ia);b&&"left"===b.re||(c.lineTo(d.j-d.ia,d.j-d.ia),c.lineTo(d.j-d.ia,.25*d.j),c.bezierCurveTo(.8*d.j,d.ia,.52*d.j,d.ia,.5*d.j,d.ia));b&&"right"===b.re||(c.lineTo(.5*d.j,d.ia),c.bezierCurveTo(.48*
d.j,d.ia,.2*d.j,d.ia,d.ia,.25*d.j),c.lineTo(d.ia,d.j-d.ia));c.closePath();if(b&&b.Mb){a=[b.Mb[0],Math.max(.2+.8*b.Mb[1],b.Mb[2]/2),b.Mb[2]];var e=Math.max(a[0],Math.max(a[1],a[2]));c.fillStyle="rgb("+a.map(function(a){return Math.round(225*(1-e)+(30+225*e)*a)}).join(",")+")"}else c.fillStyle="white";c.fill();b&&b.Mb&&(c.strokeStyle="white",c.lineWidth=d.ia,c.stroke());b&&b.Yb&&(c.fillStyle="black",c.fillRect(0,.6*d.j,.1*d.j,.35*d.j),c.fillRect(.9*d.j,.6*d.j,.1*d.j,.35*d.j));c.restore()}
function Jd(a,b){var c=(b-a)/2,d=b===a?Infinity:(b+a)/(2*c);return{Xa:c,Ue:d,x:Math.abs(d)>1E3*Math.abs(a+b)?0:d*(.01>c?c*c/2:1-Math.cos(c)),y:Math.abs(d)>1E3*Math.abs(a+b)?(a+b)/2:d*Math.sin(c)}}
function Kd(a,b,c,d,e){var f=a.I;a=a.v;d*=a.j;var g=e&&e.r||[-1,0,1],h=e&&e.color||"black";e=e&&void 0!==e.me?e.me:1;var l=Jd(b,c);f.save();f.translate(.5*a.j,.5*a.j);f.strokeStyle=h;f.lineWidth=a.ia*e;20<Math.abs(l.Ue)?(f.beginPath(),g.forEach(function(a){f.moveTo(a*d,0);f.lineTo((l.x+a)*d,-l.y*d)}),f.stroke()):g.forEach(function(a){f.beginPath();var b=-l.Ue*d;a=(l.Ue+a)*d;var c=l.Xa;0<a?f.arc(b,0,a,0,-c,0<c):0>a&&f.arc(b,0,-a,Math.PI,Math.PI-c,0<c);f.stroke()});f.restore();return l}
function Ld(a,b,c,d,e,f,g){a=a.v;e*=a.j;f*=a.j;a=.21*a.j;c=g.x-c-b/2;b=d+b/2-g.y;e=Jd(e,f);return(c-e.x)*(c-e.x)+(b-e.y)*(b-e.y)<a*a}
function Md(a){var b=a.I;a=a.v;b.save();b.translate(.5*a.j,.5*a.j);b.scale(.7,.7);b.translate(-.5*a.j,-.5*a.j);b.fillStyle="white";b.fillRect(a.ia,.45*a.j,a.j-2*a.ia,.35*a.j);b.fillStyle="black";b.beginPath();b.arc(.27*a.j,.72*a.j,.2*a.j,0,2*Math.PI);b.fill();b.fillStyle="white";b.beginPath();b.arc(.27*a.j,.72*a.j,.12*a.j,0,2*Math.PI);b.fill();b.beginPath();b.arc(.8*a.j,.8*a.j-a.ia,.1*a.j,0,2*Math.PI);b.fill();b.restore()}
function Nd(a){var b=a.I;a=a.v;b.save();b.lineWidth=a.ia;b.strokeStyle="white";for(var c=1;3>=c;c++)b.beginPath(),b.arc(.185*a.j,.48*a.j,.05*a.j*c,.9*Math.PI,1.7*Math.PI),b.stroke();b.restore()}
Ab.prototype.buttons=function(a,b,c){var d=this.I,e=this.v;a.forEach(function(a,g){d.save();d.translate(e.j*(.5+a.x),e.j*(.5-a.y));d.rotate(a.r||0);d.fillStyle=a.fillStyle?a.fillStyle:b&&!0===b[g]?"red":b&&1===b[g]?"#f66":b&&-1===b[g]?"#333":"white";d.strokeStyle=a.strokeStyle?a.strokeStyle:!b||1!==b[g]&&!0!==b[g]?b&&0>b[g]?"black":"#aaa":"#700";d.lineWidth=e.ia;d.lineJoin="round";var f=a.size||1;switch(a.F){case "r":d.fillRect(.08*-e.j*f,.08*-e.j*f,.16*e.j*f,.16*e.j*f);d.strokeRect(.08*-e.j*f,.08*
-e.j*f,.16*e.j*f,.16*e.j*f);break;case "t":d.beginPath();d.moveTo(0,-.122*e.j*f);d.lineTo(.106*e.j*f,.062*e.j*f);d.lineTo(-.106*e.j*f,.062*e.j*f);d.closePath();d.fill();d.stroke();break;case "c":d.beginPath(),d.arc(0,0,.112*e.j*f,0,2*Math.PI),d.fill(),d.stroke()}b&&-1===b[g]&&c&&c.Sd&&(d.strokeStyle="white",d.beginPath(),d.moveTo(.06*-e.j*f,.06*-e.j*f),d.lineTo(.06*e.j*f,.06*e.j*f),d.moveTo(.06*-e.j*f,.06*e.j*f),d.lineTo(.06*e.j*f,.06*-e.j*f),d.stroke());d.restore()})};
function Od(a,b,c,d,e,f,g,h,l){var m=a.I;a=a.v;m.save();m.strokeStyle="black";m.lineWidth=a.ia*l;l=b.length/2;for(var r=0;r<l;r++)0<b[2*r+1]&&(m.fillStyle=2===b[2*r+1]?"white":"black",m.beginPath(),m.arc(a.j*(c+(d-c)/l*(r+.5)),a.j*(e+(f-e)/g*(b[2*r]+.5)),a.j*h/2,0,2*Math.PI),m.fill(),m.stroke());m.restore()}
function Pd(a,b){var c=a.I,d=a.v,e=null===b?-.15*d.j:0;c.save();c.beginPath();c.moveTo(.4*d.j+e,.3*d.j);c.lineTo(.4*d.j+e,.7*d.j);c.lineTo(.7*d.j+e,.7*d.j);c.lineTo(.7*d.j+e,.37*d.j);c.lineTo(.63*d.j+e,.3*d.j);c.closePath();c.lineWidth=d.ia;c.strokeStyle="white";c.lineJoin="round";c.stroke();for(var f=.15;.31>f;f+=.06)c.beginPath(),c.arc(.65*d.j+e,.5*d.j,d.j*f,-.6,.6),c.stroke();null===b?(c.beginPath(),c.moveTo(.12*d.j,.6*d.j),c.lineTo(.88*d.j,.4*d.j),c.lineWidth=1.5*d.ia,c.stroke()):a.text(b.toString(10),
{x:-.3*d.j});c.restore()}function Qd(a){var b=a.I;a=a.v;b.beginPath();b.arc(0,0,.4*a.j,0,2*Math.PI,!0);b.moveTo(0,0);b.lineTo(0,.4*-a.j);b.strokeStyle="#666";b.lineWidth=a.ia;b.stroke();b.beginPath();b.arc(0,.4*-a.j,.1*a.j,0,2*Math.PI);b.fillStyle="white";b.fill();b.strokeStyle="black";b.stroke()}
function Rd(a,b,c){var d=a.I,e=a.v;c=c*Math.PI/12;d.save();d.translate(.5*e.j,.5*e.j);d.rotate(c);Qd(a);d.fillRect(-.28*e.j,-.1*e.j,.56*e.j,.2*e.j);d.fillStyle="black";b?(d.beginPath(),d.arc(-.15*e.j,.03*e.j,.11*e.j,0,2*Math.PI),d.fill(),d.fillStyle="white",d.beginPath(),d.arc(-.15*e.j,.03*e.j,.07*e.j,0,2*Math.PI),d.fill(),d.beginPath(),d.arc(.15*e.j,.07*e.j,.06*e.j,0,2*Math.PI)):(d.fillRect(-.28*e.j,.1*e.j,.08*e.j,.04*e.j),d.fillRect(.2*e.j,.1*e.j,.08*e.j,.04*e.j),d.fillStyle="white",d.beginPath(),
d.arc(0,.06*e.j,.06*e.j,0,2*Math.PI));d.fill();d.restore()}function Sd(a,b,c,d,e){b=d.x-b-a/2;c=c+a/2-d.y;a=(b*b+c*c)/(a*a/4);return 1>a&&.4<a&&(e||0<=c)}function Td(a,b,c,d,e){a=Math.round(12*Math.atan2(d.x-b-a/2,c+a/2-d.y)/Math.PI);return e?12===a?-12:a:Math.max(-6,Math.min(6,a))}
function Ud(a,b,c,d,e,f,g,h,l){var m=l?0>=g?0:Math.max(Math.log(10*g)/Math.log(100),0):g/4;a.save();!h&&f&&f(g);a.beginPath();a.arc(b,c,d,0,2*Math.PI);a.fillStyle="white";a.fill();f=.9*d;g=l?.8*d:.6*d;var r=2*Math.PI*(h?.2:m),k=h?"#ddd":"red";l=(g-(l?.5*d:.6*d))/4;a.save();a.beginPath();a.arc(b,c,f,-Math.PI/2,3*Math.PI/2-.05);a.arc(b,c,g-4*l,3*Math.PI/2-.05,Math.PI,!0);a.arc(b+l,c,g-3*l,Math.PI,Math.PI/2,!0);a.arc(b+l,c-l,g-2*l,Math.PI/2,0,!0);a.arc(b,c-l,g-l,0,-Math.PI/2,!0);a.clip();a.fillStyle=
k;a.beginPath();a.arc(b,c,f,-Math.PI/2,-Math.PI/2+r);a.lineTo(b,c);a.fill();a.restore();a.beginPath();a.arc(b,c,d/2,0,2*Math.PI);a.fill();a.beginPath();a.arc(b,c,d,0,2*Math.PI);a.strokeStyle="black";a.lineWidth=e;a.stroke();a.beginPath();a.moveTo(b-.1*d*Math.sin(2*m*Math.PI),c+.1*d*Math.cos(2*m*Math.PI));a.lineTo(b+.9*d*Math.sin(2*m*Math.PI),c-.9*d*Math.cos(2*m*Math.PI));a.lineWidth=2*e;a.stroke();h&&lc(a,b,c,1.25*d,.5*-Math.PI,.1*-Math.PI,{td:!0,Mc:5*e,style:"black"});a.restore()}
function Vd(a,b,c,d){var e=a.I,f=a.v.j;Ud(e,f/2+(c?-.05*f:.05*f),f/2+(c?.07*f:.03*f),.4*f,a.v.ia,function(a){e.textAlign="start";e.textBaseline="top";e.font=Math.round(f/6).toString(10)+"px sans-serif";e.fillStyle="white";e.fillText(a.toFixed(1>a?2:1),f/20,f/40)},b,c,d)}
function Wd(a,b,c,d,e,f,g,h,l,m){var r=(d+e)/2,k=(e-d)/2;a.save();a.beginPath();a.arc(b,c,d,-g,-f);a.arc(b+r*Math.cos(f),c-r*Math.sin(f),k,-f-Math.PI,-f,!0);a.arc(b,c,e,-f,-g,!0);a.arc(b+r*Math.cos(g),c-r*Math.sin(g),k,-g,-g+Math.PI,!0);a.fillStyle=h;a.strokeStyle=l;a.lineWidth=m;a.fill();a.stroke();a.restore()}function Xd(a,b,c,d){var e=a.v;Wd(a.I,e.j/2,e.j/2,.3*e.j,.45*e.j,b,c,0>d?"white":2===d?"red":0<d?"#f70":"#ddd",0===d?"#bbb":"black",e.ia)}
function Yd(a,b){var c=a.I;c.save();Xd(a,.65*Math.PI,.85*Math.PI,b[0]);Xd(a,.15*Math.PI,.35*Math.PI,b[1]);Xd(a,1.15*Math.PI,1.35*Math.PI,b[2]);Xd(a,1.65*Math.PI,1.85*Math.PI,b[3]);c.restore()}function Zd(a,b){var c=a.I;c.save();for(var d=0;8>d;d++)Xd(a,Math.PI*(.46-.25*d),Math.PI*(.54-.25*d),d===b?1:-1);c.restore()}function $d(a,b,c,d,e,f){b=(f.x-d)/b-.5;c=.5-(f.y-e)/c;for(e=0;e<a.length;e++)if(Math.max(Math.abs(b-a[e].x),Math.abs(c-a[e].y))<.11*(a[e].size||1))return e;return null}
function ae(a,b,c,d,e,f){function g(a,b){h.beginPath();h.moveTo(l.j*(.1+.8*a),l.j*(.46-c));h.lineTo(l.j*(.1+.8*b),l.j*(.46-c));h.arc(l.j*(.1+.8*b),l.j*(.5-c),.04*l.j,-Math.PI/2,Math.PI/2);h.lineTo(l.j*(.1+.8*b),l.j*(.54-c));h.lineTo(l.j*(.1+.8*a),l.j*(.54-c));h.arc(l.j*(.1+.8*a),l.j*(.5-c),.04*l.j,Math.PI/2,-Math.PI/2)}var h=a.I,l=a.v;h.save();d&&(h.translate(.5*l.j,.5*l.j),h.rotate(-Math.PI/2),h.scale(1,-1),h.translate(-.5*l.j,-.5*l.j));h.lineWidth=l.ia;h.fillStyle="white";h.strokeStyle="black";
g(0,1);h.fill();h.stroke();h.fillStyle=e;switch(f||0){case 1:g(0,b);h.fill();h.stroke();break;case 2:g(b,1),h.fill(),h.stroke()}h.fillStyle=e;h.strokeStyle="black";h.lineWidth=l.ia;h.beginPath();h.arc(l.j*(.1+.8*b),l.j*(.5-c),.1*l.j,0,2*Math.PI);h.fill();h.stroke();h.restore()}function be(a,b,c,d,e,f,g){c=(g.x-e)/c-.5;d=.5-(g.y-f)/d;return.1>Math.abs((b?c:d)-a)}function ce(a,b,c,d,e,f){b=(f.x-d)/b-.5;c=.5-(f.y-e)/c;return.5+(a?c:b)/.8}
function de(a,b,c,d,e,f,g,h,l,m,r){a=Math.floor(((r.x-l)/g-a)/((b-a)/e));c=Math.floor((c-(r.y-m)/h)/((c-d)/f));return 0<=a&&a<e&&0<=c&&c<f?{index:a,tone:c}:null}function ee(a,b,c,d,e){var f=.4*a;a=e.x-c-.55*a;b=d+.53*b-e.y;return a*a+b*b<=f*f}function fe(a,b,c,d,e,f){a=(Math.PI-Math.atan2(f.x-c-.55*a,-(d+.53*b-f.y)))/(2*Math.PI);return e?Math.exp(a*Math.log(100))/10:4*a}function ge(a,b,c,d,e){c=e.x-c-a/2;b=b/2-(e.y-d);return Math.abs(Math.sqrt(c*c+b*b)-.375*a)<=.15*a?0<=b?0>c?0:1:0>c?2:3:null}
function he(a,b,c,d,e){c=e.x-c-a/2;b=b/2-(e.y-d);return Math.abs(Math.sqrt(c*c+b*b)-.375*a)<=.15*a?(a=Math.atan2(c,b)+Math.PI/8,Math.floor((0>a?a+2*Math.PI:a)/(Math.PI/4))):null}function kc(a,b,c,d){a.beginPath();a.moveTo(b+d*Math.cos(.1),c+d*Math.sin(.2));for(var e=1;6>e;e++)a.lineTo(b+d*Math.cos(e*Math.PI/3+.2),c+d*Math.sin(e*Math.PI/3+.2));a.closePath();a.arc(b,c,.5*d,0,2*Math.PI,!0);a.fill()};function ta(a){for(var b=0;b<Ra.length;b++)if(Ra[b].name===a)return Ra[b];return null}function Pa(a){var b=[];(Ra||[]).forEach(function(c){"h"!==c.type&&0<=c.oa.indexOf(a)&&b.push(c)});return b};var Ra=[new x({name:"!stop",type:"h"}),new x(function(){var a=[{F:"c",x:0,y:0,r:0},{F:"t",x:0,y:.3,r:0},{F:"t",x:0,y:-.3,r:Math.PI},{F:"t",x:.3,y:0,r:Math.PI/2},{F:"t",x:-.3,y:0,r:-Math.PI/2}];return{name:"button 1",type:"e",ha:function(){return[0]},G:function(b,c){J(b);c=c.h[0];b.buttons(a,[0==c,1==c,2==c,3==c,4==c])},Z:function(b,c,d,e,f,g,h){b=$d(a,d,e,f,g,h);null!==b&&(B(c),c.h[0]=b);return b}}}()),new x(function(){var a=[{F:"c",x:0,y:0,r:0},{F:"t",x:0,y:.3,r:0},{F:"t",x:0,y:-.3,r:Math.PI},{F:"t",
x:.3,y:0,r:Math.PI/2},{F:"t",x:-.3,y:0,r:-Math.PI/2}];return{name:"button",oa:["c"],type:"e",ha:function(){return[!1,!1,!1,!1,!1]},ub:function(){return[!1,!1,!0,!1,!0]},G:function(b,c){J(b);b.buttons(a,c.h)},Z:function(b,c,d,e,f,g,h){b=$d(a,d,e,f,g,h);null!==b&&(B(c),c.h[b]=!c.h[b]);return b},kc:function(a){for(var b=0;5>b;b++)if(a.h[b])return null;return new Ba("No button specified",!0)}}}()),new x(function(){var a=[{F:"r",x:0,y:.4,r:0,A:"2"},{F:"r",x:-.22,y:.35,r:-.45,A:"1"},{F:"r",x:.22,y:.35,
r:.45,A:"3"},{F:"r",x:-.4,y:.22,r:-.8,A:"0"},{F:"r",x:.4,y:.22,r:.8,A:"4"},{F:"r",x:-.2,y:-.4,A:"5"},{F:"r",x:.2,y:-.4,A:"6"}];return{name:"horiz prox",oa:["b"],type:"e",ha:function(){return[0,0,0,0,0,0,0]},ub:function(){return[0,1,-1,1,-1,0,0]},G:function(b,c){J(b);b.buttons(a,c.h,{Sd:!0})},Z:function(b,c,d,e,f,g,h){b=$d(a,d,e,f,g,h);null!==b&&(B(c),c.h[b]=(c.h[b]+2)%3-1);return b},kc:function(a){for(var b=0;7>b;b++)if(a.h[b])return null;return new Ba("No proximity sensor specified",!0)},yc:function(a,
c){switch(c){case "a":return c=new z(ta("horiz prox adv"),null,null),c.h=a.h.concat(c.h.slice(7)),c;default:return a}}}}()),new x(function(){var a=[{F:"r",x:0,y:.4,r:0,A:"2"},{F:"r",x:-.22,y:.35,r:-.45,A:"1"},{F:"r",x:.22,y:.35,r:.45,A:"3"},{F:"r",x:-.4,y:.22,r:-.8,A:"0"},{F:"r",x:.4,y:.22,r:.8,A:"4"},{F:"r",x:-.2,y:-.4,A:"5"},{F:"r",x:.2,y:-.4,A:"6"}];return{name:"horiz prox adv",oa:["c"],type:"e",ha:function(){return[0,0,0,0,0,0,0,.4,.1]},ub:function(){return[0,1,-1,1,-1,0,0,.4,.1]},G:function(b,
c){J(b);b.buttons(a,c.h,{Sd:!0});ae(b,c.h[7],.02,!1,"red",2);ae(b,c.h[8],-.2,!1,"black",1)},Z:function(b,c,d,e,f,g,h){b=$d(a,d,e,f,g,h);return null!==b?(B(c),c.h[b]=(c.h[b]+2)%3-1,b):be(.02,!1,d,e,f,g,h)?(B(c),7):be(-.2,!1,d,e,f,g,h)?(B(c),8):null},Oa:function(a,c,d,e,f,g,h,l){7<=d&&(c.h[d]=Math.max(0,Math.min(1,ce(!1,e,f,g,h,l))))},kc:function(a){for(var b=0;7>b;b++)if(a.h[b])return null;return new Ba("No sensor specified",!0)},yc:function(a,c){switch(c){case "b":if(c=a.S.ha(),a.h[7]===c[7]&&a.h[8]===
c[8])return c=new z(ta("horiz prox"),null,null),c.h=a.h.slice(0,7),c;default:return a}}}}()),new x(function(){var a=[{F:"r",x:0,y:.4,r:0,A:"2"},{F:"r",x:-.22,y:.35,r:-.45,A:"1"},{F:"r",x:.22,y:.35,r:.45,A:"3"},{F:"r",x:-.4,y:.22,r:-.8,A:"0"},{F:"r",x:.4,y:.22,r:.8,A:"4"},{F:"r",x:-.2,y:-.4,A:"5"},{F:"r",x:.2,y:-.4,A:"6"}];return{name:"horiz prox 1",oa:["a"],type:"e",ha:function(){return[0,0,0,0,0,0,0,.25]},ub:function(){return[0,1,-1,1,-1,0,0,.25]},G:function(b,c){J(b);b.buttons(a,c.h,{Sd:!0});ae(b,
c.h[7],-.1,!1,"black",1)},Z:function(b,c,d,e,f,g,h){b=$d(a,d,e,f,g,h);return null!==b?(B(c),c.h[b]=(c.h[b]+2)%3-1,b):be(-.1,!1,d,e,f,g,h)?(B(c),7):null},Oa:function(a,c,d,e,f,g,h,l){7<=d&&(c.h[d]=Math.max(.25,Math.min(.75,Math.round(4*ce(!1,e,f,g,h,l))/4)))},kc:function(a){for(var b=0;7>b;b++)if(a.h[b])return null;return new Ba("No sensor specified",!0)},yc:function(a,c){switch(c){case "b":if(c=a.S.ha(),a.h[7]===c[7])return c=new z(ta("horiz prox"),null,null),c.h=a.h.slice(0,7),c;default:return a}}}}()),
new x(function(){var a=[{F:"r",x:-.15,y:.35,A:"0"},{F:"r",x:.15,y:.35,A:"1"}];return{name:"ground",oa:["b"],type:"e",ha:function(){return[0,0]},ub:function(){return[1,-1]},G:function(b,c){J(b,{Yb:!0});b.buttons(a,c.h,{Sd:!0})},Z:function(b,c,d,e,f,g,h){b=$d(a,d,e,f,g,h);null!==b&&(B(c),c.h[b]=(c.h[b]+2)%3-1);return b},kc:function(a){return a.h[0]||a.h[1]?null:new Ba("No ground sensor specified",!0)},yc:function(a,c){switch(c){case "a":return c=new z(ta("ground adv"),null,null),c.h=a.h.concat(c.h.slice(2)),
c;default:return a}}}}()),new x(function(){var a=[{F:"r",x:-.15,y:.35,A:"0"},{F:"r",x:.15,y:.35,A:"1"}];return{name:"ground adv",oa:["c"],type:"e",ha:function(){return[0,0,.6,.4]},ub:function(){return[1,-1,.6,.4]},G:function(b,c){J(b,{Yb:!0});b.buttons(a,c.h,{Sd:!0});ae(b,c.h[2],.02,!1,"red",2);ae(b,c.h[3],-.2,!1,"black",1)},Z:function(b,c,d,e,f,g,h){b=$d(a,d,e,f,g,h);return null!==b?(B(c),c.h[b]=(c.h[b]+2)%3-1,b):be(.02,!1,d,e,f,g,h)?(B(c),2):be(-.2,!1,d,e,f,g,h)?(B(c),3):null},Oa:function(a,c,d,
e,f,g,h,l){2<=d&&(c.h[d]=Math.max(0,Math.min(1,ce(!1,e,f,g,h,l))))},kc:function(a){return a.h[0]||a.h[1]?null:new Ba("No ground sensor specified",!0)},yc:function(a,c){switch(c){case "b":if(c=a.S.ha(),a.h[2]===c[2]&&a.h[3]===c[3])return c=new z(ta("ground"),null,null),c.h=a.h.slice(0,2),c;default:return a}}}}()),new x(function(){var a=[{F:"r",x:-.15,y:.35,A:"0"},{F:"r",x:.15,y:.35,A:"1"}];return{name:"ground 1",oa:["a"],type:"e",ha:function(){return[0,0,.5]},ub:function(){return[1,-1,.5]},G:function(b,
c){J(b,{Yb:!0});b.buttons(a,c.h,{Sd:!0});ae(b,c.h[2],0,!1,"black",1)},Z:function(b,c,d,e,f,g,h){b=$d(a,d,e,f,g,h);return null!==b?(B(c),c.h[b]=(c.h[b]+2)%3-1,b):be(0,!1,d,e,f,g,h)?(B(c),2):null},Oa:function(a,c,d,e,f,g,h,l){2<=d&&(c.h[d]=Math.max(.25,Math.min(.75,Math.round(4*ce(!1,e,f,g,h,l))/4)))},kc:function(a){return a.h[0]||a.h[1]?null:new Ba("No ground sensor specified",!0)},yc:function(a,c){switch(c){case "b":if(c=a.S.ha(),a.h[2]===c[2])return c=new z(ta("ground"),null,null),c.h=a.h.slice(0,
2),c;default:return a}}}}()),new x({name:"tap",oa:["b","a"],type:"e",G:function(a){a.I.translate(.05*a.v.j,0);Md(a);Nd(a)},yc:function(a,b){switch(b){case "a":return new z(ta("accelerometer"),null,null);default:return a}}}),new x(function(){var a=[{F:"c",x:-.33,y:-.3,r:0},{F:"c",x:0,y:-.3,r:0},{F:"c",x:.33,y:-.3,r:0}];return{name:"accelerometer",oa:["c"],type:"e",ha:function(){return[0,0]},G:function(b,c){var d=c.h[0];c=c.h[1];0===d?(b.I.save(),b.I.translate(.08*b.v.j,-.2*b.v.j),Md(b),Nd(b),b.I.restore()):
Rd(b,2===d,2===d?-c:c);b.buttons(a,[0===d,1===d,2===d])},Z:function(b,c,d,e,f,g,h){if(0!==c.h[0]&&Sd(d,f,g,h))return B(c),1;b=$d(a,d,e,f,g,h);return null!==b?(B(c),c.h[0]=b,2):null},Oa:function(a,c,d,e,f,g,h,l){1===d&&(a=Td(e,g,h,l),c.h[1]=2===c.h[0]?-a:a)},yc:function(a,c){switch(c){case "b":if(0===a.h[0])return new z(ta("tap"),null,null);default:return a}}}}()),new x({name:"roll",oa:["a"],type:"e",ha:function(){return[0]},ub:function(){return[2]},G:function(a,b){Rd(a,!1,b.h[0])},Z:function(a,b,
c,d,e,f,g){return Sd(c,e,f,g,!0)?(B(b),1):null},Oa:function(a,b,c,d,e,f,g,h){b.h[0]=Td(d,f,g,h,!0)}}),new x({name:"pitch",oa:["a"],type:"e",ha:function(){return[0]},ub:function(){return[2]},G:function(a,b){Rd(a,!0,b.h[0])},Z:function(a,b,c,d,e,f,g){return Sd(c,e,f,g,!0)?(B(b),1):null},Oa:function(a,b,c,d,e,f,g,h){b.h[0]=Td(d,f,g,h,!0)}}),new x({name:"yaw",oa:["a"],type:"e",ha:function(){return[0]},ub:function(){return[2]},G:function(a,b){var c=a.I,d=a.v;b=b.h[0]*Math.PI/12;c.save();c.translate(.5*
d.j,.5*d.j);c.rotate(b);Qd(a);c.translate(-d.j/2,-d.j/2);J(a,{Yb:!0,scale:.45});c.restore()},Z:function(a,b,c,d,e,f,g){return Sd(c,e,f,g,!0)?(B(b),1):null},Oa:function(a,b,c,d,e,f,g,h){b.h[0]=Td(d,f,g,h,!0)}}),new x({name:"clap",type:"e",G:function(a){var b=a.I;a=a.v;b.save();b.beginPath();b.arc(.7*a.j,.6*a.j,.15*a.j,0,2*Math.PI);b.fillStyle="white";b.fill();b.beginPath();b.moveTo(.7*a.j,.6*a.j);b.lineTo(.8*a.j,.95*a.j);b.strokeStyle="white";b.lineWidth=.13*a.j;b.stroke();b.lineWidth=1.5*a.ia;b.translate(.3*
a.j,.3*a.j);b.rotate(.1);for(var c=0;9>c;c++)b.beginPath(),b.moveTo(.07*a.j,0),b.lineTo(.14*a.j,0),b.moveTo(.17*a.j,0),b.lineTo(.22*a.j,0),b.stroke(),b.rotate(Math.PI/4.5);b.restore()}}),new x({name:"init",oa:["b","a"],type:"e",G:function(a){var b=a.I;a=a.v;var c=.4*a.j;b.save();b.fillStyle="black";b.strokeStyle="black";b.lineWidth=a.ia;b.beginPath();b.arc(.3*a.j,.5*a.j,.08*a.j,0,2*Math.PI);b.fill();b.beginPath();b.moveTo(.42*a.j,.5*a.j);b.lineTo(.7*a.j,.5*a.j);b.stroke();c*=.4;b.beginPath();b.moveTo(.8*
a.j,.5*a.j);b.lineTo(.8*a.j-c*Math.sqrt(3)/2,.5*a.j+c/2);b.lineTo(.8*a.j-c*Math.sqrt(3)/2,.5*a.j-c/2);b.fill();b.restore()},$f:!0}),new x({name:"timer",oa:["a"],type:"e",G:function(a){Vd(a,0,!0,!1)}}),new x({name:"state",oa:["a"],type:"s",ha:function(){return[0,0,0,0]},ub:function(){return[1,0,0,-1]},G:function(a,b){J(a);Yd(a,b.h)},Z:function(a,b,c,d,e,f,g){a=ge(c,d,e,f,g);null!==a&&(B(b),b.h[a]=(b.h[a]+2)%3-1);return a},yc:function(a,b){return"b"===b&&0===a.h[0]&&0===a.h[1]&&0===a.h[2]&&0===a.h[3]?
null:a}}),new x({name:"state 8",oa:["c"],type:"s",ha:function(){return[0]},G:function(a,b){J(a);Zd(a,b.h[0])},Z:function(a,b,c,d,e,f,g){a=he(c,d,e,f,g);null!==a&&(B(b),b.h[0]=a);return a}}),new x(function(){var a=[{F:"t",x:-.3,y:.3,r:0},{F:"t",x:-.3,y:-.3,r:Math.PI},{F:"t",x:.1,y:.3,r:0},{F:"t",x:.1,y:-.3,r:Math.PI},{F:"c",x:.35,y:-.3,r:0}];return{name:"counter comparison",oa:["a"],type:"s",ha:function(){return[0,0]},G:function(b,c){b.text(0===c.h[0]?"=":0<c.h[0]?"\u2265":"\u2264",{x:-.3*b.v.j,fillStyle:"black"});
b.text(c.h[1].toString(10),{x:.1*b.v.j,fillStyle:"black"});b.buttons(a,[1>c.h[0]?-2:0,-1<c.h[0]?-2:0,255>c.h[1]?-2:0,0<c.h[1]?-2:0,0!==c.h[1]?-2:0])},Z:function(b,c,d,e,f,g,h){b=$d(a,d,e,f,g,h);if(null!==b)switch(B(c),b){case 0:c.h[0]=Math.min(1,c.h[0]+1);break;case 1:c.h[0]=Math.max(-1,c.h[0]-1);break;case 2:c.h[1]=Math.min(255,c.h[1]+1);break;case 3:c.h[1]=Math.max(0,c.h[1]-1);break;case 4:c.h[1]=0}return b}}}()),new x({name:"color state",oa:["c"],type:"s",ha:function(){return[0,0,0]},G:function(a,
b){J(a,{Mb:b.h});ae(a,b.h[0],.3,!1,"red");ae(a,b.h[1],0,!1,"#0c0");ae(a,b.h[2],-.3,!1,"#08f")},Z:function(a,b,c,d,e,f,g){return be(.3,!1,c,d,e,f,g)?(B(b),0):be(0,!1,c,d,e,f,g)?(B(b),1):be(-.3,!1,c,d,e,f,g)?(B(b),2):null},Oa:function(a,b,c,d,e,f,g,h){b.h[c]=Math.max(0,Math.min(1,Math.round(ce(!1,d,e,f,g,h))))}}),new x(function(){var a=[{F:"r",x:-.15,y:.3,size:1.4,A:"black",fillStyle:"#666",strokeStyle:"white"},{F:"r",x:-.3,y:0,size:1.4,A:"red",fillStyle:"red",strokeStyle:"white"},{F:"r",x:0,y:0,size:1.4,
A:"green",fillStyle:"#0c0",strokeStyle:"white"},{F:"r",x:.3,y:0,size:1.4,A:"yellow",fillStyle:"yellow",strokeStyle:"silver"},{F:"r",x:-.3,y:-.3,size:1.4,A:"blue",fillStyle:"blue",strokeStyle:"white"},{F:"r",x:0,y:-.3,size:1.4,A:"magenta",fillStyle:"magenta",strokeStyle:"white"},{F:"r",x:.3,y:-.3,size:1.4,A:"cyan",fillStyle:"cyan",strokeStyle:"white"},{F:"r",x:.15,y:.3,size:1.4,A:"white",fillStyle:"white",strokeStyle:"silver"}];return{name:"color 8 state",oa:["a"],type:"s",ha:function(){return[0]},
G:function(b,c){J(b,{Mb:[c.h&1,(c.h&2)/2,(c.h&4)/4]});b.buttons(a,[1>c.h[0]?-2:0,-1<c.h[0]?-2:0])},Z:function(b,c,d,e,f,g,h){b=$d(a,d,e,f,g,h);null!==b&&(B(c),c.h=[b]);return b}}}()),new x({name:"motor state",oa:["c"],type:"s",ha:function(){return[0,0]},G:function(a,b){var c=Kd(a,2.4*b.h[0],2.4*b.h[1],.19);J(a,{Yb:!0,scale:.45,rotation:c.Xa,Se:[.19*c.x*a.v.j+.13*a.v.j*Math.sin(c.Xa),.19*c.y*a.v.j+.13*a.v.j*Math.cos(c.Xa)]});a.I.save();a.I.globalAlpha=.2;Kd(a,2.4*b.h[0],2.4*b.h[1],.19);a.I.restore();
ae(a,.5+.5*b.h[0],-.4,!0,0===b.h[0]?"white":b.h[0]===b.h[1]?"#0c0":b.h[0]===-b.h[1]?"#f70":"#fd0");ae(a,.5+.5*b.h[1],.4,!0,0===b.h[1]?"white":b.h[0]===b.h[1]?"#0c0":b.h[0]===-b.h[1]?"#f70":"#fd0")},Z:function(a,b,c,d,e,f,g){return be(-.4,!0,c,d,e,f,g)?(B(b),0):be(.4,!0,c,d,e,f,g)?(B(b),1):Ld(a,c,e,f,.5*b.h[0],.5*b.h[1],g)?(B(b),2):null},Oa:function(a,b,c,d,e,f,g,h){2>c?(a=ce(!0,d,e,f,g,h),b.h[c]=.25>a?-1:.75<a?1:0):(a=ce(!0,d,e,f,g,h),a=.25>a?-1:.75<a?1:0,b.h[0]=a,b.h[1]=a)}}),new x({name:"motor",
type:"a",ha:function(){return[0,0]},ub:function(){return[.5,.2]},G:function(a,b){var c=Kd(a,2.4*b.h[0],2.4*b.h[1],.19);J(a,{Yb:!0,scale:.45,rotation:c.Xa,Se:[.19*c.x*a.v.j+.13*a.v.j*Math.sin(c.Xa),.19*c.y*a.v.j+.13*a.v.j*Math.cos(c.Xa)]});a.I.save();a.I.globalAlpha=.2;Kd(a,2.4*b.h[0],2.4*b.h[1],.19);a.I.restore();ae(a,.5+.5*b.h[0],-.4,!0,0===b.h[0]?"white":b.h[0]===b.h[1]?"#0c0":b.h[0]===-b.h[1]?"#f70":"#fd0");ae(a,.5+.5*b.h[1],.4,!0,0===b.h[1]?"white":b.h[0]===b.h[1]?"#0c0":b.h[0]===-b.h[1]?"#f70":
"#fd0")},Z:function(a,b,c,d,e,f,g){return be(-.4,!0,c,d,e,f,g)?(B(b),0):be(.4,!0,c,d,e,f,g)?(B(b),1):Ld(a,c,e,f,.5*b.h[0],.5*b.h[1],g)?(B(b),2):null},Oa:function(a,b,c,d,e,f,g,h){2>c?(a=2*ce(!0,d,e,f,g,h)-1,d=b.h[1-c],.1>Math.abs(a)?a=0:.1>Math.abs(a-d)?a=d:.1>Math.abs(a+d)&&(a=-d),b.h[c]=Math.max(-1,Math.min(1,a))):(a=2*ce(!0,d,e,f,g,h)-1,a=.1>Math.abs(a)?0:Math.max(-1,Math.min(1,a)),.05>Math.abs(b.h[0]-b.h[1])?(b.h[0]=a,b.h[1]=a):Math.abs(b.h[0])>Math.abs(b.h[1])?(b.h[1]*=a/b.h[0],b.h[0]=a):(b.h[0]*=
a/b.h[1],b.h[1]=a))}}),new x(function(){var a=[{F:"c",x:0,y:0,r:0},{F:"t",x:0,y:.35,r:0},{F:"t",x:0,y:-.35,r:Math.PI},{F:"t",x:-.3,y:.32,r:-.4},{F:"t",x:.3,y:.32,r:.4},{F:"t",x:-.35,y:.05,r:-Math.PI/2},{F:"t",x:.35,y:.05,r:Math.PI/2}];return{name:"move",oa:["c"],type:"a",ha:function(){return[0]},G:function(b,c){J(b,{Yb:!0,scale:.45});b.buttons(a,[0===c.h[0]?1:-2,1===c.h[0]?1:-2,2===c.h[0]?1:-2,3===c.h[0]?1:-2,4===c.h[0]?1:-2,5===c.h[0]?1:-2,6===c.h[0]?1:-2])},Z:function(b,c,d,e,f,g,h){b=$d(a,d,e,
f,g,h);null!==b&&(B(c),c.h[0]=b);return b}}}()),new x({name:"top color",oa:["a"],type:"a",ha:function(){return[0,0,0]},G:function(a,b){J(a,{Mb:b.h});ae(a,b.h[0],.3,!1,"red");ae(a,b.h[1],0,!1,"#0c0");ae(a,b.h[2],-.3,!1,"#08f")},Z:function(a,b,c,d,e,f,g){return be(.3,!1,c,d,e,f,g)?(B(b),0):be(0,!1,c,d,e,f,g)?(B(b),1):be(-.3,!1,c,d,e,f,g)?(B(b),2):null},Oa:function(a,b,c,d,e,f,g,h){b.h[c]=Math.max(0,Math.min(1,ce(!1,d,e,f,g,h)))}}),new x(function(){var a=[{F:"r",x:-.15,y:.3,size:1.4,A:"black",fillStyle:"#666",
strokeStyle:"white"},{F:"r",x:-.3,y:0,size:1.4,A:"red",fillStyle:"red",strokeStyle:"white"},{F:"r",x:0,y:0,size:1.4,A:"green",fillStyle:"#0c0",strokeStyle:"white"},{F:"r",x:.3,y:0,size:1.4,A:"yellow",fillStyle:"yellow",strokeStyle:"silver"},{F:"r",x:-.3,y:-.3,size:1.4,A:"blue",fillStyle:"blue",strokeStyle:"white"},{F:"r",x:0,y:-.3,size:1.4,A:"magenta",fillStyle:"magenta",strokeStyle:"white"},{F:"r",x:.3,y:-.3,size:1.4,A:"cyan",fillStyle:"cyan",strokeStyle:"white"},{F:"r",x:.15,y:.3,size:1.4,A:"white",
fillStyle:"white",strokeStyle:"silver"}];return{name:"top color 8",oa:["b"],type:"a",ha:function(){return[0]},G:function(b,c){J(b,{Mb:[c.h&1,(c.h&2)/2,(c.h&4)/4]});b.buttons(a,[1>c.h[0]?-2:0,-1<c.h[0]?-2:0])},Z:function(b,c,d,e,f,g,h){b=$d(a,d,e,f,g,h);null!==b&&(B(c),c.h=[b]);return b}}}()),new x({name:"bottom color",oa:["a"],type:"a",ha:function(){return[0,0,0]},G:function(a,b){J(a,{Yb:!0,Mb:b.h});ae(a,b.h[0],.3,!1,"red");ae(a,b.h[1],0,!1,"#0c0");ae(a,b.h[2],-.3,!1,"#08f")},Z:function(a,b,c,d,e,
f,g){return be(.3,!1,c,d,e,f,g)?(B(b),0):be(0,!1,c,d,e,f,g)?(B(b),1):be(-.3,!1,c,d,e,f,g)?(B(b),2):null},Oa:function(a,b,c,d,e,f,g,h){b.h[c]=Math.max(0,Math.min(1,ce(!1,d,e,f,g,h)))}}),new x({name:"bottom-left color",oa:["c"],type:"a",ha:function(){return[0,0,0]},G:function(a,b){J(a,{Yb:!0,Mb:b.h,re:"left"});ae(a,b.h[0],.3,!1,"red");ae(a,b.h[1],0,!1,"#0c0");ae(a,b.h[2],-.3,!1,"#08f")},Z:function(a,b,c,d,e,f,g){return be(.3,!1,c,d,e,f,g)?(B(b),0):be(0,!1,c,d,e,f,g)?(B(b),1):be(-.3,!1,c,d,e,f,g)?(B(b),
2):null},Oa:function(a,b,c,d,e,f,g,h){b.h[c]=Math.max(0,Math.min(1,ce(!1,d,e,f,g,h)))}}),new x({name:"bottom-right color",oa:["c"],type:"a",ha:function(){return[0,0,0]},G:function(a,b){J(a,{Yb:!0,Mb:b.h,re:"right"});ae(a,b.h[0],.3,!1,"red");ae(a,b.h[1],0,!1,"#0c0");ae(a,b.h[2],-.3,!1,"#08f")},Z:function(a,b,c,d,e,f,g){return be(.3,!1,c,d,e,f,g)?(B(b),0):be(0,!1,c,d,e,f,g)?(B(b),1):be(-.3,!1,c,d,e,f,g)?(B(b),2):null},Oa:function(a,b,c,d,e,f,g,h){b.h[c]=Math.max(0,Math.min(1,ce(!1,d,e,f,g,h)))}}),new x(function(){var a=
[{F:"r",x:-.15,y:.3,size:1.4,A:"black",fillStyle:"#666",strokeStyle:"white"},{F:"r",x:-.3,y:0,size:1.4,A:"red",fillStyle:"red",strokeStyle:"white"},{F:"r",x:0,y:0,size:1.4,A:"green",fillStyle:"#0c0",strokeStyle:"white"},{F:"r",x:.3,y:0,size:1.4,A:"yellow",fillStyle:"yellow",strokeStyle:"silver"},{F:"r",x:-.3,y:-.3,size:1.4,A:"blue",fillStyle:"blue",strokeStyle:"white"},{F:"r",x:0,y:-.3,size:1.4,A:"magenta",fillStyle:"magenta",strokeStyle:"white"},{F:"r",x:.3,y:-.3,size:1.4,A:"cyan",fillStyle:"cyan",
strokeStyle:"white"},{F:"r",x:.15,y:.3,size:1.4,A:"white",fillStyle:"white",strokeStyle:"silver"}];return{name:"bottom color 8",oa:["b"],type:"a",ha:function(){return[0]},G:function(b,c){J(b,{Yb:!0,Mb:[c.h&1,(c.h&2)/2,(c.h&4)/4]});b.buttons(a,[1>c.h[0]?-2:0,-1<c.h[0]?-2:0])},Z:function(b,c,d,e,f,g,h){b=$d(a,d,e,f,g,h);null!==b&&(B(c),c.h=[b]);return b}}}()),new x(function(){var a=[{F:"r",x:-.15,y:.3,size:1.4,A:"black",fillStyle:"#666",strokeStyle:"white"},{F:"r",x:-.3,y:0,size:1.4,A:"red",fillStyle:"red",
strokeStyle:"white"},{F:"r",x:0,y:0,size:1.4,A:"green",fillStyle:"#0c0",strokeStyle:"white"},{F:"r",x:.3,y:0,size:1.4,A:"yellow",fillStyle:"yellow",strokeStyle:"silver"},{F:"r",x:-.3,y:-.3,size:1.4,A:"blue",fillStyle:"blue",strokeStyle:"white"},{F:"r",x:0,y:-.3,size:1.4,A:"magenta",fillStyle:"magenta",strokeStyle:"white"},{F:"r",x:.3,y:-.3,size:1.4,A:"cyan",fillStyle:"cyan",strokeStyle:"white"},{F:"r",x:.15,y:.3,size:1.4,A:"white",fillStyle:"white",strokeStyle:"silver"}];return{name:"bottom-left color 8",
oa:["c"],type:"a",ha:function(){return[0]},G:function(b,c){J(b,{Yb:!0,Mb:[c.h&1,(c.h&2)/2,(c.h&4)/4],re:"left"});b.buttons(a,[1>c.h[0]?-2:0,-1<c.h[0]?-2:0])},Z:function(b,c,d,e,f,g,h){b=$d(a,d,e,f,g,h);null!==b&&(B(c),c.h=[b]);return b}}}()),new x(function(){var a=[{F:"r",x:-.15,y:.3,size:1.4,A:"black",fillStyle:"#666",strokeStyle:"white"},{F:"r",x:-.3,y:0,size:1.4,A:"red",fillStyle:"red",strokeStyle:"white"},{F:"r",x:0,y:0,size:1.4,A:"green",fillStyle:"#0c0",strokeStyle:"white"},{F:"r",x:.3,y:0,
size:1.4,A:"yellow",fillStyle:"yellow",strokeStyle:"silver"},{F:"r",x:-.3,y:-.3,size:1.4,A:"blue",fillStyle:"blue",strokeStyle:"white"},{F:"r",x:0,y:-.3,size:1.4,A:"magenta",fillStyle:"magenta",strokeStyle:"white"},{F:"r",x:.3,y:-.3,size:1.4,A:"cyan",fillStyle:"cyan",strokeStyle:"white"},{F:"r",x:.15,y:.3,size:1.4,A:"white",fillStyle:"white",strokeStyle:"silver"}];return{name:"bottom-right color 8",oa:["c"],type:"a",ha:function(){return[0]},G:function(b,c){J(b,{Yb:!0,Mb:[c.h&1,(c.h&2)/2,(c.h&4)/4],
re:"right"});b.buttons(a,[1>c.h[0]?-2:0,-1<c.h[0]?-2:0])},Z:function(b,c,d,e,f,g,h){b=$d(a,d,e,f,g,h);null!==b&&(B(c),c.h=[b]);return b}}}()),new x({name:"notes",type:"a",ha:function(){return[0,1,1,1,2,1,0,1,2,1,4,2]},G:function(a,b){b=b.h;var c=a.I,d=a.v;c.save();c.fillStyle="#eee";for(var e=0;5>e;e++)c.fillRect(.1*d.j,d.j*(.1+.16*e),.8*d.j,.16*d.j-d.ia);Od(a,b,.1,.9,.9,.1,5,.14,1);c.restore()},Z:function(a,b,c,d,e,f,g){return(a=de(.1,.9,.9,.1,6,5,c,d,e,f,g))?(B(b),b.h[2*a.index]===a.tone?b.h[2*
a.index+1]=(b.h[2*a.index+1]+1)%3:(b.h[2*a.index]=a.tone,b.h[2*a.index+1]=1),0):null}}),new x(function(){var a=[{F:"t",x:-.3,y:.3,r:0},{F:"t",x:-.3,y:-.3,r:Math.PI}];return{name:"play",oa:["c"],type:"a",ha:function(){return[0]},G:function(b,c){Pd(b,c.h[0]);b.buttons(a,[-2,-2])},Z:function(b,c,d,e,f,g,h){b=$d(a,d,e,f,g,h);if(null!==b)switch(B(c),b){case 0:c.h[0]=(c.h[0]+1)%100;break;case 1:c.h[0]=(c.h[0]+99)%100}return b}}}()),new x({name:"play stop",oa:["c"],type:"a",G:function(a){Pd(a,null)}}),new x({name:"set state",
oa:["a"],type:"a",ha:function(){return[0,0,0,0]},ub:function(){return[0,1,-1,0]},G:function(a,b){J(a);Yd(a,b.h)},Z:function(a,b,c,d,e,f,g){a=ge(c,d,e,f,g);null!==a&&(B(b),b.h[a]=(b.h[a]+2)%3-1);return a}}),new x({name:"toggle state",oa:["c"],type:"a",ha:function(){return[!1,!1,!1,!1]},G:function(a,b){J(a);Yd(a,b.h.map(function(a){return a?2:0}));lc(a.I,a.v.j/2,a.v.j/2,.2*a.v.j,-1.4,1.4,{style:"black",lineWidth:a.v.ia,Mc:5*a.v.ia});lc(a.I,a.v.j/2,a.v.j/2,.2*a.v.j,Math.PI-1.4,Math.PI+1.4,{style:"black",
lineWidth:a.v.ia,Mc:5*a.v.ia})},Z:function(a,b,c,d,e,f,g){a=ge(c,d,e,f,g);null!==a&&(B(b),b.h[a]=!b.h[a]);return a}}),new x({name:"set state 8",oa:["c"],type:"a",ha:function(){return[0]},G:function(a,b){J(a);Zd(a,b.h[0])},Z:function(a,b,c,d,e,f,g){a=he(c,d,e,f,g);null!==a&&(B(b),b.h[0]=a);return a}}),new x(function(){var a=[{F:"c",x:-.2,y:0},{F:"c",x:.2,y:0}];return{name:"change state 8",oa:["c"],type:"a",ha:function(){return[1]},G:function(b,c){J(b);var d=b.I;d.save();for(var e=0;8>e;e++)Xd(b,Math.PI*
(.46-.25*e),Math.PI*(.54-.25*e),0);d.restore();lc(b.I,b.v.j/2,b.v.j/2,.375*b.v.j,-.8,.8,{style:"black",lineWidth:b.v.ia,Mc:5*b.v.ia});lc(b.I,b.v.j/2,b.v.j/2,.375*b.v.j,Math.PI-.8,Math.PI+.8,{td:!0,style:"black",lineWidth:b.v.ia,Mc:5*b.v.ia});b.buttons(a,[0>c.h[0],0<c.h[0]])},Z:function(b,c,d,e,f,g,h){b=$d(a,d,e,f,g,h);null!==b&&(B(c),c.h[0]=0===b?-1:1);return b}}}()),new x(function(){var a=[{F:"t",x:0,y:.3,r:0},{F:"t",x:0,y:-.3,r:Math.PI}];return{name:"set counter",oa:["a"],type:"a",ha:function(){return[0]},
G:function(b,c){b.text(0===c.h[0]?"= 0":0<c.h[0]?"+1":"\u22121");b.buttons(a,[1>c.h[0]?-2:0,-1<c.h[0]?-2:0])},Z:function(b,c,d,e,f,g,h){b=$d(a,d,e,f,g,h);if(null!==b)switch(B(c),b){case 0:c.h[0]=Math.min(1,c.h[0]+1);break;case 1:c.h[0]=Math.max(-1,c.h[0]-1)}return b}}}()),new x({name:"set timer",oa:["a"],type:"a",ha:function(){return[1]},G:function(a,b){Vd(a,b.h[0],!1,!1)},Z:function(a,b,c,d,e,f,g){return ee(c,d,e,f,g)?(B(b),1):null},Oa:function(a,b,c,d,e,f,g,h){b.h[0]=fe(d,e,f,g,!1,h)}}),new x({name:"set timer log",
oa:["c"],type:"a",ha:function(){return[1]},G:function(a,b){Vd(a,b.h[0],!1,!0)},Z:function(a,b,c,d,e,f,g){return ee(c,d,e,f,g)?(B(b),1):null},Oa:function(a,b,c,d,e,f,g,h){b.h[0]=fe(d,e,f,g,!0,h)}}),new x(function(){function a(a,b){if(a.h[1]){var c=new Image;c.src=a.h[1];c.addEventListener("load",function(){a.h[2]=c;b&&b()},!1)}}var b=[{F:"c",x:-.33,y:-.3,r:0}];return{name:"picture comment",oa:["a"],type:"c",ha:function(){return[!1,"",null]},Fe:function(a){return 2<=a.h.length?[!1,a.h[1]]:[!1,""]},
Wd:function(b,d,e){b.h=2<=d.length?[!1,d[1]]:[!1,""];a(b,e)},G:function(a,d){d.h[2]&&a.I.drawImage(d.h[2],0,0,240,240,0,0,a.v.j,a.v.j);a.buttons(b,[d.h[0]])},Z:function(c,d,e,f,g,h,l){e=$d(b,e,f,g,h,l);0===e&&(d.h[0]?ba&&(ba.pause&&ba.pause(),ca.getTracks().forEach(function(a){a.stop()}),ba=null):(B(d),navigator.mediaDevices.getUserMedia({audio:!1,video:{width:320,height:240}}).then(function(b){ca=b;ba=document.createElement("video");ba.srcObject=b;ba.addEventListener("loadedmetadata",function(){ba.play();
var b=setInterval(function(){ba?(da||(da=document.createElement("canvas"),da.width=240,da.height=240),da.getContext("2d").drawImage(ba,0,0,240,240,0,0,240,240),d.h[1]=da.toDataURL("image/png"),a(d,function(){c.la&&c.la();E(c)})):clearInterval(b)},100)},!1)})),d.h[0]=!d.h[0]);return e}}}())];function ie(a,b){function c(a){return a instanceof Array?a.join(""):a}function d(a,b){return a.map(function(a){return na(a,b)})}var e=b||{};["aseba","l2","js","python"].forEach(function(b){a[b]&&(e[b]=function(e){var f={};a[b].initVarDecl&&(f.Pb=d(a[b].initVarDecl.map(c),e));a[b].initCodeDecl&&(f.Ob=d(a[b].initCodeDecl.map(c),e));a[b].initCodeExec&&(f.Sb=d(a[b].initCodeExec.map(c),e));a[b].sectionBegin&&(f.X=na(c(a[b].sectionBegin),e));a[b].sectionEnd&&(f.qb=na(c(a[b].sectionEnd),e));a[b].sectionPreamble&&
(f.hb=na(c(a[b].sectionPreamble),e));a[b].clauseInit&&(f.da=na(c(a[b].clauseInit),e));if(a[b].clauseAnd){var g="";e.h.forEach(function(d,f){(d=na(c(a[b].clauseAnd),e,f))&&(g+=(0<g.length?" "+oa[b].o+" ":"")+d)});f.Va=g||oa[b].w}else a[b].clause&&(f.Va=na(c(a[b].clause),e));f.Qg=a[b].clauseOptional||!1;a[b].statement1?f.$=e.h.map(function(d,f){return na(c(a[b].statement1),e,f)}).join(""):a[b].statement&&(f.$=na(c(a[b].statement),e));a[b].error&&(f.Va=na(c(a.error.error),e));return f})});return e};function je(a){this.P=new DOMParser;this.b=this.P.parseFromString(a,"text/xml");this.g=this.b.documentElement;this.Aa=(this.g.getAttribute("viewBox")||"0 0 1 1").split(" ").map(function(a){return parseFloat(a)});this.w={}}
var ke={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgreen:"#006400",
darkgrey:"#A9A9A9",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",
ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",green:"#008000",greenyellow:"#ADFF2F",grey:"#808080",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgreen:"#90EE90",lightgrey:"#D3D3D3",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",
lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",
moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",
seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"};function le(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}function me(a){var b={};le(b,a);return b}
function ne(a,b){b.split(";").forEach(function(b){b=b.trim().split(":").map(function(a){return a.trim()});2===b.length&&(a[b[0]]=b[1])})}
function oe(a,b,c,d,e){a&&(a=a.replace(/\s*\(\s*/g,"(").replace(/\s*\)\s*/g,")").replace(/ +,/g,",").replace(/, +/g,",").replace(/ +/g,","),a.split(")").slice(0,-1).forEach(function(a){var f=a.split("(")[0];a=a.split("(")[1].split(",").map(function(a){return parseFloat(a)});switch(f){case "translate":b(a[0]||0,a[1]||0);break;case "rotate":f=(a[0]||0)*Math.PI/180;var h=a[1]||0;a=a[2]||0;0!==h||0!==a?(b(-h,-a),c(f),b(h,a)):c(f);break;case "scale":f=a[0]||1;d(f,a[1]||f);break;case "matrix":e(a[0],a[1],
a[2],a[3],a[4],a[5]);break;default:throw"transform not implemented: "+f;}}))}function pe(a,b){oe(a,function(a,d){b.translate(a,d)},function(a){b.rotate(a)},function(a,d){b.scale(a,d)},function(a,d,e,f,g,h){b.ne(a,d,e,f,g,h)})}
je.prototype.G=function(a,b){function c(e,m,p){function t(){for(var a=0;a<e.childElementCount;a++)c(e.children[a],m,p)}function w(a,b){a=e.getAttribute(a);return null===a?b||0:parseFloat(a)}function A(a,b){a=k.apply(new qe(a,b));q.push(a.x);n.push(a.y)}function y(a,b,c){if(null==a||""==a)return b;a=/^\s*(-?[0-9.]+)\s*([a-z%]*)\s*$/i.exec(a);b=parseFloat(a[1]);switch(a[2]||"px"){case "pt":return 25.4*b/72*3;case "pc":return 25.4*b/6*3;case "in":return 25.4*b*3;case "mm":return 3*b;case "cm":return 30*
b;case "em":return 18*b;case "ex":return 9*b;case "%":return b*c/100;default:return b}}function u(c){c=c.replace(/\.([0-9]+)(?=\.)/g,".$1 ").replace(/([.0-9])-/g,"$1 -").replace(/\s*([a-z])\s*/gi,";$1").replace(/\s*,\s*/g,",").replace(/\s+/g,",");var e=0,f=0,g=0,h=0,l=[],k=[],m=!0;a&&a.beginPath();c.slice(1).split(";").forEach(function(c){var p=c[0];c=1<c.length?c.slice(1).split(",").map(function(a){return parseFloat(a)}):[];switch(p){case "M":if(2<=c.length){e=c[0];f=c[1];a&&a.moveTo(e,f);A(e,f);
m&&1<l.length&&b&&b.ua&&b.ua.line&&b.ua.line(l,k,!1);m=!0;l=q.slice(-1);k=n.slice(-1);for(p=2;p+1<c.length;p+=2)e=c[p],f=c[p+1],a&&a.lineTo(e,f),A(e,f),l.push(q[q.length-1]),k.push(n[n.length-1]);g=e;h=f}break;case "m":if(2<=c.length)for(e+=c[0],f+=c[1],a&&a.moveTo(e,f),A(e,f),m&&1<l.length&&b&&b.ua&&b.ua.line&&b.ua.line(l,k,!1),m=!0,l=q.slice(-1),k=n.slice(-1),p=2;p+1<c.length;p+=2)e+=c[p],f+=c[p+1],a&&a.lineTo(e,f),A(e,f),l.push(q[q.length-1]),k.push(n[n.length-1]);g=e;h=f;break;case "L":for(p=
0;p+1<c.length;p+=2)e=c[p],f=c[p+1],a&&a.lineTo(e,f),A(e,f),l.push(q[q.length-1]),k.push(n[n.length-1]);g=e;h=f;break;case "l":for(p=0;p+1<c.length;p+=2)e+=c[p],f+=c[p+1],a&&a.lineTo(e,f),A(e,f),l.push(q[q.length-1]),k.push(n[n.length-1]);g=e;h=f;break;case "H":for(p=0;p<c.length;p++)e=c[p],a&&a.lineTo(e,f),A(e,f),l.push(q[q.length-1]),k.push(n[n.length-1]);g=e;h=f;break;case "h":for(p=0;p<c.length;p++)e+=c[p],a&&a.lineTo(e,f),A(e,f),l.push(q[q.length-1]),k.push(n[n.length-1]);g=e;h=f;break;case "V":for(p=
0;p<c.length;p++)f=c[p],a&&a.lineTo(e,f),A(e,f),l.push(q[q.length-1]),k.push(n[n.length-1]);g=e;h=f;break;case "v":for(p=0;p<c.length;p++)f+=c[p],a&&a.lineTo(e,f),A(e,f),l.push(q[q.length-1]),k.push(n[n.length-1]);g=e;h=f;break;case "A":for(p=0;p+6<c.length;p+=7){var t=c[p+5],w=c[p+6],aa=d(c[p],c[p+1],c[p+2]*Math.PI/180,0!=c[p+3],0==c[p+4],e,f,t,w);e=t;f=w;A(aa.x,aa.y);A(e,f);m=!1}g=e;h=f;break;case "a":for(p=0;p+6<c.length;p+=7)t=e+c[p+5],w=f+c[p+6],aa=d(c[p],c[p+1],c[p+2]*Math.PI/180,0!=c[p+3],
0==c[p+4],e,f,t,w),e=t,f=w,A(aa.x,aa.y),A(e,f),m=!1;g=e;h=f;break;case "C":for(p=0;p+5<c.length;p+=6)a&&a.bezierCurveTo(c[p],c[p+1],c[p+2],c[p+3],c[p+4],c[p+5]),e=c[p+4],f=c[p+5],g=2*e-c[p+2],h=2*f-c[p+3],A(e,f),m=!1;break;case "c":for(p=0;p+5<c.length;p+=6)a&&a.bezierCurveTo(e+c[p],f+c[p+1],e+c[p+2],f+c[p+3],e+c[p+4],f+c[p+5]),g=e+2*c[p+4]-c[p+2],h=f+2*c[p+5]-c[p+3],e+=c[p+4],f+=c[p+5],A(e,f),m=!1;break;case "S":for(p=0;p+3<c.length;p+=4)a&&a.bezierCurveTo(g,h,c[p],c[p+1],c[p+2],c[p+3]),e=c[p+2],
f=c[p+3],g=2*e-c[p],h=2*f-c[p+1],A(e,f),m=!1;break;case "s":for(p=0;p+3<c.length;p+=4)a&&a.bezierCurveTo(g,h,e+c[p],f+c[p+1],e+c[p+2],f+c[p+3]),g=e-c[p],h=f-c[p+1],e+=c[p+2],f+=c[p+3],A(e,f),m=!1;break;case "Q":for(p=0;p+3<c.length;p+=4)a&&a.quadraticCurveTo(c[p],c[p+1],c[p+2],c[p+3]),e=c[p+2],f=c[p+3],g=2*e-c[p],h=2*f-c[p+1],A(e,f),m=!1;break;case "q":for(p=0;p+3<c.length;p+=4)a&&a.quadraticCurveTo(e+c[p],f+c[p+1],e+c[p+2],f+c[p+3]),g=e+2*c[p+2]-c[p],h=f+2*c[p+3]-c[p+1],e+=c[p+2],f+=c[p+3],A(e,f),
m=!1;break;case "T":for(p=0;p+1<c.length;p+=2)a&&a.quadraticCurveTo(g,h,c[p],c[p+1]),e=c[p],f=c[p+1],g=2*e-g,h=2*f-h,A(e,f),m=!1;break;case "t":for(p=0;p+1<c.length;p+=2)a&&a.quadraticCurveTo(g,h,e+c[p],f+c[p+1]),e+=c[p],f+=c[p+1],g=2*e-g,h=2*f-h,A(e,f),m=!1;break;case "Z":case "z":a&&a.closePath();m&&1<l.length&&b&&b.ua&&b.ua.line&&b.ua.line(l,k,!0);m=!0;l=[];k=[];break;default:throw"unimplemented path command: "+p;}});m&&1<l.length&&b&&b.ua&&b.ua.line&&b.ua.line(l,k,!1)}function I(b){function c(a,
b){if(0<b.length){a.splice(0,a.length);for(var c=0;c<b.length&&1>c;c++){var d=(b[c].getAttribute("offset")||"0").trim(),e=/%$/.test(d)?parseFloat(d.slice(0,-1))/100:parseFloat(d),f=b[c].getAttribute("style");d={};f&&ne(d,f);isNaN(e)||(f=b[c].getAttribute("stop-color")||d["stop-color"]||"#000",ke.hasOwnProperty(f)&&(f=ke[f]),d=(b[c].getAttribute("stop-opacity")||d["stop-opacity"]||"1").trim(),d=/%$/.test(d)?parseFloat(d.slice(0,-1))/100:parseFloat(d),1!==d&&(/^#[0-9a-f]{3}$/i.test(f)?f="rgba("+f.slice(1).split("").map(function(a){return 17*
parseInt(a,16)}).map(function(a){return a.toString(10)}).join(",")+","+d.toFixed(2)+")":/^#[0-9a-f]{6}$/i.test(f)?f="rgba("+[f.slice(1,3),f.slice(3,5),f.slice(5)].map(function(a){return parseInt(a,16)}).map(function(a){return a.toString(10)}).join(",")+","+d.toFixed(2)+")":/^rgb(\d+%?(,|\s+)\d+%?(,|\s+)\d+%?)$/i.test(f)?f=f.slice(0,-1).replace(/\s+/g,",")+","+d.toFixed(2)+")":/^hsl(\d+%?(,|\s+)\d+%?(,|\s+)\d+%?)$/i.test(f)&&(f=f.slice(0,-1).replace(/\s+/g,",")+","+d.toFixed(2)+")")),a.push({offset:e,
color:f}))}}}function d(a,b){if(a.attributes["xlink:href"]){var e=a.getAttribute("xlink:href");"#"===e[0]&&(e=l.b.getElementById(e.slice(1)))&&(b=d(e,b))}b.ad=a.attributes.x1?parseFloat(a.getAttribute("x1")):b.ad||0;b.cd=a.attributes.y1?parseFloat(a.getAttribute("y1")):b.cd||0;b.bd=a.attributes.x2?parseFloat(a.getAttribute("x2")):b.bd||0;b.dd=a.attributes.y2?parseFloat(a.getAttribute("y2")):b.dd||0;b.rc=a.attributes.gradientUnits?a.getAttribute("gradientUnits"):b.rc||"objectBoundingBox";b.Ib=a.attributes.gradientTransform?
a.getAttribute("gradientTransform"):b.Ib||"";b.bb=b.bb||[];c(b.bb,a.getElementsByTagName("stop"));return b}function e(a,b){if(a.attributes["xlink:href"]){var d=a.getAttribute("xlink:href");"#"===d[0]&&(d=l.b.getElementById(d.slice(1)))&&(b=e(d,b))}b.mc=a.attributes.cx?parseFloat(a.getAttribute("cx")):b.mc||0;b.nc=a.attributes.cy?parseFloat(a.getAttribute("cy")):b.nc||0;b.r=a.attributes.r?parseFloat(a.getAttribute("r")):b.r||0;b.rc=a.attributes.gradientUnits?a.getAttribute("gradientUnits"):b.rc||"objectBoundingBox";
b.Ib=a.attributes.gradientTransform?a.getAttribute("gradientTransform"):b.Ib||"";b.bb=b.bb||[];c(b.bb,a.getElementsByTagName("stop"));return b}var f=/^url\(#(.+)\)$/.exec(b);if(f&&f[1]&&(f=l.b.getElementById(f[1])))switch(f.tagName){case "linearGradient":b=d(f,{});if("objectBoundingBox"===b.rc)throw"objectBoundingBox not supported";if(b.Ib)throw f=new re,pe(b.Ib,f),"gradientTransform not supported";var g=a.createLinearGradient(b.ad,b.cd,b.bd,b.dd);for(f=0;f<b.bb.length;f++)g.addColorStop(b.bb[f].offset,
b.bb[f].color);return g;case "radialGradient":b=e(f,{});if("objectBoundingBox"===b.rc)throw"objectBoundingBox not supported";b.Ib&&(f=new re,pe(b.Ib,f),g=se(f,{x:b.mc,y:b.nc}),f=b.r/Math.sqrt(Math.abs(f.b[0]*f.b[4])),b.mc=g.x,b.nc=g.y,b.r=f);g=a.createRadialGradient(b.mc,b.nc,0,b.mc,b.nc,b.r);for(f=0;f<b.bb.length;f++)g.addColorStop(b.bb[f].offset,b.bb[f].color);return g}return b}function M(b,c,d,e,f,g){0>=f||0>=g?a.rect(b,c,d,e):(f=Math.min((f+g)/2,Math.min(d,e)/2),a.moveTo(b+d-f,c),a.arc(b+d-f,
c+f,f,1.5*Math.PI,2*Math.PI),a.lineTo(b+d,c+e-f),a.arc(b+d-f,c+e-f,f,0,.5*Math.PI),a.lineTo(b+f,c+e),a.arc(b+f,c+e-f,f,.5*Math.PI,Math.PI),a.lineTo(b,c+f),a.arc(b+f,c+f,f,Math.PI,1.5*Math.PI),a.closePath())}function P(){if(a){var b=(m||"")+";"+(p||""),c={};b&&ne(c,b);"hidden"!==c.visibility&&(c.opacity&&(a.globalAlpha*=parseFloat(c.opacity)),c.fill&&"none"===c.fill||(a.fillStyle="white"===c.fill||"#fff"===c.fill||"#ffffff"===c.fill?"white":I(c.fill)||"none",a.fill()),c.stroke&&"none"!==c.stroke&&
(a.lineWidth=y(c["stroke-width"]||"1px",1,100),a.strokeStyle=c.stroke||"none",a.miterLimit=c["stroke-miterlimit"]||4,a.lineJoin=c["stroke-linejoin"]||"miter",a.lineCap=c["stroke-linecap"]||"butt",c["stroke-dasharray"]&&(a.setLineDash(c["stroke-dasharray"].split(" ").map(function(a){return parseFloat(a)})),a.lineDashOffset=c["stroke-dashoffset"]?parseFloat(c["stroke-dashoffset"]):0),a.stroke()))}}function qa(c,d,e){if(a){var f=(m||"")+";"+(p||""),g={};f&&ne(g,f);"hidden"!==g.visibility&&(a.font=(g["font-size"]||
"12px")+" "+(g["font-family"]||"helvetica"),g.fill&&"none"!==g.fill&&(a.fillStyle="white"===g.fill||"#fff"===g.fill||"#ffffff"===g.fill?"white":b&&b.fill||"silver",a.fillText(c,d,e)),g.stroke&&"none"!==g.stroke&&(a.strokeStyle=b&&b.stroke||"black",a.strokeText(c,d,e)))}}function Cb(b,c){b=te({x:b,y:c});a.save();a.strokeStyle="black";a.lineWidth=1;a.strokeRect(b.U,b.V,b.na-b.U,b.ka-b.V);a.restore()}var C=e.getAttribute("id"),Rb=C&&b&&b.gd&&b.gd[C];C=C&&b&&b.Be&&b.Be[C];a&&a.save();k.save();Rb&&a&&
f(e,Rb);C&&a&&g(e,C);(function(){var a=(b&&b.Sf||"")+";"+(e.getAttribute("style")||""),c=e.getAttribute("class");c&&r.hasOwnProperty(c)&&(a=r[c]+";"+a);m=(m||"")+";"+a;(a=e.getAttribute("stroke-dasharray"))&&(m+=";stroke-dasharray:"+a.split(",").join(" "));(a=e.getAttribute("stroke-dashoffset"))&&(m+=";stroke-dashoffset:"+a);(a=e.getAttribute("id"))&&b&&b.style&&b.style.hasOwnProperty(a)&&(p=(p||"")+";"+b.style[a])})();Rb=q.length;switch(e.tagName){case "svg":k.save();h(e.getAttribute("transform"));
t();k.restore();break;case "g":k.save();h(e.getAttribute("transform"));t();k.restore();break;case "path":a&&a.save();k.save();h(e.getAttribute("transform"));u(e.getAttribute("d")||"");P();a&&a.restore();k.restore();break;case "line":C=w("x1");var D=w("y1"),W=w("x2"),aa=w("y2");a&&a.save();k.save();h(e.getAttribute("transform"));a&&a.beginPath();a&&a.moveTo(C,D);a&&a.lineTo(W,aa);P();A(C,D);A(W,aa);b&&b.ua&&b.ua.line&&b.ua.line([C,W],[D,aa],!1);a&&a.restore();k.restore();break;case "polygon":case "polyline":C=
e.getAttribute("points").trim().replace(/\s+/g," ").split(" ").map(function(a){return parseFloat(a)});if(4<=C.length){a&&a.save();k.save();h(e.getAttribute("transform"));a&&a.beginPath();a&&a.moveTo(C[0],C[1]);A(C[0],C[1]);for(D=2;D+1<C.length;D+=2)a&&a.lineTo(C[D],C[D+1]),A(C[D],C[D+1]);"polygon"===e.tagName&&a.closePath();P();b&&b.ua&&b.ua.line&&b.ua.line(q.slice(-C.length/2),n.slice(-C.length/2),"polygon"===e.tagName);a&&a.restore();k.restore()}break;case "circle":C=w("cx");D=w("cy");W=w("r");
a&&a.save();k.save();h(e.getAttribute("transform"));a&&a.beginPath();a&&a.arc(C,D,W,0,2*Math.PI);P();A(C-W,D-W);A(C-W,D+W);A(C+W,D-W);A(C+W,D+W);b&&b.ua&&b.ua.Ae&&(C=q.slice(-4),D=n.slice(-4),W=(C[3]-C[0])*(C[3]-C[0])+(D[3]-D[0])*(D[3]-D[0]),aa=(C[2]-C[1])*(C[2]-C[1])+(D[2]-D[1])*(D[2]-D[1]),.001>Math.abs(W-aa)/(W+aa)&&.001>((C[3]-C[0])*(C[2]-C[1])+(D[3]-D[0])*(D[2]-D[1]))/W&&b.ua.Ae((C[0]+C[2])/2,(D[0]+D[2])/2,Math.sqrt(W/8)));a&&a.restore();k.restore();break;case "rect":C=w("x");D=w("y");W=w("width");
aa=w("height");var Fd=w("rx"),Ua=w("ry",Fd);Fd=w("rx",Ua);a&&a.save();k.save();h(e.getAttribute("transform"));a&&(a.beginPath(),0<Fd||0<Ua?M(C,D,W,aa,Fd,Ua):a.rect(C,D,W,aa));P();A(C,D);A(C,D+aa);A(C+W,D);A(C+W,D+aa);a&&a.restore();k.restore();break;case "text":C=w("x"),D=w("y"),a&&a.save(),k.save(),h(e.getAttribute("transform")),qa(e.textContent,C,D),A(C,D),a&&a.restore(),k.restore()}a&&a.restore();k.restore();a&&b&&b.Rf&&Cb(q.slice(Rb),n.slice(Rb))}function d(b,c,d,e,f,g,h,l,k){if(0===b||0===c)return a&&
a.lineTo(l,k),new qe(l,k);var m=Math.cos(d),n=Math.sin(d),p=(m*g+n*h)/b;h=(-n*g+m*h)/c;g=(m*l+n*k)/b;l=(-n*l+m*k)/c;k=(g-p)/2;m=(l-h)/2;n=k*k+m*m;n=Math.sqrt((1-n)/n);isNaN(n)?n=0:e===f&&(n=-n);e=(p+g)/2+n*m;k=(h+l)/2-n*k;p=Math.atan2((h-k)/b,(p-e)/c);h=Math.atan2((l-k)/b,(g-e)/c);a&&(a.rotate(d),a.scale(b,c),f?a.arc(e,k,1,p,h,!0):a.arc(e,k,1,p,h),a.scale(1/b,1/c),a.rotate(-d));g=new re;g.rotate(d);g.scale(b,c);b=f?p<h?(p+h)/2+Math.PI:(p+h)/2:p<h?(p+h)/2:(p+h)/2+Math.PI;return g.apply(new qe(e+Math.cos(b),
k+Math.sin(b)))}function e(a){switch(a.tagName){case "svg":case "defs":for(var b=0;b<a.childElementCount;b++)e(a.children[b]);break;case "style":m+=a.textContent}}function f(b,c){if(c.Xa&&0!=c.Xa){var d=c.Jd,e=c.Kd;if(void 0==d||void 0==e)d=l.G(null,{element:b}),b=te(d),d=(b.U+b.na)/2,e=(b.V+b.ka)/2;a.translate(d+(c.Cb||0),e+(c.Db||0));a.rotate(c.Xa);a.translate(-d,-e)}else(c.Cb||c.Db)&&a.translate(c.Cb,c.Db)}function g(b,c){a.beginPath();a.rect(c.x,c.y,c.Ic,c.zc);a.clip()}function h(b){oe(b,function(b,
c){a&&a.translate(b,c);k.translate(b,c)},function(b){a&&a.rotate(b);k.rotate(b)},function(b,c){a&&a.scale(b,c);k.scale(b,c)},function(b,c,d,e,f,g){a&&a.transform(b,c,d,e,f,g);k.ne(b,c,d,e,f,g)})}var l=this,m="",r={},k=new ue,q=[],n=[];e(this.g);(function(){m.split("}").forEach(function(a){var b=a.split("{");b[0].split(",").forEach(function(a){a=a.trim();/^\.[-a-z0-9]+/i.test(a)&&(a=a.slice(1),r[a]=r[a]?r[a]+";"+b[1]:b[1])})})})();var p=this.g;b&&b.wd?p=this.b.getElementById(b.wd):b&&b.element&&(p=
b.element);if(p){b&&b.Ie&&b.Ie(a,this.Aa);if(a){for(var u=[],y=p.parentElement;null!=y;y=y.parentElement)u.push(y);for(y=u.length-1;0<=y;y--){var I=u[y].getAttribute("id");(I=I&&b&&b.gd&&b.gd[I])&&f(u[y],I);I=u[y].getAttribute("transform");h(I)}}c(p)}return{x:q,y:n}};
function te(a){if(0===a.x.length)return{U:0,na:0,V:0,ka:0};for(var b=a.x[0],c=a.x[0],d=a.y[0],e=a.y[0],f=1;f<a.x.length;f++)b=Math.min(b,a.x[f]),c=Math.max(c,a.x[f]),d=Math.min(d,a.y[f]),e=Math.max(e,a.y[f]);return{U:b,na:c,V:d,ka:e}}function ve(a,b){if(a.w[b])return a.w[b];var c=a.G(null,{wd:b});c=te(c);return a.w[b]=c}je.prototype.jd=function(a,b,c){a=ve(this,a);return b>=a.U&&b<=a.na&&c>=a.V&&c<=a.ka};je.prototype.dc=function(a){return null!=this.b.getElementById(a)};
je.prototype.kf=function(a,b){a=this.b.getElementById(a);b=this.b.getElementById(b);return null!=b&&null!=a&&b.contains(a)};function we(a){je.call(this,a);this.l={};this.L={};this.o={};xe(this)}we.prototype=Object.create(je.prototype);we.prototype.constructor=we;
function xe(a){function b(a){switch(a.tagName){case "svg":case "defs":for(var c=0;c<a.childElementCount;c++)b(a.children[c]);break;case "style":f+=a.textContent}}function c(a){return a?(a=a.replace(/\s*\(\s*/g,"(").replace(/\s*\)\s*/g,")").replace(/ +,/g,",").replace(/, +/g,",").replace(/ +/g,","),a.split(")").slice(0,-1).map(function(a){var b=a.split("(")[0];a=a.split("(")[1].split(",").map(function(a){return parseFloat(a)});switch(b){case "translate":return{Wa:b,B:[a[0]||0,a[1]||0]};case "rotate":return{Wa:b,
B:[(a[0]||0)*Math.PI/180,a[1]||0,a[2]||0]};case "scale":var c=a[0]||1;return{Wa:b,B:[c,a[1]||c]};case "matrix":return{Wa:b,B:a};default:throw"transform not implemented: "+b;}})):null}function d(a,b){function f(b){for(var c=[],e=0;e<a.childElementCount;e++){var f=d(a.children[e],b);f&&c.push(f)}return c}function g(b,c){b=a.getAttribute(b);return null===b?c||0:parseFloat(b)}function h(a){a=a.replace(/\.([0-9]+)(?=\.)/g,".$1 ").replace(/([.0-9])-/g,"$1 -").replace(/\s*([a-z])\s*/gi,";$1").replace(/\s*,\s*/g,
",").replace(/\s+/g,",");var b=[],c=0,d=0,e=0,f=0;a.slice(1).split(";").forEach(function(a){var g=a[0];a=1<a.length?a.slice(1).split(",").map(function(a){return parseFloat(a)}):[];switch(g){case "M":if(2<=a.length){c=a[0];d=a[1];b.push({Wa:"M",B:[c,d]});for(g=2;g+1<a.length;g+=2)c=a[g],d=a[g+1],b.push({Wa:"L",B:[c,d]});e=c;f=d}break;case "m":if(2<=a.length)for(c+=a[0],d+=a[1],b.push({Wa:"M",B:[c,d]}),g=2;g+1<a.length;g+=2)c+=a[g],d+=a[g+1],b.push({Wa:"L",B:[c,d]});e=c;f=d;break;case "L":for(g=0;g+
1<a.length;g+=2)c=a[g],d=a[g+1],b.push({Wa:"L",B:[c,d]});e=c;f=d;break;case "l":for(g=0;g+1<a.length;g+=2)c+=a[g],d+=a[g+1],b.push({Wa:"L",B:[c,d]});e=c;f=d;break;case "H":for(g=0;g<a.length;g++)c=a[g],b.push({Wa:"L",B:[c,d]});e=c;f=d;break;case "h":for(g=0;g<a.length;g++)c+=a[g],b.push({Wa:"L",B:[c,d]});e=c;f=d;break;case "V":for(g=0;g<a.length;g++)d=a[g],b.push({Wa:"L",B:[c,d]});e=c;f=d;break;case "v":for(g=0;g<a.length;g++)d+=a[g],b.push({Wa:"L",B:[c,d]});e=c;f=d;break;case "A":for(g=0;g+6<a.length;g+=
7){var h=a[g+5],l=a[g+6];b.push({Wa:"A",B:[a[g],a[g+1],a[g+2]*Math.PI/180,0!=a[g+3]?1:0,0==a[g+4]?1:0,c,d,h,l]});c=h;d=l}e=c;f=d;break;case "a":for(g=0;g+6<a.length;g+=7)h=c+a[g+5],l=d+a[g+6],b.push({Wa:"A",B:[a[g],a[g+1],a[g+2]*Math.PI/180,0!=a[g+3],0==a[g+4],c,d,h,l]}),c=h,d=l;e=c;f=d;break;case "C":for(g=0;g+5<a.length;g+=6)b.push({Wa:"C",B:a.slice(g,g+6)}),c=a[g+4],d=a[g+5],e=2*c-a[g+2],f=2*d-a[g+3];break;case "c":for(g=0;g+5<a.length;g+=6)b.push({Wa:"C",B:[c+a[g],d+a[g+1],c+a[g+2],d+a[g+3],c+
a[g+4],d+a[g+5]]}),e=c+2*a[g+4]-a[g+2],f=d+2*a[g+5]-a[g+3],c+=a[g+4],d+=a[g+5];break;case "S":for(g=0;g+3<a.length;g+=4)b.push({Wa:"S",B:[e,f,a[g],a[g+1],a[g+2],a[g+3]]}),c=a[g+2],d=a[g+3],e=2*c-a[g],f=2*d-a[g+1];break;case "s":for(g=0;g+3<a.length;g+=4)b.push({Wa:"S",B:[e,f,c+a[g],d+a[g+1],c+a[g+2],d+a[g+3]]}),e=c-a[g],f=d-a[g+1],c+=a[g+2],d+=a[g+3];break;case "Q":for(g=0;g+3<a.length;g+=4)b.push({Wa:"Q",B:[a[g],a[g+1],a[g+2],a[g+3]]}),c=a[g+2],d=a[g+3],e=2*c-a[g],f=2*d-a[g+1];break;case "q":for(g=
0;g+3<a.length;g+=4)b.push({Wa:"Q",B:[c+a[g],d+a[g+1],c+a[g+2],d+a[g+3]]}),e=c+2*a[g+2]-a[g],f=d+2*a[g+3]-a[g+1],c+=a[g+2],d+=a[g+3];break;case "T":for(g=0;g+1<a.length;g+=2)b.push({Wa:"Q",B:[e,f,a[g],a[g+1]]}),c=a[g],d=a[g+1],e=2*c-e,f=2*d-f;break;case "t":for(g=0;g+1<a.length;g+=2)b.push({Wa:"Q",B:[e,f,c+a[g],d+a[g+1]]}),c+=a[g],d+=a[g+1],e=2*c-e,f=2*d-f;break;case "Z":case "z":b.push({Wa:"Z",B:[]});break;default:throw"unimplemented path command: "+g;}});return b}var k=a.getAttribute("id"),q=function(){var b=
a.getAttribute("style")||"",c=a.getAttribute("class");c&&e.o.hasOwnProperty(c)&&(b=e.o[c]+";"+b);c={};ne(c,b);(b=a.getAttribute("stroke-dasharray"))&&(c["stroke-dasharray"]=b.split(","));(b=a.getAttribute("stroke-dashoffset"))&&(c["stroke-dashoffset"]=b);(b=a.getAttribute("id"))&&(c.id=b);return c}();b={name:a.tagName,id:k,style:q,parent:b};switch(a.tagName){case "svg":b.children=f(b);break;case "g":b.children=f(b);b.transform=c(a.getAttribute("transform"));break;case "path":b.path=h(a.getAttribute("d")||
"");b.transform=c(a.getAttribute("transform"));break;case "line":b.ad=g("x1");b.cd=g("y1");b.bd=g("x2");b.dd=g("y2");b.transform=c(a.getAttribute("transform"));break;case "polygon":case "polyline":b.ec=a.getAttribute("points").trim().replace(/\s+/g," ").split(" ").map(function(a){return parseFloat(a)});b.transform=c(a.getAttribute("transform"));break;case "circle":b.x=g("cx");b.y=g("cy");b.r=g("r");b.transform=c(a.getAttribute("transform"));break;case "rect":b.x=g("x");b.y=g("y");b.width=g("width");
b.height=g("height");k=g("rx");q=g("ry",k);k=g("rx",q);b.kg=k;b.lg=q;b.transform=c(a.getAttribute("transform"));break;case "text":b.x=g("x");b.y=g("y");b.text=a.textContent;b.transform=c(a.getAttribute("transform"));break;default:return null}return b}var e=a,f="";b(a.g);a.o=function(){var a={};f.split("}").forEach(function(b){var c=b.split("{");c[0].split(",").forEach(function(b){b=b.trim();/^\.[-a-z0-9]+/i.test(b)&&(b=b.slice(1),a[b]=a[b]?a[b]+";"+c[1]:c[1])})});return a}();a.g&&(a.l=d(a.g,null))}
function ye(a,b){function c(a,b){if(a.id===b)return a;if(a.children)for(var d=0;d<a.children.length;d++){var e=c(a.children[d],b);if(e)return e}return null}if(a.L[b])return a.L[b];var d=c(a.l,b);d&&(a.L[b]=d);return d}
function ze(a,b,c,d,e){a&&a.forEach(function(a){switch(a.Wa){case "translate":b(a.B[0],a.B[1]);break;case "rotate":0!==a.B[1]||0!==a.B[2]?(b(-a.B[1],-a.B[2]),c(a.B[0]),b(a.B[1],a.B[2])):c(a.B[0]);break;case "scale":d(a.B[0],a.B[1]);break;case "matrix":e(a.B[0],a.B[1],a.B[2],a.B[3],a.B[4],a.B[5])}})}
we.prototype.G=function(a,b){function c(k,n,q){function p(){for(var a=0;a<k.children.length;a++)c(k.children[a],n,q)}function t(a,b){a=h.apply(new qe(a,b));l.push(a.x);m.push(a.y)}function r(a,b,c){if(null==a||""==a)return b;a=/^\s*(-?[0-9.]+)\s*([a-z%]*)\s*$/i.exec(a);b=parseFloat(a[1]);switch(a[2]||"px"){case "pt":return 25.4*b/72*3;case "pc":return 25.4*b/6*3;case "in":return 25.4*b*3;case "mm":return 3*b;case "cm":return 30*b;case "em":return 18*b;case "ex":return 9*b;case "%":return b*c/100;
default:return b}}function y(c){var d=0,e=0,f=[],g=[],h=!0;a&&a.beginPath();c.forEach(function(c){switch(c.Wa){case "M":2<=c.B.length&&(d=c.B[0],e=c.B[1],a&&a.moveTo(d,e),t(d,e),h&&1<f.length&&b&&b.ua&&b.ua.line&&b.ua.line(f,g,!1),h=!0,f=l.slice(-1),g=m.slice(-1));break;case "L":d=c.B[0];e=c.B[1];a&&a.lineTo(d,e);t(d,e);f.push(l[l.length-1]);g.push(m[m.length-1]);break;case "A":var k=c.B[5],n=c.B[6];var p=c.B[0];var aa=c.B[1],q=c.B[2],r=0!=c.B[3],C=0!=c.B[4],y=c.B[5],u=c.B[6],w=c.B[7],I=c.B[8];if(0===
p||0===aa)a&&a.lineTo(w,I),p=new qe(w,I);else{var Ua=Math.cos(q),A=Math.sin(q);c=(Ua*y+A*u)/p;u=(-A*y+Ua*u)/aa;y=(Ua*w+A*I)/p;w=(-A*w+Ua*I)/aa;I=(y-c)/2;Ua=(w-u)/2;A=I*I+Ua*Ua;A=Math.sqrt((1-A)/A);isNaN(A)?A=0:r===C&&(A=-A);r=(c+y)/2+A*Ua;I=(u+w)/2-A*I;c=Math.atan2((u-I)/p,(c-r)/aa);u=Math.atan2((w-I)/p,(y-r)/aa);a&&(a.rotate(q),a.scale(p,aa),C?a.arc(r,I,1,c,u,!0):a.arc(r,I,1,c,u),a.scale(1/p,1/aa),a.rotate(-q));y=new re;y.rotate(q);y.scale(p,aa);p=C?c<u?(c+u)/2+Math.PI:(c+u)/2:c<u?(c+u)/2:(c+u)/
2+Math.PI;p=y.apply(new qe(r+Math.cos(p),I+Math.sin(p)))}d=k;e=n;t(p.x,p.y);t(d,e);h=!1;break;case "C":a&&a.bezierCurveTo(c.B[0],c.B[1],c.B[2],c.B[3],c.B[4],c.B[5]);d=c.B[4];e=c.B[5];t(d,e);h=!1;break;case "S":a&&a.bezierCurveTo(c.B[0],c.B[1],c.B[2],c.B[3],c.B[4],c.B[5]);d=c.B[4];e=c.B[5];t(d,e);h=!1;break;case "Q":a&&a.quadraticCurveTo(c.B[0],c.B[1],c.B[2],c.B[3]);d=c.B[2];e=c.B[3];t(d,e);h=!1;break;case "Z":a&&a.closePath(),h&&1<f.length&&b&&b.ua&&b.ua.line&&b.ua.line(f,g,!0),h=!0,f=[],g=[]}});
h&&1<f.length&&b&&b.ua&&b.ua.line&&b.ua.line(f,g,!1)}function u(b){function c(a,b){if(0<b.length){a.splice(0,a.length);for(var c=0;c<b.length&&1>c;c++){var d=(b[c].getAttribute("offset")||"0").trim(),e=/%$/.test(d)?parseFloat(d.slice(0,-1))/100:parseFloat(d),f=b[c].getAttribute("style");d={};f&&ne(d,f);isNaN(e)||(f=b[c].getAttribute("stop-color")||d["stop-color"]||"#000",ke.hasOwnProperty(f)&&(f=ke[f]),d=(b[c].getAttribute("stop-opacity")||d["stop-opacity"]||"1").trim(),d=/%$/.test(d)?parseFloat(d.slice(0,
-1))/100:parseFloat(d),1!==d&&(/^#[0-9a-f]{3}$/i.test(f)?f="rgba("+f.slice(1).split("").map(function(a){return 17*parseInt(a,16)}).map(function(a){return a.toString(10)}).join(",")+","+d.toFixed(2)+")":/^#[0-9a-f]{6}$/i.test(f)?f="rgba("+[f.slice(1,3),f.slice(3,5),f.slice(5)].map(function(a){return parseInt(a,16)}).map(function(a){return a.toString(10)}).join(",")+","+d.toFixed(2)+")":/^rgb(\d+%?(,|\s+)\d+%?(,|\s+)\d+%?)$/i.test(f)?f=f.slice(0,-1).replace(/\s+/g,",")+","+d.toFixed(2)+")":/^hsl(\d+%?(,|\s+)\d+%?(,|\s+)\d+%?)$/i.test(f)&&
(f=f.slice(0,-1).replace(/\s+/g,",")+","+d.toFixed(2)+")")),a.push({offset:e,color:f}))}}}function d(a,b){if(a.attributes["xlink:href"]){var e=a.getAttribute("xlink:href");"#"===e[0]&&(e=g.b.getElementById(e.slice(1)))&&(b=d(e,b))}b.ad=a.attributes.x1?parseFloat(a.getAttribute("x1")):b.ad||0;b.cd=a.attributes.y1?parseFloat(a.getAttribute("y1")):b.cd||0;b.bd=a.attributes.x2?parseFloat(a.getAttribute("x2")):b.bd||0;b.dd=a.attributes.y2?parseFloat(a.getAttribute("y2")):b.dd||0;b.rc=a.attributes.gradientUnits?
a.getAttribute("gradientUnits"):b.rc||"objectBoundingBox";b.Ib=a.attributes.gradientTransform?a.getAttribute("gradientTransform"):b.Ib||"";b.bb=b.bb||[];c(b.bb,a.getElementsByTagName("stop"));return b}function e(a,b){if(a.attributes["xlink:href"]){var d=a.getAttribute("xlink:href");"#"===d[0]&&(d=g.b.getElementById(d.slice(1)))&&(b=e(d,b))}b.mc=a.attributes.cx?parseFloat(a.getAttribute("cx")):b.mc||0;b.nc=a.attributes.cy?parseFloat(a.getAttribute("cy")):b.nc||0;b.r=a.attributes.r?parseFloat(a.getAttribute("r")):
b.r||0;b.rc=a.attributes.gradientUnits?a.getAttribute("gradientUnits"):b.rc||"objectBoundingBox";b.Ib=a.attributes.gradientTransform?a.getAttribute("gradientTransform"):b.Ib||"";b.bb=b.bb||[];c(b.bb,a.getElementsByTagName("stop"));return b}var f=/^url\(#(.+)\)$/.exec(b);if(f&&f[1]&&(f=g.b.getElementById(f[1])))switch(f.tagName){case "linearGradient":b=d(f,{});if("objectBoundingBox"===b.rc)throw"objectBoundingBox not supported";if(b.Ib)throw f=new re,pe(b.Ib,f),"gradientTransform not supported";var h=
a.createLinearGradient(b.ad,b.cd,b.bd,b.dd);for(f=0;f<b.bb.length;f++)h.addColorStop(b.bb[f].offset,b.bb[f].color);return h;case "radialGradient":b=e(f,{});if("objectBoundingBox"===b.rc)throw"objectBoundingBox not supported";b.Ib&&(f=new re,pe(b.Ib,f),h=se(f,{x:b.mc,y:b.nc}),f=b.r/Math.sqrt(Math.abs(f.b[0]*f.b[4])),b.mc=h.x,b.nc=h.y,b.r=f);h=a.createRadialGradient(b.mc,b.nc,0,b.mc,b.nc,b.r);for(f=0;f<b.bb.length;f++)h.addColorStop(b.bb[f].offset,b.bb[f].color);return h}return b}function mb(b,c,d,
e,f,g){0>=f||0>=g?a.rect(b,c,d,e):(f=Math.min((f+g)/2,Math.min(d,e)/2),a.moveTo(b+d-f,c),a.arc(b+d-f,c+f,f,1.5*Math.PI,2*Math.PI),a.lineTo(b+d,c+e-f),a.arc(b+d-f,c+e-f,f,0,.5*Math.PI),a.lineTo(b+f,c+e),a.arc(b+f,c+e-f,f,.5*Math.PI,Math.PI),a.lineTo(b,c+f),a.arc(b+f,c+f,f,Math.PI,1.5*Math.PI),a.closePath())}function Ea(){if(a){var b={};n&&le(b,n);q&&le(b,q);"hidden"!==b.visibility&&(b.opacity&&(a.globalAlpha*=parseFloat(b.opacity)),b.fill&&"none"===b.fill||(a.fillStyle="white"===b.fill||"#fff"===b.fill||
"#ffffff"===b.fill?"white":u(b.fill)||"none",a.fill()),b.stroke&&"none"!==b.stroke&&(a.lineWidth=r(b["stroke-width"]||"1px",1,100),a.strokeStyle=b.stroke||"none",a.miterLimit=b["stroke-miterlimit"]||4,a.lineJoin=b["stroke-linejoin"]||"miter",a.lineCap=b["stroke-linecap"]||"butt",b["stroke-dasharray"]&&(a.setLineDash(b["stroke-dasharray"].split(" ").map(function(a){return parseFloat(a)})),a.lineDashOffset=b["stroke-dashoffset"]?parseFloat(b["stroke-dashoffset"]):0),a.stroke()))}}function Za(c,d,e){if(a){var f=
{};n&&le(f,n);q&&le(f,q);"hidden"!==f.visibility&&(a.font=(f["font-size"]||"12px")+" "+(f["font-family"]||"helvetica"),f.fill&&"none"!==f.fill&&(a.fillStyle="white"===f.fill||"#fff"===f.fill||"#ffffff"===f.fill?"white":b&&b.fill||"silver",a.fillText(c,d,e)),f.stroke&&"none"!==f.stroke&&(a.strokeStyle=b&&b.stroke||"black",a.strokeText(c,d,e)))}}function Aa(b,c){b=te({x:b,y:c});a.save();a.strokeStyle="black";a.lineWidth=1;a.strokeRect(b.U,b.V,b.na-b.U,b.ka-b.V);a.restore()}var ja=k.id&&b&&b.gd&&b.gd[k.id],
M=k.id&&b&&b.Be&&b.Be[k.id];a&&a.save();h.save();ja&&a&&d(k,ja);M&&a&&e(M);n=me(n);q=me(q);k.style&&le(n,k.style);b&&b.Sf&&ne(n,b.Sf);k.id&&b&&b.style&&b.style.hasOwnProperty(k.id)&&ne(q,b.style[k.id]);ja=l.length;switch(k.name){case "svg":h.save();f(k.transform);p();h.restore();break;case "g":h.save();f(k.transform);p();h.restore();break;case "path":a&&a.save();h.save();f(k.transform);y(k.path);Ea();a&&a.restore();h.restore();break;case "line":a&&a.save();h.save();f(k.transform);a&&a.beginPath();
a&&a.moveTo(k.ad,k.cd);a&&a.lineTo(k.bd,k.dd);Ea();t(k.ad,k.cd);t(k.bd,k.dd);b&&b.ua&&b.ua.line&&b.ua.line([k.ad,k.bd],[k.cd,k.dd],!1);a&&a.restore();h.restore();break;case "polygon":case "polyline":if(4<=k.ec.length){a&&a.save();h.save();f(k.transform);a&&a.beginPath();a&&a.moveTo(k.ec[0],k.ec[1]);t(k.ec[0],k.ec[1]);for(M=2;M+1<k.ec.length;M+=2)a&&a.lineTo(k.ec[M],k.ec[M+1]),t(k.ec[M],k.ec[M+1]);"polygon"===k.name&&a&&a.closePath();Ea();b&&b.ua&&b.ua.line&&b.ua.line(l.slice(-k.ec.length/2),m.slice(-k.ec.length/
2),"polygon"===k.name);a&&a.restore();h.restore()}break;case "circle":a&&a.save();h.save();f(k.transform);a&&a.beginPath();a&&a.arc(k.x,k.y,k.r,0,2*Math.PI);Ea();t(k.x-k.r,k.y-k.r);t(k.x-k.r,k.y+k.r);t(k.x+k.r,k.y-k.r);t(k.x+k.r,k.y+k.r);if(b&&b.ua&&b.ua.Ae){M=l.slice(-4);var P=m.slice(-4),qa=(M[3]-M[0])*(M[3]-M[0])+(P[3]-P[0])*(P[3]-P[0]),Cb=(M[2]-M[1])*(M[2]-M[1])+(P[2]-P[1])*(P[2]-P[1]);.001>Math.abs(qa-Cb)/(qa+Cb)&&.001>((M[3]-M[0])*(M[2]-M[1])+(P[3]-P[0])*(P[2]-P[1]))/qa&&b.ua.Ae((M[0]+M[2])/
2,(P[0]+P[2])/2,Math.sqrt(qa/8))}a&&a.restore();h.restore();break;case "rect":a&&a.save();h.save();f(k.transform);a&&(a.beginPath(),0<k.kg||0<k.lg?mb(k.x,k.y,k.width,k.height,k.kg,k.lg):a.rect(k.x,k.y,k.width,k.height));Ea();t(k.x,k.y);t(k.x,k.y+k.height);t(k.x+k.width,k.y);t(k.x+k.width,k.y+k.height);a&&a.restore();h.restore();break;case "text":a&&a.save(),h.save(),f(k.transform),Za(k.text,k.x,k.y),t(k.x,k.y),a&&a.restore(),h.restore()}a&&a.restore();h.restore();a&&b&&b.Rf&&Aa(l.slice(ja),m.slice(ja))}
function d(b,c){if(c.Xa&&0!=c.Xa){var d=c.Jd,e=c.Kd;if(void 0==d||void 0==e)d=g.G(null,{tc:b}),b=te(d),d=(b.U+b.na)/2,e=(b.V+b.ka)/2;a.translate(d+(c.Cb||0),e+(c.Db||0));a.rotate(c.Xa);a.translate(-d,-e)}else(c.Cb||c.Db)&&a.translate(c.Cb,c.Db)}function e(b){a.beginPath();a.rect(b.x,b.y,b.Ic,b.zc);a.clip()}function f(b){ze(b,function(b,c){a&&a.translate(b,c);h.translate(b,c)},function(b){a&&a.rotate(b);h.rotate(b)},function(b,c){a&&a.scale(b,c);h.scale(b,c)},function(b,c,d,e,f,g){a&&a.transform(b,
c,d,e,f,g);h.ne(b,c,d,e,f,g)})}var g=this,h=new ue,l=[],m=[],r=this.l;b&&b.wd?r=ye(this,b.wd):b&&b.tc&&(r=b.tc);if(r){b&&b.Ie&&b.Ie(a,this.Aa);if(a){for(var k=[],q=r.parentElement;null!=q;q=q.parentElement)k.push(q);for(q=k.length-1;0<=q;q--){var n=k[q].id;(n=n&&b&&b.gd&&b.gd[n])&&d(k[q],n);f(k[q].transform)}}c(r,{},{})}return{x:l,y:m}};function Ae(a,b){if(a.id===b)return a;if(a.children)for(var c=0;c<a.children.length;c++){var d=Ae(a.children[c],b);if(d)return d}return null}
we.prototype.dc=function(a){return null!=Ae(this.l,a)};we.prototype.kf=function(a,b){return null!=Ae(Ae(this.l,b),a)};function re(a){this.b=a||[1,0,0,0,1,0]}v=re.prototype;v.kb=function(){return new re(this.b)};v.apply=function(a){return new qe(this.b[0]*a.x+this.b[1]*a.y+this.b[2],this.b[3]*a.x+this.b[4]*a.y+this.b[5])};function se(a,b){var c=a.b[0]*a.b[4]-a.b[3]*a.b[1];return new qe((a.b[4]*b.x-a.b[1]*b.y+a.b[1]*a.b[5]-a.b[4]*a.b[2])/c,(-a.b[3]*b.x+a.b[0]*b.y+a.b[3]*a.b[2]-a.b[0]*a.b[5])/c)}
v.translate=function(a,b){this.b=[this.b[0],this.b[1],this.b[0]*a+this.b[1]*b+this.b[2],this.b[3],this.b[4],this.b[3]*a+this.b[4]*b+this.b[5]]};v.scale=function(a,b){this.b=[this.b[0]*a,this.b[1]*b,this.b[2],this.b[3]*a,this.b[4]*b,this.b[5]]};v.rotate=function(a){var b=Math.cos(a);a=Math.sin(a);this.b=[b*this.b[0]+a*this.b[1],-a*this.b[0]+b*this.b[1],this.b[2],b*this.b[3]+a*this.b[4],-a*this.b[3]+b*this.b[4],this.b[5]]};
v.ne=function(a,b,c,d,e,f){this.b=[a*this.b[0]+c*this.b[1],b*this.b[0]+d*this.b[1],a*this.b[2]+c*this.b[3],b*this.b[2]+d*this.b[3],a*this.b[4]+c*this.b[5]+e,b*this.b[4]+d*this.b[5]+f]};function qe(a,b){this.x=a||0;this.y=b||0}function ue(){this.stack=[new re]}v=ue.prototype;v.apply=function(a){return this.stack[this.stack.length-1].apply(a)};v.save=function(){this.stack.push(this.stack[this.stack.length-1].kb())};v.restore=function(){if(2>this.stack.length)throw"restore doesn't match save";this.stack.pop()};
v.translate=function(a,b){this.stack[this.stack.length-1].translate(a,b)};v.scale=function(a,b){this.stack[this.stack.length-1].scale(a,b)};v.rotate=function(a){this.stack[this.stack.length-1].rotate(a)};v.ne=function(a,b,c,d,e,f){this.stack[this.stack.length-1].ne(a,b,c,d,e,f)};function Vb(a){a=a.split("#");return{Pc:a[0],id:a[1]}}function Be(a,b,c){a.I.save();c.Ie=function(a,b){this.clientData.Pd=b;a.translate(-b[0],-b[1]);a.scale(this.v.j/(b[2]-b[0]),this.v.j/(b[3]-b[1]))}.bind(a);b.G(a.I,c);a.I.restore()}function Ce(a,b,c,d,e){return{x:(a.clientData.Pd[2]-a.clientData.Pd[0])/d*(b+a.clientData.Pd[0]),y:(a.clientData.Pd[3]-a.clientData.Pd[1])/e*(c+a.clientData.Pd[1])}}
function De(a,b,c){var d={},e=(a.buttons?a.buttons.length:0)+(a.radiobuttons?1:0);if(void 0!=a.sliders){for(var f=0;f<a.sliders.length;f++){var g=a.sliders[f],h=ve(b,g.id),l=ve(b,g.thumbId),m=(l.U+l.na)/2,r=(l.V+l.ka)/2;h.na-h.U<h.ka-h.V?(h.U=h.na=(h.U+h.na)/2,m=h.U):(h.V=h.ka=(h.V+h.ka)/2,r=h.V);l=(c[e+f]-g.min)/(g.max-g.min);d[g.thumbId]={Cb:l*(h.na-h.U)-(m-h.U),Db:l*(h.V-h.ka)-(r-h.ka)}}e+=a.sliders.length}if(void 0!=a.rotating)for(f=0;f<a.rotating.length;f++)g=a.rotating[f],l=g.numSteps?2*Math.PI/
g.numSteps:1,h=ve(b,g.centerId),d[g.id]={Xa:c[e+f]*l,Jd:(h.U+h.na)/2,Kd:(h.V+h.ka)/2};return d}function Ee(a,b,c){return Math.min(Math.max((c-a)/(b-a),0),1)}
function Fe(a,b,c,d,e,f,g,h,l){e=Ce(a,l.x-g,l.y-h,e,f);var m=a.clientData.Xc.min+(a.clientData.Xc.max-a.clientData.Xc.min)*Ee(a.clientData.min,a.clientData.max,a.clientData.ce?e.y:e.x),r=a.clientData.Xc.min,k=a.clientData.Xc.max;(e=a.clientData.Xc.discrete)&&0<e.length?m=e.reduce(function(a,b){return Math.abs(m-b)<Math.abs(m-a)?b:a},e[0]):(a=a.clientData.Xc.snap)&&a.forEach(function(a,c){"string"===typeof a&&/^`.+`$/.test(a)&&(a=na(a,b,c,!0));Math.abs(m-a)<Math.abs(k-r)/10&&(m=a)});b.h[(d.buttons?
d.buttons.length:0)+(d.radiobuttons?1:0)+c]=Math.max(Math.min(r,k),Math.min(Math.max(r,k),m))}
function Ge(a,b,c,d){if(0!==c.draw.length){for(var e=null,f=0;f<c.draw.length;f++)if(c.draw[f].uri){e=Vb(c.draw[f].uri).Pc;break}var g=e?De(c,b.sb[e],d.h):{};f=null;if(c.diffwheelmotion&&c.diffwheelmotion.id){f=c.diffwheelmotion;var h=f.id,l=f.dx||0,m=f.dy||0,r=f.adjscale||1,k=f.color||"black",q=void 0===f.linewidth?1:f.linewidth;f=ve(b.sb[e],h);var n=(c.buttons?c.buttons.length:0)+(c.radiobuttons?1:0),p=2.4*d.h[n];n=2.4*d.h[n+1];var u=a.v.j;f=(.5+l)*(f.na-f.U)*r/u;l=Kd(a,p,n,f,{color:k,me:q});g[h]=
{Cb:-(l.x*f*u+m*u*Math.sin(l.Xa)),Db:-(l.y*f*u+m*u*Math.cos(l.Xa)),Xa:-l.Xa};f={Cg:p,Dg:n,Ig:f,color:k,me:q}}c.draw.forEach(function(a){if(a.uri){var f=Vb(a.uri),h=b.sb[f.Pc];f=f.id;for(var k={},l=c.buttons?c.buttons.length:0,n=c.radiobuttons?c.radiobuttons.length:0,m=c.styles?c.styles.length:0,p=0;p<l;p++){var q=c.buttons[p].val,r=c.buttons[p].st;q=q.indexOf(d.h[p]);0<=q&&(k[c.buttons[p].id]=r[q])}for(p=0;p<n;p++)q=c.radiobuttons[p].val,r=c.radiobuttons[p].st,k[c.radiobuttons[p].id]=r[d.h[l]===q?
1:0];for(p=0;p<m;p++)k[c.styles[p].id]=na(c.styles[p].st,d);l=b.sb[e];n=d.h;m={};if(void 0!=c.sliders)for(p=0;p<c.sliders.length;p++){r=c.sliders[p];q=ve(l,r.id);var y=r.lowerPartId&&ve(l,r.lowerPartId);if(y){var u=(n[p]-r.min)/(r.max-r.min),P=y.na-y.U,qa=y.ka-y.V;m[r.lowerPartId]=q.na-q.U<q.ka-q.V?{x:y.U-qa,y:y.V,Ic:P+2*qa,zc:qa*u}:{x:y.U,y:y.V-qa,Ic:P*u,zc:qa+2*P}}}Be(this,h,{wd:f,style:k,gd:g,Be:m,Rf:!1})}a.js&&(a=new Function("ctx","$",a.js),this.I.save(),this.I.scale(this.v.j/1E3,this.v.j/1E3),
this.I.beginPath(),a(this.I,d.h),this.I.restore())},a);f&&Kd(a,f.Cg,f.Dg,f.Ig,{color:f.color,me:f.me});c.score&&c.score.id&&(h=(c.buttons?c.buttons.length:0)+(c.radiobuttons?1:0)+(c.sliders?c.sliders.length:0),m=c.score,k=m.numHeights||5,f=ve(b.sb[e],m.id),q=b.sb[e].Aa,Od(a,d.h.slice(h),(f.U-q[0])/(q[2]-q[0]),(f.na-q[0])/(q[2]-q[0]),(f.ka-q[1])/(q[3]-q[1]),(f.V-q[1])/(q[3]-q[1]),k,(f.ka-f.V)/(q[3]-q[1])/k*(m.noteSize||1),void 0===m.linewidth?1:m.linewidth))}}
function He(a,b,c){function d(a){for(var b=0;b<c.length;b++)if(c[b].name===a)return b;return-1}b.forEach(function(b){var e=b.name;if(!e)throw"Missing block name";var g=d(e),h=0<=g?c[g]:null,l=h?h.type:"?";if(b.type||!h)switch(b.type){case "event":l="e";break;case "action":l="a";break;case "state":l="s";break;case "comment":l="c";break;case "hidden":l="h";break;default:throw"Unknown block type "+b.type+" for block "+e;}var m=h?h.oa:[];b.modes&&!h&&b.modes.forEach(function(a){switch(a){case "basic":m.push("b");
break;case "advanced":m.push("a");break;default:throw"Unknown block mode "+a;}});var r=h?h.kc:null,k=b.validation;k&&(r=function(a){for(var b=0;b<k.length;b++){var c=k[b].assert;if("string"===typeof c&&/^`.+`$/.test(c)?!na(c,a,void 0,!0):!c)return(a=k[b].warning)?new Ba(a,!0):new Ba(k[b].error||"Error")}});var q=h?h.G:function(c,d){Ge(c,a,b,d)},n=h?h.Z:function(c,d,e,f,g,h,k){a:{var l=Vb(b.draw[0].uri).Pc,n=0,m=b.buttons;if(m){var p;b:{var q=a.sb[l],r=Ce(c,k.x-g,k.y-h,e,f);for(p=0;p<m.length;p++)if(q.jd(m[p].id,
r.x,r.y)){q=m[p].val.indexOf(d.h[p]);0<=q&&(B(d),d.h[p]=m[p].val[(q+1)%m[p].val.length]);break b}p=null}if(null!==p){d=n+p;break a}n+=m.length}if(p=b.radiobuttons){b:{q=a.sb[l];m=m||0;r=Ce(c,k.x-g,k.y-h,e,f);for(var t=0;t<p.length;t++)if(q.jd(p[t].id,r.x,r.y)){B(d);d.h[m]=p[t].val;p=0;break b}p=null}if(null!==p){d=n+p;break a}n++}if(p=m=b.pushbuttons){b:{p=a.sb[l];q=Ce(c,k.x-g,k.y-h,e,f);for(r=0;r<m.length;r++)if(p.jd(m[r].id,q.x,q.y)){B(d);m=m[r].newParameters;"string"===typeof m&&/^`.+`$/.test(m)&&
(m=na(m,d,void 0,!0));d.h=m;m=!0;break b}m=null}p=null!==m}if(p)d=-1;else{if(m=b.sliders){b:{p=a.sb[l];q=Ce(c,k.x-g,k.y-h,e,f);for(r=0;r<m.length;r++){c.clientData.Xc=m[r];var u=ve(p,c.clientData.Xc.id);c.clientData.ce=u.na-u.U<u.ka-u.V;c.clientData.min=c.clientData.ce?u.ka:u.U;c.clientData.max=c.clientData.ce?u.V:u.na;t=(u.U+u.na)/2;u=(u.V+u.ka)/2;var y=ve(p,c.clientData.Xc.thumbId);if(Math.abs((c.clientData.ce?q.x:q.y)-(c.clientData.ce?t:u))<(c.clientData.ce?y.na-y.U:y.ka-y.V)){B(d);p=r;break b}}p=
null}if(null!==p){d=n+p;break a}n+=m.length}if(m=b.rotating){b:{p=a.sb[l];q=d.h.slice(n,n+m.length);r=Ce(c,k.x-g,k.y-h,e,f);for(t=0;t<m.length;t++){u=ve(p,m[t].centerId);u={x:(u.U+u.na)/2,y:(u.V+u.ka)/2};var w=m[t].numSteps?2*Math.PI/m[t].numSteps:1;y=u.x+(r.x-u.x)*Math.cos(q[t]*w)+(r.y-u.y)*Math.sin(q[t]*w);w=u.y-(r.x-u.x)*Math.sin(q[t]*w)+(r.y-u.y)*Math.cos(q[t]*w);if(p.jd(m[t].thumbId,y,w)){c.clientData.Zg=m[t];c.clientData.Nf=u;c.clientData.Gg=Math.atan2(w-u.y,y-u.x);B(d);p=t;break b}}p=null}if(null!==
p){d=n+p;break a}n+=m.length}if(b.score&&(q=a.sb[l],c=(b.buttons?b.buttons.length:0)+(b.radiobuttons?1:0)+(b.sliders?b.sliders.length:0),l=d.h.slice(c).length/2,m=b.score.numHeights||5,p=ve(q,b.score.id),q=q.Aa,(e=de((p.U-q[0])/(q[2]-q[0]),(p.na-q[0])/(q[2]-q[0]),(p.ka-q[1])/(q[3]-q[1]),(p.V-q[1])/(q[3]-q[1]),l,m,e,f,g,h,k))?(B(d),d.h[c+2*e.index]===e.tone?d.h[c+2*e.index+1]=(d.h[c+2*e.index+1]+1)%3:(d.h[c+2*e.index]=e.tone,d.h[c+2*e.index+1]=1),p=0):p=null,null!==p)){d=n+p;break a}d=null}}return d},
p=h?h.Oa:function(a,c,d,e,f,g,h,k){var l=(b.buttons?b.buttons.length:0)+(b.radiobuttons?1:0),m=b.sliders?b.sliders.length:0;d>=l&&d<l+m?Fe(a,c,d-l,b,e,f,g,h,k):(l+=m,m=b.rotating?b.rotating.length:0,d>=l&&d<l+m&&(d-=l,e=Ce(a,k.x-g,k.y-h,e,f),c.h[(b.buttons?b.buttons.length:0)+(b.radiobuttons?1:0)+(b.sliders?b.sliders.length:0)+d]=Math.round(((Math.atan2(e.y-a.clientData.Nf.y,e.x-a.clientData.Nf.x)-a.clientData.Gg+Math.PI)%(2*Math.PI)-Math.PI)/(b.rotating[d].numSteps?2*Math.PI/b.rotating[d].numSteps:
1))))},u=ie(b,h&&h.Eb);e={name:e,type:l,oa:m,ha:h?h.ha:function(){return b.defaultParameters||[]},ub:h?h.ub:function(){return b.typicalParameters||b.defaultParameters||[]},G:q,Z:n,Oa:p,Eb:u,kc:r};0<=g?c[g]=new x(e):c.push(new x(e))})}
function Ie(a){zc=function(b,d){return{j:b,Yf:void 0===a.styles.minInteractiveBlockSize?60:a.styles.minInteractiveBlockSize,Tf:void 0===a.styles.eventRightAlign?!1:a.styles.eventRightAlign,ia:void 0===a.styles.blockLineWidth?Math.max(1,Math.min(3,b/40)):a.styles.blockLineWidth,Mf:Math.round(b/4).toString(10)+"px sans-serif",c:d,ra:void 0===a.styles.controlLineWidth?Math.max(1,Math.min(3,b/40)):a.styles.controlLineWidth,zg:"bold 15px sans-serif",df:a.styles.errorColor||"#f88",Ef:a.styles.warningColor||
"#f88",background:a.styles.background||"white",uf:a.styles.ruleMarks||"#bbb",wf:a.styles.scrollbarThumbColor||"navy",vf:a.styles.scrollbarBackgroundColor||"#ccc",Gc:a.styles.scrollbarWidth||5}};var b=[];He(a,a.blocks||[],b);Ra=b};function Ba(a,b){this.w=a;this.Fb=b||!1;this.g=!1;this.l=[];this.b=[];this.o=null}function lb(a,b){a.g=!0;a.l=b}function Ca(a,b){a.g=!0;a.o=b};function Ja(){this.Wb=[];this.Vc=[]}function Je(a,b){this.state=a;this.b=b||!1}function Ke(a){a.Wb.forEach(function(a){a.b=!1});a.Vc.forEach(function(a){a.b=!1})}Ja.prototype.zb=function(a,b){b&&Ke(this);this.Wb.push(new Je(a,b));20<this.Wb.length&&(this.Wb=this.Wb.slice(-20));this.Vc=[]};Ja.prototype.Af=function(a,b){b&&Ke(this);return 0<this.Wb.length?(this.Vc.push(new Je(a,b)),this.Wb.pop()):new Je(a,b)};
Ja.prototype.tf=function(a,b){b&&Ke(this);return 0<this.Vc.length?(this.Wb.push(new Je(a,b)),this.Vc.pop()):new Je(a,b)};z.prototype.toDataURL=function(a,b,c){var d=this;switch(this.S.type){case "e":var e=H(a,{tag:"block",aa:["event","html"]});break;case "a":e=H(a,{tag:"block",aa:["action","html"]});break;case "s":e=H(a,{tag:"block",aa:["state","html"]});break;case "c":e=H(a,{tag:"block",aa:["comment","html"]});break;default:throw"internal";}e.width=b.j;e.height=b.j;return(new yc(this,F(e),e.ma(),0,0,function(a,b,c,l){c=b.x+e.offsetLeft()+c;l=b.y+e.offsetTop()+l;fc(e,a.I,c,l);var f=d.S;b=b.data;var g=e;a.I.save();a.I.translate(c,
l);f.G(a,b,g);a.I.restore()})).toDataURL(b,c||1)};function Le(a,b,c,d){a=a.toDataURL(b,c,5);c="<img width='"+c.j.toString(10)+"' height='"+c.j.toString(10)+"' src='"+a+"'>";return d?"<a href='"+a+"' download='"+d+"'>"+c+"</a>":c}function Me(a,b,c,d){var e=H(c,{tag:"widget",id:"widget-"+b.replace(/^.*:/g,"")}),f=F(e),g=e.ma();return{url:(new yc(null,f,g,0,0,function(c,d,m,r){c.fa=a.fa;Kc(c,b,f/2+m,g/2+r,e)})).toDataURL(d,5),width:f,height:g}}
function Ne(a,b,c,d,e){a=Me(a,b,c,d);b="<img width='"+a.width.toString(10)+"' height='"+a.height.toString(10)+"' src='"+a.url+"'>";return e?"<a href='"+a.url+"' download='"+e+"'>"+b+"</a>":b}function Oe(a,b,c,d){for(var e=0;e<a.controls.length;e++){var f=a.controls[e];if(f.id===b)return a=f.xc.na-f.xc.U,b=f.xc.ka-f.xc.V,{url:(new yc(null,a,b,0,0,function(a){f.G(a.I,c,!1)})).toDataURL(d,5),width:a,height:b}}throw"button id not found";}
function Pe(a,b,c,d,e){a=Oe(a,b,c,d);b="<img width='"+a.width.toString(10)+"' height='"+a.height.toString(10)+"' src='"+a.url+"'>";return e?"<a href='"+a.url+"' download='"+e+"'>"+b+"</a>":b}
function Yb(a,b){var c=zc(100,100),d=Ne(a.ba,"vpl:then",b,c);return"<!DOCTYPE html>\n<html>\n"+(a.fa?"<head>\n<style>\n"+a.fa+"</style>\n</head>\n":"")+"<body>\n<table class='program'>\n"+a.i.i.map(function(a){return a.Kb()?"":"<tr class='rule'>\n<td class='events'>\n<table class='events'>\n<tr class='events'>\n"+a.R.map(function(a,d){var e="block";switch(a.S.type){case "e":e=e+" event"+(0===d?" event-main":" event-aux");break;case "s":e+=" state";break;case "c":e+=" comment"}return"<td class='"+
e+"'>"+Le(a,b,c)+"</td>\n"}).join("")+"</tr>\n</table>\n</td>\n<td class='then'>"+d+"</td>\n<td class='actions'>\n<table class='actions'>\n<tr class='actions'>\n"+a.actions.map(function(a){var d="block";switch(a.S.type){case "a":d+=" action";break;case "c":d+=" comment"}return"<td class='"+d+"'>"+Le(a,b,c)+"</td>\n"}).join("")+"</tr>\n</table>\n</td>\n</tr>\n"}).join("")+"</table>\n</body>\n</html>\n"}
function $b(a,b){var c=zc(100,100),d=Nc(a,b);a.l={disabled:!1,W:!0,Eg:!1,isEnabled:!0,Ya:!1,state:null};var e=rc(a,a.va,["vpl","top"]),f=Oc(a,a.va,["vpl","top"],d.ic,d.rg,e),g=rc(a,a.P,["vpl","bottom"]),h=Oc(a,a.P,["vpl","bottom"],d.qd,d.qg,g);d="<!DOCTYPE html>\n<html>\n"+(a.fa?"<head>\n<style>\n"+a.fa+"</style>\n</head>\n":"")+"<body>\n<table>\n"+Ra.map(function(a){switch(a.type){case "e":var d="event";break;case "s":d="state";break;case "a":d="action";break;case "c":d="comment";break;default:return""}var e=
new z(a,null,null);return"<tr class='"+d+"'>\n<td>\n"+Le(e,b,c,a.name.replace(/ /g,"_")+".png")+"</td>\n<td>"+a.name+"</td>\n</tr>\n"}).join("")+"</table>\n<table>\n"+Object.keys(a.ba.fa).map(function(a){return"<tr><td>"+Ne(this.ba,a,b,c,a+".png")+"</td><td>"+a+"</td></tr>\n"},a).join("")+"</table>\n<table>\n"+f.controls.map(function(a){return"<tr><td>"+Pe(f,a.id,e[a.id],c,a.id+".png")+"</td><td>"+a.id+"</td></tr>\n"},a).join("")+h.controls.map(function(a){return"<tr><td>"+Pe(h,a.id,g[a.id],c,a.id+
".png")+"</td><td>"+a.id+"</td></tr>\n"},a).join("")+"</table>\n</body>\n</html>\n";a.l=null;return d};function Qe(a,b){b=(new DOMParser).parseFromString(b,"text/xml").getElementsByTagName("node");if(1>b.length)throw"empty";b=b[0].getElementsByTagName("program");if(1!==b.length)throw"program";var c="0"!==b[0].getAttribute("advanced_mode");b=b[0].getElementsByTagName("set");Sa(a);a.mode=c?"a":"b";for(var d=0;d<b.length;d++){var e=Re(b[d],c,function(){a.zb()});a.i.push(e)}}
function Re(a,b,c){a=a.getElementsByTagName("block");for(var d=new ua,e=0;e<a.length;e++){var f=a[e],g=b;f.getAttribute("type");var h=f.getAttribute("name"),l=Se[h],m=Te[l];if(void 0===m)throw"unknown AESL block "+h;h=[];for(var r=0;1E3>r;r++){var k=f.getAttribute("value"+r);if(null===k)break;h.push(m.Lg?k:parseInt(k,10))}g&&m.ee&&(l=m.ee,m=Te[l]);f=ta(l);g=new z(f,null,null);m=m.cb?m.cb(h):h;f.Wd?f.Wd(g,m):g.h=m;va(d,g,null,c,!0)}return d}
var Zb=function(){var a=null;return function(b,c,d){null===a&&(a=document.createElement("a"),document.body.appendChild(a),a.style.display="none");d=d||"application/xml";if("function"===typeof window.Blob&&window.URL){var e=new window.Blob([b],{type:d});e=window.URL.createObjectURL(e)}else e="data:"+d+";base64,"+window.btoa(b);var f=a;d=d||"application/xml";"function"===typeof window.Blob&&window.URL?(b=new window.Blob([b],{type:d}),b=window.URL.createObjectURL(b)):b="data:"+d+";base64,"+window.btoa(b);
f.href=b;f.download=c||"untitled.xml";a.click();"string"!==typeof e&&window.URL.revokeObjectURL(e)}}();function Ue(){return[]}
var Te={accelerometer:{name:"acc",mb:function(a){return[[0,2,1][a[0]],-a[1]]},cb:function(a){return[[0,2,1][a[0]],-a[1]]}},"bottom color":{name:"colorbottom",mb:function(a){return a.map(function(a){return Math.round(32*a)})},cb:function(a){return a.map(function(a){return a/32})}},button:{name:"button",mb:function(a){return[1,4,2,3,0].map(function(b){return a[b]?1:0}).concat(0,0)},cb:function(a){return[4,0,2,3,1].map(function(b){return 0!==a[b]})}},clap:{name:"clap",mb:Ue,cb:Ue},"color state":{name:"colorstate",
ke:!0,mb:function(a){return a.map(function(a){return Math.floor(2.99*a)})},cb:function(a){return a.map(function(a){return a/2})}},"counter comparison":{name:"countercmp",ke:!0,mb:function(a){return a},cb:function(a){return a}},ground:{name:"proxground",ee:"ground adv",mb:function(a){return a.map(function(a){return 0<a?1:0>a?2:0}).concat(400,450)},cb:function(a){return a.slice(0,2).map(function(a){return 2===a?-1:a})}},"ground adv":{name:"proxground",mb:function(a){return a.slice(0,2).map(function(a){return 0<
a?1:0>a?2:0}).concat(a.slice(2).map(function(a){return Math.round(1E3*a)}))},cb:function(a){return a.slice(0,2).map(function(a){return 2===a?-1:a}).concat(a.slice(2).map(function(a){return Math.max(0,Math.min(1,a/1E3))}))}},"horiz prox":{name:"prox",ee:"horiz prox adv",mb:function(a){return a.map(function(a){return 0<a?1:0>a?2:0}).concat(1E3,2E3)},cb:function(a){return a.slice(0,7).map(function(a){return 2===a?-1:a})}},"horiz prox adv":{name:"prox",mb:function(a){return a.slice(0,7).map(function(a){return 0<
a?1:0>a?2:0}).concat(a.slice(7).map(function(a){return Math.round(700+3300*a)}))},cb:function(a){return a.slice(0,7).map(function(a){return 2===a?-1:a}).concat(a.slice(7).map(function(a){return Math.max(0,Math.min(1,(a-700)/3300))}))}},init:{name:"init",ke:!0,mb:Ue,cb:Ue},motor:{name:"move",mb:function(a){return a.map(function(a){return Math.round(500*a)})},cb:function(a){return a.map(function(a){return a/500})}},move:{name:"move2"},notes:{name:"sound",mb:function(a){for(var b=[],c=0;6>c;c++)b.push(0===
a[2*c+1]?517:a[2*c]+256*a[2*c+1]);return b},cb:function(a){for(var b=[],c=0;6>c;c++)b.push(a[c]%256),b.push(517<=a[c]?0:Math.floor(a[c]/256));return b}},"set counter":{name:"setcounter",ke:!0,mb:function(a){return a},cb:function(a){return a}},"set state":{name:"setstate",mb:function(a){return a.map(function(a){return 0<a?1:0>a?2:0})},cb:function(a){return a.map(function(a){return 2===a?-1:a})}},"set timer":{name:"timer",mb:function(a){return[Math.round(1E3*a[0])]},cb:function(a){return[a[0]/1E3]}},
"set timer log":{name:"timerlog",ke:!0,mb:function(a){return[Math.round(1E3*a[0])]},cb:function(a){return[a[0]/1E3]}},state:{name:"statefilter",mb:function(a){return a.map(function(a){return 0<a?1:0>a?2:0})},cb:function(a){return a.map(function(a){return 2===a?-1:a})}},"top color":{name:"colortop",mb:function(a){return a.map(function(a){return Math.round(32*a)})},cb:function(a){return a.map(function(a){return a/32})}},tap:{name:"acc",ee:"accelerometer",mb:function(){return[0,0]},cb:Ue},timer:{name:"timeout",
mb:Ue,cb:Ue},"picture comment":{name:"commentpict",ke:!0,Lg:!0,mb:function(a){return[a[1]]},cb:function(a){return[!1,a[0]]}}},Ve={},We;for(We in Te)if(Te.hasOwnProperty(We)){var Xe=Te[We].name;Ve[Xe]&&Te[Ve[Xe]].ee||(Ve[Xe]=We)}var Se=Ve;function Ye(){this.tb=document.getElementById("editor");this.tb.value="";this.b=this.tb.parentElement;var a=window.innerWidth,b=window.getComputedStyle(this.tb);this.tb.style.width=a-10-parseInt(b.paddingLeft,10)-parseInt(b.paddingRight,10)+"px";this.tb.style.border="0px";this.tb.style.outline="none";this.tb.style.resize="none";this.tb.style.whiteSpace="pre";this.tb.setAttribute("wrap","off");this.g=null}Ye.prototype.Qe=function(a,b){this.tb.setSelectionRange(a,b)};
Ye.prototype.resize=function(){var a=this.b.getBoundingClientRect().width,b=window.getComputedStyle(this.tb);this.tb.style.width=a-10-parseInt(b.paddingLeft,10)-parseInt(b.paddingRight,10)+"px"};function Ze(a,b){a.tb.value=b;window.getComputedStyle(a.tb)};function $e(a,b,c){this.ga=b;this.language=c||"aseba";this.b="";this.Cc=!0;this.Zc=this.Td=this.Cf=null;this.Hb=!1;this.wa=a.wa||new Da;this.Vb=new Ye;this.Vb.tb.readOnly=this.Cc;this.Vb.g=function(a){window.vplBreakpointsFunction&&window.vplBreakpointsFunction(a)};var d=this;this.Fa=new Ab(a.Qa,{Y:a.Y});document.getElementById("editor").addEventListener("input",function(){Mb(a);af(d)===a.i.ga&&(a.i.ga=!a.i.ga,Db(a))},!1);var e=document.getElementById("editor");e&&document.getElementById("editor").addEventListener("keydown",
function(a){if(9===a.keyCode){a.preventDefault();a.b=!0;a=e.value;var b=this.selectionStart;a=a.slice(0,b)+"\t"+a.slice(this.selectionEnd);Ze(d.Vb,a);this.selectionStart=this.selectionEnd=b+1;return!1}return!0},!1)}function bf(a,b){a.Cf=b}v=$e.prototype;v.Zd=function(){this.wa.b=[]};function cf(a){var b="teacher"===$a("role");a.Hb=b}function Jb(a,b,c){null===b?Ze(a.Vb,a.b):(a.b=b,Ze(a.Vb,b));c||(a.Zc=null)}v.Rb=function(){return document.getElementById("editor").value.trim()};
function af(a){return a.Rb()===a.b.trim()}v.Qe=function(a,b){this.Vb.Qe(a,b)};function df(a){var b=H(a.Fa.Y,{tag:"button",aa:["src","top"]});b.height=a.Fa.v.c;a=H(a.Fa.Y,{tag:"toolbar",aa:["src","top"]});a.height=b.ma();return{height:a.height,ma:a.ma()}}
function Mb(a){var b=a.H;b.Fa.Ua=[];var c=b.yf||"src:close !space src:new src:save !space src:language src:disass !stretch src:run src:stop !stretch src:sim src:vpl !space src:locked !stretch src:teacher-reset src:teacher".split(" "),d=rc(a,c,["src","top"]),e=df(b).height,f=Qc(b.Fa);Pc(b.Fa);var g=H(b.Fa.Y,{tag:"view",aa:["src"]});H(b.Fa.Y,{tag:"button",aa:["src","top"]});var h=H(b.Fa.Y,{tag:"separator",aa:["src","top"]}),l=H(b.Fa.Y,{tag:"toolbar",aa:["src","top"]});g.gc(f.width);g.Tb(f.height);g.setPosition(0,
0);l.gc(g.width);l.height=e;l.setPosition(g.x,g.y);G(b.Fa,function(a){g.G(a)});e=new bc(b.Fa);pc(e,a,c,["src","top"],b.jc||hc,b.te||mc);dc(e,l,d,h);ec(e,l,d);E(b.Fa)}function Hb(a,b){(a.Cc=b)&&Ze(a.Vb,a.b);a.Vb.tb.readOnly=b;Mb(window.vplApp)}
v.resize=function(a,b){this.Fa.resize(a,b);a=this.Fa.b.getBoundingClientRect();b=document.getElementById("src-editor");var c=Qc(this.Fa);var d=H(this.Fa.Y,{tag:"view",aa:["src"]});d.gc(c.width);d.Tb(c.height);d.setPosition(0,0);var e=df(this);c=d.x;var f=d.y+e.ma;var g=d.width;d=d.height-e.ma;b.style.left=a.left+a.width*this.Fa.sa.U+c+"px";b.style.width=g+"px";b.style.top=a.top+a.height*this.Fa.sa.V+f+"px";b.style.height=d+"px";this.Vb.resize();Mb(window.vplApp)};
v.focus=function(){document.getElementById("editor").focus();E(this.Fa)};function ef(a){a.b.add("src:close",{action:function(a){a.Za(["src"],{Ce:!0})},object:a,W:function(a){return 1<a.xa.length&&0<=a.xa.indexOf("src")}});a.b.add("src:new",{action:function(a){Ze(a.H.Vb,"");E(a.H.Fa)},isEnabled:function(a){return!a.H.Cc&&0<a.H.Rb().length},object:a});a.b.add("src:save",{action:function(a){var b=ab(a.i,{Rc:!1,Uc:!0});Zb(b,a.i.filename||"program.vpl3","application/x-vpl3")},isEnabled:function(a){return 0<a.H.Rb().length},object:a});a.b.add("src:vpl",{action:function(a){a.Ad?
a.Za(["vpl"],{Dd:!0}):a.Za(["vpl"],{yd:"src"})},isEnabled:function(a){return af(a.H)},object:a,W:function(a){return!a.H.ga&&0>a.xa.indexOf("vpl")}});a.b.add("src:locked",{action:function(a){Hb(a.H,!a.H.Cc);E(a.H.Fa);a.H.Cc&&(a.i.ga=!1,Db(a))},isEnabled:function(a){return null===a.H.Zc},Ya:function(a){return a.H.Cc},object:a,W:function(a){return!a.H.ga}});a.b.add("src:language",{action:function(a){var b=a.H.Cf();a.H.language=b.language;a.H.Cc&&Jb(a.H,b.code)},isEnabled:function(a){return null===a.H.Zc},
getState:function(a){return a.H.language},object:a,W:function(a){return null!=a.H.Cf}});a.b.add("src:disass",{action:function(a){if(null!==a.H.Zc)Jb(a.H,a.H.Zc),a.H.Vb.tb.readOnly=a.H.Cc;else{var b=a.H.Rb(),d=a.H.Td(a.H.language,b);null!==d&&(Jb(a.H,d,!0),a.H.Vb.tb.readOnly=!0,a.H.Zc=b)}Mb(a)},isEnabled:function(a){return null!=a.H.Td&&null!==a.H.Td(a.H.language,"")},Ya:function(a){return null!==a.H.Zc},getState:function(a){return a.H.language},object:a,W:function(a){return null!==a.H.Td}});a.b.add("src:run",
{action:function(a){var b=a.H.Rb();a.Pa[a.Ba].ab.Qb(b,a.H.language)},isEnabled:function(a){return a.Pa[a.Ba].ab.isEnabled(a.H.language)},getState:function(a){return 0===a.H.Rb().length?"empty":"canLoad"},object:a,W:function(a){return 0<=a.Ba}});a.b.add("src:stop",{action:function(a){Pb(a)},isEnabled:function(a){return Qb(a)},object:a,W:function(a){return 0<=a.Ba}});a.b.add("src:connected",{isEnabled:function(a){return!a.i.ga&&0<=a.Ba&&a.Pa[a.Ba].ab.isConnected()},object:a,W:function(a){return 0<a.Pa.length}});
a.b.add("src:sim",{action:function(a){a.Ad?a.Za(["sim"],{Dd:!0}):a.Za(["sim"],{yd:"src"})},object:a,W:function(a){return null!=a.Pa.find(function(a){return"sim"===a.name})&&null!=a.K&&0>a.xa.indexOf("sim")}});a.b.add("src:teacher-reset",{action:function(a){a.H.Zd();Mb(a)},object:a,Ec:!0,W:function(a){return a.H.Hb&&a.H.wa.Ra}});a.b.add("src:teacher",{action:function(a){a.H.wa.Ra=!a.H.wa.Ra;Mb(a)},Ya:function(a){return a.H.wa.Ra},object:a,Ec:!0,W:function(a){return a.H.Hb}})};function ff(a){var b=["vpl:message-error","vpl:message-warning"];return function(c,d,e,f,g,h,l,m,r,k){function q(a){if(void 0==a)return!0;for(var b=0;b<a.length;b++)switch(a[b]){case "pressed":if(!r||!l)return!1;break;case "unpressed":if(r&&l)return!1;break;case "selected":if(!m)return!1;break;case "unselected":if(m)return!1;break;case "disabled":if(l)return!1;break;case "enabled":if(!l)return!1;break;default:if("="===a[b][0]&&(k||"").toString()!==a[b].slice(1))return!1}return!0}var n=H(f,{tag:"button",
aa:g,id:c.replace(/:/g,"-")});if(a.buttons)for(var p=0;p<a.buttons.length;p++)if(a.buttons[p].name===c&&q(a.buttons[p].state)){a.buttons[p].draw.forEach(function(b){if(b.uri){var c=Vb(b.uri);d.save();b.alpha&&(d.globalAlpha=b.alpha);a.sb[c.Pc].G(d,{wd:c.id});b.debug&&(d.fillStyle="black",d.textAlign="center",d.textBaseline="middle",d.fillText(b.debug,n.width/2,n.height/2));d.restore()}b.js&&(b=new Function("ctx",b.js),d.save(),d.scale(n.width,n.height),d.beginPath(),b(d),d.restore())});return}0<=
b.indexOf(c)?hc(c,d,e,f,g,h,l,m,r,k):(d.fillStyle="brown",d.fillRect(0,0,n.width,n.height),d.fillStyle="white",d.textAlign="left",d.textBaseline="top",d.font=Math.round(n.height/6).toString(10)+"px sans-serif",d.fillText(c,.02*n.width,.02*n.height),d.fillText((r?"pr ":"")+(m?"sel ":"")+(l?"":"dis"),.02*n.width,.22*n.height),k&&d.fillText("="+k,.02*n.width,.42*n.height))}}
function gf(a){return function(b,c){if(a.buttons)for(var d=0;d<a.buttons.length;d++){var e=a.buttons[d];if(e.name===b&&(void 0==e.state||0>e.state.indexOf("pressed")&&0>e.state.indexOf("selected")&&0>e.state.indexOf("disabled")))return b=Vb(e.draw[0].uri),ve(a.sb[b.Pc],b.id)}return{U:0,na:c.c,V:0,ka:c.c}}}
function hf(a){function b(b){for(var c=0;c<a.widgets.length;c++)if(a.widgets[c].name===b)return a.widgets[c];return null}if(void 0==a.widgets)return{};var c={};["vpl:then","vpl:error","vpl:warning","vpl:moreHigh","vpl:moreLow"].forEach(function(d){var e=b(d);if(e){var f=Vb(e.draw[0].uri),g=ve(a.sb[f.Pc],f.id);c[d]=function(b,c,d,f){e.draw.forEach(function(c){if(c.uri){var d=Vb(c.uri);c.alpha&&(b.globalAlpha=c.alpha);b.save();var e=Math.min(f.width/(g.na-g.U),f.height/(g.ka-g.V));b.scale(e,e);b.translate(-(g.U+
g.na)/2,-(g.V+g.ka)/2);a.sb[d.Pc].G(b,{wd:d.id});b.restore();c.debug&&(b.fillStyle="black",b.textAlign="center",b.textBaseline="middle",b.fillText(c.debug,0,0))}c.js&&(c=new Function("ctx",c.js),b.save(),b.scale(f.width,f.height),b.beginPath(),c(b),b.restore())})}}});return c};function jf(a){this.o=a&&a.Qb?a.Qb:null;this.g=a&&a.Ac?a.Ac:null;this.l=a&&a.isConnected?a.isConnected:null;this.b=a&&a.isEnabled?a.isEnabled:null;this.md=a&&a.md?a.md:"aseba";this.languages=a&&a.languages?a.languages:[this.md];this.state=a&&a.state?a.state:null}jf.prototype.isConnected=function(){return null==this.l||this.l()};jf.prototype.isEnabled=function(a){return null!=this.o&&0<=this.languages.indexOf(a)&&(null==this.b||this.b(a))};jf.prototype.Ac=function(a){this.g&&this.g(a)};
jf.prototype.Qb=function(a,b){this.isEnabled(b)&&this.o(b,a)};function Fb(a,b){this.o=a;this.l=document.createElement("div");this.l.style.width="100%";this.l.style.height="100%";this.l.style.position="fixed";this.l.style.top="0";this.l.style.left="0";this.l.style.zIndex="1000";this.l.style.backgroundColor="rgba(1,1,1,0.5)";this.l.style.display="none";this.g=document.createElement("div");this.g.style.width="80%";this.g.style.height="80%";this.g.style.position="fixed";this.g.style.top="50%";this.g.style.left="50%";this.g.style.backgroundColor="white";this.g.style.padding=
"2em";this.l.appendChild(this.g);document.body.appendChild(this.l);this.b=null;if(!b){this.b=document.createElement("div");this.b.style.position="absolute";this.b.style.width="32px";this.b.style.height="32px";this.b.style.top="0";this.b.style.left="0";this.b.textContent="\u00d7";this.b.style.font="bold 30px sans-serif";this.b.style.textAlign="left";this.b.style.padding="5px";this.b.style.paddingLeft="10px";var c=this;this.b.addEventListener("click",function(){c.sc()},!1)}}
Fb.prototype.show=function(){this.g.innerHTML=this.o;this.b&&this.g.appendChild(this.b);this.l.style.display="block";Ob(this)};Fb.prototype.sc=function(){this.l.style.display="none"};function Ob(a){var b=a.g.getBoundingClientRect();a.g.style.marginLeft=-b.width/2+"px";a.g.style.marginTop=-b.height/2+"px"};function Xb(a,b,c){try{bb(a.i,b,function(a){if(0>this.xa.indexOf(a))if(1===this.xa.length)this.Za([a]);else{var b=this.xa.slice();b[0<=b.indexOf("vpl")?b.indexOf("vpl"):0<=b.indexOf("src")?b.indexOf("src"):0]=a;this.Za(b)}0<=this.xa.indexOf("vpl")&&this.ba.la()},c)}catch(d){}}function kf(a){return(a=/^[^.]+\.(.*)$/.exec(a))?a[1].toLowerCase():""}
function lf(a,b){var c=kf(b.name),d=new window.FileReader;switch(c){case "aesl":case "vpl3":case "vpl3ui":case "json":return d.onload=function(d){d=d.target.result;var e=b.name;try{Qe(a.i,d)}catch(g){Xb(a,d,{Qf:"vpl3ui"===c})}a.i.filename=e;a.ba.la()},d.readAsText(b),!0}return!1}
function mf(a,b){var c=/^[^.]+\.(.*)$/.exec(b.name);c=c?c[1]:"";var d=new window.FileReader;switch(c.toLowerCase()){case "svg":case "png":case "jpg":case "gif":return a.K&&("obstacle"===a.K.ac?(d.onload=function(b){nf(a,b.target.result)},d.readAsText(b)):(d.onload=function(b){b=b.target.result;var c=new Image;c.addEventListener("load",function(){of(a,c)});c.src=b},d.readAsDataURL(b))),!0}return!1}
function pf(a,b){var c=/^[^.]+\.(.*)$/.exec(b.name);c=c?c[1]:"";var d=new window.FileReader;switch(c.toLowerCase()){case "wav":a.K&&(d.onload=function(c){a.K.T.setFile(b.name,c.target.result)},d.readAsArrayBuffer(b))}};function qf(a){var b=this;this.b=document.createElement("div");this.b.style.width="100%";this.b.style.height="100%";this.b.style.position="fixed";this.b.style.top="0";this.b.style.left="0";this.b.style.zIndex="1000";this.b.style.backgroundColor="rgba(1,1,1,0.5)";this.b.style.display="none";this.g=document.createElement("div");this.g.style.width="40em";this.g.style.position="fixed";this.g.style.top="50%";this.g.style.left="50%";this.g.style.backgroundColor="white";this.g.style.padding="2em";this.b.appendChild(this.g);
document.body.appendChild(this.b);var c=document.createElement("p");c.textContent="Open program file";this.g.appendChild(c);c=document.createElement("table");c.style.width="100%";this.g.appendChild(c);var d=document.createElement("tr");c.appendChild(d);var e=document.createElement("td");d.appendChild(e);this.input=document.createElement("input");this.input.setAttribute("type","file");this.input.setAttribute("accept",".aesl,.json,.vpl3,.vpl3ui");this.input.style.width="35em";e.appendChild(this.input);
e=document.createElement("td");e.align="right";d.appendChild(e);d=document.createElement("input");d.setAttribute("type","button");d.setAttribute("value","OK");d.addEventListener("click",function(){var c=b.input.files[0];c&&lf(a,c);b.sc()},!1);e.appendChild(d);e.appendChild(document.createTextNode("\u00a0\u00a0"));d=document.createElement("input");d.setAttribute("type","button");d.setAttribute("value","Cancel");d.addEventListener("click",function(){b.sc()},!1);e.appendChild(d);e=document.createElement("div");
e.style.position="absolute";e.style.width="32px";e.style.height="32px";e.style.top="0";e.style.left="0";e.textContent="\u00d7";e.style.font="bold 30px sans-serif";e.style.textAlign="left";e.style.padding="5px";e.style.paddingLeft="10px";e.addEventListener("click",function(){b.sc()},!1);c.appendChild(e)}qf.prototype.show=function(){this.b.style.display="block";var a=this.g.getBoundingClientRect();this.g.style.marginLeft=-a.width/2+"px";this.g.style.marginTop=-a.height/2+"px"};
qf.prototype.sc=function(){this.b.style.display="none"};function rf(a,b,c){this.b=a;this.w=b;this.g=null;this.o=!1;this.l=c;var d=this;setInterval(function(){null!=d.g&&2<=d.g.readyState&&(!1!==d.b.se&&(d.b.se=!1,Db(d.b)),d.connect())},5E3)}
rf.prototype.connect=function(){var a=this;this.g=new WebSocket(this.w);this.g.addEventListener("open",function(){a.b.se=!0;a.g.send(JSON.stringify({sender:{type:"vpl",sessionid:a.l,role:a.b.i.Hb?"teacher":"student"},type:"hello"}));window.addEventListener("unload",function(){a.g.send(JSON.stringify({sender:{type:"vpl",sessionid:a.l,role:a.b.i.Hb?"teacher":"student"},type:"bye"}))});Db(a.b)});this.g.addEventListener("message",function(b){try{var c=JSON.parse(b.data);switch(c.type){case "cmd":var d=
c.data.cmd,e=c.data.selected,f=c.data.state,g=a.b.b;if(g.W(d)&&tb(g,d)&&g.isEnabled(d))if(void 0!==e){var h=g.find(d),l;if(l=h)h.g?e===h.Ya()?l=!0:(vb(h,void 0),l=e===h.Ya()):l=!1;l&&ub(g,d)}else if(void 0!==f){var m=g.find(d);m&&wb(m,f)&&ub(g,d)}else{var r=g.find(d);r&&(vb(r,void 0),ub(g,d))}Hd(a.b.ba);break;case "file":var k=c.data.content;switch(c.data.kind){case "vpl":var q=kf(c.data.name||"");/^[\s]*{/.test(k)?Xb(a.b,k,{Qf:"vpl3ui"===q}):(Qe(a.b.i,k),a.b.ba.la());a.b.i.filename=c.data.name||
null;Hd(a.b.ba);break;case "about":Eb(a.b,k);break;case "help":Gb(a.b,k);break;case "suspend":var n=a.b,p=n.hc;p&&n.Hd&&n.Hd.sc();n.Hd=k?new Fb(k,!0):null;k&&p&&n.Hd.show()}}}catch(u){console.info(u)}});this.o||(Sb(this.b,function(b){a.log(b)}),this.o=!0)};
rf.prototype.log=function(a){try{if("cmd"===a.type&&a.data&&0<=["vpl:run"].indexOf(a.data.cmd)){var b=ab(this.b.i,{Rc:!1,Uc:!0});this.g.send(JSON.stringify({sender:{type:"vpl",sessionid:this.l},type:"file",data:{name:this.b.i.filename,content:b}}))}this.g.send(JSON.stringify({sender:{type:"vpl",sessionid:this.l},type:"log",data:a||null}))}catch(c){}};var xd=null;document.addEventListener("mousemove",function(a){null!==xd&&(xd(a,!1),a.preventDefault())},!1);document.addEventListener("mouseup",function(a){null!==xd&&(xd(a,!0),xd=null,a.preventDefault())},!1);var Dd=null;document.addEventListener("touchmove",function(a){a.preventDefault();null!==xd&&(Dd=a.targetTouches[0],xd(Dd,!1));return!1},{capture:!1,passive:!1});document.addEventListener("touchend",function(a){null!==xd&&(xd(Dd,!0),xd=null,a.preventDefault());return!1},!1);
function sf(a,b,c,d){var e=0<=a.indexOf("/")?a.replace(/\/[^/]*$/,"/"):"",f={},g=new XMLHttpRequest;g.addEventListener("load",function(){if(200===g.status){f[a]=g.responseText;var h=JSON.parse(g.responseText),l=b(h),m=l.length,r=!1;l.forEach(function(b){var g=new XMLHttpRequest;g.addEventListener("load",function(){200===g.status?(f[b]=g.responseText,m--,r||0!==m||c(h,f)):r||(r=!0,d("HTTP error "+g.status))});g.addEventListener("error",function(){r||(r=!0,d("XMLHttpRequest error for "+a))});g.open("GET",
e+b);g.send()})}else d("HTTP error "+g.status)});g.addEventListener("error",d);g.open("GET",a);g.send()}
function tf(a,b,c,d){try{var e=document.getElementById(a).textContent,f=JSON.parse(e),g={};f.svgFilenames&&f.svgFilenames.forEach(function(a){e=document.getElementById(a).textContent;g[a]=e});f.overlays&&f.overlays.forEach(function(a){e=document.getElementById(a).textContent;g[a]=e});f.css&&f.css.forEach(function(a){e=document.getElementById(a).textContent.trim();g[a]=e});c(f,g)}catch(h){d(h)}}
function $a(a){var b=/^[^?]*\?([^#]*)/.exec(document.location.href);if(b=b&&b[1]){b=b.split("&").map(function(a){return a.split("=").map(function(a){return decodeURIComponent(a)})});for(var c=0;c<b.length;c++)if(b[c][0]===a)return b[c][1]}return""}function uf(a){return(document.location.hash||"#").slice(1).split("&").map(function(a){return a.split("=").map(decodeURIComponent)}).reduce(function(a,c){a[c[0]]=c[1];return a},{})[a]||null}
function vf(a){a&&a.overlays&&a.overlays.forEach(function(b){b=JSON.parse(a.qe[b]);for(var c in b)if(b.hasOwnProperty(c))switch(c){case "blocks":case "buttons":case "widgets":a[c]=a[c]?a[c].concat(b[c]):b[c];break;case "toolbars":for(var d in b[c])b[c].hasOwnProperty(d)&&(a[c]=a[c]||{},a[c][d]=b[c][d]);break;case "i18n":for(d in b[c])if(b[c].hasOwnProperty(d)){a[c]=a[c]||{};a[c][d]=a[c][d]||{};for(var e in b[c][d])b[c][d].hasOwnProperty(e)&&(a[c][d][e]=b[c][d][e])}}});var b=new xb;window.vplApp=b;
b.username=$a("user")||window.vplUsername||b.username;a&&Ub&&(b.i.message=Ub(a),b.i.message&&window.console.info(b.i.message));a&&a.css&&(a.css.forEach(function(c){Wc(b.Y,c,a.qe[c])}),b.Y.defineProperties());if(a&&a.i18n)for(var c in a.i18n)a.i18n.hasOwnProperty(c)&&Ha(b.o,c,a.i18n[c]);b.Wf=new qf(b);var d=void 0==a||a["hardcoded-gui"]||"classic"===$a("appearance");c=$a("uilanguage")||"en";b.o.language=c;b.Df="local"===$a("storage");b.Ad="false"!==$a("multiview");var e=$a("language");ud="true"===
$a("cssdebug");var f=hc,g=mc,h=tc;if(a){if(d)null!==a.blocks&&0<a.blocks.length&&(a.blocks||[]).forEach(function(a){ie(a,ta(a.name).Eb)});else if(null!==a.buttons&&0<a.buttons.length&&(f=ff(a),g=gf(a)),null!==a.widgets&&0<a.widgets.length&&(h=hf(a)),null!==a.blocks&&0<a.blocks.length)try{Ie(a)}catch(sa){window.console&&window.console.error(sa)}a.miscSettings&&void 0!=a.miscSettings.basicMultiEvent&&(La=1==a.miscSettings.basicMultiEvent);a.miscSettings&&void 0!=a.miscSettings.advancedMultiEvent&&(Na=
1==a.miscSettings.advancedMultiEvent);a.miscSettings&&a.miscSettings.viewRelativeSizes&&(c=a.miscSettings.viewRelativeSizes,b.Nb={vpl:c.vpl||1,src:c.src||1,sim:c.sim||1})}c=$a("server");var l=$a("session"),m="true"===$a("adv"),r="true"===$a("exp"),k=0,q=0,n="",p=$a("blur").trim()||"";/^\d+$/.test(p)&&(k=parseInt(p,10)/10);p=$a("grayscale")||"";/^\d+$/.test(p)&&(q=parseInt(p,10)/100);if(0<k||0<q)n="blur("+k.toFixed(1)+"px) grayscale("+q.toFixed(2)+")";k=1;q=0;p=!1;var u=null;p=$a("scale").trim()||
"";/^\d+(\.\d*)?$/.test(p)&&(k=parseFloat(p));p=$a("rotation").trim()||"";/^-?\d+(\.\d*)?$/.test(p)&&(q=parseFloat(p)*Math.PI/180);p=$a("mirror").trim()||"";p="true"===p;if(1!==k||0!==q||p)u=[k*Math.cos(q)*(p?-1:1),k*Math.sin(q)*(p?-1:1),-k*Math.sin(q),k*Math.cos(q),0,0];e||(e=0<=b.Ba?b.Pa[b.Ba].ab.md:"aseba");Oa();Sa(b.i,!0);b.i.Zd();k=$a("view");p=0===k.length?["vpl"]:k.split("+");q=$a("robot");if(0<=p.indexOf("sim")||"sim"===q)q="sim";q.replace(/[+;]/g,",").split(",").forEach(function(a){var c=
null;switch(a){case "thymio":c=wf(b);c.Ac(e);break;case "thymio-tdm":c=xf(b);c.Ac(e);break;case "thymio-jws":c=yf(b);c.Ac(e);break;case "sim":c=zf(b,{Of:n,Pf:u}),c.Ac(e)}c&&b.Pa.push({name:a,ab:c})});b.Ba=0<b.Pa.length?0:-1;if(!oa[e])throw"Unsupported language "+e;Fa(b.wa,m?[]:["src:language"]);b.i.Ab=e;b.ba.fa=h;b.i.i.push(new ua);null!=b.g&&(b.g.fa=h);Wb(b);!d&&a&&a.toolbars&&(a.toolbars.vpl&&(b.va=a.toolbars.vpl),a.toolbars.vpl2&&(b.P=a.toolbars.vpl2));b.i.jc=f;b.i.te=g;$e&&document.getElementById("editor")&&
(b.H=new $e(b,b.i.ga,e),Ed(b.H.Fa,n),b.i.o=function(){return af(b.H)?null:b.H.Rb()},b.i.w=function(a){Jb(b.H,a)},b.H.Fa.fa=h,ef(b),!d&&a&&a.toolbars&&a.toolbars.editor&&(b.H.yf=a.toolbars.editor),b.H.jc=f,b.H.te=g,cf(b.H));null!=b.K&&(Af(b),!d&&a&&a.toolbars&&a.toolbars.simulator&&(b.K.yf=a.toolbars.simulator),b.K.jc=f,b.K.te=g);n&&Ed(b.ba,n);Gd(b.ba,u);document.getElementsByTagName("body")[0].addEventListener("dragover",function(a){a.stopPropagation();a.preventDefault();a.dataTransfer.dropEffect=
"copy"},!1);document.getElementsByTagName("body")[0].addEventListener("drop",function(a){a.stopPropagation();a.preventDefault();a=a.dataTransfer.files;1===a.length&&(a=a[0],lf(b,a)||mf(b,a)||pf(b,a))},!1);if(b.K){b.K.wa=b.wa;var y=new Image;y.addEventListener("load",function(){b.K.$e=y});y.src="data:image/svg+xml;base64,"+btoa('<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="297mm" height="210mm" viewBox="0 0 1052 744" version="1.1"><defs><linearGradient id="gradient" x1="-1000" y1="0" x2="-800" y2="0" gradientUnits="userSpaceOnUse"><stop style="stop-color:#000;stop-opacity:1;" offset="0" /><stop style="stop-color:#000;stop-opacity:0;" offset="1" /></linearGradient></defs><g transform="translate(0,-308)"><rect style="fill:url(#gradient);stroke:none" width="319" height="687" x="-1027" y="336" transform="scale(-1,1)" /><path style="fill:none;stroke:#000;stroke-width:30;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none" d="M 114,592 C 102,417 750,306 778,532 806,757 674,675 559,622 444,568 259,567 278,664 296,762 726,730 778,808 829,887 725,955 616,936 507,917 144,1083 129,837 Z" /></g></svg>');
var I=new Image;I.addEventListener("load",function(){b.K.af=I});I.src="data:image/svg+xml;base64,"+btoa('<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" width="297mm" height="210mm" viewBox="0 0 1052 744" version="1.1"><defs><radialGradient id="gradient" cx="400" cy="650" fx="400" fy="650" r="230" gradientTransform="matrix(1.6,0,0,1.16,-113,-75)" gradientUnits="userSpaceOnUse"><stop style="stop-color:#000;stop-opacity:1;" offset="0" /><stop style="stop-color:#000;stop-opacity:0;" offset="1" /></radialGradient></defs><g transform="translate(0,-308)"><rect style="fill:url(#gradient);fill-opacity:1;stroke:none" width="939" height="650" x="54" y="357" /></g></svg>');
b.K.bf='<?xml version="1.0" encoding="UTF-8"?><svg xmlns="http://www.w3.org/2000/svg" width="297mm" height="210mm" viewBox="0 0 1052 744" version="1.1"><g transform="translate(0,-308)"><path style="fill:none;stroke:#000;stroke-width:6;stroke-linecap:butt;stroke-linejoin:miter" d="M 172,928 137,420 763,371 905,688 708,981 Z" /><path style="fill:none;stroke:#949494;stroke-width:6;stroke-linecap:butt;stroke-linejoin:miter" d="m 402,754 168,91 101,-142" /><circle style="fill:none;stroke:#000;stroke-width:6" cx="531" cy="550" r="59" /></g></svg>'}if(window.vplStorageGetFunction)window.vplStorageGetFunction("program.vpl3",
function(a,c){try{a&&(bb(b.i,a,function(){Db(b)}),b.i.filename=c&&c.filename||"program.vpl3",b.i.readOnly=void 0!=c&&1==c.readOnly,void 0!=c&&1==c.customizationMode&&(b.wa.Ra=!0))}catch(Ea){}});else if(b.Df)try{var t=window.localStorage.getItem("program.vpl3");t&&bb(b.i,t,function(){Db(b)})}catch(sa){}"text"===$a("view")?b.Za(["src"],{ga:!0}):(b.Za(["vpl"]),b.i.Uf=r,Ya(b.i),Db(b),b.H&&(document.getElementById("editor").textContent=b.i.Rb(b.i.Ab)));var w=["aseba","l2","js","python"];b.H&&0<=w.indexOf(e)&&
bf(b.H,function(){e=w[(w.indexOf(e)+1)%w.length];b.i.Ab=e;var a=b.i.Rb(e);return{language:e,code:a}});if(m&&b.H){var A=new Bf(Cf);b.H.Td=function(a,b){try{switch(a){case "aseba":var c=new Df(A,b);c.Qa=Ef;break;case "l2":c=new Ff(A,b);c.Qa=Gf;break;default:return null}var d=Hf(c);return If(d)}catch(Aa){return"; "+Aa}}}a&&a.fragments&&a.fragments["about.html"]&&Eb(b,a.fragments["about.html"]);a&&a.fragments&&a.fragments["help.html"]&&Gb(b,a.fragments["help.html"]);a&&a.fragments&&a.fragments["vpl-export-html.css"]&&
(b.fa=a.fragments["vpl-export-html.css"]);Lb(b);Hd(b.ba);window.addEventListener("resize",function(){Lb(b)},!1);b.K&&Jf(b.K);if("text"===k)b.Za(["src"],{ga:!0});else{t=["vpl","src","sim"];if(1>p.length||3<p.length||""===k)k="vpl";else for(d=0;d<p.length;d++){if(0>!t.indexOf(p[d])){k="vpl";break}for(f=0;f<d;f++)if(p[d]===p[f]){k="vpl";break}}b.Za(p)}Lb(b);c&&(window.vplCommandServer=new rf(b,c,l),window.vplCommandServer.connect())}
window.addEventListener("load",function(){var a=$a("ui")||"ui.json";(document.getElementById(a)?tf:sf)(a,function(a){return(a.svgFilenames||[]).concat(a.overlays||[]).concat(a.css||[])},function(a,c){a.qe={};a.sb={};a.svgFilenames&&a.svgFilenames.forEach(function(b){a.qe[b]=c[b];a.sb[b]=new we(c[b])});a.overlays&&a.overlays.forEach(function(b){a.qe[b]=c[b]});a.css&&a.css.forEach(function(b){a.qe[b]=c[b]});vf(a)},function(a){window.console&&window.console.error(a);vf()})},!1);
window.vplIsProgramChanged=function(){return 0<window.vplApp.i.Hc.Wb.length};window.vplGetProgramAsJSON=function(a){return ab(window.vplApp.i,a?{Rc:!0,Uc:!1}:void 0)};window.vplGetUIAsJSON=function(){return ab(window.vplApp.i,{Rc:!0,Uc:!1})};window.addEventListener("unload",function(){var a=ab(window.vplApp.i);try{window.vplStorageSetFunction?window.vplStorageSetFunction("program.vpl3",a):window.vplApp.Df&&window.localStorage.setItem("program.vpl3",a)}catch(b){}},!1);function Kf(){this.od=1}Kf.prototype.reset=function(){};Kf.prototype.resetEventListeners=function(){};Kf.prototype.set=function(){};Kf.prototype.get=function(){return null};Kf.prototype.setClientState=function(){};Kf.prototype.getClientState=function(){return null};Kf.prototype.addEventListener=function(){};Kf.prototype.sendEvent=function(){};Kf.prototype.start=function(){this.sendEvent("init",null)};Kf.prototype.setTimer=function(){};Kf.prototype.getTimer=function(){return-1};
Kf.prototype.loadCode=function(){};Kf.prototype.shouldRunContinuously=function(){return!1};Kf.prototype.run=function(){};Kf.prototype.suspend=function(){};Kf.prototype.resume=function(){};function K(){this.od=1;this.Qa={U:-Infinity,na:Infinity,V:-Infinity,ka:Infinity};this.w=this.P=0;this.r=70;this.b=[0,0];this.g=0;this.Je=!1;this.files={};this.wb=120;this.Jc=80;this.Ld=20;this.state={};this.fa={};this.jb=null;this.sd={};this.o=[];this.va={};this.Kc=!1;this.L=null;K.prototype.reset.call(this,0);K.prototype.resetEventListeners.call(this)}K.prototype=Object.create(Kf.prototype);K.prototype.constructor=K;K.prototype.setPositionLimits=function(a,b,c,d){this.Qa={U:a,na:b,V:c,ka:d}};
K.prototype.setFile=function(a,b){this.files[a]=b};
K.prototype.reset=function(a){this.w=this.P=a;this.b=[0,0];this.g=0;this.state={"button.center":!1,"button.left":!1,"button.right":!1,"button.forward":!1,"button.backward":!1,"prox.ground.delta":[1,1],"prox.horizontal":[0,0,0,0,0,0,0],acc:[0,0,1],"motor.left":0,"motor.right":0,"leds.top":[0,0,0],"leds.bottom.left":[0,0,0],"leds.bottom.right":[0,0,0],"leds.circle":[0,0,0,0,0,0,0,0],sound:{}};this.Kc=!1;var b=this;this.fa={"leds.circle":function(){b.Kc=!0},sound:function(a,d){function c(){if(!(g>=d.f.length)){b.L||
(b.L=new (window.AudioContext||window.webkitAudioContext));var a=b.L.createOscillator();a.type="sawtooth";a.frequency.value=d.f[g];var e=b.L.createGain();e.connect(b.L.destination);a.connect(e);a.start(0);var f=d.d[g]/50;e.gain.exponentialRampToValueAtTime(.01,b.L.currentTime+f);a.stop(b.L.currentTime+f);a.addEventListener("ended",c);g++}}if(d.hasOwnProperty("pcm")){if(a=b.files["P"+d.pcm+".wav"]){b.L||(b.L=new (window.AudioContext||window.webkitAudioContext));var f=b.L;f.decodeAudioData(a.slice(),
function(a){var b=f.createBufferSource();b.buffer=a;b.connect(f.destination);b.start(0)})}}else if(d.f){var g=0;c()}}};this.o=[];this.hc=!1};K.prototype.resetEventListeners=function(){this.va={}};K.prototype.enforcePositionLimits=function(){this.b=[Math.max(this.Qa.U,Math.min(this.Qa.na,this.b[0])),Math.max(this.Qa.V,Math.min(this.Qa.ka,this.b[1]))]};K.prototype.setPosition=function(a,b){this.b=a;this.g=b;this.enforcePositionLimits();this.jb&&this.jb.call(this)};
K.prototype.set=function(a,b){this.state[a]=b;this.fa[a]&&this.fa[a](a,b)};K.prototype.get=function(a){return this.state[a]};K.prototype.setClientState=function(a,b){this.sd[a]=b};K.prototype.getClientState=function(a){a=this.sd[a];a instanceof Array&&(a=a.slice());return a};K.prototype.addEventListener=function(a,b){this.va[a]=b};K.prototype.sendEvent=function(a,b){this.va[a]&&this.va[a].call(this,a,b);for(var c in this.va)if(0===c.indexOf(a+"."))this.va[c](a,b)};
K.prototype.setTimer=function(a,b,c){this.o[a]={next:this.w-this.P+b,bg:c?b:-1}};K.prototype.getTimer=function(a){return void 0===this.o[a]||0>this.o[a].next?-1:this.P+this.o[a]-this.w};K.prototype.loadCode=function(a,b){if("js"!==a)throw"unsupported language "+a;(new Function(b)).call(this)};K.prototype.shouldRunContinuously=function(){if(this.hc)return!1;if(0!==this.get("motor.left")||0!==this.get("motor.right"))return!0;for(var a=0;a<this.o.length;a++)if(this.o[a]&&0<this.o[a].next)return!0;return!1};
function Lf(a,b){return a.Je?b*Math.sqrt(-2*Math.log(Math.random()))*Math.sin(2*Math.PI*Math.random()):0}
K.prototype.run=function(a,b){0===this.P&&this.reset(a);1!==this.od&&(this.P-=(this.od-1)*(a-this.w),this.w=this.od*(this.w-a)+a);for(var c=Math.max(.01,(a-this.w)/10),d=this.b;!this.hc&&this.w<a;){c=Math.min(c,a-this.w);var e=(100*this.get("motor.left")+Lf(this,1))*c,f=(100*this.get("motor.right")+Lf(this,1))*c;if(0!==e||0!=f){if(1E-6>Math.abs(e-f)||Math.abs(e-f)<1E-4*(Math.abs(e)+Math.abs(f)))this.b=[this.b[0]+.5*(e+f)*Math.cos(this.g),this.b[1]+.5*(e+f)*Math.sin(this.g)];else{var g=(e+f)*this.r/
(e-f);e=(f-e)/(2*this.r);this.b=[this.b[0]+g*(Math.sin(this.g)-Math.sin(this.g+e)),this.b[1]-g*(Math.cos(this.g)-Math.cos(this.g+e))];this.g+=e}this.enforcePositionLimits();this.jb&&this.jb.call(this)}this.w+=c;this.sendEvent("prox",null);for(g=0;g<this.o.length;g++)this.o[g]&&0<this.o[g].next&&this.w>=this.P+this.o[g].next+Lf(this,.01)&&(this.o[g].next=0<=this.o[g].bg?this.o[g].next+this.o[g].bg:-1,this.sendEvent("timer"+g.toString(10),null))}b&&b("l",d.concat(this.b))};
K.prototype.suspend=function(){this.hc=!0};K.prototype.resume=function(a){this.hc&&(this.P+=a-this.w,this.w=a,this.hc=!1)};var Mf="shift left;shift right;add;sub;mult;div;mod;bitor;bitxor;bitand;eq;ne;gt;ge;lt;le;or;and".split(";");function Nf(a){function b(a){return 32784<=a?a-65536:a}function c(a){return 2048<=a?a-4096:a}var d=[],e=a[0];d.push({Lc:0,Cd:a.slice(0,1),Ke:-1,A:"dc "+a[0]});for(var f=[],g=1;g<e;g+=2)f.push({id:a[g],Lc:a[g+1]}),d.push({Lc:g,Cd:a.slice(g,g+2),Ke:-1,A:"dc 0x"+a[g].toString(16)+", "+a[g+1]});for(g=e;g<a.length;g++){e={Lc:g,Cd:a.slice(g,g+1),Ke:a[g]>>>12};for(var h=0;h<f.length;h++)if(f[h].Lc===g){e.id="@onevent_"+f[h].id.toString(16);break}h=a[g];switch(h>>>12){case 0:e.A="stop";break;case 1:e.A="push.s "+
((h&4095)-(h&2048?4096:0));break;case 2:e.Cd=a.slice(g,g+2);e.A="push "+b(a[++g]);break;case 3:e.A="load "+(h&4095);break;case 4:e.A="store "+(h&4095);break;case 5:e.Cd=a.slice(g,g+2);e.A="load "+(h&4095)+"+ind size="+a[++g];break;case 6:e.Cd=a.slice(g,g+2);e.A="store "+(h&4095)+"+ind size="+a[++g];break;case 7:case 8:switch(h){case 28672:e.A="neg";break;case 28673:e.A="abs";break;case 28674:e.A="bitnot";break;case 28675:e.A="not ; not implemented";break;case 32768:e.A="sl";break;case 32769:e.A="asr";
break;case 32770:e.A="add";break;case 32771:e.A="sub";break;case 32772:e.A="mult";break;case 32773:e.A="div";break;case 32774:e.A="mod";break;case 32775:e.A="bitor";break;case 32776:e.A="bitxor";break;case 32777:e.A="bitand";break;case 32778:e.A="eq";break;case 32779:e.A="ne";break;case 32780:e.A="gt";break;case 32781:e.A="ge";break;case 32782:e.A="lt";break;case 32783:e.A="le";break;case 32784:e.A="or";break;case 32785:e.A="and";break;default:throw"Unknown instruction "+h.toString(16);}break;case 9:e.A=
"jump "+(g+c(h&4095));break;case 10:e.Cd=a.slice(g,g+2);e.A="jump "+(h&256?"when":"if")+" not "+Mf[h&31]+" "+(g+b(a[g+1]))+(h&256?h&512?" (prev=true)":" (prev=false)":"");g++;break;case 11:e.A="emit id="+(h&4095)+" data="+b(a[g+1])+" count="+b(a[g+2]);break;case 12:e.A="callnat "+(h&4095);break;case 13:e.A="callsub "+(h&4095);break;case 14:e.A="ret";break;default:throw"Unknown instruction "+h.toString(16);}d.push(e)}return d}
function If(a){return Nf(a).map(function(b){var c=b.Lc.toString(10);c="    ".slice(c.length-1)+c;var d=b.Cd.map(function(a){a=a.toString(16);return"000".slice(a.length-1)+a}).join(" ");d+="     ".slice(d.length-4);return(b.id?b.id+":\n":"")+c+"  "+d+"  "+b.A+(b.Lc===a[0]-2||0===b.Ke||14===b.Ke?"\n":"")}).join("\n")};function Bf(a){this.name=a.name;this.b=a.maxVarSize;this.Sa=[];for(var b=this.Ma=0;b<a.variables.length;b++)this.Sa.push(new Of(a.variables[b].name,a.variables[b].size,[1],this.Ma,Pf)),this.Ma+=a.variables[b].size;this.Lb=a.nativeFunctions.map(function(a,b){return{id:b,name:a.name,B:a.args}});this.zd=a.localEvents.map(function(a){return{name:a.name}})}function Qf(a,b){for(var c=0;c<a.Lb.length;c++)if(a.Lb[c].name===b)return a.Lb[c];return null}
function Rf(a,b){for(var c=0;c<a.Sa.length;c++)if(a.Sa[c].name===b)return a.Sa[c];return null}function Sf(a,b){if("init"===b)return 65535;for(var c=0;c<a.zd.length;c++)if(a.zd[c].name===b)return 65534-c;throw"unknown local event "+b;}function Df(a,b){this.Nb=Tf;this.Hf=!1;this.ya=a;this.l=b;this.L=b.length;this.b=0;this.line=1;this.Ea=0;this.C=[];this.m=0;this.g=[];this.Kf=[];this.Qa=[];this.P={};this.Ta=[];this.jb=[];this.Jc=this.Kc=this.ya.b;this.nf=!1;this.Ia=0;this.Ub=[]}
function Of(a,b,c,d,e){this.name=a;this.size=b;this.v=c;this.offset=d;this.resultType=e}Of.prototype.hd=function(a,b){return[12288|this.offset+(b||0)]};Of.prototype.He=function(a,b){return[16384|this.offset+(b||0)]};Of.prototype.je=function(){return[20480|this.offset,this.size]};Of.prototype.hf=function(){return[24576|this.offset,this.size]};
Df.prototype.ng=function(){for(;this.b<this.L;)if(" "===this.l[this.b]||"\t"===this.l[this.b])this.b++,this.Ea++;else if("\n"===this.l[this.b])this.b++,this.Ea=0,this.line++;else if("\r"===this.l[this.b])this.b++;else if("#*"===this.l.slice(this.b,this.b+2))for(this.b+=2,this.Ea+=2;this.b<this.L&&"*#"!==this.l.slice(this.b-2,this.b);)"\n"===this.l[this.b]?(this.Ea=0,this.line++):"\r"!==this.l[this.b]&&this.Ea++,this.b++;else if("#"===this.l[this.b])for(;this.b<this.L&&"\n"!==this.l[this.b];)this.b++,
this.Ea++;else break};function Uf(a,b){a.jb.push(b.length-1)}function Vf(a,b,c){if(0===a.jb.length)throw"internal";void 0===c&&(c=b.length);a=a.jb.pop();b[a]=36864===b[a]?b[a]+(c-a&4095):c-a+1&65535}Df.prototype.sd=function(a,b,c,d,e){var f;a:{for(f=0;f<this.Ta.length;f++)if(this.Ta[f].name===a){f=!0;break a}for(f=0;f<this.ya.Sa.length;f++)if(this.ya.Sa[f].name===a){f=!0;break a}f=!1}if(f)throw'duplicate variable declaration "'+a+'"';this.Ta.push(new Of(a,b,c,d,e))};
function Wf(a,b){for(var c=a.Ta.length-1;0<=c;c--)if(a.Ta[c].name===b.name)return a.Ta[c];for(c=0;c<a.ya.Sa.length;c++)if(a.ya.Sa[c].name===b.name)return a.ya.Sa[c];throw"unknown variable "+b.name+" "+L(b.head);}function Xf(a,b){for(var c=0;c<a.Qa.length;c++)if(a.Qa[c].name===b)return a.Qa[c];return null}function Yf(a,b){a.Jc-=b;return a.Jc}Df.prototype.wb=function(){return[]};var Zf="== != <= >= |= ^= &= *= /= %= += -= <<= >>= ++ -- ( ) [ ] - ~ * / % + << >> & ^ | > < = , : abs and callsub call const do elseif else emit end for if in not onevent or return step sub then var when while".split(" ");
function $f(a,b,c){this.pd=a;this.$c=b;this.Yc=c}function L(a){return"line "+a.$c.toString()+" col "+a.Yc.toString()}function ag(a,b,c,d){$f.call(this,a,b,c);this.n=d}ag.prototype=Object.create($f.prototype);ag.prototype.constructor=ag;function bg(a,b,c,d){$f.call(this,a,b,c);this.n=d}bg.prototype=Object.create(ag.prototype);bg.prototype.constructor=bg;function cg(a,b,c,d){$f.call(this,a,b,c);this.name=d}cg.prototype=Object.create($f.prototype);cg.prototype.constructor=cg;
function dg(a,b,c,d){$f.call(this,a,b,c);this.name=d}dg.prototype=Object.create($f.prototype);dg.prototype.constructor=dg;
Df.prototype.Ze=function(a){for(;;){a:{var b=(b=a)||Zf;this.ng();if(this.b>=this.L)var c=null;else{for(var d=0;d<b.length;d++)if(c=b[d].length,this.l.slice(this.b,this.b+c)===b[d]&&!/[a-zA-Z0-9_.]{2}/.test(this.l.slice(this.b+c-1,this.b+c+1))){b=new dg(this.b,this.line,this.Ea,b[d]);this.b+=c;this.Ea+=c;c=b;break a}c=0;if("0x"===this.l.slice(this.b,this.b+2)){for(this.b+=2;this.b+c<this.L&&/[0-9a-fA-F]/.test(this.l[this.b+c]);)c++;if(0===c)throw"hexadecimal number syntax error";b=parseInt(this.l.slice(this.b,
this.b+c),16);b=new ag(this.b,this.line,this.Ea,b);this.b+=c;this.Ea+=2+c}else if("0b"===this.l.slice(this.b,this.b+2)){for(this.b+=2;this.b+c<this.L&&/[01]/.test(this.l[this.b+c]);)c++;if(0===c)throw"binary number syntax error";b=parseInt(this.l.slice(this.b,this.b+c),2);b=new ag(this.b,this.line,this.Ea,b);this.b+=c;this.Ea+=2+c}else if(/[0-9]/.test(this.l[this.b])){for(;this.b+c<this.L&&/[0-9]/.test(this.l[this.b+c]);)c++;if(this.Hf&&this.b+c<this.L&&"."===this.l[this.b+c]){for(c++;this.b+c<this.L&&
/[0-9]/.test(this.l[this.b+c]);c++);b=parseFloat(this.l.slice(this.b,this.b+c));b=new bg(this.b,this.line,this.Ea,b)}else b=parseInt(this.l.slice(this.b,this.b+c),10),b=new ag(this.b,this.line,this.Ea,b);this.b+=c;this.Ea+=c}else if(/[a-zA-Z_]/.test(this.l[this.b])){for(;this.b+c<this.L&&/[a-zA-Z0-9_.]/.test(this.l[this.b+c]);)c++;if(0===c)throw"name syntax error";b=new cg(this.b,this.line,this.Ea,this.l.slice(this.b,this.b+c));this.b+=c;this.Ea+=c}else throw"syntax error line "+this.line.toString()+
" col "+this.Ea.toString();c=b}}if(null===c)break;this.C.push(c)}};function eg(a,b,c,d){this.og=a;this.line=b;this.Ea=c;this.Lc=d}function fg(a,b,c){(b=b.head||b.children[0]&&b.children[0].head)&&a.Ub.push(new eg(b.pd,b.$c,b.Yc,void 0===c?a.Ia:c))}function N(a){this.head=a;this.children=[];this.ib=0;this.resultType=gg;this.rb=!0}function hg(a,b){for(var c=0;c<a.length;c++)a[c]=a[c].D(b)}N.prototype.D=function(){return this};N.prototype.La=function(a){this.children.forEach(function(b){b.La(a)})};
N.prototype.w=function(a){this.La(a);for(var b=0;b<this.children.length;b++)this.children[b]=this.children[b].w(a);return this};function O(a,b){N.call(this,a);this.n=void 0===b?this.head.n:b;this.resultType=Pf}O.prototype=Object.create(N.prototype);O.prototype.constructor=O;O.prototype.La=function(){this.ib=1};function ig(a){a&=65535;return 32768<=a?a-65536:a}function jg(a,b){O.call(this,a,b);this.resultType=Q}jg.prototype=Object.create(O.prototype);jg.prototype.constructor=jg;
function R(a){N.call(this,a);this.name=a.name;this.b=!1}R.prototype=Object.create(N.prototype);R.prototype.constructor=R;R.prototype.La=function(a){a.P.hasOwnProperty(this.name)?(this.ib=1,this.resultType=a.P[this.name].resultType):(a=Wf(a,this),this.ib=a.size,this.resultType=a.resultType)};R.prototype.D=function(a){return a.P.hasOwnProperty(this.name)?a.P[this.name].resultType===Q?new jg(this.head,a.P[this.name].O):new O(this.head,a.P[this.name].O):this};
function kg(a){var b=new R(a.head);b.resultType=a.resultType;b.b=!0;return b}var gg="?",Pf="n",Q="fx";function S(a,b,c,d){N.call(this,a);this.type=b;this.resultType=c?c.resultType:gg;this.Ca=c;this.children=d||[]}S.prototype=Object.create(N.prototype);S.prototype.constructor=S;
S.prototype.La=function(a){N.prototype.La.call(this,a);for(var b=1,c=0;c<this.children.length;c++)if(1===b)b=this.children[c].ib;else if(1!==this.children[c].ib&&this.children[c].ib!==b)throw"incompatible sizes "+L(this.head);this.ib=b;this.Ca&&this.Ca.ja&&(this.resultType=this.Ca.ja(a,this,this.children.map(function(a){return a.resultType})))};S.prototype.D=function(a){this.children=this.children.map(function(b){return b.D(a)});return this.Ca&&this.Ca.D?this.Ca.D(this,a):this};
S.prototype.w=function(a){var b=N.prototype.w.call(this,a);if(b.type===T&&b.Ca.priority===lg&&(b.children[1]instanceof mg||b.children[1]instanceof R&&1!==b.children[1].ib)){var c=b.children[0];if(!(c instanceof R)||b.rb)throw"bad array assignment "+L(b.head);for(var d=b.children[1],e=new ng(b.head),f=0;f<d.ib;f++){var g=c;1<d.ib&&(g=new og(c.head,[new O(c.head,f)]),g.resultType=c.resultType);if(d instanceof mg)var h=d.children[f];else h=new og(d.head,[new O(c.head,f)]),h.resultType=d.resultType;g=
new S(b.head,b.type,b.Ca,[g,h]);g.resultType=c.resultType;g.rb=!1;g=g.D(a);e.children.push(g)}return e}return b};function og(a,b){R.call(this,a);this.children=b}og.prototype=Object.create(R.prototype);og.prototype.constructor=og;og.prototype.La=function(a){N.prototype.La.call(this,a);a=Wf(a,this);this.ib=1;this.resultType=a.resultType};function pg(a){for(var b=0;b<a.children.length;b++)if(!(a.children[b]instanceof O))return!1;return!0}
function qg(a,b){for(var c=0,d=1,e=0;e<a.children.length;e++){if(!(a.children[e]instanceof O))throw"internal";c+=d*a.children[e].n;d*=b.v[e]}return c}function mg(a){N.call(this,a);this.v=[]}mg.prototype=Object.create(N.prototype);mg.prototype.constructor=mg;mg.prototype.La=function(a){this.ib=this.children.length;this.children[0]&&(this.children.forEach(function(b){b.La(a)}),this.resultType=this.children[0].resultType)};function U(a,b){N.call(this,a);this.type=b||rg;this.va=!1;this.Ka=[null]}
U.prototype=Object.create(N.prototype);v=U.prototype;v.constructor=U;v.pf=function(){throw"internal";};v.dg=function(){};v.fg=function(){throw"internal";};v.eg=function(){};v.Ed=function(){};function sg(a,b){b.Jc=b.Kc;fg(b,a)}var rg=1;function tg(a,b){this.b=a;this.$=b}tg.prototype.u=function(){return"internal"};function ug(a,b){U.call(this,a,2);this.Ee=b}ug.prototype=Object.create(U.prototype);ug.prototype.constructor=ug;ug.prototype.D=function(a){hg(this.children,a);return this};
ug.prototype.pf=function(){return this};function vg(a,b){U.call(this,a,2);this.pg=b}vg.prototype=Object.create(U.prototype);vg.prototype.constructor=vg;vg.prototype.D=function(a){hg(this.children,a);return this};vg.prototype.pf=function(){return this};function wg(a){U.call(this,a)}wg.prototype=Object.create(U.prototype);wg.prototype.constructor=wg;function xg(a,b,c){U.call(this,a);this.b=b;this.O=c;this.resultType=c.resultType}xg.prototype=Object.create(U.prototype);xg.prototype.constructor=xg;
function yg(a,b,c,d,e){U.call(this,a);this.P=b.name;this.resultType=c;this.b=d||null;this.size=-1;this.v=[];this.offset=-1;e&&this.children.push(e)}yg.prototype=Object.create(U.prototype);yg.prototype.constructor=yg;yg.prototype.La=function(a){this.children[0]&&(N.prototype.La.call(this,a),this.resultType=this.children[0].children[1].resultType)};yg.prototype.D=function(a){hg(this.children,a);return this};function zg(a){U.call(this,a.head);this.children.push(a)}zg.prototype=Object.create(U.prototype);
zg.prototype.constructor=zg;zg.prototype.D=function(a){hg(this.children,a);return this};function ng(a){U.call(this,a)}ng.prototype=Object.create(U.prototype);ng.prototype.constructor=ng;ng.prototype.D=function(a){hg(this.children,a);return this};function Ag(a,b){U.call(this,a,3);this.b=[b];this.g=[];this.l=[]}Ag.prototype=Object.create(U.prototype);v=Ag.prototype;v.constructor=Ag;v.La=function(a){this.b.forEach(function(b){b.La(a)});this.g.forEach(function(b){b.forEach(function(b){b.La(a)})})};
v.D=function(a){hg(this.b,a);this.g.forEach(function(b){hg(b,a)});return this};v.fg=function(a){if(this.g.length>=this.b.length)throw"multiple else "+L(a.head);a instanceof Bg&&this.b.push(a.b);this.g.push(this.children);this.l.push(a);this.children=[];this.Ka.push(a.Ka[0])};
v.Ed=function(a,b){this.g.push(this.children);this.children=[];this.l.push(b);for(a=0;a<this.b.length;)if(this.b[a]instanceof O)if(0===this.b[a].n)this.b.splice(a,1),this.g.splice(a,1);else{this.b.splice(a);this.g.splice(a+1);break}else a++};function Bg(a,b){U.call(this,a,4);this.b=b}Bg.prototype=Object.create(U.prototype);Bg.prototype.constructor=Bg;Bg.prototype.D=function(a){this.b=this.b.D(a);hg(this.children,a);return this};function Cg(a){U.call(this,a,4)}Cg.prototype=Object.create(U.prototype);
Cg.prototype.constructor=Cg;function Dg(a,b){U.call(this,a,3);this.b=b}Dg.prototype=Object.create(U.prototype);Dg.prototype.constructor=Dg;Dg.prototype.La=function(a){N.prototype.La.call(this,a);this.b.La(a)};Dg.prototype.D=function(a){this.b=this.b.D(a);hg(this.children,a);return this};function Eg(a,b){U.call(this,a,3);this.b=b;this.g=[]}Eg.prototype=Object.create(U.prototype);Eg.prototype.constructor=Eg;Eg.prototype.La=function(a){N.prototype.La.call(this,a);this.b.La(a)};
Eg.prototype.D=function(a){this.b=this.b.D(a);hg(this.children,a);return this};Eg.prototype.Ed=function(a,b){this.b instanceof O&&(0===this.b.n&&(this.children=[]),this.b=null);this.g.push(b)};function Fg(a,b,c,d,e){U.call(this,a,3);this.l=new R(b);this.children.push(c);this.children.push(d);this.b=e||null;this.g=[]}Fg.prototype=Object.create(U.prototype);Fg.prototype.constructor=Fg;Fg.prototype.La=function(a){N.prototype.La.call(this,a);this.b&&this.b.La(a)};
Fg.prototype.D=function(a){this.b&&(this.b=this.b.D(a));hg(this.children,a);return this};Fg.prototype.Ed=function(a,b){this.g.push(b)};function Gg(a,b,c){U.call(this,a);this.name=b;this.children=c}Gg.prototype=Object.create(U.prototype);Gg.prototype.constructor=Gg;Gg.prototype.D=function(a){hg(this.children,a);return this};function Hg(a,b){U.call(this,a);this.name=b}Hg.prototype=Object.create(U.prototype);Hg.prototype.constructor=Hg;function Ig(a){U.call(this,a,5)}Ig.prototype=Object.create(U.prototype);
Ig.prototype.constructor=Ig;var lg=30,T=1;function V(a,b,c){this.name=a;this.type=b;this.priority=c&&c.priority||0;this.resultType=c&&c.resultType||(c&&c.ja?gg:Pf);this.ja=c&&c.ja||null;this.D=c&&c.D||null;this.J=c&&c.J||[];this.u=c&&c.u||null}function Jg(a,b){for(var c=[],d=0;d<a.children.length;d++){if(!(a.children[d]instanceof O))return a;c.push(a.children[d].n)}return new O(a.head,ig(b(c)))}
var Tf=[new V("--",0,{priority:150}),new V("++",0,{priority:150}),new V("-",0,{priority:150,D:function(a){return Jg(a,function(a){return-a[0]})},J:[28672]}),new V("~",0,{priority:150,D:function(a){return Jg(a,function(a){return~a[0]})},J:[28674]}),new V("abs",0,{priority:150,D:function(a){return Jg(a,function(a){return Math.abs(a[0])})},J:[28673]}),new V("not",0,{priority:150,resultType:"b",D:function(a){return Jg(a,function(a){return 0==a[0]?1:0})},J:[4096,32778]}),new V("size",0,{priority:150,D:function(a,
b){var c=0<a.children[0].ib?a.children[0].ib:a.children[0]instanceof mg?a.children[0].children.length:-1;if(0>c&&a.children[0]instanceof R)for(var d=b.Ta.length-1;0<=d;d--)if(b.Ta[d].name===a.children[0].name){c=b.Ta[d].size;break}return 0<c?new O(a.head,c):a}}),new V("--",2,{priority:150}),new V("++",2,{priority:150}),new V("+=",T,{priority:lg}),new V("-=",T,{priority:lg}),new V("*=",T,{priority:lg}),new V("/=",T,{priority:lg}),new V("%=",T,{priority:lg}),new V("<<=",T,{priority:lg}),new V(">>=",
T,{priority:lg}),new V("&=",T,{priority:lg}),new V("|=",T,{priority:lg}),new V("^=",T,{priority:lg}),new V("*",T,{priority:140,D:function(a){return Jg(a,function(a){return a[0]*a[1]})},J:[32772]}),new V("/",T,{priority:140,D:function(a){return Jg(a,function(a){return Math.trunc(a[0]/a[1])})},J:[32773]}),new V("%",T,{priority:140,D:function(a){return Jg(a,function(a){return a[0]%a[1]})},J:[32774]}),new V("+",T,{priority:130,D:function(a){return Jg(a,function(a){return a[0]+a[1]})},J:[32770]}),new V("-",
T,{priority:130,D:function(a){return Jg(a,function(a){return a[0]-a[1]})},J:[32771]}),new V("<<",T,{priority:120,D:function(a){return Jg(a,function(a){return a[0]<<a[1]})},J:[32768]}),new V(">>",T,{priority:120,D:function(a){return Jg(a,function(a){return a[0]>>a[1]})},J:[32769]}),new V("==",T,{priority:80,resultType:"b",D:function(a){return Jg(a,function(a){return a[0]===a[1]?1:0})},J:[32778]}),new V("!=",T,{priority:80,resultType:"b",D:function(a){return Jg(a,function(a){return a[0]!==a[1]?1:0})},
J:[32779]}),new V("<",T,{priority:80,resultType:"b",D:function(a){return Jg(a,function(a){return a[0]<a[1]?1:0})},J:[32782]}),new V("<=",T,{priority:80,resultType:"b",D:function(a){return Jg(a,function(a){return a[0]<=a[1]?1:0})},J:[32783]}),new V(">",T,{priority:80,resultType:"b",D:function(a){return Jg(a,function(a){return a[0]>a[1]?1:0})},J:[32780]}),new V(">=",T,{priority:80,resultType:"b",D:function(a){return Jg(a,function(a){return a[0]>=a[1]?1:0})},J:[32781]}),new V("&",T,{priority:110,D:function(a){return Jg(a,
function(a){return a[0]&a[1]})},J:[32777]}),new V("|",T,{priority:90,D:function(a){return Jg(a,function(a){return a[0]|a[1]})},J:[32775]}),new V("^",T,{priority:100,D:function(a){return Jg(a,function(a){return a[0]^a[1]})},J:[32776]}),new V("and",T,{priority:60,resultType:"b",D:function(a){return Jg(a,function(a){return a[0]&&a[1]?1:0})},J:[32785]}),new V("or",T,{priority:50,resultType:"b",D:function(a){return Jg(a,function(a){return a[0]||a[1]?1:0})},J:[32784]}),new V("=",T,{priority:lg})];
function Kg(a,b,c){for(var d=0;d<a.Nb.length;d++)if(a.Nb[d].type===c&&a.Nb[d].name===b)return a.Nb[d];return null}function X(a,b,c){return a.C[a.m+b]instanceof c}function Y(a,b,c){return a.C[a.m+b]instanceof dg&&a.C[a.m+b].name===c}v=Df.prototype;v.Xf=function(a){return new S(a,4,null)};
function Z(a,b){b=b||10;if(X(a,0,bg)){var c=new jg(a.C[a.m]);a.m++}else if(X(a,0,ag))c=new O(a.C[a.m]),a.m++;else if(X(a,0,cg))Y(a,1,"(")?(c=a.Xf(a.C[a.m]),a.m++,Y(a,1,")")?a.m+=2:c.children=Lg(a)):(c=new R(a.C[a.m]),a.m++);else if(Y(a,0,"(")){a.m++;c=Z(a,20);if(!Y(a,0,")"))throw"subexpression in expression "+L(a.C[a.m]);a.m++}else if(Y(a,0,"[")){c=new mg(a.C[a.m]);a.m++;var d=[];for(var e=0,f=0,g=0;;){d.push(Z(a,25));0===g&&f++;g++;if(1<f&&g>e)throw"non-rectangular array "+L(a.C[a.m]);g>e&&(e=g);
if(X(a,0,dg))if(a.m++,"]"===a.C[a.m-1].name)break;else if(","===a.C[a.m-1].name)continue;else if(";"===a.C[a.m-1].name){e=g;g=0;continue}throw"array "+L(a.C[a.m-1]);}for(g=0;g<e;g++)for(var h=0;h<f;h++)c.children.push(d[h*e+g])}else if(X(a,0,dg)&&(d=Kg(a,a.C[a.m].name,0)))c=new S(a.C[a.m],0,d),a.m++,c.children.push(Z(a,150)),d.ja&&(c.resultType=d.ja(a,c,[c.children[0].resultType]));else if(X(a,0,dg)&&(d=Kg(a,a.C[a.m].name,3)))c=new S(a.C[a.m],3,d),a.m++;else{if(a.m<a.C.length)throw"unexpected token in expression "+
L(a.C[a.m]);throw"unexpected end of file";}for(;X(a,0,dg);)if((d=Kg(a,a.C[a.m].name,2))&&d.priority>=b)c=new S(a.C[a.m],2,d,[c]),a.m++;else if((d=Kg(a,a.C[a.m].name,T))&&(b===lg?d.priority>=b:d.priority>b))c=new S(a.C[a.m],T,d,[c]),a.m++,c.children.push(Z(a,d.priority)),d.ja&&(c.resultType=d.ja(a,c,c.children.map(function(a){return a.resultType})));else if("["===a.C[a.m].name){if(!(c instanceof R))throw"unexpected indexing";d=c.resultType;e=Lg(a,!0);c=new og(c.head,e);c.resultType=d}else break;return c}
function Lg(a,b){var c=[];if(!Y(a,0,b?"[":"("))throw"left "+(b?"bracket":"parenthesis")+" expected";for(a.m++;;){var d=Z(a,25);c.push(d);if(!X(a,0,dg))throw"syntax error in arguments";if(Y(a,0,b?"]":")")){a.m++;break}else if(Y(a,0,","))a.m++;else throw"syntax error in arguments "+L(a.C[a.m]);}return c}
v.ag=function(){if(this.m>=this.C.length)throw"no more tokens";if(this.C[this.m]instanceof dg){var a=this.C[this.m];switch(a.name){case "const":if(!X(this,1,cg)||!Y(this,2,"="))throw'syntax error for "const" '+L(a);var b=this.C[this.m+1];this.m+=3;var c=Z(this);c=c.D(this);if(!(c instanceof O))throw"non-constant expression in constant definition "+L(this.C[this.m]);return[new xg(a,b.name,c)];case "var":if(!X(this,1,cg))throw'unexpected token after "var" '+L(a);b=this.C[this.m+1];this.m+=2;if(X(this,
0,dg))switch(this.C[this.m].name){case "[":if(Y(this,1,"]")){this.m+=2;if(!Y(this,0,"="))throw"missing size or initial value in array declaration"+L(this.C[this.m-2]);c=new S(this.C[this.m],T,Kg(this,"=",T),[new R(b)]);this.m++;c.children.push(Z(this));c.resultType=c.children[1].resultType;c.rb=!1;var d=new S(new dg(c.head.pd,c.head.$c,c.head.Yc,"size"),0,Kg(this,"size",0),[c.children[1]]);return[new yg(a,b,c.resultType,[d],c)]}this.m++;d=Z(this);if(!Y(this,0,"]"))throw"array size syntax error"+L(this.C[this.m]);
this.m++;return Y(this,0,"=")?(c=new S(this.C[this.m],T,Kg(this,"=",T),[new R(b)]),this.m++,c.children.push(Z(this)),c.resultType=c.children[1].resultType,c.rb=!1,c=c.D(this),[new yg(a,b,c.resultType,[d],c)]):[new yg(a,b,gg,[d])];case "=":return c=new S(this.C[this.m],T,Kg(this,"=",T),[new R(b)]),this.m++,c.children.push(Z(this)),c.resultType=c.children[1].resultType,c.rb=!1,c=c.D(this),[new yg(a,b,c.resultType,null,c)]}return[new yg(a,b,gg)];case "if":case "elseif":this.m++;c=Z(this);if(!Y(this,
0,"then"))throw'"then" expected after "if" statement '+L(this.C[this.m]);this.m++;return["if"===a.name?new Ag(a,c):new Bg(a,c)];case "when":this.m++;c=Z(this);if(!Y(this,0,"do"))throw'"do" expected after "when" statement '+L(this.C[this.m]);this.m++;return[new Dg(a,c)];case "while":this.m++;c=Z(this);if(!Y(this,0,"do"))throw'"do" expected after "while" statement '+L(this.C[this.m]);this.m++;return[new Eg(a,c)];case "for":if(!X(this,1,cg)||!Y(this,2,"in"))throw'"for" syntax error '+L(a);b=this.C[this.m+
1];this.m+=3;c=Z(this);if(!Y(this,0,":"))throw'range expected in "for" statement '+L(this.C[this.m]);this.m++;d=Z(this);var e=null;Y(this,0,"step")&&(this.m++,e=Z(this));if(!Y(this,0,"do"))throw'"do" expected after "for" statement '+L(this.C[this.m]);this.m++;return[new Fg(a,b,c,d,e)];case "end":return this.m++,[new Ig(a)];case "call":if(!X(this,1,cg))throw'"call" syntax error '+L(a);b=this.C[this.m+1];this.m+=2;return Y(this,0,"(")?[new Gg(a,b.name,Lg(this))]:[new Gg(a,b.name,[])];case "callsub":if(!X(this,
1,cg))throw'"callsub" syntax error '+L(a);b=this.C[this.m+1];this.m+=2;return[new Hg(a,b.name)];case "else":return this.m++,[new Cg(a)];case "onevent":if(!X(this,1,cg))throw'unexpected token after "onevent" '+L(a);b=this.C[this.m+1];this.m+=2;return[new ug(a,b.name)];case "return":return this.m++,[new wg(a)];case "sub":if(!X(this,1,cg))throw'unexpected token after "sub" '+L(a);b=this.C[this.m+1];this.m+=2;return[new vg(a,b.name)]}}c=Z(this);c instanceof S&&(c.rb=!1);c=c.D(this);return[new zg(c)]};
v.hg=function(){};v.gg=function(){};
v.ue=function(a){if(a instanceof xg){a.O=a.O.D(this);if(!(a.O instanceof O))throw"constant definition "+L(a.head);this.P[a.b]={O:a.O.n,resultType:a.O.resultType}}else a instanceof yg&&(a.size=1,a.v=[],a.b&&(a.b=a.b.map(function(b){b=b.D(this);if(!(b instanceof O)||0>=b.n)throw"array variable size "+L(a.head);a.size*=b.n;a.v.push(b.n);return b},this)),a.offset=this.Ma,a.children[0]&&(a.resultType=a.children[0].resultType),this.Ma+=a.size,this.sd(a.P,a.size,a.v,a.offset,a.resultType))};v.Fd=function(){};
v.qa=function(){};v.getContext=function(){return null};v.Lf=function(){this.Ma=this.ya.Ma;for(var a=0;a<this.g.length;a++)this.ue(this.g[a])};function Mg(a,b,c){switch(b.type){case 3:c.push(a.getContext());a.qa(b.Ka[0]);break;case 4:a.qa(b.Ka[0]);break;case 5:a.qa(c.pop())}}
function Ng(a){function b(){if(1<f.length){var a=f[f.length-1].head;throw"unterminated "+a.name+" "+L(a);}c.o.push(f[0])}var c=a,d=[];a.Lf();a.Fd();d=[];a.g.forEach(function(a){Mg(this,a,d);a.La(this)},a);a.Fd();d=[];for(var e=0;e<a.g.length;e++)Mg(a,a.g[e],d),a.g[e]=a.g[e].D(a);a.Fd();d=[];for(e=0;e<a.g.length;e++)Mg(a,a.g[e],d),a.g[e]=a.g[e].w(a);a.o=[];var f=[new ug(null,"init")];a.Fd();for(e=0;e<a.g.length;e++)switch(a.g[e].type){case rg:a.g[e].Ed(a,a.g[e]);f[f.length-1].children.push(a.g[e]);
break;case 2:a.qa(a.g[e].Ka[0]);b();f=[a.g[e].pf()];break;case 3:a.qa(a.g[e].Ka[0]);a.g[e].dg(a);f.push(a.g[e]);break;case 4:a.qa(a.g[e].Ka[0]);f[f.length-1].fg(a.g[e]);break;case 5:if(2>f.length)throw"unexpected end "+L(a.g[e].head);a.qa(a.g[e].Ka[0]);f[f.length-1].eg(a.g[e]);var g=f.pop();a.qa(a.g[e].Ka[a.g[e].Ka.length-1]);g.Ed(a,a.g[e]);f[f.length-1].children.push(g);break;default:throw"not implemented "+a.g[e].type;}b()}v.ig=function(){};v.Vf=function(){return null};
N.prototype.u=function(a){for(var b=[],c=a.Ia,d=0;d<this.children.length;d++)b=b.concat(this.children[d].u(a)),a.Ia=c+b.length;return b};function Og(a){return-2048<=a&&2048>a?[4096|a&4095]:[8192,a&65535]}O.prototype.u=function(){return this.rb?Og(this.n):[]};R.prototype.u=function(a){return this.b?[]:a.P.hasOwnProperty(this.name)?Og(a.P[this.name].O):Wf(a,this).hd(a)};
S.prototype.u=function(a){function b(b,d,e,f){function g(b,g){f===c.sf&&(h=h.concat(b.hd(a,g)));e&&(h=h.concat(b.hd(a,g)));h=h.concat(d.u(a)).concat(a.wb(d.resultType,b.resultType)).concat(b.He(a,g));f===c.pe&&(h=h.concat(b.hd(a,g)))}var h=[];if(b instanceof og){var l=Wf(a,b);if(pg(b)){b=qg(b,l);if(b>=l.size)throw"index out of range";g(l,b)}else if(f!==c.Te||e){var m=Yf(a,1);h=h.concat(Pg(b,a)).concat(16384|m);f===c.sf&&(h=h.concat(12288|m).concat(l.je(a)));e&&(h=h.concat(12288|m).concat(l.je(a)));
h=h.concat(d.u(a)).concat(a.wb(d.resultType,l.resultType)).concat(12288|m).concat(l.hf(a));f===c.pe&&(h=h.concat(12288|m).concat(l.je(a)))}else h=h.concat(d.u(a)).concat(a.wb(d.resultType,l.resultType)).concat(Pg(b,a)).concat(l.hf(a))}else if(b instanceof R)l=Wf(a,b),g(l);else throw"bad assignment";return h}var c={Te:0,pe:1,sf:2},d=this.head.name;switch(d){case "=":return b(this.children[0],this.children[1],!1,this.rb?c.pe:c.Te);case "++":case "--":if(!(this.children[0]instanceof R))throw"invalid operand "+
L(this.head);var e=d[0],f=Kg(a,e,T);e=new S(new dg(this.head.pd,this.head.$c,this.head.Yc,e),T,f,[kg(this.children[0]),new O(new ag(this.head.pd,this.head.$c,this.head.Yc,1))]);f.ja&&(d=Wf(a,this.children[0]),e.resultType=f.ja(a,e,[d.resultType,Pf]));return b(this.children[0],e,!0,this.rb?0===this.type?c.pe:c.sf:c.Te);default:if(this.type===T&&this.Ca.priority===lg){if(!(this.children[0]instanceof R))throw"invalid operand "+L(this.head);e=d.slice(0,-1);f=Kg(a,e,T);e=new S(new dg(this.head.pd,this.head.$c,
this.head.Yc,e),T,f,[kg(this.children[0]),this.children[1]]);f.ja&&(d=Wf(a,this.children[0]),e.resultType=f.ja(a,e,[d.resultType,this.children[1].resultType]));return b(this.children[0],e,!0,this.rb?c.pe:c.Te)}if(this.Ca&&this.Ca.u)return this.Ca.u(this,a);switch(this.type){case 0:return N.prototype.u.call(this,a).concat(this.Ca.J);case T:return N.prototype.u.call(this,a).concat(this.Ca.J);case 3:return this.Ca.J;case 4:f=a.Vf(this);if(null!==f)return f;e=Xf(a,d);if(null!=e){if(e.Sc!==this.children.length)throw"wrong number of arguments";
f=[];d=Yf(a,e.Sc+(e.Xd||0));for(var g=0;g<this.children.length;g++)f=f.concat(this.children[g].u(a)),f=f.concat(16384|d+g);return f=f.concat(e.Eb(a,a.ya,this.children.map(function(a){return a.resultType}),d))}throw"unknown function "+d+" "+L(this.head);default:throw"internal";}}};function Qg(a,b,c){return a instanceof S&&2===a.children.length?a.children[0].u(b).concat(a.children[1].u(b)).concat([40960|(c?256:0)|a.Ca.J[0]&255,0]):a.u(b).concat(4096,40960|(c?256:0)|Mf.indexOf("ne"),0)}
function Pg(a,b){var c=Wf(b,a);if(a.children.length>c.v.length)throw"too many indices"+L(a.head);for(var d=[],e=1,f=0;f<a.children.length;f++)d=d.concat(a.children[f].u(b)),0<f&&(d=d.concat(4096|e,32772,32770)),e*=c.v[f];return d}og.prototype.u=function(a){if(this.b)return[];var b=Wf(a,this);if(pg(this)){var c=qg(this,b);if(c>=b.size)throw"index out of range "+L(this.head);return b.hd(a,c)}return Pg(this,a).concat(b.je(a))};mg.prototype.u=function(){throw"internal";};
U.prototype.u=function(){throw"internal";};ug.prototype.u=function(a){var b=a.getContext();sg(this,a);a.qa(this.Ka[0]);var c="init"===this.Ee?a.Kf:[];a.Ia+=c.length;c=c.concat(N.prototype.u.call(this,a)).concat(0);a.qa(b);return c};vg.prototype.u=function(a){var b=a.getContext();sg(this,a);a.qa(this.Ka[0]);var c=N.prototype.u.call(this,a).concat(57344);a.qa(b);return c};xg.prototype.u=function(a){sg(this,a);return[]};
yg.prototype.u=function(a){sg(this,a);return 0===this.children.length?[]:N.prototype.u.call(this,a)};zg.prototype.u=function(a){sg(this,a);return this.children[0].u(a)};ng.prototype.u=function(a,b){sg(this,a);var c=[];this.children.forEach(function(d){c=c.concat(d.u(a,b))});return c};
Ag.prototype.u=function(a){var b=a.getContext();sg(this,a);for(var c=a.Ia,d=[],e=0,f=0;f<this.b.length;f++)a.Ia=c+d.length,0<f&&fg(a,this.l[f-1]),d=d.concat(Qg(this.b[f],a)),a.Ia=c+d.length,Uf(a,d),a.qa(this.Ka[f]),this.g[f].forEach(function(b){d=d.concat(b.u(a));a.Ia=c+d.length}),a.qa(b),f+1<this.g.length?(d=d.concat(36864),Vf(a,d),Uf(a,d),e++):Vf(a,d);a.Ia=c+d.length;this.g.length>this.b.length&&(fg(a,this.l[this.b.length-1],a.Ia+d.length),a.qa(this.Ka[this.b.length]),this.g[this.b.length].forEach(function(b){d=
d.concat(b.u(a));a.Ia=c+d.length}));for(;0<e--;)Vf(a,d);a.qa(b);return d};Dg.prototype.u=function(a){var b=a.getContext();sg(this,a);var c=a.Ia,d=Qg(this.b,a,!0);Uf(a,d);a.qa(this.Ka[0]);this.children.forEach(function(b){a.Ia=c+d.length;d=d.concat(b.u(a))});Vf(a,d);a.qa(b);return d};
Eg.prototype.u=function(a){if(null==this.b&&0===this.children.length)return[];var b=a.getContext();sg(this,a);var c=a.Ia,d=[];null!=this.b&&(d=Qg(this.b,a));Uf(a,d);a.qa(this.Ka[0]);this.children.forEach(function(b){a.Ia=c+d.length;d=d.concat(b.u(a))});a.Ia=c+d.length;fg(a,this.g[0]);d=d.concat(36864|-d.length&4095);Vf(a,d);a.qa(b);return d};
Fg.prototype.u=function(a){var b=a.getContext();sg(this,a);var c=a.Ia,d=this.children[0].u(a),e=Wf(a,this.l);d=d.concat(e.He(a));var f=d.length;d=d.concat(e.hd(a)).concat(this.children[1].u(a)).concat(40975,0);Uf(a,d);a.qa(this.Ka[0]);for(var g=2;g<this.children.length;g++)a.Ia=c+d.length,d=d.concat(this.children[g].u(a));a.Ia=c+d.length;fg(a,this.g[0]);d=d.concat(e.hd(a));d=this.b?d.concat(this.b.u(a)):d.concat(Og(1));d=d.concat(32770,e.He(a),36864|f-d.length-2&4095);Vf(a,d);a.qa(b);return d};
Gg.prototype.u=function(a){sg(this,a);var b=Qf(a.ya,this.name);if(!b)throw'native function "'+this.name+'" not found';if(this.children.length!==b.B.length)throw'wrong number of arguments for native function "'+this.name+'"';for(var c=[],d=[],e=[],f=this.children.length-1;0<=f;f--){var g=this.children[f];if(0>b.B[f])if(void 0==d[-b.B[f]-1])d[-b.B[f]-1]=g.ib;else{if(d[-b.B[f]-1]!==g.ib)throw'argument size mismatch in native function "'+this.name+'"';}else 0===b.B[f]&&e.push(g.ib);if(g instanceof og)c=
c.concat(Og(Wf(a,g).offset)).concat(Pg(g,a)).concat(32770);else if(g instanceof R)c=c.concat(Og(Wf(a,g).offset));else{for(var h=Yf(a,g.ib),l=0;l<g.ib;l++)c=c.concat((g instanceof mg?g.children[l]:g).u(a)),c=c.concat(16384|h+l);c=c.concat(Og(h))}}for(f=e.length-1;0<=f;f--)c=Og(e[f]).concat(c);for(f=d.length-1;0<=f;f--)void 0!==d[f]&&(c=Og(d[f]).concat(c));return c=c.concat(49152|b.id)};wg.prototype.u=function(a){sg(this,a);return[(a.nf?14:0)<<12]};function Rg(a,b){tg.call(this,a,b)}Rg.prototype=Object.create(tg.prototype);
Rg.prototype.constructor=Rg;Rg.prototype.u=function(){var a=this.$.name;if(void 0===this.b.Ld[a])throw'unknown function "'+a+'" '+L(this.$.head);return 53248|this.b.Ld[a]};Hg.prototype.u=function(a){sg(this,a);return[new Rg(a,this)]};function Sg(a,b){b=b||0;for(var c=0;c<a.length;c++)a[c]instanceof tg&&(a[c]=a[c].u(b+c))}
Df.prototype.u=function(){this.jb=[];this.Fd();this.Ub=[];var a=this.o.map(function(a){this.Ia=0;this.qa(a.Ka[0]);this.nf=a instanceof vg;this.Ub=[];return{ud:a.u(this,!0),mapping:this.Ub}},this);if(0<this.jb.length)throw"internal";for(var b=0,c=0;c<this.o.length;c++)this.o[c]instanceof ug&&b++;this.Ld={};var d=[],e=[1+2*b];this.Ub=[];for(c=0;c<this.o.length;c++)this.Ub=this.Ub.concat(a[c].mapping.map(function(a){return new eg(a.og,a.line,a.Ea,a.Lc+1+2*b+d.length)})),this.o[c]instanceof ug?(e=e.concat(Sf(this.ya,
this.o[c].Ee),1+2*b+d.length),d=d.concat(a[c].ud)):this.o[c]instanceof vg&&(this.Ld[this.o[c].pg]=1+2*b+d.length,d=d.concat(a[c].ud));Sg(d,1+2*b);return e.concat(d)};function Hf(a){a.Ze();a.hg();a.m=0;for(a.g=[];a.m<a.C.length;)a.g=a.g.concat(a.ag());a.gg();Ng(a);a.ig();return a.u()};function Tg(a,b,c){void 0===c&&(c=1);return{name:a,Sc:c,Xd:1,ie:function(a){return null!=Qf(a,b)},Eb:function(a,e,f,g){a=Qf(e,b);e=[4097];for(f=0;f<c;f++)e=e.concat([4096|g+c-1-f]);return e=e.concat([4096|g+c,49152|a.id,12288|g+c])}}}var Ef=[Tg("min","math.min",2),Tg("max","math.max",2),Tg("clamp","math.clamp",3),Tg("muldiv","math.muldiv",3),Tg("atan2","math.atan2",2),Tg("sin","math.sin"),Tg("cos","math.cos"),Tg("sqrt","math.sqrt"),Tg("rand","math.rand",0)];function Ff(a,b){Df.call(this,a,b);this.Hf=!0;this.Nb=Ug;this.ob=100;this.tg=[];this.Ge=[];this.Jf=[];this.labels=[[]];this.If=[];this.xb=!1;this.label=null;this.fa=gg;this.va=[]}Ff.prototype=Object.create(Df.prototype);Ff.prototype.constructor=Ff;var Vg="== != <= >= |= ^= &= *= /= %= += -= <<= >>= ++ -- ( ) [ ] - ~ ! * / % + << >> && || & ^ | > < = , ? : { } ; bool break case const continue default do else emit false fixed for goto if int onevent return size switch true void when while".split(" ");
function Wg(a,b,c){return c[0]}function Xg(a,b,c){for(a=0;a<c.length;a++)switch(c[a]){case gg:case Q:return c[a];case "v":throw"cannot use void result in expression";}return Pf}function Yg(a,b,c){if(!(a instanceof mg)&&a.resultType!==b&&a.resultType!==gg){if("v"===a.resultType)throw"cannot use void result "+L(a.head);if(b=Zg(b))a=new S(new dg(a.head.pd,a.head.$c,a.head.Yc,b),0,Kg(c,b,0),[a]),a=a.D(c)}return a}function $g(a,b){a.children[1]=Yg(a.children[1],a.resultType,b);return a}
Ff.prototype.wb=function(a,b){if(a===gg||b===gg)throw"internal";if("v"===a)throw"bad conversion from void";switch(a){case Pf:case "b":switch(b){case Q:return[4196,32772]}break;case Q:switch(b){case Pf:case "b":return[4196,32773]}}return[]};function ah(a,b,c){var d=[];a.forEach(function(a){d=a instanceof jg&&b===Pf?d.concat(Og(Math.trunc(a.n))):a instanceof O&&a.resultType===Pf&&b===Q?d.concat(Og(a.n*c.ob)):d.concat(a.u(c)).concat(c.wb(a.resultType,b))});return d}
function bh(a,b,c,d){var e=Yf(a,4);return(b instanceof N?b.u(a):Og(b)).concat(16384|e).concat(c instanceof N?c.u(a):Og(c)).concat(16384|e+1).concat(d instanceof N?d.u(a):Og(d)).concat([16384|e+2,4097,4096|e+2,4096|e+1,4096|e,4096|e+3,49152|Qf(a.ya,"math.muldiv").id,12288|e+3])}
function ch(a,b,c,d){for(var e=!1,f=[],g=0;g<a.children.length;g++){if(a.children[g]instanceof jg)e=!0;else if(!(a.children[g]instanceof O))return a;f.push(a.children[g].n)}c=(e&&d?d:c)(f);d=a.Ca.resultType;a.Ca.ja&&(d=a.Ca.ja(b,a,a.children.map(function(a){return a.resultType})));switch(d){case Pf:case "b":return new O(a.head,ig(c));case Q:return new jg(a.head,c);default:throw"internal";}}
var Ug=[new V("--",0,{priority:150,ja:Wg}),new V("++",0,{priority:150,ja:Wg}),new V("-",0,{priority:150,ja:Wg,D:function(a,b){return ch(a,b,function(a){return-a[0]})},J:[28672]}),new V("~",0,{priority:150,D:function(a,b){return ch(a,b,function(a){return~a[0]})},J:[28674]}),new V("!",0,{priority:150,resultType:"b",D:function(a,b){return ch(a,b,function(a){return 0==a[0]?1:0})},J:[4096,32778]}),new V("bool",0,{priority:150,resultType:"b",D:function(a,b){return ch(a,b,function(a){return 0!=a[0]?1:0})},
J:[],u:function(a,b){b=a.children[0].u(b);"b"!==a.children[0].resultType&&(b=b.concat(4096,32779));return b}}),new V("fixed",0,{priority:150,resultType:Q,D:function(a,b){return ch(a,b,function(a){return a[0]})},J:[],u:function(a,b){var c=a.children[0].u(b);a.children[0].resultType!==Q&&(c=c.concat(4096|b.ob,32772));return c}}),new V("int",0,{priority:150,D:function(a,b){return ch(a,b,function(a){return a[0]})},J:[],u:function(a,b){var c=a.children[0].u(b);a.children[0].resultType===Q&&(c=c.concat(4096|
b.ob,32773));return c}}),new V("size",0,{priority:150,D:function(a,b){var c=0<a.children[0].ib?a.children[0].ib:a.children[0]instanceof mg?a.children[0].children.length:-1;if(0>c&&a.children[0]instanceof R)for(var d=b.Ta.length-1;0<=d;d--)if(b.Ta[d].name===a.children[0].name){c=b.Ta[d].size;break}return 0<c?new O(a.head,c):a}}),new V("--",2,{priority:150,ja:Wg}),new V("++",2,{priority:150,ja:Wg}),new V("+=",T,{priority:lg,ja:Wg,D:$g}),new V("-=",T,{priority:lg,ja:Wg}),new V("*=",T,{priority:lg,ja:Wg}),
new V("/=",T,{priority:lg,ja:Wg}),new V("%=",T,{priority:lg,ja:Wg}),new V("<<=",T,{priority:lg}),new V(">>=",T,{priority:lg}),new V("&=",T,{priority:lg}),new V("|=",T,{priority:lg}),new V("^=",T,{priority:lg}),new V("*",T,{priority:140,ja:Xg,J:[32772],D:function(a,b){return ch(a,b,function(a){return a[0]*a[1]})},u:function(a,b){var c=a.children[1].resultType===Q,d=[];a.children[0].resultType===Q&&c?d=d.concat(bh(b,a.children[0],a.children[1],b.ob)):(a.children.forEach(function(a){d=d.concat(a.u(b))}),
d=d.concat(a.Ca.J));return d}}),new V("/",T,{priority:140,ja:Xg,J:[32773],D:function(a,b){return ch(a,b,function(b){if(0===b[1])throw"division by 0 "+L(a.head);return Math.trunc(b[0]/b[1])},function(b){if(0===b[1])throw"division by 0 "+L(a.head);return b[0]/b[1]})},u:function(a,b){var c=a.children[1].resultType===Q,d=[];a.children[0].resultType===Q?c?d=d.concat(bh(b,a.children[0],b.ob,a.children[1])):(a.children.forEach(function(a){d=d.concat(a.u(b))}),d=d.concat(a.Ca.J)):c?d=d.concat(bh(b,a.children[0],
b.ob*b.ob,a.children[1])):(a.children.forEach(function(a){d=d.concat(a.u(b))}),d=d.concat(a.Ca.J));return d}}),new V("%",T,{priority:140,ja:Xg,D:function(a,b){return ch(a,b,function(b){if(0===b[1])throw"division by 0 "+L(a.head);return b[0]%b[1]})},J:[32774],u:function(a,b){return ah(a.children,a.resultType,b).concat(a.Ca.J)}}),new V("+",T,{priority:130,ja:Xg,D:function(a,b){return ch(a,b,function(a){return a[0]+a[1]})},J:[32770],u:function(a,b){return ah(a.children,a.resultType,b).concat(a.Ca.J)}}),
new V("-",T,{priority:130,ja:Xg,D:function(a,b){return ch(a,b,function(a){return a[0]-a[1]})},J:[32771],u:function(a,b){return ah(a.children,a.resultType,b).concat(a.Ca.J)}}),new V("<<",T,{priority:120,D:function(a,b){return ch(a,b,function(a){return a[0]<<a[1]})},J:[32768],u:function(a,b){return a.children[0].u(b).concat(ah(a.children.slice(1),Pf,b)).concat(a.Ca.J)}}),new V(">>",T,{priority:120,D:function(a,b){return ch(a,b,function(a){return a[0]>>a[1]})},J:[32769],u:function(a,b){return a.children[0].u(b).concat(ah(a.children.slice(1),
Pf,b)).concat(a.Ca.J)}}),new V("==",T,{priority:80,resultType:"b",D:function(a,b){return ch(a,b,function(a){return a[0]===a[1]?1:0})},J:[32778],u:function(a,b){var c=a.children.map(function(a){return a.resultType});return ah(a.children,Xg(b,a,c),b).concat(a.Ca.J)}}),new V("!=",T,{priority:80,resultType:"b",D:function(a,b){return ch(a,b,function(a){return a[0]!==a[1]?1:0})},J:[32779],u:function(a,b){var c=a.children.map(function(a){return a.resultType});return ah(a.children,Xg(b,a,c),b).concat(a.Ca.J)}}),
new V("<",T,{priority:80,resultType:"b",D:function(a,b){return ch(a,b,function(a){return a[0]<a[1]?1:0})},J:[32782],u:function(a,b){var c=a.children.map(function(a){return a.resultType});return ah(a.children,Xg(b,a,c),b).concat(a.Ca.J)}}),new V("<=",T,{priority:80,resultType:"b",D:function(a,b){return ch(a,b,function(a){return a[0]<=a[1]?1:0})},J:[32783],u:function(a,b){var c=a.children.map(function(a){return a.resultType});return ah(a.children,Xg(b,a,c),b).concat(a.Ca.J)}}),new V(">",T,{priority:80,
resultType:"b",D:function(a,b){return ch(a,b,function(a){return a[0]>a[1]?1:0})},J:[32780],u:function(a,b){var c=a.children.map(function(a){return a.resultType});return ah(a.children,Xg(b,a,c),b).concat(a.Ca.J)}}),new V(">=",T,{priority:80,resultType:"b",D:function(a,b){return ch(a,b,function(a){return a[0]>=a[1]?1:0})},J:[32781],u:function(a,b){var c=a.children.map(function(a){return a.resultType});return ah(a.children,Xg(b,a,c),b).concat(a.Ca.J)}}),new V("&",T,{priority:110,D:function(a,b){return ch(a,
b,function(a){return a[0]&a[1]})},J:[32777]}),new V("|",T,{priority:90,D:function(a,b){return ch(a,b,function(a){return a[0]|a[1]})},J:[32775]}),new V("^",T,{priority:100,D:function(a,b){return ch(a,b,function(a){return a[0]^a[1]})},J:[32776]}),new V("&&",T,{priority:60,ja:Wg,D:function(a,b){return ch(a,b,function(a){return a[0]&&a[1]?1:0})},J:[32785],u:function(a,b){var c=a.children[0].u(b).concat([16384|b.fc,12288|b.fc,4096,40960|Mf.indexOf("eq"),4,12288|b.fc,36864]);Uf(b,c);a=Yg(a.children[1],
a.children[0].resultType,b).D(b);c=c.concat(a.u(b));Vf(b,c);return c}}),new V("||",T,{priority:50,ja:Wg,D:function(a,b){return ch(a,b,function(a){return a[0]||a[1]?1:0})},J:[32784],u:function(a,b){var c=a.children[0].u(b).concat([16384|b.fc,12288|b.fc,4096,40960|Mf.indexOf("ne"),4,12288|b.fc,36864]);Uf(b,c);a=Yg(a.children[1],a.children[0].resultType,b).D(b);c=c.concat(a.u(b));Vf(b,c);return c}}),new V("?",T,{priority:40,ja:function(a,b,c){return c[1]},D:function(a){if(!(a.children[1]instanceof S)||
0==a.children[1].Ca||":"!==a.children[1].Ca.name)throw"missing else part in conditional expression "+L(a.head);return a.children[0]instanceof O?a.children[1].children[a.children[0].n?0:1]:a},u:function(a,b){var c=Qg(a.children[0],b);Uf(b,c);c=c.concat(a.children[1].children[0].u(b)).concat(36864);Vf(b,c);Uf(b,c);c=c.concat(a.children[1].children[1].u(b));Vf(b,c);return c}}),new V(":",T,{priority:41,ja:Wg,D:function(a,b){a.children[1]=Yg(a.children[1],a.children[0].resultType,b);return a},u:function(a){throw"unexpected colon outside conditional expression "+
L(a.head);}}),new V("=",T,{priority:lg,ja:Wg,D:$g}),new V(",",T,{priority:25,ja:function(a,b){return b[1]},D:function(a){a.children[0].rb=!1;return a}}),new V("false",3,{resultType:"b",D:function(a,b){return ch(a,b,function(){return 0})},J:[4096]}),new V("true",3,{resultType:"b",D:function(a,b){return ch(a,b,function(){return 1})},J:[4097]})];v=Ff.prototype;
v.ng=function(){for(;this.b<this.L;)if(" "===this.l[this.b]||"\t"===this.l[this.b])this.b++,this.Ea++;else if("\n"===this.l[this.b])this.b++,this.Ea=0,this.line++;else if("\r"===this.l[this.b])this.b++;else if("/*"===this.l.slice(this.b,this.b+2))for(this.b+=2,this.Ea+=2;this.b<this.L&&"*/"!==this.l.slice(this.b-2,this.b);)"\n"===this.l[this.b]?(this.Ea=0,this.line++):"\r"!==this.l[this.b]&&this.Ea++,this.b++;else if("//"===this.l.slice(this.b,this.b+2))for(;this.b<this.L&&"\n"!==this.l[this.b];)this.b++,
this.Ea++;else break};v.Ze=function(a){return Df.prototype.Ze.call(this,a||Vg)};v.hg=function(){this.C.forEach(function(a,b){a instanceof dg&&("def"===a.name||0<=["int","bool","fixed","void"].indexOf(a.name))&&this.C[b+1]instanceof cg&&this.C[b+2]instanceof dg&&"("===this.C[b+2].name&&this.tg.push(this.C[b+1].name)},this)};
function dh(a,b){switch(a.name){case "var":case "def":return b||Pf;case "void":return"v";case "int":return Pf;case "bool":return"b";case "fixed":return Q;default:throw"internal";}}function Zg(a){switch(a){case Pf:return"int";case Q:return"fixed";case "b":return"bool";default:return""}}function eh(a){return Y(a,0,"int")||Y(a,0,"bool")||Y(a,0,"fixed")}
v.ag=function(){function a(){var a=[];for(this.m++;;){d=this.C[this.m];this.m++;if(!X(this,0,dg))throw"syntax error "+L(c);switch(this.C[this.m].name){case "[":if(Y(this,1,"]")){this.m+=2;if(!Y(this,0,"="))throw"missing size or initial value in array declaration"+L(this.C[this.m-2]);e=new S(this.C[this.m],T,Kg(this,"=",T),[new R(d)]);this.m++;e.children.push(Z(this,25));e.resultType=dh(c,e.children[1].resultType);e.children[1].La(this);e.rb=!1;var b=new S(new dg(this.C[this.m].pd,this.C[this.m].$c,
this.C[this.m].Yc,"size"),0,Kg(this,"size",0),[e.children[1]]);a.push(new yg(c,d,e.resultType,[b],e))}else b=Lg(this,!0),Y(this,0,"=")?(e=new S(this.C[this.m],T,Kg(this,"=",T),[new R(d)]),this.m++,e.children.push(Z(this,25)),e.resultType=dh(c,e.children[1].resultType),e.rb=!1,a.push(new yg(c,d,e.resultType,b,e))):a.push(new yg(c,d,dh(c),b));break;case "=":e=new S(this.C[this.m],T,Kg(this,"=",T),[new R(d)]);this.m++;e.children.push(Z(this,25));e.resultType=dh(c,e.children[1].resultType);e.rb=!1;e=
e.D(this);a.push(new yg(c,d,e.resultType,null,e));break;default:a.push(new yg(c,d,dh(c)))}if(Y(this,0,","))this.m++;else{if(Y(this,0,";"))return this.m++,a;throw"missing semicolon "+L(this.C[this.m]);}}}function b(){var a=dh(c);d=this.C[this.m+1];this.m+=3;var b=[];if(!Y(this,0,")"))for(;;){var e=Pf;eh(this)&&(e=dh(this.C[this.m]),this.m++);if(!X(this,0,cg))throw"bad function definition argument "+L(this.C[this.m]);var f=this.C[this.m].name,g=[],h=!1;this.m++;Y(this,0,"[")&&(h=!0,g=Lg(this,!0));b.push({name:f,
type:e,Bg:g,size:1,v:[],Dc:h});if(Y(this,0,","))this.m++;else if(Y(this,0,")"))break;else throw"syntax error in function definition "+L(this.C[this.m]);}this.m++;if(!Y(this,0,"{"))throw"block expected after function header "+L(this.C[this.m]);this.m++;return new fh(c,d.name,a,b)}if(this.m>=this.C.length)throw"no more tokens";var c=this.C[this.m];if(this.C[this.m]instanceof dg)switch(c.name){case "const":if(!X(this,1,cg)||!Y(this,2,"="))throw'syntax error for "const" '+L(c);var d=this.C[this.m+1];
this.m+=3;var e=Z(this,25);e=e.D(this);if(!(e instanceof O))throw"non-constant expression in constant definition "+L(this.C[this.m]);if(!Y(this,0,";"))throw"missing semicolon "+L(c);this.m++;return[new xg(c,d.name,e)];case "int":case "bool":case "fixed":if(!X(this,1,cg))throw'unexpected token after "'+c.name+'" '+L(c);return Y(this,2,"(")?[b.call(this)]:a.call(this);case "void":return[b.call(this)];case "if":this.m++;var f=Lg(this);if(1!==f.length)throw'bad condition in "if" statement '+L(this.C[this.m]);
var g=new Ag(c,f[0]);Y(this,0,"{")?this.m++:g.va=!0;return[g];case "when":this.m++;f=Lg(this);if(1!==f.length)throw'bad condition in "when" statement '+L(this.C[this.m]);if(!Y(this,0,"{"))throw'block expected after "when" statement '+L(this.C[this.m]);this.m++;return[new Dg(c,f[0])];case "switch":this.m++;f=Lg(this);if(1!==f.length)throw'bad expression in "switch" statement '+L(this.C[this.m]);if(!Y(this,0,"{"))throw'block expected after "switch" statement '+L(this.C[this.m]);this.m++;return[new gh(c,
f[0])];case "case":this.m++;e=Z(this);if(!Y(this,0,":"))throw'missing colon after "case" '+L(this.C[this.m]);this.m++;return[new hh(c,e)];case "default":if(!Y(this,1,":"))throw'missing colon after "default" '+L(this.C[this.m]);this.m+=2;return[new hh(c,null)];case "goto":if(!X(this,1,cg))throw'missing label after "goto" '+L(this.C[this.m]);d=this.C[this.m+1];this.m+=2;return[new ih(c,d.name)];case "while":this.m++;f=Lg(this);if(1!==f.length)throw'bad condition in "while" statement '+L(this.C[this.m]);
if(Y(this,0,";"))return this.m++,[new jh(c,f[0])];if(!Y(this,0,"{"))throw'block expected after "while" statement '+L(this.C[this.m]);this.m++;return[new kh(c,f[0])];case "do":if(!Y(this,1,"{"))throw'block expected after "do" statement '+L(this.C[this.m]);this.m+=2;return[new lh(c)];case "for":if(!Y(this,1,"("))throw'"for" syntax error '+L(c);this.m+=2;d=null;var h=Pf;if(Y(this,0,";"))e=null;else{if(Y(this,0,"var")||eh(this)){if(!X(this,1,cg))throw'bad variable declaration in "for" statement '+L(this.C[this.m]);
h=dh(this.C[this.m]);this.m++;d=this.C[this.m]}e=Z(this);if(!Y(this,0,";"))throw'semicolon expected in "for" statement '+L(this.C[this.m]);}this.m++;if(Y(this,0,";"))g=null;else if(g=Z(this),!Y(this,0,";"))throw'semicolon expected in "for" statement '+L(this.C[this.m]);this.m++;if(Y(this,0,")"))f=null;else if(f=Z(this),!Y(this,0,")"))throw'semicolon expected in "for" statement '+L(this.C[this.m]);this.m++;if(!Y(this,0,"{"))throw'block expected after "for" statement '+L(this.C[this.m]);this.m++;return[new mh(c,
d,h,e,g,f)];case ";":return this.m++,[new nh(c)];case "{":return this.m++,[new oh(c)];case "}":this.m++;if(Y(this,0,"else")){this.m++;if(Y(this,0,"if")){this.m++;f=Lg(this);if(1>f.length)throw'empty condition in "if" statement '+L(this.C[this.m]);1<f.length&&(g=new ng(c),g.children=f.slice(0,-1).map(function(a){a instanceof S&&(a.rb=!1);return a}),f=f.slice(-1));if(!Y(this,0,"{"))throw'block expected after "if" statement '+L(this.C[this.m]);this.m++;return[new Bg(c,f[0])]}if(!Y(this,0,"{"))throw'block expected after "else" statement '+
L(this.C[this.m]);this.m++;return[new Cg(c)]}return[new Ig(c)];case "else":throw'unexpected "else" '+L(this.C[this.m]);case "onevent":if(!X(this,1,cg))throw'unexpected token after "onevent" '+L(c);if(!Y(this,2,"{"))throw'block expected after "onevent" statement '+L(this.C[this.m]);d=this.C[this.m+1];this.m+=3;return[new ph(c,d.name)];case "return":this.m++;Y(this,0,";")?e=null:e=Z(this);if(!Y(this,0,";"))throw"missing semicolon "+L(c);this.m++;return[new qh(c,e)];case "break":d=null;X(this,1,cg)&&
(d=this.C[this.m+1],this.m++);if(!Y(this,1,";"))throw"missing semicolon "+L(c);this.m+=2;return[new rh(c,!1,d?d.name:null)];case "continue":d=null;X(this,1,cg)&&(d=this.C[this.m+1],this.m++);if(!Y(this,1,";"))throw"missing semicolon "+L(c);this.m+=2;return[new rh(c,!0,d?d.name:null)]}if(X(this,0,cg)&&Y(this,1,"(")&&(d=this.C[this.m],Qf(this.ya,d.name)))return this.m++,[new Gg(c,d.name,Lg(this))];if(X(this,0,cg)&&Y(this,1,":"))return d=this.C[this.m],this.m+=2,[new sh(c,d.name)];e=Z(this);e.rb=!1;
if(!Y(this,0,";"))throw"missing semicolon "+(this.m<this.C.length?L(this.C[this.m]):"eof");this.m++;e=e.D(this);return[new zg(e)]};
v.ue=function(a){if(a instanceof fh){for(var b=0;b<a.B.length;b++)a.B[b].size=1,a.B[b].v=a.B[b].Bg.map(function(c){c=c.D(this);if(!(c instanceof O))throw"non-constant expression in argument dimension "+L(c.head);if(0>=c.n||Math.round(c.n)!==c.n)throw"bad value for argument dimension "+L(c.head);a.B[b].size*=c.n;return c.n},this),this.sd(a.B[b].name,a.B[b].size,a.B[b].v,this.Ma,a.B[b].type,a.B[b].Dc),this.Ma+=a.B[b].Dc?1:a.B[b].size;a.Ka[1]={Ta:this.Ta.slice(),labels:this.labels.slice()}}else a instanceof
mh?a.fa&&(this.sd(a.fa.name,1,[1],this.Ma,a.Qa),this.Ma+=1,a.Ka[1]={Ta:this.Ta.slice(),labels:this.labels.slice()}):Df.prototype.ue.call(this,a)};v.Fd=function(){this.Ta=this.Jf;this.labels=this.If};v.qa=function(a){a&&(this.Ta=a.Ta,this.labels=a.labels)};v.getContext=function(){return{Ta:this.Ta,labels:this.labels.slice()}};function th(a,b,c,d,e,f,g){Of.call(this,a,b,c,d,e);this.xb=f;this.Dc=g||!1}th.prototype=Object.create(Of.prototype);v=th.prototype;v.constructor=th;
v.hd=function(a,b){return this.xb?this.Dc?[12288|a.w,20480|this.offset,a.ya.b,20480|(b||0),a.ya.b]:[12288|a.w,20480|this.offset+(b||0),a.ya.b]:[12288|this.offset+(b||0)]};v.He=function(a,b){return this.xb?this.Dc?[12288|a.w,20480|this.offset,a.ya.b,24576|(b||0),a.ya.b]:[12288|a.w,24576|this.offset+(b||0),a.ya.b]:[16384|this.offset+(b||0)]};v.je=function(a){return this.xb?this.Dc?[12288|a.w,20480|this.offset,a.ya.b,32770,20480,a.ya.b]:[12288|a.w,32770,20480|this.offset,a.ya.b]:[20480|this.offset,this.size]};
v.hf=function(a){return this.xb?this.Dc?[12288|a.w,20480|this.offset,a.ya.b,32770,24576,a.ya.b]:[12288|a.w,32770,24576|this.offset,a.ya.b]:[24576|this.offset,this.size]};Ff.prototype.sd=function(a,b,c,d,e,f){this.Ta.push(new th(a,b,c,d,e,this.xb,f))};function uh(a){S.call(this,a,4,null)}uh.prototype=Object.create(S.prototype);uh.prototype.constructor=uh;v=Ff.prototype;
v.Xf=function(a){var b=new uh(a,this.xb,this.Ma);b.Ca={ja:function(b,d){var c;a:{for(c=0;c<b.Ge.length;c++)if(b.Ge[c].gf===a.name){c=b.Ge[c];break a}c=null}return c?c.resultType:(c=Xf(b,a.name))&&c.ja?c.ja(b,c,d):Pf}};return b};
v.Lf=function(){this.Ma=this.ya.Ma;this.xb=!1;for(var a=[],b=0;b<this.g.length;b++){if(0<=[Ig,Bg,Cg].indexOf(this.g[b].constructor)){if(0===a.length)throw"unexpected end of block "+L(this.g[b].head);var c=a.pop();this.Ma=c.Ma;this.xb=c.xb;c.Jg.Ka[0]={Ta:this.Ta.slice(),labels:this.labels.slice()};this.Ta.splice(c.Ng);this.labels.pop();0===a.length&&(this.fa=gg)}0<=[Ag,Dg,gh,kh,oh,mh,ph,fh,Bg,Cg].indexOf(this.g[b].constructor)&&(a.push({Ma:this.Ma,xb:this.xb,Ng:this.Ta.length,Jg:this.g[b]}),this.labels.push([]),
this.g[b]instanceof fh&&(this.xb=!0,this.fa=this.g[b].resultType,this.Ma=0));this.ue(this.g[b]);if(this.g[b]instanceof sh){c=this.g[b].label;for(var d=this.labels.length-1,e=0;e<this.labels[d].length;e++)if(this.labels[d][e].label===c)throw'duplicate label "'+c+'"';this.labels[d].push({label:c})}}this.Jf=this.Ta.slice();this.If=this.labels};
v.gg=function(){for(var a=1;a<this.g.length;)this.g[a]instanceof jh&&this.g[a-1]instanceof Ig?this.g.splice(a-1,1):a++;this.g.forEach(function(a){a instanceof fh&&(this.Ge.push(a),this.fa=a.resultType)},this);for(a=0;a<this.g.length-1;a++)this.g[a]instanceof sh&&(this.g[a+1]instanceof kh?this.g[a+1].label=this.g[a].label:this.g[a+1]instanceof lh?this.g[a+1].label=this.g[a].label:this.g[a+1]instanceof mh?this.g[a+1].label=this.g[a].label:this.g[a+1]instanceof gh&&(this.g[a+1].label=this.g[a].label))};
v.ig=function(){for(var a=0;a<this.g.length;a++)(this.g[a]instanceof ph||this.g[a]instanceof fh)&&this.o.push(this.g[a])};function vh(a,b){for(var c=a.length-1;0<=c;c--)for(var d=a[c].length-1;0<=d;d--)if(a[c][d].label===b)return a[c][d];return null}
v.u=function(){this.jb=[];this.Fd();this.Ub=[];this.fc=this.Jc=this.Kc=this.ya.b-2;this.w=this.fc+1;this.Kf=[];var a=this.o.map(function(a){this.Ia=0;this.qa(a.Ka[0]);this.nf=a instanceof vg||a instanceof fh;this.xb=a instanceof fh;this.Ub=[];a=a.u(this,!0);Sg(a);return{ud:a,mapping:this.Ub}},this);if(0<this.jb.length)throw"internal";for(var b=0,c=0;c<this.o.length;c++)this.o[c]instanceof ug&&b++;var d=[],e={},f=[];this.Ub=[];for(c=0;c<this.o.length;c++){var g=1+2*b+f.length;this.o[c]instanceof ph||
this.o[c]instanceof ug?(d.push({id:Sf(this.ya,this.o[c].Ee),offset:f.length}),f=f.concat(a[c].ud)):this.o[c]instanceof vg?(e[this.o[c].pg]=f.length,f=f.concat(a[c].ud)):this.o[c]instanceof fh&&(e[this.o[c].gf]=f.length,f=f.concat(a[c].ud));this.Ub=this.Ub.concat(a[c].mapping.map(function(a){return new eg(a.og,a.line,a.Ea,a.Lc+g)}))}a=[1+2*d.length];for(c=0;c<d.length;c++)a=a.concat(d[c].id,1+2*d.length+d[c].offset);for(c=0;c<f.length;c++)if("string"===typeof f[c]){if(void 0===e[f[c]])throw wh(f[c]),
'unknown function "'+f[c]+'"';f[c]=53248|e[f[c]]+a.length}return a.concat(f)};
v.Vf=function(a){for(var b=a.head.name,c=0;c<this.o.length;c++)if(this.o[c]instanceof fh&&this.o[c].gf===b){if(a.children.length!==this.o[c].B.length)throw"wrong number of arguments "+L(a.head);b=a.rb?[b,12288|this.fc]:[b];this.xb?0<this.Ma&&(b=[12288|this.w,4096|this.Ma,32770,16384|this.w].concat(b).concat(12288|this.w,4096|this.Ma,32771,16384|this.w)):b=[4096|this.Ma,16384|this.w].concat(b);for(var d=[],e=0;e<a.children.length;e++){if(this.o[c].B[e].size!==a.children[e].ib)throw"incompatible size "+
L(a.children[e].head);if(this.o[c].B[e].Dc){if(!(a.children[e]instanceof R))throw"variable reference expected "+L(a.children[e].head);if(this.o[c].B[e].type!==a.children[e].resultType)throw"variable reference type mismatch "+L(a.children[e].head);}if(this.o[c].B[e].Dc){var f=Wf(this,a.children[e]);d=d.concat(f.xb?f.Dc?[12288|this.w,20480|f.offset,this.ya.b]:[12288|this.w,4096|f.offset,32770]:[4096|f.offset]).concat(this.xb?[12288|this.w,24576|e+this.Ma,this.ya.b]:16384|e+this.Ma)}else a.children[e]=
Yg(a.children[e],this.o[c].B[e].type,this).D(this),d=d.concat(a.children[e].u(this)).concat(this.wb(a.children[e].resultType,this.o[c].B[e].type)).concat(this.xb?[12288|this.w,24576|e+this.Ma,this.ya.b]:16384|e+this.Ma)}return d.concat(b)}return null};function xh(a){a=a.trim();if(""===a)return!1;var b=["#","//","/*"].map(function(b){b=a.indexOf(b);return 0>b?a.length:b}).sort(function(a,b){return a-b})[0];return b<a.length?"#"!==a[b]:/[;{]/.test(a)}
jg.prototype.u=function(a){return Og(Math.round(this.n*a.ob))};function oh(a){U.call(this,a,3)}oh.prototype=Object.create(U.prototype);oh.prototype.constructor=oh;oh.prototype.D=function(a){hg(this.children,a);return this};oh.prototype.u=function(a){var b=a.getContext();sg(this,a);a.qa(this.Ka[0]);var c=N.prototype.u.call(this,a);a.qa(b);return c};function nh(a){U.call(this,a)}nh.prototype=Object.create(U.prototype);nh.prototype.constructor=nh;nh.prototype.u=function(){return[]};
function kh(a,b){Eg.call(this,a,b);this.label=null}kh.prototype=Object.create(Eg.prototype);kh.prototype.constructor=kh;kh.prototype.u=function(a){if(null==this.b&&0===this.children.length)return[];var b=a.getContext();sg(this,a);var c=[],d=a.Ia;a.va.push({});null!=this.b&&(c=Qg(this.b,a));Uf(a,c);a.qa(this.Ka[0]);this.children.forEach(function(b){a.Ia=d+c.length;c=c.concat(b.u(a))});c=c.concat(36864|-c.length&4095);Vf(a,c);yh(c,0,c.length,this.label);a.va.pop();a.qa(b);return c};
function lh(a){U.call(this,a,3);this.label=this.b=null}lh.prototype=Object.create(U.prototype);lh.prototype.constructor=lh;lh.prototype.eg=function(a){if(!(a instanceof jh))throw'unexpected closing statement for "do"';this.b=a.b};
lh.prototype.u=function(a){if(null==this.b&&0===this.children.length)return[];var b=a.getContext();sg(this,a);var c=[],d=a.Ia;a.va.push({});a.qa(this.Ka[0]);this.children.forEach(function(b){a.Ia=d+c.length;c=c.concat(b.u(a))});null!=this.b&&(c=c.concat(Qg(new S(new dg(this.b.head.pd,this.b.head.$c,this.b.head.Yc,"not"),0,Kg(a,"!",0),[this.b]),a)),Uf(a,c),Vf(a,c,0));yh(c,0,c.length,this.label);a.va.pop();a.qa(b);return c};function jh(a,b){U.call(this,a,5);this.b=b}jh.prototype=Object.create(U.prototype);
jh.prototype.constructor=jh;function mh(a,b,c,d,e,f){U.call(this,a,3);d&&(d.rb=!1);f&&(f.rb=!1);this.fa=b;this.Qa=c;this.g=d;this.b=e;this.l=f;this.label=null;this.P=[]}mh.prototype=Object.create(U.prototype);v=mh.prototype;v.constructor=mh;v.La=function(a){N.prototype.La.call(this,a);this.g&&this.g.La(a);this.b&&this.b.La(a);this.l&&this.l.La(a)};v.D=function(a){this.g&&(this.g=this.g.D(a));this.b&&(this.b=this.b.D(a));this.l&&(this.l=this.l.D(a));hg(this.children,a);return this};
v.Ed=function(a,b){this.P.push(b)};
v.u=function(a){var b=a.getContext();sg(this,a);a.qa(this.Ka[1]);var c=a.Ia,d=this.g?this.g.u(a):[];a.va.push({});var e=d.length;this.b&&(d=d.concat(Qg(this.b,a)),Uf(a,d));a.qa(this.Ka[0]);for(var f=0;f<this.children.length;f++)a.Ia=c+d.length,d=d.concat(this.children[f].u(a));a.qa(this.Ka[1]);f=d.length;a.Ia=c+d.length;fg(a,this.P[0]);this.l&&(d=d.concat(this.l.u(a)));d=d.concat(36864|e-d.length&4095);this.b&&Vf(a,d);yh(d,f,d.length,this.label);a.va.pop();a.qa(b);return d};
function rh(a,b,c){U.call(this,a);this.L=b;this.label=c}rh.prototype=Object.create(U.prototype);rh.prototype.constructor=rh;function zh(a,b){tg.call(this,a,b)}zh.prototype=Object.create(tg.prototype);zh.prototype.constructor=zh;function yh(a,b,c,d){for(var e=0;e<a.length;e++)if(a[e]instanceof zh){var f=a[e].$.label;if(null==f||f===d)a[e]=a[e].$.L?36864|b-e&4095:36864|c-e&4095}}
function wh(a){if(a instanceof zh){var b=a.$.label;if(null!=b)throw"unknown "+(a.$.L?"continue":"break")+' label "'+b+'"'+L(a.$.head);throw'unexpected "'+(a.$.L?"continue":"break")+'" '+L(a.$.head);}}rh.prototype.u=function(a){if(0===a.va.length)throw(this.L?'"continue"':'"break"')+" outside loop "+L(this.head);sg(this,a);return[new zh(a,this)]};function gh(a,b){U.call(this,a,3);this.o=b;this.label=null}gh.prototype=Object.create(U.prototype);gh.prototype.constructor=gh;
gh.prototype.u=function(a){var b=a.Ia,c=this.o.u(a).concat(16384|a.fc),d=a.getContext();a.qa(this.Ka[0]);var e=!(this.children[0]instanceof hh);e&&(c=c.concat(36864),Uf(a,c));a.va.push({});for(var f=!1,g=0;g<this.children.length;)if(a.Ia=b+c.length,this.children[g]instanceof hh){for(var h=[],l=!1;g<this.children.length&&this.children[g]instanceof hh;){if(null!=this.children[g].o){var m=this.children[g].o.D(a);if(!(m instanceof O))throw'non-constant expression in "case" '+L(this.children[g].head);
h.push(m.n)}else l=!0;g++}l?e&&(Vf(a,c),e=!1):(1===h.length?(f&&(c=c.concat(36869)),e&&Vf(a,c),c=c.concat(12288|a.fc).concat(Og(h[0])).concat(40960|Mf.indexOf("eq"),0)):(f&&(c=c.concat(36864|4*h.length+1)),e&&Vf(a,c),h.forEach(function(b,d){c=c.concat(12288|a.fc).concat(Og(b)).concat(40960|Mf.indexOf("ne"),4*(h.length-d)-1)}),c=c.concat(36864)),Uf(a,c),e=!0);f=!0}else c=c.concat(this.children[g].u(a)),f=!(this.children[g]instanceof rh)&&!(this.children[g]instanceof qh),g++;yh(c,-1,c.length,this.label);
a.va.pop();a.qa(d);return c};function hh(a,b){U.call(this,a);this.o=b}hh.prototype=Object.create(U.prototype);hh.prototype.constructor=hh;hh.prototype.u=function(){throw(this.o?'"case"':'"default"')+" outside switch "+L(this.head);};function sh(a,b){U.call(this,a);this.label=b}sh.prototype=Object.create(U.prototype);sh.prototype.constructor=sh;sh.prototype.u=function(a){a.label=this.label;vh(a.labels,this.label).ug=a.Ia;return[]};function ih(a,b){U.call(this,a);this.label=b}ih.prototype=Object.create(U.prototype);
ih.prototype.constructor=ih;function Ah(a,b,c){tg.call(this,a,b);this.labels=c}Ah.prototype=Object.create(tg.prototype);Ah.prototype.constructor=Ah;Ah.prototype.u=function(a){var b=vh(this.labels,this.$.label);if(null===b)throw'unknown label "'+this.$.label+'" '+L(this.$.head);return 36864|b.ug-a&4095};ih.prototype.u=function(a){return[new Ah(a,this,a.labels.slice())]};function ph(a,b){U.call(this,a,3);this.Ee=b}ph.prototype=Object.create(U.prototype);ph.prototype.constructor=ph;
ph.prototype.D=function(a){hg(this.children,a);return this};ph.prototype.u=function(a,b){if(b){b=a.getContext();sg(this,a);a.qa(this.Ka[0]);var c=N.prototype.u.call(this,a).concat(0);a.qa(b);return c}return[]};function fh(a,b,c,d){U.call(this,a,3);this.gf=b;this.resultType=c;this.B=d}fh.prototype=Object.create(U.prototype);fh.prototype.constructor=fh;fh.prototype.dg=function(a){a.fa=this.resultType};fh.prototype.D=function(a){hg(this.children,a);return this};
fh.prototype.u=function(a,b){if(b){b=a.getContext();sg(this,a);a.qa(this.Ka[0]);var c=N.prototype.u.call(this,a).concat(57344);a.qa(b);return c}return[]};function qh(a,b){U.call(this,a);b&&this.children.push(b)}qh.prototype=Object.create(U.prototype);qh.prototype.constructor=qh;
qh.prototype.Ed=function(a){if(a.fa===gg)throw'"return" outside function definition '+L(this.head);if("v"===a.fa&&0<this.children.length)throw"unexpected return value in void function "+L(this.head);if("v"!==a.fa&&0===this.children.length)throw"missing return value in non-void function "+L(this.head);0<this.children.length&&(this.children[0]=Yg(this.children[0],a.fa,a).D(a))};
qh.prototype.u=function(a){sg(this,a);var b=[];0<this.children.length&&(b=this.children[0].u(a).concat(a.wb(this.children[0].resultType,a.fa)).concat(16384|a.fc));return b.concat(57344)};var Gf=[{name:"abs",Sc:1,ja:function(a,b){return b[0]},ie:function(){return!0},Eb:function(a,b,c,d){return[12288|d,28673]}},{name:"atan2",Sc:2,Xd:1,ja:function(){return Q},ie:function(a){return null!=Qf(a,"math.atan2")},Eb:function(a,b,c,d){return(c[0]===Q&&c[1]!==Q?[12288|d+1,4096|a.ob,32772,16384|d+1]:c[0]!==Q&&c[1]===Q?[12288|d,4096|a.ob,32772,16384|d]:[]).concat([4097,4096|d+1,4096|d,4096|d+2,49152|Qf(b,"math.atan2").id,12288|d+2,4096|Math.floor(32768/(a.ob*Math.PI)),32773])}},{name:"cos",Sc:1,
Xd:1,ja:function(){return Q},ie:function(a){return null!=Qf(a,"math.cos")},Eb:function(a,b,c,d){return[12288|d,4096|Math.round(32767/((c[0]===Q?a.ob:1)*Math.PI)),32772,16384|d,4097,4096|d,4096|d+1,49152|Qf(b,"math.cos").id,12288|d+1,4096|Math.floor(32768/a.ob),32773]}},Tg("rand","math.rand",0),{name:"random",Sc:0,Xd:1,ja:function(){return Q},ie:function(a){return null!=Qf(a,"math.rand")},Eb:function(a,b,c,d){return[4097,4096|d,49152|Qf(b,"math.rand").id,12288|d,28673,4096|Math.floor(32768/a.ob),32773]}},
{name:"stop",Sc:0,ja:function(){return"v"},Eb:function(){return[0]}},{name:"sin",Sc:1,Xd:1,ja:function(){return Q},ie:function(a){return null!=Qf(a,"math.sin")},Eb:function(a,b,c,d){return[12288|d,4096|Math.round(32767/((c[0]===Q?a.ob:1)*Math.PI)),32772,16384|d,4097,4096|d,4096|d+1,49152|Qf(b,"math.sin").id,12288|d+1,4096|Math.floor(32768/a.ob),32773]}},{name:"sqrt",Sc:1,Xd:6,ja:function(){return Q},Eb:function(a,b,c,d){b=Og(c[0]===Q?a.ob:a.ob*a.ob);return[4096|a.ob,16384|d+1,4106,16384|d+2,12288|
d,16384|d+4].concat(b).concat([16384|d+5,12288|d+1,16384|d+6,4097,4096|d+6,4096|d+5,4096|d+4,4096|d+3,49152|Qf(a.ya,"math.muldiv").id,12288|d+3,12288|d+1,32770,4098,32773,16384|d+1,12288|d+2,4097,32771,16384|d+2,12288|d+2,4096,40960|Mf.indexOf("le"),-(23+b.length)&65535,12288|d+1])}}];var Cf={name:"thymio-II",maxVarSize:620,variables:[{name:"_id",size:1},{name:"event.source",size:1},{name:"event.args",size:32},{name:"_fwversion",size:2},{name:"_productId",size:1},{name:"buttons._raw",size:5},{name:"button.backward",size:1},{name:"button.left",size:1},{name:"button.center",size:1},{name:"button.forward",size:1},{name:"button.right",size:1},{name:"buttons._mean",size:5},{name:"buttons._noise",size:5},{name:"prox.horizontal",size:7},{name:"prox.comm.rx._payloads",size:7},{name:"prox.comm.rx._intensities",
size:7},{name:"prox.comm.rx",size:1},{name:"prox.comm.tx",size:1},{name:"prox.ground.ambiant",size:2},{name:"prox.ground.reflected",size:2},{name:"prox.ground.delta",size:2},{name:"motor.left.target",size:1},{name:"motor.right.target",size:1},{name:"_vbat",size:2},{name:"_imot",size:2},{name:"motor.left.speed",size:1},{name:"motor.right.speed",size:1},{name:"motor.left.pwm",size:1},{name:"motor.right.pwm",size:1},{name:"acc",size:3},{name:"temperature",size:1},{name:"rc5.address",size:1},{name:"rc5.command",
size:1},{name:"mic.intensity",size:1},{name:"mic.threshold",size:1},{name:"mic._mean",size:1},{name:"timer.period",size:2},{name:"acc._tap",size:1}],localEvents:[{name:"button.backward"},{name:"button.left"},{name:"button.center"},{name:"button.forward"},{name:"button.right"},{name:"buttons"},{name:"prox"},{name:"prox.comm"},{name:"tap"},{name:"acc"},{name:"mic"},{name:"sound.finished"},{name:"temperature"},{name:"rc5"},{name:"motor"},{name:"timer0"},{name:"timer1"}],nativeFunctions:[{name:"_system_reboot",
args:[]},{name:"_system_settings_read",args:[1,1]},{name:"_system_settings_write",args:[1,1]},{name:"_system_settings_flash",args:[]},{name:"math.copy",args:[-1,-1]},{name:"math.fill",args:[-1,1]},{name:"math.addscalar",args:[-1,-1,1]},{name:"math.add",args:[-1,-1,-1]},{name:"math.sub",args:[-1,-1,-1]},{name:"math.mul",args:[-1,-1,-1]},{name:"math.div",args:[-1,-1,-1]},{name:"math.min",args:[-1,-1,-1]},{name:"math.max",args:[-1,-1,-1]},{name:"math.clamp",args:[-1,-1,-1,-1]},{name:"math.dot",args:[1,
-1,-1,1]},{name:"math.stat",args:[-1,1,1,1]},{name:"math.argbounds",args:[-1,1,1]},{name:"math.sort",args:[-1]},{name:"math.muldiv",args:[-1,-1,-1,-1]},{name:"math.atan2",args:[-1,-1,-1]},{name:"math.sin",args:[-1,-1]},{name:"math.cos",args:[-1,-1]},{name:"math.rot2",args:[2,2,1]},{name:"math.sqrt",args:[-1,-1]},{name:"math.rand",args:[-1]},{name:"_leds.set",args:[1,1]},{name:"sound.record",args:[1]},{name:"sound.play",args:[1]},{name:"sound.replay",args:[1]},{name:"sound.system",args:[1]},{name:"leds.circle",
args:[1,1,1,1,1,1,1,1]},{name:"leds.top",args:[1,1,1]},{name:"leds.bottom.left",args:[1,1,1]},{name:"leds.bottom.right",args:[1,1,1]},{name:"sound.freq",args:[1,1]},{name:"leds.buttons",args:[1,1,1,1]},{name:"leds.prox.h",args:[1,1,1,1,1,1,1,1]},{name:"leds.prox.v",args:[1,1]},{name:"leds.rc",args:[1]},{name:"leds.sound",args:[1]},{name:"leds.temperature",args:[1,1]},{name:"sound.wave",args:[142]},{name:"prox.comm.enable",args:[1]},{name:"sd.open",args:[1,1]},{name:"sd.write",args:[-1,1]},{name:"sd.read",
args:[-1,1]},{name:"sd.seek",args:[1,1]},{name:"_rf.nodeid",args:[1]},{name:"_poweroff",args:[]}]};function Bh(a,b,c){this.id=a;this.o=b;if(c instanceof ArrayBuffer)this.g=c;else if(c){for(a=b=0;a<c.length;a++)b="string"===typeof c[a]?b+(1+c[a].length):b+2;b=new ArrayBuffer(b);for(var d=new DataView(b),e=a=0;a<c.length;a++)if("string"===typeof c[a]){d.setUint8(e++,c[a].length);for(var f=0;f<c[a].length;f++)d.setUint8(e++,c[a].charCodeAt(f))}else 32768>c[a]?d.setInt16(e,c[a],!0):d.setUint16(e,c[a],!0),e+=2;this.g=b}else this.g=new ArrayBuffer(0)}
function Ch(a){function b(a){for(var b=[],d=0,e=0;e<a.length;e++)if(a[e]){for(var f=c.getUint8(d),g="",q=0;q<f;q++)g+=String.fromCharCode(c.getUint8(d+1+q));b.push(g);d+=1+f}else b.push(c.getUint16(d,!0)),d+=2;return b}var c=new DataView(a.g);switch(a.id){case Dh:var d=b([!0,!1,!1,!1,!1,!1,!1,!1]);a.nodeName=d[0];a.Qd=d[2];a.ae=d[3];a.rd=d[4];break;case Eh:d=b([!1,!0]);a.Ma=d[0];a.P=d[1];break;case Fh:d=b([!0,!0]);break;case Gh:var e=[!0,!0,!1];d=b(e);a.functionName=d[0];a.w=d[2];for(var f=0;f<a.w;f++)e.push(!1),
e.push(!0);d=b(e);a.ca=[];for(f=0;f<a.w;f++)a.ca.push({size:d[3+2*f]-(d[3+2*f]&32768?65536:0),name:d[4+2*f]});break;case Hh:c.getUint16(0,!0);a.vc=[];for(f=2;f<c.byteLength;f+=2)a.vc.push(c.getUint16(f,!0));break;case Ih:a.b=c.getUint16(0,!0);f=c.getUint16(2,!0);a.flags={flags:f,Wg:0!==(f&1),ah:0!==(f&2),Xg:0!==(f&4)};break;case Jh:a.b=c.getUint16(2,!0);a.result=c.getUint16(4,!0);break;case Kh:a.l=c.getUint16(0,!0);c.getUint16(2,!0);d=[];for(f=4;f<c.byteLength;f+=2)d.push(c.getUint16(f,!0));a.ud=
d;break;case Lh:case Mh:case Nh:case Oh:case Ph:case Qh:case Rh:a.l=c.getUint16(0,!0);break;case Sh:case Th:a.l=c.getUint16(0,!0);a.b=c.getUint16(2,!0);break;case Uh:a.l=c.getUint16(0,!0);c.getUint16(2,!0);c.getUint16(4,!0);break;case Vh:a.l=c.getUint16(0,!0);c.getUint16(2,!0);d=[];for(f=4;f<c.byteLength;f+=2)d.push(c.getUint16(f,!0));break;case Wh:a.version=c.getUint16(0,!0)}}
function Xh(a){var b=new ArrayBuffer(6+a.g.byteLength),c=new DataView(b);c.setUint16(0,a.g.byteLength,!0);c.setUint16(2,a.o,!0);c.setUint16(4,a.id,!0);(new Uint8Array(b)).set(new Uint8Array(a.g),6);return b}Bh.prototype.kb=function(){var a=new Bh(this.id,this.o,this.g);Ch(a);return a};Bh.prototype.toString=function(){var a=Yh[this.id]||"0x"+this.id.toString(16);a+=" from "+this.o.toString(10);0<=this.l&&(a+=" to "+this.l.toString());return a};
var Dh=36864,Eh=36865,Fh=36866,Gh=36867,Hh=36869,Ih=36874,Jh=36875,Kh=40961,Mh=40962,Nh=40963,Oh=40964,Ph=40965,Qh=40966,Rh=40967,Sh=40968,Th=40969,Lh=40970,Uh=40971,Vh=40972,Wh=40977,Yh={36864:"description",36865:"namedVariableDescription",36866:"localEventDescription",36867:"nativeFunctionDescription",36869:"variables",36874:"executionStateChanged",36876:"nodePresent",40960:"getDescription",40961:"setBytecode",40962:"reset",40963:"run",40964:"pause",40965:"step",40966:"stop",40967:"getExecutionState",
40968:"breakpointSet",40969:"breakpointClear",40970:"breakpointClearAll",40971:"getVariables",40972:"setVariables",40976:"getNodeDescription",40977:"listNodes"};function Zh(a){this.Bd=a&&a.Bd||54321;this.Sa=a&&a.Sa||[];this.zd=a&&a.zd||[];this.Lb=a&&a.Lb||[];this.Qd=a&&a.Qd||500;this.ae=a&&a.ae||200;this.rd=a&&a.rd||200;a=[];for(var b=0,c=0;c<this.Sa.length;c++)this.Sa[c].offset=b,a=a.concat(this.Sa[c].O),b+=this.Sa[c].O.length;for(;a.length<this.rd;)a.push(0);this.vc=a;this.J=[];this.b=0;this.g=!1;this.l=!0;this.o=!1;this.stack=[];this.P=[];this.write=this.w=this.L=null}
Zh.prototype.kb=function(){var a=new Zh({Bd:this.Bd,Sa:this.Sa,zd:this.zd,Lb:this.Lb,Qd:this.Qd,ae:this.ae,rd:this.rd});a.Qd=this.Qd;a.ae=this.ae;a.rd=this.rd;a.J=this.J.slice();a.b=this.b;a.g=this.g;a.l=this.l;a.o=this.o;a.stack=this.stack.slice();a.P=this.P.slice();return a};
function $h(a,b,c){if(a.L)for(var d=0;d<a.Sa.length;d++)if(a.Sa[d].offset+a.Sa[d].O.length>b&&a.Sa[d].offset<b+c.length)for(var e=0;e<a.Sa[d].O.length;e++)0<=a.Sa[d].offset+e-b&&a.Sa[d].offset+e-b<c.length&&a.L(a.Sa[d].name,e,c[a.Sa[d].offset+e-b],a.vc[a.Sa[d].offset+e]);c.forEach(function(a,c){this.vc[b+c]=a},a)}function ai(a,b){a:{if(0<a.J.length)for(var c=1;c<a.J[0];c+=2)if(a.J[c]==b){b=a.J[c+1];break a}b=null}null!==b&&(a.g&&(c=new Bh(36872,a.Bd,[a.b]),a.write&&a.write(Xh(c))),a.b=b,a.g=!0)}
function bi(a){a.g=!1;a.l=!0;a.o=!1;if(0<a.J.length)for(var b=a.J[0];b<a.J.length;){var c=a.J[b];10==c>>>12&&(a.J[b]&=-513);b+=[1,1,2,1,1,2,2,1,1,1,2,3,1,1,1,1][c>>>12]}a.stack=[];for(b=0;b<a.vc.length;b++)a.vc[b]=0;a.fa&&a.fa();ai(a,65535)}
function ci(a){function b(a){return 32768<=a?a-65536:a}function c(a){switch(a){case 28672:d.stack.push(-d.stack.pop());break;case 28673:d.stack.push(Math.abs(d.stack.pop()));break;case 28674:d.stack.push(~d.stack.pop());break;case 32768:a=d.stack.pop();d.stack.push(b(d.stack.pop()<<a&65535));break;case 32769:a=d.stack.pop();d.stack.push(d.stack.pop()>>a);break;case 32770:d.stack.push(b(d.stack.pop()+d.stack.pop()&65535));break;case 32771:a=d.stack.pop();d.stack.push(b(d.stack.pop()-a&65535));break;
case 32772:d.stack.push(b(d.stack.pop()*d.stack.pop()&65535));break;case 32773:a=d.stack.pop();d.stack.push(b(Math.trunc(d.stack.pop()/a)&65535));break;case 32774:a=d.stack.pop();d.stack.push(b(d.stack.pop()%a&65535));break;case 32775:d.stack.push(b((d.stack.pop()|d.stack.pop())&65535));break;case 32776:d.stack.push(b((d.stack.pop()^d.stack.pop())&65535));break;case 32777:d.stack.push(b(d.stack.pop()&d.stack.pop()&65535));break;case 32778:d.stack.push(d.stack.pop()===d.stack.pop()?1:0);break;case 32779:d.stack.push(d.stack.pop()!==
d.stack.pop()?1:0);break;case 32780:a=d.stack.pop();d.stack.push(d.stack.pop()>a?1:0);break;case 32781:a=d.stack.pop();d.stack.push(d.stack.pop()>=a?1:0);break;case 32782:a=d.stack.pop();d.stack.push(d.stack.pop()<a?1:0);break;case 32783:a=d.stack.pop();d.stack.push(d.stack.pop()<=a?1:0);break;case 32784:a=d.stack.pop();d.stack.push(d.stack.pop()||a?1:0);break;case 32785:a=d.stack.pop();d.stack.push(d.stack.pop()&&a?1:0);break;default:throw"unknown op 0x"+a.toString(16);}}var d=a,e=a.J[a.b],f=e&4095;
switch(e>>>12){case 0:a.g=!1;break;case 1:a.stack.push(2048<=f?f-4096:f);break;case 2:a.b++;a.stack.push(b(a.J[a.b]));break;case 3:a.stack.push(a.vc[f]);break;case 4:$h(a,f,[a.stack.pop()]);break;case 5:a.b++;e=a.J[a.b];var g=a.stack.pop();if(g>=e)throw"out of bounds";a.stack.push(a.vc[f+g]);break;case 6:a.b++;e=a.J[a.b];g=a.stack.pop();if(g>=e)throw"Index out of bounds";$h(a,f+g,[a.stack.pop()]);break;case 9:a.b+=(2048<=f?f-4096:f)-1;break;case 10:var h=e&256;c(32768|e&255);f=0!=a.stack.pop();a.b++;
g=b(a.J[a.b]);if(h){h=a.b-1;if(e&512||!f)a.b+=g-2;a.J[h]=f?a.J[h]|512:a.J[h]&-513}else f||(a.b+=g-2);break;case 11:null(f);break;case 12:if(0>f||f>=a.Lb.length)throw"Native call index out of bounds";var l=a.Lb[f].ca.map(function(){return{p:this.stack.pop()}},a),m=[];a.Lb[f].ca.forEach(function(a,b){l[b].mg=0===a.size?this.stack.pop():a.size},a);a.Lb[f].ca.forEach(function(a){0>a.size&&void 0===m[-a.size]&&(m[-a.size]=0)},a);m=m.map(function(a){return void 0!==a?this.stack.pop():a},a);a.Lb[f].ca.forEach(function(a,
b){0>a.size&&(l[b].mg=m[-a.size])},a);var r=l.map(function(a){return this.vc.slice(a.p,a.p+a.mg)},a);e=!1;a.w&&(e=a.w(a.Lb[f].name,a,r));e||a.Lb[f].za(a,r);l.forEach(function(a,b){$h(this,a.p,r[b])},a);break;case 13:a.stack.push(a.b+1);a.b=f-1;break;case 14:a.b=a.stack.pop()-1;break;case 15:throw"op 0x"+e.toString(16)+" (reserved) not implemented";default:c(e)}a.b++}Zh.prototype.Qb=function(){for(;this.g&&(ci(this),!this.l););};function di(a){function b(a){a&=65535;return 32768<=a?a-65536:a}Zh.call(this,{Bd:a,Sa:[{name:"_id",O:[0]},{name:"event.source",O:[0]},{name:"event.args",O:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{name:"_fwversion",O:[0,0]},{name:"_productId",O:[0]},{name:"buttons._raw",O:[0,0,0,0,0]},{name:"button.backward",O:[0]},{name:"button.left",O:[0]},{name:"button.center",O:[0]},{name:"button.forward",O:[0]},{name:"button.right",O:[0]},{name:"buttons._mean",O:[0,0,0,0,0]},{name:"buttons._noise",
O:[0,0,0,0,0]},{name:"prox.horizontal",O:[0,0,0,0,0,0,0]},{name:"prox.comm.rx._payloads",O:[0,0,0,0,0,0,0]},{name:"prox.comm.rx._intensities",O:[0,0,0,0,0,0,0]},{name:"prox.comm.rx",O:[0]},{name:"prox.comm.tx",O:[0]},{name:"prox.ground.ambiant",O:[0,0]},{name:"prox.ground.reflected",O:[0,0]},{name:"prox.ground.delta",O:[0,0]},{name:"motor.left.target",O:[0]},{name:"motor.right.target",O:[0]},{name:"_vbat",O:[0,0]},{name:"_imot",O:[0,0]},{name:"motor.left.speed",O:[0]},{name:"motor.right.speed",O:[0]},
{name:"motor.left.pwm",O:[0]},{name:"motor.right.pwm",O:[0]},{name:"acc",O:[0,0,0]},{name:"temperature",O:[0]},{name:"rc5.address",O:[0]},{name:"rc5.command",O:[0]},{name:"mic.intensity",O:[0]},{name:"mic.threshold",O:[0]},{name:"mic._mean",O:[0]},{name:"timer.period",O:[0,0]},{name:"acc._tap",O:[0]},{name:"sd.present",O:[0]}],zd:[{name:"button.backward",description:"Backward button state changed"},{name:"button.left",description:"Left button state changed"},{name:"button.center",description:"Center button state changed"},
{name:"button.forward",description:"Forward button state changed"},{name:"button.right",description:"Right button state changed"},{name:"buttons",description:"Buttons values updated"},{name:"prox",description:"Proximity values updated"},{name:"prox.comm",description:"Data received on the proximity communication"},{name:"tap",description:"Tap detected"},{name:"acc",description:"Accelerometer values updated"},{name:"mic",description:"Microphone above threshold"},{name:"sound.finished",description:"Sound playback finished"},
{name:"temperature",description:"Temperature value updated"},{name:"rc5",description:"RC5 message received"},{name:"motor",description:"Motor timer"},{name:"timer0",description:"Timer 0"},{name:"timer1",description:"Timer 1"}],Lb:[{name:"_system_reboot",ca:[],za:function(){}},{name:"_system_settings_read",ca:[],za:function(){}},{name:"_system_settings_write",ca:[],za:function(){}},{name:"_system_settings_flash",ca:[],za:function(){}},{name:"math.copy",ca:[],za:function(a,b){for(a=0;a<b[0].length;a++)b[0][a]=
b[1][a]}},{name:"math.fill",ca:[],za:function(a,b){for(a=0;a<b[0].length;a++)b[0][a]=b[1][0]}},{name:"math.addscalar",ca:[{name:"r",size:-1},{name:"a",size:-1},{name:"b",size:1}],za:function(a,d){for(a=0;a<d[0].length;a++)d[0][a]=b(d[1][a]+d[2][0])}},{name:"math.add",ca:[{name:"r",size:-1},{name:"a",size:-1},{name:"b",size:-1}],za:function(a,d){for(a=0;a<d[0].length;a++)d[0][a]=b(d[1][a]+d[2][a])}},{name:"math.sub",ca:[{name:"r",size:-1},{name:"a",size:-1},{name:"b",size:-1}],za:function(a,d){for(a=
0;a<d[0].length;a++)d[0][a]=b(d[1][a]-d[2][a])}},{name:"math.mul",ca:[{name:"r",size:-1},{name:"a",size:-1},{name:"b",size:-1}],za:function(a,d){for(a=0;a<d[0].length;a++)d[0][a]=b(d[1][a]*d[2][a])}},{name:"math.div",ca:[{name:"r",size:-1},{name:"a",size:-1},{name:"b",size:-1}],za:function(a,d){for(a=0;a<d[0].length;a++)d[0][a]=b(Math.trunc(d[1][a]/d[2][a]))}},{name:"math.min",ca:[{name:"r",size:-1},{name:"a",size:-1},{name:"b",size:-1}],za:function(a,b){for(a=0;a<b[0].length;a++)b[0][a]=Math.min(b[1][a],
b[2][a])}},{name:"math.max",ca:[{name:"r",size:-1},{name:"a",size:-1},{name:"b",size:-1}],za:function(a,b){for(a=0;a<b[0].length;a++)b[0][a]=Math.max(b[1][a],b[2][a])}},{name:"math.clamp",ca:[{name:"r",size:-1},{name:"x",size:-1},{name:"low",size:-1},{name:"high",size:-1}],za:function(a,b){for(a=0;a<b[0].length;a++)b[0][a]=Math.min(Math.max(b[1][a],b[2][a]),b[3][a])}},{name:"math.dot",ca:[{name:"r",size:-1},{name:"a",size:-1},{name:"b",size:-1},{name:"shift",size:1}],za:function(a,b){for(var c=a=
0;c<b[0].length;c++)a+=b[1][c]*b[2][c];b[0][0]=a/Math.pow(2,b[3][0])}},{name:"math.stat",ca:[{name:"x",size:-1},{name:"min",size:1},{name:"max",size:1},{name:"mean",size:1}],za:function(a,b){a=0;b[1][0]=32767;b[2][0]=-32768;for(var c=0;c<b[0].length;c++)b[1][0]=Math.min(b[1][0],b[0][c]),b[2][0]=Math.max(b[2][0],b[0][c]),a+=b[0][c];b[3][0]=a/b[0].length}},{name:"math.argbounds",ca:[{name:"x",size:-1},{name:"argmin",size:1},{name:"argmax",size:1}],za:function(a,b){a=-Infinity;for(var c=Infinity,d=0;d<
b[0].length;d++)b[0][d]<c&&(c=b[0][d],b[1][0]=d),b[0][d]>a&&(a=b[0][d],b[2][0]=d)}},{name:"math.sort",ca:[{name:"x",size:-1}],za:function(a,b){b[0].sort(function(a,b){return a-b})}},{name:"math.muldiv",ca:[{name:"r",size:-1},{name:"a",size:-1},{name:"b",size:-1},{name:"c",size:-1}],za:function(a,d){for(a=0;a<d[0].length;a++)d[0][a]=b(d[1][a]*d[2][a]/d[3][a])}},{name:"math.atan2",description:"Atan2",ca:[{name:"r",size:-1},{name:"y",size:-1},{name:"x",size:-1}],za:function(a,b){b[2].forEach(function(a,
c){b[0][c]=Math.round(32767*Math.atan2(b[1][c],a)/Math.PI)})}},{name:"math.sin",description:"Sine",ca:[{name:"r",size:-1},{name:"theta",size:-1}],za:function(a,b){b[1].forEach(function(a,c){b[0][c]=Math.round(32767*Math.sin(a*Math.PI/32768))})}},{name:"math.cos",description:"Cosine",ca:[{name:"r",size:-1},{name:"theta",size:-1}],za:function(a,b){b[1].forEach(function(a,c){b[0][c]=Math.round(32767*Math.cos(a*Math.PI/32768))})}},{name:"math.rot2",ca:[{name:"r",size:2},{name:"v",size:2},{name:"theta",
size:1}]},{name:"math.sqrt",description:"Square root",ca:[{name:"r",size:-1},{name:"x",size:-1}],za:function(a,b){b[1].forEach(function(a,c){b[0][c]=0<a?Math.floor(Math.sqrt(a)):0})}},{name:"math.rand",description:"Pseudo-random number",ca:[{name:"r",size:-1}],za:function(a,b){for(a=0;a<b[0].length;a++)b[0][a]=Math.floor(65535.9999*Math.random())-32768}},{name:"_leds.set",ca:[{name:"led",size:1},{name:"br",size:1}],za:function(){}},{name:"sound.record",ca:[{name:"n",size:1}],za:function(){}},{name:"sound.play",
ca:[{name:"n",size:1}],za:function(){}},{name:"sound.replay",ca:[{name:"n",size:1}],za:function(){}},{name:"sound.system",description:"Start playing system sound",ca:[{name:"n",size:1}],za:function(){}},{name:"leds.circle",description:"Set circular leds",ca:[{name:"l0",size:1},{name:"l1",size:1},{name:"l2",size:1},{name:"l3",size:1},{name:"l4",size:1},{name:"l5",size:1},{name:"l6",size:1},{name:"l7",size:1}],za:function(a,b){a.state["leds.circle"]=b.map(function(a){return a[0]});a.Tc&&a.Tc("leds.circle")}},
{name:"leds.top",description:"Set top RGB led",ca:[{name:"r",size:1},{name:"g",size:1},{name:"b",size:1}],za:function(a,b){a.state["leds.top"]=b.map(function(a){return a[0]});a.Tc&&a.Tc("leds.top")}},{name:"leds.bottom.left",description:"Set bottom-left RGB led",ca:[{name:"r",size:1},{name:"g",size:1},{name:"b",size:1}],za:function(a,b){a.state["leds.bottom.left"]=b.map(function(a){return a[0]});a.Tc&&a.Tc("leds.bottom.left")}},{name:"leds.bottom.right",description:"Set bottom-right RGB led",ca:[{name:"r",
size:1},{name:"g",size:1},{name:"b",size:1}],za:function(a,b){a.state["leds.bottom.right"]=b.map(function(a){return a[0]});a.Tc&&a.Tc("leds.bottom.right")}},{name:"sound.freq",description:"Play frequency",ca:[{name:"Hz",size:1},{name:"ds",size:1}],za:function(a,b){console.info(b)}},{name:"leds.buttons",description:"Set buttons leds",ca:[{name:"led 0",size:1},{name:"led 1",size:1},{name:"led 2",size:1},{name:"led 3",size:1}]},{name:"leds.prox.h",description:"Set horizontal proximity leds",ca:[{name:"led 0",
size:1},{name:"led 1",size:1},{name:"led 2",size:1},{name:"led 3",size:1},{name:"led 4",size:1},{name:"led 5",size:1},{name:"led 6",size:1},{name:"led 7",size:1}]},{name:"leds.prox.v",description:"Set vertical proximity leds",ca:[{name:"led 0",size:1},{name:"led 1",size:1}]},{name:"leds.rc",description:"Set rc led",ca:[{name:"led",size:1}]},{name:"leds.sound",description:"Set sound led",ca:[{name:"led",size:1}]},{name:"leds.temperature",description:"Set ntc led",ca:[{name:"red",size:1},{name:"blue",
size:1}]},{name:"sound.wave",description:"Set the primary wave of the tone generator",ca:[{name:"wave",size:142}],za:function(){}},{name:"prox.comm.enable",description:"Enable or disable the proximity communication",ca:[{name:"state",size:1}]},{name:"sd.open",description:"Open a file on the SD card",ca:[{name:"number",size:1},{name:"status",size:1}]},{name:"sd.write",description:"Write data to the opened file",ca:[{name:"data",size:-1},{name:"written",size:1}]},{name:"sd.read",description:"Read data from the opened file",
ca:[{name:"data",size:-1},{name:"read",size:1}]},{name:"sd.seek",description:"Seek the opened file",ca:[{name:"position",size:1},{name:"status",size:1}]},{name:"_rf.nodeid"},{name:"_poweroff"}],rd:620});this.state={};this.Tc=null}di.prototype=Object.create(Zh.prototype);di.prototype.constructor=di;function ei(){K.call(this);this.Nb=!0;this.l=new di(9999);var a=this;this.l.Tc=function(b){a.fa[b]&&a.fa[b](b,a.l.state[b])};this.l.L=function(b,c,d){switch(b){case "timer.period":a.setTimer(c,.001*d,!0)}};this.l.w=function(b,c,d){switch(b){case "sound.play":return a.fa.sound("sound",{pcm:d[0][0]}),!0}return!1};this.ya=new Bf(Cf)}ei.prototype=Object.create(K.prototype);ei.prototype.constructor=ei;ei.prototype.reset=function(a){K.prototype.reset.call(this,a);bi(this.l)};
function fi(a,b){b=Rf(a.ya,b);return null==b?null:a.l.vc.slice(b.offset,b.offset+b.size)}function gi(a,b,c){var d=Rf(a.ya,b);if(null==d)throw"Unknown VM variable "+b;if(c.length!==d.size)throw"Bad size for variable "+b;Array.prototype.splice.apply(a.l.vc,[d.offset,d.size].concat(c))}
ei.prototype.set=function(a,b){if(this.Nb){K.prototype.set.call(this,a,b);switch(a){case "button.backward":case "button.left":case "button.center":case "button.forward":case "button.right":gi(this,a,[b?1:0]);break;case "prox.ground.delta":gi(this,"prox.ground.delta",b.map(function(a){return 2E3*a}));break;case "prox.horizontal":gi(this,"prox.horizontal",b.map(function(a){return 2E3*a}));break;case "acc":gi(this,"acc",b.map(function(a){return 22*a}));break;default:throw"Unknown variable "+a;}this.fa[a]&&
this.fa[a](a,b)}else K.prototype.set.call(this,a,b)};
ei.prototype.get=function(a){if(this.Nb)switch(a){case "leds.top":return(this.l.state&&this.l.state["leds.top"]||[0,0,0]).map(function(a){return 32<=a?1:0>=a?0:a/32});case "leds.bottom.left":return(this.l.state&&this.l.state["leds.bottom.left"]||[0,0,0]).map(function(a){return 32<=a?1:0>=a?0:a/32});case "leds.bottom.right":return(this.l.state&&this.l.state["leds.bottom.right"]||[0,0,0]).map(function(a){return 32<=a?1:0>=a?0:a/32});case "leds.circle":return(this.l.state&&this.l.state["leds.circle"]||
[0,0,0,0,0,0,0,0]).map(function(a){return 16<=a?1:0});case "motor.left":return fi(this,"motor.left.target")[0]/200;case "motor.right":return fi(this,"motor.right.target")[0]/200;default:return K.prototype.get.call(this,a)}else return K.prototype.get.call(this,a)};ei.prototype.sendEvent=function(a,b){if(this.Nb){if(null!=b)throw"Event arguments not implemented";a=Sf(this.ya,a);ai(this.l,a);hi(this)}else K.prototype.sendEvent.call(this,a,b)};
ei.prototype.loadCode=function(a,b){"js"===a?(K.prototype.loadCode.call(this,a,b),this.Nb=!1):(b=(a=xh(b))?new Ff(this.ya,b):new Df(this.ya,b),b.Qa=a?Gf:Ef,b=Hf(b),a=this.l,a.J.splice.apply(a.J,[0,b.length].concat(b)),bi(this.l),hi(this),this.Nb=!0)};function hi(a){for(var b=0;2E3>b&&a.l.g;b++)ci(a.l)};function zf(a,b){a.g=new Ab(a.Qa,{Y:a.Y});a.g.Qa=function(){a.w=null;ii(a)};var c=null;return new jf({Qb:function(b,e){var d=a.K;d.T.loadCode(b,e);null!==c&&clearInterval(c);d.T.start(ji());c=setInterval(function(){d.T.run(ji(),function(a,b){ki(d,a,b)})},10);d.T.hc=d.paused;ii(a)},Ac:function(){var c=new ei;c=new li(a.g,c);b&&b.Of&&Ed(a.g,b.Of);b&&b.Pf&&(a.g.transform=b.Pf);a.K=c},md:"js",languages:["js","aseba","l2"]})};function mi(){this.b=[]}mi.prototype.add=function(a){this.b.push(a)};mi.prototype.G=function(a){this.b.forEach(function(b){b.G(a)})};function ni(){}ni.prototype.b=function(){throw"internal";};ni.prototype.G=function(){};function oi(a,b,c){this.x=a;this.y=b;this.g=c}oi.prototype=Object.create(ni.prototype);oi.prototype.constructor=oi;
oi.prototype.b=function(a,b,c){for(var d=Infinity,e=this.x.length,f=0;f<(this.g?this.x.length:this.x.length-1);f++){var g=this.x[(f+1)%e],h=this.y[(f+1)%e],l=[Math.cos(c),g-this.x[f],Math.sin(c),h-this.y[f]];g=[g-a,h-b];h=l[0]*l[3]-l[1]*l[2];l=[(l[3]*g[0]-l[1]*g[1])/h,(l[0]*g[1]-l[2]*g[0])/h];d=Math.min(d,0<=l[1]&&1>=l[1]&&0<l[0]?l[0]:Infinity)}return d};
oi.prototype.G=function(a){a.save();a.beginPath();a.moveTo(this.x[0],this.y[0]);for(var b=1;b<this.x.length;b++)a.lineTo(this.x[b],this.y[b]);this.g&&a.closePath();a.stroke();a.restore()};function pi(a,b,c){this.x=a;this.y=b;this.r=c}pi.prototype=Object.create(ni.prototype);pi.prototype.constructor=pi;
pi.prototype.b=function(a,b,c){var d=(this.x-a)*Math.cos(c)+(this.y-b)*Math.sin(c);a=(a-this.x)*Math.sin(c)+(this.y-b)*Math.cos(c);a=this.r*this.r-a*a;if(0>a)return Infinity;a=Math.sqrt(a);return 0>d+a?Infinity:0>d-a?d+a:d-a};pi.prototype.G=function(a){a.save();a.beginPath();a.arc(this.x,this.y,this.r,0,2*Math.PI);a.stroke();a.restore()};function qi(a,b){this.width=a;this.height=b}
function li(a,b){var c=this;this.wa=new Da;this.T=b;this.L=this.Pe=this.paused=this.$d=!1;this.ac=ri;this.b=new qi(10*this.T.wb,7.07*this.T.wb);b=this.T.wb;this.T.setPositionLimits(-this.b.width/2+b,this.b.width/2-b,-this.b.height/2+b,this.b.height/2-b);this.$e=this.cc=null;this.g=document.createElement("canvas");this.jf=!1;this.af=this.Jb=null;this.l=document.createElement("canvas");this.w=new mi;this.lf=!1;this.bf=this.P=null;si(this);this.T.jb=function(){ti(c);ui(c);vi(c)};this.o=a;this.o.state=
{};this.fa=!1}var ri="ground";li.prototype.Zd=function(){this.wa.b=[]};function Jf(a){var b="teacher"===$a("role");a.Hb=b}function wi(a){var b=a.K;if(b.cc){b.g.width=b.cc.width;b.g.height=b.cc.height;var c=b.g.getContext("2d");c.fillStyle="white";c.fillRect(0,0,b.cc.width,b.cc.height);c.drawImage(b.cc,0,0,b.cc.width,b.cc.height)}else b.g.width=b.o?b.o.width:800,b.g.height=b.g.width*b.b.height/b.b.width,c=b.g.getContext("2d"),c.fillStyle="white",c.fillRect(0,0,b.g.width,b.g.height);b.jf=!1;Kb(a)}
function ki(a,b,c){if(a.Pe){var d=a.g.getContext("2d");d.save();d.translate(a.g.width/2,a.g.height/2);d.scale(a.g.width/a.b.width,-a.g.height/a.b.height);d.beginPath();switch(b){case "l":d.moveTo(c[0],c[1]);d.lineTo(c[2],c[3]);break;case "a":d.arc(c[0],c[1],Math.abs(c[2]),c[3],c[4],0>c[2])}d.strokeStyle="#060";d.lineCap="round";d.lineWidth=.1*a.T.wb;d.stroke();d.restore();a.jf=!0}}
function si(a){a.w.b=[];a.w.add(new oi([-a.b.width/2,a.b.width/2,a.b.width/2,-a.b.width/2],[-a.b.height/2,-a.b.height/2,a.b.height/2,a.b.height/2],!0))}
function xi(a,b){var c=a.K;si(c);if(c.P=b){var d=new je(b),e=c.b.width/d.Aa[2],f=-c.b.width*(.5+d.Aa[0]/d.Aa[2]),g=-c.b.height/d.Aa[3],h=c.b.height*(.5+d.Aa[1]/d.Aa[3]);d.G(null,{ua:{line:function(a,b,d){c.w.add(new oi(a.map(function(a){return f+e*a}),b.map(function(a){return h+g*a}),d))},Ae:function(a,b,d){c.w.add(new pi(f+e*a,h+g*b,(e-g)/2*d))}}})}c.lf=null!=b;ui(c);Kb(a)}
function yi(a,b,c){b=Math.round(a.g.width*(b+a.b.width/2)/a.b.width);c=Math.round(a.g.height*(a.b.height/2-c)/a.b.height);return a.g.getContext("2d").getImageData(b,c,1,1).data[0]/255}function zi(a,b,c){if(null==a.Jb)return 0;b=Math.round(a.l.width*(b+a.b.width/2)/a.b.width);c=Math.round(a.l.height*(a.b.height/2-c)/a.b.height);a=a.l.getContext("2d").getImageData(b,c,1,1).data;return-(a[0]+a[1]+a[2])/765}
function ti(a){for(var b=[],c=0;2>c;c++)b.push(yi(a,a.T.b[0]+a.T.Jc*Math.cos(a.T.g)+(0===c?-1:1)*a.T.Ld*Math.sin(a.T.g),a.T.b[1]+a.T.Jc*Math.sin(a.T.g)-(0===c?-1:1)*a.T.Ld*Math.cos(a.T.g))+Lf(a.T,.05));a.T.set("prox.ground.delta",b)}
function ui(a){var b=Math.cos(a.T.g),c=Math.sin(a.T.g),d=[{ld:70,kd:60,Xa:.7},{ld:85,kd:30,Xa:.35},{ld:95,kd:0,Xa:0},{ld:85,kd:-30,Xa:-.35},{ld:70,kd:-60,Xa:-.7},{ld:-25,kd:35,Xa:2.8},{ld:-25,kd:-35,Xa:-2.8}].map(function(a){var d=this.w,e=this.T.b[0]+a.ld*b-a.kd*c,h=this.T.b[1]+a.ld*c+a.kd*b;a=this.T.g+a.Xa;for(var l=Infinity,m=0;m<d.b.length;m++)l=Math.min(l,d.b[m].b(e,h,a));d=l+Lf(this.T,.01*this.T.r);return 100>d?1:300<d?0:(d-300)*(d-300)/4E4},a);a.T.set("prox.horizontal",d)}
function vi(a){for(var b=[0,0,a.T.r],c=[-a.T.r,a.T.r,0],d=[],e=0;3>e;e++)d.push(zi(a,a.T.b[0]+b[e]*Math.cos(a.T.g)+c[e]*Math.sin(a.T.g),a.T.b[1]+b[e]*Math.sin(a.T.g)-c[e]*Math.cos(a.T.g)));b=200*(d[1]-d[0])/(2*a.T.r);d=200*(d[2]-(d[0]+d[1])/2)/a.T.Jc;a.T.set("acc",[b+Lf(a.T,.02),d+Lf(a.T,.02),Math.sqrt(1-b*b-d*d)+Lf(a.T,.02)])}
function of(a,b){switch(a.K.ac){case ri:a.K.$e=null==b?a.K.cc:null;a.K.cc=b;wi(a);ti(a.K);Kb(a);break;case "height":a.K.af=null==b?a.K.Jb:null;var c=a.K;c.Jb=b;c.Jb?(c.l.width=c.Jb.width,c.l.height=c.Jb.height,b=c.l.getContext("2d"),b.fillStyle="white",b.fillRect(0,0,c.Jb.width,c.Jb.height),b.drawImage(c.Jb,0,0,c.Jb.width,c.Jb.height)):(c.l.width=1,c.l.height=1);vi(c);Kb(a)}}function nf(a,b){switch(a.K.ac){case "obstacle":a.K.bf=null==b?a.K.P:null,xi(a,b)}}
xb.prototype.start=function(a){this.K.paused=a;this.K.$d=!a;Kb(this)};function Ai(a){a=[a[0],Math.max(.2+.8*a[1],a[2]/2),a[2]];var b=Math.max(a[0],Math.max(a[1],a[2]));return"rgb("+a.map(function(a){return Math.round(225*(1-b)+(30+225*b)*a)}).join(",")+")"}function Bi(a){return function(b){a.w!==b&&(a.w=b,ii(a))}}
function Kb(a){function b(a){return function(){c.w!==a&&(c.w=a,ii(c))}}var c=a,d=a.K,e=d.T,f=a.g;if(f.P){d.fa||(d.fa=!0,d.resize(a),wi(a));f.Ua=[];var g=d.yf||"sim:close !stretch sim:restart sim:pause !space sim:speedup sim:noise !stretch sim:pen sim:clear !space sim:map-kind sim:map !stretch sim:vpl sim:text !stretch sim:teacher-reset sim:teacher".split(" "),h=rc(a,g,["sim","top"]),l=sc(h),m=Qc(f);Pc(f);var r=H(f.Y,{tag:"view",aa:["sim"]}),k=H(f.Y,{tag:"button",aa:["sim","event"]}),q=H(f.Y,{tag:"sim-controller"}),
n=H(f.Y,{tag:"separator",id:"sim-controller-separator"}),p=H(f.Y,{tag:"separator",aa:["sim","top"]}),u=H(f.Y,{tag:"toolbar",aa:["sim","top"]}),y=H(f.Y,{tag:"sim-playground-area"}),I=H(f.Y,{tag:"sim-playground"});r.gc(m.width);r.Tb(m.height);r.setPosition(0,0);var t=Math.max(k.width,k.height);q.width=3*F(k);q.Tb(r.height);q.setPosition(r.x+r.width-F(q),r.y);u.gc(r.width-F(q));u.height=l;u.setPosition(r.x,r.y);y.gc(r.width-F(q));y.Tb(r.height-u.ma());y.setPosition(r.x,r.y+u.ma());G(f,function(a){r.G(a)});
l=new bc(f);pc(l,a,g,["sim","top"],d.jc||hc,d.te||mc);dc(l,u,h,p);ec(l,u,h,Bi(a));G(f,function(a){q.G(a)});g=[];h=q.y+k.offsetTop();g.push(gc(f,q.x+F(k)+k.offsetLeft(),h,k,function(a,b,c){(d.jc||hc)("sim-event:forward",a,f.v,f.Y,["sim","event"],null,!0,!1,c)},function(){e.set("button.forward",!0);e.sendEvent("buttons",null);e.set("button.forward",!1);e.sendEvent("buttons",null)},null,null,b("sim:btn-button.forward"),"button.forward"));h+=k.ma();g.push(gc(f,q.x+k.offsetLeft(),h,k,function(a,b,c){(d.jc||
hc)("sim-event:left",a,f.v,f.Y,["sim","event"],null,!0,!1,c)},function(){e.set("button.left",!0);e.sendEvent("buttons",null);e.set("button.left",!1);e.sendEvent("buttons",null)},null,null,b("sim:btn-button.left"),"button.left"));g.push(gc(f,q.x+F(k)+k.offsetLeft(),h,k,function(a,b,c){(d.jc||hc)("sim-event:center",a,f.v,f.Y,["sim","event"],null,!0,!1,c)},function(){e.set("button.center",!0);e.sendEvent("buttons",null);e.set("button.center",!1);e.sendEvent("buttons",null)},null,null,b("sim:btn-button.center"),
"button.center"));g.push(gc(f,q.x+2*F(k)+k.offsetLeft(),h,k,function(a,b,c){(d.jc||hc)("sim-event:right",a,f.v,f.Y,["sim","event"],null,!0,!1,c)},function(){e.set("button.right",!0);e.sendEvent("buttons",null);e.set("button.right",!1);e.sendEvent("buttons",null)},null,null,b("sim:btn-button.right"),"button.right"));h+=k.ma();g.push(gc(f,q.x+F(k)+k.offsetLeft(),h,k,function(a,b,c){(d.jc||hc)("sim-event:backward",a,f.v,f.Y,["sim","event"],null,!0,!1,c)},function(){e.set("button.backward",!0);e.sendEvent("buttons",
null);e.set("button.backward",!1);e.sendEvent("buttons",null)},null,null,b("sim:btn-button.backward"),"button.backward"));h+=k.ma()+n.ma();g.push(gc(f,q.x+.5*F(k)+k.offsetLeft(),h,k,function(a,b,c){(d.jc||hc)("sim-event:tap",a,f.v,f.Y,["sim","event"],null,!0,!1,c)},function(){e.sendEvent("tap",null)},null,null,b("sim:btn-tap"),"tap"));g.push(gc(f,q.x+1.5*F(k)+k.offsetLeft(),h,k,function(a,b,c){(d.jc||hc)("sim-event:clap",a,f.v,f.Y,["sim","event"],null,!0,!1,c)},function(){e.sendEvent("mic",null)},
null,null,b("sim:btn-clap"),"clap"));h+=2*t;var w=q.x+1.5*F(k),A=h+3.5*t;g.push(G(f,function(a){function b(b,c,d,e,f,g){a.save();a.translate(b,c);a.beginPath();a.arc(0,0,d,0,2*Math.PI);a.arc(0,0,d/2,2*Math.PI,0,!0);a.fillStyle=f||"#bbb";a.fill();a.beginPath();a.arc(0,0,d,(-.5+2*e)*Math.PI,-.5*Math.PI,!0);a.arc(0,0,d/2,-.5*Math.PI,(-.5+2*e)*Math.PI,!1);a.fillStyle=g||"#222";a.fill();a.restore()}a.save();a.beginPath();a.moveTo(w-1.2*t,A);a.lineTo(w-1.2*t,A-1.8*t);a.bezierCurveTo(w-.72*t,A-2.4*t,w-.05*
t,A-2.4*t,w,A-2.4*t);a.bezierCurveTo(w+.05*t,A-2.4*t,w+.72*t,A-2.4*t,w+1.2*t,A-1.8*t);a.lineTo(w+1.2*t,A);a.closePath();a.lineWidth=2;a.strokeStyle="black";a.stroke();var c=e.get("prox.ground.delta");b(w-.45*t,A-1.8*t,.4*t,c[0],"#afa","#060");b(w+.45*t,A-1.8*t,.4*t,c[1],"#9f9","#060");c=e.get("prox.horizontal");b(w-1.45*t,A-2.3*t,.4*t,c[0],"#fcc","#d00");b(w-.8*t,A-2.8*t,.4*t,c[1],"#fcc","#d00");b(w,A-3*t,.4*t,c[2],"#fcc","#d00");b(w+.8*t,A-2.8*t,.4*t,c[3],"#fcc","#d00");b(w+1.45*t,A-2.3*t,.4*t,c[4],
"#fcc","#d00");b(w-.8*t,A+.5*t,.4*t,c[5],"#fcc","#d00");b(w+.8*t,A+.5*t,.4*t,c[6],"#fcc","#d00");a.restore()}));var sa=h+=5*t;g.push(G(f,function(a){a.save();a.fillStyle="black";a.fillRect(w-1.15*t,sa+.5*t,.3*t,.6*t);a.fillRect(w+.85*t,sa+.5*t,.3*t,.6*t);a.fillStyle=Ai(e.get("leds.top"));a.fillRect(w-1.2*t,sa,2.4*t,.5*t);a.fillStyle=Ai(e.get("leds.bottom.left"));a.fillRect(w-1.2*t,sa+.5*t,1.2*t,.5*t);a.fillStyle=Ai(e.get("leds.bottom.right"));a.fillRect(w,sa+.5*t,1.2*t,.5*t);a.lineWidth=1;a.beginPath();
a.moveTo(w-1.2*t,sa+.5*t);a.lineTo(w+1.2*t,sa+.5*t);a.moveTo(w,sa+.5*t);a.lineTo(w,sa+t);a.strokeStyle="white";a.stroke();a.lineJoin="round";a.strokeStyle="black";a.strokeRect(w-1.2*t,sa,2.4*t,t);a.restore()}));h+=1.5*t;if(null!=d.Jb){var mb=h+1.5*t;g.push(G(f,function(a){var b=e.get("acc");b=[Math.atan2(b[0],b[1]),Math.atan2(b[1],b[2]),Math.atan2(b[0],b[2])];a.save();a.strokeStyle="black";a.lineWidth=.7*f.v.ia;for(var c=0;3>c;c++){a.save();a.translate(w+(c-1)*t,mb);a.save();a.strokeStyle="silver";
a.beginPath();a.moveTo(-.4*t,0);a.lineTo(.4*t,0);a.moveTo(0,-.4*t);a.lineTo(0,.4*t);a.stroke();a.restore();a.rotate(-b[c]);switch(c){case 0:var d=.25*t;a.translate(0,1.2*d);a.beginPath();a.moveTo(-1.2*d,0);a.lineTo(-1.2*d,-1.8*d);a.bezierCurveTo(-.72*d,-2.4*d,-.05*d,-2.4*d,0,-2.4*d);a.bezierCurveTo(.05*d,-2.4*d,.72*d,-2.4*d,1.2*d,-1.8*d);a.lineTo(1.2*d,0);a.closePath();a.lineWidth=2;a.strokeStyle="black";a.stroke();break;case 1:a.strokeRect(-.4*t,-.15*t,.8*t,.3*t);a.beginPath();a.arc(-.2*t,.05*t,
.15*t,0,2*Math.PI);a.fillStyle="white";a.fill();a.lineWidth=.07*t;a.stroke();break;case 2:a.strokeRect(-.4*t,-.15*t,.8*t,.3*t),a.fillStyle="black",a.fillRect(-.35*t,.15*t,.15*t,.08*t),a.fillRect(.2*t,.15*t,.15*t,.08*t)}a.restore()}a.restore()}));h+=2.5*t}if(e.Kc){var Ea=h+2*t;g.push(G(f,function(a){for(var b=e.get("leds.circle"),c=0;8>c;c++)Wd(a,w,Ea,.9*t,1.2*t,Math.PI*(.44-.25*c),Math.PI*(.56-.25*c),b[c]?"#fa0":"white","black",f.v.ia)}));h+=3.5*t}var Za=h+1.5*t,Aa=e.getTimer(0);0<=Aa?(g.push(G(f,
function(a){f.state.be?"lin"===f.state.be&&4<Aa&&(f.state.be="log"):f.state.be=4<Aa?"log":"lin";Ud(a,w,Za,t,f.v.ia,function(b){a.textAlign="start";a.textBaseline="top";a.font=(t/2).toFixed(1)+"px sans-serif";a.fillStyle="black";a.fillText(b.toFixed(1),q.x,Za-t)},Math.min(Aa,"log"===f.state.be?9.9:3.95),!1,"log"===f.state.be)})),h+=2.5*t):f.state.be=!1;var ja=Math.min((y.y-q.y+q.y+q.height-h)/2,q.y+q.height-h);0<ja&&g.forEach(function(a){a.y+=ja});var M=y.x,P=y.y,qa=y.width,Cb=y.height;var C=Math.min(qa/
d.b.width,Cb/d.b.height);k=(qa-d.b.width*C)/2;n=(Cb-d.b.height*C)/2;I.width=d.b.width*C;I.height=d.b.height*C;I.x=M+k;I.y=P+n;if(a.wa.Ra){var Rb=H(f.Y,{tag:"widget",id:"vpl-customize"});G(f,function(){Kc(f,"vpl:customize",M+qa/2,P+Cb/2,Rb)})}else{var D=e.wb,W=!1;k=new yc(null,d.b.width*C,d.b.height*C,M+k,P+n,function(a,b,c,g){a=a.I;a.save();y.G(a);I.G(a);switch(d.ac){case ri:a.drawImage(d.g,b.x+c,b.y+g,b.width,b.height);break;case "height":null!=d.Jb&&a.drawImage(d.l,b.x+c,b.y+g,b.width,b.height);
break;case "obstacle":a.save(),a.translate(b.x+c+b.width/2,b.y+g+b.height/2),a.scale(C,-C),d.w.G(a),a.restore()}a.translate(b.x+c+b.width/2,b.y+g+b.height/2);a.scale(C,C);a.translate(e.b[0],-e.b[1]);a.rotate(.5*Math.PI-e.g);a.beginPath();a.moveTo(0,.2*D);a.lineTo(.5*D,.2*D);a.lineTo(.5*D,-.55*D);a.bezierCurveTo(.3*D,-.8*D,.02*D,-.8*D,0,-.8*D);a.bezierCurveTo(-.02*D,-.8*D,-.3*D,-.8*D,-.5*D,-.55*D);a.lineTo(-.5*D,.2*D);a.closePath();a.fillStyle=Ai(e.get("leds.top"));a.strokeStyle="black";a.lineJoin=
"round";a.lineWidth=2;a.moveTo(.05*D,0);a.arc(0,0,.05*D,0,2*Math.PI);a.fill();a.stroke();if(!d.$d||d.paused)a.beginPath(),a.arc(0,0,D,0,2*Math.PI),a.strokeStyle=f.state.Zf?"navy":"#3cf",a.lineWidth=.1*D,a.stroke(),a.beginPath(),a.arc(0,-D,.15*D,0,2*Math.PI),a.fillStyle=f.state.rf?"navy":"white",a.strokeStyle=f.state.rf?"navy":"#3cf",a.lineWidth=.06*D,a.fill(),a.stroke();a.restore()},{Z:function(a,b,c,g,h,k,l){a=(l.x-h-c/2)/C;g=(g/2-(l.y-k))/C;k=a-e.b[0];l=g-e.b[1];b=D*Math.cos(e.g);c=D*Math.sin(e.g);
return(!d.$d||d.paused)&&(k-b)*(k-b)+(l-c)*(l-c)<.1*D*D?(f.state.x=a,f.state.y=g,f.state.rf=!0,1):k*k+l*l<D*D?(d.paused?W=!1:(e.suspend(),W=!0),f.state.x=a,f.state.y=g,f.state.Zf=!0,0):null},Oa:function(a,b,c,g,h,k,l,m){a=(m.x-k-g/2)/C;h=(h/2-(m.y-l))/C;switch(c){case 0:c=e.b;e.setPosition([e.b[0]+a-f.state.x,e.b[1]+h-f.state.y],e.g);ki(d,"l",[c[0],c[1],e.b[0],e.b[1]]);break;case 1:e.setPosition(e.b,e.g+(Math.atan2(h-e.b[1],a-e.b[0])-Math.atan2(f.state.y-e.b[1],f.state.x-e.b[0])))}f.state.x=a;f.state.y=
h},Le:function(){f.state.Zf=!1;f.state.rf=!1;W&&e.resume(ji())}});k.l=!1;Bc(f,k)}a.w&&G(f,function(a){var b=H(f.Y,{tag:"hint"});a.fillStyle=b.color;a.font=ic(b);a.textAlign="start";a.textBaseline="middle";var d=c.o.translate(c.w);b.width=a.measureText(d).width;b.height=1.2*b.fontSize;fc(b,a,b.marginLeft,m.height-b.ma()+b.marginTop,!0);a.fillText(d,b.offsetLeft(),m.height-b.ma()+b.offsetTop()+b.height/2)});E(f);!d.paused&&e.shouldRunContinuously()&&ii(a)}}
function ii(a){a.K.L||(a.K.L=!0,window.requestAnimationFrame(function(){a.K.L=!1;Kb(a)}))}function ji(){return.001*(new Date).getTime()}li.prototype.resize=function(a){var b=window.innerWidth,c=window.innerHeight;window.vplDisableResize&&(c=this.o.b.getBoundingClientRect(),b=c.width,c=c.height);this.o.v=this.o.v;this.o.resize(b,c);Kb(a)};function Af(a){a.b.add("sim:close",{action:function(a){a.Za(["sim"],{Ce:!0})},object:a,W:function(a){return 1<a.xa.length&&0<=a.xa.indexOf("sim")}});a.b.add("sim:restart",{action:function(a){wi(a);a.K.T.reset(ji());a.K.T.start();a.K.$d=!0;a.K.paused=!1;Kb(a)},object:a});a.b.add("sim:pause",{action:function(a){a.K.$d&&(a.K.paused=!a.K.paused,a.K.paused?a.K.T.suspend():(a.K.T.resume(ji()),Kb(a)))},isEnabled:function(a){return a.K.$d},Ya:function(a){return a.K.paused},object:a});a.b.add("sim:speedup",
{action:function(a){var b=[.5,1,2,5,10];a.K.T.od=b[(b.indexOf(a.K.T.od)+1)%b.length]},Ya:function(a){return 1!==a.K.T.od},getState:function(a){return a.K.T.od},object:a});a.b.add("sim:noise",{action:function(a){a.K.T.Je=!a.K.T.Je},Ya:function(a){return a.K.T.Je},object:a});a.b.add("sim:pen",{action:function(a){a.K.Pe=!a.K.Pe},Ya:function(a){return a.K.Pe},object:a});a.b.add("sim:clear",{action:function(a){wi(a)},isEnabled:function(a){return a.K.jf},object:a});a.b.add("sim:map-kind",{action:function(a){switch(a.K.ac){case ri:a.K.ac=
"height";break;case "height":a.K.ac="obstacle";break;case "obstacle":a.K.ac=ri}},getState:function(a){switch(a.K.ac){case ri:return"ground";case "height":return"height";case "obstacle":return"obstacles";default:return"ground"}},object:a});a.b.add("sim:map",{action:function(a){switch(a.K.ac){case ri:of(a,null==a.K.cc?a.K.$e:null);break;case "height":of(a,null==a.K.Jb?a.K.af:null);break;case "obstacle":nf(a,a.K.lf?null:a.K.bf)}},Ya:function(a){switch(a.K.ac){case ri:return null!=a.K.cc;case "height":return null!=
a.K.Jb;case "obstacle":return a.K.lf}throw"internal";},getState:function(a){switch(a.K.ac){case ri:return"ground";case "height":return"height";case "obstacle":return"obstacles";default:return"ground"}},object:a});a.b.add("sim:vpl",{action:function(a){a.Ad?a.Za(["vpl"],{Dd:!0}):a.Za(["vpl"],{yd:"sim"})},isEnabled:function(a){return null==a.H||af(a.H)},object:a,W:function(a){return(null==a.H||!a.H.ga)&&0>a.xa.indexOf("vpl")}});a.b.add("sim:text",{action:function(a){a.Ad?a.Za(["src"],{Dd:!0,Bf:!a.H.Cc}):
a.Za(["src"],{yd:"sim",Bf:!a.H.Cc})},object:a,W:function(a){return 0>a.xa.indexOf("src")}});a.b.add("sim:teacher-reset",{action:function(a){a.K.Zd();Kb(a)},object:a,Ec:!0,W:function(a){return a.K.Hb&&a.K.wa.Ra}});a.b.add("sim:teacher",{action:function(a){a.K.wa.Ra=!a.K.wa.Ra;Kb(a)},Ya:function(a){return a.K.wa.Ra},object:a,Ec:!0,W:function(a){return a.K.Hb}})};function wf(a){return new jf({Qb:function(b,c){a.Pa[a.Ba].ab.state.b(c)},Ac:function(){try{var b=uf("asebahttp")||("http:"!==document.location.origin.slice(0,5)?"http://127.0.0.1:3000":document.location.origin);la(b,function(){a.Pa[a.Ba].ab.state=fa[0];Hd(a.ba)})}catch(c){console.info(c),Hd(a.ba)}},isConnected:function(){return null!=a.Pa[a.Ba].ab.state},isEnabled:function(b){return"aseba"===b&&null!=a.Pa[a.Ba].ab.state},md:"aseba",languages:["aseba","l2"],state:null})};function xf(a){var b=null;return new jf({Qb:function(a,d){b.run(d)},Ac:function(){try{b=new window.TDM(uf("w"),{uuid:uf("uuid")||"auto",change:function(b){a.Pa[a.Ba].ab.state=b?{}:null;Hd(a.ba)}})}catch(c){console.info(c),Hd(a.ba)}},isConnected:function(){return null!=a.Pa[a.Ba].ab.state&&b.isConnected()},isEnabled:function(c){return"aseba"===c&&null!=a.Pa[a.Ba].ab.state&&b.canRun()},md:"aseba",languages:["aseba"],state:null})};function Ci(a){this.w=a||"ws://127.0.0.1:8002/";this.o={};this.l=this.b=null}Ci.prototype.connect=function(){this.g=new WebSocket(this.w);var a=this;this.g.addEventListener("open",function(){a.g.send(JSON.stringify({type:"nodes"}))});this.g.addEventListener("message",function(b){try{var c=JSON.parse(b.data);switch(c.type){case "connect":if(c.id){var d=c.id;a.o[d]=c;a.b&&a.b(d,c.descr)}break;case "disconnect":d=c.id,delete a.o[d],a.l&&a.l(d)}}catch(e){}})};
Ci.prototype.Qb=function(a,b){this.g.send(JSON.stringify({type:"run",id:a,bc:b}))};function yf(a){var b=null,c=uf("uuid")||null;c&&(c=c.replace(/^\{(.*)\}$/,"$1"));var d=null;return new jf({Qb:function(a,f){switch(a){case "aseba":var e=new Df(d,f);e.Qa=Ef;break;case "l2":e=new Df(d,f),e.Qa=Gf}a=Hf(e);b.Qb(c,a)},Ac:function(){try{var e=uf("w")||("http:"!==document.location.origin.slice(0,5)?"ws://127.0.0.1:8002":document.location.origin.replace(/^http/,"ws"));b=new Ci(e);b.b=function(b,e){if(null==c||b===c)d=new Bf(e),a.Pa[a.Ba].ab.state={},Hd(a.ba)};b.l=function(b){if(null==c||
b===c)a.Pa[a.Ba].ab.state=null,Hd(a.ba)};b.connect()}catch(f){console.info(f),Hd(a.ba)}},isConnected:function(){return null!=a.Pa[a.Ba].ab.state},isEnabled:function(b){return("aseba"===b||"l2"===b)&&null!=a.Pa[a.Ba].ab.state},md:"aseba",languages:["aseba","l2"],state:null})};
}).call(this);
