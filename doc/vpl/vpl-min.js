/* Copyright 2018-2020 ECOLE POLYTECHNIQUE FEDERALE DE LAUSANNE - author Yves Piguet */
(function(){
var M,aa,ba,ca;function ea(a,b){this.name=a;this.Md=b}var ha=[];function ka(){var a=la;if(a)for(var b=ha.length-1;0<=b;b--)ha[b]instanceof a&&ha.splice(b,1);else ha=[]}ea.prototype.b=function(){throw"not implemented";};ea.prototype.addEventListener=function(){throw"not implemented";};function la(a,b,c){ea.call(this,a,b);this.url=c}la.prototype=Object.create(ea.prototype);la.prototype.constructor=la;function na(a,b,c,d){var e=new XMLHttpRequest;e.timeout=200;e.onerror=function(){c(null)};c&&(e.onreadystatechange=function(){if(4===e.readyState)switch(e.status){case 200:c(e.responseText);break;default:c(null)}});e.open(a,b,!0);e.send(d)}
function oa(a,b){a=a||"";na("GET",a+"/nodes",function(c){null!==c&&(c=JSON.parse(c),0===c.length?oa(a,b):(ka(),c.forEach(function(d){var e=new la(d.name,d.aeslId,a+"/nodes/"+d.name,d.protocolVersion);na("GET",a+"/nodes/"+d.name,function(f){e.description=f?JSON.parse(f):""});ha.push(e)}),b&&b()))})}
function pa(a,b){return"<!DOCTYPE aesl-source>\n<network>\n"+[].map(function(c){return"<event size='"+(c.size||0).toString(10)+"' name='"+c.name+"'/>\n"}).join("")+"<keywords flag='true'/>\n<node nodeId='"+(a.Md||1).toString(10)+"' name='"+a.name+"'><![CDATA["+b+"]]\x3e</node>\n</network>\n"}la.prototype.b=function(a){a=pa(this,a);na("PUT",this.url,void 0,a)};
la.prototype.addEventListener=function(a,b){a=a.toString();var c=this.url+"/events";a&&(c+="/"+a);c=new EventSource(c);c.onmessage=function(d){b(d.data.split(" ").slice(1).map(function(e){return parseInt(e,10)}),a)};return c};function qa(a){this.name=a.name;this.type=a.type;this.ma=a.ma||["b","a"];this.ng=a.ng||!1;this.ga=a.ga||null;this.jb=a.jb||null;this.pe=a.pe||null;this.Ze=a.Ze||null;this.fe=a.fe||null;this.sc=a.sc||null;this.Jb=a.Jb||{aseba:"e"===this.type?function(b){return{Fd:"# onevent "+b.V.name+"\n"}}:function(b){return{ia:"# "+b.V.name+"\n"}}};this.H=a.H||function(b,c){b.text(c.V.name)};this.Wd=a.Wd||!1;this.aa=a.aa||null;this.Pa=a.Pa||null;this.Fc=a.Fc||null}
function ra(a,b,c,d){for(var e=null;;){var f=/`([^`]*)`/.exec(a);if(null==f)break;e=(new Function("$","i","rgb","toFixed","return "+f[1]+";"))(b.h,c,function(g){g=[g[0],Math.max(.2+.8*g[1],g[2]/2),g[2]];var h=Math.max(g[0],Math.max(g[1],g[2]));return g.map(function(k){return.88*(1-h)+(.12+.88*h)*k})},function(g,h){return parseFloat(g.toFixed(void 0===h?2:h)).toString()});a=a.slice(0,f.index)+e+a.slice(f.index+f[0].length)}return d?e:a};function sa(a,b,c){this.V=a;this.Bb=b;this.ie=c;this.locked=this.disabled=!1;this.h=a.ga?a.ga():null;this.ce=this.b=null}sa.prototype.pb=function(a,b,c){a=new sa(this.V,a,b);a.disabled=this.disabled;a.b=c;this.h&&(a.h=this.h.slice());return a};function ta(a){a.b&&a.b()}sa.prototype.g=function(a){return this.disabled?{}:this.V.Jb[a]?this.V.Jb[a](this):ua[a].l(this)};function va(a,b,c){sa.call(this,xa[a],b,c)}va.prototype=Object.create(sa.prototype);va.prototype.constructor=va;var xa={e:new qa({name:"empty e",type:"e",H:function(a,b,c,d){var e=ya("!empty event");e&&e.H(a,b,c,d)}}),a:new qa({name:"empty a",type:"a",H:function(a,b,c,d){var e=ya("!empty action");e&&e.H(a,b,c,d)}}),s:new qa({name:"empty s",type:"s",H:function(a,b,c,d){var e=ya("!empty state")||ya("!empty event");e&&e.H(a,b,c,d)}})};va.prototype.g=function(){return{}};function za(){this.U=[];this.actions=[];this.error=null;this.locked=this.disabled=!1}za.prototype.pb=function(){for(var a=new za,b=0;b<this.U.length;b++)Aa(a,this.U[b],null,null);for(b=0;b<this.actions.length;b++)Aa(a,this.actions[b],null,null);return a};za.prototype.Ub=function(){return 0===this.U.length&&0===this.actions.length};function Ba(a){for(var b=0;b<a.U.length;b++)if("init"===a.U[b].V.name)return a.U[b];return null}
function Aa(a,b,c,d,e){if(b){switch(b.V.type){case "e":case "s":if(b.Bb===a)c&&(a.U.splice(b.ie.index,1),e?b.b=d:b=b.pb(a,c,d),a.U.splice(c.index,0,b));else if(c){if(a.U[c.index]===b)return;e?b.b=d:b=b.pb(a,c,d);a.U[c.index]=b}else e?b.b=d:b=b.pb(a,{Wc:!0,index:a.U.length},d),a.U.push(b);break;case "a":case "c":if(b.Bb===a)c&&(Ca(a,b.ie),e?b.b=d:b=b.pb(a,c,d),(c.Wc?a.U:a.actions).splice(c.index,0,b));else if(c){if((c.Wc?a.U:a.actions)[c.index]===b)return;e?b.b=d:b=b.pb(a,c,d);(c.Wc?a.U:a.actions)[c.index]=
b}else e?b.b=d:b=b.pb(a,{Wc:!1,index:a.actions.length},d),a.actions.push(b)}Da(a)}}function Ca(a,b){b.Wc?a.U[b.index]&&a.U.splice(b.index,1):a.actions[b.index]&&a.actions.splice(b.index,1)}function Da(a){a.U.forEach(function(b,c){b.Bb=this;b.ie={Wc:!0,index:c}},a);a.actions.forEach(function(b,c){b.Bb=this;b.ie={Wc:!1,index:c}},a)}
function Ea(a,b){function c(k,l){if(k.disabled)return l.disabled?0:1;if(l.disabled)return-1;k=k.V.name;l=l.V.name;return k>l?1:k<l?-1:0}function d(k,l){if(null===k.h&&null===l.h)return!0;if(null===k.h||null===l.h||k.h.length!==l.h.length)return!1;for(var z=0;z<k.h.length;z++)if(k.h[z]!==l.h[z])return!1;return!0}function e(k){for(var l=0;l<k.U.length;l++)if(!k.U[l].disabled)return!1;return!0}if(!(a.disabled||b.disabled||e(a)||e(b)||0===a.U.length||b.U.length!==a.U.length)){for(var f=a.U.slice(0,1).concat(a.U.slice(1).sort(c)),
g=b.U.slice(0,1).concat(b.U.slice(1).sort(c)),h=0;h<f.length&&!f[h].disabled&&!g[h].disabled;h++)if(f[h].V!==g[h].V||!d(f[h],g[h]))return;if(null==a.error||a.error.Kb)f=new Ga("Rules with same events"),Ha(f,b),a.error=f;if(null==b.error||b.error.Kb)f=new Ga("Rules with same events"),Ha(f,a),b.error=f}};function Ia(){this.b=[];this.Xa=!1}function Ja(a,b){a.b=b.slice()}Ia.prototype.toggle=function(a){var b=this.b.indexOf(a);0<=b?this.b.splice(b,1):this.b.push(a)};function Ka(){this.b={};this.language="en"}function La(a,b,c){a.b[b]||(a.b[b]={});a=a.b[b];for(var d in c)c.hasOwnProperty(d)&&(a[d]=c[d])}Ka.prototype.translate=function(a){var b=this.b[this.language];return b&&b[a]||a};function Ma(a){this.filename=null;this.readOnly=!1;this.mode="b";this.fa=!1;this.Ob=!0;this.hg=!1;this.i=[];this.Bc=!1;this.Ff=!0;this.w=this.o=this.na=null;this.Qc=new Na;this.code={};this.Db="aseba";this.message=null;this.xc=Oa;this.g=Pa;this.wc=Qa;this.b=Ra;this.ya=a||new Ia;this.l=null}var ua={},Oa=[],Pa=!1,Ra=!0,Qa=[];function Sa(){Oa=Ta("b").map(function(a){return a.name});Qa=Ta("a").map(function(a){return a.name})}
function Ua(a){var b=Va.map(function(c){return c.name});switch(a){case "b":Oa=b;break;case "a":Qa=b}}M=Ma.prototype;M.je=function(){this.ya.b=[]};function Wa(a,b){b?(b=a.Qc,b.gc=[],b.bd=[]):a.Cb();a.mode="b";a.xc=Oa;a.g=Pa;a.wc=Qa;a.b=Ra;a.i=[];a.code={};a.Ff=!0}M.Ub=function(){for(var a=0;a<this.i.length;a++)if(!this.i[a].Ub())return!1;return!0};M.getError=function(){for(var a=0;a<this.i.length;a++)if(null!==this.i[a].error)return this.i[a].error;return null};
function Xa(a){if("b"===a.mode?a.g:a.b)return!1;for(var b=0;b<a.i.length;b++)if(1<a.i[b].U.length||0<a.i[b].U.length&&"s"===a.i[b].U[0].V.type)return!1;return!0}M.Cb=function(){this.Qc.Cb(Ya(this),this.Bc);this.code={};this.Bc=!1};M.Pf=function(a){if(0<this.Qc.gc.length){var b=this.Qc.Pf(Ya(this),this.Bc);Za(this,b.state,a);this.Bc=b.b;this.code={}}};M.If=function(a){if(0<this.Qc.bd.length){var b=this.Qc.If(Ya(this),this.Bc);Za(this,b.state,a);this.Bc=b.b;this.code={}}};
function $a(a,b){b!==a.mode&&(a.Cb(),a.mode=b,a.i.forEach(function(c){c.U.forEach(function(d,e){c.U[e]=d});c.actions.forEach(function(d,e){c.actions[e]=d})}))}function ab(a){var b="teacher"===bb("role");a.Ob=b}
function Ya(a,b){var c={};b&&!1===b.Yc||(c.advanced="a"===a.mode,c.basicBlocks=a.xc,c.basicMultiEvent=a.g,c.advancedBlocks=a.wc,c.advancedMultiEvent=a.b,c.disabledUI=a.ya.b);if(b&&!1===b.ad)return c;b=a.o?a.o():null;var d=null;null==b&&(d=a.i.map(function(e){function f(h){h&&g.push({name:h.V.name,disabled:h.disabled,locked:h.locked,param:h.V.Ze?h.V.Ze(h):h.h?h.h.slice():null})}var g=[];e.U.forEach(function(h){f(h)});e.actions.forEach(function(h){f(h)});return{blocks:g,disabled:e.disabled,locked:e.locked}}));
c.program=d;c.code=b;return c}function cb(a,b){return JSON.stringify(Ya(a,b),null,"\t")}
function Za(a,b,c,d){var e=!1,f="vpl";try{if(b&&(!b.disabledUI||d&&d.jh||Ja(a.ya,b.disabledUI),d&&d.ih||(a.mode=b.advanced?"a":"b",a.xc=b.basicBlocks||Oa,a.g=void 0!==b.basicMultiEvent?b.basicMultiEvent:Pa,a.wc=b.advancedBlocks||Qa,a.b=void 0!==b.advancedMultiEvent?b.advancedMultiEvent:Ra),!d||!d.dg)&&(b.program?a.i=b.program.map(function(h){var k=new za;h.blocks.forEach(function(l){var z=ya(l.name);if(z){var m=new sa(z,null,null);m.disabled=l.disabled||!1;m.locked=l.locked||!1;z.fe?z.fe(m,l.param,
function(){e&&c&&c("vpl")}):m.h=l.param;Aa(k,m,null,function(){a.Cb()},!0)}},this);k.disabled=h.disabled||!1;k.locked=h.locked||!1;return k},a):a.i=[],a.w)){var g=b.code;a.w(void 0==b.code?null:g);null!=g&&(f="src")}}catch(h){}a.fa="src"===f;c&&c(f);e=!0}function db(a,b,c,d){try{var e=JSON.parse(b);Za(a,e,c,d);var f=a.Qc;f.gc=[];f.bd=[]}catch(g){}}M.$b=function(a){"string"!==typeof this.code[a]&&(this.code[a]=ua[a].g(this));return this.code[a]};
function eb(a,b){var c=ua[a];a=fb(c,b,!0);b=fb(c,b,!1);return 0<=a&&0<=b?{Fd:a,end:b}:null}function gb(a,b){a.l=b}M.log=function(a){this.l&&this.l(a)};function hb(a,b,c){this.language=a;this.o=b;this.w=c;this.b=[]}function ib(a,b,c){this.id=a;this.l=b;this.g=c;if(0>a||6399<a)throw"internal";this.A=String.fromCharCode(57344+a);this.b=-1}
function jb(a,b){a.forEach(function(d){d.b=b.indexOf(d.A)});a.sort(function(d,e){return d.b-e.b});for(var c=0;c<a.length;c++)a[c].b-=c,b=b.replace(a[c].A,"");a.forEach(function(d){var e;if(d.g){for(;;){for(e=d.b;" "===b[e]||"\t"===b[e];e++);if("\n"===b[e])d.b=e+1;else break}if(" "===b[d.b-1]||"\t"===b[d.b-1]){for(e=d.b-1;" "===b[e]||"\t"===b[e];e--);"\n"===b[e]&&(d.b=e+1)}}else if(" "===b[d.b-1]||"\t"===b[d.b-1]){for(e=d.b-1;" "===b[e]||"\t"===b[e];e--);"\n"===b[e]&&(d.b=e+1)}});return b}
function kb(a){return a.replace(/[\ue000-\uf8ff]/g,"")}function lb(a,b,c){var d=a.b.length,e=new ib(d,c,!0);a.b.push(e);c=new ib(d+1,c,!1);a.b.push(c);return e.A+b+c.A}function fb(a,b,c){for(var d=0;d<a.b.length;d++)if(a.b[d].l===b&&a.b[d].g===c)return a.b[d].b;return-1}
function mb(a,b){if(b.disabled||b.Ub())return{};b.error=null;for(var c=!1,d=!1,e=0;e<b.U.length;e++)if(!b.U[e].disabled)if("e"===b.U[e].V.type){if(c=!0,b.U[e].V.sc){var f=b.U[e].V.sc(b.U[e]);if(f&&(nb(f,[e]),!f.Kb||!b.error)&&(b.error=f,!f.Kb))return{error:f}}}else"s"===b.U[e].V.type&&(d=!0);f=!1;for(e=0;e<b.actions.length;e++)if(!b.actions[e].disabled&&"a"===b.actions[e].V.type){f=!0;break}if(!c&&!f)return b.error?{error:b.error}:{};if(!c&&!d)return f=new Ga("Missing event block"),nb(f,[]),b.error=
f,{error:f};if(!f)return f=new Ga("Missing action block"),f.b.push(0),b.error=f,{error:f};if(!b.error)for(e=0;e<b.actions.length;e++)for(c=e+1;c<b.actions.length;c++)"a"===b.actions[c].V.type&&b.actions[c].V===b.actions[e].V&&(f=new Ga("Duplicate action blocks",!0),f.b.push(e),f.b.push(c),b.error=f);var g=[],h=[],k=[],l="",z=[],m="",x=[],n="";b.U.forEach(function(r,v){var p=r.g(this.language);p.Wa&&(0===v&&p.O?(l=lb(this,p.Wa,r),p.$&&(m+=p.$)):(z.push(lb(this,p.Wa,r)),p.$&&(x=x.concat(p.$))));p.Tb&&
(g=g.concat(p.Tb));p.ac&&(h=h.concat(p.ac));p.Sb&&(k=k.concat(p.Sb));p.ia&&(n+=lb(this,p.ia,r))},a);for(e=0;e<b.actions.length;e++)c=b.actions[e].g(a.language),n+=c.ia?lb(a,c.ia,b.actions[e]):"",c.Tb&&c.Tb.forEach(function(r){0>g.indexOf(r)&&g.push(r)}),c.ac&&c.ac.forEach(function(r){0>h.indexOf(r)&&h.push(r)}),c.Sb&&c.Sb.forEach(function(r){0>k.indexOf(r)&&k.push(r)});return 0<n.length?(e="e"===b.U[0].V.type?b.U[0].g(a.language):null,c=b.U.slice(1).filter(function(r){return"e"===r.V.type}).map(function(r){return r.g(this.language)},
a),{mh:b.U[0]?b.U[0].V.name:"",Tb:g,ac:h,Sb:k,O:e?e.O:"",hb:e?e.hb:"",Ua:e?e.Ua:"",nd:c.map(function(r){return r.O||""}),Ke:c.map(function(r){return r.hb||""}),Le:c.map(function(r){return r.Ua||""}),$:m,md:x,Wa:l,Gb:z.join(" "+a.o+" "),ia:(e&&e.ia||"")+n}):{}}hb.prototype.g=function(){throw"internal";};hb.prototype.l=function(){throw"internal";};function ob(){hb.call(this,"aseba","and","1 == 1")}ob.prototype=Object.create(hb.prototype);ob.prototype.constructor=ob;
ob.prototype.g=function(a,b){this.b=[];var c=a.i.map(function(q){return mb(this,q)},this),d={},e=[];c.forEach(function(q){q.O&&(d[q.O]={O:q.O,hb:q.hb,Ua:q.Ua,$:"",Ha:""},0>e.indexOf(q.O)&&e.push(q.O));q.nd&&q.nd.forEach(function(t,u){d[t]={O:t,hb:q.Ke[u],Ua:q.Le[u],$:"",Ha:""};0>e.indexOf(t)&&e.push(t)})});var f=[],g=[],h=[],k=[];c.forEach(function(q,t){q.Tb&&q.Tb.forEach(function(F){0>f.indexOf(F)&&f.push(F)});q.ac&&q.ac.forEach(function(F){0>g.indexOf(F)&&g.push(F)});q.Sb&&q.Sb.forEach(function(F){0>
h.indexOf(F)&&h.push(F)});if(q.O&&(q.Ya=k.indexOf(kb(q.Wa||q.O)),0>q.Ya)){q.Ya=k.length;k.push(kb(q.Wa||q.O));var u=d[q.O];q.$&&0>u.$.indexOf(q.$)&&(u.$+=q.$);u.Ha+=q.Wa?"when "+q.Wa+" do\neventCache["+q.Ya+"] = 1\nend\n":"eventCache["+q.Ya+"] = 1\n"}q.O||(q.ia=lb(this,q.ia||"",a.i[t]))},this);var l="";if(b){var z=new za,m=new sa(ya("init"),null,null);Aa(z,m,null,null);b.forEach(function(q){Aa(z,q,null,null)});m=mb(this,z);var x=!0;m.Tb.forEach(function(q){0>f.indexOf(q)&&(x=!1)});m.Sb.forEach(function(q){0>
h.indexOf(q)&&(x=!1)});x?l=m.ia:m.Yg&&(l=m.Yg)}var n=[],r="",v="",p=0;for(m=0;m<a.i.length;m++)0<=c[m].Ya?(c[m].md&&c[m].md.forEach(function(q){0>n.indexOf(q)&&n.push(q)}),r+="if eventCache["+c[m].Ya+"] != 0"+(c[m].Gb?" and "+c[m].Gb:"")+" then\ntodo["+p+"] = 1\nend\n",v+="if todo["+p+"] != 0 then\n"+c[m].ia+"end\n",p++):c[m].Gb&&(r+="when "+c[m].Gb+" do\ntodo["+p+"] = 1\nend\n",v+="if todo["+p+"] != 0 then\n"+c[m].ia+"end\n",p++);c=0<f.length?"\n"+f.join("\n"):"";0<k.length&&(c+="var eventCache[] = ["+
k.map(function(){return"0"}).join(", ")+"]\n");if(0<p){c+="var todo[] = [";for(m=0;m<p;m++)c+=0<m?", 0":"0";c+="]\n"}b?c+="\n"+l:(0<g.length&&(c+="\n"+g.join("\n")),r&&(c+=(0<c.length?"\n":"")+"timer.period[1] = 50\n"));for(m=0;m<e.length;m++)!/onevent/.test(d[e[m]].O)&&(d[e[m]].Ua||d[e[m]].$||d[e[m]].Ha)&&(c+="\n"+(d[e[m]].O||"")+(d[e[m]].Ua||"")+(d[e[m]].$||"")+(d[e[m]].Ha||"")+(d[e[m]].hb||""));0<h.length&&(c+="\n"+h.join("\n"));for(m=0;m<e.length;m++)/onevent/.test(d[e[m]].O)&&(d[e[m]].Ua||d[e[m]].$||
d[e[m]].Ha)&&(c+="\n"+(d[e[m]].O||"")+(d[e[m]].Ua||"")+(d[e[m]].$||"")+(d[e[m]].Ha||"")+(d[e[m]].hb||""));if(r){c+="\nonevent timer1\n"+n.join("")+r+v;for(m=0;m<k.length;m++)c+="eventCache["+m+"] = 0\n";for(m=0;m<p;m++)c+="todo["+m+"] = 0\n"}"\n"===c[0]&&(c=c.slice(1));var w=0;b=c.split("\n").map(function(q){return q.trim()}).map(function(q){function t(G){for(var D=kb(q),O=0;O<G.length;O++)if(D.slice(0,G[O].length)===G[O]&&!/^\w/.test(D.slice(G[O].length)))return!0;return!1}if(0<q.length){var u=t(["else",
"elseif","end","onevent","sub"]),F=t("if else elseif for onevent sub when while".split(" "));u&&(w=Math.max(w-1,0));q="\t\t\t\t\t".slice(0,w)+q;F&&w++}return q});for(m=b.length-2;0<=m;m--)/^\s*#/.test(b[m])&&(l=b[m+1].replace(/^(\s*).*$/,"$1"),b[m]=l+b[m].replace(/^\s*/,""));c=b.join("\n");for(m=0;m<a.i.length;m++)for(b=m+1;b<a.i.length;b++)Ea(a.i[m],a.i[b]);return c=jb(this.b,c)};
ob.prototype.l=function(a){var b="# missing Aseba implementation for block "+a.V.name+"\n";switch(a.V.type){case "e":case "s":return{$:b,Wa:"1 == 1"};case "a":return{ia:b};default:return{}}};ua.aseba=new ob;function pb(){hb.call(this,"l2","&&","true")}pb.prototype=Object.create(hb.prototype);pb.prototype.constructor=pb;
pb.prototype.g=function(a,b){this.b=[];var c=a.i.map(function(w){return mb(this,w)},this),d={},e=[];c.forEach(function(w){w.O&&(d[w.O]={O:w.O,hb:w.hb,Ua:w.Ua,$:"",Ha:""},0>e.indexOf(w.O)&&e.push(w.O));w.nd&&w.nd.forEach(function(q,t){d[q]={O:q,hb:w.Ke[t],Ua:w.Le[t],$:"",Ha:""};0>e.indexOf(q)&&e.push(q)})});var f=[],g=[],h=[],k=[];c.forEach(function(w,q){w.Tb&&w.Tb.forEach(function(u){0>f.indexOf(u)&&f.push(u)});w.ac&&w.ac.forEach(function(u){0>g.indexOf(u)&&g.push(u)});w.Sb&&w.Sb.forEach(function(u){0>
h.indexOf(u)&&h.push(u)});if(w.O&&(w.Ya=k.indexOf(kb(w.Wa||w.O)),0>w.Ya)){w.Ya=k.length;k.push(kb(w.Wa||w.O));var t=d[w.O];w.$&&0>t.$.indexOf(w.$)&&(t.$+=w.$);t.Ha+=w.Wa?"when ("+w.Wa+") {\neventCache["+w.Ya+"] = true;\n}\n":"eventCache["+w.Ya+"] = true;\n"}w.O||(w.ia=lb(this,w.ia||"",a.i[q]))},this);var l="";if(b){var z=new za,m=new sa(ya("init"),null,null);Aa(z,m,null,null);b.forEach(function(w){Aa(z,w,null,null)});l=mb(this,z).ia}var x=[],n="",r="",v=0;for(m=0;m<a.i.length;m++)0<=c[m].Ya?(c[m].md&&
c[m].md.forEach(function(w){0>x.indexOf(w)&&x.push(w)}),n+="if (eventCache["+c[m].Ya+"]"+(c[m].Gb?" && "+c[m].Gb:"")+") {\ntodo["+v+"] = true;\n}\n",r+="if (todo["+v+"]) {\n"+c[m].ia+"}\n",v++):c[m].Gb&&(n+="when ("+c[m].Gb+") {\ntodo["+v+"] = true;\n}\n",r+="if (todo["+v+"]) {\n"+c[m].ia+"}\n",v++);c=0<f.length?"\n"+f.join("\n"):"";0<k.length&&(c+="bool eventCache["+k.length+"] = false;\n");b?c+="\n"+l:(m="",0<g.length&&(m+="\n"+g.join("\n")),m&&(c+=(0<c.length?"\n":"")+m.slice(1)),n&&(c+=(0<c.length?
"\n":"")+"timer.period[1] = 50;\n"));for(m=0;m<e.length;m++)!/onevent/.test(d[e[m]].O)&&(d[e[m]].Ua||d[e[m]].$||d[e[m]].Ha)&&(c+="\n"+(d[e[m]].O||"")+(d[e[m]].Ua||"")+(d[e[m]].$||"")+(d[e[m]].Ha||"")+(d[e[m]].hb||""));0<h.length&&(c+="\n"+h.join("\n"));for(m=0;m<e.length;m++)/onevent/.test(d[e[m]].O)&&(d[e[m]].Ua||d[e[m]].$||d[e[m]].Ha)&&(c+="\n"+(d[e[m]].O||"")+(d[e[m]].Ua||"")+(d[e[m]].$||"")+(d[e[m]].Ha||"")+(d[e[m]].hb||""));n&&(c+="\nonevent timer1 {\n",0<v&&(c+="bool todo["+v+"] = false;\n"),
c+=x.join("")+n+r+"eventCache = false;\n}\n");"\n"===c[0]&&(c=c.slice(1));var p=0;b=c.split("\n").map(function(w){return w.trim()}).map(function(w){var q=kb(w);if(0<q.length){var t="{"===q.slice(-1);"}"===q[0]&&(p=Math.max(p-1,0));w="\t\t\t\t\t".slice(0,p)+w;t&&p++}return w});for(m=b.length-2;0<=m;m--)/^\s*#/.test(b[m])&&(n=b[m+1].replace(/^(\s*).*$/,"$1"),b[m]=n+b[m].replace(/^\s*/,""));c=b.join("\n");for(m=0;m<a.i.length;m++)for(b=m+1;b<a.i.length;b++)Ea(a.i[m],a.i[b]);return c=jb(this.b,c)};
pb.prototype.l=function(a){var b="// missing L2 implementation for block "+a.V.name+"\n";switch(a.V.type){case "e":case "s":return{$:b,Wa:"true"};case "a":return{ia:b};default:return{}}};ua.l2=new pb;function qb(){hb.call(this,"js","&&","true")}qb.prototype=Object.create(hb.prototype);qb.prototype.constructor=qb;
qb.prototype.g=function(a,b){this.b=[];var c=a.i.map(function(u){return mb(this,u)},this),d={},e=[];c.forEach(function(u){u.O&&(d[u.O]={O:u.O,hb:u.hb,Ua:u.Ua,$:"",Ha:""},0>e.indexOf(u.O)&&e.push(u.O));u.nd&&u.nd.forEach(function(F,G){d[F]={O:F,hb:u.Ke[G],Ua:u.Le[G],$:"",Ha:""};0>e.indexOf(F)&&e.push(F)})});var f=[],g=[],h=[],k=[],l=[],z=0;c.forEach(function(u,F){u.Tb&&u.Tb.forEach(function(O){0>f.indexOf(O)&&f.push(O)});u.ac&&u.ac.forEach(function(O){0>g.indexOf(O)&&g.push(O)});u.Sb&&u.Sb.forEach(function(O){0>
h.indexOf(O)&&h.push(O)});var G=u.ia||"";u.Wa&&(G="cond = "+u.Wa+";\nif (cond && !cond0["+z+"]) {\n"+G+"}\ncond0["+z+"] = cond;\n",z++);if(u.O&&(u.Ya=k.indexOf(kb(u.Wa||u.O)),0>u.Ya)){u.Ya=k.length;k.push(kb(u.Wa||u.O));var D=d[u.O];u.$&&0>D.$.indexOf(u.$)&&(D.$+=u.$);u.Wa?(D.Ha+="cond = "+u.Wa+";\nif (cond && !cond0["+z+"]) {\neventCache["+u.Ya+"] = true;\n}\ncond0["+z+"] = cond;\n",z++):D.Ha+="eventCache["+u.Ya+"] = true;\n"}u.O||(u.ia=lb(this,G,a.i[F]));Ba(a.i[F])&&l.push(F)},this);var m="";if(b){var x=
new za,n=new sa(ya("init"),null,null);Aa(x,n,null,null);b.forEach(function(u){Aa(x,u,null,null)});m=mb(this,x).ia}var r=[],v="",p="",w=0;for(n=0;n<a.i.length;n++)0<=c[n].Ya?(c[n].md&&c[n].md.forEach(function(u){0>r.indexOf(u)&&r.push(u)}),v+="if (eventCache["+c[n].Ya+"]"+(c[n].Gb?" && "+c[n].Gb:"")+") {\ntodo["+w+"] = true;\n}\n",p+="if (todo["+w+"]) {\n"+c[n].ia+"}\n",w++):c[n].Gb&&(v+="cond = "+c[n].Gb+";\nif (cond && !cond0["+z+"]) {\ntodo["+w+"] = true;\n}\ncond0["+z+"] = cond;\n",z++,p+="if (todo["+
w+"]) {\n"+c[n].ia+"}\n",w++);0<z&&(f.unshift("var cond0;\nvar cond;\n"),g.unshift("cond0 = [];\n"));var q=0<f.length?"\n"+f.join("\n"):"";0<k.length&&(q+="var eventCache = [];\n");0<w&&(q+="var todo = [];\n");if(b)q+="\n"+m;else{b="";0<g.length&&(b+="\n"+g.join("\n"));v&&(b+="this.setTimer(1, 0.1, true);\n");for(n=0;n<a.i.length;n++)0<=l.indexOf(n)&&c[n].ia&&(b+=(0<b.length?"\n":"")+(c[n].O||"")+(c[n].ia||"")+(c[n].hb||""));b&&(q+=(0<q.length?"\n":"")+'this.addEventListener("init", function (name, param) {\n'+
b.slice(1)+"});\n")}if(0<h.length)throw"internal error, unsupported sub/onevent in js";for(n=0;n<e.length;n++)if(d[e[n]].Ua||d[e[n]].$||d[e[n]].Ha)q+="\n"+(d[e[n]].O||"")+(d[e[n]].Ua||"")+(d[e[n]].$||"")+(d[e[n]].Ha||"")+(d[e[n]].hb||"");if(v){q+='\nthis.addEventListener("timer1", function (name, param) {\n'+r.join("")+v+p;for(n=0;n<k.length;n++)q+="eventCache["+n+"] = false;\n";for(n=0;n<w;n++)q+="todo["+n+"] = false;\n"}0<q.trim().length&&(q+="});");"\n"===q[0]&&(q=q.slice(1));var t=0;c=q.split("\n").map(function(u){return u.trim()}).map(function(u){var F=
kb(u);if(0<F.length){var G="{"===F.slice(-1);"}"===F[0]&&(t=Math.max(t-1,0));u="\t\t\t\t\t".slice(0,t)+u;G&&t++}return u});for(n=c.length-2;0<=n;n--)/^\s*#/.test(c[n])&&(q=c[n+1].replace(/^(\s*).*$/,"$1"),c[n]=q+c[n].replace(/^\s*/,""));q=c.join("\n");for(n=0;n<a.i.length;n++)for(c=n+1;c<a.i.length;c++)Ea(a.i[n],a.i[c]);return q=jb(this.b,q)};
qb.prototype.l=function(a){var b="// missing JavaScript implementation for block "+a.V.name+"\n";switch(a.V.type){case "e":case "s":return{$:b,Wa:"true"};case "a":return{ia:b};default:return{}}};ua.js=new qb;function rb(){hb.call(this,"python","and","True")}rb.prototype=Object.create(hb.prototype);rb.prototype.constructor=rb;
rb.prototype.g=function(a,b){this.b=[];var c=a.i.map(function(t){return mb(this,t)},this),d={},e=[];c.forEach(function(t){t.O&&(d[t.O]={O:t.O,hb:t.hb,Ua:t.Ua,$:"",Ha:""},0>e.indexOf(t.O)&&e.push(t.O));t.nd&&t.nd.forEach(function(u,F){d[u]={O:u,hb:t.Ke[F],Ua:t.Le[F],$:"",Ha:""};0>e.indexOf(u)&&e.push(u)})});var f=[],g=[],h=[],k=[],l=!1;c.forEach(function(t,u){t.Tb&&t.Tb.forEach(function(G){0>f.indexOf(G)&&f.push(G)});t.ac&&t.ac.forEach(function(G){0>g.indexOf(G)&&g.push(G)});t.Sb&&t.Sb.forEach(function(G){0>
h.indexOf(G)&&h.push(G)});if(t.O&&(t.Ya=k.indexOf(kb(t.Wa||t.O)),0>t.Ya)){t.Ya=k.length;k.push(kb(t.Wa||t.O));var F=d[t.O];t.$&&0>F.$.indexOf(t.$)&&(F.$+=t.$);t.Wa?(F.Ha+="cond = "+t.Wa+"\nif cond and not cond0["+u+"]:\neventCache["+t.Ya+"] = True\n<\n",l=!0):F.Ha+="eventCache["+t.Ya+"] = True\n"}t.O||(t.ia=lb(this,t.ia||"",a.i[u]))},this);if(b){var z=new za,m=new sa(ya("init"),null,null);Aa(z,m,null,null);b.forEach(function(t){Aa(z,t,null,null)});var x=mb(this,z);x.Tb.forEach(function(){});x.Sb.forEach(function(){})}l&&
g.unshift("cond0 = {}\n");var n=[],r="",v="",p=0;for(m=0;m<a.i.length;m++)0<=c[m].Ya?(c[m].md&&c[m].md.forEach(function(t){0>n.indexOf(t)&&n.push(t)}),r+="if eventCache["+c[m].Ya+"]"+(c[m].Gb?" and "+c[m].Gb:"")+":\ntodo["+p+"] = True\n<\n",v+="if todo["+p+"]:\n"+c[m].ia+"<\n",p++):c[m].Gb&&(r+="cond = "+c[m].Gb+"\nif cond and not cond0["+m+"]:\ntodo["+p+"] = 1\n<\ncond0["+m+"] = cond\n",v+="if todo["+p+"]:\n"+c[m].ia+"<\n",p++);c=0<f.length?f.join("\n"):"";0<k.length&&(c+="eventCache = ["+k.map(function(){return"0"}).join(", ")+
"]\n");if(0<p){c+="todo = [";for(m=0;m<p;m++)c+=0<m?", 0":"0";c+="]\n"}b?c+="\n"+x:(0<g.length&&(c+="\n"+g.join("\n")),r&&(c+=(0<c.length?"\n":"")+"thymio.timer.period[1] = 50\n"));for(m=0;m<e.length;m++)!/onevent/.test(d[e[m]].O)&&(d[e[m]].Ua||d[e[m]].$||d[e[m]].Ha)&&(c+="\n"+(d[e[m]].O||"")+(d[e[m]].Ua||"")+(d[e[m]].$||"")+(d[e[m]].Ha||"")+(d[e[m]].hb||""));0<h.length&&(c+="\n"+h.join("\n"));for(m=0;m<e.length;m++)/onevent/.test(d[e[m]].O)&&(d[e[m]].Ua||d[e[m]].$||d[e[m]].Ha)&&(c+="\n"+(d[e[m]].O||
"")+(d[e[m]].Ua||"")+(d[e[m]].$||"")+(d[e[m]].Ha||"")+(d[e[m]].hb||""));if(r){c+="\n@thymio.onevent(thymio.TIMER1)\ndef onevent_timer1():\n"+n.join("")+r+v;for(m=0;m<k.length;m++)c+="eventCache["+m+"] = False\n";for(m=0;m<p;m++)c+="todo["+m+"] = False\n";c+="<\n"}"\n"===c[0]&&(c=c.slice(1));c&&(c="import thymio\n\n"+c);c=kb(c);c=c.replace(/\n[ \t]+/g,"\n").replace(/\n<\n\n<\n/g,"\n<\n<\n");var w=0,q="";c.split("\n").map(function(t){return t.trim()}).forEach(function(t){var u=kb(t);if(0<u.length){var F=
":"===u.slice(-1);"<"===u&&(w=Math.max(w-1,0));"<"!==u&&(t="\t\t\t\t\t".slice(0,w)+t,F&&w++)}"<"!==u&&(q+=t+"\n")});c=q;for(m=0;m<a.i.length;m++)for(b=m+1;b<a.i.length;b++)Ea(a.i[m],a.i[b]);return c=jb(this.b,c)};rb.prototype.l=function(a){var b="# missing Python implementation for block "+a.V.name+"\n";switch(a.V.type){case "e":case "s":return{$:b,Wa:"True"};case "a":return{ia:b};default:return{}}};ua.python=new rb;function sb(){ob.call(this)}sb.prototype=Object.create(hb.prototype);sb.prototype.constructor=sb;sb.prototype.g=function(a,b){a=ob.prototype.g.call(this,a,b);b=new tb(ub);a=new vb(b,a);a.ha=wb;a=xb(a);return yb(a,!0)};ua.asm=new sb;function zb(a){this.L=[];this.b=a||null}M=zb.prototype;M.add=function(a,b){this.L.push(new Ab(a,b))};M.find=function(a){for(var b=0;b<this.L.length;b++)if(this.L[b].name===a)return this.L[b];return null};function Bb(a,b){a=a.find(b);return null!=a&&null!=a.l}function Cb(a,b){if(a.b){var c=a.find(b);b={cmd:b};c.g&&(b.selected=c.Ta());c.b&&(b.state=c.getState());a.b({type:"cmd",data:b})}}M.mb=function(a,b){this.b&&this.b({type:"drop",data:{cmd:a}});(a=this.find(a))&&a.mb(b)};
M.lb=function(a,b){a=this.find(a);return null!=a&&a.lb(b)};M.T=function(a){a=this.find(a);return null!=a&&a.T()};M.isEnabled=function(a){a=this.find(a);return null!=a&&a.isEnabled()};M.Ta=function(a){a=this.find(a);return null!=a&&a.Ta()};M.getState=function(a){a=this.find(a);return null!=a?a.getState():null};
function Ab(a,b){this.name=a;this.o=b.isEnabled||null;this.g=b.Ta||null;this.b=b.getState||null;this.l=b.action||null;this.M=b.mb||null;this.w=b.lb||null;this.Ac=b.object||null;this.Mc=b.Mc||!1;this.P=b.T||null;this.cb=b.cb||null}function Db(a,b){a.isEnabled()&&a.l&&a.l(a.Ac,b)}function Eb(a,b){if(!a.b)return!1;var c=a.getState();if(b===c)return!0;for(var d=0;100>d;d++){Db(a,void 0);var e=a.getState();if(e===b)return!0;if(e===c)break}return!1}M=Ab.prototype;
M.mb=function(a){this.lb(a)&&this.M&&this.M(this.Ac,a)};M.lb=function(a){return null!=this.w&&this.w(this.Ac,a)};M.isEnabled=function(){return null==this.o||this.o(this.Ac)};M.Ta=function(){return null!=this.g&&this.g(this.Ac)};M.getState=function(){return null!=this.b?this.b(this.Ac):null};M.T=function(){return null==this.P||this.P(this.Ac)};function Fb(){var a=document.getElementById("programCanvas");Gb||(Sa(),Gb=!0);this.Ra=a;this.ba=new Hb;this.g=new Ka;this.ya=new Ia;var b=this;this.L=new zb(function(c){b.log(c)});this.Qb=null;this.P="vpl:close !space vpl:about vpl:help !space vpl:new vpl:save vpl:load vpl:upload vpl:filename vpl:exportToHTML !space vpl:advanced !stretch vpl:readonly !stretch vpl:undo vpl:redo !stretch vpl:connected !stretch vpl:run vpl:stop vpl:debug vpl:robot !stretch vpl:sim vpl:text !stretch vpl:teacher-reset vpl:teacher-save vpl:teacher-setasnew vpl:teacher".split(" ");
this.w="!!stretch vpl:message-error vpl:message-warning !!stretch vpl:duplicate vpl:disable vpl:lock vpl:trashcan".split(" ");this.za="src:close !space src:new src:save !space src:language src:disass !stretch src:run src:stop !stretch src:sim src:vpl !space src:locked !stretch src:teacher-reset src:teacher".split(" ");this.ha="sim:close !stretch sim:restart sim:pause !space sim:speedup sim:noise !stretch sim:pen sim:clear !space sim:map-kind sim:map sim:map-ground sim:map-obstacles sim:map-height !stretch sim:vpl sim:text !stretch sim:teacher-reset sim:teacher".split(" ");
this.Aa=["vpl"];this.Xb={vpl:1,src:1,sim:1};this.Pc=["ground","height","obstacles"];this.Rd=this.Cf=this.Be=this.re=this.ze=null;this.qc=!1;this.username=null;this.i=new Ma(this.ya);gb(this.i,function(c){b.log(c)});this.hc="";this.Sd=!1;this.da=new Ib(a,{ba:this.ba});this.da.state={bh:new Jb};this.M="";this.F=this.b=null;this.La=[];this.xa=-1;this.Sf=this.Ld=!1;this.o=null;this.da.Ra=function(){null!==b.o&&(b.o=null,Kb(b))};this.l=null;this.yb=[];this.He=this.gb=null}var Gb=!1;
Fb.prototype.translate=function(a){return this.g.translate(a)};function Lb(a,b){a.re=b?new Mb(b):null}function Nb(a,b){a.Cf=b?new Mb(b):null}
Fb.prototype.fb=function(a,b){function c(){0<=a.indexOf("vpl")&&Ob(d.da);0<=a.indexOf("src")&&Ob(d.I.Ga);0<=a.indexOf("sim")&&Ob(d.b)}var d=this;b&&(b.fa||b.Qf)&&(this.i.fa=!0,this.I.fa=!0,Pb(this.I,!1));if(1===a.length&&b&&b.Id&&1<this.Aa.length){if(0<=this.Aa.indexOf(a[0]))return;var e=this.Aa.slice();e[this.Aa[0]===b.Id?1:0]=a[0];a=e}else b&&b.Nd?0>this.Aa.indexOf(a[0])&&(a=this.Aa.concat(a)):1===a.length&&b&&b.Te&&1<this.Aa.length&&0<=this.Aa.indexOf(a[0])?(this.Aa.splice(this.Aa.indexOf(a[0]),
1),a=this.Aa):1===a.length&&b&&b.toggle&&(0<=this.Aa.indexOf(a[0])?(this.Aa.splice(this.Aa.indexOf(a[0]),1),a=this.Aa):a=this.Aa.concat(a));this.Aa=a;null!=this.F&&this.b.zc();this.da.zc();null!=this.I&&(document.getElementById("src-editor").style.display=0<=a.indexOf("src")?"block":"none",this.I.Ga.zc());0<=a.indexOf("vpl")&&this.da.show();0<=a.indexOf("src")&&this.I.Ga.show();null!=this.F&&0<=a.indexOf("sim")&&this.b.show();Qb(this,window.innerWidth<window.innerHeight);for(e=0;e<a.length;e++)switch(a[e]){case "vpl":this.da.na=
function(){if(!d.i.fa){d.i.code={};var f=d.i;if(0!==f.i.length&&f.i[f.i.length-1].Ub())for(;1<f.i.length&&f.i[f.i.length-2].Ub();)f.i.splice(-2,1);else f.i.push(new za);if(d.I){f=d.I;var g=d.i.$b(d.i.Db);if(f.fd){var h=f.be(f.language,g);null!==h&&(Rb(f,h,!0),f.ec.wb.readOnly=!0,f.fd=g)}else Rb(f,g)}d.log()}Kb(d)};break;case "src":Pb(this.I,!(b&&(b.fa||b.Qf)));this.I.focus();this.I.resize(window.innerWidth,window.innerHeight);break;case "sim":this.b.na=function(){Sb(d)}}b&&(b.Te||b.Nd)&&Tb(d);this.da&&
(this.da.qb=c);this.I&&this.I.Ga&&(this.I.Ga.qb=c);this.b&&(this.b.qb=c);0<=a.indexOf("vpl")&&(this.da.na(),this.da.qb?this.da.qb():Ob(this.da));0<=a.indexOf("src")&&(Ub(this),this.I.Ga.qb?this.I.Ga.qb():Ob(this.I.Ga));0<=a.indexOf("sim")&&(this.start(!1),this.b.na(),this.b.qb?this.b.qb():Ob(this.b))};Fb.prototype.setView=Fb.prototype.fb;
function Qb(a,b){for(var c=a.Aa.map(function(h){return this.Xb[h]},a),d=c.reduce(function(h,k){return h+k},0),e=0,f=0;f<a.Aa.length;f++){var g=b?{Y:0,pa:1,Z:e,la:e+c[f]/d}:{Y:e,pa:e+c[f]/d,Z:0,la:1};e+=c[f]/d;switch(a.Aa[f]){case "vpl":Vb(a.da,g);break;case "src":Vb(a.I.Ga,g);break;case "sim":Vb(a.b,g)}}}
function Tb(a){var b=a.da.b.parentElement.getBoundingClientRect(),c=b.width;b=window.innerHeight-b.top;Qb(a,c<b);window.vplDisableResize&&(b=a.da.b.getBoundingClientRect(),c=b.width,b=b.height);a.da.resize(c,b);a.I&&a.I.resize(c,b);a.F&&a.b.resize(c,b);a.Aa.forEach(function(d){switch(d){case "vpl":Kb(this);break;case "src":Ob(this.I.Ga);break;case "sim":this.F&&Sb(this)}},a);a.re&&Wb(a.re)}function Xb(a){if(0<=a.xa){var b=ya("!stop"),c=a.i.Db;(b=b&&b.Jb[c])&&a.La[a.xa].eb.Zb(b(null).ia,c)}}
function Yb(a){return!a.i.fa&&a.La[a.xa].eb.isEnabled(a.i.Db)}function Zb(a,b){a.yb.push(b)}
Fb.prototype.log=function(a){if(null==a){$b(this);a={type:"vpl-changed",data:{filename:this.i.filename,nrules:this.i.i.reduce(function(c,d){return 0<d.U.length+d.actions.length?c+1:c},0),nblocks:this.i.i.reduce(function(c,d){return c+d.U.length+d.actions.length},0),error:this.hc&&!this.Sd?this.hc:null,warning:this.hc&&this.Sd?this.hc:null,robot:0<=this.xa?this.La[this.xa].eb.isConnected()&&this.La[this.xa].eb.Jd():null}};var b=JSON.stringify(a);if(b===this.gb)return;this.gb=b}this.yb.forEach(function(c){try{c(a)}catch(d){}})};function ac(a){function b(e){function f(F){for(var G=0;G<w.length;G++)if(w[G].uri&&a.vb[q].Bf(F,bc(w[G].uri).id))return!0;return!1}var g=e.name;if("!"===g[0])return 0;var h=0;/^\w/.test(g)||(c+='Bad block name "'+g+'"\n',h++);var k=e.defaultParameters,l=e.typicalParameters,z=e.buttons,m=e.radiobuttons,x=e.sliders,n=e.rotating,r=e.diffwheelmotion,v=e.score,p=e.otherParameters?parseInt(e.otherParameters,10):0,w=e.draw;if(w){var q=null;for(e=0;e<w.length;e++)if(w[e].uri)if(null==q){q=bc(w[e].uri).Xc;
var t=a.vb[q]}else{var u=bc(w[e].uri);u.Xc!==q?(c+='In block "'+g+'", multiple svg\n',h++):t.lc(u.id)||(c+='In block "'+g+'", uri "'+w[e].uri+'" not found\n',h++)}}z&&z.forEach(function(F){t.lc(F.id)?f(F.id)||(c+='In block "'+g+'", button id "'+F.id+'" not displayed\n',h++):(c+='In block "'+g+'", button id "'+F.id+'" not found\n',h++);void 0==F.val?(c+='In block "'+g+'", missing property "val"\n',h++):void 0==F.st?(c+='In block "'+g+'", missing property "st"\n',h++):F.val.length!==F.st.length&&(c+=
'In block "'+g+'", properties "val" and "st" have different lengths\n',h++)});m&&m.forEach(function(F){t.lc(F.id)?f(F.id)?void 0==F.val?(c+='In block "'+g+'", missing property "val"\n',h++):F.val instanceof Array?(c+='In block "'+g+'", illegal array in property "val"\n',h++):void 0==F.st?(c+='In block "'+g+'", missing property "st"\n',h++):2!==F.st.length&&(c+='In block "'+g+'", property "st" must have length 2\n',h++):(c+='In block "'+g+'", radiobutton id "'+F.id+'" not displayed\n',h++):(c+='In block "'+
g+'", radiobutton id "'+F.id+'" not found\n',h++)});x&&x.forEach(function(F){t.lc(F.id)?f(F.id)||(c+='In block "'+g+'", slider id "'+F.id+'" not displayed\n',h++):(c+='In block "'+g+'", slider id "'+F.id+'" not found\n',h++);t.lc(F.thumbId)?f(F.thumbId)||(c+='In block "'+g+'", slider thumbId "'+F.thumbId+'" not displayed\n',h++):(c+='In block "'+g+'", slider thumbId "'+F.thumbId+'" not found\n',h++);void 0==F.min&&(c+='In block "'+g+'", slider min undefined\n',h++);void 0==F.max&&(c+='In block "'+
g+'", slider max undefined\n',h++);F.lowerPartId&&!t.lc(F.lowerPartId)&&(c+='In block "'+g+'", slider lowerPartId "'+F.lowerPartId+'" not found\n',h++);if(F.snap&&(F=F.snap,F instanceof Array))for(var G=0;G<F.length;G++)"string"===typeof F[G]?/^`.+`$/.test(F[G])||(c+='In block "'+g+'", invalid slider snap expression\n',h++):"number"!==typeof F[G]&&(c+='In block "'+g+'", slider snap must be a number or a string\n',h++)});n&&n.forEach(function(F){var G=F.id,D=F.centerId;F=F.thumbId;t.lc(G)?f(G)||(c+=
'In block "'+g+'", rotating id "'+G+'" not displayed\n',h++):(c+='In block "'+g+'", rotating id "'+G+'" not found\n',h++);t.lc(D)||(c+='In block "'+g+'", rotating centerId "'+D+'" not found\n',h++);t.lc(F)?f(F)||(c+='In block "'+g+'", rotating thumbId "'+F+'" not displayed\n',h++):(c+='In block "'+g+'", rotating thumbId "'+F+'" not found\n',h++);t.Bf(F,G)||(c+='In block "'+g+'", rotating thumbId "'+F+'" not a descendent of id "'+G+'"\n',h++)});r&&(t.lc(r.id)?f(r.id)||(c+='In block "'+g+'", diffwheelmotion id "'+
r.id+'" not displayed\n',h++):(c+='In block "'+g+'", diffwheelmotion id "'+r.id+'" not found\n',h++));v&&(t.lc(v.id)?f(v.id)||(c+='In block "'+g+'", score id "'+v.id+'" not displayed\n',h++):(c+='In block "'+g+'", score id "'+v.id+'" not found\n',h++),"number"!==typeof v.numHeights||v.numHeights!==Math.round(v.numHeights)||0>=v.numHeights)&&(c+='In block "'+g+'", score numHeights must be a strictly positive integer\n',h++);(z||m||x||n||v||0<p)&&!k&&(c+='In block "'+g+'", missing defaultParameters\n',
h++);k&&(r=0,z&&(r+=z.length),m&&(r+=1),x&&(r+=x.length),n&&(r+=n.length),v&&(r+=2*Math.floor((k.length-r)/2)),r+=p,r!==k.length?(c+='In block "'+g+'", defaultParameters.length='+k.length+", needs "+r+" parameters\n",h++):l&&l.length!=r&&(c+='In block "'+g+'", typicalParameters.length='+l.length+", needs "+r+" parameters\n",h++));return h}var c="",d=0;a.blocks&&a.blocks.forEach(function(e){d+=b(e)});0<d&&(c+=d+" error"+(1<d?"s":"")+"\n");return c||null};function cc(a){a.L.add("vpl:close",{action:function(b){b.fb(["vpl"],{Te:!0})},object:a,T:function(b){return 1<b.Aa.length&&0<=b.Aa.indexOf("vpl")}});a.L.add("vpl:about",{action:function(b){b.re.show()},object:a,T:function(b){return null!=b.re}});a.L.add("vpl:help",{action:function(b){b.Cf.show()},object:a,T:function(b){return null!=b.Cf}});a.L.add("vpl:readonly",{isEnabled:function(){return!1},object:a,T:function(b){return b.i.readOnly||b.i.fa}});a.L.add("vpl:suspend",{action:function(b){b.qc=!b.qc;
b.qc?(Yb(b)&&(Xb(b),b.i.Bc=!1),b.Rd.show()):b.Rd.zc()},Ta:function(b){return b.qc},object:a,T:function(b){return!b.i.Ob&&null!=b.Rd}});a.L.add("vpl:new",{action:function(b){Wa(b.i);b.ze&&dc(b,b.ze)},isEnabled:function(b){return!b.i.fa&&!b.i.readOnly&&!b.i.Ub()},object:a,T:function(b){return!b.i.readOnly}});a.L.add("vpl:save",{action:function(b,c){c?(b=ec(b,b.ba),fc(b,"vpl-program.html","text/html")):(c=cb(b.i,{Yc:!0,ad:!0}),fc(c,b.i.filename||"program.vpl3","application/x-vpl3"))},isEnabled:function(b){return!b.i.fa&&
!b.i.Ub()},object:a,T:function(b){return!b.i.readOnly}});a.L.add("vpl:load",{action:function(b){b.Be.show("Open program file",".aesl,.json,.vpl3,.vpl3ui",function(c){gc(b,c)})},isEnabled:function(b){return!b.i.fa&&!b.i.readOnly},object:a,T:function(b){return!b.i.readOnly}});a.L.add("vpl:upload",{action:function(b){var c=cb(b.i,{Yc:!1,ad:!0});window.vplUpload(b.i.filename,c)},isEnabled:function(b){return!b.i.fa&&!b.i.readOnly&&!b.i.Ub()},object:a,T:function(b){return null!=window.vplUpload&&!b.i.readOnly}});
a.L.add("vpl:exportToHTML",{action:function(b,c){c?(b=hc(b,b.ba),fc(b,"vpl-ui.html","text/html")):(b=ec(b,b.ba),fc(b,"vpl-program.html","text/html"))},isEnabled:function(b){return!b.i.fa&&!b.i.Ub()},object:a});a.L.add("vpl:text",{action:function(b){b.Ld?b.fb(["src"],{Nd:!0}):b.fb(["src"],{Id:"vpl"})},isEnabled:function(b){return!b.i.fa},mb:function(b,c){if(c.data instanceof sa&&c.data.Bb){if(c=eb(b.i.Db,c.data))b.fb(["src"]),b.I.kf(c.Fd,c.end)}else c.data instanceof za&&(c=eb(b.i.Db,c.data))&&(b.fb(["src"]),
b.I.kf(c.Fd,c.end))},lb:function(b,c){return c.data instanceof sa&&null!=c.data.Bb||c.data instanceof za},object:a,T:function(b){return b.I&&0>b.Aa.indexOf("src")}});a.L.add("vpl:text-toggle",{action:function(b){b.fb(["src"],{toggle:!0})},isEnabled:function(b){return!b.i.fa},Ta:function(b){return 0<=b.Aa.indexOf("src")},object:a,cb:[{selected:!1},{selected:!0}]});a.L.add("vpl:advanced",{action:function(b){$a(b.i,"b"===b.i.mode?"a":"b")},isEnabled:function(b){return!b.i.fa&&!b.i.readOnly},Ta:function(b){return"a"===
b.i.mode},object:a,T:function(b){return!b.i.readOnly},cb:[{selected:!1},{selected:!0}]});a.L.add("vpl:undo",{action:function(b){b.i.Pf(function(){Kb(b)})},isEnabled:function(b){return!b.i.fa&&0<b.i.Qc.gc.length},object:a,T:function(b){return!b.i.readOnly}});a.L.add("vpl:redo",{action:function(b){b.i.If(function(){Kb(b)})},isEnabled:function(b){return!b.i.fa&&0<b.i.Qc.bd.length},object:a,T:function(b){return!b.i.readOnly}});a.L.add("vpl:run",{action:function(b){var c=b.i.$b(b.i.Db);b.La[b.xa].eb.Zb(c,
b.i.Db);b.i.Bc=!0;b.i.Ff=!1},isEnabled:function(b){if(b.i.fa||!b.La[b.xa].eb.isEnabled(b.i.Db))return!1;b=b.i.getError();return null==b||b.Kb},Ta:function(b){return b.i.Bc},getState:function(b){if(b.i.Ub())return"empty";if(b.i.Bc)return"running";var c=b.i.getError();return c&&!c.Kb?"error":b.i.Ff?"canLoad":"canReload"},mb:function(b,c){c.data instanceof sa?c.data.Bb?(c=ua[b.i.Db].g(b.i,[c.data]),b.La[b.xa].eb.Zb(c,b.i.Db)):b.da.xb=ic(b.da,c):c.data instanceof za&&(c=ua[b.i.Db].g(b.i,c.data.actions),
b.La[b.xa].eb.Zb(c,b.i.Db))},lb:function(b,c){if(b=b.La[b.xa].eb.isEnabled(b.i.Db)&&c.data instanceof za)a:{b=c.data;for(var d=0;d<b.U.length;d++)if("a"===b.U[d].V.type){b=!0;break a}for(d=0;d<b.actions.length;d++)if("a"===b.actions[d].V.type){b=!0;break a}b=!1}return b||c.data instanceof sa&&null!=c.data.Bb&&"a"===c.data.V.type},object:a,T:function(b){return 0<=b.xa},cb:[{selected:!1},{selected:!0},{state:"empty"},{state:"running"},{state:"error"},{state:"canLoad"},{state:"canReload"}]});a.L.add("vpl:stop",
{action:function(b){Xb(b);b.i.Bc=!1},isEnabled:function(b){return Yb(b)},object:a,T:function(b){return 0<=b.xa}});a.L.add("vpl:debug",{action:function(){},Ta:function(){return!1},object:a,T:function(){return!1},cb:[{selected:!1},{selected:!0}]});a.L.add("vpl:connected",{isEnabled:function(){return!1},Ta:function(b){return!b.i.fa&&b.La[b.xa].eb.isConnected()},getState:function(b){return b.He?"monitored":!1===b.He?"nonmonitored":""},object:a,T:function(b){return 0<=b.xa},cb:[{selected:!1},{selected:!0},
{selected:!1,state:"monitored"},{selected:!0,state:"monitored"},{selected:!1,state:"nonmonitored"},{selected:!0,state:"nonmonitored"}]});a.L.add("vpl:robot",{action:function(b){b.xa=(b.xa+1)%b.La.length},getState:function(b){return b.La[b.xa].name},object:a,T:function(b){return 1<b.La.length}});a.L.add("vpl:sim",{action:function(b){b.Ld?b.fb(["sim"],{Nd:!0}):b.fb(["sim"],{Id:"vpl"})},isEnabled:function(b){return!b.i.fa},object:a,T:function(b){return 0<=b.xa&&null!=b.F&&0>b.Aa.indexOf("sim")}});a.L.add("vpl:duplicate",
{isEnabled:function(b){return!b.i.fa},mb:function(b,c){var d=b.i.i.indexOf(c.data);0<=d&&(b.i.Cb(),b.i.i.splice(d+1,0,c.data.pb()),b.da.na&&b.da.na(),b.log())},lb:function(b,c){return c.data instanceof za&&!c.data.Ub()},object:a,T:function(b){return!b.i.readOnly}});a.L.add("vpl:disable",{isEnabled:function(b){return!b.i.fa},mb:function(b,c){c.data instanceof sa?(b.i.Cb(),c.data.disabled=!c.data.disabled,b.da.na&&b.da.na(),b.log()):c.data instanceof za&&(b.i.Cb(),c=c.data,c.disabled=!c.disabled,c.disabled&&
(c.error=null),b.da.na&&b.da.na(),b.log())},lb:function(b,c){return c.data instanceof za?!c.data.Ub():c.data instanceof sa&&null!==c.data.Bb},object:a,T:function(b){return!b.i.readOnly}});a.L.add("vpl:lock",{isEnabled:function(b){return!b.i.fa},mb:function(b,c){c.data instanceof sa?(b.i.Cb(),c.data.locked=!c.data.locked,b.da.na&&b.da.na(),b.log()):c.data instanceof za&&(b.i.Cb(),c.data.locked=!c.data.locked,b.da.na&&b.da.na(),b.log())},lb:function(b,c){return c.data instanceof za?!c.data.Ub():c.data instanceof
sa&&null!==c.data.Bb},object:a,T:function(b){return b.i.hg&&b.i.Ob&&!b.i.readOnly}});a.L.add("vpl:trashcan",{isEnabled:function(b){return!b.i.fa},mb:function(b,c){c.data instanceof sa?null!==c.data.Bb&&(b.i.Cb(),Ca(c.data.Bb,c.data.ie),b.da.na&&b.da.na(),b.log()):c.data instanceof za&&(c=b.i.i.indexOf(c.data),0<=c&&(b.i.Cb(),b.i.i.splice(c,1),b.da.na&&b.da.na(),b.log()))},lb:function(b,c){return c.data instanceof sa?null!==c.data.Bb&&!c.data.locked:c.data instanceof za&&(!c.data.Ub()||b.i.i.indexOf(c.data)+
1<b.i.i.length)&&!c.data.locked},object:a,T:function(b){return!b.i.readOnly}});a.L.add("vpl:message-error",{isEnabled:function(){return!1},getState:function(b){return b.hc},object:a,T:function(b){return b.hc&&!b.Sd}});a.L.add("vpl:message-warning",{isEnabled:function(){return!1},getState:function(b){return b.hc},object:a,T:function(b){return b.hc&&b.Sd}});a.L.add("vpl:message-empty",{isEnabled:function(){return!1},object:a,T:function(b){return!b.hc}});a.L.add("vpl:filename",{isEnabled:function(){return!1},
getState:function(b){return(b.i.filename||"")+(b.username?"\n"+b.username:"")},object:a,T:function(b){return b.i.filename||b.username?!0:!1}});a.L.add("vpl:teacher",{action:function(b){b.i.ya.Xa=!b.i.ya.Xa},isEnabled:function(b){return!b.i.fa&&!b.i.readOnly},Ta:function(b){return b.i.ya.Xa},object:a,Mc:!0,T:function(b){return b.i.Ob&&!b.i.readOnly},cb:[{selected:!1},{selected:!0}]});a.L.add("vpl:teacher-reset",{action:function(b,c){c?(Ua(b.i.mode),b.i.xc=Oa,b.i.wc=Qa):(Sa(),Wa(b.i),b.i.je())},isEnabled:function(b){return!b.i.fa},
object:a,Mc:!0,T:function(b){return b.i.Ob&&b.i.ya.Xa&&!b.i.readOnly}});a.L.add("vpl:teacher-save",{action:function(b){b=cb(b.i,{Yc:!0,ad:!1});fc(b,"ui.vpl3ui","application/x-vpl3-ui")},isEnabled:function(b){return!b.i.fa},object:a,Mc:!0,T:function(b){return b.i.Ob&&b.i.ya.Xa&&!b.i.readOnly}});a.L.add("vpl:teacher-setasnew",{action:function(b){var c=cb(b.i,{Yc:!0,ad:!1});b.ze=b.ze===c?null:c},Ta:function(b){return b.ze===cb(b.i,{Yc:!0,ad:!1})},object:a,Mc:!0,T:function(b){return b.i.Ob&&b.i.ya.Xa&&
!b.i.readOnly},cb:[{selected:!1},{selected:!0}]})};function jc(a){this.g=a;this.controls=[];this.b="";this.y=this.x=0}function kc(a,b,c,d,e,f,g){a.controls.push({H:b,action:d||null,mb:e||null,lb:f||null,id:g||"",Ec:c,x:0,y:0});a.b+="X"}
function lc(a,b,c,d){a.x=b.x;a.y=b.y;for(var e=a.b.replace(/^[s ]+/,"").replace(/[s ]+$/,"").replace(/ +/g," ").replace(/s +/g,"s").replace(/ +s/g,"s").replace(/s+/g,"s"),f=0,g=0,h=0,k=0,l=0;l<e.length;l++)switch(e[l]){case "X":f+=mc(c[a.controls[k].id]);k++;break;case " ":case "_":g++;break;case "s":case "S":h++}d=d?mc(d):0;var z=0;if(f>=b.width)d=0;else for(;;){z=(b.width-(f+d*g))/h;if(z>=d||!(0<d))break;d/=2}k=0;f=b.x;for(l=0;l<e.length;l++)switch(e[l]){case "X":g=a.controls[k];g.x=f+c[g.id].offsetLeft();
f+=mc(c[g.id]);g.y=b.y+c[g.id].offsetTop();k++;break;case " ":case "_":f+=d;break;case "s":case "S":f+=z}}function nc(a,b,c,d){oc(a.g,function(e){pc(b,e,a.x,a.y)});a.controls.forEach(function(e){qc(this.g,e.x,e.y,c[e.id],function(f,g,h){var k=Math.min(g.width/(e.Ec.pa-e.Ec.Y),g.height/(e.Ec.la-e.Ec.Z));f.save();f.translate(-e.Ec.Y,-e.Ec.Z);f.scale(k,k);e.H(f,g,h);f.restore()},e.action,e.mb,e.lb,d?function(){d(e.id)}:null,e.id)},a)};function rc(a,b,c,d,e,f,g,h,k,l){function z(p,w,q){b.save();q&&(b.scale(-1,1),b.translate(-2*p-c.c,0));b.fillStyle=k&&g?n.va:n.ra;b.fillRect(p,w,c.c,c.c);b.fillStyle=g?n.N:n.ca;b.beginPath();b.moveTo(p+.1*c.c,w+.6*c.c);b.lineTo(p+.4*c.c,w+.6*c.c);b.lineTo(p+.25*c.c,w+.34*c.c);b.closePath();b.fill();b.beginPath();b.arc(p+.5*c.c,w+.83*c.c,.4*c.c,4.2,5.6);b.strokeStyle=b.fillStyle;b.lineWidth=.08*c.c;b.stroke();b.restore()}function m(p,w,q){b.save();b.fillStyle=k?n.va:n.ra;b.fillRect(p,w,r.width,r.height);
b.translate(p+r.width/2,w+r.width/2);b.rotate(-q*Math.PI/2);b.translate(-p-r.width/2,-w-r.width/2);b.beginPath();b.moveTo(p+.3557*r.width,w+.25*r.width);b.lineTo(p+.3557*r.width,w+.75*r.width);b.lineTo(p+.7887*r.width,w+.5*r.width);b.closePath();b.strokeStyle=n.N;b.lineWidth=c.sa;b.stroke();b.restore()}function x(){b.beginPath();b.moveTo(0,.5*c.c);b.lineTo(.5*c.c,.5*c.c);b.lineTo(.5*c.c,-.25*c.c);b.bezierCurveTo(.3*c.c,-.5*c.c,.02*c.c,-.5*c.c,0,-.5*c.c);b.lineTo(0,-.5*c.c);b.bezierCurveTo(-.02*c.c,
-.5*c.c,-.3*c.c,-.5*c.c,-.5*c.c,-.25*c.c);b.lineTo(-.5*c.c,.5*c.c);b.closePath();b.fillStyle=g?n.N:n.ca;b.fill()}var n={ra:"navy",va:"#37f",Vc:"#06f",N:"white",ca:"#777",Gc:"#44a",wf:"#ddf",de:"#99a",te:"#a00",qf:"#d10",ue:"#d00",rf:"#f50",Hd:"#c66",xf:"#800"};n={ra:"white",va:"#ddd",Vc:"white",N:"#333",ca:"#999",Gc:"#ddd",wf:"#555",de:"#666",te:"#fcc",qf:"#fcc",ue:"#faa",rf:"#faa",Hd:"#866",xf:"#faa"};var r=sc(d,{tag:"button",W:e,id:a.replace(/:/g,"-")}),v={"vpl:close":function(){b.fillStyle=k&&
g?n.va:n.ra;b.fillRect(0,0,.5*c.c,c.c);b.beginPath();b.moveTo(.1*c.c,.1*c.c);b.lineTo(.4*c.c,.4*c.c);b.moveTo(.1*c.c,.4*c.c);b.lineTo(.4*c.c,.1*c.c);b.strokeStyle=g?n.N:n.ca;b.lineWidth=c.sa;b.stroke()},"vpl:about":function(){b.fillStyle=k&&g?n.va:n.ra;b.fillRect(0,0,c.c,c.c);b.textAlign="center";b.textBaseline="middle";b.font="bold "+Math.round(.7*c.c).toString(10)+"px times";b.fillStyle=g?n.N:n.ca;b.fillText("i",.5*c.c,.5*c.c)},"vpl:help":function(){b.fillStyle=k&&g?n.va:n.ra;b.fillRect(0,0,c.c,
c.c);b.textAlign="center";b.textBaseline="middle";b.font="bold "+Math.round(.7*c.c).toString(10)+"px times";b.fillStyle=g?n.N:n.ca;b.fillText("?",.5*c.c,.5*c.c)},"vpl:readonly":function(){var p=c.c;b.save();b.fillStyle=n.de;b.strokeStyle=n.de;b.lineWidth=c.sa;b.translate(.5*p,.7*p);b.save();b.rotate(.6);b.beginPath();b.moveTo(-.015/.22*p,.07*p);b.lineTo(0,.22*p);b.lineTo(.015/.22*p,.07*p);b.fill();b.beginPath();b.moveTo(-.1*p,-.4*p);b.lineTo(-.1*p,0);b.lineTo(0,.22*p);b.lineTo(.1*p,0);b.lineTo(.1*
p,-.4*p);b.restore();b.moveTo(-.2*p,-.4*p);b.lineTo(.4*p,.2*p);b.stroke();b.restore()},"vpl:new":function(){b.fillStyle=k&&g?n.va:n.ra;b.fillRect(0,0,c.c,c.c);b.beginPath();b.moveTo(.25*c.c,.2*c.c);b.lineTo(.25*c.c,.8*c.c);b.lineTo(.75*c.c,.8*c.c);b.lineTo(.75*c.c,.3*c.c);b.lineTo(.65*c.c,.2*c.c);b.closePath();b.moveTo(.65*c.c,.2*c.c);b.lineTo(.65*c.c,.3*c.c);b.lineTo(.75*c.c,.3*c.c);b.strokeStyle=g?n.N:n.ca;b.lineWidth=c.sa;b.stroke()},"vpl:save":function(){b.fillStyle=k&&g?n.va:n.ra;b.fillRect(0,
0,c.c,c.c);b.beginPath();b.moveTo(.25*c.c,.2*c.c);b.lineTo(.25*c.c,.7*c.c);b.lineTo(.67*c.c,.7*c.c);b.lineTo(.67*c.c,.27*c.c);b.lineTo(.6*c.c,.2*c.c);b.closePath();b.moveTo(.6*c.c,.2*c.c);b.lineTo(.6*c.c,.27*c.c);b.lineTo(.67*c.c,.27*c.c);b.strokeStyle=g?n.N:n.ca;b.lineWidth=c.sa;b.stroke();b.lineWidth=2*c.sa;b.beginPath();b.moveTo(.8*c.c,.5*c.c);b.lineTo(.8*c.c,.8*c.c);b.moveTo(.7*c.c,.7*c.c);b.lineTo(.8*c.c,.8*c.c);b.lineTo(.9*c.c,.7*c.c);b.stroke()},"vpl:exportToHTML":function(){b.fillStyle=k&&
g?n.va:n.ra;b.fillRect(0,0,c.c,c.c);b.strokeStyle=g?n.N:n.ca;b.lineWidth=2*c.sa;b.beginPath();b.moveTo(.8*c.c,.2*c.c);b.lineTo(.8*c.c,.5*c.c);b.moveTo(.7*c.c,.4*c.c);b.lineTo(.8*c.c,.5*c.c);b.lineTo(.9*c.c,.4*c.c);b.textAlign="center";b.textBaseline="middle";b.font="bold "+Math.round(.3*c.c).toString(10)+"px sans-serif";b.fillStyle=g?n.N:n.ca;b.fillText("HTML",.5*c.c,.7*c.c);b.stroke()},"vpl:load":function(){b.fillStyle=k&&g?n.va:n.ra;b.fillRect(0,0,c.c,c.c);b.beginPath();b.moveTo(.25*c.c,.2*c.c);
b.lineTo(.25*c.c,.7*c.c);b.lineTo(.67*c.c,.7*c.c);b.lineTo(.67*c.c,.27*c.c);b.lineTo(.6*c.c,.2*c.c);b.closePath();b.moveTo(.6*c.c,.2*c.c);b.lineTo(.6*c.c,.27*c.c);b.lineTo(.67*c.c,.27*c.c);b.strokeStyle=g?n.N:n.ca;b.lineWidth=c.sa;b.stroke();b.lineWidth=2*c.sa;b.beginPath();b.moveTo(.8*c.c,.55*c.c);b.lineTo(.8*c.c,.85*c.c);b.moveTo(.7*c.c,.65*c.c);b.lineTo(.8*c.c,.55*c.c);b.lineTo(.9*c.c,.65*c.c);b.stroke()},"vpl:upload":function(){b.fillStyle=k&&g?n.va:n.ra;b.fillRect(0,0,c.c,c.c);b.beginPath();
b.moveTo(.25*c.c,.3*c.c);b.lineTo(.25*c.c,.8*c.c);b.lineTo(.67*c.c,.8*c.c);b.lineTo(.67*c.c,.37*c.c);b.lineTo(.6*c.c,.3*c.c);b.closePath();b.moveTo(.6*c.c,.3*c.c);b.lineTo(.6*c.c,.37*c.c);b.lineTo(.67*c.c,.37*c.c);b.strokeStyle=g?n.N:n.ca;b.lineWidth=c.sa;b.stroke();b.lineWidth=2*c.sa;b.beginPath();b.moveTo(.8*c.c,.5*c.c);b.lineTo(.8*c.c,.2*c.c);b.moveTo(.7*c.c,.3*c.c);b.lineTo(.8*c.c,.2*c.c);b.lineTo(.9*c.c,.3*c.c);b.stroke()},"vpl:text":function(){b.fillStyle=k&&g?n.va:n.ra;b.fillRect(0,0,c.c,c.c);
b.beginPath();b.moveTo(.25*c.c,.2*c.c);b.lineTo(.25*c.c,.8*c.c);b.lineTo(.75*c.c,.8*c.c);b.lineTo(.75*c.c,.3*c.c);b.lineTo(.65*c.c,.2*c.c);b.closePath();b.moveTo(.65*c.c,.2*c.c);b.lineTo(.65*c.c,.3*c.c);b.lineTo(.75*c.c,.3*c.c);for(var p=.2;.6>p;p+=.1)b.moveTo(.3*c.c,c.c*(.2+p)),b.lineTo(.7*c.c,c.c*(.2+p));b.strokeStyle=g?n.N:n.ca;b.lineWidth=c.sa;b.stroke()},"vpl:text-toggle":function(){b.fillStyle=k&&g?n.va:n.ra;b.fillRect(0,0,c.c,c.c);b.beginPath();b.moveTo(.28*c.c,.2*c.c);b.lineTo(.28*c.c,.7*
c.c);b.lineTo(.7*c.c,.7*c.c);b.lineTo(.7*c.c,.27*c.c);b.lineTo(.63*c.c,.2*c.c);b.closePath();b.moveTo(.63*c.c,.2*c.c);b.lineTo(.63*c.c,.27*c.c);b.lineTo(.7*c.c,.27*c.c);for(var p=.1;.5>p;p+=.1)b.moveTo(.33*c.c,c.c*(.2+p)),b.lineTo(.63*c.c,c.c*(.2+p));b.strokeStyle=g?n.N:n.ca;b.lineWidth=c.sa;b.stroke();b.fillStyle=g?h||k?n.N:n.Gc:n.ca;b.fillRect(.1*c.c,.8*c.c,.8*c.c,.1*c.c)},"vpl:advanced":function(){b.fillStyle=k&&g?n.va:h?n.Vc:n.ra;b.fillRect(0,0,c.c,c.c);b.fillStyle=g?n.N:n.ca;for(var p=0;4>p;p++)for(var w=
0;5>w;w++)b.fillRect(.1*c.c*(1+p)+(2>p?0:.43*c.c),.1*c.c*(2+w),.07*c.c,.07*c.c);b.fillStyle=g?h||k?n.N:n.Gc:n.ca;b.fillRect(.1*c.c,.8*c.c,.8*c.c,.1*c.c)},"vpl:undo":function(){z(0,0,!1)},"vpl:redo":function(){z(0,0,!0)},"vpl:run":function(){b.fillStyle=k&&g?n.va:n.ra;b.fillRect(0,0,c.c,c.c);b.beginPath();b.moveTo(.3*c.c,.25*c.c);b.lineTo(.3*c.c,.75*c.c);b.lineTo(.8*c.c,.5*c.c);b.closePath();b.fillStyle=g?n.N:n.ca;b.fill();b.fillStyle=g?h||k?n.N:n.Gc:n.ca;b.fillRect(.1*c.c,.8*c.c,.8*c.c,.1*c.c)},"vpl:stop":function(){b.fillStyle=
k&&g?n.va:n.ra;b.fillRect(0,0,c.c,c.c);b.fillStyle=g?n.N:n.ca;b.fillRect(.28*c.c,.28*c.c,.44*c.c,.44*c.c)},"vpl:debug":function(){b.fillStyle=k&&g?n.va:n.ra;b.fillRect(0,0,c.c,c.c);b.strokeStyle=g?n.N:n.ca;b.lineWidth=c.sa;b.save();b.translate(.5*c.c,.42*c.c);b.scale(.0085*c.c,.012*c.c);b.beginPath();b.arc(0,0,20,0,2*Math.PI);b.moveTo(-13,-10);b.bezierCurveTo(0,-5,0,-5,13,-10);b.moveTo(0,-5);b.lineTo(0,20);b.moveTo(-18,-5);b.lineTo(-30,-10);b.moveTo(-18,2);b.lineTo(-32,6);b.moveTo(-15,10);b.lineTo(-26,
18);b.moveTo(18,-5);b.lineTo(30,-10);b.moveTo(18,2);b.lineTo(32,6);b.moveTo(15,10);b.lineTo(26,18);b.restore();b.stroke();b.fillStyle=g?h||k?n.N:n.Gc:n.ca;b.fillRect(.1*c.c,.8*c.c,.8*c.c,.1*c.c)},"vpl:connected":function(){function p(w,q){var t=.08*c.c;b.save();b.fillStyle=g?n.va:n.ra;b.fillRect(w-t,q-t,2*t,2*t);b.beginPath();b.moveTo(w-t,q-t);b.lineTo(w+t,q+t);b.moveTo(w+t,q-t);b.lineTo(w-t,q+t);b.stroke();b.restore()}b.translate(0,.1*c.c);b.save();b.translate(.8*c.c,.2*c.c);b.scale(.35,.35);x();
b.restore();b.fillStyle=g?n.N:n.ca;b.strokeStyle=g?n.N:n.ca;b.lineWidth=1.5*c.sa;l&&b.strokeRect(0,.05*c.c,.3*c.c,.3*c.c);b.strokeRect(.3*c.c,.55*c.c,.4*c.c,.3*c.c);b.lineWidth=c.sa;b.beginPath();b.moveTo(.7*c.c,.7*c.c);b.bezierCurveTo(.9*c.c,.7*c.c,.9*c.c,.7*c.c,.85*c.c,.35*c.c);l&&(b.moveTo(.3*c.c,.7*c.c),b.bezierCurveTo(.1*c.c,.7*c.c,.1*c.c,.7*c.c,.15*c.c,.35*c.c));b.stroke();h||p(.86*c.c,.55*c.c);"nonmonitored"===l&&p(.14*c.c,.55*c.c)},"vpl:robot":function(){b.fillStyle=k?n.va:n.ra;b.fillRect(0,
0,c.c,c.c);switch(l){case "thymio":b.save();b.translate(c.c/2,.35*c.c);b.scale(.3,.3);b.rotate(.2);x();b.restore();break;case "thymio-tdm":b.save();b.translate(c.c/2,.35*c.c);b.scale(.3,.3);b.rotate(.2);x();b.restore();b.fillStyle=n.N;b.fillRect(.4*c.c,.65*c.c,.2*c.c,.2*c.c);break;case "sim":b.save(),b.translate(c.c/2,.35*c.c),b.scale(.3,.3),b.rotate(.2),x(),b.beginPath(),b.strokeStyle=n.N,b.lineWidth=c.sa/.3,b.strokeRect(-c.c,-.8*c.c,2*c.c,1.6*c.c),b.restore()}b.beginPath();b.moveTo(.2*c.c,.75*c.c);
b.lineTo(.5*c.c,.75*c.c);b.lineTo(.5*c.c,c.c*("sim"===l?.6:.3));b.strokeStyle=n.N;b.lineWidth=c.sa;b.stroke()},"vpl:sim":function(){b.fillStyle=k&&g?n.va:n.ra;b.fillRect(0,0,c.c,c.c);b.save();b.translate(c.c/2,.35*c.c);b.scale(.4,.4);b.rotate(.2);x();b.beginPath();b.arc(c.c,.5*c.c,1.4*c.c,-3.2,-3.8,!0);b.strokeStyle=k&&g?n.wf:n.de;b.lineWidth=.2*c.c;b.stroke();b.beginPath();b.arc(c.c,.5*c.c,.6*c.c,-3.3,-3.8,!0);b.stroke();b.restore()},"vpl:message-empty":function(){},"vpl:message-error":function(){if(l){b.fillStyle=
r.color;b.font=tc(r);b.textAlign="center";b.textBaseline="middle";var p=f.translate(l);b.fillText(p,r.width/2,r.height/2)}},"vpl:filename":function(){if(l){b.beginPath();var p=3*c.c;b.rect(0,0,p,c.c);b.clip();b.fillStyle=r.color;b.font=tc(r);b.textAlign="center";b.textBaseline="middle";var w=l.trim().split("\n").slice(0,2).map(function(q){q=q.slice(0,80);if(1<q.length&&b.measureText(q).width>p){for(;1<q.length&&b.measureText(q+"\u2026").width>p;)q=q.slice(0,-1);q+="\u2026"}return q});1<w.length?(b.fillText(w[0],
r.width/2,.25*r.height),b.fillText(w[1],r.width/2,.75*r.height)):b.fillText(w[0],r.width/2,r.height/2)}},"vpl:duplicate":function(){b.fillStyle=k&&g?n.va:n.ra;b.fillRect(0,0,c.c,c.c);b.strokeStyle=g?n.N:n.ca;b.lineWidth=c.sa;b.strokeRect(.3*c.c,.3*c.c,.4*c.c,.15*c.c);b.strokeRect(.3*c.c,.55*c.c,.4*c.c,.15*c.c)},"vpl:disable":function(){b.fillStyle=k&&g?n.va:n.ra;b.fillRect(0,0,c.c,c.c);b.strokeStyle=g?n.N:n.ca;b.lineWidth=c.sa;b.strokeRect(.3*c.c,.3*c.c,.4*c.c,.4*c.c);b.beginPath();b.moveTo(.2*c.c,
.6*c.c);b.lineTo(.8*c.c,.4*c.c);b.stroke()},"vpl:lock":function(){b.fillStyle=k&&g?n.va:n.ra;b.fillRect(0,0,c.c,c.c);b.strokeStyle=g?n.N:n.ca;b.fillStyle=g?n.N:n.ca;b.lineWidth=c.sa;b.strokeRect(.3*c.c,.3*c.c,.4*c.c,.4*c.c);uc(b,.5*c.c,.52*c.c,.04*c.c,n.N)},"vpl:trashcan":function(){b.fillStyle=k&&g?n.va:n.ra;b.fillRect(0,0,c.c,c.c);b.beginPath();b.moveTo(.25*c.c,.2*c.c);b.lineTo(.32*c.c,.8*c.c);b.lineTo(.68*c.c,.8*c.c);b.lineTo(.75*c.c,.2*c.c);b.closePath();b.strokeStyle=g?n.N:n.ca;b.lineWidth=c.sa;
b.stroke()},"vpl:teacher-reset":function(){b.fillStyle=k&&g?n.ue:n.te;b.fillRect(0,0,c.c,c.c);b.beginPath();b.moveTo(.25*c.c,.2*c.c);b.lineTo(.25*c.c,.8*c.c);b.lineTo(.75*c.c,.8*c.c);b.lineTo(.75*c.c,.3*c.c);b.lineTo(.65*c.c,.2*c.c);b.closePath();b.moveTo(.65*c.c,.2*c.c);b.lineTo(.65*c.c,.3*c.c);b.lineTo(.75*c.c,.3*c.c);b.strokeStyle=g?n.N:n.Hd;b.lineWidth=c.sa;b.stroke();b.fillStyle=g?n.N:n.Hd;vc(b,.63*c.c,.7*c.c,.2*c.c)},"vpl:teacher-save":function(){b.fillStyle=k&&g?n.ue:n.te;b.fillRect(0,0,c.c,
c.c);b.strokeStyle=g?n.N:n.Hd;b.beginPath();b.moveTo(.25*c.c,.2*c.c);b.lineTo(.25*c.c,.7*c.c);b.lineTo(.67*c.c,.7*c.c);b.lineTo(.67*c.c,.27*c.c);b.lineTo(.6*c.c,.2*c.c);b.closePath();b.moveTo(.6*c.c,.2*c.c);b.lineTo(.6*c.c,.27*c.c);b.lineTo(.67*c.c,.27*c.c);b.lineWidth=c.sa;b.stroke();b.lineWidth=2*c.sa;b.beginPath();b.moveTo(.8*c.c,.5*c.c);b.lineTo(.8*c.c,.8*c.c);b.moveTo(.7*c.c,.7*c.c);b.lineTo(.8*c.c,.8*c.c);b.lineTo(.9*c.c,.7*c.c);b.stroke();b.fillStyle=g?n.N:n.Hd;vc(b,.46*c.c,.45*c.c,.2*c.c)},
"vpl:teacher-setasnew":function(){b.fillStyle=k&&g?h?n.rf:n.ue:h&&g?n.qf:n.te;b.fillRect(0,0,c.c,c.c);b.strokeStyle=g?n.N:n.Hd;b.beginPath();b.moveTo(.25*c.c,.2*c.c);b.lineTo(.25*c.c,.7*c.c);b.lineTo(.67*c.c,.7*c.c);b.lineTo(.67*c.c,.27*c.c);b.lineTo(.6*c.c,.2*c.c);b.closePath();b.moveTo(.6*c.c,.2*c.c);b.lineTo(.6*c.c,.27*c.c);b.lineTo(.67*c.c,.27*c.c);b.lineWidth=c.sa;b.stroke();b.lineWidth=2*c.sa;b.beginPath();b.moveTo(.8*c.c,.5*c.c);b.lineTo(.5*c.c,.5*c.c);b.moveTo(.6*c.c,.4*c.c);b.lineTo(.5*c.c,
.5*c.c);b.lineTo(.6*c.c,.6*c.c);b.stroke();b.fillStyle=g?h||k?n.N:n.xf:n.ca;b.fillRect(.1*c.c,.8*c.c,.8*c.c,.1*c.c)},"vpl:teacher":function(){b.fillStyle=k&&g?h?n.rf:n.ue:h&&g?n.qf:n.te;b.fillRect(0,0,c.c,c.c);b.fillStyle=g?n.N:n.Hd;vc(b,.5*c.c,.4*c.c,.27*c.c);b.fillStyle=g?h||k?n.N:n.xf:n.ca;b.fillRect(.1*c.c,.8*c.c,.8*c.c,.1*c.c)},"src:vpl":function(){b.save();b.fillStyle=k&&g?n.va:n.ra;b.fillRect(0,0,c.c,c.c);b.beginPath();b.moveTo(.25*c.c,.2*c.c);b.lineTo(.25*c.c,.8*c.c);b.lineTo(.75*c.c,.8*c.c);
b.lineTo(.75*c.c,.3*c.c);b.lineTo(.65*c.c,.2*c.c);b.closePath();b.moveTo(.65*c.c,.2*c.c);b.lineTo(.65*c.c,.3*c.c);b.lineTo(.75*c.c,.3*c.c);b.strokeStyle=g?n.N:n.ca;b.lineWidth=c.sa;b.stroke();b.fillStyle=k&&g?n.N:n.de;for(var p=.15;.6>p;p+=.15)b.fillRect(.3*c.c,c.c*(.2+p),.4*c.c,.1*c.c);b.restore()},"src:locked":function(){b.save();b.fillStyle=g?k?n.va:h?n.Vc:n.ra:n.ra;b.fillRect(0,0,c.c,c.c);b.strokeStyle=g?n.N:n.ca;b.lineWidth=c.sa;b.fillStyle=g?h?n.wf:n.de:n.ca;for(var p=.15;.6>p;p+=.15)b.fillRect(.15*
c.c,c.c*p,.4*c.c,.1*c.c);uc(b,.77*c.c,.36*c.c,.06*c.c,g?n.N:n.ca,!h);b.fillStyle=g?h||k?n.N:n.Gc:n.ca;b.fillRect(.1*c.c,.8*c.c,.8*c.c,.1*c.c);b.restore()},"src:language":function(){var p=c.c;b.save();b.fillStyle=g?k?n.va:n.ra:n.ra;b.fillRect(0,0,p,p);b.beginPath();for(var w=0;3>w;w++)b.moveTo(.2*p,p*(.2+.1*w)),b.lineTo(.5*p,p*(.2+.1*w));b.strokeStyle=g?n.N:n.ca;b.lineWidth=c.sa;b.stroke();for(w=0;3>w;w++){var q=2*(w+.25)/3*Math.PI;wc(b,.75*p,.3*p,.15*p,q-.3*Math.PI,q+.3*Math.PI,{Dd:!1,Uc:3*c.sa,style:g?
n.N:n.ca})}b.textAlign="center";b.textBaseline="middle";b.font="bold "+Math.round(p/3).toString(10)+"px sans-serif";b.fillStyle=g?n.N:n.ca;b.fillText({aseba:"Aa",l2:"l2",asm:"asm",js:"js",python:"Py"}[l],.5*p,.7*p);b.restore()},"src:disass":function(){var p=c.c;b.save();b.fillStyle=g&&k?n.va:h?n.Vc:n.ra;b.fillRect(0,0,p,p);b.beginPath();b.moveTo(.2*p,.2*p);b.lineTo(.3*p,.2*p);for(var w=0;5>w;w++)b.moveTo(.4*p,p*(.2+.1*w)),b.lineTo(.45*p,p*(.2+.1*w)),b.moveTo(.55*p,p*(.2+.1*w)),b.lineTo(.65*p,p*(.2+
.1*w));b.strokeStyle=g?n.N:n.ca;b.lineWidth=c.sa;b.stroke();b.fillStyle=g&&(h||k)?n.N:n.Gc;b.fillRect(.1*c.c,.8*c.c,.8*c.c,.1*c.c);b.restore()},"sim:restart":function(){b.save();b.fillStyle=k?n.va:n.ra;b.fillRect(0,0,r.width,r.height);var p=c.c;b.lineWidth=.05*p;wc(b,.5*p,.5*p,.25*p,1.56,0,{Dd:!1,Uc:.2*p,style:n.N});b.restore()},"sim:pause":function(){b.save();b.fillStyle=k?n.va:h?n.Vc:n.ra;b.fillRect(0,0,c.c,c.c);b.fillStyle=g?n.N:n.ca;b.fillRect(.28*c.c,.28*c.c,.15*c.c,.44*c.c);h?(b.beginPath(),
b.moveTo(.54*c.c,.28*c.c),b.lineTo(.62*c.c,.28*c.c),b.lineTo(.75*c.c,.5*c.c),b.lineTo(.62*c.c,.72*c.c),b.lineTo(.54*c.c,.72*c.c),b.fill()):b.fillRect(.57*c.c,.28*c.c,.15*c.c,.44*c.c);b.restore()},"sim:speedup":function(){b.save();b.fillStyle=k&&g?n.va:h?n.Vc:n.ra;b.fillRect(0,0,c.c,c.c);b.fillStyle=g?n.N:n.ca;b.beginPath();for(var p=0;2>p;p++)b.moveTo(c.c*(.3+.22*p),.25*c.c/2),b.lineTo(c.c*(.3+.22*p),.75*c.c/2),b.lineTo(c.c*(.5+.22*p),.5*c.c/2),b.closePath();b.fill();b.textAlign="center";b.textBaseline=
"middle";b.font="bold "+Math.round(c.c/3).toString(10)+"px sans-serif";b.fillText(1<=l?"\u00d7"+l.toString(10):"\u00f7"+Math.round(1/l).toString(10),.5*c.c,.7*c.c);b.restore()},"sim:noise":function(){b.save();b.fillStyle=k&&g?n.va:h?n.Vc:n.ra;b.fillRect(0,0,c.c,c.c);b.beginPath();var p=[.58,1.48,.96,.39,1.36,.09,-.75,-1.58,-.32,-1.36,-1.39,-.94,-1.1,-1.04,-.1,.93,1.22,.6,.89,.61];b.moveTo(.1*c.c,(.4+.1*p[0])*c.c);for(var w=1;w<p.length;w++)b.lineTo((.1+.8/(p.length-1)*w)*c.c,(.4+.1*p[w])*c.c);b.strokeStyle=
g?n.N:n.ca;b.lineWidth=c.sa;b.stroke();b.fillStyle=g?h||k?n.N:n.Gc:n.ca;b.fillRect(.1*c.c,.8*c.c,.8*c.c,.1*c.c);b.restore()},"sim:pen":function(){var p=c.c;b.save();b.fillStyle=k&&g?n.va:h?n.Vc:n.ra;b.fillRect(0,0,p,p);b.fillStyle=g?h||k?n.N:n.Gc:n.ca;b.fillRect(.1*p,.8*p,.8*p,.1*p);b.translate(.5*p,p*(.4+(h?.13:0)));b.beginPath();b.moveTo(-.015/.22*p,.07*p);b.lineTo(0,.22*p);b.lineTo(.015/.22*p,.07*p);b.fillStyle=g?n.N:n.ca;b.fill();b.beginPath();b.moveTo(-.1*p,-.22*p);b.lineTo(-.1*p,0);b.lineTo(0,
.22*p);b.lineTo(.1*p,0);b.lineTo(.1*p,-.22*p);b.strokeStyle=g?n.N:n.ca;b.lineWidth=c.sa;b.stroke();b.restore()},"sim:clear":function(){var p=c.c;b.save();b.fillStyle=k&&g?n.va:n.ra;b.fillRect(0,0,p,p);b.strokeStyle=g?n.N:n.ca;b.lineWidth=c.sa;b.strokeRect(.15*p,.25*p,.7*p,.5*p);b.translate(.5*p,.4*p);b.rotate(.4);b.fillStyle=g?n.N:n.ca;b.fillRect(0,0,.3*p,.2*p);b.restore()},"sim:map-kind":function(){var p=c.c,w=c.sa;b.save();b.fillStyle=k&&g?n.va:n.ra;b.fillRect(0,0,c.c,c.c);b.lineWidth=w;b.strokeStyle=
g?n.N:n.ca;b.fillStyle=g?n.N:n.ca;for(var q=["ground","height","obstacles"].indexOf(l),t=0;3>t;t++){var u=2*(t+.25)/3*Math.PI;t===q?b.fillRect(p*(.35+.25*Math.cos(u)),p*(.39+.25*Math.sin(u)),.3*p,.22*p):b.strokeRect(p*(.35+.25*Math.cos(u)),p*(.39+.25*Math.sin(u)),.3*p,.22*p);wc(b,.5*p,.5*p,.36*p,u-.42*Math.PI,u-.22*Math.PI,{Dd:!1,Uc:3*w,style:n.N})}b.restore()},"sim:map":function(){var p=c.c;b.save();b.fillStyle=k&&g?n.va:h?n.Vc:n.ra;b.fillRect(0,0,c.c,c.c);b.fillStyle=g?h||k?n.N:n.Gc:n.ca;b.fillRect(.1*
p,.8*p,.8*p,.1*p);b.lineWidth=c.sa;b.strokeStyle=g?n.N:n.ca;b.strokeRect(.15*p,.15*p,.7*p,.5*p);switch(l){case "ground":b.lineWidth=.08*p;b.beginPath();b.arc(.6*p,.4*p,.15*p,-.5*Math.PI,.5*Math.PI);b.lineTo(.4*p,.55*p);b.arc(.4*p,.4*p,.15*p,.5*Math.PI,1.5*Math.PI);b.closePath();b.stroke();break;case "height":b.beginPath();for(var w=0;.75>=w;w+=.25)for(var q=0;1>=q;q+=.1){var t=p*(.2+.5*q+.15*w),u=p*(.5-.3*w-.2*(.2*Math.cos(5*q+2*w-3)-(w-.9)*(w-.9)/3));0===q?b.moveTo(t,u):b.lineTo(t,u)}b.stroke();
break;case "obstacles":b.strokeRect(.2*p,.2*p,.6*p,.4*p),b.beginPath(),b.moveTo(.4*p,.2*p),b.lineTo(.4*p,.43*p),b.moveTo(.6*p,.6*p),b.lineTo(.6*p,.37*p),b.stroke()}b.restore()},"sim:map-ground":function(){l="ground";v["sim:map"]()},"sim:map-height":function(){l="height";v["sim:map"]()},"sim:map-obstacles":function(){l="obstacles";v["sim:map"]()},"sim-event:forward":function(){m(0,0,1)},"sim-event:backward":function(){m(0,0,3)},"sim-event:left":function(){m(0,0,2)},"sim-event:right":function(){m(0,
0,0)},"sim-event:center":function(){b.save();b.fillStyle=k?n.va:n.ra;b.fillRect(0,0,r.width,r.height);b.beginPath();b.arc(.5*r.width,.5*r.width,.25*r.width,0,2*Math.PI);b.strokeStyle=n.N;b.lineWidth=c.sa;b.stroke();b.restore()},"sim-event:clap":function(){b.save();b.fillStyle=k?n.va:n.ra;b.fillRect(0,0,r.width,r.height);b.beginPath();b.strokeStyle=n.N;b.lineWidth=c.sa;b.translate(.5*r.width,.5*r.width);b.rotate(.1);for(var p=0;9>p;p++)b.beginPath(),b.moveTo(.12*r.width,0),b.lineTo(.24*r.width,0),
b.moveTo(.28*r.width,0),b.lineTo(.36*r.width,0),b.stroke(),b.rotate(Math.PI/4.5);b.restore()},"sim-event:tap":function(){b.save();b.fillStyle=k?n.va:n.ra;b.fillRect(0,0,r.width,r.height);b.beginPath();b.strokeStyle=n.N;b.lineWidth=c.sa;b.translate(.6*r.width,.6*r.width);for(var p=1;3>=p;p++)b.beginPath(),b.arc(0,0,.15*r.width*p,.9*Math.PI,1.7*Math.PI),b.stroke();b.moveTo(.3*r.width,0);b.lineTo(0,0);b.lineTo(0,.3*r.width);b.stroke();b.restore()}};v["vpl:message-warning"]=v["vpl:message-error"];v["src:close"]=
v["vpl:close"];v["src:new"]=v["vpl:new"];v["src:save"]=v["vpl:save"];v["src:load"]=v["vpl:load"];v["src:run"]=v["vpl:run"];v["src:stop"]=v["vpl:stop"];v["src:connected"]=v["vpl:connected"];v["src:sim"]=v["vpl:sim"];v["src:teacher"]=v["vpl:teacher"];v["src:teacher-reset"]=v["vpl:teacher-reset"];v["sim:close"]=v["vpl:close"];v["sim:vpl"]=v["src:vpl"];v["sim:text"]=v["vpl:text"];v["sim:teacher"]=v["vpl:teacher"];v["sim:teacher-reset"]=v["vpl:teacher-reset"];(a=v[a])&&a()}
function xc(a,b){switch(a){case "vpl:close":case "src:close":case "sim:close":return{Y:0,pa:b.c/2,Z:0,la:b.c};case "vpl:message-error":case "vpl:message-warning":case "vpl:message-empty":return{Y:0,pa:5*b.c,Z:0,la:b.c};case "vpl:filename":return{Y:0,pa:3*b.c,Z:0,la:b.c}}return{Y:0,pa:b.c,Z:0,la:b.c}};function yc(a,b,c,d,e,f){var g=0<=b.ya.b.indexOf(c);if((b.Qb?b.Qb.T:b.L.T(c))&&(b.ya.Xa||!g)){var h=a.g,k=b.L.find(c).Mc;kc(a,function(l,z,m){b.Qb?e(c,l,h.v,h.ba,d,b.g,b.Qb.isEnabled,b.Qb.Ta,b.Qb.Sg,b.Qb.state):e(c,l,h.v,h.ba,d,b.g,b.L.isEnabled(c),b.L.Ta(c),m,b.L.getState(c));(b.Qb?b.Qb.disabled:g)&&zc(h,0,0,z.width,z.height,["button"],["button"])},f,b.ya.Xa&&!k?function(){b.ya.toggle(c);return 1}:Bb(b.L,c)?function(l){var z=b.L;l=l.Tg;var m=z.find(c);m&&(Db(m,l),Cb(z,c))}:null,b.ya.Xa&&!k?null:
function(l,z){b.L.mb(c,z)},b.ya.Xa&&!k?null:function(l,z){return b.L.lb(c,z)},c)}}function Ac(a,b,c,d,e,f){a.controls=[];a.b="";for(var g=0;g<c.length;g++)switch(c[g]){case "!space":a.b+=" ";break;case "!!space":a.b+="_";break;case "!stretch":a.b+="s";break;case "!!stretch":a.b+="S";break;default:yc(a,b,c[g],d,e,f(c[g],a.g.v,b.L.find(c[g]).Ac))}}function Bc(a,b){for(var c=0;c<b.length;c++)if("!"!==b[c][0]&&a.L.T(b[c]))return!0;return!1}
function Cc(a,b,c){for(var d={},e=0;e<b.length;e++)if("!"!==b[e][0]&&(a.Qb?a.Qb.T:a.L.find(b[e]).T())){var f=sc(a.ba,{tag:"button",id:b[e].replace(/:/g,"-"),W:c});d[b[e]]=f}return d}function Dc(a){var b=0,c;for(c in a)a.hasOwnProperty(c)&&(b=Math.max(b,a[c].oa()));return b};var Ec={"vpl:then":function(a,b,c,d){b=Math.min(d.width,d.height);a.strokeStyle=c.Jf;a.lineWidth=.2*b;a.beginPath();a.moveTo(-.25*b,-.5*b);a.lineTo(.25*b,0);a.lineTo(-.25*b,.5*b);a.stroke()},"vpl:error":function(a,b,c,d){b=Math.min(d.width,d.height);a.fillStyle="white";a.strokeStyle=c.vf;a.lineWidth=.07*b;a.beginPath();a.arc(0,0,.5*b,0,2*Math.PI);a.fill();a.stroke();a.fillStyle=c.vf;a.font="bold "+Math.round(.75*b).toString()+"px sans-serif";a.textAlign="center";a.textBaseline="middle";a.fillText("?",
0,.05*b)},"vpl:warning":function(a,b,c,d){b=Math.min(d.width,d.height);a.fillStyle="white";a.strokeStyle=c.Tf;a.lineWidth=.07*b;a.beginPath();a.arc(0,0,.5*b,0,2*Math.PI);a.fill();a.stroke();a.fillStyle=c.Tf;a.font="bold "+Math.round(.75*b).toString()+"px sans-serif";a.textAlign="center";a.textBaseline="middle";a.fillText("!",0,.05*b)},"vpl:moreHigh":function(a,b,c,d){b=Math.min(d.width,d.height);a.beginPath();a.moveTo(-.2*b,.1*b);a.lineTo(0,-.1*b);a.lineTo(.2*b,.1*b);a.lineWidth=.1*b;a.strokeStyle=
"black";a.shadowColor="white";a.shadowBlur=.2*b;a.stroke()},"vpl:moreLow":function(a,b,c,d){b=Math.min(d.width,d.height);a.beginPath();a.moveTo(-.2*b,-.1*b);a.lineTo(0,.1*b);a.lineTo(.2*b,-.1*b);a.lineWidth=.1*b;a.strokeStyle="black";a.shadowColor="white";a.shadowBlur=.2*b;a.stroke()},"vpl:customize":function(a,b,c,d){b=Math.min(d.width,d.height)/2;a.fillStyle=c.Jf;vc(a,0,0,b)}};function Jb(){this.l=new Fc;this.b=new Fc;this.b.P=!0;this.g=new Fc}function Gc(a,b){return function(){a.o!==b&&(a.o=b,Kb(a))}}function Hc(a){return function(b){a.o!==b&&(a.o=b,Kb(a))}}
function Ic(a,b,c,d,e,f,g){function h(m){return"a"===m||"c"===m}var k=a.i,l=Math.min(d.width,d.height),z=l/b.v.j;e=new Jc(c,d.width,d.height,e,f,function(m,x,n,r,v){var p=m.J;p.save();var w=m.v;m.v=Kc(l,m.v.c*z);pc(d,p,x.x+n,x.y+r);var q=c.V,t=x.data,u=x.x+n,F=x.y+r;m.J.save();m.J.translate(u,F);q.H(m,t,d,v);m.J.restore();c.locked&&Lc(m,x.x+n,x.y+r,l,l,!0);(c.disabled||g.disabled)&&zc(m,x.x+n,x.y+r,l,l,["block"],["block"],!g.Og);m.v=w;p.restore()},g&&g.hf||c.disabled||c.locked||c.Bb&&c.Bb.locked||
!c.V.aa?g&&g.aa?{aa:g.aa}:null:{aa:c.V.aa,Pa:c.V.Pa},g&&g.gf?null:function(m,x){m.data.Bb&&(k.Cb(),Aa(m.data.Bb,x.data,m.data.ie,function(){k.Cb()}));b.na&&b.na()},g&&g.gf?null:function(m,x){return x.data instanceof sa&&(h(m.data.V.type)===h(x.data.V.type)||"c"===x.data.V.type)&&m.data!==x.data});if(!(g&&g.hf||!c.V.aa)){if(k.P||c.V.Wd)e.w=function(m){return ic(b,m)};if(k.M||c.V.Wd)e.M=function(m){return ic(b,m)}}e.Ra=!(g&&g.ff);e.l=!(g&&g.De);e.P=Gc(a,c.V.name);Mc(b,e,Nc(b,c));return e}
function Oc(a,b,c,d,e,f){var g=new sa(c,null,null);c.jb&&(g.h=c.jb());var h=a.i,k=0>("b"===h.mode?h.xc:h.wc).indexOf(c.name);a=Ic(a,b,g,d,e,f,{hf:!0,gf:!0,De:a.fa||a.readOnly,disabled:k||a.readOnly,Og:k,aa:!a.ya.Xa||a.fa||h.readOnly?null:function(){var l="b"===h.mode?h.xc:h.wc;0<=l.indexOf(c.name)?l.splice(l.indexOf(c.name),1):l.push(c.name);return 1}});c.jb&&(a.za=function(l){l=l.clone();l.data=new sa(c,null,null);return l})}
function Pc(a,b,c){var d=[],e=0;d=a.U.map(function(h,k){var l=a.error&&a.error.g&&(0===a.error.l.length||0<=a.error.l.indexOf(k))?a.error.Kb?c.pd:c.od:c.Ea;l.width=null==h?mc(1===d.length?c.Pe:c.Oe):mc(Qc(h,0===k,c));e+=mc(l);return c.Ea.width});if(0===a.U.length||!b&&null!==a.U[a.U.length-1])c.Ea.width=mc(0===a.U.length?c.Pe:c.Oe),d.push(c.Ea.width),e+=mc(c.Ea);b=mc(c.Eb);var f=[],g=0;f=a.actions.map(function(h,k){var l=a.error&&!a.error.g&&(0===a.error.b.length||0<=a.error.b.indexOf(k))?a.error.Kb?
c.pd:c.od:c.Ea;l.width=null==h?mc(1===f.length?c.Ne:c.Me):mc(Qc(h,0===k,c));g+=mc(l);return mc(l)});if(0===a.actions.length||null!==a.actions[a.actions.length-1])c.Ea.width=mc(0===a.actions.length?c.Ne:c.Me),f.push(c.Ea.width),g+=mc(c.Ea);return{total:e+b+g,U:d,Of:e,oh:b,actions:f,$g:g}}function Qc(a,b,c){switch(a.V.type){case "e":return b?c.tc:c.jc;case "a":return c.Dc;case "s":return c.Lg;case "c":return c.Jg;default:throw"internal";}}
function Rc(a,b){switch(a.verticalAlign){case "middle":return(b.height-a.oa())/2;case "bottom":return b.height-a.oa();case "top":return 0;default:return b.height-a.oa()-a.verticalAlign}}
function Sc(a,b,c,d,e,f,g,h,k){var l=f,z=Pc(c,d,k),m=a.i,x=0<c.U.length&&"e"===c.U[0].V.type?k.tc:k.jc,n=new Jc(c,Tc(k.Ia),Uc(k.Ia),l-k.Ia.paddingLeft-k.Ea.offsetLeft()-x.offsetLeft(),h-k.Ia.paddingTop-k.Ea.offsetTop()-x.offsetTop(),function(w,q,t,u){var F=w.J;pc(k.Ia,F,q.x+t,q.y+u,!0);pc(k.Eb,F,g-k.Eb.width-k.Eb.marginRight-k.Eb.paddingRight-k.Ea.offsetLeft()-k.Dc.offsetLeft()+t,q.y+(Uc(k.Ia)-k.Eb.height)/2+u);Vc(w,"vpl:then",g-mc(k.Eb)/2-k.Ea.offsetLeft()-k.Dc.offsetLeft()+t,q.y+Uc(k.Ia)/2+u,k.Eb);
c.locked&&Lc(w,q.x,q.y,q.width,q.height,!1,c.disabled?"#ddd":"");var G=q.x+t+k.Ia.paddingLeft;0<e&&(G+=e-z.Of);v.forEach(function(D,O){var Q=c.error&&c.error.g&&(0===c.error.l.length||0<=c.error.l.indexOf(O))?c.error.Kb?k.pd:k.od:k.Ea;Q.width=null==D?mc(1===v.length?k.Pe:k.Oe):mc(Qc(D,0===O,k));pc(Q,F,G+Q.marginLeft,q.y+u+k.Ia.paddingTop+k.Ea.marginTop,!0);G+=mc(Q)});G=q.x+t+k.Ia.paddingLeft+g-f;p.forEach(function(D,O){var Q=c.error&&!c.error.g&&(0===c.error.b.length||0<=c.error.b.indexOf(O))?c.error.Kb?
k.pd:k.od:k.Ea;Q.width=null==D?mc(1===p.length?k.Ne:k.Me):mc(Qc(D,0===O,k));pc(Q,F,G+Q.marginLeft,q.y+u+k.Ia.paddingTop+k.Ea.marginTop,!0);G+=mc(Q)})},null,function(w,q){if(q.data instanceof za){w=m.i.indexOf(w.data);var t=m.i.indexOf(q.data);0<=w&&0<=t&&(m.Cb(),m.i.splice(t,1),m.i.splice(w,0,q.data))}else q.data instanceof sa&&(m.Cb(),Aa(w.data,q.data,null,function(){m.Cb()}));b.na&&b.na()},function(w,q){return q.data instanceof za?q.data!==w.data:q.data.Bb!==w.data&&("a"===m.mode||0===w.data.U.length||
q.data instanceof sa&&"a"===q.data.V.type)});c.disabled&&(n.g=function(w,q,t,u){zc(b,q.x+t,q.y+u,q.width,q.height,["rule"],["rule"])});if(a.i.fa||a.i.readOnly)n.l=!1;Mc(b,n);var r,v=c.U;if(0===v.length||!d&&null!==v[v.length-1])v=v.concat(null);l=f;0<e&&(l+=e-z.Of);v.forEach(function(w,q){var t=w?Qc(w,0===q,k):1===v.length?k.Pe:k.Oe,u=c.error&&c.error.g&&(0===c.error.l.length||0<=c.error.l.indexOf(q))?c.error.Kb?k.pd:k.od:k.Ea,F=Rc(t,u);w?(u.width=mc(t),r=Ic(this,b,w,t,l,h+F,{hf:c.disabled||this.i.fa||
this.i.readOnly,ff:c.disabled||this.i.fa||this.i.readOnly,De:this.i.fa||this.i.readOnly})):(u.width=mc(t),r=Ic(this,b,new va("e",c,{Wc:!0,index:q}),t,l,h+F,{gf:c.disabled||this.readOnly,ff:!0,De:!0}));n.ha.push(r);l+=mc(u)},a);var p=c.actions;if(0===p.length||null!==p[p.length-1])p=p.concat(null);l=g;p.forEach(function(w,q){var t=w?Qc(w,0==q,k):1===p.length?k.Ne:k.Me,u=c.error&&!c.error.g&&(0===c.error.b.length||0<=c.error.b.indexOf(q))?c.error.Kb?k.pd:k.od:k.Ea,F=Rc(t,u);w?(u.width=mc(t),r=Ic(this,
b,w,Qc(w,0===q,k),l,h+F,{hf:c.disabled||this.i.fa||this.i.readOnly,ff:c.disabled||this.i.fa||this.i.readOnly,De:this.i.fa||this.i.readOnly})):(u.width=mc(t),r=Ic(this,b,new va("a",c,{Wc:!1,index:q}),t,l,h,{gf:m.readOnly,ff:!0,De:!0}));n.ha.push(r);l+=mc(u)},a);oc(b,function(){if(null!==c.error){var w=c.error.Kb?k.Gg:k.Xe;Vc(b,c.error.Kb?"vpl:warning":"vpl:error",f-k.Ia.paddingLeft-k.Ia.marginLeft-k.Ea.offsetLeft()-x.offsetLeft()-w.width/2-w.marginRight-w.paddingRight,h+.5*x.height,w)}})}
function Wc(a,b,c,d,e,f){var g=f?e.Gg:e.Xe;oc(a,function(h){var k=Xc(a.ba,{tag:"conflict-line",W:[f?"warning":"error"]}),l=b-e.Ia.paddingLeft-e.Ia.marginLeft-e.Ea.offsetLeft()-e.tc.offsetLeft()-g.width/2-g.marginRight-g.paddingRight,z=c+(e.Ea.height+g.height)/2,m=d+(e.Ea.height-g.height)/2;h.beginPath();h.moveTo(l,z);h.lineTo(l,m);k.stroke(h);h.beginPath();h.arc(l,z,k.lineWidth,0,Math.PI);k.stroke(h);h.beginPath();h.arc(l,m,k.lineWidth,-Math.PI,0);k.stroke(h)})}
function Yc(a,b){var c={};a=window.matchMedia&&window.matchMedia("(pointer: coarse)").matches?a.i.M:a.i.P;c.Ca=sc(b,{tag:"view",W:["vpl"]});c.Fg=sc(b,{tag:"separator",W:["vpl","top"]});c.Eg=sc(b,{tag:"separator",W:["vpl","bottom"]});c.rc=sc(b,{tag:"toolbar",W:["vpl","top"]});c.Ad=sc(b,{tag:"toolbar",W:["vpl","bottom"]});c.Ja=sc(b,{tag:"vpl",id:"scrolling-vpl"});c.tc=sc(b,{tag:"block",W:["event","event-main"],nb:a?["small"]:[]});c.jc=sc(b,{tag:"block",W:["event","event-aux"],nb:a?["small"]:[]});c.Dc=
sc(b,{tag:"block",W:["action"],nb:a?["small"]:[]});c.Lg=sc(b,{tag:"block",W:["state"],nb:a?["small"]:[]});c.Jg=sc(b,{tag:"block",W:["comment"],nb:a?["small"]:[]});c.dh=sc(b,{tag:"block",W:["event","empty"],nb:a?["small"]:[]});c.Me=sc(b,{tag:"block",W:["action","empty"],nb:a?["small"]:[]});c.Pe=sc(b,{tag:"block",W:["event","empty"],nb:a?["only-child","small"]:["only-child"]});c.Oe=sc(b,{tag:"block",W:["event","event-aux","empty"],nb:a?["small"]:[]});c.Ne=sc(b,{tag:"block",W:["action","empty"],nb:a?
["only-child","small"]:["only-child"]});c.Ea=sc(b,{tag:"block-container"});c.od=sc(b,{tag:"block-container",W:["error"]});c.pd=sc(b,{tag:"block-container",W:["warning"]});c.Ia=sc(b,{tag:"rule",nb:a?["small"]:[]});c.Eb=sc(b,{tag:"widget",id:"widget-then",nb:a?["small"]:[]});c.ve=sc(b,{tag:"block",W:["library","event"]});c.Xd=sc(b,{tag:"block",W:["library","action"]});c.Mg=sc(b,{tag:"block",W:["library","state"]});c.Kg=sc(b,{tag:"block",W:["library","comment"]});c.Na=sc(b,{tag:"block-library",W:["event"]});
c.Sa=sc(b,{tag:"block-library",W:["action"]});c.Xe=sc(b,{tag:"widget",id:"widget-error",nb:a?["small"]:[]});c.Gg=sc(b,{tag:"widget",id:"widget-warning",nb:a?["small"]:[]});return c}function $b(a){var b=a.ya,c=a.i;c.$b(c.Db);a.hc="";a.Sd=!1;if(!b.Xa)for(b=0;b<c.i.length;b++)if(c.i[b].error)if(c.i[b].error.Kb)a.hc||(a.hc=c.i[b].error.w,a.Sd=!0);else{a.hc=c.i[b].error.w;a.Sd=!1;break}}function Zc(a,b,c,d,e,f){var g=new jc(a.da);Ac(g,a,b,c,a.i.fc||rc,a.i.Ie||xc);lc(g,d,f,e);return g}
function Kb(a){function b(K,A){switch(A.type){case "e":return K.ve;case "a":return K.Xd;case "s":return K.Mg;case "c":return K.Kg;default:throw"internal";}}var c=a.ya,d=a.da,e=a.i,f=Yc(a,d.ba);$c(d);$b(a);e.P=d.v.j<d.v.kg;e.M=d.v.j<d.v.lg;var g=ad(d),h=d.state.bh,k=Bc(a,a.w),l=Xa(e),z=0,m=0;e.i.forEach(function(K){K=Pc(K,l,f);z=Math.max(z,K.Of);m=Math.max(m,K.$g)});var x=0,n=0;Va.forEach(function(K){if(c.Xa||0<=("b"===e.mode?e.xc:e.wc).indexOf(K.name))switch(K.type){case "e":case "s":x++;break;case "a":case "c":n++}},
a);bd(d,function(K,A,S){if(a.L.lb("vpl:trashcan",A)){K=u-f.Ia.offsetLeft()-f.Ea.offsetLeft()-f.tc.offsetLeft();var N=mc(f.Ia);if(S<K||S>K+N)return a.L.mb("vpl:trashcan",A),!0}return!1});var r=Cc(a,a.P,["vpl","top"]),v=Dc(r),p=Cc(a,a.w,["vpl","bottom"]),w=Dc(r);f.Ca.oc(g.width);f.Ca.cc(g.height);f.Ca.setPosition(0,0);f.rc.oc(f.Ca.width);f.rc.height=v;f.rc.setPosition(f.Ca.x,f.Ca.y);f.Na.cc(f.Ca.height-f.rc.oa());var q=Math.max(Math.floor(f.Na.height/f.ve.oa()),1);v=f.Na.scroll?1:Math.ceil(x/q);f.Na.width=
v*mc(f.ve);f.Na.setPosition(f.Ca.x,f.Ca.y+f.rc.oa());f.Sa.cc(f.Ca.height-f.rc.oa());var t=f.Sa.scroll?1:Math.ceil(n/q);f.Sa.width=t*mc(f.Xd);f.Sa.setPosition(f.Ca.x+f.Ca.width-mc(f.Sa),f.Ca.y+f.rc.oa());f.Ad.oc(f.Ca.width-mc(f.Na)-mc(f.Sa));f.Ad.height=w;f.Ad.setPosition(f.Ca.x+mc(f.Na),f.Ca.y+f.Ca.height-f.Ad.oa());f.Ja.oc(f.Ca.width-mc(f.Na)-mc(f.Sa));f.Ja.cc(f.Ca.height-f.rc.oa()-(k?f.Ad.oa():0));f.Ja.setPosition(f.Ca.x+mc(f.Na),f.Ca.y+f.rc.oa());f.Ea.width=f.od.width=f.pd.width=mc(f.tc);f.Ea.height=
f.od.height=f.pd.height=f.tc.oa();w=mc(f.Eb);q=z+m+w;var u=f.Ca.x+(f.Ca.width-q+mc(f.Xe))/2,F=u+z+w;f.Ia.width=q;f.Ia.height=f.Ea.oa();d.$a=[];oc(d,function(K){f.Ca.H(K)});nc(Zc(a,a.P,["vpl","top"],f.rc,f.Fg,r),f.rc,r,Hc(a));0<k&&nc(Zc(a,a.w,["vpl","bottom"],f.Ad,f.Eg,p),f.Ad,p,Hc(a));var G=f.ve.oa(),D=f.Xd.oa(),O=0,Q=0;if(f.Na.scroll){O=mc(f.ve);h.b.cc(x*G);f.Na.width=O;f.Na.height=f.Na.height;h.b.resize(f.Na.x,f.Na.y,f.Na.width,f.Na.height);oc(d,function(K){f.Na.H(K)});h.b.Fd(d);var R=0;Va.forEach(function(K){if(("e"===
K.type||"s"===K.type)&&(c.Xa||0<=("b"===e.mode?e.xc:e.wc).indexOf(K.name))){var A=b(f,K);Oc(this,d,K,A,f.Na.x+A.offsetLeft(),f.Na.y+A.offsetTop()+R*G);R++}},a);h.b.end();oc(d,function(){var K=sc(d.ba,{tag:"widget",id:"widget-moreHigh"}),A=sc(d.ba,{tag:"widget",id:"widget-moreLow"});cd(h.b)||Vc(d,"vpl:moreHigh",f.Na.x+f.Na.width/2,f.Na.y+K.oa()/2,K);dd(h.b)||Vc(d,"vpl:moreLow",f.Na.x+f.Na.width/2,f.Na.y+f.Na.height-A.oa()/2,A)})}else{oc(d,function(K){f.Na.H(K)});O=v*G+ed(f.Na);var V=Math.ceil(x/v);
R=0;Va.forEach(function(K){if(("e"===K.type||"s"===K.type)&&(c.Xa||0<=("b"===e.mode?e.xc:e.wc).indexOf(K.name))){var A=b(f,K),S=f.Na.x+A.offsetLeft()+Math.floor(R/V)*G,N=f.Na.y+A.offsetTop()+R%V*G;Oc(a,d,K,A,S,N);R++}},a)}f.Sa.scroll?(Q=mc(f.Xd),h.g.cc(n*D),f.Sa.width=Q,f.Sa.height=f.Sa.height,h.g.resize(f.Sa.x,f.Sa.y,f.Sa.width,f.Sa.height),oc(d,function(K){f.Sa.H(K)}),h.g.Fd(d),R=0,Va.forEach(function(K){if(("a"===K.type||"c"===K.type)&&(c.Xa||0<=("b"===e.mode?e.xc:e.wc).indexOf(K.name))){var A=
b(f,K);Oc(this,d,K,A,f.Sa.x+f.Xd.offsetLeft(),f.Sa.y+f.Xd.offsetTop()+R*D);R++}},a),h.g.end(),oc(d,function(){var K=sc(d.ba,{tag:"widget",id:"widget-moreHigh"}),A=sc(d.ba,{tag:"widget",id:"widget-moreLow"});cd(h.g)||Vc(d,"vpl:moreHigh",f.Sa.x+f.Sa.width/2,f.Sa.y+K.oa()/2,K);dd(h.g)||Vc(d,"vpl:moreLow",f.Sa.x+f.Sa.width/2,f.Sa.y+f.Sa.height-A.oa()/2,A)})):(oc(d,function(K){f.Sa.H(K)}),Q=t*D+ed(f.Sa),V=Math.ceil(n/t),R=0,Va.forEach(function(K){if(("a"===K.type||"c"===K.type)&&(c.Xa||0<=("b"===e.mode?
e.xc:e.wc).indexOf(K.name))){var A=b(f,K),S=f.Sa.x+A.offsetLeft()+f.Sa.width-(t-Math.floor(R/V))*D,N=f.Sa.y+A.offsetTop()+R%V*D;Oc(a,d,K,A,S,N);R++}},a));if(c.Xa){(function(){var K=f.Ea.pb();K.width=mc(f.tc);var A=f.Ea.pb();A.width=mc(f.jc);var S=f.Ea.pb();S.width=mc(f.Dc);var N=mc(K)+mc(A)+mc(f.Eb)+mc(S),X=f.Ia.pb();X.width=N;var y=f.Ca.x+(f.Ca.width-N)/2+(O-Q)/2-d.v.Oc/2,P=y+N-mc(S);N=f.Ja.y+X.offsetTop()+K.offsetTop();var I=!1;N=new Jc(a,Tc(X),Uc(X),y-X.paddingLeft-K.offsetLeft(),N-X.paddingTop-
K.offsetTop(),function(C,B,H,Z){var L=C.J;pc(X,L,B.x+H,B.y+Z,!0);pc(f.Eb,L,P-f.Eb.width-f.Eb.marginRight-f.Eb.paddingRight-f.Ea.offsetLeft()-f.Dc.offsetLeft()+H,B.y+(Uc(f.Ia)-f.Eb.height)/2+Z);Vc(C,"vpl:then",P-mc(f.Eb)/2-f.Ea.offsetLeft()-f.Dc.offsetLeft()+H,B.y+Uc(f.Ia)/2+Z,f.Eb);var fa=B.x+H+X.paddingLeft;pc(K,L,fa+K.marginLeft,B.y+Z+X.paddingTop+K.marginTop,!0);pc(f.tc,L,fa+K.offsetLeft()+f.tc.marginLeft,B.y+Z+X.paddingTop+K.offsetTop()+f.tc.marginTop+Rc(f.tc,K),!0);fa+=mc(K);pc(A,L,fa+A.marginLeft,
B.y+Z+X.paddingTop+A.marginTop,!0);pc(f.jc,L,fa+K.offsetLeft()+f.jc.marginLeft,B.y+Z+X.paddingTop+A.offsetTop()+f.jc.marginTop+Rc(f.jc,A),!0);!("a"===a.i.mode?a.i.b:a.i.g)^I&&zc(C,fa+K.offsetLeft()+f.jc.marginLeft,B.y+Z+X.paddingTop+A.offsetTop()+f.jc.marginTop+Rc(f.jc,A),f.jc.width,f.jc.height,["block"],["block"],!1);fa=B.x+H+f.Ia.paddingLeft+P-y;pc(S,L,fa+S.marginLeft,B.y+Z+X.paddingTop+S.marginTop,!0);pc(f.Dc,L,fa+S.offsetLeft()+f.Dc.marginLeft,B.y+Z+X.paddingTop+S.offsetTop()+f.Dc.marginTop+Rc(f.Dc,
S),!0)},{aa:function(C){I=!0;Ob(C);return 0},Pa:function(C,B,H,Z,L,fa,ia,Y){H=C.b.getBoundingClientRect();B=Y.x-H.left;Y=Y.y-H.top;I=B>=fa&&B<fa+Z&&Y>=ia&&Y<ia+L;Ob(C)},ef:function(C){I&&("a"===a.i.mode?a.i.b=!a.i.b:a.i.g=!a.i.g);Ob(C)}},null,null);N.l=!1;Mc(d,N)})();var da=sc(d.ba,{tag:"widget",id:"vpl-customize"});da.width=f.Ja.width/2;da.height=(f.Ja.height-f.Ia.oa())/2;oc(d,function(){Vc(d,"vpl:customize",f.Ja.x+f.Ja.width/2,f.Ja.y+(f.Ja.height+f.Ia.oa())/2,da)})}else if(e.message)oc(d,function(K){var A=
e.message.split("\n"),S=Math.min(14,g.height/A.length);K.font=S+"px sans-serif";K.textAlign="start";K.textBaseline="top";var N=f.Ja.x+S,X=f.Ja.y+S;A.forEach(function(y,P){K.fillText(y,N,X+1.2*S*P)})});else{k=mc(f.Ia)+f.Ja.paddingLeft+f.Ja.paddingRight+mc(f.Xe);h.l.oc(k);h.l.cc(e.i.length*f.Ia.oa());h.l.resize(f.Ja.x,f.Ja.y,f.Ja.width,f.Ja.height);oc(d,function(K){f.Ja.H(K)});h.l.Fd(d);u+=(O-Q)/2-d.v.Oc/2;F+=(O-Q)/2-d.v.Oc/2;k>f.Ja.width&&(u+=(k-f.Ja.width)/2+f.Ja.paddingLeft+f.Ja.marginLeft,F+=(k-
f.Ja.width)/2+f.Ja.paddingLeft+f.Ja.marginLeft);var ja="";e.i.forEach(function(K,A){Sc(this,d,K,l,d.v.gg?z:0,u,F,f.Ja.y+f.Ia.oa()*A+f.Ia.offsetTop()+f.Ea.offsetTop(),f);if(null!==K.error&&""===ja&&(ja=K.error.w,null!==K.error.o))for(var S=A+1;S<e.i.length;S++)if(e.i[S]===K.error.o){Wc(d,u,f.Ja.y+f.Ia.oa()*A+f.Ia.offsetTop()+f.Ea.offsetTop(),f.Ja.y+f.Ia.oa()*S+f.Ia.offsetTop()+f.Ea.offsetTop(),f,K.error.Kb);break}},a);h.l.end();e.fa&&oc(d,function(){zc(d,f.Ja.x,f.Ja.y,f.Ja.width,f.Ja.height,["vpl"],
["vpl"])})}a.o&&oc(d,function(K){var A=sc(d.ba,{tag:"hint"});K.fillStyle=A.color;K.font=tc(A);K.textAlign="start";K.textBaseline="middle";var S=a.g.translate(a.o);A.width=K.measureText(S).width;A.height=1.2*A.fontSize;pc(A,K,A.marginLeft,g.height-A.oa()+A.marginTop,!0);K.fillText(S,A.offsetLeft(),g.height-A.oa()+A.offsetTop()+A.height/2)});oc(d,function(K){K.font="9px sans-serif";K.textAlign="start";K.textBaseline="bottom";K.rotate(-Math.PI/2);K.fillText("EPFL 2018-2019",-g.height+d.v.ja,g.width-
d.v.ja)});e.na&&e.na();Ob(d)};function fd(){this.za={};this.l=[];this.M={px:1,cm:96/2.54,mm:96/25.4,"in":96,pc:16,pt:96/72};this.b=null}
function gd(a,b,c){function d(){return b+" line "+z+" col "+m}function e(){for(;l<c.length;)if(" "===c[l]||"\t"===c[l])l++,m++;else if("\n"===c[l])l++,m=1,z++;else if("\r"===c[l])l++;else if("/*"===c.slice(l,l+2))for(l+=2,m+=2;l<c.length;)if("*/"===c.slice(l,l+2)){l+=2;m+=2;break}else l++,m++;else break}function f(){"\n"===c[l]?(m=1,z++):"\r"!==c[l]&&m++;l++}function g(){for(var p=0;l+p<c.length&&/[-_a-z0-9]/i.test(c[l+p]);)p++;l+=p;m+=p;return c.slice(l-p,l)}function h(){var p=new hd;if(!/[a-z_.#*:]/i.test(c[l]))throw"Syntax error "+
d();for(/[a-z_]/i.test(c[l])?p.tag=g():"*"===c[l]&&f();;)if("#"===c[l]){if(p.id)throw"Multiple ids in selector "+d();f();p.id=g()}else if("."===c[l])f(),p.W.push(g());else if(":"===c[l])f(),p.nb.push(g());else break;return p}function k(){for(var p=0;l+p<c.length&&";"!==c[l+p]&&"}"!==c[l+p];)"\n"===c[l]?(z++,m=1):"\r"!==c[l]&&m++,p++;l+=p;return c.slice(l-p,l).trim()}a.za[b]=c;for(var l=0,z=1,m=1;l<c.length;){e();if(l>=c.length)break;for(var x=[];;){x.push(h());e();if(","!==c[l])break;l++;m++;e()}if("{"!==
c[l])throw"Syntax error "+d();l++;m++;for(var n={};;){for(;;){e();if(";"!==c[l])break;l++}if(l>=c.length)throw"Unclosed block "+d();if("}"===c[l]){l++;m++;break}else if(!/[a-z_]/i.test(c[l]))throw"Syntax error "+d();var r=g();e();if(":"!==c[l])throw"Missing colon "+d();l++;m++;var v=k();n[r]=a.ha(r,v)}for(r=0;r<x.length;r++)a.l.push({Mf:x[r],Nc:n})}}fd.prototype.ha=function(a,b){return b};
function id(a,b){if(/^(max|min)\(.*\)$/.test(b))return a=b.slice(4,-1).split(",").map(function(e){return id(this,e)},a),new jd(b.slice(0,3),a);b=/^(-?([0-9]+\.?|[0-9]*\.[0-9]+))([a-z]*|%)$/.exec(b);var c=1,d=kd;if(null==b)throw"Illegal length";if("%"===b[3])d=ld;else if(a.M.hasOwnProperty(b[3]))c=a.M[b[3]];else if("vw"===b[3])d=md;else if("vh"===b[3])d=nd;else if("vmin"===b[3])d=od;else if("vmax"===b[3])d=pd;else if("ww"===b[3])d=qd;else if("wh"===b[3])d=rd;else if("wmin"===b[3])d=sd;else if("wmax"===
b[3])d=td;else if(0==parseFloat(b[1]))c=0;else throw"Unknown length unit";return new ud(parseFloat(b[1])*c,d)}
var vd={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgreen:"#006400",
darkgrey:"#A9A9A9",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",
ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",green:"#008000",greenyellow:"#ADFF2F",grey:"#808080",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgreen:"#90EE90",lightgrey:"#D3D3D3",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",
lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",
moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",
seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32",transparent:"rgba(0,0,0,0)"};function ud(a,b){this.S=a;this.type=b?b:kd}
var kd="abs",ld="%",md="vw",nd="vh",od="vmin",pd="vmax",qd="ww",rd="wh",sd="wmin",td="wmax";
ud.prototype.R=function(a){switch(this.type){case kd:return this.S;case ld:return this.S*(a?a.w/100:1);case md:return this.S*(a?a.g:1);case nd:return this.S*(a?a.b:1);case od:return this.S*(a?Math.min(a.g,a.b):1);case pd:return this.S*(a?Math.max(a.g,a.b):1);case qd:return this.S*(a?a.o:1);case rd:return this.S*(a?a.l:1);case sd:return this.S*(a?Math.min(a.o,a.l):1);case td:return this.S*(a?Math.max(a.o,a.l):1);default:throw"internal";}};function jd(a,b){ud.call(this,0);this.Ba=a;this.values=b}
jd.prototype=Object.create(ud.prototype);jd.prototype.constructor=jd;jd.prototype.R=function(a){switch(this.Ba){case "max":return this.values.reduce(function(b,c){return Math.max(b,c.R(a))},-Infinity);case "min":return this.values.reduce(function(b,c){return Math.min(b,c.R(a))},Infinity);default:throw"internal";}};function wd(a,b,c,d,e){this.w=a;this.g=b;this.b=c;this.o=d;this.l=e}function hd(){this.id=this.tag=null;this.W=[];this.nb=[]}
function xd(a,b){a=a.id?"#"+a.id:(a.tag||"")+(a.W&&0<a.W.length?"."+a.W.join("."):"")+(a.nb&&0<a.nb.length?":"+a.nb.join("."):"")||"*";b&&(a+="/"+Math.round(b.w).toString(10)+","+Math.round(b.g).toString(10)+","+Math.round(b.b).toString(10)+","+Math.round(b.o).toString(10)+","+Math.round(b.l).toString(10));return a}
hd.prototype.match=function(a){if(a.tag&&this.tag&&a.tag!==this.tag||this.id&&this.id!==a.id)return!1;for(var b=0;b<this.W.length;b++)if(void 0==a.W||0>a.W.indexOf(this.W[b]))return!1;for(b=0;b<this.nb.length;b++)if(void 0==a.nb||0>a.nb.indexOf(this.nb[b]))return!1;return!0};function Hb(){fd.call(this);this.g=[];this.o={};this.w={};this.P="none hidden dotted dashed solid double".split(" ");this.Ra=["normal","italic","oblique"];this.gb=["normal","bold"]}Hb.prototype=Object.create(fd.prototype);Hb.prototype.constructor=Hb;Hb.prototype.defineProperties=function(){for(var a=0;a<this.l.length;a++){var b=new yd;zd(b,this.l[a].Nc);this.g.push({Mf:this.l[a].Mf,xg:b})}};
Hb.prototype.ha=function(a,b){function c(x){try{id(e,x)}catch(n){return!1}return!0}function d(x){return vd.hasOwnProperty(x)||/^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(x)||/^rgba\([^()]*\)$/.test(x)}var e=this;b=b.replace(/\s+(?=[^()]*\))/g,"");switch(a){case "margin-left":case "margin-right":case "margin-top":case "margin-bottom":case "padding-left":case "padding-right":case "padding-top":case "padding-bottom":case "border-left-width":case "border-right-width":case "border-top-width":case "border-bottom-width":case "line-width":case "width":case "height":case "min-width":case "min-height":case "max-width":case "max-height":case "font-size":return id(this,
b);case "margin":case "padding":case "border-width":switch(a=b.replace(/ +/g," ").split(" ").map(function(x){return id(e,x)}),a.length){case 1:return[a[0],a[0],a[0],a[0]];case 2:return[a[0],a[1],a[0],a[1]];case 3:return[a[0],a[1],a[2],a[1]];case 4:return a;default:throw"Wrong number of lengths";}case "border-style":case "border-left-style":case "border-right-style":case "border-top-style":case "border-bottom-style":case "line-style":if(!(0<=e.P.indexOf(b)))throw"Unknown border style";return b;case "line-cap":if(!(0<=
["butt","round","square"].indexOf(b)))throw"Unknown line cap";return b;case "border-color":case "border-left-color":case "border-right-color":case "border-top-color":case "border-bottom-color":case "color":case "background-color":case "background":if(!d(b))throw"Unknown border color";return b;case "border-left":case "border-right":case "border-top":case "border-bottom":case "border":case "line":var f=null,g=null,h=null;b.replace(/ +/g," ").split(" ").forEach(function(x){if(d(x))f=x;else if(0<=e.P.indexOf(x))g=
x;else if(c(x))h=id(e,x);else throw"Illegal border property";});return{color:f,style:null===g&&(f||h)?"solid":g,width:null===h&&(f||g)?new ud(1):h};case "border-top-left-radius":case "border-top-right-radius":case "border-bottom-right-radius":case "border-bottom-left-radius":switch(a=b.replace(/ +/g," ").split(" ").map(function(x){return id(e,x)}),a.length){case 1:return[a[0],a[0]];case 2:return a;default:throw"Wrong number of radii";}case "border-radius":switch(a=b.split("/").map(function(x){x=x.replace(/ +/g,
" ").split(" ").map(function(n){return"/"===n?"/":id(e,n)});switch(x.length){case 1:return[x[0],x[0],x[0],x[0]];case 2:return[x[0],x[1],x[0],x[1]];case 3:return[x[0],x[1],x[2],x[1]];case 4:return x;default:throw"Wrong number of radii";}}),a.length){case 1:return a[0].concat(a[0]);case 2:return a[0].concat(a[1]);default:throw"Wrong number of radius dimensions";}case "font":var k="",l="",z=null,m="";b.replace(/ +/g," ").split(" ").forEach(function(x){if(null===z)if(c(x))z=id(e,x);else if(0<=e.Ra.indexOf(x))k=
x;else if(0<=e.gb.indexOf(x))l=x;else throw"Unknown font style "+x;else{if(""!==m)throw"Unexpected font style after font-family";m=x}});return{fontFamily:m,fontSize:z,fontStyle:k,fontWeight:l};case "box-shadow":case "line-shadow":return b=b.split(",")[0],a=b.replace(/ +/g," ").split(" "),"inset"===a[0]&&(a=a.slice(1)),3<=a.length&&5>=a.length?{offset:[id(this,a[0]),id(this,a[1])],color:a[a.length-1],Qe:4<=a.length?id(this,a[2]):null,lf:5<=a.length?id(this,a[3]):null}:{};case "overflow":if(0>["wrap",
"scroll"].indexOf(b))throw"Unknown overflow mode";return b;case "vertical-align":return 0<=["top","middle","bottom"].indexOf(b)?b:id(this,b);default:return b}};function Ad(a,b){for(var c=null,d=0;d<a.g.length;d++)if(a.g[d].Mf.match(b)){if(c){var e=void 0;var f=a.g[d].xg;c=c.pb();for(e in f.Nc)f.Nc.hasOwnProperty(e)&&(c.Nc[e]=f.Nc[e]);e=c}else e=a.g[d].xg.pb();c=e}for(var g in c)c.hasOwnProperty(g)&&c[g]instanceof ud&&(c[g]=c[g].R(a.b));return c}
function sc(a,b){var c=xd(b,a.b);if(a.o[c])return a.o[c];b=Ad(a,b);b=new Bd(b,a.b);return a.o[c]=b}function Xc(a,b){var c=xd(b,a.b);if(a.w[c])return a.w[c];b=Ad(a,b);b=new Cd(b,a.b);return a.w[c]=b}function yd(){this.Nc={}}function zd(a,b){for(var c in b)b.hasOwnProperty(c)&&(a.Nc[c]=b[c])}yd.prototype.pb=function(){var a=new yd;zd(a,this.Nc);return a};
function Bd(a,b){this.marginBottom=this.marginTop=this.marginRight=this.marginLeft=this.y=this.x=this.height=this.width=0;this.tb=!0;this.xd=!1;this.borderBottomWidth=this.borderTopWidth=this.borderRightWidth=this.borderLeftWidth=0;this.borderBottomStyle=this.borderTopStyle=this.borderRightStyle=this.borderLeftStyle="none";this.borderBottomColor=this.borderTopColor=this.borderRightColor=this.borderLeftColor="black";this.borderTopLeftRadius=[0,0];this.borderTopRightRadius=[0,0];this.borderBottomRightRadius=
[0,0];this.borderBottomLeftRadius=[0,0];this.paddingBottom=this.paddingTop=this.paddingRight=this.paddingLeft=0;this.backgroundColor="transparent";this.color="black";this.fontFamily="sans-serif";this.fontSize=10;this.fontWeight=this.fontStyle="";this.scroll=!1;this.verticalAlign="middle";this.Nb=null;this.Qd=this.cd=0;this.shadowColor=null;a&&Dd(this,a.Nc,b)}Bd.prototype=Object.create(yd.prototype);M=Bd.prototype;M.constructor=Bd;
function Dd(a,b,c){var d=-1,e=-1,f=-1,g=-1,h=1E9,k=1E9,l;for(l in b)switch(l){case "margin-left":a.marginLeft=b[l].R(c);break;case "margin-right":a.marginRight=b[l].R(c);break;case "margin-top":a.marginTop=b[l].R(c);break;case "margin-bottom":a.marginBottom=b[l].R(c);break;case "border-left-width":a.borderLeftWidth=b[l].R(c);a.tb=!1;break;case "border-right-width":a.borderRightWidth=b[l].R(c);a.tb=!1;break;case "border-top-width":a.borderTopWidth=b[l].R(c);a.tb=!1;break;case "border-bottom-width":a.borderBottomWidth=
b[l].R(c);a.tb=!1;break;case "padding-left":a.paddingLeft=b[l].R(c);break;case "padding-right":a.paddingRight=b[l].R(c);break;case "padding-top":a.paddingTop=b[l].R(c);break;case "padding-bottom":a.paddingBottom=b[l].R(c);break;case "margin":a.marginTop=b[l][0].R(c);a.marginRight=b[l][1].R(c);a.marginBottom=b[l][2].R(c);a.marginLeft=b[l][3].R(c);break;case "border-width":a.borderTopWidth=b[l][0].R(c);"none"===a.borderTopStyle&&0<a.borderTopWidth&&(a.borderTopStyle=null);a.borderRightWidth=b[l][1].R(c);
"none"===a.borderRightStyle&&0<a.borderRightWidth&&(a.borderRightStyle=null);a.borderBottomWidth=b[l][2].R(c);"none"===a.borderBottomStyle&&0<a.borderBottomWidth&&(a.borderBottomStyle=null);a.borderLeftWidth=b[l][3].R(c);"none"===a.borderLeftStyle&&0<a.borderLeftWidth&&(a.borderLeftStyle=null);break;case "padding":a.paddingTop=b[l][0].R(c);a.paddingRight=b[l][1].R(c);a.paddingBottom=b[l][2].R(c);a.paddingLeft=b[l][3].R(c);break;case "border-style":a.borderLeftStyle=b[l];a.borderRightStyle=b[l];a.borderTopStyle=
b[l];a.borderBottomStyle=b[l];break;case "border-left-style":a.borderLeftStyle=b[l];a.tb=!1;break;case "border-right-style":a.borderRightStyle=b[l];a.tb=!1;break;case "border-top-style":a.borderTopStyle=b[l];a.tb=!1;break;case "border-bottom-style":a.borderBottomStyle=b[l];a.tb=!1;break;case "border-color":a.borderLeftColor=b[l];a.borderRightColor=b[l];a.borderTopColor=b[l];a.borderBottomColor=b[l];break;case "border-left-color":a.borderLeftColor=b[l];a.tb=!1;break;case "border-right-color":a.borderRightColor=
b[l];a.tb=!1;break;case "border-top-color":a.borderTopColor=b[l];a.tb=!1;break;case "border-bottom-color":a.borderBottomColor=b[l];a.tb=!1;break;case "border-left":null!==b[l].color&&(a.borderLeftColor=b[l].color);null!==b[l].style&&(a.borderLeftStyle=b[l].style);null!==b[l].width&&(a.borderLeftWidth=b[l].width.R(c));a.tb=!1;break;case "border-right":null!==b[l].color&&(a.borderRightColor=b[l].color);null!==b[l].style&&(a.borderRightStyle=b[l].style);null!==b[l].width&&(a.borderRightWidth=b[l].width.R(c));
a.tb=!1;break;case "border-top":null!==b[l].color&&(a.borderTopColor=b[l].color);null!==b[l].style&&(a.borderTopStyle=b[l].style);null!==b[l].width&&(a.borderTopWidth=b[l].width.R(c));a.tb=!1;break;case "border-bottom":null!==b[l].color&&(a.borderBottomColor=b[l].color);null!==b[l].style&&(a.borderBottomStyle=b[l].style);null!==b[l].width&&(a.borderBottomWidth=b[l].width.R(c));a.tb=!1;break;case "border":null!==b[l].color&&(a.borderLeftColor=a.borderRightColor=a.borderTopColor=a.borderBottomColor=
b[l].color);null!==b[l].style&&(a.borderLeftStyle=a.borderRightStyle=a.borderTopStyle=a.borderBottomStyle=b[l].style);null!==b[l].width&&(a.borderLeftWidth=a.borderRightWidth=a.borderTopWidth=a.borderBottomWidth=b[l].width.R(c));a.tb=!0;break;case "border-top-left-radius":a.borderTopLeftRadius=b[l].map(function(z){return z.R(c)});a.xd=!0;break;case "border-top-right-radius":a.borderTopRightRadius=b[l].map(function(z){return z.R(c)});a.xd=!0;break;case "border-bottom-right-radius":a.borderBottomRightRadius=
b[l].map(function(z){return z.R(c)});a.xd=!0;break;case "border-bottom-left-radius":a.borderBottomLeftRadius=b[l].map(function(z){return z.R(c)});a.xd=!0;break;case "border-radius":a.borderTopLeftRadius=[b[l][0].R(c),b[l][4].R(c)];a.borderTopRightRadius=[b[l][1].R(c),b[l][5].R(c)];a.borderBottomRightRadius=[b[l][2].R(c),b[l][6].R(c)];a.borderBottomLeftRadius=[b[l][3].R(c),b[l][7].R(c)];a.xd=!0;break;case "background-color":case "background":a.backgroundColor=b[l];break;case "color":a.color=b[l];break;
case "font":a.fontFamily=b[l].fontFamily;a.fontSize=b[l].fontSize.R(c);a.fontStyle=b[l].fontStyle;a.fontWeight=b[l].fontWeight;break;case "font-family":a.fontFamily=b[l];break;case "font-size":a.fontSize=b[l].R(c);break;case "font-style":a.fontStyle=b[l];break;case "font-weight":a.fontWeight=b[l];break;case "overflow":a.scroll="scroll"===b[l];break;case "vertical-align":a.verticalAlign=b[l]instanceof ud?b[l].R(c):b[l];break;case "box-shadow":null!==b[l].Nb&&(a.Nb=b[l].offset.map(function(z){return z?
z.R(c):0}),a.cd=b[l].Qe?b[l].Qe.R(c):0,a.Qd=b[l].lf?b[l].lf.R(c):0,a.shadowColor=b[l].color);break;case "width":d=b[l].R(c);break;case "min-width":f=b[l].R(c);break;case "max-width":h=b[l].R(c);break;case "height":e=b[l].R(c);break;case "min-height":g=b[l].R(c);break;case "max-height":k=b[l].R(c)}d=Math.max(Math.min(d,h),f);e=Math.max(Math.min(e,k),g);0<=d&&(a.width=d);0<=e&&(a.height=e)}M.setPosition=function(a,b){this.x=a+this.offsetLeft();this.y=b+this.offsetTop()};
function mc(a){return a.width+ed(a)}M.oa=function(){return this.height+(this.marginTop+this.borderTopWidth+this.paddingTop+this.paddingBottom+this.borderBottomWidth+this.marginBottom)};M.oc=function(a){this.width=a-(this.marginLeft+this.borderLeftWidth+this.paddingLeft+this.paddingRight+this.borderRightWidth+this.marginRight)};M.cc=function(a){this.height=a-(this.marginTop+this.borderTopWidth+this.paddingTop+this.paddingBottom+this.borderBottomWidth+this.marginBottom)};
M.pb=function(){var a=new Bd;a.width=this.width;a.height=this.height;a.x=this.x;a.y=this.y;a.marginLeft=this.marginLeft;a.marginRight=this.marginRight;a.marginTop=this.marginTop;a.marginBottom=this.marginBottom;a.tb=this.tb;a.xd=this.xd;a.borderLeftWidth=this.borderLeftWidth;a.borderRightWidth=this.borderRightWidth;a.borderTopWidth=this.borderTopWidth;a.borderBottomWidth=this.borderBottomWidth;a.borderLeftStyle=this.borderLeftStyle;a.borderRightStyle=this.borderRightStyle;a.borderTopStyle=this.borderTopStyle;
a.borderBottomStyle=this.borderBottomStyle;a.borderLeftColor=this.borderLeftColor;a.borderRightColor=this.borderRightColor;a.borderTopColor=this.borderTopColor;a.borderBottomColor=this.borderBottomColor;a.borderTopLeftRadius=this.borderTopLeftRadius;a.borderTopRightRadius=this.borderTopRightRadius;a.borderBottomRightRadius=this.borderBottomRightRadius;a.borderBottomLeftRadius=this.borderBottomLeftRadius;a.paddingLeft=this.paddingLeft;a.paddingRight=this.paddingRight;a.paddingTop=this.paddingTop;a.paddingBottom=
this.paddingBottom;a.backgroundColor=this.backgroundColor;a.color=this.color;a.fontFamily=this.fontFamily;a.fontSize=this.fontSize;a.fontStyle=this.fontStyle;a.fontWeight=this.fontWeight;a.scroll=this.scroll;a.verticalAlign=this.verticalAlign;a.Nb=this.Nb;a.cd=this.cd;a.Qd=this.Qd;a.shadowColor=this.shadowColor;return a};M.offsetLeft=function(){return this.marginLeft+this.borderLeftWidth+this.paddingLeft};
function ed(a){return a.marginLeft+a.borderLeftWidth+a.paddingLeft+a.paddingRight+a.borderRightWidth+a.marginRight}M.offsetTop=function(){return this.marginTop+this.borderTopWidth+this.paddingTop};function Tc(a){return a.width+a.paddingLeft+a.paddingRight}function Uc(a){return a.height+a.paddingTop+a.paddingBottom}function tc(a){return(a.fontStyle?a.fontStyle+" ":"")+(a.fontWeight?a.fontWeight+" ":"")+a.fontSize.toFixed(1)+"px "+a.fontFamily}
function Cd(a,b){this.margin=0;this.$d=this.style=this.width=null;this.color="black";this.Nb=null;this.Qd=this.cd=0;this.shadowColor=null;a&&Ed(this,a.Nc,b);null===this.width&&(this.width=null!==this.style&&"none"!==this.style?1:0);null===this.style&&(this.style=0<this.width?"solid":"none");null===this.$d&&(this.$d="butt")}Cd.prototype=Object.create(yd.prototype);Cd.prototype.constructor=Cd;
function Ed(a,b,c){for(var d in b)switch(d){case "margin":a.margin=b[d].R(c);break;case "line-width":a.width=b[d].R(c);break;case "line-style":a.style=b[d];break;case "line-cap":a.$d=b[d];break;case "color":a.color=b[d];break;case "line":null!==b[d].color&&(a.color=b[d].color);null!==b[d].style&&(a.style=b[d].style);null!==b[d].width&&(a.width=b[d].width.R(c));break;case "line-shadow":null!==b[d].Nb&&(a.Nb=b[d].offset.map(function(e){return e?e.R(c):0}),a.cd=b[d].Qe?b[d].Qe.R(c):0,a.Qd=b[d].lf?b[d].lf.R(c):
0,a.shadowColor=b[d].color)}}Cd.prototype.pb=function(){var a=new Cd;a.margin=this.margin;a.width=this.width;a.style=this.style;a.$d=this.$d;a.color=this.color;a.Nb=this.Nb;a.cd=this.cd;a.Qd=this.Qd;a.shadowColor=this.shadowColor;return a};var Fd=!1;function Gd(a,b,c,d){a.strokeStyle=c||"black";switch(d){case "dotted":a.setLineDash([2*b,3*b]);a.lineDashOffset=0;break;case "dashed":a.setLineDash([3*b,3*b]),a.lineDashOffset=0}a.lineWidth=b||0}
function pc(a,b,c,d,e){function f(){var l=Math.min(g.borderTopLeftRadius[0],h/2),z=Math.min(g.borderTopLeftRadius[1],k/2);b.moveTo(c,d+z);b.bezierCurveTo(c,d+z/2,c+l/2,d,c+l,d);l=Math.min(g.borderTopRightRadius[0],h/2);z=Math.min(g.borderTopRightRadius[1],k/2);b.lineTo(c+h-l,d);b.bezierCurveTo(c+h-l/2,d,c+h,d+z/2,c+h,d+z);l=Math.min(g.borderBottomRightRadius[0],h/2);z=Math.min(g.borderBottomRightRadius[1],k/2);b.lineTo(c+h,d+k-z);b.bezierCurveTo(c+h,d+k-z/2,c+h-l/2,d+k,c+h-l,d+k);l=Math.min(g.borderBottomLeftRadius[0],
h/2);z=Math.min(g.borderBottomLeftRadius[1],k/2);b.lineTo(c+l,d+k);b.bezierCurveTo(c+l/2,d+k,c,d+k-z/2,c,d+k-z);b.closePath()}e||(c-=a.paddingLeft,d-=a.paddingTop);var g=a,h=a.width+a.paddingLeft+a.paddingRight,k=a.height+a.paddingTop+a.paddingBottom;Fd&&(b.save(),b.strokeStyle="black",b.lineWidth=1,b.strokeRect(c,d,h,k),b.strokeRect(c+a.paddingLeft,d+a.paddingTop,a.width,a.height),b.strokeRect(c-a.marginLeft,d-a.marginTop,h+a.marginLeft+a.marginRight,k+a.marginTop+a.marginBottom),b.restore());b.save();
b.beginPath();a.xd?(b.beginPath(),f()):b.rect(c,d,h,k);b.save();a.Nb&&(b.shadowOffsetX=a.Nb[0],b.shadowOffsetY=a.Nb[1],b.shadowColor=a.shadowColor,b.shadowBlur=a.cd);a.backgroundColor?b.fillStyle=a.backgroundColor:a.Nb&&(b.fillStyle="transparent");b.fill();b.restore();a.tb?0<a.borderLeftWidth&&a.borderLeftColor&&"none"!==a.borderLeftStyle&&"hidden"!==a.borderLeftStyle&&(Gd(b,a.borderLeftWidth,a.borderLeftColor,a.borderLeftStyle),"double"===a.borderLeftStyle&&(b.save(),b.translate(c+h/2,d+k/2),b.scale((h-
3*a.borderLeftWidth)/h,(k-3*a.borderLeftWidth)/k),b.translate(-c-h/2,-d-k/2),f(),b.restore()),b.stroke()):(0<a.borderLeftWidth&&a.borderLeftColor&&"none"!==a.borderLeftStyle&&"hidden"!==a.borderLeftStyle&&(Gd(b,a.borderLeftWidth,a.borderLeftColor,a.borderLeftStyle),b.beginPath(),b.moveTo(c,d),b.lineTo(c,d+k),b.stroke()),0<a.borderRightWidth&&a.borderRightColor&&"none"!==a.borderRightStyle&&"hidden"!==a.borderRightStyle&&(Gd(b,a.borderRightWidth,a.borderRightColor,a.borderRightStyle),b.beginPath(),
b.moveTo(c+h,d),b.lineTo(c+h,d+k),b.stroke()),0<a.borderTopWidth&&a.borderTopColor&&"none"!==a.borderTopStyle&&"hidden"!==a.borderTopStyle&&(Gd(b,a.borderTopWidth,a.borderTopColor,a.borderTopStyle),b.beginPath(),b.moveTo(c,d),b.lineTo(c+h,d),b.stroke()),0<a.borderBottomWidth&&a.borderBottomColor&&"none"!==a.borderBottomStyle&&"hidden"!==a.borderBottomStyle&&(Gd(b,a.borderBottomWidth,a.borderBottomColor,a.borderBottomStyle),b.beginPath(),b.moveTo(c,d+k),b.lineTo(c+h,d+k),b.stroke()));b.restore()}
Bd.prototype.H=function(a){pc(this,a,this.x,this.y)};Cd.prototype.stroke=function(a){a.save();this.Nb&&(a.shadowOffsetX=this.Nb[0],a.shadowOffsetY=this.Nb[1],a.shadowColor=this.shadowColor,a.shadowBlur=this.cd);0<this.width&&this.color&&"none"!==this.style&&"hidden"!==this.style&&(Gd(a,this.width,this.color,this.style),a.lineCap=this.$d,a.stroke());a.restore()};function Jc(a,b,c,d,e,f,g,h,k,l){this.data=a;this.width=b;this.height=c;this.x=d;this.y=e;this.b=null;this.ha=[];this.o=f;this.g=null;this.l=this.Ra=!0;this.za=null;this.Jc=g||null;this.mb=h||null;this.lb=k||null;this.uf=this.gb=!1;this.P=this.doScroll=null;this.id=l||"";this.ce=this.na=this.M=this.w=null}Jc.prototype.clone=function(){var a=new Jc(this.data,this.width,this.height,this.x,this.y,this.o,this.Jc,this.mb,this.lb,this.id);a.g=this.g;return a};
Jc.prototype.H=function(a,b,c,d,e){var f=a.J,g=this.b&&void 0===b;g&&(f.save(),f.beginPath(),f.rect(this.b.x,this.b.y,this.b.Rc,this.b.Hc),f.clip(),b=this.b.Uf,c=this.b.Vf);d?this.g&&this.g(a,this,b||0,c||0,e):this.o&&this.o(a,this,b||0,c||0,e);g&&f.restore()};Jc.prototype.toDataURL=function(a,b,c){var d=document.createElement("canvas");b=b||1;d.width=b*this.width;d.height=b*this.height;b=new Ib(d,{qg:b});b.v=a;this.H(b);this.H(b,0,0,!0);return d.toDataURL(c||"image/png")};
function Hd(a){return a.b?{Hb:a.b.Uf,Ib:a.b.Vf}:{Hb:0,Ib:0}}
function Ib(a,b){function c(f){function g(r){var v=e.b.getBoundingClientRect(),p=Hd(r);r.ce=r.Jc.aa(e,r.data,r.width,r.height,v.left+r.x+p.Hb,v.top+r.y+p.Ib,h);return null!==r.ce?(r.Jc.Pa&&r.Jc.Pa(e,r.data,r.ce,r.width,r.height,v.left+r.x+p.Hb,v.top+r.y+p.Ib,h),e.na&&e.na(),e.qb?e.qb():Ob(e),Id=r.Jc.Pa?function(w,q){q?r.Jc.ef&&(r.Jc.ef(e,r.data,r.ce),e.na&&e.na(),e.qb?e.qb():Ob(e)):(r.Jc.Pa(e,r.data,r.ce,r.width,r.height,v.left+r.x+p.Hb,v.top+r.y+p.Ib,Jd(e,w,d)),e.na&&e.na(),e.qb?e.qb():Ob(e))}:null,
e.na&&e.na(),e.qb?e.qb():Ob(e),!0):!1}if(e.P){var h=Jd(e,f,d);if(Kd(e,h)){var k=e.xb;k.Jc&&g(k)}else if(e.xb)e.w=-1,e.xb=null,e.na&&e.na(),e.qb?e.qb():Ob(e);else{var l=Ld(e,h,!0);if(0<l.length){if(k=e.$a[l[0]],0<=e.w&&e.w!==l[0]&&(e.w=-1,e.xb=null),e.yb=Date.now(),(!k.Jc||(f instanceof MouseEvent?k.w:k.M)&&e.w!==l[0]||!g(k))&&k.l){var z=k.za?k.za(k):k,m=null;f=Hd(z);var x=h.x-f.Hb,n=h.y-f.Ib;Id=function(r,v,p){var w=Jd(e,r,d);if(v){if((p?k.M:k.w)&&k===e.$a[Ld(e,w,!1)[0]])e.w=l[0],e.xb=(p?k.M:k.w)(k,
p);else if(m&&m.mb&&(!m.lb||m.lb(m,z)))m.mb(m,z);else if(null==m||null==m.mb||m.lb&&!m.lb(m,z))for(v=0;v<e.za.length&&!e.za[v].mb(m,z,w.x,w.y);v++);Ob(e);e.b.style.cursor="default"}else{p=Ld(e,w,!1);m=null;r=!1;for(v=0;!r&&v<p.length;v++)m=e.$a[p[v]],r=m.mb&&(!m.lb||m.lb(m,z));r&&null!=m?(m.uf=!0,Ob(e),m.uf=!1):Ob(e);v=e.J;r&&!m.gb&&(p=Hd(m),Md(e,m.x+p.Hb,m.y+p.Ib,m.width,m.height,["drop-target"]));v.save();Nd(e);e.transform&&(v.translate(e.width/2,e.height/2),CanvasRenderingContext2D.prototype.transform.apply(v,
e.transform),v.translate(-e.width/2,-e.height/2));v.translate(e.l*e.ua.Y,e.g*e.ua.Z);v.globalAlpha=.5;z.H(e,w.x-x,w.y-n);z.ha.forEach(function(q){q.H(e,w.x-x,w.y-n);q.H(e,w.x-x,w.y-n,!0)});z.H(e,w.x-x,w.y-n,!0);v.restore();e.b.style.cursor=r?"copy":"default"}}}}else 0<=e.w&&(e.w=-1,e.xb=null,Ob(e))}}}var d=b&&b.qg||("devicePixelRatio"in window?window.devicePixelRatio:1);this.b=a;this.l=a.width/d;this.g=a.height/d;this.ua=b&&b.ua||{Y:0,pa:1,Z:0,la:1};this.width=this.l*(this.ua.pa-this.ua.Y);this.height=
this.g*(this.ua.la-this.ua.Z);this.P=!0;this.transform=this.gb=null;this.J=this.b.getContext("2d");this.Ra=this.state=null;this.za=[];this.yb=0;this.w=-1;this.xb=null;this.o={};this.clientData={};this.ba=b&&b.ba||new Hb;this.v=null;this.resize(this.width,this.height,b&&b.qg);this.ha={};var e=this;a.addEventListener("mousedown",c,!1);a.addEventListener("touchstart",function(f){var g=f.targetTouches;1===g.length&&(f.preventDefault(),c(g[0]),Od=g[0])},!1);a.addEventListener("wheel",function(f){function g(l){l.doScroll&&
(f.preventDefault(),l.doScroll(0===f.deltaMode?f.deltaX:1===f.deltaMode?10*f.deltaX:30*f.deltaX,0===f.deltaMode?f.deltaY:1===f.deltaMode?10*f.deltaY:30*f.deltaY))}if(e.P){var h=Jd(e,f,d);if(Kd(e,h))e.xb&&g(e.xb);else if(0>e.w){h=Ld(e,h,!0);for(var k=0;k<h.length;k++)if(null!=e.$a[h[k]].doScroll){g(e.$a[h[k]]);break}}}},!1);a.addEventListener("mousemove",function(f){if(e.P){var g=Jd(e,f,d);g=Ld(e,g,!0);for(var h=0;h<g.length;h++)if(null!=e.$a[g[h]].P){f.preventDefault();e.$a[g[h]].P();return}e.Ra&&
e.Ra()}},!1);this.$a=[];this.M=[];this.qb=this.na=null}function Vb(a,b){a.ua=b||{Y:0,pa:1,Z:0,la:1};a.width=a.l*(a.ua.pa-a.ua.Y);a.height=a.g*(a.ua.la-a.ua.Z)}function bd(a,b){for(var c=0;c<a.za.length;c++)if("delete"===a.za[c].tag){a.za[c].mb=b;return}a.za.push({tag:"delete",mb:b})}Ib.prototype.show=function(){this.P=!0};Ib.prototype.zc=function(){this.P=!1};function Pd(a,b){a.b.style.filter=b}function Qd(a,b){a.gb=b&&b.slice();a.transform=a.gb}
function Jd(a,b,c){var d=a.b.getBoundingClientRect();b={x:b.clientX*a.b.width/c/d.width,y:b.clientY*a.b.height/c/d.height,Tg:b.altKey};c=[b.x,b.y];c=[c[0]-a.l*a.ua.Y,c[1]-a.g*a.ua.Z];if(d=a.transform){var e=a.width/2;a=a.height/2;d=d.slice(0,4).concat(d[4]-e*d[0]-a*d[2]+e,d[5]-e*d[1]-a*d[3]+a);a=d[0]*d[3]-d[1]*d[2];a=[(d[3]*c[0]-d[2]*c[1]+d[2]*d[5]-d[3]*d[4])/a,(-d[1]*c[0]+d[0]*c[1]+d[1]*d[4]-d[0]*d[5])/a]}else a=c;b.x=a[0];b.y=a[1];return b}function Rd(a){a.na&&a.na();a.qb?a.qb():Ob(a)}
function Kc(a,b){return{j:a,kg:60,lg:120,gg:!1,ja:Math.max(1,Math.min(3,Math.round(a/40))),sf:Math.round(a/4).toString(10)+"px sans-serif",gh:"navy",hh:"#37f",fh:"#06f",c:b,sa:Math.max(1,Math.min(3,b/30)),Ng:"bold 15px sans-serif",Lf:"navy",Kf:"#ccc",Oc:5,vf:"#e44",Tf:"#f88",Jf:"#bbb"}}
function $c(a,b){a.width=a.l*(a.ua.pa-a.ua.Y);a.height=a.g*(a.ua.la-a.ua.Z);a.J=a.b.getContext("2d");b=b||("devicePixelRatio"in window?window.devicePixelRatio:1);1!=b&&(a.J.resetTransform(),a.J.scale(b,b));a.ba.b=new wd(a.width,a.width/100,a.height/100,a.l/100,a.g/100);b=sc(a.ba,{tag:"block"}).width;var c=sc(a.ba,{tag:"button"}).width;a.v=Kc(b,c)}
Ib.prototype.resize=function(a,b,c){var d=c||("devicePixelRatio"in window?window.devicePixelRatio:1);this.b.width=a*d;this.b.height=b*d;this.l=a;this.g=b;$c(this,c)};function Nc(a,b){for(var c=0;c<a.$a.length;c++)if(a.$a[c].data===b)return c;return-1}
function Ld(a,b,c){var d=a.b.getBoundingClientRect(),e=b.x-d.left;b=b.y-d.top;d=[];for(var f=a.$a.length-1;0<=f;f--){var g=Hd(a.$a[f]);if(g=(!c||a.$a[f].Ra)&&e>=a.$a[f].x+g.Hb&&e<=a.$a[f].x+g.Hb+a.$a[f].width&&b>=a.$a[f].y+g.Ib&&b<=a.$a[f].y+g.Ib+a.$a[f].height)g=a.$a[f],g=!g.b||e>=g.b.x&&e<g.b.x+g.b.Rc&&b>=g.b.y&&b<g.b.y+g.b.Hc;g&&d.push(f)}return d}
function ic(a,b){var c=b.clone();a=ad(a);var d=Math.min(a.width,a.height)/1.5/c.width;c.width*=d;c.height*=d;c.x=(a.width-c.width)/2;c.y=(a.height-c.height)/2;c.w=null;c.M=null;c.o=function(e,f){var g=e.J;g.save();g.translate(f.x,f.y);g.scale(d,d);g.translate(-f.x,-f.y);b.o(e,c,f.x-c.x,f.y-c.y,!0);g.restore()};b.g&&(c.g=function(e,f){var g=e.J;g.save();g.translate(f.x,f.y);g.scale(d,d);g.translate(-f.x,-f.y);b.g(e,c,f.x-c.x,f.y-c.y,!0);g.restore()});return c}
function Kd(a,b){if(null==a.xb)return!1;var c=a.b.getBoundingClientRect(),d=b.x-c.left;b=b.y-c.top;return d>=a.xb.x&&d<=a.xb.x+a.xb.width&&b>=a.xb.y&&b<=a.xb.y+a.xb.height}function ad(a){return{width:a.width,height:a.height}}function Nd(a){a.J.beginPath();a.J.rect(a.l*a.ua.Y,a.g*a.ua.Z,a.l*(a.ua.pa-a.ua.Y),a.g*(a.ua.la-a.ua.Z));a.J.clip()}
function Sd(a,b,c,d,e,f,g){f=f||0;g=g||0;if(0<a.M.length){var h=a.M[a.M.length-1];h.x>b&&(d-=h.x-b,b=h.x);h.x+h.Rc<b+d&&(d=h.x+h.Rc-b);h.y>c&&(e-=h.y-c,c=h.y);h.y+h.Hc<c+e&&(e=h.y+h.Hc-c);f+=h.Uf;g+=h.Vf}a.M.push({x:b,y:c,Rc:d,Hc:e,Uf:f,Vf:g})}function Mc(a,b,c){0<a.M.length&&(b.b=a.M[a.M.length-1]);0<=c?a.$a[c]=b:a.$a.push(b)}function oc(a,b){var c=new Jc(null,-1,-1,0,0,function(d,e,f,g){d=d.J;d.save();d.translate(e.x+f,e.y+g);b(d);d.restore()});Mc(a,c);return c}
function qc(a,b,c,d,e,f,g,h,k,l){var z,m=new Jc(null,d.width,d.height,b,c,function(x,n,r,v){x=x.J;x.save();pc(d,x,n.x+r,n.y+v);x.translate(n.x+r,n.y+v);e(x,d,a.o.id===l&&a.o.sd||n.uf);x.restore()},f?{aa:function(x,n,r,v,p,w,q){a.o={id:l,rect:{x:m.x,y:m.y,Rc:r,Hc:v},sd:!0};z=q;Ob(a);return 0},Pa:function(x,n,r,v,p,w,q,t){r=x.b.getBoundingClientRect();n=t.x-r.left;t=t.y-r.top;a.o.sd=n>=a.o.rect.x&&n<a.o.rect.x+a.o.rect.Rc&&t>=a.o.rect.y&&t<a.o.rect.y+a.o.rect.Hc;Ob(x)},ef:function(){a.o.sd&&f(z);a.o=
{};Ob(a)}}:null,g,h,l);m.P=k||null;m.l=!1;m.gb=!0;Mc(a,m);return m}function Vc(a,b,c,d,e){pc(e,a.J,c-e.width/2,d-e.height/2);var f=a.ha[b];void 0!=f&&(a.J.save(),a.J.translate(c,d),f(a.J,b,a.v,e),a.J.restore())}
function Ob(a){a.P&&(a.J.clearRect(a.l*a.ua.Y,a.g*a.ua.Z,a.l*(a.ua.pa-a.ua.Y),a.g*(a.ua.la-a.ua.Z)),a.J.save(),a.transform&&(a.J.translate(a.width/2,a.height/2),CanvasRenderingContext2D.prototype.transform.apply(a.J,a.transform),a.J.translate(-a.width/2,-a.height/2)),a.J.translate(a.l*a.ua.Y,a.g*a.ua.Z),a.$a.forEach(function(b){b.H(this)},a),a.$a.forEach(function(b){b.H(this,void 0,void 0,!0)},a),a.xb&&(a.J.save(),a.J.globalAlpha=.5,a.J.fillStyle="black",a.J.fillRect(a.l*a.ua.Y,a.g*a.ua.Z,a.l*(a.ua.pa-
a.ua.Y),a.g*(a.ua.la-a.ua.Z)),a.J.restore(),a.xb.H(a),a.xb.H(a,0,0,!0)),a.J.restore())};function Fc(){this.w=this.M=1;this.b=this.g=this.y=this.x=0;this.P=!1;this.za="";this.Ud=this.l=this.Td=this.o=0;this.ha=null}M=Fc.prototype;M.oc=function(a){this.M=a;this.o=Math.max(0,Math.min(this.o,this.M-this.g))};M.cc=function(a){this.w=a;this.l=Math.max(0,Math.min(this.l,this.w-this.b))};M.resize=function(a,b,c,d){this.x=a;this.y=b;this.g=c;this.b=d;this.o=Math.max(0,Math.min(this.o,this.M-this.g));this.l=Math.max(0,Math.min(this.l,this.w-this.b))};
M.Fd=function(a){this.ha=a;var b=this,c=new Jc(null,this.g,this.b,this.x,this.y,null,this.M>this.g||this.w>this.b?{aa:function(d,e,f,g,h,k,l){b.Td=l.x;b.Ud=l.y;return 0},Pa:function(d,e,f,g,h,k,l,z){d=Math.max(Math.min(z.x-b.Td,b.o),b.o-b.M+b.g);b.o-=d;b.Td+=d;z=Math.max(Math.min(z.y-b.Ud,b.l),b.l-b.w+b.b);b.l-=z;b.Ud+=z}}:null,null,null);c.l=!1;c.doScroll=function(d,e){b.o+=d;b.l+=e;a.na()};Mc(a,c);this.za&&oc(a,function(d){d.save();d.fillStyle=b.za;d.fillRect(b.x,b.y,b.g,b.b);d.restore()});(this.M>
this.g||this.w>this.b)&&oc(a,function(d){d.save();if(b.M>b.g){var e=b.g/b.M;e=Math.max(e*b.g,Math.min(20,b.g));var f=b.g-e,g=b.o/(b.M-b.g);f*=g;d.fillStyle=a.v.Kf;d.fillRect(b.x,b.y+b.b+2,b.g,a.v.Oc);d.fillStyle=a.v.Lf;d.fillRect(b.x+f,b.y+b.b+2,e,a.v.Oc)}b.w>b.b&&(e=b.b/b.w,e=Math.max(e*b.b,Math.min(20,b.b)),f=b.b-e,g=b.l/(b.w-b.b),f*=g,d.save(),d.fillStyle=a.v.Kf,d.fillRect(b.P?b.x-2-a.v.Oc:b.x+b.g+2,b.y,a.v.Oc,b.b),d.fillStyle=a.v.Lf,d.fillRect(b.P?b.x-2-a.v.Oc:b.x+b.g+2,b.y+f,a.v.Oc,e));d.restore()});
Sd(a,this.x,this.y,this.g,this.b,-this.o,-this.l)};M.end=function(){this.ha.M.pop()};function cd(a){return a.l<=.001*a.b}function dd(a){return a.l>=a.w-1.001*a.b};function Md(a,b,c,d,e,f){f=sc(a.ba,{tag:"overlay-rectangle",W:f||[]});f.x=b;f.y=c;f.width=d;f.height=e;f.H(a.J)}function zc(a,b,c,d,e,f,g,h){Md(a,b,c,d,e,(f||[]).concat("disabled"));sc(a.ba,{tag:"overlay-rectangle",W:f||[]});h||(a.J.save(),f=Xc(a.ba,{tag:"crossout-line",W:g||[]}),g=.1*Math.min(d,a.v.j),a.J.beginPath(),a.J.moveTo(b-g,c+.7*e),a.J.lineTo(b+d+g,c+.3*e),f.stroke(a.J),a.J.restore())}
function uc(a,b,c,d,e,f){a.save();a.strokeStyle=e;a.fillStyle=e;a.lineWidth=d;a.fillRect(b-2.5*d,c-d,5*d,4*d);a.beginPath();a.moveTo(b-1.7*d,c);a.lineTo(b-1.7*d,c);f?(a.arc(b-3.4*d,c-2*d,1.7*d,0,Math.PI,!0),a.lineTo(b-5.1*d,c)):(a.arc(b,c-2*d,1.7*d,-Math.PI,0),a.lineTo(b+1.7*d,c));a.stroke();a.restore()}function Lc(a,b,c,d,e,f,g){var h=.03*a.v.j;uc(a.J,b+d+(f?-5:5)*h,c+.15*e,h,g||"#333")}
function wc(a,b,c,d,e,f,g){a.save();g&&(g.style&&(a.strokeStyle=g.style,a.fillStyle=g.style),void 0!==g.lineWidth&&(a.lineWidth=g.lineWidth),void 0!==g.alpha&&(a.globalAlpha=g.alpha));var h=g&&void 0!==g.Uc?g.Uc:5*a.lineWidth;a.beginPath();var k=e+(g&&g.Dd?h/d:0),l=f-(g&&g.Dd?0:h/d);a.arc(b,c,d,k,l);a.stroke();g&&g.Dd?(a.translate(b+d*Math.cos(e),c+d*Math.sin(e)),a.rotate((e+k)/2+Math.PI)):(a.translate(b+d*Math.cos(f),c+d*Math.sin(f)),a.rotate((f+l)/2));a.beginPath();a.moveTo(0,0);a.lineTo(h/2,1.2*
-h);a.lineTo(-h/2,1.2*-h);a.fill();a.restore()}Ib.prototype.text=function(a,b){var c=this.J,d=this.v;c.save();c.fillStyle=b&&b.fillStyle||"white";c.font=d.sf;c.textAlign="center";c.textBaseline="middle";c.translate(.5*d.j+(b&&b.x||0),.5*d.j-(b&&b.y||0));b&&b.Vg&&c.rotate(-b.Vg);c.translate(-.5*d.j,-.5*d.j);c.fillText(a,.5*d.j,.5*d.j);c.restore()};
function Td(a,b){var c=a.J,d=a.v;c.save();c.beginPath();c.rect(0,0,a.v.j,a.v.j);c.clip();b&&(b.scale||b.rotation)&&(b.mf&&c.translate(-b.mf[0],-b.mf[1]),c.translate(.5*d.j,.5*d.j),b.scale&&c.scale(b.scale,b.scale),b.rotation&&c.rotate(-b.rotation),c.translate(-.5*d.j,-.5*d.j));c.beginPath();c.moveTo(.5*d.j,d.j-d.ja);b&&"left"===b.Ge||(c.lineTo(d.j-d.ja,d.j-d.ja),c.lineTo(d.j-d.ja,.25*d.j),c.bezierCurveTo(.8*d.j,d.ja,.52*d.j,d.ja,.5*d.j,d.ja));b&&"right"===b.Ge||(c.lineTo(.5*d.j,d.ja),c.bezierCurveTo(.48*
d.j,d.ja,.2*d.j,d.ja,d.ja,.25*d.j),c.lineTo(d.ja,d.j-d.ja));c.closePath();if(b&&b.Vb){a=[b.Vb[0],Math.max(.2+.8*b.Vb[1],b.Vb[2]/2),b.Vb[2]];var e=Math.max(a[0],Math.max(a[1],a[2]));c.fillStyle="rgb("+a.map(function(f){return Math.round(225*(1-e)+(30+225*e)*f)}).join(",")+")"}else c.fillStyle="white";c.fill();b&&b.Vb&&(c.strokeStyle="white",c.lineWidth=d.ja,c.stroke());b&&b.ic&&(c.fillStyle="black",c.fillRect(0,.6*d.j,.1*d.j,.35*d.j),c.fillRect(.9*d.j,.6*d.j,.1*d.j,.35*d.j));c.restore()}
function Ud(a,b){var c=(b-a)/2,d=b===a?Infinity:(b+a)/(2*c);return{bb:c,pf:d,x:Math.abs(d)>1E3*Math.abs(a+b)?0:d*(.01>c?c*c/2:1-Math.cos(c)),y:Math.abs(d)>1E3*Math.abs(a+b)?(a+b)/2:d*Math.sin(c)}}
function Vd(a,b,c,d,e){var f=a.J;a=a.v;d*=a.j;var g=e&&e.r||[-1,0,1],h=e&&e.color||"black";e=e&&void 0!==e.Ae?e.Ae:1;var k=Ud(b,c);f.save();f.translate(.5*a.j,.5*a.j);f.strokeStyle=h;f.lineWidth=a.ja*e;20<Math.abs(k.pf)?(f.beginPath(),g.forEach(function(l){f.moveTo(l*d,0);f.lineTo((k.x+l)*d,-k.y*d)}),f.stroke()):g.forEach(function(l){f.beginPath();var z=-k.pf*d;l=(k.pf+l)*d;var m=k.bb;0<l?f.arc(z,0,l,0,-m,0<m):0>l&&f.arc(z,0,-l,Math.PI,Math.PI-m,0<m);f.stroke()});f.restore();return k}
function Wd(a,b,c,d,e,f,g){a=a.v;e*=a.j;f*=a.j;a=.21*a.j;c=g.x-c-b/2;b=d+b/2-g.y;e=Ud(e,f);return(c-e.x)*(c-e.x)+(b-e.y)*(b-e.y)<a*a}
function Xd(a){var b=a.J;a=a.v;b.save();b.translate(.5*a.j,.5*a.j);b.scale(.7,.7);b.translate(-.5*a.j,-.5*a.j);b.fillStyle="white";b.fillRect(a.ja,.45*a.j,a.j-2*a.ja,.35*a.j);b.fillStyle="black";b.beginPath();b.arc(.27*a.j,.72*a.j,.2*a.j,0,2*Math.PI);b.fill();b.fillStyle="white";b.beginPath();b.arc(.27*a.j,.72*a.j,.12*a.j,0,2*Math.PI);b.fill();b.beginPath();b.arc(.8*a.j,.8*a.j-a.ja,.1*a.j,0,2*Math.PI);b.fill();b.restore()}
function Yd(a){var b=a.J;a=a.v;b.save();b.lineWidth=a.ja;b.strokeStyle="white";for(var c=1;3>=c;c++)b.beginPath(),b.arc(.185*a.j,.48*a.j,.05*a.j*c,.9*Math.PI,1.7*Math.PI),b.stroke();b.restore()}
Ib.prototype.buttons=function(a,b,c){var d=this.J,e=this.v;a.forEach(function(f,g){d.save();d.translate(e.j*(.5+f.x),e.j*(.5-f.y));d.rotate(f.r||0);d.fillStyle=f.fillStyle?f.fillStyle:b&&!0===b[g]?"red":b&&1===b[g]?"#f66":b&&-1===b[g]?"#333":"white";d.strokeStyle=f.strokeStyle?f.strokeStyle:!b||1!==b[g]&&!0!==b[g]?b&&0>b[g]?"black":"#aaa":"#700";d.lineWidth=e.ja;d.lineJoin="round";var h=f.size||1;switch(f.G){case "r":d.fillRect(.08*-e.j*h,.08*-e.j*h,.16*e.j*h,.16*e.j*h);d.strokeRect(.08*-e.j*h,.08*
-e.j*h,.16*e.j*h,.16*e.j*h);break;case "t":d.beginPath();d.moveTo(0,-.122*e.j*h);d.lineTo(.106*e.j*h,.062*e.j*h);d.lineTo(-.106*e.j*h,.062*e.j*h);d.closePath();d.fill();d.stroke();break;case "c":d.beginPath(),d.arc(0,0,.112*e.j*h,0,2*Math.PI),d.fill(),d.stroke()}b&&-1===b[g]&&c&&c.ae&&(d.strokeStyle="white",d.beginPath(),d.moveTo(.06*-e.j*h,.06*-e.j*h),d.lineTo(.06*e.j*h,.06*e.j*h),d.moveTo(.06*-e.j*h,.06*e.j*h),d.lineTo(.06*e.j*h,.06*-e.j*h),d.stroke());d.restore()})};
function Zd(a,b,c,d,e,f,g,h,k){var l=a.J;a=a.v;l.save();l.strokeStyle="black";l.lineWidth=a.ja*k;k=b.length/2;for(var z=0;z<k;z++)0<b[2*z+1]&&(l.fillStyle=2===b[2*z+1]?"white":"black",l.beginPath(),l.arc(a.j*(c+(d-c)/k*(z+.5)),a.j*(e+(f-e)/g*(b[2*z]+.5)),a.j*h/2,0,2*Math.PI),l.fill(),l.stroke());l.restore()}
function $d(a,b){var c=a.J,d=a.v,e=null===b?-.15*d.j:0;c.save();c.beginPath();c.moveTo(.4*d.j+e,.3*d.j);c.lineTo(.4*d.j+e,.7*d.j);c.lineTo(.7*d.j+e,.7*d.j);c.lineTo(.7*d.j+e,.37*d.j);c.lineTo(.63*d.j+e,.3*d.j);c.closePath();c.lineWidth=d.ja;c.strokeStyle="white";c.lineJoin="round";c.stroke();for(var f=.15;.31>f;f+=.06)c.beginPath(),c.arc(.65*d.j+e,.5*d.j,d.j*f,-.6,.6),c.stroke();null===b?(c.beginPath(),c.moveTo(.12*d.j,.6*d.j),c.lineTo(.88*d.j,.4*d.j),c.lineWidth=1.5*d.ja,c.stroke()):a.text(b.toString(10),
{x:-.3*d.j});c.restore()}function ae(a){var b=a.J;a=a.v;b.beginPath();b.arc(0,0,.4*a.j,0,2*Math.PI,!0);b.moveTo(0,0);b.lineTo(0,.4*-a.j);b.strokeStyle="#666";b.lineWidth=a.ja;b.stroke();b.beginPath();b.arc(0,.4*-a.j,.1*a.j,0,2*Math.PI);b.fillStyle="white";b.fill();b.strokeStyle="black";b.stroke()}
function be(a,b,c){var d=a.J,e=a.v;c=c*Math.PI/12;d.save();d.translate(.5*e.j,.5*e.j);d.rotate(c);ae(a);d.fillRect(-.28*e.j,-.1*e.j,.56*e.j,.2*e.j);d.fillStyle="black";b?(d.beginPath(),d.arc(-.15*e.j,.03*e.j,.11*e.j,0,2*Math.PI),d.fill(),d.fillStyle="white",d.beginPath(),d.arc(-.15*e.j,.03*e.j,.07*e.j,0,2*Math.PI),d.fill(),d.beginPath(),d.arc(.15*e.j,.07*e.j,.06*e.j,0,2*Math.PI)):(d.fillRect(-.28*e.j,.1*e.j,.08*e.j,.04*e.j),d.fillRect(.2*e.j,.1*e.j,.08*e.j,.04*e.j),d.fillStyle="white",d.beginPath(),
d.arc(0,.06*e.j,.06*e.j,0,2*Math.PI));d.fill();d.restore()}function ce(a,b,c,d,e){b=d.x-b-a/2;c=c+a/2-d.y;a=(b*b+c*c)/(a*a/4);return 1>a&&.4<a&&(e||0<=c)}function de(a,b,c,d,e){a=Math.round(12*Math.atan2(d.x-b-a/2,c+a/2-d.y)/Math.PI);return e?12===a?-12:a:Math.max(-6,Math.min(6,a))}
function ee(a,b,c,d,e,f,g,h,k){var l=k?0>=g?0:Math.max(Math.log(10*g)/Math.log(100),0):g/4;a.save();!h&&f&&f(g);a.beginPath();a.arc(b,c,d,0,2*Math.PI);a.fillStyle="white";a.fill();f=.9*d;g=k?.8*d:.6*d;var z=2*Math.PI*(h?.2:l),m=h?"#ddd":"red";k=(g-(k?.5*d:.6*d))/4;a.save();a.beginPath();a.arc(b,c,f,-Math.PI/2,3*Math.PI/2-.05);a.arc(b,c,g-4*k,3*Math.PI/2-.05,Math.PI,!0);a.arc(b+k,c,g-3*k,Math.PI,Math.PI/2,!0);a.arc(b+k,c-k,g-2*k,Math.PI/2,0,!0);a.arc(b,c-k,g-k,0,-Math.PI/2,!0);a.clip();a.fillStyle=
m;a.beginPath();a.arc(b,c,f,-Math.PI/2,-Math.PI/2+z);a.lineTo(b,c);a.fill();a.restore();a.beginPath();a.arc(b,c,d/2,0,2*Math.PI);a.fill();a.beginPath();a.arc(b,c,d,0,2*Math.PI);a.strokeStyle="black";a.lineWidth=e;a.stroke();a.beginPath();a.moveTo(b-.1*d*Math.sin(2*l*Math.PI),c+.1*d*Math.cos(2*l*Math.PI));a.lineTo(b+.9*d*Math.sin(2*l*Math.PI),c-.9*d*Math.cos(2*l*Math.PI));a.lineWidth=2*e;a.stroke();h&&wc(a,b,c,1.25*d,.5*-Math.PI,.1*-Math.PI,{Dd:!0,Uc:5*e,style:"black"});a.restore()}
function fe(a,b,c,d){var e=a.J,f=a.v.j;ee(e,f/2+(c?-.05*f:.05*f),f/2+(c?.07*f:.03*f),.4*f,a.v.ja,function(g){e.textAlign="start";e.textBaseline="top";e.font=Math.round(f/6).toString(10)+"px sans-serif";e.fillStyle="white";e.fillText(g.toFixed(1>g?2:1),f/20,f/40)},b,c,d)}
function ge(a,b,c,d,e,f,g,h,k,l){var z=(d+e)/2,m=(e-d)/2;a.save();a.beginPath();a.arc(b,c,d,-g,-f);a.arc(b+z*Math.cos(f),c-z*Math.sin(f),m,-f-Math.PI,-f,!0);a.arc(b,c,e,-f,-g,!0);a.arc(b+z*Math.cos(g),c-z*Math.sin(g),m,-g,-g+Math.PI,!0);a.fillStyle=h;a.strokeStyle=k;a.lineWidth=l;a.fill();a.stroke();a.restore()}function he(a,b,c,d){var e=a.v;ge(a.J,e.j/2,e.j/2,.3*e.j,.45*e.j,b,c,0>d?"white":2===d?"red":0<d?"#f70":"#ddd",0===d?"#bbb":"black",e.ja)}
function ie(a,b){var c=a.J;c.save();he(a,.65*Math.PI,.85*Math.PI,b[0]);he(a,.15*Math.PI,.35*Math.PI,b[1]);he(a,1.15*Math.PI,1.35*Math.PI,b[2]);he(a,1.65*Math.PI,1.85*Math.PI,b[3]);c.restore()}function je(a,b){var c=a.J;c.save();for(var d=0;8>d;d++)he(a,Math.PI*(.46-.25*d),Math.PI*(.54-.25*d),d===b?1:-1);c.restore()}function ke(a,b,c,d,e,f){b=(f.x-d)/b-.5;c=.5-(f.y-e)/c;for(e=0;e<a.length;e++)if(Math.max(Math.abs(b-a[e].x),Math.abs(c-a[e].y))<.11*(a[e].size||1))return e;return null}
function le(a,b,c,d,e,f){function g(l,z){h.beginPath();h.moveTo(k.j*(.1+.8*l),k.j*(.46-c));h.lineTo(k.j*(.1+.8*z),k.j*(.46-c));h.arc(k.j*(.1+.8*z),k.j*(.5-c),.04*k.j,-Math.PI/2,Math.PI/2);h.lineTo(k.j*(.1+.8*z),k.j*(.54-c));h.lineTo(k.j*(.1+.8*l),k.j*(.54-c));h.arc(k.j*(.1+.8*l),k.j*(.5-c),.04*k.j,Math.PI/2,-Math.PI/2)}var h=a.J,k=a.v;h.save();d&&(h.translate(.5*k.j,.5*k.j),h.rotate(-Math.PI/2),h.scale(1,-1),h.translate(-.5*k.j,-.5*k.j));h.lineWidth=k.ja;h.fillStyle="white";h.strokeStyle="black";
g(0,1);h.fill();h.stroke();h.fillStyle=e;switch(f||0){case 1:g(0,b);h.fill();h.stroke();break;case 2:g(b,1),h.fill(),h.stroke()}h.fillStyle=e;h.strokeStyle="black";h.lineWidth=k.ja;h.beginPath();h.arc(k.j*(.1+.8*b),k.j*(.5-c),.1*k.j,0,2*Math.PI);h.fill();h.stroke();h.restore()}function me(a,b,c,d,e,f,g){c=(g.x-e)/c-.5;d=.5-(g.y-f)/d;return.1>Math.abs((b?c:d)-a)}function ne(a,b,c,d,e,f){b=(f.x-d)/b-.5;c=.5-(f.y-e)/c;return.5+(a?c:b)/.8}
function oe(a,b,c,d,e,f,g,h,k,l,z){a=Math.floor(((z.x-k)/g-a)/((b-a)/e));c=Math.floor((c-(z.y-l)/h)/((c-d)/f));return 0<=a&&a<e&&0<=c&&c<f?{index:a,tone:c}:null}function pe(a,b,c,d,e){var f=.4*a;a=e.x-c-.55*a;b=d+.53*b-e.y;return a*a+b*b<=f*f}function qe(a,b,c,d,e,f){a=(Math.PI-Math.atan2(f.x-c-.55*a,-(d+.53*b-f.y)))/(2*Math.PI);return e?Math.exp(a*Math.log(100))/10:4*a}function re(a,b,c,d,e){c=e.x-c-a/2;b=b/2-(e.y-d);return Math.abs(Math.sqrt(c*c+b*b)-.375*a)<=.15*a?0<=b?0>c?0:1:0>c?2:3:null}
function se(a,b,c,d,e){c=e.x-c-a/2;b=b/2-(e.y-d);return Math.abs(Math.sqrt(c*c+b*b)-.375*a)<=.15*a?(a=Math.atan2(c,b)+Math.PI/8,Math.floor((0>a?a+2*Math.PI:a)/(Math.PI/4))):null}function vc(a,b,c,d){a.beginPath();a.moveTo(b+d*Math.cos(.1),c+d*Math.sin(.2));for(var e=1;6>e;e++)a.lineTo(b+d*Math.cos(e*Math.PI/3+.2),c+d*Math.sin(e*Math.PI/3+.2));a.closePath();a.arc(b,c,.5*d,0,2*Math.PI,!0);a.fill()};function ya(a){for(var b=0;b<Va.length;b++)if(Va[b].name===a)return Va[b];return null}function Ta(a){var b=[];(Va||[]).forEach(function(c){"h"!==c.type&&0<=c.ma.indexOf(a)&&b.push(c)});return b};var Va=[new qa({name:"!stop",type:"h"}),new qa(function(){var a=[{G:"c",x:0,y:0,r:0},{G:"t",x:0,y:.3,r:0},{G:"t",x:0,y:-.3,r:Math.PI},{G:"t",x:.3,y:0,r:Math.PI/2},{G:"t",x:-.3,y:0,r:-Math.PI/2}];return{name:"button 1",type:"e",ga:function(){return[0]},H:function(b,c){Td(b);c=c.h[0];b.buttons(a,[0==c,1==c,2==c,3==c,4==c])},aa:function(b,c,d,e,f,g,h){b=ke(a,d,e,f,g,h);null!==b&&(ta(c),c.h[0]=b);return b}}}()),new qa(function(){var a=[{G:"c",x:0,y:0,r:0},{G:"t",x:0,y:.3,r:0},{G:"t",x:0,y:-.3,r:Math.PI},
{G:"t",x:.3,y:0,r:Math.PI/2},{G:"t",x:-.3,y:0,r:-Math.PI/2}];return{name:"button",ma:["c"],type:"e",ga:function(){return[!1,!1,!1,!1,!1]},jb:function(){return[!1,!1,!0,!1,!0]},H:function(b,c){Td(b);b.buttons(a,c.h)},aa:function(b,c,d,e,f,g,h){b=ke(a,d,e,f,g,h);null!==b&&(ta(c),c.h[b]=!c.h[b]);return b},sc:function(b){for(var c=0;5>c;c++)if(b.h[c])return null;return new Ga("No button specified",!0)}}}()),new qa(function(){var a=[{G:"r",x:0,y:.4,r:0,A:"2"},{G:"r",x:-.22,y:.35,r:-.45,A:"1"},{G:"r",x:.22,
y:.35,r:.45,A:"3"},{G:"r",x:-.4,y:.22,r:-.8,A:"0"},{G:"r",x:.4,y:.22,r:.8,A:"4"},{G:"r",x:-.2,y:-.4,A:"5"},{G:"r",x:.2,y:-.4,A:"6"}];return{name:"horiz prox",ma:["b"],type:"e",ga:function(){return[0,0,0,0,0,0,0]},jb:function(){return[0,1,-1,1,-1,0,0]},H:function(b,c){Td(b);b.buttons(a,c.h,{ae:!0})},aa:function(b,c,d,e,f,g,h){b=ke(a,d,e,f,g,h);null!==b&&(ta(c),c.h[b]=(c.h[b]+2)%3-1);return b},sc:function(b){for(var c=0;7>c;c++)if(b.h[c])return null;return new Ga("No proximity sensor specified",!0)},
Fc:function(b,c){switch(c){case "a":return c=new sa(ya("horiz prox adv"),null,null),c.h=b.h.concat(c.h.slice(7)),c;default:return b}}}}()),new qa(function(){var a=[{G:"r",x:0,y:.4,r:0,A:"2"},{G:"r",x:-.22,y:.35,r:-.45,A:"1"},{G:"r",x:.22,y:.35,r:.45,A:"3"},{G:"r",x:-.4,y:.22,r:-.8,A:"0"},{G:"r",x:.4,y:.22,r:.8,A:"4"},{G:"r",x:-.2,y:-.4,A:"5"},{G:"r",x:.2,y:-.4,A:"6"}];return{name:"horiz prox adv",ma:["c"],type:"e",ga:function(){return[0,0,0,0,0,0,0,.4,.1]},jb:function(){return[0,1,-1,1,-1,0,0,.4,
.1]},H:function(b,c){Td(b);b.buttons(a,c.h,{ae:!0});le(b,c.h[7],.02,!1,"red",2);le(b,c.h[8],-.2,!1,"black",1)},aa:function(b,c,d,e,f,g,h){b=ke(a,d,e,f,g,h);return null!==b?(ta(c),c.h[b]=(c.h[b]+2)%3-1,b):me(.02,!1,d,e,f,g,h)?(ta(c),7):me(-.2,!1,d,e,f,g,h)?(ta(c),8):null},Pa:function(b,c,d,e,f,g,h,k){7<=d&&(c.h[d]=Math.max(0,Math.min(1,ne(!1,e,f,g,h,k))))},sc:function(b){for(var c=0;7>c;c++)if(b.h[c])return null;return new Ga("No sensor specified",!0)},Fc:function(b,c){switch(c){case "b":if(c=b.V.ga(),
b.h[7]===c[7]&&b.h[8]===c[8])return c=new sa(ya("horiz prox"),null,null),c.h=b.h.slice(0,7),c;default:return b}}}}()),new qa(function(){var a=[{G:"r",x:0,y:.4,r:0,A:"2"},{G:"r",x:-.22,y:.35,r:-.45,A:"1"},{G:"r",x:.22,y:.35,r:.45,A:"3"},{G:"r",x:-.4,y:.22,r:-.8,A:"0"},{G:"r",x:.4,y:.22,r:.8,A:"4"},{G:"r",x:-.2,y:-.4,A:"5"},{G:"r",x:.2,y:-.4,A:"6"}];return{name:"horiz prox 1",ma:["a"],type:"e",ga:function(){return[0,0,0,0,0,0,0,.25]},jb:function(){return[0,1,-1,1,-1,0,0,.25]},H:function(b,c){Td(b);
b.buttons(a,c.h,{ae:!0});le(b,c.h[7],-.1,!1,"black",1)},aa:function(b,c,d,e,f,g,h){b=ke(a,d,e,f,g,h);return null!==b?(ta(c),c.h[b]=(c.h[b]+2)%3-1,b):me(-.1,!1,d,e,f,g,h)?(ta(c),7):null},Pa:function(b,c,d,e,f,g,h,k){7<=d&&(c.h[d]=Math.max(.25,Math.min(.75,Math.round(4*ne(!1,e,f,g,h,k))/4)))},sc:function(b){for(var c=0;7>c;c++)if(b.h[c])return null;return new Ga("No sensor specified",!0)},Fc:function(b,c){switch(c){case "b":if(c=b.V.ga(),b.h[7]===c[7])return c=new sa(ya("horiz prox"),null,null),c.h=
b.h.slice(0,7),c;default:return b}}}}()),new qa(function(){var a=[{G:"r",x:-.15,y:.35,A:"0"},{G:"r",x:.15,y:.35,A:"1"}];return{name:"ground",ma:["b"],type:"e",ga:function(){return[0,0]},jb:function(){return[1,-1]},H:function(b,c){Td(b,{ic:!0});b.buttons(a,c.h,{ae:!0})},aa:function(b,c,d,e,f,g,h){b=ke(a,d,e,f,g,h);null!==b&&(ta(c),c.h[b]=(c.h[b]+2)%3-1);return b},sc:function(b){return b.h[0]||b.h[1]?null:new Ga("No ground sensor specified",!0)},Fc:function(b,c){switch(c){case "a":return c=new sa(ya("ground adv"),
null,null),c.h=b.h.concat(c.h.slice(2)),c;default:return b}}}}()),new qa(function(){var a=[{G:"r",x:-.15,y:.35,A:"0"},{G:"r",x:.15,y:.35,A:"1"}];return{name:"ground adv",ma:["c"],type:"e",ga:function(){return[0,0,.6,.4]},jb:function(){return[1,-1,.6,.4]},H:function(b,c){Td(b,{ic:!0});b.buttons(a,c.h,{ae:!0});le(b,c.h[2],.02,!1,"red",2);le(b,c.h[3],-.2,!1,"black",1)},aa:function(b,c,d,e,f,g,h){b=ke(a,d,e,f,g,h);return null!==b?(ta(c),c.h[b]=(c.h[b]+2)%3-1,b):me(.02,!1,d,e,f,g,h)?(ta(c),2):me(-.2,!1,
d,e,f,g,h)?(ta(c),3):null},Pa:function(b,c,d,e,f,g,h,k){2<=d&&(c.h[d]=Math.max(0,Math.min(1,ne(!1,e,f,g,h,k))))},sc:function(b){return b.h[0]||b.h[1]?null:new Ga("No ground sensor specified",!0)},Fc:function(b,c){switch(c){case "b":if(c=b.V.ga(),b.h[2]===c[2]&&b.h[3]===c[3])return c=new sa(ya("ground"),null,null),c.h=b.h.slice(0,2),c;default:return b}}}}()),new qa(function(){var a=[{G:"r",x:-.15,y:.35,A:"0"},{G:"r",x:.15,y:.35,A:"1"}];return{name:"ground 1",ma:["a"],type:"e",ga:function(){return[0,
0,.5]},jb:function(){return[1,-1,.5]},H:function(b,c){Td(b,{ic:!0});b.buttons(a,c.h,{ae:!0});le(b,c.h[2],0,!1,"black",1)},aa:function(b,c,d,e,f,g,h){b=ke(a,d,e,f,g,h);return null!==b?(ta(c),c.h[b]=(c.h[b]+2)%3-1,b):me(0,!1,d,e,f,g,h)?(ta(c),2):null},Pa:function(b,c,d,e,f,g,h,k){2<=d&&(c.h[d]=Math.max(.25,Math.min(.75,Math.round(4*ne(!1,e,f,g,h,k))/4)))},sc:function(b){return b.h[0]||b.h[1]?null:new Ga("No ground sensor specified",!0)},Fc:function(b,c){switch(c){case "b":if(c=b.V.ga(),b.h[2]===c[2])return c=
new sa(ya("ground"),null,null),c.h=b.h.slice(0,2),c;default:return b}}}}()),new qa({name:"tap",ma:["b","a"],type:"e",H:function(a){a.J.translate(.05*a.v.j,0);Xd(a);Yd(a)},Fc:function(a,b){switch(b){case "a":return new sa(ya("accelerometer"),null,null);default:return a}}}),new qa(function(){var a=[{G:"c",x:-.33,y:-.3,r:0},{G:"c",x:0,y:-.3,r:0},{G:"c",x:.33,y:-.3,r:0}];return{name:"accelerometer",ma:["c"],type:"e",ga:function(){return[0,0]},H:function(b,c){var d=c.h[0];c=c.h[1];0===d?(b.J.save(),b.J.translate(.08*
b.v.j,-.2*b.v.j),Xd(b),Yd(b),b.J.restore()):be(b,2===d,2===d?-c:c);b.buttons(a,[0===d,1===d,2===d])},aa:function(b,c,d,e,f,g,h){if(0!==c.h[0]&&ce(d,f,g,h))return ta(c),1;b=ke(a,d,e,f,g,h);return null!==b?(ta(c),c.h[0]=b,2):null},Pa:function(b,c,d,e,f,g,h,k){1===d&&(b=de(e,g,h,k),c.h[1]=2===c.h[0]?-b:b)},Fc:function(b,c){switch(c){case "b":if(0===b.h[0])return new sa(ya("tap"),null,null);default:return b}}}}()),new qa({name:"roll",ma:["a"],type:"e",ga:function(){return[0]},jb:function(){return[2]},
H:function(a,b){be(a,!1,b.h[0])},aa:function(a,b,c,d,e,f,g){return ce(c,e,f,g,!0)?(ta(b),1):null},Pa:function(a,b,c,d,e,f,g,h){b.h[0]=de(d,f,g,h,!0)}}),new qa({name:"pitch",ma:["a"],type:"e",ga:function(){return[0]},jb:function(){return[2]},H:function(a,b){be(a,!0,b.h[0])},aa:function(a,b,c,d,e,f,g){return ce(c,e,f,g,!0)?(ta(b),1):null},Pa:function(a,b,c,d,e,f,g,h){b.h[0]=de(d,f,g,h,!0)}}),new qa({name:"yaw",ma:["a"],type:"e",ga:function(){return[0]},jb:function(){return[2]},H:function(a,b){var c=
a.J,d=a.v;b=b.h[0]*Math.PI/12;c.save();c.translate(.5*d.j,.5*d.j);c.rotate(b);ae(a);c.translate(-d.j/2,-d.j/2);Td(a,{ic:!0,scale:.45});c.restore()},aa:function(a,b,c,d,e,f,g){return ce(c,e,f,g,!0)?(ta(b),1):null},Pa:function(a,b,c,d,e,f,g,h){b.h[0]=de(d,f,g,h,!0)}}),new qa({name:"clap",type:"e",H:function(a){var b=a.J;a=a.v;b.save();b.beginPath();b.arc(.7*a.j,.6*a.j,.15*a.j,0,2*Math.PI);b.fillStyle="white";b.fill();b.beginPath();b.moveTo(.7*a.j,.6*a.j);b.lineTo(.8*a.j,.95*a.j);b.strokeStyle="white";
b.lineWidth=.13*a.j;b.stroke();b.lineWidth=1.5*a.ja;b.translate(.3*a.j,.3*a.j);b.rotate(.1);for(var c=0;9>c;c++)b.beginPath(),b.moveTo(.07*a.j,0),b.lineTo(.14*a.j,0),b.moveTo(.17*a.j,0),b.lineTo(.22*a.j,0),b.stroke(),b.rotate(Math.PI/4.5);b.restore()}}),new qa({name:"init",ma:["b","a"],type:"e",H:function(a){var b=a.J;a=a.v;var c=.4*a.j;b.save();b.fillStyle="black";b.strokeStyle="black";b.lineWidth=a.ja;b.beginPath();b.arc(.3*a.j,.5*a.j,.08*a.j,0,2*Math.PI);b.fill();b.beginPath();b.moveTo(.42*a.j,
.5*a.j);b.lineTo(.7*a.j,.5*a.j);b.stroke();c*=.4;b.beginPath();b.moveTo(.8*a.j,.5*a.j);b.lineTo(.8*a.j-c*Math.sqrt(3)/2,.5*a.j+c/2);b.lineTo(.8*a.j-c*Math.sqrt(3)/2,.5*a.j-c/2);b.fill();b.restore()},ng:!0}),new qa({name:"timer",ma:["a"],type:"e",H:function(a){fe(a,0,!0,!1)}}),new qa({name:"state",ma:["a"],type:"s",ga:function(){return[0,0,0,0]},jb:function(){return[1,0,0,-1]},H:function(a,b){Td(a);ie(a,b.h)},aa:function(a,b,c,d,e,f,g){a=re(c,d,e,f,g);null!==a&&(ta(b),b.h[a]=(b.h[a]+2)%3-1);return a},
Fc:function(a,b){return"b"===b&&0===a.h[0]&&0===a.h[1]&&0===a.h[2]&&0===a.h[3]?null:a}}),new qa({name:"state 8",ma:["c"],type:"s",ga:function(){return[0]},H:function(a,b){Td(a);je(a,b.h[0])},aa:function(a,b,c,d,e,f,g){a=se(c,d,e,f,g);null!==a&&(ta(b),b.h[0]=a);return a}}),new qa(function(){var a=[{G:"t",x:-.3,y:.3,r:0},{G:"t",x:-.3,y:-.3,r:Math.PI},{G:"t",x:.1,y:.3,r:0},{G:"t",x:.1,y:-.3,r:Math.PI},{G:"c",x:.35,y:-.3,r:0}];return{name:"counter comparison",ma:["a"],type:"s",ga:function(){return[0,
0]},H:function(b,c){b.text(0===c.h[0]?"=":0<c.h[0]?"\u2265":"\u2264",{x:-.3*b.v.j,fillStyle:"black"});b.text(c.h[1].toString(10),{x:.1*b.v.j,fillStyle:"black"});b.buttons(a,[1>c.h[0]?-2:0,-1<c.h[0]?-2:0,255>c.h[1]?-2:0,0<c.h[1]?-2:0,0!==c.h[1]?-2:0])},aa:function(b,c,d,e,f,g,h){b=ke(a,d,e,f,g,h);if(null!==b)switch(ta(c),b){case 0:c.h[0]=Math.min(1,c.h[0]+1);break;case 1:c.h[0]=Math.max(-1,c.h[0]-1);break;case 2:c.h[1]=Math.min(255,c.h[1]+1);break;case 3:c.h[1]=Math.max(0,c.h[1]-1);break;case 4:c.h[1]=
0}return b}}}()),new qa({name:"color state",ma:["c"],type:"s",ga:function(){return[0,0,0]},H:function(a,b){Td(a,{Vb:b.h});le(a,b.h[0],.3,!1,"red");le(a,b.h[1],0,!1,"#0c0");le(a,b.h[2],-.3,!1,"#08f")},aa:function(a,b,c,d,e,f,g){return me(.3,!1,c,d,e,f,g)?(ta(b),0):me(0,!1,c,d,e,f,g)?(ta(b),1):me(-.3,!1,c,d,e,f,g)?(ta(b),2):null},Pa:function(a,b,c,d,e,f,g,h){b.h[c]=Math.max(0,Math.min(1,Math.round(ne(!1,d,e,f,g,h))))}}),new qa(function(){var a=[{G:"r",x:-.15,y:.3,size:1.4,A:"black",fillStyle:"#666",
strokeStyle:"white"},{G:"r",x:-.3,y:0,size:1.4,A:"red",fillStyle:"red",strokeStyle:"white"},{G:"r",x:0,y:0,size:1.4,A:"green",fillStyle:"#0c0",strokeStyle:"white"},{G:"r",x:.3,y:0,size:1.4,A:"yellow",fillStyle:"yellow",strokeStyle:"silver"},{G:"r",x:-.3,y:-.3,size:1.4,A:"blue",fillStyle:"blue",strokeStyle:"white"},{G:"r",x:0,y:-.3,size:1.4,A:"magenta",fillStyle:"magenta",strokeStyle:"white"},{G:"r",x:.3,y:-.3,size:1.4,A:"cyan",fillStyle:"cyan",strokeStyle:"white"},{G:"r",x:.15,y:.3,size:1.4,A:"white",
fillStyle:"white",strokeStyle:"silver"}];return{name:"color 8 state",ma:["a"],type:"s",ga:function(){return[0]},H:function(b,c){Td(b,{Vb:[c.h&1,(c.h&2)/2,(c.h&4)/4]});b.buttons(a,[1>c.h[0]?-2:0,-1<c.h[0]?-2:0])},aa:function(b,c,d,e,f,g,h){b=ke(a,d,e,f,g,h);null!==b&&(ta(c),c.h=[b]);return b}}}()),new qa({name:"motor state",ma:["c"],type:"s",ga:function(){return[0,0]},H:function(a,b){var c=Vd(a,2.4*b.h[0],2.4*b.h[1],.19);Td(a,{ic:!0,scale:.45,rotation:c.bb,mf:[.19*c.x*a.v.j+.13*a.v.j*Math.sin(c.bb),
.19*c.y*a.v.j+.13*a.v.j*Math.cos(c.bb)]});a.J.save();a.J.globalAlpha=.2;Vd(a,2.4*b.h[0],2.4*b.h[1],.19);a.J.restore();le(a,.5+.5*b.h[0],-.4,!0,0===b.h[0]?"white":b.h[0]===b.h[1]?"#0c0":b.h[0]===-b.h[1]?"#f70":"#fd0");le(a,.5+.5*b.h[1],.4,!0,0===b.h[1]?"white":b.h[0]===b.h[1]?"#0c0":b.h[0]===-b.h[1]?"#f70":"#fd0")},aa:function(a,b,c,d,e,f,g){return me(-.4,!0,c,d,e,f,g)?(ta(b),0):me(.4,!0,c,d,e,f,g)?(ta(b),1):Wd(a,c,e,f,.5*b.h[0],.5*b.h[1],g)?(ta(b),2):null},Pa:function(a,b,c,d,e,f,g,h){2>c?(a=ne(!0,
d,e,f,g,h),b.h[c]=.25>a?-1:.75<a?1:0):(a=ne(!0,d,e,f,g,h),a=.25>a?-1:.75<a?1:0,b.h[0]=a,b.h[1]=a)}}),new qa({name:"motor",type:"a",ga:function(){return[0,0]},jb:function(){return[.5,.2]},H:function(a,b){var c=Vd(a,2.4*b.h[0],2.4*b.h[1],.19);Td(a,{ic:!0,scale:.45,rotation:c.bb,mf:[.19*c.x*a.v.j+.13*a.v.j*Math.sin(c.bb),.19*c.y*a.v.j+.13*a.v.j*Math.cos(c.bb)]});a.J.save();a.J.globalAlpha=.2;Vd(a,2.4*b.h[0],2.4*b.h[1],.19);a.J.restore();le(a,.5+.5*b.h[0],-.4,!0,0===b.h[0]?"white":b.h[0]===b.h[1]?"#0c0":
b.h[0]===-b.h[1]?"#f70":"#fd0");le(a,.5+.5*b.h[1],.4,!0,0===b.h[1]?"white":b.h[0]===b.h[1]?"#0c0":b.h[0]===-b.h[1]?"#f70":"#fd0")},aa:function(a,b,c,d,e,f,g){return me(-.4,!0,c,d,e,f,g)?(ta(b),0):me(.4,!0,c,d,e,f,g)?(ta(b),1):Wd(a,c,e,f,.5*b.h[0],.5*b.h[1],g)?(ta(b),2):null},Pa:function(a,b,c,d,e,f,g,h){2>c?(a=2*ne(!0,d,e,f,g,h)-1,d=b.h[1-c],.1>Math.abs(a)?a=0:.1>Math.abs(a-d)?a=d:.1>Math.abs(a+d)&&(a=-d),b.h[c]=Math.max(-1,Math.min(1,a))):(a=2*ne(!0,d,e,f,g,h)-1,a=.1>Math.abs(a)?0:Math.max(-1,Math.min(1,
a)),.05>Math.abs(b.h[0]-b.h[1])?(b.h[0]=a,b.h[1]=a):Math.abs(b.h[0])>Math.abs(b.h[1])?(b.h[1]*=a/b.h[0],b.h[0]=a):(b.h[0]*=a/b.h[1],b.h[1]=a))}}),new qa(function(){var a=[{G:"c",x:0,y:0,r:0},{G:"t",x:0,y:.35,r:0},{G:"t",x:0,y:-.35,r:Math.PI},{G:"t",x:-.3,y:.32,r:-.4},{G:"t",x:.3,y:.32,r:.4},{G:"t",x:-.35,y:.05,r:-Math.PI/2},{G:"t",x:.35,y:.05,r:Math.PI/2}];return{name:"move",ma:["c"],type:"a",ga:function(){return[0]},H:function(b,c){Td(b,{ic:!0,scale:.45});b.buttons(a,[0===c.h[0]?1:-2,1===c.h[0]?
1:-2,2===c.h[0]?1:-2,3===c.h[0]?1:-2,4===c.h[0]?1:-2,5===c.h[0]?1:-2,6===c.h[0]?1:-2])},aa:function(b,c,d,e,f,g,h){b=ke(a,d,e,f,g,h);null!==b&&(ta(c),c.h[0]=b);return b}}}()),new qa({name:"nn obstacles",ma:[],type:"a",ga:function(){return[0,0,0,0]},jb:function(){return[.3,.2,.1,.3]},H:function(a,b,c,d){c=d?.5:1;var e=a.J,f=a.v;e.save();d&&e.scale(c,c);e.fillStyle="white";e.font=f.sf;e.textAlign="center";e.textBaseline="middle";e.translate(.5*f.j,.5*f.j);e.translate(-.5*f.j,-.5*f.j);d?(e.fillText("\u21d1",
.25*f.j,.35*f.j),e.fillText(b.h[0].toFixed(1),.6*f.j,.35*f.j),e.fillText("\u21a7",.25*f.j,.81*f.j),e.fillText(b.h[1].toFixed(1),.6*f.j,.81*f.j),e.fillText("+",.25*f.j,1.27*f.j),e.fillText(b.h[2].toFixed(1),.6*f.j,1.27*f.j),e.fillText("\u2212",.25*f.j,1.69*f.j),e.fillText(b.h[3].toFixed(1),.6*f.j,1.69*f.j),e.translate(f.j,0),le(a,b.h[0],.15,!1),le(a,b.h[1],-.3,!1),le(a,b.h[2],-.75,!1),le(a,b.h[3],-1.2,!1)):(e.fillText("\u21d1",.25*f.j,.17*f.j),e.fillText(b.h[0].toFixed(1),.6*f.j,.17*f.j),e.fillText("\u21a7",
.25*f.j,.4*f.j),e.fillText(b.h[1].toFixed(1),.6*f.j,.4*f.j),e.fillText("+",.25*f.j,.63*f.j),e.fillText(b.h[2].toFixed(1),.6*f.j,.63*f.j),e.fillText("\u2212",.25*f.j,.87*f.j),e.fillText(b.h[3].toFixed(1),.6*f.j,.87*f.j));e.restore()},Wd:!0,aa:function(a,b,c,d,e,f,g){return me(.35,!1,c/2,d,e+c/2,f,g)?(ta(b),0):me(.12,!1,c/2,d,e+c/2,f,g)?(ta(b),1):me(-.12,!1,c/2,d,e+c/2,f,g)?(ta(b),2):me(-.35,!1,c/2,d,e+c/2,f,g)?(ta(b),3):null},Pa:function(a,b,c,d,e,f,g,h){b.h[c]=Math.max(0,Math.min(1,Math.round(20*
ne(!1,d/2,e,f+d/2,g,h))/20))}}),new qa({name:"top color",ma:["a"],type:"a",ga:function(){return[0,0,0]},H:function(a,b){Td(a,{Vb:b.h});le(a,b.h[0],.3,!1,"red");le(a,b.h[1],0,!1,"#0c0");le(a,b.h[2],-.3,!1,"#08f")},aa:function(a,b,c,d,e,f,g){return me(.3,!1,c,d,e,f,g)?(ta(b),0):me(0,!1,c,d,e,f,g)?(ta(b),1):me(-.3,!1,c,d,e,f,g)?(ta(b),2):null},Pa:function(a,b,c,d,e,f,g,h){b.h[c]=Math.max(0,Math.min(1,ne(!1,d,e,f,g,h)))}}),new qa(function(){var a=[{G:"r",x:-.15,y:.3,size:1.4,A:"black",fillStyle:"#666",
strokeStyle:"white"},{G:"r",x:-.3,y:0,size:1.4,A:"red",fillStyle:"red",strokeStyle:"white"},{G:"r",x:0,y:0,size:1.4,A:"green",fillStyle:"#0c0",strokeStyle:"white"},{G:"r",x:.3,y:0,size:1.4,A:"yellow",fillStyle:"yellow",strokeStyle:"silver"},{G:"r",x:-.3,y:-.3,size:1.4,A:"blue",fillStyle:"blue",strokeStyle:"white"},{G:"r",x:0,y:-.3,size:1.4,A:"magenta",fillStyle:"magenta",strokeStyle:"white"},{G:"r",x:.3,y:-.3,size:1.4,A:"cyan",fillStyle:"cyan",strokeStyle:"white"},{G:"r",x:.15,y:.3,size:1.4,A:"white",
fillStyle:"white",strokeStyle:"silver"}];return{name:"top color 8",ma:["b"],type:"a",ga:function(){return[0]},H:function(b,c){Td(b,{Vb:[c.h&1,(c.h&2)/2,(c.h&4)/4]});b.buttons(a,[1>c.h[0]?-2:0,-1<c.h[0]?-2:0])},aa:function(b,c,d,e,f,g,h){b=ke(a,d,e,f,g,h);null!==b&&(ta(c),c.h=[b]);return b}}}()),new qa({name:"bottom color",ma:["a"],type:"a",ga:function(){return[0,0,0]},H:function(a,b){Td(a,{ic:!0,Vb:b.h});le(a,b.h[0],.3,!1,"red");le(a,b.h[1],0,!1,"#0c0");le(a,b.h[2],-.3,!1,"#08f")},aa:function(a,b,
c,d,e,f,g){return me(.3,!1,c,d,e,f,g)?(ta(b),0):me(0,!1,c,d,e,f,g)?(ta(b),1):me(-.3,!1,c,d,e,f,g)?(ta(b),2):null},Pa:function(a,b,c,d,e,f,g,h){b.h[c]=Math.max(0,Math.min(1,ne(!1,d,e,f,g,h)))}}),new qa({name:"bottom-left color",ma:["c"],type:"a",ga:function(){return[0,0,0]},H:function(a,b){Td(a,{ic:!0,Vb:b.h,Ge:"left"});le(a,b.h[0],.3,!1,"red");le(a,b.h[1],0,!1,"#0c0");le(a,b.h[2],-.3,!1,"#08f")},aa:function(a,b,c,d,e,f,g){return me(.3,!1,c,d,e,f,g)?(ta(b),0):me(0,!1,c,d,e,f,g)?(ta(b),1):me(-.3,!1,
c,d,e,f,g)?(ta(b),2):null},Pa:function(a,b,c,d,e,f,g,h){b.h[c]=Math.max(0,Math.min(1,ne(!1,d,e,f,g,h)))}}),new qa({name:"bottom-right color",ma:["c"],type:"a",ga:function(){return[0,0,0]},H:function(a,b){Td(a,{ic:!0,Vb:b.h,Ge:"right"});le(a,b.h[0],.3,!1,"red");le(a,b.h[1],0,!1,"#0c0");le(a,b.h[2],-.3,!1,"#08f")},aa:function(a,b,c,d,e,f,g){return me(.3,!1,c,d,e,f,g)?(ta(b),0):me(0,!1,c,d,e,f,g)?(ta(b),1):me(-.3,!1,c,d,e,f,g)?(ta(b),2):null},Pa:function(a,b,c,d,e,f,g,h){b.h[c]=Math.max(0,Math.min(1,
ne(!1,d,e,f,g,h)))}}),new qa(function(){var a=[{G:"r",x:-.15,y:.3,size:1.4,A:"black",fillStyle:"#666",strokeStyle:"white"},{G:"r",x:-.3,y:0,size:1.4,A:"red",fillStyle:"red",strokeStyle:"white"},{G:"r",x:0,y:0,size:1.4,A:"green",fillStyle:"#0c0",strokeStyle:"white"},{G:"r",x:.3,y:0,size:1.4,A:"yellow",fillStyle:"yellow",strokeStyle:"silver"},{G:"r",x:-.3,y:-.3,size:1.4,A:"blue",fillStyle:"blue",strokeStyle:"white"},{G:"r",x:0,y:-.3,size:1.4,A:"magenta",fillStyle:"magenta",strokeStyle:"white"},{G:"r",
x:.3,y:-.3,size:1.4,A:"cyan",fillStyle:"cyan",strokeStyle:"white"},{G:"r",x:.15,y:.3,size:1.4,A:"white",fillStyle:"white",strokeStyle:"silver"}];return{name:"bottom color 8",ma:["b"],type:"a",ga:function(){return[0]},H:function(b,c){Td(b,{ic:!0,Vb:[c.h&1,(c.h&2)/2,(c.h&4)/4]});b.buttons(a,[1>c.h[0]?-2:0,-1<c.h[0]?-2:0])},aa:function(b,c,d,e,f,g,h){b=ke(a,d,e,f,g,h);null!==b&&(ta(c),c.h=[b]);return b}}}()),new qa(function(){var a=[{G:"r",x:-.15,y:.3,size:1.4,A:"black",fillStyle:"#666",strokeStyle:"white"},
{G:"r",x:-.3,y:0,size:1.4,A:"red",fillStyle:"red",strokeStyle:"white"},{G:"r",x:0,y:0,size:1.4,A:"green",fillStyle:"#0c0",strokeStyle:"white"},{G:"r",x:.3,y:0,size:1.4,A:"yellow",fillStyle:"yellow",strokeStyle:"silver"},{G:"r",x:-.3,y:-.3,size:1.4,A:"blue",fillStyle:"blue",strokeStyle:"white"},{G:"r",x:0,y:-.3,size:1.4,A:"magenta",fillStyle:"magenta",strokeStyle:"white"},{G:"r",x:.3,y:-.3,size:1.4,A:"cyan",fillStyle:"cyan",strokeStyle:"white"},{G:"r",x:.15,y:.3,size:1.4,A:"white",fillStyle:"white",
strokeStyle:"silver"}];return{name:"bottom-left color 8",ma:["c"],type:"a",ga:function(){return[0]},H:function(b,c){Td(b,{ic:!0,Vb:[c.h&1,(c.h&2)/2,(c.h&4)/4],Ge:"left"});b.buttons(a,[1>c.h[0]?-2:0,-1<c.h[0]?-2:0])},aa:function(b,c,d,e,f,g,h){b=ke(a,d,e,f,g,h);null!==b&&(ta(c),c.h=[b]);return b}}}()),new qa(function(){var a=[{G:"r",x:-.15,y:.3,size:1.4,A:"black",fillStyle:"#666",strokeStyle:"white"},{G:"r",x:-.3,y:0,size:1.4,A:"red",fillStyle:"red",strokeStyle:"white"},{G:"r",x:0,y:0,size:1.4,A:"green",
fillStyle:"#0c0",strokeStyle:"white"},{G:"r",x:.3,y:0,size:1.4,A:"yellow",fillStyle:"yellow",strokeStyle:"silver"},{G:"r",x:-.3,y:-.3,size:1.4,A:"blue",fillStyle:"blue",strokeStyle:"white"},{G:"r",x:0,y:-.3,size:1.4,A:"magenta",fillStyle:"magenta",strokeStyle:"white"},{G:"r",x:.3,y:-.3,size:1.4,A:"cyan",fillStyle:"cyan",strokeStyle:"white"},{G:"r",x:.15,y:.3,size:1.4,A:"white",fillStyle:"white",strokeStyle:"silver"}];return{name:"bottom-right color 8",ma:["c"],type:"a",ga:function(){return[0]},H:function(b,
c){Td(b,{ic:!0,Vb:[c.h&1,(c.h&2)/2,(c.h&4)/4],Ge:"right"});b.buttons(a,[1>c.h[0]?-2:0,-1<c.h[0]?-2:0])},aa:function(b,c,d,e,f,g,h){b=ke(a,d,e,f,g,h);null!==b&&(ta(c),c.h=[b]);return b}}}()),new qa({name:"notes",type:"a",ga:function(){return[0,1,1,1,2,1,0,1,2,1,4,2]},H:function(a,b){b=b.h;var c=a.J,d=a.v;c.save();c.fillStyle="#eee";for(var e=0;5>e;e++)c.fillRect(.1*d.j,d.j*(.1+.16*e),.8*d.j,.16*d.j-d.ja);Zd(a,b,.1,.9,.9,.1,5,.14,1);c.restore()},aa:function(a,b,c,d,e,f,g){return(a=oe(.1,.9,.9,.1,6,
5,c,d,e,f,g))?(ta(b),b.h[2*a.index]===a.tone?b.h[2*a.index+1]=(b.h[2*a.index+1]+1)%3:(b.h[2*a.index]=a.tone,b.h[2*a.index+1]=1),0):null}}),new qa(function(){var a=[{G:"t",x:-.3,y:.3,r:0},{G:"t",x:-.3,y:-.3,r:Math.PI}];return{name:"play",ma:["c"],type:"a",ga:function(){return[0]},H:function(b,c){$d(b,c.h[0]);b.buttons(a,[-2,-2])},aa:function(b,c,d,e,f,g,h){b=ke(a,d,e,f,g,h);if(null!==b)switch(ta(c),b){case 0:c.h[0]=(c.h[0]+1)%100;break;case 1:c.h[0]=(c.h[0]+99)%100}return b}}}()),new qa({name:"play stop",
ma:["c"],type:"a",H:function(a){$d(a,null)}}),new qa({name:"set state",ma:["a"],type:"a",ga:function(){return[0,0,0,0]},jb:function(){return[0,1,-1,0]},H:function(a,b){Td(a);ie(a,b.h)},aa:function(a,b,c,d,e,f,g){a=re(c,d,e,f,g);null!==a&&(ta(b),b.h[a]=(b.h[a]+2)%3-1);return a}}),new qa({name:"toggle state",ma:["c"],type:"a",ga:function(){return[!1,!1,!1,!1]},jb:function(){return[!0,!1,!1,!1]},H:function(a,b){Td(a);ie(a,b.h.map(function(c){return c?2:0}));wc(a.J,a.v.j/2,a.v.j/2,.2*a.v.j,-1.4,1.4,{style:"black",
lineWidth:a.v.ja,Uc:5*a.v.ja});wc(a.J,a.v.j/2,a.v.j/2,.2*a.v.j,Math.PI-1.4,Math.PI+1.4,{style:"black",lineWidth:a.v.ja,Uc:5*a.v.ja})},aa:function(a,b,c,d,e,f,g){a=re(c,d,e,f,g);null!==a&&(ta(b),b.h[a]=!b.h[a]);return a}}),new qa({name:"set state 8",ma:["c"],type:"a",ga:function(){return[0]},H:function(a,b){Td(a);je(a,b.h[0])},aa:function(a,b,c,d,e,f,g){a=se(c,d,e,f,g);null!==a&&(ta(b),b.h[0]=a);return a}}),new qa(function(){var a=[{G:"c",x:-.2,y:0},{G:"c",x:.2,y:0}];return{name:"change state 8",ma:["c"],
type:"a",ga:function(){return[1]},H:function(b,c){Td(b);var d=b.J;d.save();for(var e=0;8>e;e++)he(b,Math.PI*(.46-.25*e),Math.PI*(.54-.25*e),0);d.restore();wc(b.J,b.v.j/2,b.v.j/2,.375*b.v.j,-.8,.8,{style:"black",lineWidth:b.v.ja,Uc:5*b.v.ja});wc(b.J,b.v.j/2,b.v.j/2,.375*b.v.j,Math.PI-.8,Math.PI+.8,{Dd:!0,style:"black",lineWidth:b.v.ja,Uc:5*b.v.ja});b.buttons(a,[0>c.h[0],0<c.h[0]])},aa:function(b,c,d,e,f,g,h){b=ke(a,d,e,f,g,h);null!==b&&(ta(c),c.h[0]=0===b?-1:1);return b}}}()),new qa(function(){var a=
[{G:"t",x:0,y:.3,r:0},{G:"t",x:0,y:-.3,r:Math.PI}];return{name:"set counter",ma:["a"],type:"a",ga:function(){return[0]},H:function(b,c){b.text(0===c.h[0]?"= 0":0<c.h[0]?"+1":"\u22121");b.buttons(a,[1>c.h[0]?-2:0,-1<c.h[0]?-2:0])},aa:function(b,c,d,e,f,g,h){b=ke(a,d,e,f,g,h);if(null!==b)switch(ta(c),b){case 0:c.h[0]=Math.min(1,c.h[0]+1);break;case 1:c.h[0]=Math.max(-1,c.h[0]-1)}return b}}}()),new qa({name:"set timer",ma:["a"],type:"a",ga:function(){return[1]},H:function(a,b){fe(a,b.h[0],!1,!1)},aa:function(a,
b,c,d,e,f,g){return pe(c,d,e,f,g)?(ta(b),1):null},Pa:function(a,b,c,d,e,f,g,h){b.h[0]=qe(d,e,f,g,!1,h)}}),new qa({name:"set timer log",ma:["c"],type:"a",ga:function(){return[1]},H:function(a,b){fe(a,b.h[0],!1,!0)},aa:function(a,b,c,d,e,f,g){return pe(c,d,e,f,g)?(ta(b),1):null},Pa:function(a,b,c,d,e,f,g,h){b.h[0]=qe(d,e,f,g,!0,h)}}),new qa(function(){function a(c,d){if(c.h[1]){var e=new Image;e.src=c.h[1];e.addEventListener("load",function(){c.h[2]=e;d&&d()},!1)}}var b=[{G:"c",x:-.33,y:-.3,r:0}];return{name:"picture comment",
ma:["a"],type:"c",ga:function(){return[!1,"",null]},Ze:function(c){return 2<=c.h.length?[!1,c.h[1]]:[!1,""]},fe:function(c,d,e){c.h=2<=d.length?[!1,d[1]]:[!1,""];a(c,e)},H:function(c,d){d.h[2]&&c.J.drawImage(d.h[2],0,0,240,240,0,0,c.v.j,c.v.j);c.buttons(b,[d.h[0]])},aa:function(c,d,e,f,g,h,k){e=ke(b,e,f,g,h,k);0===e&&(d.h[0]?aa&&(aa.pause&&aa.pause(),ba.getTracks().forEach(function(l){l.stop()}),aa=null):(ta(d),navigator.mediaDevices.getUserMedia({audio:!1,video:{width:320,height:240}}).then(function(l){ba=
l;aa=document.createElement("video");aa.srcObject=l;aa.addEventListener("loadedmetadata",function(){aa.play();var z=setInterval(function(){aa?(ca||(ca=document.createElement("canvas"),ca.width=240,ca.height=240),ca.getContext("2d").drawImage(aa,0,0,240,240,0,0,240,240),d.h[1]=ca.toDataURL("image/png"),a(d,function(){c.na&&c.na();Ob(c)})):clearInterval(z)},100)},!1)})),d.h[0]=!d.h[0]);return e}}}())];function te(a,b){function c(f){return f instanceof Array?f.join(""):f}function d(f,g){return f.map(function(h){return ra(h,g)})}var e=b||{};["aseba","l2","js","python"].forEach(function(f){a[f]&&(e[f]=function(g){var h={};a[f].initVarDecl&&(h.Tb=d(a[f].initVarDecl.map(c),g));a[f].initCodeDecl&&(h.Sb=d(a[f].initCodeDecl.map(c),g));a[f].initCodeExec&&(h.ac=d(a[f].initCodeExec.map(c),g));a[f].sectionBegin&&(h.O=ra(c(a[f].sectionBegin),g));a[f].sectionEnd&&(h.hb=ra(c(a[f].sectionEnd),g));a[f].sectionPreamble&&
(h.Ua=ra(c(a[f].sectionPreamble),g));a[f].clauseInit&&(h.$=ra(c(a[f].clauseInit),g));if(a[f].clauseAnd){var k="";g.h.forEach(function(l,z){(l=ra(c(a[f].clauseAnd),g,z))&&(k+=(0<k.length?" "+ua[f].o+" ":"")+l)});h.Wa=k||ua[f].w}else a[f].clause&&(h.Wa=ra(c(a[f].clause),g));h.eh=a[f].clauseOptional||!1;a[f].statement1?h.ia=g.h.map(function(l,z){return ra(c(a[f].statement1),g,z)}).join(""):a[f].statement&&(h.ia=ra(c(a[f].statement),g));a[f].error&&(h.Wa=ra(c(a.error.error),g));return h})});return e}
;function ue(a){this.P=new DOMParser;this.b=this.P.parseFromString(a,"text/xml");this.g=this.b.documentElement;this.Ca=(this.g.getAttribute("viewBox")||"0 0 1 1").split(" ").map(function(b){return parseFloat(b)});this.w={}}
var ve={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgreen:"#006400",
darkgrey:"#A9A9A9",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",
ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",green:"#008000",greenyellow:"#ADFF2F",grey:"#808080",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgreen:"#90EE90",lightgrey:"#D3D3D3",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",
lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",
moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",
seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"};function we(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}function xe(a){var b={};we(b,a);return b}
function ye(a,b){b.split(";").forEach(function(c){c=c.trim().split(":").map(function(d){return d.trim()});2===c.length&&(a[c[0]]=c[1])})}
function ze(a,b,c,d,e){a&&(a=a.replace(/\s*\(\s*/g,"(").replace(/\s*\)\s*/g,")").replace(/ +,/g,",").replace(/, +/g,",").replace(/ +/g,","),a.split(")").slice(0,-1).forEach(function(f){var g=f.split("(")[0];f=f.split("(")[1].split(",").map(function(k){return parseFloat(k)});switch(g){case "translate":b(f[0]||0,f[1]||0);break;case "rotate":g=(f[0]||0)*Math.PI/180;var h=f[1]||0;f=f[2]||0;0!==h||0!==f?(b(-h,-f),c(g),b(h,f)):c(g);break;case "scale":g=f[0]||1;d(g,f[1]||g);break;case "matrix":e(f[0],f[1],
f[2],f[3],f[4],f[5]);break;default:throw"transform not implemented: "+g;}}))}function Ae(a,b){ze(a,function(c,d){b.translate(c,d)},function(c){b.rotate(c)},function(c,d){b.scale(c,d)},function(c,d,e,f,g,h){b.Ce(c,d,e,f,g,h)})}
ue.prototype.H=function(a,b){function c(q,t,u){function F(){for(var C=0;C<q.childElementCount;C++)c(q.children[C],t,u)}function G(C,B){C=q.getAttribute(C);return null===C?B||0:parseFloat(C)}function D(C,B){C=m.apply(new Be(C,B));x.push(C.x);n.push(C.y)}function O(C,B,H){if(null==C||""==C)return B;C=/^\s*(-?[0-9.]+)\s*([a-z%]*)\s*$/i.exec(C);B=parseFloat(C[1]);switch(C[2]||"px"){case "pt":return 25.4*B/72*3;case "pc":return 25.4*B/6*3;case "in":return 25.4*B*3;case "mm":return 3*B;case "cm":return 30*
B;case "em":return 18*B;case "ex":return 9*B;case "%":return B*H/100;default:return B}}function Q(C){C=C.replace(/\.([0-9]+)(?=\.)/g,".$1 ").replace(/([.0-9])-/g,"$1 -").replace(/\s*([a-z])\s*/gi,";$1").replace(/\s*,\s*/g,",").replace(/\s+/g,",");var B=0,H=0,Z=0,L=0,fa=[],ia=[],Y=!0;a&&a.beginPath();C.slice(1).split(";").forEach(function(J){var E=J[0];J=1<J.length?J.slice(1).split(",").map(function(Lh){return parseFloat(Lh)}):[];switch(E){case "M":if(2<=J.length){B=J[0];H=J[1];a&&a.moveTo(B,H);D(B,
H);Y&&1<fa.length&&b&&b.wa&&b.wa.line&&b.wa.line(fa,ia,!1);Y=!0;fa=x.slice(-1);ia=n.slice(-1);for(E=2;E+1<J.length;E+=2)B=J[E],H=J[E+1],a&&a.lineTo(B,H),D(B,H),fa.push(x[x.length-1]),ia.push(n[n.length-1]);Z=B;L=H}break;case "m":if(2<=J.length)for(B+=J[0],H+=J[1],a&&a.moveTo(B,H),D(B,H),Y&&1<fa.length&&b&&b.wa&&b.wa.line&&b.wa.line(fa,ia,!1),Y=!0,fa=x.slice(-1),ia=n.slice(-1),E=2;E+1<J.length;E+=2)B+=J[E],H+=J[E+1],a&&a.lineTo(B,H),D(B,H),fa.push(x[x.length-1]),ia.push(n[n.length-1]);Z=B;L=H;break;
case "L":for(E=0;E+1<J.length;E+=2)B=J[E],H=J[E+1],a&&a.lineTo(B,H),D(B,H),fa.push(x[x.length-1]),ia.push(n[n.length-1]);Z=B;L=H;break;case "l":for(E=0;E+1<J.length;E+=2)B+=J[E],H+=J[E+1],a&&a.lineTo(B,H),D(B,H),fa.push(x[x.length-1]),ia.push(n[n.length-1]);Z=B;L=H;break;case "H":for(E=0;E<J.length;E++)B=J[E],a&&a.lineTo(B,H),D(B,H),fa.push(x[x.length-1]),ia.push(n[n.length-1]);Z=B;L=H;break;case "h":for(E=0;E<J.length;E++)B+=J[E],a&&a.lineTo(B,H),D(B,H),fa.push(x[x.length-1]),ia.push(n[n.length-
1]);Z=B;L=H;break;case "V":for(E=0;E<J.length;E++)H=J[E],a&&a.lineTo(B,H),D(B,H),fa.push(x[x.length-1]),ia.push(n[n.length-1]);Z=B;L=H;break;case "v":for(E=0;E<J.length;E++)H+=J[E],a&&a.lineTo(B,H),D(B,H),fa.push(x[x.length-1]),ia.push(n[n.length-1]);Z=B;L=H;break;case "A":for(E=0;E+6<J.length;E+=7){var Fa=J[E+5],ma=J[E+6],wa=d(J[E],J[E+1],J[E+2]*Math.PI/180,0!=J[E+3],0==J[E+4],B,H,Fa,ma);B=Fa;H=ma;D(wa.x,wa.y);D(B,H);Y=!1}Z=B;L=H;break;case "a":for(E=0;E+6<J.length;E+=7)Fa=B+J[E+5],ma=H+J[E+6],wa=
d(J[E],J[E+1],J[E+2]*Math.PI/180,0!=J[E+3],0==J[E+4],B,H,Fa,ma),B=Fa,H=ma,D(wa.x,wa.y),D(B,H),Y=!1;Z=B;L=H;break;case "C":for(E=0;E+5<J.length;E+=6)a&&a.bezierCurveTo(J[E],J[E+1],J[E+2],J[E+3],J[E+4],J[E+5]),B=J[E+4],H=J[E+5],Z=2*B-J[E+2],L=2*H-J[E+3],D(B,H),Y=!1;break;case "c":for(E=0;E+5<J.length;E+=6)a&&a.bezierCurveTo(B+J[E],H+J[E+1],B+J[E+2],H+J[E+3],B+J[E+4],H+J[E+5]),Z=B+2*J[E+4]-J[E+2],L=H+2*J[E+5]-J[E+3],B+=J[E+4],H+=J[E+5],D(B,H),Y=!1;break;case "S":for(E=0;E+3<J.length;E+=4)a&&a.bezierCurveTo(Z,
L,J[E],J[E+1],J[E+2],J[E+3]),B=J[E+2],H=J[E+3],Z=2*B-J[E],L=2*H-J[E+1],D(B,H),Y=!1;break;case "s":for(E=0;E+3<J.length;E+=4)a&&a.bezierCurveTo(Z,L,B+J[E],H+J[E+1],B+J[E+2],H+J[E+3]),Z=B-J[E],L=H-J[E+1],B+=J[E+2],H+=J[E+3],D(B,H),Y=!1;break;case "Q":for(E=0;E+3<J.length;E+=4)a&&a.quadraticCurveTo(J[E],J[E+1],J[E+2],J[E+3]),B=J[E+2],H=J[E+3],Z=2*B-J[E],L=2*H-J[E+1],D(B,H),Y=!1;break;case "q":for(E=0;E+3<J.length;E+=4)a&&a.quadraticCurveTo(B+J[E],H+J[E+1],B+J[E+2],H+J[E+3]),Z=B+2*J[E+2]-J[E],L=H+2*J[E+
3]-J[E+1],B+=J[E+2],H+=J[E+3],D(B,H),Y=!1;break;case "T":for(E=0;E+1<J.length;E+=2)a&&a.quadraticCurveTo(Z,L,J[E],J[E+1]),B=J[E],H=J[E+1],Z=2*B-Z,L=2*H-L,D(B,H),Y=!1;break;case "t":for(E=0;E+1<J.length;E+=2)a&&a.quadraticCurveTo(Z,L,B+J[E],H+J[E+1]),B+=J[E],H+=J[E+1],Z=2*B-Z,L=2*H-L,D(B,H),Y=!1;break;case "Z":case "z":a&&a.closePath();Y&&1<fa.length&&b&&b.wa&&b.wa.line&&b.wa.line(fa,ia,!0);Y=!0;fa=[];ia=[];break;default:throw"unimplemented path command: "+E;}});Y&&1<fa.length&&b&&b.wa&&b.wa.line&&
b.wa.line(fa,ia,!1)}function R(C){function B(ia,Y){if(0<Y.length){ia.splice(0,ia.length);for(var J=0;J<Y.length&&1>J;J++){var E=(Y[J].getAttribute("offset")||"0").trim(),Fa=/%$/.test(E)?parseFloat(E.slice(0,-1))/100:parseFloat(E),ma=Y[J].getAttribute("style");E={};ma&&ye(E,ma);isNaN(Fa)||(ma=Y[J].getAttribute("stop-color")||E["stop-color"]||"#000",ve.hasOwnProperty(ma)&&(ma=ve[ma]),E=(Y[J].getAttribute("stop-opacity")||E["stop-opacity"]||"1").trim(),E=/%$/.test(E)?parseFloat(E.slice(0,-1))/100:parseFloat(E),
1!==E&&(/^#[0-9a-f]{3}$/i.test(ma)?ma="rgba("+ma.slice(1).split("").map(function(wa){return 17*parseInt(wa,16)}).map(function(wa){return wa.toString(10)}).join(",")+","+E.toFixed(2)+")":/^#[0-9a-f]{6}$/i.test(ma)?ma="rgba("+[ma.slice(1,3),ma.slice(3,5),ma.slice(5)].map(function(wa){return parseInt(wa,16)}).map(function(wa){return wa.toString(10)}).join(",")+","+E.toFixed(2)+")":/^rgb(\d+%?(,|\s+)\d+%?(,|\s+)\d+%?)$/i.test(ma)?ma=ma.slice(0,-1).replace(/\s+/g,",")+","+E.toFixed(2)+")":/^hsl(\d+%?(,|\s+)\d+%?(,|\s+)\d+%?)$/i.test(ma)&&
(ma=ma.slice(0,-1).replace(/\s+/g,",")+","+E.toFixed(2)+")")),ia.push({offset:Fa,color:ma}))}}}function H(ia,Y){if(ia.attributes["xlink:href"]){var J=ia.getAttribute("xlink:href");"#"===J[0]&&(J=k.b.getElementById(J.slice(1)))&&(Y=H(J,Y))}Y.hd=ia.attributes.x1?parseFloat(ia.getAttribute("x1")):Y.hd||0;Y.kd=ia.attributes.y1?parseFloat(ia.getAttribute("y1")):Y.kd||0;Y.jd=ia.attributes.x2?parseFloat(ia.getAttribute("x2")):Y.jd||0;Y.ld=ia.attributes.y2?parseFloat(ia.getAttribute("y2")):Y.ld||0;Y.yc=ia.attributes.gradientUnits?
ia.getAttribute("gradientUnits"):Y.yc||"objectBoundingBox";Y.Rb=ia.attributes.gradientTransform?ia.getAttribute("gradientTransform"):Y.Rb||"";Y.ib=Y.ib||[];B(Y.ib,ia.getElementsByTagName("stop"));return Y}function Z(ia,Y){if(ia.attributes["xlink:href"]){var J=ia.getAttribute("xlink:href");"#"===J[0]&&(J=k.b.getElementById(J.slice(1)))&&(Y=Z(J,Y))}Y.uc=ia.attributes.cx?parseFloat(ia.getAttribute("cx")):Y.uc||0;Y.vc=ia.attributes.cy?parseFloat(ia.getAttribute("cy")):Y.vc||0;Y.r=ia.attributes.r?parseFloat(ia.getAttribute("r")):
Y.r||0;Y.yc=ia.attributes.gradientUnits?ia.getAttribute("gradientUnits"):Y.yc||"objectBoundingBox";Y.Rb=ia.attributes.gradientTransform?ia.getAttribute("gradientTransform"):Y.Rb||"";Y.ib=Y.ib||[];B(Y.ib,ia.getElementsByTagName("stop"));return Y}var L=/^url\(#(.+)\)$/.exec(C);if(L&&L[1]&&(L=k.b.getElementById(L[1])))switch(L.tagName){case "linearGradient":C=H(L,{});if("objectBoundingBox"===C.yc)throw"objectBoundingBox not supported";if(C.Rb)throw L=new Ce,Ae(C.Rb,L),"gradientTransform not supported";
var fa=a.createLinearGradient(C.hd,C.kd,C.jd,C.ld);for(L=0;L<C.ib.length;L++)fa.addColorStop(C.ib[L].offset,C.ib[L].color);return fa;case "radialGradient":C=Z(L,{});if("objectBoundingBox"===C.yc)throw"objectBoundingBox not supported";C.Rb&&(L=new Ce,Ae(C.Rb,L),fa=De(L,{x:C.uc,y:C.vc}),L=C.r/Math.sqrt(Math.abs(L.b[0]*L.b[4])),C.uc=fa.x,C.vc=fa.y,C.r=L);fa=a.createRadialGradient(C.uc,C.vc,0,C.uc,C.vc,C.r);for(L=0;L<C.ib.length;L++)fa.addColorStop(C.ib[L].offset,C.ib[L].color);return fa}return C}function V(C,
B,H,Z,L,fa){0>=L||0>=fa?a.rect(C,B,H,Z):(L=Math.min((L+fa)/2,Math.min(H,Z)/2),a.moveTo(C+H-L,B),a.arc(C+H-L,B+L,L,1.5*Math.PI,2*Math.PI),a.lineTo(C+H,B+Z-L),a.arc(C+H-L,B+Z-L,L,0,.5*Math.PI),a.lineTo(C+L,B+Z),a.arc(C+L,B+Z-L,L,.5*Math.PI,Math.PI),a.lineTo(C,B+L),a.arc(C+L,B+L,L,Math.PI,1.5*Math.PI),a.closePath())}function da(){if(a){var C=(t||"")+";"+(u||""),B={};C&&ye(B,C);"hidden"!==B.visibility&&(B.opacity&&(a.globalAlpha*=parseFloat(B.opacity)),B.fill&&"none"===B.fill||(a.fillStyle="white"===
B.fill||"#fff"===B.fill||"#ffffff"===B.fill?"white":R(B.fill)||"none",a.fill()),B.stroke&&"none"!==B.stroke&&(a.lineWidth=O(B["stroke-width"]||"1px",1,100),a.strokeStyle=B.stroke||"none",a.miterLimit=B["stroke-miterlimit"]||4,a.lineJoin=B["stroke-linejoin"]||"miter",a.lineCap=B["stroke-linecap"]||"butt",B["stroke-dasharray"]&&(a.setLineDash(B["stroke-dasharray"].split(" ").map(function(H){return parseFloat(H)})),a.lineDashOffset=B["stroke-dashoffset"]?parseFloat(B["stroke-dashoffset"]):0),a.stroke()))}}
function ja(C,B,H){if(a){var Z=(t||"")+";"+(u||""),L={};Z&&ye(L,Z);"hidden"!==L.visibility&&(a.font=(L["font-size"]||"12px")+" "+(L["font-family"]||"helvetica"),L.fill&&"none"!==L.fill&&(a.fillStyle="white"===L.fill||"#fff"===L.fill||"#ffffff"===L.fill?"white":b&&b.fill||"silver",a.fillText(C,B,H)),L.stroke&&"none"!==L.stroke&&(a.strokeStyle=b&&b.stroke||"black",a.strokeText(C,B,H)))}}function K(C,B){C=Ee({x:C,y:B});a.save();a.strokeStyle="black";a.lineWidth=1;a.strokeRect(C.Y,C.Z,C.pa-C.Y,C.la-C.Z);
a.restore()}var A=q.getAttribute("id"),S=A&&b&&b.qd&&b.qd[A];A=A&&b&&b.Se&&b.Se[A];a&&a.save();m.save();S&&a&&f(q,S);A&&a&&g(q,A);(function(){var C=(b&&b.fg||"")+";"+(q.getAttribute("style")||""),B=q.getAttribute("class");B&&z.hasOwnProperty(B)&&(C=z[B]+";"+C);t=(t||"")+";"+C;(C=q.getAttribute("stroke-dasharray"))&&(t+=";stroke-dasharray:"+C.split(",").join(" "));(C=q.getAttribute("stroke-dashoffset"))&&(t+=";stroke-dashoffset:"+C);(C=q.getAttribute("id"))&&b&&b.style&&b.style.hasOwnProperty(C)&&
(u=(u||"")+";"+b.style[C])})();S=x.length;switch(q.tagName){case "svg":m.save();h(q.getAttribute("transform"));F();m.restore();break;case "g":m.save();h(q.getAttribute("transform"));F();m.restore();break;case "path":a&&a.save();m.save();h(q.getAttribute("transform"));Q(q.getAttribute("d")||"");da();a&&a.restore();m.restore();break;case "line":A=G("x1");var N=G("y1"),X=G("x2"),y=G("y2");a&&a.save();m.save();h(q.getAttribute("transform"));a&&a.beginPath();a&&a.moveTo(A,N);a&&a.lineTo(X,y);da();D(A,
N);D(X,y);b&&b.wa&&b.wa.line&&b.wa.line([A,X],[N,y],!1);a&&a.restore();m.restore();break;case "polygon":case "polyline":A=q.getAttribute("points").trim().replace(/\s+/g," ").split(" ").map(function(C){return parseFloat(C)});if(4<=A.length){a&&a.save();m.save();h(q.getAttribute("transform"));a&&a.beginPath();a&&a.moveTo(A[0],A[1]);D(A[0],A[1]);for(N=2;N+1<A.length;N+=2)a&&a.lineTo(A[N],A[N+1]),D(A[N],A[N+1]);"polygon"===q.tagName&&a.closePath();da();b&&b.wa&&b.wa.line&&b.wa.line(x.slice(-A.length/
2),n.slice(-A.length/2),"polygon"===q.tagName);a&&a.restore();m.restore()}break;case "circle":A=G("cx");N=G("cy");X=G("r");a&&a.save();m.save();h(q.getAttribute("transform"));a&&a.beginPath();a&&a.arc(A,N,X,0,2*Math.PI);da();D(A-X,N-X);D(A-X,N+X);D(A+X,N-X);D(A+X,N+X);b&&b.wa&&b.wa.Re&&(A=x.slice(-4),N=n.slice(-4),X=(A[3]-A[0])*(A[3]-A[0])+(N[3]-N[0])*(N[3]-N[0]),y=(A[2]-A[1])*(A[2]-A[1])+(N[2]-N[1])*(N[2]-N[1]),.001>Math.abs(X-y)/(X+y)&&.001>((A[3]-A[0])*(A[2]-A[1])+(N[3]-N[0])*(N[2]-N[1]))/X&&b.wa.Re((A[0]+
A[2])/2,(N[0]+N[2])/2,Math.sqrt(X/8)));a&&a.restore();m.restore();break;case "rect":A=G("x");N=G("y");X=G("width");y=G("height");var P=G("rx"),I=G("ry",P);P=G("rx",I);a&&a.save();m.save();h(q.getAttribute("transform"));a&&(a.beginPath(),0<P||0<I?V(A,N,X,y,P,I):a.rect(A,N,X,y));da();D(A,N);D(A,N+y);D(A+X,N);D(A+X,N+y);a&&a.restore();m.restore();break;case "text":A=G("x"),N=G("y"),a&&a.save(),m.save(),h(q.getAttribute("transform")),ja(q.textContent,A,N),D(A,N),a&&a.restore(),m.restore()}a&&a.restore();
m.restore();a&&b&&b.eg&&K(x.slice(S),n.slice(S))}function d(q,t,u,F,G,D,O,Q,R){if(0===q||0===t)return a&&a.lineTo(Q,R),new Be(Q,R);var V=Math.cos(u),da=Math.sin(u),ja=(V*D+da*O)/q;O=(-da*D+V*O)/t;D=(V*Q+da*R)/q;Q=(-da*Q+V*R)/t;R=(D-ja)/2;V=(Q-O)/2;da=R*R+V*V;da=Math.sqrt((1-da)/da);isNaN(da)?da=0:F===G&&(da=-da);F=(ja+D)/2+da*V;R=(O+Q)/2-da*R;ja=Math.atan2((O-R)/q,(ja-F)/t);O=Math.atan2((Q-R)/q,(D-F)/t);a&&(a.rotate(u),a.scale(q,t),G?a.arc(F,R,1,ja,O,!0):a.arc(F,R,1,ja,O),a.scale(1/q,1/t),a.rotate(-u));
D=new Ce;D.rotate(u);D.scale(q,t);q=G?ja<O?(ja+O)/2+Math.PI:(ja+O)/2:ja<O?(ja+O)/2:(ja+O)/2+Math.PI;return D.apply(new Be(F+Math.cos(q),R+Math.sin(q)))}function e(q){switch(q.tagName){case "svg":case "defs":for(var t=0;t<q.childElementCount;t++)e(q.children[t]);break;case "style":l+=q.textContent}}function f(q,t){if(t.bb&&0!=t.bb){var u=t.Td,F=t.Ud;if(void 0==u||void 0==F)u=k.H(null,{element:q}),q=Ee(u),u=(q.Y+q.pa)/2,F=(q.Z+q.la)/2;a.translate(u+(t.Hb||0),F+(t.Ib||0));a.rotate(t.bb);a.translate(-u,
-F)}else(t.Hb||t.Ib)&&a.translate(t.Hb,t.Ib)}function g(q,t){a.beginPath();a.rect(t.x,t.y,t.Rc,t.Hc);a.clip()}function h(q){ze(q,function(t,u){a&&a.translate(t,u);m.translate(t,u)},function(t){a&&a.rotate(t);m.rotate(t)},function(t,u){a&&a.scale(t,u);m.scale(t,u)},function(t,u,F,G,D,O){a&&a.transform(t,u,F,G,D,O);m.Ce(t,u,F,G,D,O)})}var k=this,l="",z={},m=new Fe,x=[],n=[];e(this.g);(function(){l.split("}").forEach(function(q){var t=q.split("{");t[0].split(",").forEach(function(u){u=u.trim();/^\.[-a-z0-9]+/i.test(u)&&
(u=u.slice(1),z[u]=z[u]?z[u]+";"+t[1]:t[1])})})})();var r=this.g;b&&b.Gd?r=this.b.getElementById(b.Gd):b&&b.element&&(r=b.element);if(r){b&&b.bf&&b.bf(a,this.Ca);if(a){for(var v=[],p=r.parentElement;null!=p;p=p.parentElement)v.push(p);for(p=v.length-1;0<=p;p--){var w=v[p].getAttribute("id");(w=w&&b&&b.qd&&b.qd[w])&&f(v[p],w);w=v[p].getAttribute("transform");h(w)}}c(r)}return{x:x,y:n}};
function Ee(a){if(0===a.x.length)return{Y:0,pa:0,Z:0,la:0};for(var b=a.x[0],c=a.x[0],d=a.y[0],e=a.y[0],f=1;f<a.x.length;f++)b=Math.min(b,a.x[f]),c=Math.max(c,a.x[f]),d=Math.min(d,a.y[f]),e=Math.max(e,a.y[f]);return{Y:b,pa:c,Z:d,la:e}}function Ge(a,b){if(a.w[b])return a.w[b];var c=a.H(null,{Gd:b});c=Ee(c);return a.w[b]=c}ue.prototype.sd=function(a,b,c){a=Ge(this,a);return b>=a.Y&&b<=a.pa&&c>=a.Z&&c<=a.la};ue.prototype.lc=function(a){return null!=this.b.getElementById(a)};
ue.prototype.Bf=function(a,b){a=this.b.getElementById(a);b=this.b.getElementById(b);return null!=b&&null!=a&&b.contains(a)};function He(a){ue.call(this,a);this.l={};this.M={};this.o={};Ie(this)}He.prototype=Object.create(ue.prototype);He.prototype.constructor=He;
function Ie(a){function b(g){switch(g.tagName){case "svg":case "defs":for(var h=0;h<g.childElementCount;h++)b(g.children[h]);break;case "style":f+=g.textContent}}function c(g){return g?(g=g.replace(/\s*\(\s*/g,"(").replace(/\s*\)\s*/g,")").replace(/ +,/g,",").replace(/, +/g,",").replace(/ +/g,","),g.split(")").slice(0,-1).map(function(h){var k=h.split("(")[0];h=h.split("(")[1].split(",").map(function(z){return parseFloat(z)});switch(k){case "translate":return{ab:k,B:[h[0]||0,h[1]||0]};case "rotate":return{ab:k,
B:[(h[0]||0)*Math.PI/180,h[1]||0,h[2]||0]};case "scale":var l=h[0]||1;return{ab:k,B:[l,h[1]||l]};case "matrix":return{ab:k,B:h};default:throw"transform not implemented: "+k;}})):null}function d(g,h){function k(n){for(var r=[],v=0;v<g.childElementCount;v++){var p=d(g.children[v],n);p&&r.push(p)}return r}function l(n,r){n=g.getAttribute(n);return null===n?r||0:parseFloat(n)}function z(n){n=n.replace(/\.([0-9]+)(?=\.)/g,".$1 ").replace(/([.0-9])-/g,"$1 -").replace(/\s*([a-z])\s*/gi,";$1").replace(/\s*,\s*/g,
",").replace(/\s+/g,",");var r=[],v=0,p=0,w=0,q=0;n.slice(1).split(";").forEach(function(t){var u=t[0];t=1<t.length?t.slice(1).split(",").map(function(D){return parseFloat(D)}):[];switch(u){case "M":if(2<=t.length){v=t[0];p=t[1];r.push({ab:"M",B:[v,p]});for(u=2;u+1<t.length;u+=2)v=t[u],p=t[u+1],r.push({ab:"L",B:[v,p]});w=v;q=p}break;case "m":if(2<=t.length)for(v+=t[0],p+=t[1],r.push({ab:"M",B:[v,p]}),u=2;u+1<t.length;u+=2)v+=t[u],p+=t[u+1],r.push({ab:"L",B:[v,p]});w=v;q=p;break;case "L":for(u=0;u+
1<t.length;u+=2)v=t[u],p=t[u+1],r.push({ab:"L",B:[v,p]});w=v;q=p;break;case "l":for(u=0;u+1<t.length;u+=2)v+=t[u],p+=t[u+1],r.push({ab:"L",B:[v,p]});w=v;q=p;break;case "H":for(u=0;u<t.length;u++)v=t[u],r.push({ab:"L",B:[v,p]});w=v;q=p;break;case "h":for(u=0;u<t.length;u++)v+=t[u],r.push({ab:"L",B:[v,p]});w=v;q=p;break;case "V":for(u=0;u<t.length;u++)p=t[u],r.push({ab:"L",B:[v,p]});w=v;q=p;break;case "v":for(u=0;u<t.length;u++)p+=t[u],r.push({ab:"L",B:[v,p]});w=v;q=p;break;case "A":for(u=0;u+6<t.length;u+=
7){var F=t[u+5],G=t[u+6];r.push({ab:"A",B:[t[u],t[u+1],t[u+2]*Math.PI/180,0!=t[u+3]?1:0,0==t[u+4]?1:0,v,p,F,G]});v=F;p=G}w=v;q=p;break;case "a":for(u=0;u+6<t.length;u+=7)F=v+t[u+5],G=p+t[u+6],r.push({ab:"A",B:[t[u],t[u+1],t[u+2]*Math.PI/180,0!=t[u+3],0==t[u+4],v,p,F,G]}),v=F,p=G;w=v;q=p;break;case "C":for(u=0;u+5<t.length;u+=6)r.push({ab:"C",B:t.slice(u,u+6)}),v=t[u+4],p=t[u+5],w=2*v-t[u+2],q=2*p-t[u+3];break;case "c":for(u=0;u+5<t.length;u+=6)r.push({ab:"C",B:[v+t[u],p+t[u+1],v+t[u+2],p+t[u+3],v+
t[u+4],p+t[u+5]]}),w=v+2*t[u+4]-t[u+2],q=p+2*t[u+5]-t[u+3],v+=t[u+4],p+=t[u+5];break;case "S":for(u=0;u+3<t.length;u+=4)r.push({ab:"S",B:[w,q,t[u],t[u+1],t[u+2],t[u+3]]}),v=t[u+2],p=t[u+3],w=2*v-t[u],q=2*p-t[u+1];break;case "s":for(u=0;u+3<t.length;u+=4)r.push({ab:"S",B:[w,q,v+t[u],p+t[u+1],v+t[u+2],p+t[u+3]]}),w=v-t[u],q=p-t[u+1],v+=t[u+2],p+=t[u+3];break;case "Q":for(u=0;u+3<t.length;u+=4)r.push({ab:"Q",B:[t[u],t[u+1],t[u+2],t[u+3]]}),v=t[u+2],p=t[u+3],w=2*v-t[u],q=2*p-t[u+1];break;case "q":for(u=
0;u+3<t.length;u+=4)r.push({ab:"Q",B:[v+t[u],p+t[u+1],v+t[u+2],p+t[u+3]]}),w=v+2*t[u+2]-t[u],q=p+2*t[u+3]-t[u+1],v+=t[u+2],p+=t[u+3];break;case "T":for(u=0;u+1<t.length;u+=2)r.push({ab:"Q",B:[w,q,t[u],t[u+1]]}),v=t[u],p=t[u+1],w=2*v-w,q=2*p-q;break;case "t":for(u=0;u+1<t.length;u+=2)r.push({ab:"Q",B:[w,q,v+t[u],p+t[u+1]]}),v+=t[u],p+=t[u+1],w=2*v-w,q=2*p-q;break;case "Z":case "z":r.push({ab:"Z",B:[]});break;default:throw"unimplemented path command: "+u;}});return r}var m=g.getAttribute("id"),x=function(){var n=
g.getAttribute("style")||"",r=g.getAttribute("class");r&&e.o.hasOwnProperty(r)&&(n=e.o[r]+";"+n);r={};ye(r,n);(n=g.getAttribute("stroke-dasharray"))&&(r["stroke-dasharray"]=n.split(","));(n=g.getAttribute("stroke-dashoffset"))&&(r["stroke-dashoffset"]=n);(n=g.getAttribute("id"))&&(r.id=n);return r}();h={name:g.tagName,id:m,style:x,parent:h};switch(g.tagName){case "svg":h.children=k(h);break;case "g":h.children=k(h);h.transform=c(g.getAttribute("transform"));break;case "path":h.path=z(g.getAttribute("d")||
"");h.transform=c(g.getAttribute("transform"));break;case "line":h.hd=l("x1");h.kd=l("y1");h.jd=l("x2");h.ld=l("y2");h.transform=c(g.getAttribute("transform"));break;case "polygon":case "polyline":h.mc=g.getAttribute("points").trim().replace(/\s+/g," ").split(" ").map(function(n){return parseFloat(n)});h.transform=c(g.getAttribute("transform"));break;case "circle":h.x=l("cx");h.y=l("cy");h.r=l("r");h.transform=c(g.getAttribute("transform"));break;case "rect":h.x=l("x");h.y=l("y");h.width=l("width");
h.height=l("height");m=l("rx");x=l("ry",m);m=l("rx",x);h.yg=m;h.zg=x;h.transform=c(g.getAttribute("transform"));break;case "text":h.x=l("x");h.y=l("y");h.text=g.textContent;h.transform=c(g.getAttribute("transform"));break;default:return null}return h}var e=a,f="";b(a.g);a.o=function(){var g={};f.split("}").forEach(function(h){var k=h.split("{");k[0].split(",").forEach(function(l){l=l.trim();/^\.[-a-z0-9]+/i.test(l)&&(l=l.slice(1),g[l]=g[l]?g[l]+";"+k[1]:k[1])})});return g}();a.g&&(a.l=d(a.g,null))}
function Je(a,b){function c(e,f){if(e.id===f)return e;if(e.children)for(var g=0;g<e.children.length;g++){var h=c(e.children[g],f);if(h)return h}return null}if(a.M[b])return a.M[b];var d=c(a.l,b);d&&(a.M[b]=d);return d}
function Ke(a,b,c,d,e){a&&a.forEach(function(f){switch(f.ab){case "translate":b(f.B[0],f.B[1]);break;case "rotate":0!==f.B[1]||0!==f.B[2]?(b(-f.B[1],-f.B[2]),c(f.B[0]),b(f.B[1],f.B[2])):c(f.B[0]);break;case "scale":d(f.B[0],f.B[1]);break;case "matrix":e(f.B[0],f.B[1],f.B[2],f.B[3],f.B[4],f.B[5])}})}
He.prototype.H=function(a,b){function c(r,v,p){function w(){for(var A=0;A<r.children.length;A++)c(r.children[A],v,p)}function q(A,S){A=h.apply(new Be(A,S));k.push(A.x);l.push(A.y)}function t(A,S,N){if(null==A||""==A)return S;A=/^\s*(-?[0-9.]+)\s*([a-z%]*)\s*$/i.exec(A);S=parseFloat(A[1]);switch(A[2]||"px"){case "pt":return 25.4*S/72*3;case "pc":return 25.4*S/6*3;case "in":return 25.4*S*3;case "mm":return 3*S;case "cm":return 30*S;case "em":return 18*S;case "ex":return 9*S;case "%":return S*N/100;
default:return S}}function u(A){var S=0,N=0,X=[],y=[],P=!0;a&&a.beginPath();A.forEach(function(I){switch(I.ab){case "M":2<=I.B.length&&(S=I.B[0],N=I.B[1],a&&a.moveTo(S,N),q(S,N),P&&1<X.length&&b&&b.wa&&b.wa.line&&b.wa.line(X,y,!1),P=!0,X=k.slice(-1),y=l.slice(-1));break;case "L":S=I.B[0];N=I.B[1];a&&a.lineTo(S,N);q(S,N);X.push(k[k.length-1]);y.push(l[l.length-1]);break;case "A":var C=I.B[5],B=I.B[6];var H=I.B[0];var Z=I.B[1],L=I.B[2],fa=0!=I.B[3],ia=0!=I.B[4],Y=I.B[5],J=I.B[6],E=I.B[7],Fa=I.B[8];
if(0===H||0===Z)a&&a.lineTo(E,Fa),H=new Be(E,Fa);else{var ma=Math.cos(L),wa=Math.sin(L);I=(ma*Y+wa*J)/H;J=(-wa*Y+ma*J)/Z;Y=(ma*E+wa*Fa)/H;E=(-wa*E+ma*Fa)/Z;Fa=(Y-I)/2;ma=(E-J)/2;wa=Fa*Fa+ma*ma;wa=Math.sqrt((1-wa)/wa);isNaN(wa)?wa=0:fa===ia&&(wa=-wa);fa=(I+Y)/2+wa*ma;Fa=(J+E)/2-wa*Fa;I=Math.atan2((J-Fa)/H,(I-fa)/Z);J=Math.atan2((E-Fa)/H,(Y-fa)/Z);a&&(a.rotate(L),a.scale(H,Z),ia?a.arc(fa,Fa,1,I,J,!0):a.arc(fa,Fa,1,I,J),a.scale(1/H,1/Z),a.rotate(-L));Y=new Ce;Y.rotate(L);Y.scale(H,Z);H=ia?I<J?(I+J)/
2+Math.PI:(I+J)/2:I<J?(I+J)/2:(I+J)/2+Math.PI;H=Y.apply(new Be(fa+Math.cos(H),Fa+Math.sin(H)))}S=C;N=B;q(H.x,H.y);q(S,N);P=!1;break;case "C":a&&a.bezierCurveTo(I.B[0],I.B[1],I.B[2],I.B[3],I.B[4],I.B[5]);S=I.B[4];N=I.B[5];q(S,N);P=!1;break;case "S":a&&a.bezierCurveTo(I.B[0],I.B[1],I.B[2],I.B[3],I.B[4],I.B[5]);S=I.B[4];N=I.B[5];q(S,N);P=!1;break;case "Q":a&&a.quadraticCurveTo(I.B[0],I.B[1],I.B[2],I.B[3]);S=I.B[2];N=I.B[3];q(S,N);P=!1;break;case "Z":a&&a.closePath(),P&&1<X.length&&b&&b.wa&&b.wa.line&&
b.wa.line(X,y,!0),P=!0,X=[],y=[]}});P&&1<X.length&&b&&b.wa&&b.wa.line&&b.wa.line(X,y,!1)}function F(A){function S(I,C){if(0<C.length){I.splice(0,I.length);for(var B=0;B<C.length&&1>B;B++){var H=(C[B].getAttribute("offset")||"0").trim(),Z=/%$/.test(H)?parseFloat(H.slice(0,-1))/100:parseFloat(H),L=C[B].getAttribute("style");H={};L&&ye(H,L);isNaN(Z)||(L=C[B].getAttribute("stop-color")||H["stop-color"]||"#000",ve.hasOwnProperty(L)&&(L=ve[L]),H=(C[B].getAttribute("stop-opacity")||H["stop-opacity"]||"1").trim(),
H=/%$/.test(H)?parseFloat(H.slice(0,-1))/100:parseFloat(H),1!==H&&(/^#[0-9a-f]{3}$/i.test(L)?L="rgba("+L.slice(1).split("").map(function(fa){return 17*parseInt(fa,16)}).map(function(fa){return fa.toString(10)}).join(",")+","+H.toFixed(2)+")":/^#[0-9a-f]{6}$/i.test(L)?L="rgba("+[L.slice(1,3),L.slice(3,5),L.slice(5)].map(function(fa){return parseInt(fa,16)}).map(function(fa){return fa.toString(10)}).join(",")+","+H.toFixed(2)+")":/^rgb(\d+%?(,|\s+)\d+%?(,|\s+)\d+%?)$/i.test(L)?L=L.slice(0,-1).replace(/\s+/g,
",")+","+H.toFixed(2)+")":/^hsl(\d+%?(,|\s+)\d+%?(,|\s+)\d+%?)$/i.test(L)&&(L=L.slice(0,-1).replace(/\s+/g,",")+","+H.toFixed(2)+")")),I.push({offset:Z,color:L}))}}}function N(I,C){if(I.attributes["xlink:href"]){var B=I.getAttribute("xlink:href");"#"===B[0]&&(B=g.b.getElementById(B.slice(1)))&&(C=N(B,C))}C.hd=I.attributes.x1?parseFloat(I.getAttribute("x1")):C.hd||0;C.kd=I.attributes.y1?parseFloat(I.getAttribute("y1")):C.kd||0;C.jd=I.attributes.x2?parseFloat(I.getAttribute("x2")):C.jd||0;C.ld=I.attributes.y2?
parseFloat(I.getAttribute("y2")):C.ld||0;C.yc=I.attributes.gradientUnits?I.getAttribute("gradientUnits"):C.yc||"objectBoundingBox";C.Rb=I.attributes.gradientTransform?I.getAttribute("gradientTransform"):C.Rb||"";C.ib=C.ib||[];S(C.ib,I.getElementsByTagName("stop"));return C}function X(I,C){if(I.attributes["xlink:href"]){var B=I.getAttribute("xlink:href");"#"===B[0]&&(B=g.b.getElementById(B.slice(1)))&&(C=X(B,C))}C.uc=I.attributes.cx?parseFloat(I.getAttribute("cx")):C.uc||0;C.vc=I.attributes.cy?parseFloat(I.getAttribute("cy")):
C.vc||0;C.r=I.attributes.r?parseFloat(I.getAttribute("r")):C.r||0;C.yc=I.attributes.gradientUnits?I.getAttribute("gradientUnits"):C.yc||"objectBoundingBox";C.Rb=I.attributes.gradientTransform?I.getAttribute("gradientTransform"):C.Rb||"";C.ib=C.ib||[];S(C.ib,I.getElementsByTagName("stop"));return C}var y=/^url\(#(.+)\)$/.exec(A);if(y&&y[1]&&(y=g.b.getElementById(y[1])))switch(y.tagName){case "linearGradient":A=N(y,{});if("objectBoundingBox"===A.yc)throw"objectBoundingBox not supported";if(A.Rb)throw y=
new Ce,Ae(A.Rb,y),"gradientTransform not supported";var P=a.createLinearGradient(A.hd,A.kd,A.jd,A.ld);for(y=0;y<A.ib.length;y++)P.addColorStop(A.ib[y].offset,A.ib[y].color);return P;case "radialGradient":A=X(y,{});if("objectBoundingBox"===A.yc)throw"objectBoundingBox not supported";A.Rb&&(y=new Ce,Ae(A.Rb,y),P=De(y,{x:A.uc,y:A.vc}),y=A.r/Math.sqrt(Math.abs(y.b[0]*y.b[4])),A.uc=P.x,A.vc=P.y,A.r=y);P=a.createRadialGradient(A.uc,A.vc,0,A.uc,A.vc,A.r);for(y=0;y<A.ib.length;y++)P.addColorStop(A.ib[y].offset,
A.ib[y].color);return P}return A}function G(A,S,N,X,y,P){0>=y||0>=P?a.rect(A,S,N,X):(y=Math.min((y+P)/2,Math.min(N,X)/2),a.moveTo(A+N-y,S),a.arc(A+N-y,S+y,y,1.5*Math.PI,2*Math.PI),a.lineTo(A+N,S+X-y),a.arc(A+N-y,S+X-y,y,0,.5*Math.PI),a.lineTo(A+y,S+X),a.arc(A+y,S+X-y,y,.5*Math.PI,Math.PI),a.lineTo(A,S+y),a.arc(A+y,S+y,y,Math.PI,1.5*Math.PI),a.closePath())}function D(){if(a){var A={};v&&we(A,v);p&&we(A,p);"hidden"!==A.visibility&&(A.opacity&&(a.globalAlpha*=parseFloat(A.opacity)),A.fill&&"none"===
A.fill||(a.fillStyle="white"===A.fill||"#fff"===A.fill||"#ffffff"===A.fill?"white":F(A.fill)||"none",a.fill()),A.stroke&&"none"!==A.stroke&&(a.lineWidth=t(A["stroke-width"]||"1px",1,100),a.strokeStyle=A.stroke||"none",a.miterLimit=A["stroke-miterlimit"]||4,a.lineJoin=A["stroke-linejoin"]||"miter",a.lineCap=A["stroke-linecap"]||"butt",A["stroke-dasharray"]&&(a.setLineDash(A["stroke-dasharray"].split(" ").map(function(S){return parseFloat(S)})),a.lineDashOffset=A["stroke-dashoffset"]?parseFloat(A["stroke-dashoffset"]):
0),a.stroke()))}}function O(A,S,N){if(a){var X={};v&&we(X,v);p&&we(X,p);"hidden"!==X.visibility&&(a.font=(X["font-size"]||"12px")+" "+(X["font-family"]||"helvetica"),X.fill&&"none"!==X.fill&&(a.fillStyle="white"===X.fill||"#fff"===X.fill||"#ffffff"===X.fill?"white":b&&b.fill||"silver",a.fillText(A,S,N)),X.stroke&&"none"!==X.stroke&&(a.strokeStyle=b&&b.stroke||"black",a.strokeText(A,S,N)))}}function Q(A,S){A=Ee({x:A,y:S});a.save();a.strokeStyle="black";a.lineWidth=1;a.strokeRect(A.Y,A.Z,A.pa-A.Y,A.la-
A.Z);a.restore()}var R=r.id&&b&&b.qd&&b.qd[r.id],V=r.id&&b&&b.Se&&b.Se[r.id];a&&a.save();h.save();R&&a&&d(r,R);V&&a&&e(V);v=xe(v);p=xe(p);r.style&&we(v,r.style);b&&b.fg&&ye(v,b.fg);r.id&&b&&b.style&&b.style.hasOwnProperty(r.id)&&ye(p,b.style[r.id]);R=k.length;switch(r.name){case "svg":h.save();f(r.transform);w();h.restore();break;case "g":h.save();f(r.transform);w();h.restore();break;case "path":a&&a.save();h.save();f(r.transform);u(r.path);D();a&&a.restore();h.restore();break;case "line":a&&a.save();
h.save();f(r.transform);a&&a.beginPath();a&&a.moveTo(r.hd,r.kd);a&&a.lineTo(r.jd,r.ld);D();q(r.hd,r.kd);q(r.jd,r.ld);b&&b.wa&&b.wa.line&&b.wa.line([r.hd,r.jd],[r.kd,r.ld],!1);a&&a.restore();h.restore();break;case "polygon":case "polyline":if(4<=r.mc.length){a&&a.save();h.save();f(r.transform);a&&a.beginPath();a&&a.moveTo(r.mc[0],r.mc[1]);q(r.mc[0],r.mc[1]);for(V=2;V+1<r.mc.length;V+=2)a&&a.lineTo(r.mc[V],r.mc[V+1]),q(r.mc[V],r.mc[V+1]);"polygon"===r.name&&a&&a.closePath();D();b&&b.wa&&b.wa.line&&
b.wa.line(k.slice(-r.mc.length/2),l.slice(-r.mc.length/2),"polygon"===r.name);a&&a.restore();h.restore()}break;case "circle":a&&a.save();h.save();f(r.transform);a&&a.beginPath();a&&a.arc(r.x,r.y,r.r,0,2*Math.PI);D();q(r.x-r.r,r.y-r.r);q(r.x-r.r,r.y+r.r);q(r.x+r.r,r.y-r.r);q(r.x+r.r,r.y+r.r);if(b&&b.wa&&b.wa.Re){V=k.slice(-4);var da=l.slice(-4),ja=(V[3]-V[0])*(V[3]-V[0])+(da[3]-da[0])*(da[3]-da[0]),K=(V[2]-V[1])*(V[2]-V[1])+(da[2]-da[1])*(da[2]-da[1]);.001>Math.abs(ja-K)/(ja+K)&&.001>((V[3]-V[0])*
(V[2]-V[1])+(da[3]-da[0])*(da[2]-da[1]))/ja&&b.wa.Re((V[0]+V[2])/2,(da[0]+da[2])/2,Math.sqrt(ja/8))}a&&a.restore();h.restore();break;case "rect":a&&a.save();h.save();f(r.transform);a&&(a.beginPath(),0<r.yg||0<r.zg?G(r.x,r.y,r.width,r.height,r.yg,r.zg):a.rect(r.x,r.y,r.width,r.height));D();q(r.x,r.y);q(r.x,r.y+r.height);q(r.x+r.width,r.y);q(r.x+r.width,r.y+r.height);a&&a.restore();h.restore();break;case "text":a&&a.save(),h.save(),f(r.transform),O(r.text,r.x,r.y),q(r.x,r.y),a&&a.restore(),h.restore()}a&&
a.restore();h.restore();a&&b&&b.eg&&Q(k.slice(R),l.slice(R))}function d(r,v){if(v.bb&&0!=v.bb){var p=v.Td,w=v.Ud;if(void 0==p||void 0==w)p=g.H(null,{Ac:r}),r=Ee(p),p=(r.Y+r.pa)/2,w=(r.Z+r.la)/2;a.translate(p+(v.Hb||0),w+(v.Ib||0));a.rotate(v.bb);a.translate(-p,-w)}else(v.Hb||v.Ib)&&a.translate(v.Hb,v.Ib)}function e(r){a.beginPath();a.rect(r.x,r.y,r.Rc,r.Hc);a.clip()}function f(r){Ke(r,function(v,p){a&&a.translate(v,p);h.translate(v,p)},function(v){a&&a.rotate(v);h.rotate(v)},function(v,p){a&&a.scale(v,
p);h.scale(v,p)},function(v,p,w,q,t,u){a&&a.transform(v,p,w,q,t,u);h.Ce(v,p,w,q,t,u)})}var g=this,h=new Fe,k=[],l=[],z=this.l;b&&b.Gd?z=Je(this,b.Gd):b&&b.Ac&&(z=b.Ac);if(z){b&&b.bf&&b.bf(a,this.Ca);if(a){for(var m=[],x=z.parentElement;null!=x;x=x.parentElement)m.push(x);for(x=m.length-1;0<=x;x--){var n=m[x].id;(n=n&&b&&b.qd&&b.qd[n])&&d(m[x],n);f(m[x].transform)}}c(z,{},{})}return{x:k,y:l}};
function Le(a,b){if(a.id===b)return a;if(a.children)for(var c=0;c<a.children.length;c++){var d=Le(a.children[c],b);if(d)return d}return null}He.prototype.lc=function(a){return null!=Le(this.l,a)};He.prototype.Bf=function(a,b){return null!=Le(Le(this.l,b),a)};function Ce(a){this.b=a||[1,0,0,0,1,0]}M=Ce.prototype;M.pb=function(){return new Ce(this.b)};M.apply=function(a){return new Be(this.b[0]*a.x+this.b[1]*a.y+this.b[2],this.b[3]*a.x+this.b[4]*a.y+this.b[5])};function De(a,b){var c=a.b[0]*a.b[4]-a.b[3]*a.b[1];return new Be((a.b[4]*b.x-a.b[1]*b.y+a.b[1]*a.b[5]-a.b[4]*a.b[2])/c,(-a.b[3]*b.x+a.b[0]*b.y+a.b[3]*a.b[2]-a.b[0]*a.b[5])/c)}
M.translate=function(a,b){this.b=[this.b[0],this.b[1],this.b[0]*a+this.b[1]*b+this.b[2],this.b[3],this.b[4],this.b[3]*a+this.b[4]*b+this.b[5]]};M.scale=function(a,b){this.b=[this.b[0]*a,this.b[1]*b,this.b[2],this.b[3]*a,this.b[4]*b,this.b[5]]};M.rotate=function(a){var b=Math.cos(a);a=Math.sin(a);this.b=[b*this.b[0]+a*this.b[1],-a*this.b[0]+b*this.b[1],this.b[2],b*this.b[3]+a*this.b[4],-a*this.b[3]+b*this.b[4],this.b[5]]};
M.Ce=function(a,b,c,d,e,f){this.b=[a*this.b[0]+c*this.b[1],b*this.b[0]+d*this.b[1],a*this.b[2]+c*this.b[3],b*this.b[2]+d*this.b[3],a*this.b[4]+c*this.b[5]+e,b*this.b[4]+d*this.b[5]+f]};function Be(a,b){this.x=a||0;this.y=b||0}function Fe(){this.stack=[new Ce]}M=Fe.prototype;M.apply=function(a){return this.stack[this.stack.length-1].apply(a)};M.save=function(){this.stack.push(this.stack[this.stack.length-1].pb())};M.restore=function(){if(2>this.stack.length)throw"restore doesn't match save";this.stack.pop()};
M.translate=function(a,b){this.stack[this.stack.length-1].translate(a,b)};M.scale=function(a,b){this.stack[this.stack.length-1].scale(a,b)};M.rotate=function(a){this.stack[this.stack.length-1].rotate(a)};M.Ce=function(a,b,c,d,e,f){this.stack[this.stack.length-1].Ce(a,b,c,d,e,f)};function bc(a){a=a.split("#");return{Xc:a[0],id:a[1]}}function Me(a,b,c){a.J.save();c.bf=function(d,e){this.clientData.Yd=e;d.translate(-e[0],-e[1]);d.scale(this.v.j/(e[2]-e[0]),this.v.j/(e[3]-e[1]))}.bind(a);b.H(a.J,c);a.J.restore()}function Ne(a,b,c,d,e){return{x:(a.clientData.Yd[2]-a.clientData.Yd[0])/d*(b+a.clientData.Yd[0]),y:(a.clientData.Yd[3]-a.clientData.Yd[1])/e*(c+a.clientData.Yd[1])}}
function Oe(a,b,c){var d={},e=(a.buttons?a.buttons.length:0)+(a.radiobuttons?1:0);if(void 0!=a.sliders){for(var f=0;f<a.sliders.length;f++){var g=a.sliders[f],h=Ge(b,g.id),k=Ge(b,g.thumbId),l=(k.Y+k.pa)/2,z=(k.Z+k.la)/2;h.pa-h.Y<h.la-h.Z?(h.Y=h.pa=(h.Y+h.pa)/2,l=h.Y):(h.Z=h.la=(h.Z+h.la)/2,z=h.Z);k=(c[e+f]-g.min)/(g.max-g.min);d[g.thumbId]={Hb:k*(h.pa-h.Y)-(l-h.Y),Ib:k*(h.Z-h.la)-(z-h.la)}}e+=a.sliders.length}if(void 0!=a.rotating)for(f=0;f<a.rotating.length;f++)g=a.rotating[f],k=g.numSteps?2*Math.PI/
g.numSteps:1,h=Ge(b,g.centerId),d[g.id]={bb:c[e+f]*k,Td:(h.Y+h.pa)/2,Ud:(h.Z+h.la)/2};return d}function Pe(a,b,c){return Math.min(Math.max((c-a)/(b-a),0),1)}
function Qe(a,b,c,d,e,f,g,h,k){e=Ne(a,k.x-g,k.y-h,e,f);var l=a.clientData.dd.min+(a.clientData.dd.max-a.clientData.dd.min)*Pe(a.clientData.min,a.clientData.max,a.clientData.qe?e.y:e.x),z=a.clientData.dd.min,m=a.clientData.dd.max;(e=a.clientData.dd.discrete)&&0<e.length?l=e.reduce(function(x,n){return Math.abs(l-n)<Math.abs(l-x)?n:x},e[0]):(a=a.clientData.dd.snap)&&a.forEach(function(x,n){"string"===typeof x&&/^`.+`$/.test(x)&&(x=ra(x,b,n,!0));Math.abs(l-x)<Math.abs(m-z)/10&&(l=x)});b.h[(d.buttons?
d.buttons.length:0)+(d.radiobuttons?1:0)+c]=Math.max(Math.min(z,m),Math.min(Math.max(z,m),l))}
function Re(a,b,c,d){if(0!==c.draw.length){for(var e=null,f=0;f<c.draw.length;f++)if(c.draw[f].uri){e=bc(c.draw[f].uri).Xc;break}var g=e?Oe(c,b.vb[e],d.h):{};f=null;if(c.diffwheelmotion&&c.diffwheelmotion.id){f=c.diffwheelmotion;var h=f.id,k=f.dx||0,l=f.dy||0,z=f.adjscale||1,m=f.color||"black",x=void 0===f.linewidth?1:f.linewidth;f=Ge(b.vb[e],h);var n=(c.buttons?c.buttons.length:0)+(c.radiobuttons?1:0),r=2.4*d.h[n];n=2.4*d.h[n+1];var v=a.v.j;f=(.5+k)*(f.pa-f.Y)*z/v;k=Vd(a,r,n,f,{color:m,Ae:x});g[h]=
{Hb:-(k.x*f*v+l*v*Math.sin(k.bb)),Ib:-(k.y*f*v+l*v*Math.cos(k.bb)),bb:-k.bb};f={Qg:r,Rg:n,Wg:f,color:m,Ae:x}}c.draw.forEach(function(p){if(p.uri){var w=bc(p.uri),q=b.vb[w.Xc];w=w.id;for(var t={},u=c.buttons?c.buttons.length:0,F=c.radiobuttons?c.radiobuttons.length:0,G=c.styles?c.styles.length:0,D=0;D<u;D++){var O=c.buttons[D].val,Q=c.buttons[D].st;O=O.indexOf(d.h[D]);0<=O&&(t[c.buttons[D].id]=Q[O])}for(D=0;D<F;D++)O=c.radiobuttons[D].val,Q=c.radiobuttons[D].st,t[c.radiobuttons[D].id]=Q[d.h[u]===O?
1:0];for(D=0;D<G;D++)t[c.styles[D].id]=ra(c.styles[D].st,d);u=b.vb[e];F=d.h;G={};if(void 0!=c.sliders)for(D=0;D<c.sliders.length;D++){Q=c.sliders[D];O=Ge(u,Q.id);var R=Q.lowerPartId&&Ge(u,Q.lowerPartId);if(R){var V=(F[D]-Q.min)/(Q.max-Q.min),da=R.pa-R.Y,ja=R.la-R.Z;G[Q.lowerPartId]=O.pa-O.Y<O.la-O.Z?{x:R.Y-ja,y:R.Z,Rc:da+2*ja,Hc:ja*V}:{x:R.Y,y:R.Z-ja,Rc:da*V,Hc:ja+2*da}}}Me(this,q,{Gd:w,style:t,qd:g,Se:G,eg:!1})}p.js&&(p=new Function("ctx","$",p.js),this.J.save(),this.J.scale(this.v.j/1E3,this.v.j/
1E3),this.J.beginPath(),p(this.J,d.h),this.J.restore())},a);f&&Vd(a,f.Qg,f.Rg,f.Wg,{color:f.color,Ae:f.Ae});c.score&&c.score.id&&(h=(c.buttons?c.buttons.length:0)+(c.radiobuttons?1:0)+(c.sliders?c.sliders.length:0),l=c.score,m=l.numHeights||5,f=Ge(b.vb[e],l.id),x=b.vb[e].Ca,Zd(a,d.h.slice(h),(f.Y-x[0])/(x[2]-x[0]),(f.pa-x[0])/(x[2]-x[0]),(f.la-x[1])/(x[3]-x[1]),(f.Z-x[1])/(x[3]-x[1]),m,(f.la-f.Z)/(x[3]-x[1])/m*(l.noteSize||1),void 0===l.linewidth?1:l.linewidth))}}
function Se(a,b,c){function d(e){for(var f=0;f<c.length;f++)if(c[f].name===e)return f;return-1}b.forEach(function(e){var f=e.name;if(!f)throw"Missing block name";var g=d(f),h=0<=g?c[g]:null,k=h?h.type:"?";if(e.type||!h)switch(e.type){case "event":k="e";break;case "action":k="a";break;case "state":k="s";break;case "comment":k="c";break;case "hidden":k="h";break;default:throw"Unknown block type "+e.type+" for block "+f;}var l=h?h.ma:[];e.modes&&!h&&e.modes.forEach(function(p){switch(p){case "basic":l.push("b");
break;case "advanced":l.push("a");break;default:throw"Unknown block mode "+p;}});var z=h?h.sc:null,m=e.validation;m&&(z=function(p){for(var w=0;w<m.length;w++){var q=m[w].assert;if("string"===typeof q&&/^`.+`$/.test(q)?!ra(q,p,void 0,!0):!q)return(p=m[w].warning)?new Ga(p,!0):new Ga(m[w].error||"Error")}});var x=h?h.H:function(p,w){Re(p,a,e,w)},n=h?h.aa:function(p,w,q,t,u,F,G){a:{var D=bc(e.draw[0].uri).Xc,O=0,Q=e.buttons;if(Q){var R;b:{var V=a.vb[D],da=Ne(p,G.x-u,G.y-F,q,t);for(R=0;R<Q.length;R++)if(V.sd(Q[R].id,
da.x,da.y)){V=Q[R].val.indexOf(w.h[R]);0<=V&&(ta(w),w.h[R]=Q[R].val[(V+1)%Q[R].val.length]);break b}R=null}if(null!==R){w=O+R;break a}O+=Q.length}if(R=e.radiobuttons){b:{V=a.vb[D];Q=Q||0;da=Ne(p,G.x-u,G.y-F,q,t);for(var ja=0;ja<R.length;ja++)if(V.sd(R[ja].id,da.x,da.y)){ta(w);w.h[Q]=R[ja].val;R=0;break b}R=null}if(null!==R){w=O+R;break a}O++}if(R=Q=e.pushbuttons){b:{R=a.vb[D];V=Ne(p,G.x-u,G.y-F,q,t);for(da=0;da<Q.length;da++)if(R.sd(Q[da].id,V.x,V.y)){ta(w);Q=Q[da].newParameters;"string"===typeof Q&&
/^`.+`$/.test(Q)&&(Q=ra(Q,w,void 0,!0));w.h=Q;Q=!0;break b}Q=null}R=null!==Q}if(R)w=-1;else{if(Q=e.sliders){b:{R=a.vb[D];V=Ne(p,G.x-u,G.y-F,q,t);for(da=0;da<Q.length;da++){p.clientData.dd=Q[da];var K=Ge(R,p.clientData.dd.id);p.clientData.qe=K.pa-K.Y<K.la-K.Z;p.clientData.min=p.clientData.qe?K.la:K.Y;p.clientData.max=p.clientData.qe?K.Z:K.pa;ja=(K.Y+K.pa)/2;K=(K.Z+K.la)/2;var A=Ge(R,p.clientData.dd.thumbId);if(Math.abs((p.clientData.qe?V.x:V.y)-(p.clientData.qe?ja:K))<(p.clientData.qe?A.pa-A.Y:A.la-
A.Z)){ta(w);R=da;break b}}R=null}if(null!==R){w=O+R;break a}O+=Q.length}if(Q=e.rotating){b:{R=a.vb[D];V=w.h.slice(O,O+Q.length);da=Ne(p,G.x-u,G.y-F,q,t);for(ja=0;ja<Q.length;ja++){K=Ge(R,Q[ja].centerId);K={x:(K.Y+K.pa)/2,y:(K.Z+K.la)/2};var S=Q[ja].numSteps?2*Math.PI/Q[ja].numSteps:1;A=K.x+(da.x-K.x)*Math.cos(V[ja]*S)+(da.y-K.y)*Math.sin(V[ja]*S);S=K.y-(da.x-K.x)*Math.sin(V[ja]*S)+(da.y-K.y)*Math.cos(V[ja]*S);if(R.sd(Q[ja].thumbId,A,S)){p.clientData.nh=Q[ja];p.clientData.ag=K;p.clientData.Ug=Math.atan2(S-
K.y,A-K.x);ta(w);R=ja;break b}}R=null}if(null!==R){w=O+R;break a}O+=Q.length}if(e.score&&(V=a.vb[D],p=(e.buttons?e.buttons.length:0)+(e.radiobuttons?1:0)+(e.sliders?e.sliders.length:0),D=w.h.slice(p).length/2,Q=e.score.numHeights||5,R=Ge(V,e.score.id),V=V.Ca,(q=oe((R.Y-V[0])/(V[2]-V[0]),(R.pa-V[0])/(V[2]-V[0]),(R.la-V[1])/(V[3]-V[1]),(R.Z-V[1])/(V[3]-V[1]),D,Q,q,t,u,F,G))?(ta(w),w.h[p+2*q.index]===q.tone?w.h[p+2*q.index+1]=(w.h[p+2*q.index+1]+1)%3:(w.h[p+2*q.index]=q.tone,w.h[p+2*q.index+1]=1),R=
0):R=null,null!==R)){w=O+R;break a}w=null}}return w},r=h?h.Pa:function(p,w,q,t,u,F,G,D){var O=(e.buttons?e.buttons.length:0)+(e.radiobuttons?1:0),Q=e.sliders?e.sliders.length:0;q>=O&&q<O+Q?Qe(p,w,q-O,e,t,u,F,G,D):(O+=Q,Q=e.rotating?e.rotating.length:0,q>=O&&q<O+Q&&(q-=O,t=Ne(p,D.x-F,D.y-G,t,u),w.h[(e.buttons?e.buttons.length:0)+(e.radiobuttons?1:0)+(e.sliders?e.sliders.length:0)+q]=Math.round(((Math.atan2(t.y-p.clientData.ag.y,t.x-p.clientData.ag.x)-p.clientData.Ug+Math.PI)%(2*Math.PI)-Math.PI)/(e.rotating[q].numSteps?
2*Math.PI/e.rotating[q].numSteps:1))))},v=te(e,h&&h.Jb);f={name:f,type:k,ma:l,ga:h?h.ga:function(){return e.defaultParameters||[]},jb:h?h.jb:function(){return e.typicalParameters||e.defaultParameters||[]},pe:h?h.pe||null:e.typicalParamSet||null,H:x,Wd:h?h.Wd||!1:e.alwaysZoom||!1,aa:n,Pa:r,Jb:v,sc:z};0<=g?c[g]=new qa(f):c.push(new qa(f))})}
function Te(a){Kc=function(c,d){return{j:c,kg:void 0===a.styles.minInteractiveBlockSize?60:a.styles.minInteractiveBlockSize,lg:void 0===a.styles.minTouchInteractiveBlockSize?120:a.styles.minTouchInteractiveBlockSize,gg:void 0===a.styles.eventRightAlign?!1:a.styles.eventRightAlign,ja:void 0===a.styles.blockLineWidth?Math.max(1,Math.min(3,c/40)):a.styles.blockLineWidth,sf:Math.round(c/4).toString(10)+"px sans-serif",c:d,sa:void 0===a.styles.controlLineWidth?Math.max(1,Math.min(3,c/40)):a.styles.controlLineWidth,
Ng:"bold 15px sans-serif",vf:a.styles.errorColor||"#f88",Tf:a.styles.warningColor||"#f88",background:a.styles.background||"white",Jf:a.styles.ruleMarks||"#bbb",Lf:a.styles.scrollbarThumbColor||"navy",Kf:a.styles.scrollbarBackgroundColor||"#ccc",Oc:a.styles.scrollbarWidth||5}};var b=[];Se(a,a.blocks||[],b);Va=b};function Ga(a,b){this.w=a;this.Kb=b||!1;this.g=!1;this.l=[];this.b=[];this.o=null}function nb(a,b){a.g=!0;a.l=b}function Ha(a,b){a.g=!0;a.o=b};function Na(){this.gc=[];this.bd=[]}function Ue(a,b){this.state=a;this.b=b||!1}function Ve(a){a.gc.forEach(function(b){b.b=!1});a.bd.forEach(function(b){b.b=!1})}Na.prototype.Cb=function(a,b){b&&Ve(this);this.gc.push(new Ue(a,b));20<this.gc.length&&(this.gc=this.gc.slice(-20));this.bd=[]};Na.prototype.Pf=function(a,b){b&&Ve(this);return 0<this.gc.length?(this.bd.push(new Ue(a,b)),this.gc.pop()):new Ue(a,b)};
Na.prototype.If=function(a,b){b&&Ve(this);return 0<this.bd.length?(this.gc.push(new Ue(a,b)),this.bd.pop()):new Ue(a,b)};sa.prototype.toDataURL=function(a,b,c){var d=this;switch(this.V.type){case "e":var e=sc(a,{tag:"block",W:["event","html"]});break;case "a":e=sc(a,{tag:"block",W:["action","html"]});break;case "s":e=sc(a,{tag:"block",W:["state","html"]});break;case "c":e=sc(a,{tag:"block",W:["comment","html"]});break;default:throw"internal";}e.width=b.j;e.height=b.j;return(new Jc(this,mc(e),e.oa(),0,0,function(f,g,h,k,l){h=g.x+e.offsetLeft()+h;k=g.y+e.offsetTop()+k;pc(e,f.J,h,k);var z=d.V;g=g.data;var m=e;f.J.save();
f.J.translate(h,k);z.H(f,g,m,l);f.J.restore()})).toDataURL(b,c||1)};function We(a,b,c,d,e){a=a.toDataURL(b,c,d);c="<img width='"+c.j.toString(10)+"' height='"+c.j.toString(10)+"' src='"+a+"'>";return e?"<a href='"+a+"' download='"+e+"'>"+c+"</a>":c}function Xe(a,b,c,d,e){var f=sc(c,{tag:"widget",id:"widget-"+b.replace(/^.*:/g,"")}),g=mc(f),h=f.oa();return{url:(new Jc(null,g,h,0,0,function(k,l,z,m){k.ha=a.ha;Vc(k,b,g/2+z,h/2+m,f)})).toDataURL(d,e||1),width:g,height:h}}
function Ye(a,b,c,d,e,f){a=Xe(a,b,c,d,e);b="<img width='"+a.width.toString(10)+"' height='"+a.height.toString(10)+"' src='"+a.url+"'>";return f?"<a href='"+a.url+"' download='"+f+"'>"+b+"</a>":b}function Ze(a,b,c,d,e,f){return{url:(new Jc(null,b,c,0,0,function(g){a(g.J,d,!1)})).toDataURL(e,f||1),width:b,height:c}}
function ec(a,b){var c=Kc(100,100),d=Ye(a.da,"vpl:then",b,c,5);return"<!DOCTYPE html>\n<html>\n"+(a.M?"<head>\n<style>\n"+a.M+"</style>\n</head>\n":"")+"<body>\n<table class='program'>\n"+a.i.i.map(function(e){return e.Ub()?"":"<tr class='rule'>\n<td class='events'>\n<table class='events'>\n<tr class='events'>\n"+e.U.map(function(f,g){var h="block";switch(f.V.type){case "e":h=h+" event"+(0===g?" event-main":" event-aux");break;case "s":h+=" state";break;case "c":h+=" comment"}return"<td class='"+
h+"'>"+We(f,b,c,5)+"</td>\n"}).join("")+"</tr>\n</table>\n</td>\n<td class='then'>"+d+"</td>\n<td class='actions'>\n<table class='actions'>\n<tr class='actions'>\n"+e.actions.map(function(f){var g="block";switch(f.V.type){case "a":g+=" action";break;case "c":g+=" comment"}return"<td class='"+g+"'>"+We(f,b,c,5)+"</td>\n"}).join("")+"</tr>\n</table>\n</td>\n</tr>\n"}).join("")+"</table>\n</body>\n</html>\n"}
function hc(a,b){function c(r,v){return v.controls.map(function(p){return(r.L.find(p.id).cb||[{}]).map(function(w){r.Qb.Ta=!0===w.selected;r.Qb.state=w.state||null;var q=!0===w.selected?"selected":!1===w.selected?"unselected":"";w.state&&(q+=(0<q.length?" ":"")+"="+w.state);w=p.id+(q?"-"+q.replace(/\s+/g,"-").replace("=",""):"")+".png";a:{var t=p.id;for(var u=g[p.id],F=d,G=e,D=0;D<v.controls.length;D++){var O=v.controls[D];if(O.id===t){t=Ze(O.H,O.Ec.pa-O.Ec.Y,O.Ec.la-O.Ec.Z,u,F,G);break a}}throw"button id not found";
}u="<img width='"+t.width.toString(10)+"' height='"+t.height.toString(10)+"' src='"+t.url+"'>";return"<tr><td>"+(w?"<a href='"+t.url+"' download='"+w+"'>"+u+"</a>":u)+"</td><td>"+p.id+"</td><td>"+q+"</td></tr>\n"}).join("")}).join("")}var d=Kc(100,100),e=5,f=Yc(a,b);a.Qb={disabled:!1,T:!0,Sg:!1,isEnabled:!0,Ta:!1,state:null};var g=Cc(a,a.P,["vpl","top"]),h=Zc(a,a.P,["vpl","top"],f.rc,f.Fg,g);g=Object.assign(g,Cc(a,a.w,["vpl","bottom"]));f=Zc(a,a.w,["vpl","bottom"],f.Ad,f.Eg,g);a.za.forEach(function(r){g[r]=
sc(b,{tag:"button",id:r.replace(/:/g,"-"),W:["src","top"]})},a);var k=$e(a,a.za,sc(b,{tag:"toolbar",W:["src","top"]}),sc(b,{tag:"separator",W:["src","top"]}),g);a.ha.forEach(function(r){g[r]=sc(b,{tag:"button",id:r.replace(/:/g,"-"),W:["sim","top"]})},a);var l=af(a,a.ha,sc(b,{tag:"toolbar",W:["sim","top"]}),sc(b,{tag:"separator",W:["sim","top"]}),g),z="sim-event:forward sim-event:backward sim-event:left sim-event:right sim-event:center sim-event:clap sim-event:tap".split(" "),m=a.F,x=sc(b,{tag:"button",
W:["sim","event"]}),n=z.map(function(r){return Ze(function(v,p,w){(m.fc||rc)(r,v,d,b,["sim","event"],null,!0,!1,w)},x.width,x.height,x,d,e)});h="<!DOCTYPE html>\n<html>\n"+(a.M?"<head>\n<style>\n"+a.M+"</style>\n</head>\n":"")+"<body>\n<table>\n"+Va.map(function(r){var v=null;switch(r.type){case "e":v="event";break;case "s":v="state";break;case "a":v="action";break;case "c":v="comment";break;default:return""}var p=new sa(r,null,null),w="<tr class='"+v+"'>\n<td>\n";r.pe?r.pe.forEach(function(q,t){p.h=
q;w+=We(p,b,d,e,r.name.replace(/ /g,"_")+"-"+t.toString(10)+".png")}):(p.h=r.jb?r.jb():p.h,w+=We(p,b,d,e,r.name.replace(/ /g,"_")+".png"));return w+="</td>\n<td>"+r.name+"</td>\n</tr>\n"}).join("")+"</table>\n<table>\n"+Object.keys(a.da.ha).map(function(r){return"<tr><td>"+Ye(this.da,r,b,d,e,r+".png")+"</td><td>"+r+"</td></tr>\n"},a).join("")+"</table>\n<table>\n"+c(a,h)+c(a,f)+c(a,k)+c(a,l)+n.map(function(r,v){v=z[v];var p="<img width='"+r.width.toString(10)+"' height='"+r.height.toString(10)+"' src='"+
r.url+"'>",w=v.replace(/ /g,"_")+".png";return"<tr><td><a href='"+(r.url+"' download='"+w+"'>"+p+"</a></td><td>")+v+"</td></tr>\n"})+"</table>\n</body>\n</html>\n";a.Qb=null;return h};function bf(a,b){b=(new DOMParser).parseFromString(b,"text/xml").getElementsByTagName("node");if(1>b.length)throw"empty";b=b[0].getElementsByTagName("program");if(1!==b.length)throw"program";var c="0"!==b[0].getAttribute("advanced_mode");b=b[0].getElementsByTagName("set");Wa(a);a.mode=c?"a":"b";for(var d=0;d<b.length;d++){var e=cf(b[d],c,function(){a.Cb()});a.i.push(e)}}
function cf(a,b,c){a=a.getElementsByTagName("block");for(var d=new za,e=0;e<a.length;e++){var f=a[e],g=b;f.getAttribute("type");var h=f.getAttribute("name"),k=df[h],l=ef[k];if(void 0===l)throw"unknown AESL block "+h;h=[];for(var z=0;1E3>z;z++){var m=f.getAttribute("value"+z);if(null===m)break;h.push(l.Zg?m:parseInt(m,10))}g&&l.se&&(k=l.se,l=ef[k]);f=ya(k);g=new sa(f,null,null);l=l.kb?l.kb(h):h;f.fe?f.fe(g,l):g.h=l;Aa(d,g,null,c,!0)}return d}
var fc=function(){var a=null;return function(b,c,d){null===a&&(a=document.createElement("a"),document.body.appendChild(a),a.style.display="none");d=d||"application/xml";var e;"function"===typeof window.Blob&&window.URL?e=window.URL.createObjectURL(new window.Blob([b],{type:d})):e="data:"+d+";base64,"+window.btoa(b);var f=a;d=d||"application/xml";var g;"function"===typeof window.Blob&&window.URL?g=window.URL.createObjectURL(new window.Blob([b],{type:d})):g="data:"+d+";base64,"+window.btoa(b);f.href=
g;f.download=c||"untitled.xml";a.click();"string"!==typeof e&&window.URL.revokeObjectURL(e)}}();function ff(){return[]}
var ef={accelerometer:{name:"acc",rb:function(a){return[[0,2,1][a[0]],-a[1]]},kb:function(a){return[[0,2,1][a[0]],-a[1]]}},"bottom color":{name:"colorbottom",rb:function(a){return a.map(function(b){return Math.round(32*b)})},kb:function(a){return a.map(function(b){return b/32})}},button:{name:"button",rb:function(a){return[1,4,2,3,0].map(function(b){return a[b]?1:0}).concat(0,0)},kb:function(a){return[4,0,2,3,1].map(function(b){return 0!==a[b]})}},clap:{name:"clap",rb:ff,kb:ff},"color state":{name:"colorstate",
ye:!0,rb:function(a){return a.map(function(b){return Math.floor(2.99*b)})},kb:function(a){return a.map(function(b){return b/2})}},"counter comparison":{name:"countercmp",ye:!0,rb:function(a){return a},kb:function(a){return a}},ground:{name:"proxground",se:"ground adv",rb:function(a){return a.map(function(b){return 0<b?1:0>b?2:0}).concat(400,450)},kb:function(a){return a.slice(0,2).map(function(b){return 2===b?-1:b})}},"ground adv":{name:"proxground",rb:function(a){return a.slice(0,2).map(function(b){return 0<
b?1:0>b?2:0}).concat(a.slice(2).map(function(b){return Math.round(1E3*b)}))},kb:function(a){return a.slice(0,2).map(function(b){return 2===b?-1:b}).concat(a.slice(2).map(function(b){return Math.max(0,Math.min(1,b/1E3))}))}},"horiz prox":{name:"prox",se:"horiz prox adv",rb:function(a){return a.map(function(b){return 0<b?1:0>b?2:0}).concat(1E3,2E3)},kb:function(a){return a.slice(0,7).map(function(b){return 2===b?-1:b})}},"horiz prox adv":{name:"prox",rb:function(a){return a.slice(0,7).map(function(b){return 0<
b?1:0>b?2:0}).concat(a.slice(7).map(function(b){return Math.round(700+3300*b)}))},kb:function(a){return a.slice(0,7).map(function(b){return 2===b?-1:b}).concat(a.slice(7).map(function(b){return Math.max(0,Math.min(1,(b-700)/3300))}))}},init:{name:"init",ye:!0,rb:ff,kb:ff},motor:{name:"move",rb:function(a){return a.map(function(b){return Math.round(500*b)})},kb:function(a){return a.map(function(b){return b/500})}},move:{name:"move2"},notes:{name:"sound",rb:function(a){for(var b=[],c=0;6>c;c++)b.push(0===
a[2*c+1]?517:a[2*c]+256*a[2*c+1]);return b},kb:function(a){for(var b=[],c=0;6>c;c++)b.push(a[c]%256),b.push(517<=a[c]?0:Math.floor(a[c]/256));return b}},"set counter":{name:"setcounter",ye:!0,rb:function(a){return a},kb:function(a){return a}},"set state":{name:"setstate",rb:function(a){return a.map(function(b){return 0<b?1:0>b?2:0})},kb:function(a){return a.map(function(b){return 2===b?-1:b})}},"set timer":{name:"timer",rb:function(a){return[Math.round(1E3*a[0])]},kb:function(a){return[a[0]/1E3]}},
"set timer log":{name:"timerlog",ye:!0,rb:function(a){return[Math.round(1E3*a[0])]},kb:function(a){return[a[0]/1E3]}},state:{name:"statefilter",rb:function(a){return a.map(function(b){return 0<b?1:0>b?2:0})},kb:function(a){return a.map(function(b){return 2===b?-1:b})}},"top color":{name:"colortop",rb:function(a){return a.map(function(b){return Math.round(32*b)})},kb:function(a){return a.map(function(b){return b/32})}},tap:{name:"acc",se:"accelerometer",rb:function(){return[0,0]},kb:ff},timer:{name:"timeout",
rb:ff,kb:ff},"picture comment":{name:"commentpict",ye:!0,Zg:!0,rb:function(a){return[a[1]]},kb:function(a){return[!1,a[0]]}}},gf={},hf;for(hf in ef)if(ef.hasOwnProperty(hf)){var jf=ef[hf].name;gf[jf]&&ef[gf[jf]].se||(gf[jf]=hf)}var df=gf;function kf(){this.wb=document.getElementById("editor");this.wb.value="";this.b=this.wb.parentElement;var a=window.innerWidth,b=window.getComputedStyle(this.wb);this.wb.style.width=a-10-parseInt(b.paddingLeft,10)-parseInt(b.paddingRight,10)+"px";this.wb.style.border="0px";this.wb.style.outline="none";this.wb.style.resize="none";this.wb.style.whiteSpace="pre";this.wb.setAttribute("wrap","off");this.g=null}kf.prototype.kf=function(a,b){this.wb.setSelectionRange(a,b)};
kf.prototype.resize=function(){var a=this.b.getBoundingClientRect().width,b=window.getComputedStyle(this.wb);this.wb.style.width=a-10-parseInt(b.paddingLeft,10)-parseInt(b.paddingRight,10)+"px"};function lf(a,b){a.wb.value=b;window.getComputedStyle(a.wb)};function mf(a,b,c){this.fa=b;this.language=c||"aseba";this.b="";this.Kc=!0;this.fd=this.be=this.Rf=null;this.Ob=!1;this.ya=a.ya||new Ia;this.ec=new kf;this.ec.wb.readOnly=this.Kc;this.ec.g=function(f){window.vplBreakpointsFunction&&window.vplBreakpointsFunction(f)};var d=this;this.Ga=new Ib(a.Ra,{ba:a.ba});document.getElementById("editor").addEventListener("input",function(){Ub(a);nf(d)===a.i.fa&&(a.i.fa=!a.i.fa,Kb(a))},!1);var e=document.getElementById("editor");e&&document.getElementById("editor").addEventListener("keydown",
function(f){if(9===f.keyCode){f.preventDefault();f.b=!0;f=e.value;var g=this.selectionStart;f=f.slice(0,g)+"\t"+f.slice(this.selectionEnd);lf(d.ec,f);this.selectionStart=this.selectionEnd=g+1;return!1}return!0},!1)}function of(a,b){a.Rf=b}M=mf.prototype;M.je=function(){this.ya.b=[]};function pf(a){var b="teacher"===bb("role");a.Ob=b}function Rb(a,b,c){null===b?lf(a.ec,a.b):(a.b=b,lf(a.ec,b));c||(a.fd=null)}M.$b=function(){return document.getElementById("editor").value.replace(/\s+$/,"")};
function nf(a){return a.$b()===a.b.trim()}M.kf=function(a,b){this.ec.kf(a,b)};function qf(a){var b=sc(a.Ga.ba,{tag:"button",W:["src","top"]});b.height=a.Ga.v.c;a=sc(a.Ga.ba,{tag:"toolbar",W:["src","top"]});a.height=b.oa();return{height:a.height,oa:a.oa()}}function $e(a,b,c,d,e){var f=new jc(a.I.Ga);Ac(f,a,b,["src","top"],a.I.fc||rc,a.I.Ie||xc);lc(f,c,e,d);return f}
function Ub(a){var b=a.I;b.Ga.$a=[];var c=b.Nf||a.za,d=Cc(a,c,["src","top"]),e=qf(b).height,f=ad(b.Ga);$c(b.Ga);var g=sc(b.Ga.ba,{tag:"view",W:["src"]});sc(b.Ga.ba,{tag:"button",W:["src","top"]});var h=sc(b.Ga.ba,{tag:"separator",W:["src","top"]}),k=sc(b.Ga.ba,{tag:"toolbar",W:["src","top"]});g.oc(f.width);g.cc(f.height);g.setPosition(0,0);k.oc(g.width);k.height=e;k.setPosition(g.x,g.y);oc(b.Ga,function(l){g.H(l)});nc($e(a,c,k,h,d),k,d);Ob(b.Ga)}
function Pb(a,b){(a.Kc=b)&&lf(a.ec,a.b);a.ec.wb.readOnly=b;Ub(window.vplApp)}
M.resize=function(a,b){this.Ga.resize(a,b);a=this.Ga.b.getBoundingClientRect();b=document.getElementById("src-editor");var c=ad(this.Ga);var d=sc(this.Ga.ba,{tag:"view",W:["src"]});d.oc(c.width);d.cc(c.height);d.setPosition(0,0);var e=qf(this);c=d.x;var f=d.y+e.oa;var g=d.width;d=d.height-e.oa;b.style.left=a.left+a.width*this.Ga.ua.Y+c+"px";b.style.width=g+"px";b.style.top=a.top+a.height*this.Ga.ua.Z+f+"px";b.style.height=d+"px";this.ec.resize();Ub(window.vplApp)};
M.focus=function(){document.getElementById("editor").focus();Ob(this.Ga)};function rf(a){a.L.add("src:close",{action:function(b){b.fb(["src"],{Te:!0})},object:a,T:function(b){return 1<b.Aa.length&&0<=b.Aa.indexOf("src")}});a.L.add("src:new",{action:function(b){lf(b.I.ec,"");Ob(b.I.Ga)},isEnabled:function(b){return!b.I.Kc&&0<b.I.$b().length},object:a});a.L.add("src:save",{action:function(b){var c=cb(b.i,{Yc:!1,ad:!0});fc(c,b.i.filename||"program.vpl3","application/x-vpl3")},isEnabled:function(b){return 0<b.I.$b().length},object:a});a.L.add("src:vpl",{action:function(b){b.Ld?
b.fb(["vpl"],{Nd:!0}):b.fb(["vpl"],{Id:"src"})},isEnabled:function(b){return nf(b.I)},object:a,T:function(b){return!b.I.fa&&0>b.Aa.indexOf("vpl")}});a.L.add("src:locked",{action:function(b){Pb(b.I,!b.I.Kc);Ob(b.I.Ga);b.I.Kc&&(b.i.fa=!1,Kb(b))},isEnabled:function(b){return null===b.I.fd},Ta:function(b){return b.I.Kc},object:a,T:function(b){return!b.I.fa},cb:[{selected:!1},{selected:!0}]});a.L.add("src:language",{action:function(b){var c=b.I.Rf();b.I.language=c.language;b.I.Kc&&Rb(b.I,c.code)},isEnabled:function(b){return null===
b.I.fd},getState:function(b){return b.I.language},object:a,T:function(b){return null!=b.I.Rf},cb:[{state:"aseba"},{state:"l2"},{state:"asm"},{state:"js"},{state:"python"}]});a.L.add("src:disass",{action:function(b){if(null!==b.I.fd)Rb(b.I,b.I.fd),b.I.ec.wb.readOnly=b.I.Kc;else{var c=b.I.$b(),d=b.I.be(b.I.language,c);null!==d&&(Rb(b.I,d,!0),b.I.ec.wb.readOnly=!0,b.I.fd=c)}Ub(b)},isEnabled:function(b){return null!=b.I.be&&null!==b.I.be(b.I.language,"")},Ta:function(b){return null!==b.I.fd},object:a,
T:function(b){return null!==b.I.be},cb:[{selected:!1},{selected:!0}]});a.L.add("src:run",{action:function(b){var c=b.I.$b();b.La[b.xa].eb.Zb(c,b.I.language)},isEnabled:function(b){return b.La[b.xa].eb.isEnabled(b.I.language)},getState:function(b){return 0===b.I.$b().length?"empty":"canLoad"},object:a,T:function(b){return 0<=b.xa},cb:[{selected:!1},{selected:!0},{state:"empty"},{state:"running"},{state:"error"},{state:"canLoad"},{state:"canReload"}]});a.L.add("src:stop",{action:function(b){Xb(b)},
isEnabled:function(b){return Yb(b)},object:a,T:function(b){return 0<=b.xa}});a.L.add("src:connected",{isEnabled:function(b){return!b.i.fa&&0<=b.xa&&b.La[b.xa].eb.isConnected()},object:a,T:function(b){return 0<b.La.length},cb:[{selected:!1},{selected:!0},{selected:!1,state:"monitored"},{selected:!0,state:"monitored"},{selected:!1,state:"nonmonitored"},{selected:!0,state:"nonmonitored"}]});a.L.add("src:sim",{action:function(b){b.Ld?b.fb(["sim"],{Nd:!0}):b.fb(["sim"],{Id:"src"})},object:a,T:function(b){return null!=
b.La.find(function(c){return"sim"===c.name})&&null!=b.F&&0>b.Aa.indexOf("sim")}});a.L.add("src:teacher-reset",{action:function(b){b.I.je();Ub(b)},object:a,Mc:!0,T:function(b){return b.I.Ob&&b.I.ya.Xa}});a.L.add("src:teacher",{action:function(b){b.I.ya.Xa=!b.I.ya.Xa;Ub(b)},Ta:function(b){return b.I.ya.Xa},object:a,Mc:!0,T:function(b){return b.I.Ob},cb:[{selected:!1},{selected:!0}]})};function sf(a){var b=["vpl:message-error","vpl:message-warning"];return function(c,d,e,f,g,h,k,l,z,m){function x(v){if(void 0==v)return!0;for(var p=0;p<v.length;p++)switch(v[p]){case "pressed":if(!z||!k)return!1;break;case "unpressed":if(z&&k)return!1;break;case "selected":if(!l)return!1;break;case "unselected":if(l)return!1;break;case "disabled":if(k)return!1;break;case "enabled":if(!k)return!1;break;default:if("="===v[p][0]&&(m||"").toString()!==v[p].slice(1))return!1}return!0}var n=sc(f,{tag:"button",
W:g,id:c.replace(/:/g,"-")});if(a.buttons)for(var r=0;r<a.buttons.length;r++)if(a.buttons[r].name===c&&x(a.buttons[r].state)){a.buttons[r].draw.forEach(function(v){if(v.uri){var p=bc(v.uri);d.save();v.alpha&&(d.globalAlpha=v.alpha);a.vb[p.Xc].H(d,{Gd:p.id});v.debug&&(d.fillStyle="black",d.textAlign="center",d.textBaseline="middle",d.fillText(v.debug,n.width/2,n.height/2));d.restore()}v.js&&(v=new Function("ctx",v.js),d.save(),d.scale(n.width,n.height),d.beginPath(),v(d),d.restore())});return}0<=b.indexOf(c)?
rc(c,d,e,f,g,h,k,l,z,m):(d.fillStyle="brown",d.fillRect(0,0,n.width,n.height),d.fillStyle="white",d.textAlign="left",d.textBaseline="top",d.font=Math.round(n.height/6).toString(10)+"px sans-serif",d.fillText(c,.02*n.width,.02*n.height),d.fillText((z?"pr ":"")+(l?"sel ":"")+(k?"":"dis"),.02*n.width,.22*n.height),m&&d.fillText("="+m,.02*n.width,.42*n.height))}}
function tf(a){return function(b,c){if(a.buttons)for(var d=0;d<a.buttons.length;d++){var e=a.buttons[d];if(e.name===b&&(void 0==e.state||0>e.state.indexOf("pressed")&&0>e.state.indexOf("selected")&&0>e.state.indexOf("disabled")))return b=bc(e.draw[0].uri),Ge(a.vb[b.Xc],b.id)}return{Y:0,pa:c.c,Z:0,la:c.c}}}
function uf(a){function b(d){for(var e=0;e<a.widgets.length;e++)if(a.widgets[e].name===d)return a.widgets[e];return null}if(void 0==a.widgets)return{};var c={};["vpl:then","vpl:error","vpl:warning","vpl:moreHigh","vpl:moreLow"].forEach(function(d){var e=b(d);if(e){var f=bc(e.draw[0].uri),g=Ge(a.vb[f.Xc],f.id);c[d]=function(h,k,l,z){e.draw.forEach(function(m){if(m.uri){var x=bc(m.uri);m.alpha&&(h.globalAlpha=m.alpha);h.save();var n=Math.min(z.width/(g.pa-g.Y),z.height/(g.la-g.Z));h.scale(n,n);h.translate(-(g.Y+
g.pa)/2,-(g.Z+g.la)/2);a.vb[x.Xc].H(h,{Gd:x.id});h.restore();m.debug&&(h.fillStyle="black",h.textAlign="center",h.textBaseline="middle",h.fillText(m.debug,0,0))}m.js&&(m=new Function("ctx",m.js),h.save(),h.scale(z.width,z.height),h.beginPath(),m(h),h.restore())})}}});return c};function vf(a){this.w=a&&a.Zb?a.Zb:null;this.l=a&&a.Ic?a.Ic:null;this.o=a&&a.isConnected?a.isConnected:null;this.b=a&&a.isEnabled?a.isEnabled:null;this.g=a&&a.Jd?a.Jd:null;this.wd=a&&a.wd?a.wd:"aseba";this.languages=a&&a.languages?a.languages:[this.wd];this.state=a&&a.state?a.state:null}M=vf.prototype;M.isConnected=function(){return null==this.o||this.o()};M.isEnabled=function(a){return null!=this.w&&0<=this.languages.indexOf(a)&&(null==this.b||this.b(a))};
M.Jd=function(){return null!=this.g?this.g():null};M.Ic=function(a){this.l&&this.l(a)};M.Zb=function(a,b){this.isEnabled(b)&&this.w(b,a)};function Mb(a,b){this.o=a;this.l=document.createElement("div");this.l.style.width="100%";this.l.style.height="100%";this.l.style.position="fixed";this.l.style.top="0";this.l.style.left="0";this.l.style.zIndex="1000";this.l.style.backgroundColor="rgba(1,1,1,0.5)";this.l.style.display="none";this.g=document.createElement("div");this.g.style.width="80%";this.g.style.height="80%";this.g.style.position="fixed";this.g.style.top="50%";this.g.style.left="50%";this.g.style.backgroundColor="white";this.g.style.padding=
"2em";this.l.appendChild(this.g);document.body.appendChild(this.l);this.b=null;if(!b){this.b=document.createElement("div");this.b.style.position="absolute";this.b.style.width="32px";this.b.style.height="32px";this.b.style.top="0";this.b.style.left="0";this.b.textContent="\u00d7";this.b.style.font="bold 30px sans-serif";this.b.style.textAlign="left";this.b.style.padding="5px";this.b.style.paddingLeft="10px";var c=this;this.b.addEventListener("click",function(){c.zc()},!1)}}
Mb.prototype.show=function(){this.g.innerHTML=this.o;this.b&&this.g.appendChild(this.b);this.l.style.display="block";Wb(this)};Mb.prototype.zc=function(){this.l.style.display="none"};function Wb(a){var b=a.g.getBoundingClientRect();a.g.style.marginLeft=-b.width/2+"px";a.g.style.marginTop=-b.height/2+"px"};function dc(a,b,c){try{db(a.i,b,function(d){if(0>this.Aa.indexOf(d))if(1===this.Aa.length)this.fb([d]);else{var e=this.Aa.slice();e[0<=e.indexOf("vpl")?e.indexOf("vpl"):0<=e.indexOf("src")?e.indexOf("src"):0]=d;this.fb(e)}0<=this.Aa.indexOf("vpl")&&this.da.na()},c)}catch(d){}}function wf(a){return(a=/^[^.]+\.(.*)$/.exec(a))?a[1].toLowerCase():""}
function gc(a,b){var c=wf(b.name),d=new window.FileReader;switch(c){case "aesl":case "vpl3":case "vpl3ui":case "json":return d.onload=function(e){e=e.target.result;var f=b.name;try{bf(a.i,e)}catch(g){dc(a,e,{dg:"vpl3ui"===c})}a.i.filename=f;a.da.na()},d.readAsText(b),!0}return!1}
function xf(a,b){var c=/^[^.]+\.(.*)$/.exec(b.name);c=c?c[1]:"";var d=new window.FileReader;switch(c.toLowerCase()){case "svg":case "png":case "jpg":case "gif":return a.F&&("obstacle"===a.F.kc?(d.onload=function(e){yf(a,e.target.result)},d.readAsText(b)):(d.onload=function(e){e=e.target.result;var f=new Image;f.addEventListener("load",function(){zf(a,f)});f.src=e},d.readAsDataURL(b))),!0}return!1}
function Af(a,b){var c=/^[^.]+\.(.*)$/.exec(b.name);c=c?c[1]:"";var d=new window.FileReader;switch(c.toLowerCase()){case "wav":a.F&&(d.onload=function(e){a.F.X.setFile(b.name,e.target.result)},d.readAsArrayBuffer(b))}};function Bf(a){var b=this;this.b=document.createElement("div");this.b.style.width="100%";this.b.style.height="100%";this.b.style.position="fixed";this.b.style.top="0";this.b.style.left="0";this.b.style.zIndex="1000";this.b.style.backgroundColor="rgba(1,1,1,0.5)";this.b.style.display="none";this.g=document.createElement("div");this.g.style.width="40em";this.g.style.position="fixed";this.g.style.top="50%";this.g.style.left="50%";this.g.style.backgroundColor="white";this.g.style.padding="2em";this.b.appendChild(this.g);
document.body.appendChild(this.b);var c=document.createElement("p");this.w=c;this.g.appendChild(c);c=document.createElement("table");c.style.width="100%";this.g.appendChild(c);var d=document.createElement("tr");c.appendChild(d);var e=document.createElement("td");d.appendChild(e);this.input=document.createElement("input");this.input.setAttribute("type","file");this.input.style.width="35em";e.appendChild(this.input);e=document.createElement("td");e.align="right";d.appendChild(e);d=document.createElement("input");
d.setAttribute("type","button");d.setAttribute("value",a.g.translate("OK"));d.addEventListener("click",function(){var f=b.input.files[0];f&&b.l(f);b.zc()},!1);e.appendChild(d);e.appendChild(document.createTextNode("\u00a0\u00a0"));d=document.createElement("input");d.setAttribute("type","button");d.setAttribute("value",a.g.translate("Cancel"));d.addEventListener("click",function(){b.zc()},!1);e.appendChild(d);e=document.createElement("div");e.style.position="absolute";e.style.width="32px";e.style.height=
"32px";e.style.top="0";e.style.left="0";e.textContent="\u00d7";e.style.font="bold 30px sans-serif";e.style.textAlign="left";e.style.padding="5px";e.style.paddingLeft="10px";e.addEventListener("click",function(){b.zc()},!1);c.appendChild(e);this.o=a.g;this.l=null}
Bf.prototype.show=function(a,b,c){this.w.textContent=this.o.translate(a);this.input.setAttribute("accept",b);this.l=c;this.b.style.display="block";a=this.g.getBoundingClientRect();this.g.style.marginLeft=-a.width/2+"px";this.g.style.marginTop=-a.height/2+"px"};Bf.prototype.zc=function(){this.b.style.display="none"};function Cf(a,b,c){this.b=a;this.w=b;this.g=null;this.o=!1;this.l=c;var d=this;setInterval(function(){null!=d.g&&2<=d.g.readyState&&(!1!==d.b.He&&(d.b.He=!1,Kb(d.b)),d.connect())},5E3)}
Cf.prototype.connect=function(){var a=this;this.g=new WebSocket(this.w);this.g.addEventListener("open",function(){a.b.He=!0;a.g.send(JSON.stringify({sender:{type:"vpl",sessionid:a.l,role:a.b.i.Ob?"teacher":"student"},type:"hello"}));window.addEventListener("unload",function(){a.g.send(JSON.stringify({sender:{type:"vpl",sessionid:a.l,role:a.b.i.Ob?"teacher":"student"},type:"bye"}))});Kb(a.b)});this.g.addEventListener("message",function(b){try{var c=JSON.parse(b.data);switch(c.type){case "cmd":var d=
c.data.cmd,e=c.data.selected,f=c.data.state,g=a.b.L;if(g.T(d)&&Bb(g,d)&&g.isEnabled(d))if(void 0!==e){var h=g.find(d),k;if(k=h)h.g?e===h.Ta()?k=!0:(Db(h,void 0),k=e===h.Ta()):k=!1;k&&Cb(g,d)}else if(void 0!==f){var l=g.find(d);l&&Eb(l,f)&&Cb(g,d)}else{var z=g.find(d);z&&(Db(z,void 0),Cb(g,d))}Rd(a.b.da);break;case "file":var m=c.data.content;switch(c.data.kind){case "vpl":var x=wf(c.data.name||"");/^[\s]*{/.test(m)?dc(a.b,m,{dg:"vpl3ui"===x}):(bf(a.b.i,m),a.b.da.na());a.b.i.filename=c.data.name||
null;Rd(a.b.da);break;case "about":Lb(a.b,m);break;case "help":Nb(a.b,m);break;case "suspend":var n=a.b,r=n.qc;r&&n.Rd&&n.Rd.zc();n.Rd=m?new Mb(m,!0):null;m&&r&&n.Rd.show()}}}catch(v){console.info(v)}});this.o||(Zb(this.b,function(b){a.log(b)}),this.o=!0)};
Cf.prototype.log=function(a){try{if("cmd"===a.type&&a.data&&0<=["vpl:run"].indexOf(a.data.cmd)){var b=cb(this.b.i,{Yc:!1,ad:!0});this.g.send(JSON.stringify({sender:{type:"vpl",sessionid:this.l},type:"file",data:{name:this.b.i.filename,content:b}}))}this.g.send(JSON.stringify({sender:{type:"vpl",sessionid:this.l},type:"log",data:a||null}))}catch(c){}};var Id=null;document.addEventListener("mousemove",function(a){null!==Id&&(Id(a,!1,!1),a.preventDefault())},!1);document.addEventListener("mouseup",function(a){null!==Id&&(Id(a,!0,!1),Id=null,a.preventDefault())},!1);var Od=null;document.addEventListener("touchmove",function(a){a.preventDefault();null!==Id&&(Od=a.targetTouches[0],Id(Od,!1,!0));return!1},{capture:!1,passive:!1});document.addEventListener("touchend",function(a){null!==Id&&(Id(Od,!0,!0),Id=null,a.preventDefault());return!1},!1);
function Df(a,b,c,d,e){var f=0<=a.indexOf("/")?a.replace(/\/[^/]*$/,"/"):"",g={},h=new XMLHttpRequest;h.addEventListener("load",function(){if(200===h.status){g[a]=h.responseText;var k=JSON.parse(h.responseText),l=c(k),z=l.length,m=!1;l.forEach(function(x){var n=new XMLHttpRequest;n.addEventListener("load",function(){200===n.status?(g[x]=n.responseText,z--,m||0!==z||d(k,g)):m||(m=!0,e("HTTP error "+n.status))});n.addEventListener("error",function(){m||(m=!0,e("XMLHttpRequest error for "+a))});n.open("GET",
f+x);n.send()})}else e("HTTP error "+h.status)});h.addEventListener("error",e);h.open("GET",a);h.send()}
function Ef(a,b,c,d,e){try{var f=document.getElementById(a).textContent,g=JSON.parse(f),h={};g.svgFilenames&&g.svgFilenames.forEach(function(k){f=document.getElementById(k).textContent;h[k]=f});g.overlays&&g.overlays.forEach(function(k){f=document.getElementById(k).textContent;h[k]=f});g.css&&g.css.forEach(function(k){f=document.getElementById(k).textContent.trim();h[k]=f});d(g,h)}catch(k){e(k)}}
function bb(a){var b=/^[^?]*\?([^#]*)/.exec(document.location.href);if(b=b&&b[1]){b=b.split("&").map(function(d){return d.split("=").map(function(e){return decodeURIComponent(e)})});for(var c=0;c<b.length;c++)if(b[c][0]===a)return b[c][1]}return""}function Ff(a){return(document.location.hash||"#").slice(1).split("&").map(function(b){return b.split("=").map(decodeURIComponent)}).reduce(function(b,c){b[c[0]]=c[1];return b},{})[a]||null}
function Gf(a,b){a&&a.overlays&&a.overlays.forEach(function(G){G=JSON.parse(a.Fe[G]);for(var D in G)if(G.hasOwnProperty(D))switch(D){case "blocks":case "buttons":case "widgets":a[D]=a[D]?a[D].concat(G[D]):G[D];break;case "toolbars":for(var O in G[D])G[D].hasOwnProperty(O)&&(a[D]=a[D]||{},a[D][O]=G[D][O]);break;case "i18n":for(O in G[D])if(G[D].hasOwnProperty(O)){a[D]=a[D]||{};a[D][O]=a[D][O]||{};for(var Q in G[D][O])G[D][O].hasOwnProperty(Q)&&(a[D][O][Q]=G[D][O][Q])}}});var c=new Fb;c.Pc=void 0==
window.vplSimMaps?"ground,height,obstacles":"merged"===window.vplSimMaps?null:window.vplSimMaps.split(",");window.vplApp=c;c.username=bb("user")||window.vplUsername||c.username;a&&ac&&(c.i.message=ac(a),c.i.message&&window.console.info(c.i.message));a&&a.css&&(a.css.forEach(function(G){gd(c.ba,G,a.Fe[G])}),c.ba.defineProperties());if(a&&a.i18n)for(var d in a.i18n)a.i18n.hasOwnProperty(d)&&La(c.g,d,a.i18n[d]);d=bb("uilanguage")||"en";c.g.language=d;c.Be=new Bf(c);var e=void 0==a||a["hardcoded-gui"]||
"classic"===bb("appearance");c.Sf="local"===bb("storage");c.Ld="false"!==bb("multiview");var f=bb("language");Fd="true"===bb("cssdebug");var g=rc,h=xc,k=Ec;if(a){if(e)null!==a.blocks&&0<a.blocks.length&&(a.blocks||[]).forEach(function(G){var D=ya(G.name);te(G,D.Jb);G.typicalParamSet&&(D.pe=G.typicalParamSet)});else if(null!==a.buttons&&0<a.buttons.length&&(g=sf(a),h=tf(a)),null!==a.widgets&&0<a.widgets.length&&(k=uf(a)),null!==a.blocks&&0<a.blocks.length)try{Te(a)}catch(G){window.console&&window.console.error(G)}a.miscSettings&&
void 0!=a.miscSettings.basicMultiEvent&&(Pa=1==a.miscSettings.basicMultiEvent);a.miscSettings&&void 0!=a.miscSettings.advancedMultiEvent&&(Ra=1==a.miscSettings.advancedMultiEvent);a.miscSettings&&a.miscSettings.viewRelativeSizes&&(d=a.miscSettings.viewRelativeSizes,c.Xb={vpl:d.vpl||1,src:d.src||1,sim:d.sim||1})}d=bb("server");var l=bb("session"),z="true"===bb("adv"),m="true"===bb("exp"),x=0,n=0,r="",v=bb("blur").trim()||"";/^\d+$/.test(v)&&(x=parseInt(v,10)/10);v=bb("grayscale")||"";/^\d+$/.test(v)&&
(n=parseInt(v,10)/100);if(0<x||0<n)r="blur("+x.toFixed(1)+"px) grayscale("+n.toFixed(2)+")";x=1;n=0;v=!1;var p=null;v=bb("scale").trim()||"";/^\d+(\.\d*)?$/.test(v)&&(x=parseFloat(v));v=bb("rotation").trim()||"";/^-?\d+(\.\d*)?$/.test(v)&&(n=parseFloat(v)*Math.PI/180);v=bb("mirror").trim()||"";v="true"===v;if(1!==x||0!==n||v)p=[x*Math.cos(n)*(v?-1:1),x*Math.sin(n)*(v?-1:1),-x*Math.sin(n),x*Math.cos(n),0,0];f||(f=0<=c.xa?c.La[c.xa].eb.wd:"aseba");Sa();Wa(c.i,!0);c.i.je();x=bb("view");v=0===x.length?
["vpl"]:x.split("+");n=bb("robot");if(0<=v.indexOf("sim")||"sim"===n)n="sim";n.replace(/[+;]/g,",").split(",").forEach(function(G){var D=null;switch(G){case "thymio":D=Hf(c);D.Ic(f);break;case "thymio-tdm":D=If(c);D.Ic(f);break;case "thymio-jws":D=Jf(c);D.Ic(f);break;case "sim":D=Kf(c,{bg:r,cg:p}),D.Ic(f)}D&&c.La.push({name:G,eb:D})});c.xa=0<c.La.length?0:-1;if(!ua[f])throw"Unsupported language "+f;Ja(c.ya,z?[]:["src:language"]);c.i.Db=f;c.da.ha=k;c.i.i.push(new za);null!=c.b&&(c.b.ha=k);cc(c);!e&&
a&&a.toolbars&&(a.toolbars.vpl&&(c.P=a.toolbars.vpl),a.toolbars.vpl2&&(c.w=a.toolbars.vpl2));c.i.fc=g;c.i.Ie=h;mf&&document.getElementById("editor")&&(c.I=new mf(c,c.i.fa,f),Pd(c.I.Ga,r),c.i.o=function(){return nf(c.I)?null:c.I.$b()},c.i.w=function(G){Rb(c.I,G)},c.I.Ga.ha=k,rf(c),!e&&a&&a.toolbars&&a.toolbars.editor&&(c.I.Nf=a.toolbars.editor),c.I.fc=g,c.I.Ie=h,pf(c.I));null!=c.F&&(Lf(c),!e&&a&&a.toolbars&&a.toolbars.simulator&&(c.F.Nf=a.toolbars.simulator),c.F.fc=g,c.F.Ie=h);r&&Pd(c.da,r);Qd(c.da,
p);document.getElementsByTagName("body")[0].addEventListener("dragover",function(G){G.stopPropagation();G.preventDefault();G.dataTransfer.dropEffect="copy"},!1);document.getElementsByTagName("body")[0].addEventListener("drop",function(G){G.stopPropagation();G.preventDefault();G=G.dataTransfer.files;1===G.length&&(G=G[0],gc(c,G)||xf(c,G)||Af(c,G))},!1);if(c.F){c.F.ya=c.ya;var w=new Image;w.addEventListener("load",function(){c.F.Ue=w});w.src="data:image/svg+xml;base64,"+btoa('<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="297mm" height="210mm" viewBox="0 0 1052 744" version="1.1"><defs><linearGradient id="gradient" x1="-1000" y1="0" x2="-800" y2="0" gradientUnits="userSpaceOnUse"><stop style="stop-color:#000;stop-opacity:1;" offset="0" /><stop style="stop-color:#000;stop-opacity:0;" offset="1" /></linearGradient></defs><g transform="translate(0,-308)"><rect style="fill:url(#gradient);stroke:none" width="319" height="687" x="-1027" y="336" transform="scale(-1,1)" /><path style="fill:none;stroke:#000;stroke-width:30;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none" d="M 114,592 C 102,417 750,306 778,532 806,757 674,675 559,622 444,568 259,567 278,664 296,762 726,730 778,808 829,887 725,955 616,936 507,917 144,1083 129,837 Z" /></g></svg>');
var q=new Image;q.addEventListener("load",function(){c.F.Ve=q});q.src="data:image/svg+xml;base64,"+btoa('<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" width="297mm" height="210mm" viewBox="0 0 1052 744" version="1.1"><defs><radialGradient id="gradient" cx="400" cy="650" fx="400" fy="650" r="230" gradientTransform="matrix(1.6,0,0,1.16,-113,-75)" gradientUnits="userSpaceOnUse"><stop style="stop-color:#000;stop-opacity:1;" offset="0" /><stop style="stop-color:#000;stop-opacity:0;" offset="1" /></radialGradient></defs><g transform="translate(0,-308)"><rect style="fill:url(#gradient);fill-opacity:1;stroke:none" width="939" height="650" x="54" y="357" /></g></svg>');
c.F.We='<?xml version="1.0" encoding="UTF-8"?><svg xmlns="http://www.w3.org/2000/svg" width="297mm" height="210mm" viewBox="0 0 1052 744" version="1.1"><g transform="translate(0,-308)"><path style="fill:none;stroke:#000;stroke-width:6;stroke-linecap:butt;stroke-linejoin:miter" d="M 172,928 137,420 763,371 905,688 708,981 Z" /><path style="fill:none;stroke:#949494;stroke-width:6;stroke-linecap:butt;stroke-linejoin:miter" d="m 402,754 168,91 101,-142" /><circle style="fill:none;stroke:#000;stroke-width:6" cx="531" cy="550" r="59" /></g></svg>'}if(window.vplStorageGetFunction)window.vplStorageGetFunction("program.vpl3",
function(G,D){try{G&&(db(c.i,G,function(){Kb(c)}),c.i.filename=D&&D.filename||"program.vpl3",c.i.readOnly=void 0!=D&&1==D.readOnly,void 0!=D&&1==D.customizationMode&&(c.ya.Xa=!0))}catch(O){}});else if(c.Sf)try{var t=window.localStorage.getItem("program.vpl3");t&&db(c.i,t,function(){Kb(c)})}catch(G){}"text"===bb("view")?c.fb(["src"],{fa:!0}):(c.fb(["vpl"]),c.i.hg=m,ab(c.i),Kb(c),c.I&&(document.getElementById("editor").textContent=c.i.$b(c.i.Db)));var u=["aseba","l2","asm","js","python"];c.I&&0<=u.indexOf(f)&&
of(c.I,function(){f=u[(u.indexOf(f)+1)%u.length];c.i.Db=f;var G=c.i.$b(f);return{language:f,code:G}});if(z&&c.I){var F=new tb(ub);c.I.be=function(G,D){try{switch(G){case "aseba":var O=new vb(F,D);O.ha=wb;var Q=xb(O);return Mf(D,Q,O.Wb);case "l2":return O=new Nf(F,D),O.ha=Of,Q=xb(O),Mf(D,Q,O.Wb);case "asm":return Q=Pf(new Qf(F,D)),yb(Q);default:return null}}catch(R){return"; "+R}}}a&&a.fragments&&a.fragments["about.html"]&&Lb(c,a.fragments["about.html"].replace(/UIROOT/g,b));a&&a.fragments&&a.fragments["help.html"]&&
Nb(c,a.fragments["help.html"].replace(/UIROOT/g,b));a&&a.fragments&&a.fragments["vpl-export-html.css"]&&(c.M=a.fragments["vpl-export-html.css"]);Tb(c);Rd(c.da);window.addEventListener("resize",function(){Tb(c)},!1);c.F&&Rf(c.F);if("text"===x)c.fb(["src"],{fa:!0});else{b=["vpl","src","sim"];if(1>v.length||3<v.length||""===x)x="vpl";else for(t=0;t<v.length;t++){if(0>!b.indexOf(v[t])){x="vpl";break}for(e=0;e<t;e++)if(v[t]===v[e]){x="vpl";break}}c.fb(v)}Tb(c);d&&(window.vplCommandServer=new Cf(c,d,l),
window.vplCommandServer.connect())}
window.addEventListener("load",function(){var a=bb("ui")||"ui.json",b=null!=document.getElementById(a),c=window.vplUIRoot?window.vplUIRoot:b?".":0<=a.indexOf("/")?a.replace(/\/[^/]*$/,""):".";(b?Ef:Df)(a,c,function(d){return(d.svgFilenames||[]).concat(d.overlays||[]).concat(d.css||[])},function(d,e){d.Fe={};d.vb={};d.svgFilenames&&d.svgFilenames.forEach(function(f){d.Fe[f]=e[f];d.vb[f]=new He(e[f])});d.overlays&&d.overlays.forEach(function(f){d.Fe[f]=e[f]});d.css&&d.css.forEach(function(f){d.Fe[f]=
e[f]});Gf(d,c)},function(d){window.console&&window.console.error(d);Gf()})},!1);window.vplIsProgramChanged=function(){return 0<window.vplApp.i.Qc.gc.length};window.vplGetProgramAsJSON=function(a){return cb(window.vplApp.i,a?{Yc:!0,ad:!1}:void 0)};window.vplGetUIAsJSON=function(){return cb(window.vplApp.i,{Yc:!0,ad:!1})};
window.addEventListener("unload",function(){var a=cb(window.vplApp.i);try{window.vplStorageSetFunction?window.vplStorageSetFunction("program.vpl3",a):window.vplApp.Sf&&window.localStorage.setItem("program.vpl3",a)}catch(b){}},!1);function Sf(){this.yd=1}Sf.prototype.reset=function(){};Sf.prototype.resetEventListeners=function(){};Sf.prototype.set=function(){};Sf.prototype.get=function(){return null};Sf.prototype.setClientState=function(){};Sf.prototype.getClientState=function(){return null};Sf.prototype.addEventListener=function(){};Sf.prototype.sendEvent=function(){};Sf.prototype.start=function(){this.sendEvent("init",null)};Sf.prototype.setTimer=function(){};Sf.prototype.getTimer=function(){return-1};
Sf.prototype.loadCode=function(){};Sf.prototype.shouldRunContinuously=function(){return!1};Sf.prototype.run=function(){};Sf.prototype.suspend=function(){};Sf.prototype.resume=function(){};function Tf(){this.yd=1;this.Ra={Y:-Infinity,pa:Infinity,Z:-Infinity,la:Infinity};this.w=this.P=0;this.r=70;this.b=[0,0];this.g=0;this.cf=!1;this.files={};this.yb=120;this.Sc=80;this.Vd=20;this.state={};this.ha={};this.gb=null;this.Cd={};this.o=[];this.za={};this.Tc=!1;this.M=null;Tf.prototype.reset.call(this,0);Tf.prototype.resetEventListeners.call(this)}Tf.prototype=Object.create(Sf.prototype);Tf.prototype.constructor=Tf;Tf.prototype.setPositionLimits=function(a,b,c,d){this.Ra={Y:a,pa:b,Z:c,la:d}};
Tf.prototype.setFile=function(a,b){this.files[a]=b};
Tf.prototype.reset=function(a){this.w=this.P=a;this.b=[0,0];this.g=0;this.state={"button.center":!1,"button.left":!1,"button.right":!1,"button.forward":!1,"button.backward":!1,"prox.ground.delta":[1,1],"prox.horizontal":[0,0,0,0,0,0,0],acc:[0,0,1],"motor.left":0,"motor.right":0,"leds.top":[0,0,0],"leds.bottom.left":[0,0,0],"leds.bottom.right":[0,0,0],"leds.circle":[0,0,0,0,0,0,0,0],sound:{}};this.Tc=!1;var b=this;this.ha={"leds.circle":function(){b.Tc=!0},sound:function(c,d){function e(){if(!(g>=
d.f.length)){b.M||(b.M=new (window.AudioContext||window.webkitAudioContext));var h=b.M.createOscillator();h.type="sawtooth";h.frequency.value=d.f[g];var k=b.M.createGain();k.connect(b.M.destination);h.connect(k);h.start(0);var l=d.d[g]/50;k.gain.exponentialRampToValueAtTime(.01,b.M.currentTime+l);h.stop(b.M.currentTime+l);h.addEventListener("ended",e);g++}}if(d.hasOwnProperty("pcm")){if(c=b.files["P"+d.pcm+".wav"]){b.M||(b.M=new (window.AudioContext||window.webkitAudioContext));var f=b.M;f.decodeAudioData(c.slice(),
function(h){var k=f.createBufferSource();k.buffer=h;k.connect(f.destination);k.start(0)})}}else if(d.f){var g=0;e()}}};this.o=[];this.qc=!1};Tf.prototype.resetEventListeners=function(){this.za={}};Tf.prototype.enforcePositionLimits=function(){this.b=[Math.max(this.Ra.Y,Math.min(this.Ra.pa,this.b[0])),Math.max(this.Ra.Z,Math.min(this.Ra.la,this.b[1]))]};Tf.prototype.setPosition=function(a,b){this.b=a;this.g=b;this.enforcePositionLimits();this.gb&&this.gb.call(this)};
Tf.prototype.set=function(a,b){this.state[a]=b;this.ha[a]&&this.ha[a](a,b)};Tf.prototype.get=function(a){return this.state[a]};Tf.prototype.setClientState=function(a,b){this.Cd[a]=b};Tf.prototype.getClientState=function(a){a=this.Cd[a];a instanceof Array&&(a=a.slice());return a};Tf.prototype.addEventListener=function(a,b){this.za[a]=b};Tf.prototype.sendEvent=function(a,b){this.za[a]&&this.za[a].call(this,a,b);for(var c in this.za)if(0===c.indexOf(a+"."))this.za[c](a,b)};
Tf.prototype.setTimer=function(a,b,c){this.o[a]={next:this.w-this.P+b,pg:c?b:-1}};Tf.prototype.getTimer=function(a){return void 0===this.o[a]||0>this.o[a].next?-1:this.P+this.o[a]-this.w};Tf.prototype.loadCode=function(a,b){if("js"!==a)throw"unsupported language "+a;(new Function(b)).call(this)};
Tf.prototype.shouldRunContinuously=function(){if(this.qc)return!1;if(0!==this.get("motor.left")||0!==this.get("motor.right"))return!0;for(var a=0;a<this.o.length;a++)if(this.o[a]&&0<this.o[a].next)return!0;return!1};function Uf(a,b){return a.cf?b*Math.sqrt(-2*Math.log(Math.random()))*Math.sin(2*Math.PI*Math.random()):0}
Tf.prototype.run=function(a,b){0===this.P&&this.reset(a);1!==this.yd&&(this.P-=(this.yd-1)*(a-this.w),this.w=this.yd*(this.w-a)+a);for(var c=Math.max(.01,(a-this.w)/10),d=this.b;!this.qc&&this.w<a;){c=Math.min(c,a-this.w);var e=(100*this.get("motor.left")+Uf(this,1))*c,f=(100*this.get("motor.right")+Uf(this,1))*c;if(0!==e||0!=f){if(1E-6>Math.abs(e-f)||Math.abs(e-f)<1E-4*(Math.abs(e)+Math.abs(f)))this.b=[this.b[0]+.5*(e+f)*Math.cos(this.g),this.b[1]+.5*(e+f)*Math.sin(this.g)];else{var g=(e+f)*this.r/
(e-f);e=(f-e)/(2*this.r);this.b=[this.b[0]+g*(Math.sin(this.g)-Math.sin(this.g+e)),this.b[1]-g*(Math.cos(this.g)-Math.cos(this.g+e))];this.g+=e}this.enforcePositionLimits();this.gb&&this.gb.call(this)}this.w+=c;this.sendEvent("prox",null);for(g=0;g<this.o.length;g++)this.o[g]&&0<this.o[g].next&&this.w>=this.P+this.o[g].next+Uf(this,.01)&&(this.o[g].next=0<=this.o[g].pg?this.o[g].next+this.o[g].pg:-1,this.sendEvent("timer"+g.toString(10),null))}b&&b("l",d.concat(this.b))};
Tf.prototype.suspend=function(){this.qc=!0};Tf.prototype.resume=function(a){this.qc&&(this.P+=a-this.w,this.w=a,this.qc=!1)};var Vf="shift left;shift right;add;sub;mult;div;mod;bitor;bitxor;bitand;eq;ne;gt;ge;lt;le;or;and".split(";");function Wf(a,b){function c(l){return 32784<=l?l-65536:l}function d(l){return 2048<=l?l-4096:l}var e=[],f=a[0];0<a.length&&e.push({Pb:0,vd:a.slice(0,1),df:-1,A:"dc "+a[0]});for(var g=[],h=1;h<f;h+=2)g.push({id:a[h],Pb:a[h+1]}),e.push({Pb:h,vd:a.slice(h,h+2),df:-1,A:"dc 0x"+a[h].toString(16)+", "+a[h+1]});for(h=f;h<a.length;h++){f={Pb:h,vd:a.slice(h,h+1),df:a[h]>>>12};if(!b)for(var k=0;k<g.length;k++)if(g[k].Pb===h){f.id="onevent_"+g[k].id.toString(16);break}k=a[h];switch(k>>>12){case 0:f.A="stop";
break;case 1:f.A="push.s "+((k&4095)-(k&2048?4096:0));break;case 2:f.vd=a.slice(h,h+2);f.A="push "+c(a[++h]);break;case 3:f.A="load "+(k&4095);break;case 4:f.A="store "+(k&4095);break;case 5:f.vd=a.slice(h,h+2);f.A="load.ind "+(k&4095)+" size="+a[++h];break;case 6:f.vd=a.slice(h,h+2);f.A="store.ind "+(k&4095)+" size="+a[++h];break;case 7:case 8:switch(k){case 28672:f.A="neg";break;case 28673:f.A="abs";break;case 28674:f.A="bitnot";break;case 28675:f.A="not ; not implemented";break;case 32768:f.A=
"sl";break;case 32769:f.A="asr";break;case 32770:f.A="add";break;case 32771:f.A="sub";break;case 32772:f.A="mult";break;case 32773:f.A="div";break;case 32774:f.A="mod";break;case 32775:f.A="bitor";break;case 32776:f.A="bitxor";break;case 32777:f.A="bitand";break;case 32778:f.A="eq";break;case 32779:f.A="ne";break;case 32780:f.A="gt";break;case 32781:f.A="ge";break;case 32782:f.A="lt";break;case 32783:f.A="le";break;case 32784:f.A="or";break;case 32785:f.A="and";break;default:throw"Unknown instruction "+
k.toString(16);}break;case 9:f.A="jump "+(h+d(k&4095));break;case 10:f.vd=a.slice(h,h+2);f.A=(k&256?k&512?"dont.":"do.":"")+"jump."+(k&256?"when":"if")+".not "+Vf[k&31]+" "+(h+c(a[h+1]));h++;break;case 11:f.A="emit id="+(k&4095)+" data="+c(a[h+1])+" count="+c(a[h+2]);h+=2;break;case 12:f.A="callnat "+(k&4095);break;case 13:f.A="callsub "+(k&4095);break;case 14:f.A="ret";break;default:throw"Unknown instruction "+k.toString(16);}e.push(f)}return e}
function yb(a,b){var c=Wf(a).map(function(d){var e=d.Pb.toString(10);e="    ".slice(e.length-1)+e;var f=d.vd.map(function(g){g=g.toString(16);return"000".slice(g.length-1)+g}).join(" ");f+="     ".slice(f.length-4);return(d.id?d.id+":\n":"")+(b?"    ":e+"  "+f+"  ")+d.A+(d.Pb===a[0]-2||0===d.df||14===d.df?"\n":"")}).join("\n");0===c.length&&(c="; empty");return c};function Mf(a,b,c){function d(z){var m=e[z].Pb.toString(10);m="    ".slice(m.length-1)+m;var x=e[z].vd.map(function(n){n=n.toString(16);return"000".slice(n.length-1)+n}).join(" ");x+="     ".slice(x.length-4);f+=(e[z].id?e[z].id+":\n":"")+m+"  "+x+"  "+e[z].A+"\n";e.splice(z,1)}var e=Wf(b,!0);a=a.split("\n");c=c.slice().sort(function(z,m){return z.Pb-m.Pb});c=[new Xf(-1,-1,-1,0)].concat(c,new Xf(Infinity,Infinity,Infinity,b.length));var f="";for(b=0;b<a.length;b++){for(var g=!1,h=0;h<c.length-1;)if(c[h].line<=
b){for(var k=c[h].Pb;k<c[h+1].Pb;k++)for(var l=0;l<e.length;)e[l].Pb===k?(!g&&0<b&&(f+="\n"),g=!0,d(l)):l++;c.splice(h,1)}else h++;g&&(f+="\n");f+=a[b]+"\n"}for(l=0;l<e.length;)d(l);return f};function tb(a){this.name=a.name;this.b=a.maxVarSize;this.Va=[];for(var b=this.Ma=0;b<a.variables.length;b++)this.Va.push(new Yf(a.variables[b].name,a.variables[b].size,[1],this.Ma,Zf)),this.Ma+=a.variables[b].size;this.Lb=a.nativeFunctions.map(function(c,d){return{id:d,name:c.name,B:c.args}});this.Kd=a.localEvents.map(function(c){return{name:c.name}})}function $f(a,b){for(var c=0;c<a.Lb.length;c++)if(a.Lb[c].name===b)return a.Lb[c];return null}
function ag(a,b){for(var c=0;c<a.Va.length;c++)if(a.Va[c].name===b)return a.Va[c];return null}function bg(a,b){if("init"===b)return 65535;for(var c=0;c<a.Kd.length;c++)if(a.Kd[c].name===b)return 65534-c;throw"unknown local event "+b;}function vb(a,b){this.Xb=cg;this.Wf=!1;this.qa=a;this.l=b;this.M=b.length;this.b=0;this.line=1;this.Fa=0;this.C=[];this.m=0;this.g=[];this.Zf=[];this.ha=[];this.P={};this.Za=[];this.gb=[];this.Sc=this.Tc=this.qa.b;this.Df=!1;this.Ka=0;this.Wb=[]}
function Yf(a,b,c,d,e){this.name=a;this.size=b;this.v=c;this.offset=d;this.resultType=e}Yf.prototype.rd=function(a,b){return[12288|this.offset+(b||0)]};Yf.prototype.af=function(a,b){return[16384|this.offset+(b||0)]};Yf.prototype.xe=function(){return[20480|this.offset,this.size]};Yf.prototype.zf=function(){return[24576|this.offset,this.size]};
vb.prototype.Bg=function(){for(;this.b<this.M;)if(" "===this.l[this.b]||"\t"===this.l[this.b])this.b++,this.Fa++;else if("\n"===this.l[this.b])this.b++,this.Fa=0,this.line++;else if("\r"===this.l[this.b])this.b++;else if("#*"===this.l.slice(this.b,this.b+2))for(this.b+=2,this.Fa+=2;this.b<this.M&&"*#"!==this.l.slice(this.b-2,this.b);)"\n"===this.l[this.b]?(this.Fa=0,this.line++):"\r"!==this.l[this.b]&&this.Fa++,this.b++;else if("#"===this.l[this.b])for(;this.b<this.M&&"\n"!==this.l[this.b];)this.b++,
this.Fa++;else break};function dg(a,b){a.gb.push(b.length-1)}function eg(a,b,c){if(0===a.gb.length)throw"internal";void 0===c&&(c=b.length);a=a.gb.pop();b[a]=36864===b[a]?b[a]+(c-a&4095):c-a+1&65535}vb.prototype.Cd=function(a,b,c,d,e){var f;a:{for(f=0;f<this.Za.length;f++)if(this.Za[f].name===a){f=!0;break a}for(f=0;f<this.qa.Va.length;f++)if(this.qa.Va[f].name===a){f=!0;break a}f=!1}if(f)throw'duplicate variable declaration "'+a+'"';this.Za.push(new Yf(a,b,c,d,e))};
function fg(a,b){for(var c=a.Za.length-1;0<=c;c--)if(a.Za[c].name===b.name)return a.Za[c];for(c=0;c<a.qa.Va.length;c++)if(a.qa.Va[c].name===b.name)return a.qa.Va[c];throw"unknown variable "+b.name+" "+T(b.head);}function gg(a,b){for(var c=0;c<a.ha.length;c++)if(a.ha[c].name===b)return a.ha[c];return null}function hg(a,b){a.Sc-=b;return a.Sc}vb.prototype.yb=function(){return[]};var ig="== != <= >= |= ^= &= *= /= %= += -= <<= >>= ++ -- ( ) [ ] - ~ * / % + << >> & ^ | > < = , : abs and callsub call const do elseif else emit end for if in not onevent or return step sub then var when while".split(" ");
function jg(a,b,c){this.zd=a;this.gd=b;this.ed=c}function T(a){return"line "+a.gd.toString()+" col "+a.ed.toString()}function kg(a,b,c,d){jg.call(this,a,b,c);this.n=d}kg.prototype=Object.create(jg.prototype);kg.prototype.constructor=kg;function lg(a,b,c,d){jg.call(this,a,b,c);this.n=d}lg.prototype=Object.create(kg.prototype);lg.prototype.constructor=lg;function mg(a,b,c,d){jg.call(this,a,b,c);this.name=d}mg.prototype=Object.create(jg.prototype);mg.prototype.constructor=mg;
function ng(a,b,c,d){jg.call(this,a,b,c);this.name=d}ng.prototype=Object.create(jg.prototype);ng.prototype.constructor=ng;
vb.prototype.tf=function(a){for(;;){a:{var b=(b=a)||ig;this.Bg();if(this.b>=this.M)var c=null;else{for(var d=0;d<b.length;d++)if(c=b[d].length,this.l.slice(this.b,this.b+c)===b[d]&&!/[a-zA-Z0-9_.]{2}/.test(this.l.slice(this.b+c-1,this.b+c+1))){b=new ng(this.b,this.line,this.Fa,b[d]);this.b+=c;this.Fa+=c;c=b;break a}c=0;if("0x"===this.l.slice(this.b,this.b+2)){for(this.b+=2;this.b+c<this.M&&/[0-9a-fA-F]/.test(this.l[this.b+c]);)c++;if(0===c)throw"hexadecimal number syntax error";b=parseInt(this.l.slice(this.b,
this.b+c),16);b=new kg(this.b,this.line,this.Fa,b);this.b+=c;this.Fa+=2+c}else if("0b"===this.l.slice(this.b,this.b+2)){for(this.b+=2;this.b+c<this.M&&/[01]/.test(this.l[this.b+c]);)c++;if(0===c)throw"binary number syntax error";b=parseInt(this.l.slice(this.b,this.b+c),2);b=new kg(this.b,this.line,this.Fa,b);this.b+=c;this.Fa+=2+c}else if(/[0-9]/.test(this.l[this.b])){for(;this.b+c<this.M&&/[0-9]/.test(this.l[this.b+c]);)c++;if(this.Wf&&this.b+c<this.M&&"."===this.l[this.b+c]){for(c++;this.b+c<this.M&&
/[0-9]/.test(this.l[this.b+c]);c++);b=parseFloat(this.l.slice(this.b,this.b+c));b=new lg(this.b,this.line,this.Fa,b)}else b=parseInt(this.l.slice(this.b,this.b+c),10),b=new kg(this.b,this.line,this.Fa,b);this.b+=c;this.Fa+=c}else if(/[a-zA-Z_]/.test(this.l[this.b])){for(;this.b+c<this.M&&/[a-zA-Z0-9_.]/.test(this.l[this.b+c]);)c++;if(0===c)throw"name syntax error";b=new mg(this.b,this.line,this.Fa,this.l.slice(this.b,this.b+c));this.b+=c;this.Fa+=c}else throw"syntax error line "+this.line.toString()+
" col "+this.Fa.toString();c=b}}if(null===c)break;this.C.push(c)}};function Xf(a,b,c,d){this.Cg=a;this.line=b;this.Fa=c;this.Pb=d}function og(a,b,c){(b=b.head||b.children[0]&&b.children[0].head)&&a.Wb.push(new Xf(b.zd,b.gd,b.ed,void 0===c?a.Ka:c))}function pg(a){this.head=a;this.children=[];this.ob=0;this.resultType=qg;this.ub=!0}function rg(a,b){for(var c=0;c<a.length;c++)a[c]=a[c].D(b)}pg.prototype.D=function(){return this};pg.prototype.Qa=function(a){this.children.forEach(function(b){b.Qa(a)})};
pg.prototype.w=function(a){this.Qa(a);for(var b=0;b<this.children.length;b++)this.children[b]=this.children[b].w(a);return this};function sg(a,b){pg.call(this,a);this.n=void 0===b?this.head.n:b;this.resultType=Zf}sg.prototype=Object.create(pg.prototype);sg.prototype.constructor=sg;sg.prototype.Qa=function(){this.ob=1};function tg(a){a&=65535;return 32768<=a?a-65536:a}function ug(a,b){sg.call(this,a,b);this.resultType=vg}ug.prototype=Object.create(sg.prototype);ug.prototype.constructor=ug;
function wg(a){pg.call(this,a);this.name=a.name;this.b=!1}wg.prototype=Object.create(pg.prototype);wg.prototype.constructor=wg;wg.prototype.Qa=function(a){a.P.hasOwnProperty(this.name)?(this.ob=1,this.resultType=a.P[this.name].resultType):(a=fg(a,this),this.ob=a.size,this.resultType=a.resultType)};wg.prototype.D=function(a){return a.P.hasOwnProperty(this.name)?a.P[this.name].resultType===vg?new ug(this.head,a.P[this.name].S):new sg(this.head,a.P[this.name].S):this};
function xg(a){var b=new wg(a.head);b.resultType=a.resultType;b.b=!0;return b}var qg="?",Zf="n",vg="fx";function yg(a,b,c,d){pg.call(this,a);this.type=b;this.resultType=c?c.resultType:qg;this.Da=c;this.children=d||[]}yg.prototype=Object.create(pg.prototype);yg.prototype.constructor=yg;
yg.prototype.Qa=function(a){pg.prototype.Qa.call(this,a);for(var b=1,c=0;c<this.children.length;c++)if(1===b)b=this.children[c].ob;else if(1!==this.children[c].ob&&this.children[c].ob!==b)throw"incompatible sizes "+T(this.head);this.ob=b;this.Da&&this.Da.ka&&(this.resultType=this.Da.ka(a,this,this.children.map(function(d){return d.resultType})))};yg.prototype.D=function(a){this.children=this.children.map(function(b){return b.D(a)});return this.Da&&this.Da.D?this.Da.D(this,a):this};
yg.prototype.w=function(a){var b=pg.prototype.w.call(this,a);if(b.type===U&&b.Da.priority===zg&&(b.children[1]instanceof Ag||b.children[1]instanceof wg&&1!==b.children[1].ob)){var c=b.children[0];if(!(c instanceof wg)||b.ub)throw"bad array assignment "+T(b.head);for(var d=b.children[1],e=new Bg(b.head),f=0;f<d.ob;f++){var g=c;1<d.ob&&(g=new Cg(c.head,[new sg(c.head,f)]),g.resultType=c.resultType);if(d instanceof Ag)var h=d.children[f];else h=new Cg(d.head,[new sg(c.head,f)]),h.resultType=d.resultType;
g=new yg(b.head,b.type,b.Da,[g,h]);g.resultType=c.resultType;g.ub=!1;g=g.D(a);e.children.push(g)}return e}return b};function Cg(a,b){wg.call(this,a);this.children=b}Cg.prototype=Object.create(wg.prototype);Cg.prototype.constructor=Cg;Cg.prototype.Qa=function(a){pg.prototype.Qa.call(this,a);a=fg(a,this);this.ob=1;this.resultType=a.resultType};function Dg(a){for(var b=0;b<a.children.length;b++)if(!(a.children[b]instanceof sg))return!1;return!0}
function Eg(a,b){for(var c=0,d=1,e=0;e<a.children.length;e++){if(!(a.children[e]instanceof sg))throw"internal";c+=d*a.children[e].n;d*=b.v[e]}return c}function Ag(a){pg.call(this,a);this.v=[]}Ag.prototype=Object.create(pg.prototype);Ag.prototype.constructor=Ag;Ag.prototype.Qa=function(a){this.ob=this.children.length;this.children[0]&&(this.children.forEach(function(b){b.Qa(a)}),this.resultType=this.children[0].resultType)};
function Fg(a,b){pg.call(this,a);this.type=b||Gg;this.za=!1;this.Oa=[null]}Fg.prototype=Object.create(pg.prototype);M=Fg.prototype;M.constructor=Fg;M.Ef=function(){throw"internal";};M.rg=function(){};M.tg=function(){throw"internal";};M.sg=function(){};M.Od=function(){};function Hg(a,b){b.Sc=b.Tc;og(b,a)}var Gg=1;function Ig(a,b){this.b=a;this.ia=b}Ig.prototype.u=function(){return"internal"};function Jg(a,b){Fg.call(this,a,2);this.Ye=b}Jg.prototype=Object.create(Fg.prototype);
Jg.prototype.constructor=Jg;Jg.prototype.D=function(a){rg(this.children,a);return this};Jg.prototype.Ef=function(){return this};function Kg(a,b){Fg.call(this,a,2);this.Dg=b}Kg.prototype=Object.create(Fg.prototype);Kg.prototype.constructor=Kg;Kg.prototype.D=function(a){rg(this.children,a);return this};Kg.prototype.Ef=function(){return this};function Lg(a){Fg.call(this,a)}Lg.prototype=Object.create(Fg.prototype);Lg.prototype.constructor=Lg;
function Mg(a,b,c){Fg.call(this,a);this.b=b;this.S=c;this.resultType=c.resultType}Mg.prototype=Object.create(Fg.prototype);Mg.prototype.constructor=Mg;function Ng(a,b,c,d,e){Fg.call(this,a);this.P=b.name;this.resultType=c;this.b=d||null;this.size=-1;this.v=[];this.offset=-1;e&&this.children.push(e)}Ng.prototype=Object.create(Fg.prototype);Ng.prototype.constructor=Ng;Ng.prototype.Qa=function(a){this.children[0]&&(pg.prototype.Qa.call(this,a),this.resultType=this.children[0].children[1].resultType)};
Ng.prototype.D=function(a){rg(this.children,a);return this};function Og(a){Fg.call(this,a.head);this.children.push(a)}Og.prototype=Object.create(Fg.prototype);Og.prototype.constructor=Og;Og.prototype.D=function(a){rg(this.children,a);return this};function Bg(a){Fg.call(this,a)}Bg.prototype=Object.create(Fg.prototype);Bg.prototype.constructor=Bg;Bg.prototype.D=function(a){rg(this.children,a);return this};function Pg(a,b){Fg.call(this,a,3);this.b=[b];this.g=[];this.l=[]}Pg.prototype=Object.create(Fg.prototype);
M=Pg.prototype;M.constructor=Pg;M.Qa=function(a){this.b.forEach(function(b){b.Qa(a)});this.g.forEach(function(b){b.forEach(function(c){c.Qa(a)})})};M.D=function(a){rg(this.b,a);this.g.forEach(function(b){rg(b,a)});return this};M.tg=function(a){if(this.g.length>=this.b.length)throw"multiple else "+T(a.head);a instanceof Qg&&this.b.push(a.b);this.g.push(this.children);this.l.push(a);this.children=[];this.Oa.push(a.Oa[0])};
M.Od=function(a,b){this.g.push(this.children);this.children=[];this.l.push(b);for(a=0;a<this.b.length;)if(this.b[a]instanceof sg)if(0===this.b[a].n)this.b.splice(a,1),this.g.splice(a,1);else{this.b.splice(a);this.g.splice(a+1);break}else a++};function Qg(a,b){Fg.call(this,a,4);this.b=b}Qg.prototype=Object.create(Fg.prototype);Qg.prototype.constructor=Qg;Qg.prototype.D=function(a){this.b=this.b.D(a);rg(this.children,a);return this};function Rg(a){Fg.call(this,a,4)}Rg.prototype=Object.create(Fg.prototype);
Rg.prototype.constructor=Rg;function Sg(a,b){Fg.call(this,a,3);this.b=b}Sg.prototype=Object.create(Fg.prototype);Sg.prototype.constructor=Sg;Sg.prototype.Qa=function(a){pg.prototype.Qa.call(this,a);this.b.Qa(a)};Sg.prototype.D=function(a){this.b=this.b.D(a);rg(this.children,a);return this};function Tg(a,b){Fg.call(this,a,3);this.b=b;this.g=[]}Tg.prototype=Object.create(Fg.prototype);Tg.prototype.constructor=Tg;Tg.prototype.Qa=function(a){pg.prototype.Qa.call(this,a);this.b.Qa(a)};
Tg.prototype.D=function(a){this.b=this.b.D(a);rg(this.children,a);return this};Tg.prototype.Od=function(a,b){this.b instanceof sg&&(0===this.b.n&&(this.children=[]),this.b=null);this.g.push(b)};function Ug(a,b,c,d,e){Fg.call(this,a,3);this.l=new wg(b);this.children.push(c);this.children.push(d);this.b=e||null;this.g=[]}Ug.prototype=Object.create(Fg.prototype);Ug.prototype.constructor=Ug;Ug.prototype.Qa=function(a){pg.prototype.Qa.call(this,a);this.b&&this.b.Qa(a)};
Ug.prototype.D=function(a){this.b&&(this.b=this.b.D(a));rg(this.children,a);return this};Ug.prototype.Od=function(a,b){this.g.push(b)};function Vg(a,b,c){Fg.call(this,a);this.name=b;this.children=c}Vg.prototype=Object.create(Fg.prototype);Vg.prototype.constructor=Vg;Vg.prototype.D=function(a){rg(this.children,a);return this};function Wg(a,b){Fg.call(this,a);this.name=b}Wg.prototype=Object.create(Fg.prototype);Wg.prototype.constructor=Wg;function Xg(a){Fg.call(this,a,5)}Xg.prototype=Object.create(Fg.prototype);
Xg.prototype.constructor=Xg;var zg=30,U=1;function W(a,b,c){this.name=a;this.type=b;this.priority=c&&c.priority||0;this.resultType=c&&c.resultType||(c&&c.ka?qg:Zf);this.ka=c&&c.ka||null;this.D=c&&c.D||null;this.K=c&&c.K||[];this.u=c&&c.u||null}function Yg(a,b){for(var c=[],d=0;d<a.children.length;d++){if(!(a.children[d]instanceof sg))return a;c.push(a.children[d].n)}return new sg(a.head,tg(b(c)))}
var cg=[new W("--",0,{priority:150}),new W("++",0,{priority:150}),new W("-",0,{priority:150,D:function(a){return Yg(a,function(b){return-b[0]})},K:[28672]}),new W("~",0,{priority:150,D:function(a){return Yg(a,function(b){return~b[0]})},K:[28674]}),new W("abs",0,{priority:150,D:function(a){return Yg(a,function(b){return Math.abs(b[0])})},K:[28673]}),new W("not",0,{priority:150,resultType:"b",D:function(a){return Yg(a,function(b){return 0==b[0]?1:0})},K:[4096,32778]}),new W("size",0,{priority:150,D:function(a,
b){var c=0<a.children[0].ob?a.children[0].ob:a.children[0]instanceof Ag?a.children[0].children.length:-1;if(0>c&&a.children[0]instanceof wg)for(var d=b.Za.length-1;0<=d;d--)if(b.Za[d].name===a.children[0].name){c=b.Za[d].size;break}return 0<c?new sg(a.head,c):a}}),new W("--",2,{priority:150}),new W("++",2,{priority:150}),new W("+=",U,{priority:zg}),new W("-=",U,{priority:zg}),new W("*=",U,{priority:zg}),new W("/=",U,{priority:zg}),new W("%=",U,{priority:zg}),new W("<<=",U,{priority:zg}),new W(">>=",
U,{priority:zg}),new W("&=",U,{priority:zg}),new W("|=",U,{priority:zg}),new W("^=",U,{priority:zg}),new W("*",U,{priority:140,D:function(a){return Yg(a,function(b){return b[0]*b[1]})},K:[32772]}),new W("/",U,{priority:140,D:function(a){return Yg(a,function(b){return Math.trunc(b[0]/b[1])})},K:[32773]}),new W("%",U,{priority:140,D:function(a){return Yg(a,function(b){return b[0]%b[1]})},K:[32774]}),new W("+",U,{priority:130,D:function(a){return Yg(a,function(b){return b[0]+b[1]})},K:[32770]}),new W("-",
U,{priority:130,D:function(a){return Yg(a,function(b){return b[0]-b[1]})},K:[32771]}),new W("<<",U,{priority:120,D:function(a){return Yg(a,function(b){return b[0]<<b[1]})},K:[32768]}),new W(">>",U,{priority:120,D:function(a){return Yg(a,function(b){return b[0]>>b[1]})},K:[32769]}),new W("==",U,{priority:80,resultType:"b",D:function(a){return Yg(a,function(b){return b[0]===b[1]?1:0})},K:[32778]}),new W("!=",U,{priority:80,resultType:"b",D:function(a){return Yg(a,function(b){return b[0]!==b[1]?1:0})},
K:[32779]}),new W("<",U,{priority:80,resultType:"b",D:function(a){return Yg(a,function(b){return b[0]<b[1]?1:0})},K:[32782]}),new W("<=",U,{priority:80,resultType:"b",D:function(a){return Yg(a,function(b){return b[0]<=b[1]?1:0})},K:[32783]}),new W(">",U,{priority:80,resultType:"b",D:function(a){return Yg(a,function(b){return b[0]>b[1]?1:0})},K:[32780]}),new W(">=",U,{priority:80,resultType:"b",D:function(a){return Yg(a,function(b){return b[0]>=b[1]?1:0})},K:[32781]}),new W("&",U,{priority:110,D:function(a){return Yg(a,
function(b){return b[0]&b[1]})},K:[32777]}),new W("|",U,{priority:90,D:function(a){return Yg(a,function(b){return b[0]|b[1]})},K:[32775]}),new W("^",U,{priority:100,D:function(a){return Yg(a,function(b){return b[0]^b[1]})},K:[32776]}),new W("and",U,{priority:60,resultType:"b",D:function(a){return Yg(a,function(b){return b[0]&&b[1]?1:0})},K:[32785]}),new W("or",U,{priority:50,resultType:"b",D:function(a){return Yg(a,function(b){return b[0]||b[1]?1:0})},K:[32784]}),new W("=",U,{priority:zg})];
function Zg(a,b,c){for(var d=0;d<a.Xb.length;d++)if(a.Xb[d].type===c&&a.Xb[d].name===b)return a.Xb[d];return null}function $g(a,b,c){return a.C[a.m+b]instanceof c}function ah(a,b,c){return a.C[a.m+b]instanceof ng&&a.C[a.m+b].name===c}M=vb.prototype;M.jg=function(a){return new yg(a,4,null)};
function bh(a,b){b=b||10;if($g(a,0,lg)){var c=new ug(a.C[a.m]);a.m++}else if($g(a,0,kg))c=new sg(a.C[a.m]),a.m++;else if($g(a,0,mg))ah(a,1,"(")?(c=a.jg(a.C[a.m]),a.m++,ah(a,1,")")?a.m+=2:c.children=ch(a)):(c=new wg(a.C[a.m]),a.m++);else if(ah(a,0,"(")){a.m++;c=bh(a,20);if(!ah(a,0,")"))throw"subexpression in expression "+T(a.C[a.m]);a.m++}else if(ah(a,0,"[")){c=new Ag(a.C[a.m]);a.m++;var d=[];for(var e=0,f=0,g=0;;){d.push(bh(a,25));0===g&&f++;g++;if(1<f&&g>e)throw"non-rectangular array "+T(a.C[a.m]);
g>e&&(e=g);if($g(a,0,ng))if(a.m++,"]"===a.C[a.m-1].name)break;else if(","===a.C[a.m-1].name)continue;else if(";"===a.C[a.m-1].name){e=g;g=0;continue}throw"array "+T(a.C[a.m-1]);}for(g=0;g<e;g++)for(var h=0;h<f;h++)c.children.push(d[h*e+g])}else if($g(a,0,ng)&&(d=Zg(a,a.C[a.m].name,0)))c=new yg(a.C[a.m],0,d),a.m++,c.children.push(bh(a,150)),d.ka&&(c.resultType=d.ka(a,c,[c.children[0].resultType]));else if($g(a,0,ng)&&(d=Zg(a,a.C[a.m].name,3)))c=new yg(a.C[a.m],3,d),a.m++;else{if(a.m<a.C.length)throw"unexpected token in expression "+
T(a.C[a.m]);throw"unexpected end of file";}for(;$g(a,0,ng);)if((d=Zg(a,a.C[a.m].name,2))&&d.priority>=b)c=new yg(a.C[a.m],2,d,[c]),a.m++;else if((d=Zg(a,a.C[a.m].name,U))&&(b===zg?d.priority>=b:d.priority>b))c=new yg(a.C[a.m],U,d,[c]),a.m++,c.children.push(bh(a,d.priority)),d.ka&&(c.resultType=d.ka(a,c,c.children.map(function(k){return k.resultType})));else if("["===a.C[a.m].name){if(!(c instanceof wg))throw"unexpected indexing";d=c.resultType;e=ch(a,!0);c=new Cg(c.head,e);c.resultType=d}else break;
return c}function ch(a,b){var c=[];if(!ah(a,0,b?"[":"("))throw"left "+(b?"bracket":"parenthesis")+" expected";for(a.m++;;){var d=bh(a,25);c.push(d);if(!$g(a,0,ng))throw"syntax error in arguments";if(ah(a,0,b?"]":")")){a.m++;break}else if(ah(a,0,","))a.m++;else throw"syntax error in arguments "+T(a.C[a.m]);}return c}
M.og=function(){if(this.m>=this.C.length)throw"no more tokens";if(this.C[this.m]instanceof ng){var a=this.C[this.m];switch(a.name){case "const":if(!$g(this,1,mg)||!ah(this,2,"="))throw'syntax error for "const" '+T(a);var b=this.C[this.m+1];this.m+=3;var c=bh(this);c=c.D(this);if(!(c instanceof sg))throw"non-constant expression in constant definition "+T(this.C[this.m]);return[new Mg(a,b.name,c)];case "var":if(!$g(this,1,mg))throw'unexpected token after "var" '+T(a);b=this.C[this.m+1];this.m+=2;if($g(this,
0,ng))switch(this.C[this.m].name){case "[":if(ah(this,1,"]")){this.m+=2;if(!ah(this,0,"="))throw"missing size or initial value in array declaration"+T(this.C[this.m-2]);c=new yg(this.C[this.m],U,Zg(this,"=",U),[new wg(b)]);this.m++;c.children.push(bh(this));c.resultType=c.children[1].resultType;c.ub=!1;var d=new yg(new ng(c.head.zd,c.head.gd,c.head.ed,"size"),0,Zg(this,"size",0),[c.children[1]]);return[new Ng(a,b,c.resultType,[d],c)]}this.m++;d=bh(this);if(!ah(this,0,"]"))throw"array size syntax error"+
T(this.C[this.m]);this.m++;return ah(this,0,"=")?(c=new yg(this.C[this.m],U,Zg(this,"=",U),[new wg(b)]),this.m++,c.children.push(bh(this)),c.resultType=c.children[1].resultType,c.ub=!1,c=c.D(this),[new Ng(a,b,c.resultType,[d],c)]):[new Ng(a,b,qg,[d])];case "=":return c=new yg(this.C[this.m],U,Zg(this,"=",U),[new wg(b)]),this.m++,c.children.push(bh(this)),c.resultType=c.children[1].resultType,c.ub=!1,c=c.D(this),[new Ng(a,b,c.resultType,null,c)]}return[new Ng(a,b,qg)];case "if":case "elseif":this.m++;
c=bh(this);if(!ah(this,0,"then"))throw'"then" expected after "if" statement '+T(this.C[this.m]);this.m++;return["if"===a.name?new Pg(a,c):new Qg(a,c)];case "when":this.m++;c=bh(this);if(!ah(this,0,"do"))throw'"do" expected after "when" statement '+T(this.C[this.m]);this.m++;return[new Sg(a,c)];case "while":this.m++;c=bh(this);if(!ah(this,0,"do"))throw'"do" expected after "while" statement '+T(this.C[this.m]);this.m++;return[new Tg(a,c)];case "for":if(!$g(this,1,mg)||!ah(this,2,"in"))throw'"for" syntax error '+
T(a);b=this.C[this.m+1];this.m+=3;c=bh(this);if(!ah(this,0,":"))throw'range expected in "for" statement '+T(this.C[this.m]);this.m++;d=bh(this);var e=null;ah(this,0,"step")&&(this.m++,e=bh(this));if(!ah(this,0,"do"))throw'"do" expected after "for" statement '+T(this.C[this.m]);this.m++;return[new Ug(a,b,c,d,e)];case "end":return this.m++,[new Xg(a)];case "call":if(!$g(this,1,mg))throw'"call" syntax error '+T(a);b=this.C[this.m+1];this.m+=2;return ah(this,0,"(")?[new Vg(a,b.name,ch(this))]:[new Vg(a,
b.name,[])];case "callsub":if(!$g(this,1,mg))throw'"callsub" syntax error '+T(a);b=this.C[this.m+1];this.m+=2;return[new Wg(a,b.name)];case "else":return this.m++,[new Rg(a)];case "onevent":if(!$g(this,1,mg))throw'unexpected token after "onevent" '+T(a);b=this.C[this.m+1];this.m+=2;return[new Jg(a,b.name)];case "return":return this.m++,[new Lg(a)];case "sub":if(!$g(this,1,mg))throw'unexpected token after "sub" '+T(a);b=this.C[this.m+1];this.m+=2;return[new Kg(a,b.name)]}}c=bh(this);c instanceof yg&&
(c.ub=!1);c=c.D(this);return[new Og(c)]};M.vg=function(){};M.ug=function(){};
M.Je=function(a){if(a instanceof Mg){a.S=a.S.D(this);if(!(a.S instanceof sg))throw"constant definition "+T(a.head);this.P[a.b]={S:a.S.n,resultType:a.S.resultType}}else a instanceof Ng&&(a.size=1,a.v=[],a.b&&(a.b=a.b.map(function(b){b=b.D(this);if(!(b instanceof sg)||0>=b.n)throw"array variable size "+T(a.head);a.size*=b.n;a.v.push(b.n);return b},this)),a.offset=this.Ma,a.children[0]&&(a.resultType=a.children[0].resultType),this.Ma+=a.size,this.Cd(a.P,a.size,a.v,a.offset,a.resultType))};M.Pd=function(){};
M.ta=function(){};M.getContext=function(){return null};M.$f=function(){this.Ma=this.qa.Ma;for(var a=0;a<this.g.length;a++)this.Je(this.g[a])};function dh(a,b,c){switch(b.type){case 3:c.push(a.getContext());a.ta(b.Oa[0]);break;case 4:a.ta(b.Oa[0]);break;case 5:a.ta(c.pop())}}
function eh(a){function b(){if(1<f.length){var h=f[f.length-1].head;throw"unterminated "+h.name+" "+T(h);}c.o.push(f[0])}var c=a,d=[];a.$f();a.Pd();d=[];a.g.forEach(function(h){dh(this,h,d);h.Qa(this)},a);a.Pd();d=[];for(var e=0;e<a.g.length;e++)dh(a,a.g[e],d),a.g[e]=a.g[e].D(a);a.Pd();d=[];for(e=0;e<a.g.length;e++)dh(a,a.g[e],d),a.g[e]=a.g[e].w(a);a.o=[];var f=[new Jg(null,"init")];a.Pd();for(e=0;e<a.g.length;e++)switch(a.g[e].type){case Gg:a.g[e].Od(a,a.g[e]);f[f.length-1].children.push(a.g[e]);
break;case 2:a.ta(a.g[e].Oa[0]);b();f=[a.g[e].Ef()];break;case 3:a.ta(a.g[e].Oa[0]);a.g[e].rg(a);f.push(a.g[e]);break;case 4:a.ta(a.g[e].Oa[0]);f[f.length-1].tg(a.g[e]);break;case 5:if(2>f.length)throw"unexpected end "+T(a.g[e].head);a.ta(a.g[e].Oa[0]);f[f.length-1].sg(a.g[e]);var g=f.pop();a.ta(a.g[e].Oa[a.g[e].Oa.length-1]);g.Od(a,a.g[e]);f[f.length-1].children.push(g);break;default:throw"not implemented "+a.g[e].type;}b()}M.wg=function(){};M.ig=function(){return null};
pg.prototype.u=function(a){for(var b=[],c=a.Ka,d=0;d<this.children.length;d++)b=b.concat(this.children[d].u(a)),a.Ka=c+b.length;return b};function fh(a){return-2048<=a&&2048>a?[4096|a&4095]:[8192,a&65535]}sg.prototype.u=function(){return this.ub?fh(this.n):[]};wg.prototype.u=function(a){return this.b?[]:a.P.hasOwnProperty(this.name)?fh(a.P[this.name].S):fg(a,this).rd(a)};
yg.prototype.u=function(a){function b(h,k,l,z){function m(v,p){z===c.Hf&&(x=x.concat(v.rd(a,p)));l&&(x=x.concat(v.rd(a,p)));x=x.concat(k.u(a)).concat(a.yb(k.resultType,v.resultType),v.af(a,p));z===c.Ee&&(x=x.concat(v.rd(a,p)))}var x=[];if(h instanceof Cg){var n=fg(a,h);if(Dg(h)){h=Eg(h,n);if(h>=n.size)throw"index out of range";m(n,h)}else if(z!==c.nf||l){var r=hg(a,1);x=x.concat(gh(h,a)).concat(16384|r);z===c.Hf&&(x=x.concat(12288|r).concat(n.xe(a)));l&&(x=x.concat(12288|r).concat(n.xe(a)));x=x.concat(k.u(a)).concat(a.yb(k.resultType,
n.resultType),12288|r,n.zf(a));z===c.Ee&&(x=x.concat(12288|r).concat(n.xe(a)))}else x=x.concat(k.u(a)).concat(a.yb(k.resultType,n.resultType)).concat(gh(h,a),n.zf(a))}else if(h instanceof wg)n=fg(a,h),m(n);else throw"bad assignment";return x}var c={nf:0,Ee:1,Hf:2},d=this.head.name;switch(d){case "=":return b(this.children[0],this.children[1],!1,this.ub?c.Ee:c.nf);case "++":case "--":if(!(this.children[0]instanceof wg))throw"invalid operand "+T(this.head);var e=d[0],f=Zg(a,e,U);e=new yg(new ng(this.head.zd,
this.head.gd,this.head.ed,e),U,f,[xg(this.children[0]),new sg(new kg(this.head.zd,this.head.gd,this.head.ed,1))]);f.ka&&(d=fg(a,this.children[0]),e.resultType=f.ka(a,e,[d.resultType,Zf]));return b(this.children[0],e,!0,this.ub?0===this.type?c.Ee:c.Hf:c.nf);default:if(this.type===U&&this.Da.priority===zg){if(!(this.children[0]instanceof wg))throw"invalid operand "+T(this.head);e=d.slice(0,-1);f=Zg(a,e,U);e=new yg(new ng(this.head.zd,this.head.gd,this.head.ed,e),U,f,[xg(this.children[0]),this.children[1]]);
f.ka&&(d=fg(a,this.children[0]),e.resultType=f.ka(a,e,[d.resultType,this.children[1].resultType]));return b(this.children[0],e,!0,this.ub?c.Ee:c.nf)}if(this.Da&&this.Da.u)return this.Da.u(this,a);switch(this.type){case 0:return pg.prototype.u.call(this,a).concat(this.Da.K);case U:return pg.prototype.u.call(this,a).concat(this.Da.K);case 3:return this.Da.K;case 4:f=a.ig(this);if(null!==f)return f;e=gg(a,d);if(null!=e){if(e.Zc!==this.children.length)throw"wrong number of arguments";f=[];d=hg(a,e.Zc+
(e.he||0));for(var g=0;g<this.children.length;g++)f=f.concat(this.children[g].u(a)),f=f.concat(16384|d+g);return f=f.concat(e.Jb(a,a.qa,this.children.map(function(h){return h.resultType}),d))}throw"unknown function "+d+" "+T(this.head);default:throw"internal";}}};function hh(a,b,c){return a instanceof yg&&2===a.children.length?a.children[0].u(b).concat(a.children[1].u(b)).concat([40960|(c?256:0)|a.Da.K[0]&255,0]):a.u(b).concat(4096,40960|(c?256:0)|Vf.indexOf("ne"),0)}
function gh(a,b){var c=fg(b,a);if(a.children.length>c.v.length)throw"too many indices"+T(a.head);for(var d=[],e=1,f=0;f<a.children.length;f++)d=d.concat(a.children[f].u(b)),0<f&&(d=d.concat(4096|e,32772,32770)),e*=c.v[f];return d}Cg.prototype.u=function(a){if(this.b)return[];var b=fg(a,this);if(Dg(this)){var c=Eg(this,b);if(c>=b.size)throw"index out of range "+T(this.head);return b.rd(a,c)}return gh(this,a).concat(b.xe(a))};Ag.prototype.u=function(){throw"internal";};
Fg.prototype.u=function(){throw"internal";};Jg.prototype.u=function(a){var b=a.getContext();Hg(this,a);a.ta(this.Oa[0]);var c="init"===this.Ye?a.Zf:[];a.Ka+=c.length;c=c.concat(pg.prototype.u.call(this,a),0);a.ta(b);return c};Kg.prototype.u=function(a){var b=a.getContext();Hg(this,a);a.ta(this.Oa[0]);var c=pg.prototype.u.call(this,a).concat(57344);a.ta(b);return c};Mg.prototype.u=function(a){Hg(this,a);return[]};
Ng.prototype.u=function(a){Hg(this,a);return 0===this.children.length?[]:pg.prototype.u.call(this,a)};Og.prototype.u=function(a){Hg(this,a);return this.children[0].u(a)};Bg.prototype.u=function(a,b){Hg(this,a);var c=[];this.children.forEach(function(d){c=c.concat(d.u(a,b))});return c};
Pg.prototype.u=function(a){var b=a.getContext();Hg(this,a);for(var c=a.Ka,d=[],e=0,f=0;f<this.b.length;f++)a.Ka=c+d.length,0<f&&og(a,this.l[f-1]),d=d.concat(hh(this.b[f],a)),a.Ka=c+d.length,dg(a,d),a.ta(this.Oa[f]),this.g[f].forEach(function(g){d=d.concat(g.u(a));a.Ka=c+d.length}),a.ta(b),f+1<this.g.length?(d=d.concat(36864),eg(a,d),dg(a,d),e++):eg(a,d);a.Ka=c+d.length;this.g.length>this.b.length&&(og(a,this.l[this.b.length-1],a.Ka+d.length),a.ta(this.Oa[this.b.length]),this.g[this.b.length].forEach(function(g){d=
d.concat(g.u(a));a.Ka=c+d.length}));for(;0<e--;)eg(a,d);a.ta(b);return d};Sg.prototype.u=function(a){var b=a.getContext();Hg(this,a);var c=a.Ka,d=hh(this.b,a,!0);dg(a,d);a.ta(this.Oa[0]);this.children.forEach(function(e){a.Ka=c+d.length;d=d.concat(e.u(a))});eg(a,d);a.ta(b);return d};
Tg.prototype.u=function(a){if(null==this.b&&0===this.children.length)return[];var b=a.getContext();Hg(this,a);var c=a.Ka,d=[];null!=this.b&&(d=hh(this.b,a));dg(a,d);a.ta(this.Oa[0]);this.children.forEach(function(e){a.Ka=c+d.length;d=d.concat(e.u(a))});a.Ka=c+d.length;og(a,this.g[0]);d=d.concat(36864|-d.length&4095);eg(a,d);a.ta(b);return d};
Ug.prototype.u=function(a){var b=a.getContext();Hg(this,a);var c=a.Ka,d=this.children[0].u(a),e=fg(a,this.l);d=d.concat(e.af(a));var f=d.length;d=d.concat(e.rd(a)).concat(this.children[1].u(a),40975,0);dg(a,d);a.ta(this.Oa[0]);for(var g=2;g<this.children.length;g++)a.Ka=c+d.length,d=d.concat(this.children[g].u(a));a.Ka=c+d.length;og(a,this.g[0]);d=d.concat(e.rd(a));d=this.b?d.concat(this.b.u(a)):d.concat(fh(1));d=d.concat(32770,e.af(a),36864|f-d.length-2&4095);eg(a,d);a.ta(b);return d};
Vg.prototype.u=function(a){Hg(this,a);var b=$f(a.qa,this.name);if(!b)throw'native function "'+this.name+'" not found';if(this.children.length!==b.B.length)throw'wrong number of arguments for native function "'+this.name+'"';for(var c=[],d=[],e=[],f=this.children.length-1;0<=f;f--){var g=this.children[f];if(0>b.B[f])if(void 0==d[-b.B[f]-1])d[-b.B[f]-1]=g.ob;else{if(d[-b.B[f]-1]!==g.ob)throw'argument size mismatch in native function "'+this.name+'"';}else 0===b.B[f]&&e.push(g.ob);if(g instanceof Cg)c=
c.concat(fh(fg(a,g).offset)).concat(gh(g,a),32770);else if(g instanceof wg)c=c.concat(fh(fg(a,g).offset));else{for(var h=hg(a,g.ob),k=0;k<g.ob;k++)c=c.concat((g instanceof Ag?g.children[k]:g).u(a)),c=c.concat(16384|h+k);c=c.concat(fh(h))}}for(f=e.length-1;0<=f;f--)c=fh(e[f]).concat(c);for(f=d.length-1;0<=f;f--)void 0!==d[f]&&(c=fh(d[f]).concat(c));return c=c.concat(49152|b.id)};Lg.prototype.u=function(a){Hg(this,a);return[(a.Df?14:0)<<12]};function ih(a,b){Ig.call(this,a,b)}ih.prototype=Object.create(Ig.prototype);
ih.prototype.constructor=ih;ih.prototype.u=function(){var a=this.ia.name;if(void 0===this.b.Vd[a])throw'unknown function "'+a+'" '+T(this.ia.head);return 53248|this.b.Vd[a]};Wg.prototype.u=function(a){Hg(this,a);return[new ih(a,this)]};function jh(a,b){b=b||0;for(var c=0;c<a.length;c++)a[c]instanceof Ig&&(a[c]=a[c].u(b+c))}
vb.prototype.u=function(){this.gb=[];this.Pd();this.Wb=[];var a=this.o.map(function(f){this.Ka=0;this.ta(f.Oa[0]);this.Df=f instanceof Kg;this.Wb=[];return{Ed:f.u(this,!0),mapping:this.Wb}},this);if(0<this.gb.length)throw"internal";for(var b=0,c=0;c<this.o.length;c++)this.o[c]instanceof Jg&&b++;this.Vd={};var d=[],e=[1+2*b];this.Wb=[];for(c=0;c<this.o.length;c++)this.Wb=this.Wb.concat(a[c].mapping.map(function(f){return new Xf(f.Cg,f.line,f.Fa,f.Pb+1+2*b+d.length)})),this.o[c]instanceof Jg?(e=e.concat(bg(this.qa,
this.o[c].Ye),1+2*b+d.length),d=d.concat(a[c].Ed)):this.o[c]instanceof Kg&&(this.Vd[this.o[c].Dg]=1+2*b+d.length,d=d.concat(a[c].Ed));jh(d,1+2*b);return e.concat(d)};function xb(a){a.tf();a.vg();a.m=0;for(a.g=[];a.m<a.C.length;)a.g=a.g.concat(a.og());a.ug();eh(a);a.wg();return a.u()};function kh(a,b,c){void 0===c&&(c=1);return{name:a,Zc:c,he:1,we:function(d){return null!=$f(d,b)},Jb:function(d,e,f,g){d=$f(e,b);e=[4097];for(f=0;f<c;f++)e=e.concat([4096|g+c-1-f]);return e=e.concat([4096|g+c,49152|d.id,12288|g+c])}}}var wb=[kh("min","math.min",2),kh("max","math.max",2),kh("clamp","math.clamp",3),kh("muldiv","math.muldiv",3),kh("atan2","math.atan2",2),kh("sin","math.sin"),kh("cos","math.cos"),kh("sqrt","math.sqrt"),kh("rand","math.rand",0)];function Nf(a,b){vb.call(this,a,b);this.Wf=!0;this.Xb=lh;this.sb=100;this.Hg=[];this.$e=[];this.Yf=[];this.labels=[[]];this.Xf=[];this.Ab=!1;this.label=null;this.za=qg;this.Ra=[]}Nf.prototype=Object.create(vb.prototype);Nf.prototype.constructor=Nf;var mh="== != <= >= |= ^= &= *= /= %= += -= <<= >>= ++ -- ( ) [ ] - ~ ! * / % + << >> && || & ^ | > < = , ? : { } ; bool break case const continue default do else emit false fixed for goto if int onevent return size switch true void when while".split(" ");
function nh(a,b,c){return c[0]}function oh(a,b,c){for(a=0;a<c.length;a++)switch(c[a]){case qg:case vg:return c[a];case "v":throw"cannot use void result in expression";}return Zf}function ph(a,b,c){if(!(a instanceof Ag)&&a.resultType!==b&&a.resultType!==qg){if("v"===a.resultType)throw"cannot use void result "+T(a.head);if(b=qh(b))a=new yg(new ng(a.head.zd,a.head.gd,a.head.ed,b),0,Zg(c,b,0),[a]),a=a.D(c)}return a}function rh(a,b){a.children[1]=ph(a.children[1],a.resultType,b);return a}
Nf.prototype.yb=function(a,b){if(a===qg||b===qg)throw"internal";if("v"===a)throw"bad conversion from void";switch(a){case Zf:case "b":switch(b){case vg:return[4196,32772]}break;case vg:switch(b){case Zf:case "b":return[4196,32773]}}return[]};function sh(a,b,c){var d=[];a.forEach(function(e){d=e instanceof ug&&b===Zf?d.concat(fh(Math.trunc(e.n))):e instanceof sg&&e.resultType===Zf&&b===vg?d.concat(fh(e.n*c.sb)):d.concat(e.u(c)).concat(c.yb(e.resultType,b))});return d}
function th(a,b,c,d){var e=hg(a,4);return(b instanceof pg?b.u(a):fh(b)).concat(16384|e).concat(c instanceof pg?c.u(a):fh(c),16384|e+1).concat(d instanceof pg?d.u(a):fh(d),[16384|e+2,4097,4096|e+2,4096|e+1,4096|e,4096|e+3,49152|$f(a.qa,"math.muldiv").id,12288|e+3])}
function uh(a,b,c,d){for(var e=!1,f=[],g=0;g<a.children.length;g++){if(a.children[g]instanceof ug)e=!0;else if(!(a.children[g]instanceof sg))return a;f.push(a.children[g].n)}c=(e&&d?d:c)(f);d=a.Da.resultType;a.Da.ka&&(d=a.Da.ka(b,a,a.children.map(function(h){return h.resultType})));switch(d){case Zf:case "b":return new sg(a.head,tg(c));case vg:return new ug(a.head,c);default:throw"internal";}}
var lh=[new W("--",0,{priority:150,ka:nh}),new W("++",0,{priority:150,ka:nh}),new W("-",0,{priority:150,ka:nh,D:function(a,b){return uh(a,b,function(c){return-c[0]})},K:[28672]}),new W("~",0,{priority:150,D:function(a,b){return uh(a,b,function(c){return~c[0]})},K:[28674]}),new W("!",0,{priority:150,resultType:"b",D:function(a,b){return uh(a,b,function(c){return 0==c[0]?1:0})},K:[4096,32778]}),new W("bool",0,{priority:150,resultType:"b",D:function(a,b){return uh(a,b,function(c){return 0!=c[0]?1:0})},
K:[],u:function(a,b){b=a.children[0].u(b);"b"!==a.children[0].resultType&&(b=b.concat(4096,32779));return b}}),new W("fixed",0,{priority:150,resultType:vg,D:function(a,b){return uh(a,b,function(c){return c[0]})},K:[],u:function(a,b){var c=a.children[0].u(b);a.children[0].resultType!==vg&&(c=c.concat(4096|b.sb,32772));return c}}),new W("int",0,{priority:150,D:function(a,b){return uh(a,b,function(c){return c[0]})},K:[],u:function(a,b){var c=a.children[0].u(b);a.children[0].resultType===vg&&(c=c.concat(4096|
b.sb,32773));return c}}),new W("size",0,{priority:150,D:function(a,b){var c=0<a.children[0].ob?a.children[0].ob:a.children[0]instanceof Ag?a.children[0].children.length:-1;if(0>c&&a.children[0]instanceof wg)for(var d=b.Za.length-1;0<=d;d--)if(b.Za[d].name===a.children[0].name){c=b.Za[d].size;break}return 0<c?new sg(a.head,c):a}}),new W("--",2,{priority:150,ka:nh}),new W("++",2,{priority:150,ka:nh}),new W("+=",U,{priority:zg,ka:nh,D:rh}),new W("-=",U,{priority:zg,ka:nh}),new W("*=",U,{priority:zg,
ka:nh}),new W("/=",U,{priority:zg,ka:nh}),new W("%=",U,{priority:zg,ka:nh}),new W("<<=",U,{priority:zg}),new W(">>=",U,{priority:zg}),new W("&=",U,{priority:zg}),new W("|=",U,{priority:zg}),new W("^=",U,{priority:zg}),new W("*",U,{priority:140,ka:oh,K:[32772],D:function(a,b){return uh(a,b,function(c){return c[0]*c[1]})},u:function(a,b){var c=a.children[1].resultType===vg,d=[];a.children[0].resultType===vg&&c?d=d.concat(th(b,a.children[0],a.children[1],b.sb)):(a.children.forEach(function(e){d=d.concat(e.u(b))}),
d=d.concat(a.Da.K));return d}}),new W("/",U,{priority:140,ka:oh,K:[32773],D:function(a,b){return uh(a,b,function(c){if(0===c[1])throw"division by 0 "+T(a.head);return Math.trunc(c[0]/c[1])},function(c){if(0===c[1])throw"division by 0 "+T(a.head);return c[0]/c[1]})},u:function(a,b){var c=a.children[1].resultType===vg,d=[];a.children[0].resultType===vg?c?d=d.concat(th(b,a.children[0],b.sb,a.children[1])):(a.children.forEach(function(e){d=d.concat(e.u(b))}),d=d.concat(a.Da.K)):c?d=d.concat(th(b,a.children[0],
b.sb*b.sb,a.children[1])):(a.children.forEach(function(e){d=d.concat(e.u(b))}),d=d.concat(a.Da.K));return d}}),new W("%",U,{priority:140,ka:oh,D:function(a,b){return uh(a,b,function(c){if(0===c[1])throw"division by 0 "+T(a.head);return c[0]%c[1]})},K:[32774],u:function(a,b){return sh(a.children,a.resultType,b).concat(a.Da.K)}}),new W("+",U,{priority:130,ka:oh,D:function(a,b){return uh(a,b,function(c){return c[0]+c[1]})},K:[32770],u:function(a,b){return sh(a.children,a.resultType,b).concat(a.Da.K)}}),
new W("-",U,{priority:130,ka:oh,D:function(a,b){return uh(a,b,function(c){return c[0]-c[1]})},K:[32771],u:function(a,b){return sh(a.children,a.resultType,b).concat(a.Da.K)}}),new W("<<",U,{priority:120,D:function(a,b){return uh(a,b,function(c){return c[0]<<c[1]})},K:[32768],u:function(a,b){return a.children[0].u(b).concat(sh(a.children.slice(1),Zf,b)).concat(a.Da.K)}}),new W(">>",U,{priority:120,D:function(a,b){return uh(a,b,function(c){return c[0]>>c[1]})},K:[32769],u:function(a,b){return a.children[0].u(b).concat(sh(a.children.slice(1),
Zf,b)).concat(a.Da.K)}}),new W("==",U,{priority:80,resultType:"b",D:function(a,b){return uh(a,b,function(c){return c[0]===c[1]?1:0})},K:[32778],u:function(a,b){var c=a.children.map(function(d){return d.resultType});return sh(a.children,oh(b,a,c),b).concat(a.Da.K)}}),new W("!=",U,{priority:80,resultType:"b",D:function(a,b){return uh(a,b,function(c){return c[0]!==c[1]?1:0})},K:[32779],u:function(a,b){var c=a.children.map(function(d){return d.resultType});return sh(a.children,oh(b,a,c),b).concat(a.Da.K)}}),
new W("<",U,{priority:80,resultType:"b",D:function(a,b){return uh(a,b,function(c){return c[0]<c[1]?1:0})},K:[32782],u:function(a,b){var c=a.children.map(function(d){return d.resultType});return sh(a.children,oh(b,a,c),b).concat(a.Da.K)}}),new W("<=",U,{priority:80,resultType:"b",D:function(a,b){return uh(a,b,function(c){return c[0]<=c[1]?1:0})},K:[32783],u:function(a,b){var c=a.children.map(function(d){return d.resultType});return sh(a.children,oh(b,a,c),b).concat(a.Da.K)}}),new W(">",U,{priority:80,
resultType:"b",D:function(a,b){return uh(a,b,function(c){return c[0]>c[1]?1:0})},K:[32780],u:function(a,b){var c=a.children.map(function(d){return d.resultType});return sh(a.children,oh(b,a,c),b).concat(a.Da.K)}}),new W(">=",U,{priority:80,resultType:"b",D:function(a,b){return uh(a,b,function(c){return c[0]>=c[1]?1:0})},K:[32781],u:function(a,b){var c=a.children.map(function(d){return d.resultType});return sh(a.children,oh(b,a,c),b).concat(a.Da.K)}}),new W("&",U,{priority:110,D:function(a,b){return uh(a,
b,function(c){return c[0]&c[1]})},K:[32777]}),new W("|",U,{priority:90,D:function(a,b){return uh(a,b,function(c){return c[0]|c[1]})},K:[32775]}),new W("^",U,{priority:100,D:function(a,b){return uh(a,b,function(c){return c[0]^c[1]})},K:[32776]}),new W("&&",U,{priority:60,ka:nh,D:function(a,b){return uh(a,b,function(c){return c[0]&&c[1]?1:0})},K:[32785],u:function(a,b){var c=a.children[0].u(b).concat([16384|b.nc,12288|b.nc,4096,40960|Vf.indexOf("eq"),4,12288|b.nc,36864]);dg(b,c);a=ph(a.children[1],
a.children[0].resultType,b).D(b);c=c.concat(a.u(b));eg(b,c);return c}}),new W("||",U,{priority:50,ka:nh,D:function(a,b){return uh(a,b,function(c){return c[0]||c[1]?1:0})},K:[32784],u:function(a,b){var c=a.children[0].u(b).concat([16384|b.nc,12288|b.nc,4096,40960|Vf.indexOf("ne"),4,12288|b.nc,36864]);dg(b,c);a=ph(a.children[1],a.children[0].resultType,b).D(b);c=c.concat(a.u(b));eg(b,c);return c}}),new W("?",U,{priority:40,ka:function(a,b,c){return c[1]},D:function(a){if(!(a.children[1]instanceof yg)||
0==a.children[1].Da||":"!==a.children[1].Da.name)throw"missing else part in conditional expression "+T(a.head);return a.children[0]instanceof sg?a.children[1].children[a.children[0].n?0:1]:a},u:function(a,b){var c=hh(a.children[0],b);dg(b,c);c=c.concat(a.children[1].children[0].u(b)).concat(36864);eg(b,c);dg(b,c);c=c.concat(a.children[1].children[1].u(b));eg(b,c);return c}}),new W(":",U,{priority:41,ka:nh,D:function(a,b){a.children[1]=ph(a.children[1],a.children[0].resultType,b);return a},u:function(a){throw"unexpected colon outside conditional expression "+
T(a.head);}}),new W("=",U,{priority:zg,ka:nh,D:rh}),new W(",",U,{priority:25,ka:function(a,b){return b[1]},D:function(a){a.children[0].ub=!1;return a}}),new W("false",3,{resultType:"b",D:function(a,b){return uh(a,b,function(){return 0})},K:[4096]}),new W("true",3,{resultType:"b",D:function(a,b){return uh(a,b,function(){return 1})},K:[4097]})];M=Nf.prototype;
M.Bg=function(){for(;this.b<this.M;)if(" "===this.l[this.b]||"\t"===this.l[this.b])this.b++,this.Fa++;else if("\n"===this.l[this.b])this.b++,this.Fa=0,this.line++;else if("\r"===this.l[this.b])this.b++;else if("/*"===this.l.slice(this.b,this.b+2))for(this.b+=2,this.Fa+=2;this.b<this.M&&"*/"!==this.l.slice(this.b-2,this.b);)"\n"===this.l[this.b]?(this.Fa=0,this.line++):"\r"!==this.l[this.b]&&this.Fa++,this.b++;else if("//"===this.l.slice(this.b,this.b+2))for(;this.b<this.M&&"\n"!==this.l[this.b];)this.b++,
this.Fa++;else break};M.tf=function(a){return vb.prototype.tf.call(this,a||mh)};M.vg=function(){this.C.forEach(function(a,b){a instanceof ng&&("def"===a.name||0<=["int","bool","fixed","void"].indexOf(a.name))&&this.C[b+1]instanceof mg&&this.C[b+2]instanceof ng&&"("===this.C[b+2].name&&this.Hg.push(this.C[b+1].name)},this)};
function vh(a,b){switch(a.name){case "var":case "def":return b||Zf;case "void":return"v";case "int":return Zf;case "bool":return"b";case "fixed":return vg;default:throw"internal";}}function qh(a){switch(a){case Zf:return"int";case vg:return"fixed";case "b":return"bool";default:return""}}function wh(a){return ah(a,0,"int")||ah(a,0,"bool")||ah(a,0,"fixed")}
M.og=function(){function a(){var k=[];for(this.m++;;){d=this.C[this.m];this.m++;if(!$g(this,0,ng))throw"syntax error "+T(c);switch(this.C[this.m].name){case "[":if(ah(this,1,"]")){this.m+=2;if(!ah(this,0,"="))throw"missing size or initial value in array declaration"+T(this.C[this.m-2]);e=new yg(this.C[this.m],U,Zg(this,"=",U),[new wg(d)]);this.m++;e.children.push(bh(this,25));e.resultType=vh(c,e.children[1].resultType);e.children[1].Qa(this);e.ub=!1;var l=new yg(new ng(this.C[this.m].zd,this.C[this.m].gd,
this.C[this.m].ed,"size"),0,Zg(this,"size",0),[e.children[1]]);k.push(new Ng(c,d,e.resultType,[l],e))}else l=ch(this,!0),ah(this,0,"=")?(e=new yg(this.C[this.m],U,Zg(this,"=",U),[new wg(d)]),this.m++,e.children.push(bh(this,25)),e.resultType=vh(c,e.children[1].resultType),e.ub=!1,k.push(new Ng(c,d,e.resultType,l,e))):k.push(new Ng(c,d,vh(c),l));break;case "=":e=new yg(this.C[this.m],U,Zg(this,"=",U),[new wg(d)]);this.m++;e.children.push(bh(this,25));e.resultType=vh(c,e.children[1].resultType);e.ub=
!1;e=e.D(this);k.push(new Ng(c,d,e.resultType,null,e));break;default:k.push(new Ng(c,d,vh(c)))}if(ah(this,0,","))this.m++;else{if(ah(this,0,";"))return this.m++,k;throw"missing semicolon "+T(this.C[this.m]);}}}function b(){var k=vh(c);d=this.C[this.m+1];this.m+=3;var l=[];if(!ah(this,0,")"))for(;;){var z=Zf;wh(this)&&(z=vh(this.C[this.m]),this.m++);if(!$g(this,0,mg))throw"bad function definition argument "+T(this.C[this.m]);var m=this.C[this.m].name,x=[],n=!1;this.m++;ah(this,0,"[")&&(n=!0,x=ch(this,
!0));l.push({name:m,type:z,Pg:x,size:1,v:[],Lc:n});if(ah(this,0,","))this.m++;else if(ah(this,0,")"))break;else throw"syntax error in function definition "+T(this.C[this.m]);}this.m++;if(!ah(this,0,"{"))throw"block expected after function header "+T(this.C[this.m]);this.m++;return new xh(c,d.name,k,l)}if(this.m>=this.C.length)throw"no more tokens";var c=this.C[this.m];if(this.C[this.m]instanceof ng)switch(c.name){case "const":if(!$g(this,1,mg)||!ah(this,2,"="))throw'syntax error for "const" '+T(c);
var d=this.C[this.m+1];this.m+=3;var e=bh(this,25);e=e.D(this);if(!(e instanceof sg))throw"non-constant expression in constant definition "+T(this.C[this.m]);if(!ah(this,0,";"))throw"missing semicolon "+T(c);this.m++;return[new Mg(c,d.name,e)];case "int":case "bool":case "fixed":if(!$g(this,1,mg))throw'unexpected token after "'+c.name+'" '+T(c);return ah(this,2,"(")?[b.call(this)]:a.call(this);case "void":return[b.call(this)];case "if":this.m++;var f=ch(this);if(1!==f.length)throw'bad condition in "if" statement '+
T(this.C[this.m]);var g=new Pg(c,f[0]);ah(this,0,"{")?this.m++:g.za=!0;return[g];case "when":this.m++;f=ch(this);if(1!==f.length)throw'bad condition in "when" statement '+T(this.C[this.m]);if(!ah(this,0,"{"))throw'block expected after "when" statement '+T(this.C[this.m]);this.m++;return[new Sg(c,f[0])];case "switch":this.m++;f=ch(this);if(1!==f.length)throw'bad expression in "switch" statement '+T(this.C[this.m]);if(!ah(this,0,"{"))throw'block expected after "switch" statement '+T(this.C[this.m]);
this.m++;return[new yh(c,f[0])];case "case":this.m++;e=bh(this);if(!ah(this,0,":"))throw'missing colon after "case" '+T(this.C[this.m]);this.m++;return[new zh(c,e)];case "default":if(!ah(this,1,":"))throw'missing colon after "default" '+T(this.C[this.m]);this.m+=2;return[new zh(c,null)];case "goto":if(!$g(this,1,mg))throw'missing label after "goto" '+T(this.C[this.m]);d=this.C[this.m+1];this.m+=2;return[new Ah(c,d.name)];case "while":this.m++;f=ch(this);if(1!==f.length)throw'bad condition in "while" statement '+
T(this.C[this.m]);if(ah(this,0,";"))return this.m++,[new Bh(c,f[0])];if(!ah(this,0,"{"))throw'block expected after "while" statement '+T(this.C[this.m]);this.m++;return[new Ch(c,f[0])];case "do":if(!ah(this,1,"{"))throw'block expected after "do" statement '+T(this.C[this.m]);this.m+=2;return[new Dh(c)];case "for":if(!ah(this,1,"("))throw'"for" syntax error '+T(c);this.m+=2;d=null;var h=Zf;if(ah(this,0,";"))e=null;else{if(ah(this,0,"var")||wh(this)){if(!$g(this,1,mg))throw'bad variable declaration in "for" statement '+
T(this.C[this.m]);h=vh(this.C[this.m]);this.m++;d=this.C[this.m]}e=bh(this);if(!ah(this,0,";"))throw'semicolon expected in "for" statement '+T(this.C[this.m]);}this.m++;if(ah(this,0,";"))g=null;else if(g=bh(this),!ah(this,0,";"))throw'semicolon expected in "for" statement '+T(this.C[this.m]);this.m++;if(ah(this,0,")"))f=null;else if(f=bh(this),!ah(this,0,")"))throw'semicolon expected in "for" statement '+T(this.C[this.m]);this.m++;if(!ah(this,0,"{"))throw'block expected after "for" statement '+T(this.C[this.m]);
this.m++;return[new Eh(c,d,h,e,g,f)];case ";":return this.m++,[new Fh(c)];case "{":return this.m++,[new Gh(c)];case "}":this.m++;if(ah(this,0,"else")){this.m++;if(ah(this,0,"if")){this.m++;f=ch(this);if(1>f.length)throw'empty condition in "if" statement '+T(this.C[this.m]);1<f.length&&(g=new Bg(c),g.children=f.slice(0,-1).map(function(k){k instanceof yg&&(k.ub=!1);return k}),f=f.slice(-1));if(!ah(this,0,"{"))throw'block expected after "if" statement '+T(this.C[this.m]);this.m++;return[new Qg(c,f[0])]}if(!ah(this,
0,"{"))throw'block expected after "else" statement '+T(this.C[this.m]);this.m++;return[new Rg(c)]}return[new Xg(c)];case "else":throw'unexpected "else" '+T(this.C[this.m]);case "onevent":if(!$g(this,1,mg))throw'unexpected token after "onevent" '+T(c);if(!ah(this,2,"{"))throw'block expected after "onevent" statement '+T(this.C[this.m]);d=this.C[this.m+1];this.m+=3;return[new Hh(c,d.name)];case "return":this.m++;ah(this,0,";")?e=null:e=bh(this);if(!ah(this,0,";"))throw"missing semicolon "+T(c);this.m++;
return[new Ih(c,e)];case "break":d=null;$g(this,1,mg)&&(d=this.C[this.m+1],this.m++);if(!ah(this,1,";"))throw"missing semicolon "+T(c);this.m+=2;return[new Jh(c,!1,d?d.name:null)];case "continue":d=null;$g(this,1,mg)&&(d=this.C[this.m+1],this.m++);if(!ah(this,1,";"))throw"missing semicolon "+T(c);this.m+=2;return[new Jh(c,!0,d?d.name:null)]}if($g(this,0,mg)&&ah(this,1,"(")&&(d=this.C[this.m],$f(this.qa,d.name)))return this.m++,[new Vg(c,d.name,ch(this))];if($g(this,0,mg)&&ah(this,1,":"))return d=
this.C[this.m],this.m+=2,[new Kh(c,d.name)];e=bh(this);e.ub=!1;if(!ah(this,0,";"))throw"missing semicolon "+(this.m<this.C.length?T(this.C[this.m]):"eof");this.m++;e=e.D(this);return[new Og(e)]};
M.Je=function(a){if(a instanceof xh){for(var b=0;b<a.B.length;b++)a.B[b].size=1,a.B[b].v=a.B[b].Pg.map(function(c){c=c.D(this);if(!(c instanceof sg))throw"non-constant expression in argument dimension "+T(c.head);if(0>=c.n||Math.round(c.n)!==c.n)throw"bad value for argument dimension "+T(c.head);a.B[b].size*=c.n;return c.n},this),this.Cd(a.B[b].name,a.B[b].size,a.B[b].v,this.Ma,a.B[b].type,a.B[b].Lc),this.Ma+=a.B[b].Lc?1:a.B[b].size;a.Oa[1]={Za:this.Za.slice(),labels:this.labels.slice()}}else a instanceof
Eh?a.ha&&(this.Cd(a.ha.name,1,[1],this.Ma,a.Ra),this.Ma+=1,a.Oa[1]={Za:this.Za.slice(),labels:this.labels.slice()}):vb.prototype.Je.call(this,a)};M.Pd=function(){this.Za=this.Yf;this.labels=this.Xf};M.ta=function(a){a&&(this.Za=a.Za,this.labels=a.labels)};M.getContext=function(){return{Za:this.Za,labels:this.labels.slice()}};function Mh(a,b,c,d,e,f,g){Yf.call(this,a,b,c,d,e);this.Ab=f;this.Lc=g||!1}Mh.prototype=Object.create(Yf.prototype);M=Mh.prototype;M.constructor=Mh;
M.rd=function(a,b){return this.Ab?this.Lc?[12288|a.w,20480|this.offset,a.qa.b,20480|(b||0),a.qa.b]:[12288|a.w,20480|this.offset+(b||0),a.qa.b]:[12288|this.offset+(b||0)]};M.af=function(a,b){return this.Ab?this.Lc?[12288|a.w,20480|this.offset,a.qa.b,24576|(b||0),a.qa.b]:[12288|a.w,24576|this.offset+(b||0),a.qa.b]:[16384|this.offset+(b||0)]};M.xe=function(a){return this.Ab?this.Lc?[12288|a.w,20480|this.offset,a.qa.b,32770,20480,a.qa.b]:[12288|a.w,32770,20480|this.offset,a.qa.b]:[20480|this.offset,this.size]};
M.zf=function(a){return this.Ab?this.Lc?[12288|a.w,20480|this.offset,a.qa.b,32770,24576,a.qa.b]:[12288|a.w,32770,24576|this.offset,a.qa.b]:[24576|this.offset,this.size]};Nf.prototype.Cd=function(a,b,c,d,e,f){this.Za.push(new Mh(a,b,c,d,e,this.Ab,f))};function Nh(a){yg.call(this,a,4,null)}Nh.prototype=Object.create(yg.prototype);Nh.prototype.constructor=Nh;M=Nf.prototype;
M.jg=function(a){var b=new Nh(a,this.Ab,this.Ma);b.Da={ka:function(c,d){var e;a:{for(e=0;e<c.$e.length;e++)if(c.$e[e].yf===a.name){e=c.$e[e];break a}e=null}return e?e.resultType:(e=gg(c,a.name))&&e.ka?e.ka(c,e,d):Zf}};return b};
M.$f=function(){this.Ma=this.qa.Ma;this.Ab=!1;for(var a=[],b=0;b<this.g.length;b++){if(0<=[Xg,Qg,Rg].indexOf(this.g[b].constructor)){if(0===a.length)throw"unexpected end of block "+T(this.g[b].head);var c=a.pop();this.Ma=c.Ma;this.Ab=c.Ab;c.Xg.Oa[0]={Za:this.Za.slice(),labels:this.labels.slice()};this.Za.splice(c.ah);this.labels.pop();0===a.length&&(this.za=qg)}0<=[Pg,Sg,yh,Ch,Gh,Eh,Hh,xh,Qg,Rg].indexOf(this.g[b].constructor)&&(a.push({Ma:this.Ma,Ab:this.Ab,ah:this.Za.length,Xg:this.g[b]}),this.labels.push([]),
this.g[b]instanceof xh&&(this.Ab=!0,this.za=this.g[b].resultType,this.Ma=0));this.Je(this.g[b]);if(this.g[b]instanceof Kh){c=this.g[b].label;for(var d=this.labels.length-1,e=0;e<this.labels[d].length;e++)if(this.labels[d][e].label===c)throw'duplicate label "'+c+'"';this.labels[d].push({label:c})}}this.Yf=this.Za.slice();this.Xf=this.labels};
M.ug=function(){for(var a=1;a<this.g.length;)this.g[a]instanceof Bh&&this.g[a-1]instanceof Xg?this.g.splice(a-1,1):a++;this.g.forEach(function(b){b instanceof xh&&(this.$e.push(b),this.za=b.resultType)},this);for(a=0;a<this.g.length-1;a++)this.g[a]instanceof Kh&&(this.g[a+1]instanceof Ch?this.g[a+1].label=this.g[a].label:this.g[a+1]instanceof Dh?this.g[a+1].label=this.g[a].label:this.g[a+1]instanceof Eh?this.g[a+1].label=this.g[a].label:this.g[a+1]instanceof yh&&(this.g[a+1].label=this.g[a].label))};
M.wg=function(){for(var a=0;a<this.g.length;a++)(this.g[a]instanceof Hh||this.g[a]instanceof xh)&&this.o.push(this.g[a])};function Oh(a,b){for(var c=a.length-1;0<=c;c--)for(var d=a[c].length-1;0<=d;d--)if(a[c][d].label===b)return a[c][d];return null}
M.u=function(){this.gb=[];this.Pd();this.Wb=[];this.nc=this.Sc=this.Tc=this.qa.b-2;this.w=this.nc+1;this.Zf=[];var a=this.o.map(function(h){this.Ka=0;this.ta(h.Oa[0]);this.Df=h instanceof Kg||h instanceof xh;this.Ab=h instanceof xh;this.Wb=[];h=h.u(this,!0);jh(h);return{Ed:h,mapping:this.Wb}},this);if(0<this.gb.length)throw"internal";for(var b=0,c=0;c<this.o.length;c++)this.o[c]instanceof Jg&&b++;var d=[],e={},f=[];this.Wb=[];for(c=0;c<this.o.length;c++){var g=1+2*b+f.length;this.o[c]instanceof Hh||
this.o[c]instanceof Jg?(d.push({id:bg(this.qa,this.o[c].Ye),offset:f.length}),f=f.concat(a[c].Ed)):this.o[c]instanceof Kg?(e[this.o[c].Dg]=f.length,f=f.concat(a[c].Ed)):this.o[c]instanceof xh&&(e[this.o[c].yf]=f.length,f=f.concat(a[c].Ed));this.Wb=this.Wb.concat(a[c].mapping.map(function(h){return new Xf(h.Cg,h.line,h.Fa,h.Pb+g)}))}a=[1+2*d.length];for(c=0;c<d.length;c++)a=a.concat(d[c].id,1+2*d.length+d[c].offset);for(c=0;c<f.length;c++)if("string"===typeof f[c]){if(void 0===e[f[c]])throw Ph(f[c]),
'unknown function "'+f[c]+'"';f[c]=53248|e[f[c]]+a.length}return a.concat(f)};
M.ig=function(a){for(var b=a.head.name,c=0;c<this.o.length;c++)if(this.o[c]instanceof xh&&this.o[c].yf===b){if(a.children.length!==this.o[c].B.length)throw"wrong number of arguments "+T(a.head);b=a.ub?[b,12288|this.nc]:[b];this.Ab?0<this.Ma&&(b=[12288|this.w,4096|this.Ma,32770,16384|this.w].concat(b,12288|this.w,4096|this.Ma,32771,16384|this.w)):b=[4096|this.Ma,16384|this.w].concat(b);for(var d=[],e=0;e<a.children.length;e++){if(this.o[c].B[e].size!==a.children[e].ob)throw"incompatible size "+T(a.children[e].head);
if(this.o[c].B[e].Lc){if(!(a.children[e]instanceof wg))throw"variable reference expected "+T(a.children[e].head);if(this.o[c].B[e].type!==a.children[e].resultType)throw"variable reference type mismatch "+T(a.children[e].head);}if(this.o[c].B[e].Lc){var f=fg(this,a.children[e]);d=d.concat(f.Ab?f.Lc?[12288|this.w,20480|f.offset,this.qa.b]:[12288|this.w,4096|f.offset,32770]:[4096|f.offset]).concat(this.Ab?[12288|this.w,24576|e+this.Ma,this.qa.b]:16384|e+this.Ma)}else a.children[e]=ph(a.children[e],this.o[c].B[e].type,
this).D(this),d=d.concat(a.children[e].u(this)).concat(this.yb(a.children[e].resultType,this.o[c].B[e].type),this.Ab?[12288|this.w,24576|e+this.Ma,this.qa.b]:16384|e+this.Ma)}return d.concat(b)}return null};function Qh(a){a=a.trim();if(""===a)return!1;var b=["#","//","/*"].map(function(c){c=a.indexOf(c);return 0>c?a.length:c}).sort(function(c,d){return c-d})[0];return b<a.length?"#"!==a[b]:/[;{]/.test(a)}ug.prototype.u=function(a){return fh(Math.round(this.n*a.sb))};
function Gh(a){Fg.call(this,a,3)}Gh.prototype=Object.create(Fg.prototype);Gh.prototype.constructor=Gh;Gh.prototype.D=function(a){rg(this.children,a);return this};Gh.prototype.u=function(a){var b=a.getContext();Hg(this,a);a.ta(this.Oa[0]);var c=pg.prototype.u.call(this,a);a.ta(b);return c};function Fh(a){Fg.call(this,a)}Fh.prototype=Object.create(Fg.prototype);Fh.prototype.constructor=Fh;Fh.prototype.u=function(){return[]};function Ch(a,b){Tg.call(this,a,b);this.label=null}Ch.prototype=Object.create(Tg.prototype);
Ch.prototype.constructor=Ch;Ch.prototype.u=function(a){if(null==this.b&&0===this.children.length)return[];var b=a.getContext();Hg(this,a);var c=[],d=a.Ka;a.Ra.push({});null!=this.b&&(c=hh(this.b,a));dg(a,c);a.ta(this.Oa[0]);this.children.forEach(function(e){a.Ka=d+c.length;c=c.concat(e.u(a))});c=c.concat(36864|-c.length&4095);eg(a,c);Rh(c,0,c.length,this.label);a.Ra.pop();a.ta(b);return c};function Dh(a){Fg.call(this,a,3);this.label=this.b=null}Dh.prototype=Object.create(Fg.prototype);
Dh.prototype.constructor=Dh;Dh.prototype.sg=function(a){if(!(a instanceof Bh))throw'unexpected closing statement for "do"';this.b=a.b};
Dh.prototype.u=function(a){if(null==this.b&&0===this.children.length)return[];var b=a.getContext();Hg(this,a);var c=[],d=a.Ka;a.Ra.push({});a.ta(this.Oa[0]);this.children.forEach(function(e){a.Ka=d+c.length;c=c.concat(e.u(a))});null!=this.b&&(c=c.concat(hh(new yg(new ng(this.b.head.zd,this.b.head.gd,this.b.head.ed,"not"),0,Zg(a,"!",0),[this.b]),a)),dg(a,c),eg(a,c,0));Rh(c,0,c.length,this.label);a.Ra.pop();a.ta(b);return c};function Bh(a,b){Fg.call(this,a,5);this.b=b}Bh.prototype=Object.create(Fg.prototype);
Bh.prototype.constructor=Bh;function Eh(a,b,c,d,e,f){Fg.call(this,a,3);d&&(d.ub=!1);f&&(f.ub=!1);this.ha=b;this.Ra=c;this.g=d;this.b=e;this.l=f;this.label=null;this.P=[]}Eh.prototype=Object.create(Fg.prototype);M=Eh.prototype;M.constructor=Eh;M.Qa=function(a){pg.prototype.Qa.call(this,a);this.g&&this.g.Qa(a);this.b&&this.b.Qa(a);this.l&&this.l.Qa(a)};M.D=function(a){this.g&&(this.g=this.g.D(a));this.b&&(this.b=this.b.D(a));this.l&&(this.l=this.l.D(a));rg(this.children,a);return this};
M.Od=function(a,b){this.P.push(b)};
M.u=function(a){var b=a.getContext();Hg(this,a);a.ta(this.Oa[1]);var c=a.Ka,d=this.g?this.g.u(a):[];a.Ra.push({});var e=d.length;this.b&&(d=d.concat(hh(this.b,a)),dg(a,d));a.ta(this.Oa[0]);for(var f=0;f<this.children.length;f++)a.Ka=c+d.length,d=d.concat(this.children[f].u(a));a.ta(this.Oa[1]);f=d.length;a.Ka=c+d.length;og(a,this.P[0]);this.l&&(d=d.concat(this.l.u(a)));d=d.concat(36864|e-d.length&4095);this.b&&eg(a,d);Rh(d,f,d.length,this.label);a.Ra.pop();a.ta(b);return d};
function Jh(a,b,c){Fg.call(this,a);this.M=b;this.label=c}Jh.prototype=Object.create(Fg.prototype);Jh.prototype.constructor=Jh;function Sh(a,b){Ig.call(this,a,b)}Sh.prototype=Object.create(Ig.prototype);Sh.prototype.constructor=Sh;function Rh(a,b,c,d){for(var e=0;e<a.length;e++)if(a[e]instanceof Sh){var f=a[e].ia.label;if(null==f||f===d)a[e]=a[e].ia.M?36864|b-e&4095:36864|c-e&4095}}
function Ph(a){if(a instanceof Sh){var b=a.ia.label;if(null!=b)throw"unknown "+(a.ia.M?"continue":"break")+' label "'+b+'"'+T(a.ia.head);throw'unexpected "'+(a.ia.M?"continue":"break")+'" '+T(a.ia.head);}}Jh.prototype.u=function(a){if(0===a.Ra.length)throw(this.M?'"continue"':'"break"')+" outside loop "+T(this.head);Hg(this,a);return[new Sh(a,this)]};function yh(a,b){Fg.call(this,a,3);this.o=b;this.label=null}yh.prototype=Object.create(Fg.prototype);yh.prototype.constructor=yh;
yh.prototype.u=function(a){var b=a.Ka,c=this.o.u(a).concat(16384|a.nc),d=a.getContext();a.ta(this.Oa[0]);var e=!(this.children[0]instanceof zh);e&&(c=c.concat(36864),dg(a,c));a.Ra.push({});for(var f=!1,g=0;g<this.children.length;)if(a.Ka=b+c.length,this.children[g]instanceof zh){for(var h=[],k=!1;g<this.children.length&&this.children[g]instanceof zh;){if(null!=this.children[g].o){var l=this.children[g].o.D(a);if(!(l instanceof sg))throw'non-constant expression in "case" '+T(this.children[g].head);
h.push(l.n)}else k=!0;g++}k?e&&(eg(a,c),e=!1):(1===h.length?(f&&(c=c.concat(36869)),e&&eg(a,c),c=c.concat(12288|a.nc).concat(fh(h[0])).concat(40960|Vf.indexOf("eq"),0)):(f&&(c=c.concat(36864|4*h.length+1)),e&&eg(a,c),h.forEach(function(z,m){c=c.concat(12288|a.nc).concat(fh(z)).concat(40960|Vf.indexOf("ne"),4*(h.length-m)-1)}),c=c.concat(36864)),dg(a,c),e=!0);f=!0}else c=c.concat(this.children[g].u(a)),f=!(this.children[g]instanceof Jh)&&!(this.children[g]instanceof Ih),g++;Rh(c,-1,c.length,this.label);
a.Ra.pop();a.ta(d);return c};function zh(a,b){Fg.call(this,a);this.o=b}zh.prototype=Object.create(Fg.prototype);zh.prototype.constructor=zh;zh.prototype.u=function(){throw(this.o?'"case"':'"default"')+" outside switch "+T(this.head);};function Kh(a,b){Fg.call(this,a);this.label=b}Kh.prototype=Object.create(Fg.prototype);Kh.prototype.constructor=Kh;Kh.prototype.u=function(a){a.label=this.label;Oh(a.labels,this.label).Ig=a.Ka;return[]};function Ah(a,b){Fg.call(this,a);this.label=b}Ah.prototype=Object.create(Fg.prototype);
Ah.prototype.constructor=Ah;function Th(a,b,c){Ig.call(this,a,b);this.labels=c}Th.prototype=Object.create(Ig.prototype);Th.prototype.constructor=Th;Th.prototype.u=function(a){var b=Oh(this.labels,this.ia.label);if(null===b)throw'unknown label "'+this.ia.label+'" '+T(this.ia.head);return 36864|b.Ig-a&4095};Ah.prototype.u=function(a){return[new Th(a,this,a.labels.slice())]};function Hh(a,b){Fg.call(this,a,3);this.Ye=b}Hh.prototype=Object.create(Fg.prototype);Hh.prototype.constructor=Hh;
Hh.prototype.D=function(a){rg(this.children,a);return this};Hh.prototype.u=function(a,b){if(b){b=a.getContext();Hg(this,a);a.ta(this.Oa[0]);var c=pg.prototype.u.call(this,a).concat(0);a.ta(b);return c}return[]};function xh(a,b,c,d){Fg.call(this,a,3);this.yf=b;this.resultType=c;this.B=d}xh.prototype=Object.create(Fg.prototype);xh.prototype.constructor=xh;xh.prototype.rg=function(a){a.za=this.resultType};xh.prototype.D=function(a){rg(this.children,a);return this};
xh.prototype.u=function(a,b){if(b){b=a.getContext();Hg(this,a);a.ta(this.Oa[0]);var c=pg.prototype.u.call(this,a).concat(57344);a.ta(b);return c}return[]};function Ih(a,b){Fg.call(this,a);b&&this.children.push(b)}Ih.prototype=Object.create(Fg.prototype);Ih.prototype.constructor=Ih;
Ih.prototype.Od=function(a){if(a.za===qg)throw'"return" outside function definition '+T(this.head);if("v"===a.za&&0<this.children.length)throw"unexpected return value in void function "+T(this.head);if("v"!==a.za&&0===this.children.length)throw"missing return value in non-void function "+T(this.head);0<this.children.length&&(this.children[0]=ph(this.children[0],a.za,a).D(a))};
Ih.prototype.u=function(a){Hg(this,a);var b=[];0<this.children.length&&(b=this.children[0].u(a).concat(a.yb(this.children[0].resultType,a.za)).concat(16384|a.nc));return b.concat(57344)};var Of=[{name:"abs",Zc:1,ka:function(a,b){return b[0]},we:function(){return!0},Jb:function(a,b,c,d){return[12288|d,28673]}},{name:"atan2",Zc:2,he:1,ka:function(){return vg},we:function(a){return null!=$f(a,"math.atan2")},Jb:function(a,b,c,d){return(c[0]===vg&&c[1]!==vg?[12288|d+1,4096|a.sb,32772,16384|d+1]:c[0]!==vg&&c[1]===vg?[12288|d,4096|a.sb,32772,16384|d]:[]).concat([4097,4096|d+1,4096|d,4096|d+2,49152|$f(b,"math.atan2").id,12288|d+2,4096|Math.floor(32768/(a.sb*Math.PI)),32773])}},{name:"cos",
Zc:1,he:1,ka:function(){return vg},we:function(a){return null!=$f(a,"math.cos")},Jb:function(a,b,c,d){return[12288|d,4096|Math.round(32767/((c[0]===vg?a.sb:1)*Math.PI)),32772,16384|d,4097,4096|d,4096|d+1,49152|$f(b,"math.cos").id,12288|d+1,4096|Math.floor(32768/a.sb),32773]}},kh("rand","math.rand",0),{name:"random",Zc:0,he:1,ka:function(){return vg},we:function(a){return null!=$f(a,"math.rand")},Jb:function(a,b,c,d){return[4097,4096|d,49152|$f(b,"math.rand").id,12288|d,28673,4096|Math.floor(32768/
a.sb),32773]}},{name:"stop",Zc:0,ka:function(){return"v"},Jb:function(){return[0]}},{name:"sin",Zc:1,he:1,ka:function(){return vg},we:function(a){return null!=$f(a,"math.sin")},Jb:function(a,b,c,d){return[12288|d,4096|Math.round(32767/((c[0]===vg?a.sb:1)*Math.PI)),32772,16384|d,4097,4096|d,4096|d+1,49152|$f(b,"math.sin").id,12288|d+1,4096|Math.floor(32768/a.sb),32773]}},{name:"sqrt",Zc:1,he:6,ka:function(){return vg},Jb:function(a,b,c,d){b=fh(c[0]===vg?a.sb:a.sb*a.sb);return[4096|a.sb,16384|d+1,4106,
16384|d+2,12288|d,16384|d+4].concat(b,[16384|d+5,12288|d+1,16384|d+6,4097,4096|d+6,4096|d+5,4096|d+4,4096|d+3,49152|$f(a.qa,"math.muldiv").id,12288|d+3,12288|d+1,32770,4098,32773,16384|d+1,12288|d+2,4097,32771,16384|d+2,12288|d+2,4096,40960|Vf.indexOf("le"),-(23+b.length)&65535,12288|d+1])}}];var ub={name:"thymio-II",maxVarSize:620,variables:[{name:"_id",size:1},{name:"event.source",size:1},{name:"event.args",size:32},{name:"_fwversion",size:2},{name:"_productId",size:1},{name:"buttons._raw",size:5},{name:"button.backward",size:1},{name:"button.left",size:1},{name:"button.center",size:1},{name:"button.forward",size:1},{name:"button.right",size:1},{name:"buttons._mean",size:5},{name:"buttons._noise",size:5},{name:"prox.horizontal",size:7},{name:"prox.comm.rx._payloads",size:7},{name:"prox.comm.rx._intensities",
size:7},{name:"prox.comm.rx",size:1},{name:"prox.comm.tx",size:1},{name:"prox.ground.ambiant",size:2},{name:"prox.ground.reflected",size:2},{name:"prox.ground.delta",size:2},{name:"motor.left.target",size:1},{name:"motor.right.target",size:1},{name:"_vbat",size:2},{name:"_imot",size:2},{name:"motor.left.speed",size:1},{name:"motor.right.speed",size:1},{name:"motor.left.pwm",size:1},{name:"motor.right.pwm",size:1},{name:"acc",size:3},{name:"temperature",size:1},{name:"rc5.address",size:1},{name:"rc5.command",
size:1},{name:"mic.intensity",size:1},{name:"mic.threshold",size:1},{name:"mic._mean",size:1},{name:"timer.period",size:2},{name:"acc._tap",size:1}],localEvents:[{name:"button.backward"},{name:"button.left"},{name:"button.center"},{name:"button.forward"},{name:"button.right"},{name:"buttons"},{name:"prox"},{name:"prox.comm"},{name:"tap"},{name:"acc"},{name:"mic"},{name:"sound.finished"},{name:"temperature"},{name:"rc5"},{name:"motor"},{name:"timer0"},{name:"timer1"}],nativeFunctions:[{name:"_system_reboot",
args:[]},{name:"_system_settings_read",args:[1,1]},{name:"_system_settings_write",args:[1,1]},{name:"_system_settings_flash",args:[]},{name:"math.copy",args:[-1,-1]},{name:"math.fill",args:[-1,1]},{name:"math.addscalar",args:[-1,-1,1]},{name:"math.add",args:[-1,-1,-1]},{name:"math.sub",args:[-1,-1,-1]},{name:"math.mul",args:[-1,-1,-1]},{name:"math.div",args:[-1,-1,-1]},{name:"math.min",args:[-1,-1,-1]},{name:"math.max",args:[-1,-1,-1]},{name:"math.clamp",args:[-1,-1,-1,-1]},{name:"math.dot",args:[1,
-1,-1,1]},{name:"math.stat",args:[-1,1,1,1]},{name:"math.argbounds",args:[-1,1,1]},{name:"math.sort",args:[-1]},{name:"math.muldiv",args:[-1,-1,-1,-1]},{name:"math.atan2",args:[-1,-1,-1]},{name:"math.sin",args:[-1,-1]},{name:"math.cos",args:[-1,-1]},{name:"math.rot2",args:[2,2,1]},{name:"math.sqrt",args:[-1,-1]},{name:"math.rand",args:[-1]},{name:"_leds.set",args:[1,1]},{name:"sound.record",args:[1]},{name:"sound.play",args:[1]},{name:"sound.replay",args:[1]},{name:"sound.system",args:[1]},{name:"leds.circle",
args:[1,1,1,1,1,1,1,1]},{name:"leds.top",args:[1,1,1]},{name:"leds.bottom.left",args:[1,1,1]},{name:"leds.bottom.right",args:[1,1,1]},{name:"sound.freq",args:[1,1]},{name:"leds.buttons",args:[1,1,1,1]},{name:"leds.prox.h",args:[1,1,1,1,1,1,1,1]},{name:"leds.prox.v",args:[1,1]},{name:"leds.rc",args:[1]},{name:"leds.sound",args:[1]},{name:"leds.temperature",args:[1,1]},{name:"sound.wave",args:[142]},{name:"prox.comm.enable",args:[1]},{name:"sd.open",args:[1,1]},{name:"sd.write",args:[-1,1]},{name:"sd.read",
args:[-1,1]},{name:"sd.seek",args:[1,1]},{name:"_rf.nodeid",args:[1]},{name:"_poweroff",args:[]}]};function Qf(a,b){this.qa=a;this.b=b}function Uh(a){var b={};a.qa.Va.forEach(function(c){b[c.name]=c.offset});b._userdata=a.qa.Ma;b._topdata=a.qa.b;a.qa.Lb.forEach(function(c){b["_nf."+c.name]=c.id});return b}
function Pf(a){for(var b=a.b.split("\n"),c=[],d=Uh(a),e=0;2>e;e++){c=[];var f=null;b.forEach(function(g,h){var k=/^\s*(;.*)?$/.exec(g);if(!k)if(k=/^\s*([\w_.]+:)\s*(;.*)?$/i.exec(g))f=k[1].slice(0,-1),d[f]=c.length;else if(k=/^\s*([\w_.]+:)?\s*([a-z0-9.]+)([-+a-z0-9\s._,=]*)(;.*)?$/i.exec(g)){if(k[1]&&(f=k[1].slice(0,-1),d[f]=c.length),g=k[2],k=k[3].trim(),g){var l=0<k.length?k.split(",").map(function(z){return z.trim().split(/\s+/)}):[];l=[].concat.apply([],l);k=Vh[g];if(void 0==k)throw'Unknown instruction "'+
g+'" (line '+(h+1).toString(10)+")";if(-1!==k.Mb&&(k.Mb||0)!=l.length)throw"Wrong number of arguments (line "+(h+1).toString(10)+")";void 0!==k.code?c=c.concat(k.code):k.Fb&&(g=l.map(function(z){/^[a-z]+=/.test(z)&&(z=z.replace(/^[a-z]+=/,""));return/^(0x[0-9a-f]+|[0-9]+)$/i.test(z)?parseInt(z,0):z}),c=c.concat(k.Fb(c.length,g,f,1==e?d:null,h+1)));f&&d[f]!==c.length&&(f=null)}}else throw"Syntax error (line "+(h+1).toString(10)+")";},a)}return c}
function Wh(a,b,c){function d(k){if(null==b)return 0;if(/^(0x[0-9a-f]+|[0-9]+)$/i.test(k))return parseInt(k,0);if(!b.hasOwnProperty(k))throw'Unknown symbol "'+a+'" (line '+c.toString(10)+")";return b[k]}if("string"===typeof a){for(var e=0,f=!1,g=0;g<a.length;){var h=/^(\+|-|[._a-z0-9]+)/i.exec(a.slice(g));if(null==h)throw"Syntax error (line "+c.toString(10)+")";switch(h[0]){case "+":f=!1;break;case "-":f=!0;break;default:e+=f?-d(h[0]):d(h[0])}g+=h[0].length}return e}return a}
var Vh={dc:{Mb:-1,Fb:function(a,b,c,d,e){return b.map(function(f){f=Wh(f,d,e);return f&65535})}},equ:{Mb:1,Fb:function(a,b,c,d,e){if(!c)throw'No label for pseudo-instruction "equ" (line '+e.toString(10)+")";d&&(d[c]=Wh(b[0],d,e));return[]}},stop:{code:[0]},"push.s":{Mb:1,Fb:function(a,b,c,d,e){a=Wh(b[0],d,e);if(4096<=a||4096<-a)throw"Small integer overflow (line "+e.toString(10)+")";return[4096|a&4095]}},push:{Mb:1,Fb:function(a,b,c,d,e){return[8192,Wh(b[0],d,e)&65535]}},load:{Mb:1,Fb:function(a,
b,c,d,e){a=Wh(b[0],d,e);if(0>a||4096<=a)throw"Data address out of range (line "+e.toString(10)+")";return[12288|a&4095]}},store:{Mb:1,Fb:function(a,b,c,d,e){a=Wh(b[0],d,e);if(0>a||4096<=a)throw"Data address out of range (line "+e.toString(10)+")";return[16384|a&4095]}},"load.ind":{Mb:2,Fb:function(a,b,c,d,e){a=Wh(b[0],d,e);if(0>a||4096<=a)throw"Data address out of range (line "+e.toString(10)+")";b=Wh(b[1],d,e);return[20480|a&4095,b&65535]}},"store.ind":{Mb:2,Fb:function(a,b,c,d,e){a=Wh(b[0],d,e);
if(0>a||4096<=a)throw"Data address out of range (line "+e.toString(10)+")";b=Wh(b[1],d,e);return[24576|a&4095,b&65535]}},neg:{code:[28672]},abs:{code:[28673]},bitnot:{code:[28674]},not:{Fb:function(a,b,c,d,e){throw"Unary not not implemented in the VM (line "+e.toString(10)+")";}},sl:{code:[32768]},asr:{code:[32769]},add:{code:[32770]},sub:{code:[32771]},mult:{code:[32772]},div:{code:[32773]},mod:{code:[32774]},bitor:{code:[32775]},bitxor:{code:[32776]},bitand:{code:[32777]},eq:{code:[32778]},ne:{code:[32779]},
gt:{code:[32780]},ge:{code:[32781]},lt:{code:[32782]},le:{code:[32783]},or:{code:[32784]},and:{code:[32785]},jump:{Mb:1,Fb:function(a,b,c,d,e){return[36864|Wh(b[0],d,e)-a&4095]}},"jump.if.not":{Mb:2,Fb:function(a,b,c,d,e){c=Vh[b[0]];if(void 0==c||void 0==c.code||1!==c.code.length||32768!==(c.code[0]&61440))throw'Unknown op "'+b[0]+'" for jump.if.not (line '+e.toString(10)+")";b=Wh(b[1],d,e);return[40960|c.code[0]&255,b-a&65535]}},"do.jump.when.not":{Mb:2,Fb:function(a,b,c,d,e){c=Vh[b[0]];if(void 0==
c||void 0==c.code||1!==c.code.length||32768!==(c.code[0]&61440))throw'Unknown op "'+b[0]+'" for do.jump.when.not (line '+e.toString(10)+")";b=Wh(b[1],d,e);return[41216|c.code[0]&255,b-a&65535]}},"do.jump.always":{Mb:2,Fb:function(a,b,c,d,e){c=Vh[b[0]];if(void 0==c||void 0==c.code||1!==c.code.length||32768!==(c.code[0]&61440))throw'Unknown op "'+b[0]+'" for do.jump.always (line '+e.toString(10)+")";b=Wh(b[1],d,e);return[41728|c.code[0]&255,b-a&65535]}},emit:{Mb:3,Fb:function(a,b,c,d,e){a=Wh(b[0],d,
e);if(0>a||4096<=a)throw"Event id out of range (line "+e.toString(10)+")";c=Wh(b[1],d,e);b=Wh(b[2],d,e);return[45056|a&4095,c&65535,b&65535]}},callnat:{Mb:1,Fb:function(a,b,c,d,e){a=Wh(b[0],d,e);if(0>a||4096<=a)throw"Native call id out of range (line "+e.toString(10)+")";return[49152|a&4095]}},callsub:{Mb:1,Fb:function(a,b,c,d,e){a=Wh(b[0],d,e);if(0>a||4096<=a)throw"Subroutine address out of range (line "+e.toString(10)+")";return[53248|a&4095]}},ret:{code:[57344]}};function Xh(a,b,c){this.id=a;this.o=b;if(c instanceof ArrayBuffer)this.g=c;else if(c){for(a=b=0;a<c.length;a++)b="string"===typeof c[a]?b+(1+c[a].length):b+2;b=new ArrayBuffer(b);for(var d=new DataView(b),e=a=0;a<c.length;a++)if("string"===typeof c[a]){d.setUint8(e++,c[a].length);for(var f=0;f<c[a].length;f++)d.setUint8(e++,c[a].charCodeAt(f))}else 32768>c[a]?d.setInt16(e,c[a],!0):d.setUint16(e,c[a],!0),e+=2;this.g=b}else this.g=new ArrayBuffer(0)}
function Yh(a){function b(g){for(var h=[],k=0,l=0;l<g.length;l++)if(g[l]){for(var z=c.getUint8(k),m="",x=0;x<z;x++)m+=String.fromCharCode(c.getUint8(k+1+x));h.push(m);k+=1+z}else h.push(c.getUint16(k,!0)),k+=2;return h}var c=new DataView(a.g);switch(a.id){case Zh:var d=b([!0,!1,!1,!1,!1,!1,!1,!1]);a.nodeName=d[0];a.Zd=d[2];a.me=d[3];a.Bd=d[4];break;case $h:d=b([!1,!0]);a.Ma=d[0];a.P=d[1];break;case ai:d=b([!0,!0]);break;case bi:var e=[!0,!0,!1];d=b(e);a.functionName=d[0];a.w=d[2];for(var f=0;f<a.w;f++)e.push(!1),
e.push(!0);d=b(e);a.ea=[];for(f=0;f<a.w;f++)a.ea.push({size:d[3+2*f]-(d[3+2*f]&32768?65536:0),name:d[4+2*f]});break;case ci:c.getUint16(0,!0);a.Cc=[];for(f=2;f<c.byteLength;f+=2)a.Cc.push(c.getUint16(f,!0));break;case di:a.b=c.getUint16(0,!0);f=c.getUint16(2,!0);a.flags={flags:f,kh:0!==(f&1),ph:0!==(f&2),lh:0!==(f&4)};break;case ei:a.b=c.getUint16(2,!0);a.result=c.getUint16(4,!0);break;case fi:a.l=c.getUint16(0,!0);c.getUint16(2,!0);d=[];for(f=4;f<c.byteLength;f+=2)d.push(c.getUint16(f,!0));a.Ed=
d;break;case gi:case hi:case ii:case ji:case ki:case li:case mi:a.l=c.getUint16(0,!0);break;case ni:case oi:a.l=c.getUint16(0,!0);a.b=c.getUint16(2,!0);break;case pi:a.l=c.getUint16(0,!0);c.getUint16(2,!0);c.getUint16(4,!0);break;case qi:a.l=c.getUint16(0,!0);c.getUint16(2,!0);d=[];for(f=4;f<c.byteLength;f+=2)d.push(c.getUint16(f,!0));break;case ri:a.version=c.getUint16(0,!0)}}
function si(a){var b=new ArrayBuffer(6+a.g.byteLength),c=new DataView(b);c.setUint16(0,a.g.byteLength,!0);c.setUint16(2,a.o,!0);c.setUint16(4,a.id,!0);(new Uint8Array(b)).set(new Uint8Array(a.g),6);return b}Xh.prototype.pb=function(){var a=new Xh(this.id,this.o,this.g);Yh(a);return a};Xh.prototype.toString=function(){var a=ti[this.id]||"0x"+this.id.toString(16);a+=" from "+this.o.toString(10);0<=this.l&&(a+=" to "+this.l.toString());return a};
var Zh=36864,$h=36865,ai=36866,bi=36867,ci=36869,di=36874,ei=36875,fi=40961,hi=40962,ii=40963,ji=40964,ki=40965,li=40966,mi=40967,ni=40968,oi=40969,gi=40970,pi=40971,qi=40972,ri=40977,ti={36864:"description",36865:"namedVariableDescription",36866:"localEventDescription",36867:"nativeFunctionDescription",36869:"variables",36874:"executionStateChanged",36876:"nodePresent",40960:"getDescription",40961:"setBytecode",40962:"reset",40963:"run",40964:"pause",40965:"step",40966:"stop",40967:"getExecutionState",
40968:"breakpointSet",40969:"breakpointClear",40970:"breakpointClearAll",40971:"getVariables",40972:"setVariables",40976:"getNodeDescription",40977:"listNodes"};function ui(a){this.Md=a&&a.Md||54321;this.Va=a&&a.Va||[];this.Kd=a&&a.Kd||[];this.Lb=a&&a.Lb||[];this.Zd=a&&a.Zd||500;this.me=a&&a.me||200;this.Bd=a&&a.Bd||200;a=[];for(var b=0,c=0;c<this.Va.length;c++)this.Va[c].offset=b,a=a.concat(this.Va[c].S),b+=this.Va[c].S.length;for(;a.length<this.Bd;)a.push(0);this.Cc=a;this.K=[];this.b=0;this.g=!1;this.l=!0;this.o=!1;this.stack=[];this.P=[];this.write=this.w=this.M=null}
ui.prototype.pb=function(){var a=new ui({Md:this.Md,Va:this.Va,Kd:this.Kd,Lb:this.Lb,Zd:this.Zd,me:this.me,Bd:this.Bd});a.Zd=this.Zd;a.me=this.me;a.Bd=this.Bd;a.K=this.K.slice();a.b=this.b;a.g=this.g;a.l=this.l;a.o=this.o;a.stack=this.stack.slice();a.P=this.P.slice();return a};
function vi(a,b,c){if(a.M)for(var d=0;d<a.Va.length;d++)if(a.Va[d].offset+a.Va[d].S.length>b&&a.Va[d].offset<b+c.length)for(var e=0;e<a.Va[d].S.length;e++)0<=a.Va[d].offset+e-b&&a.Va[d].offset+e-b<c.length&&a.M(a.Va[d].name,e,c[a.Va[d].offset+e-b],a.Cc[a.Va[d].offset+e]);c.forEach(function(f,g){this.Cc[b+g]=f},a)}function wi(a,b){a:{if(0<a.K.length)for(var c=1;c<a.K[0];c+=2)if(a.K[c]==b){b=a.K[c+1];break a}b=null}null!==b&&(a.g&&(c=new Xh(36872,a.Md,[a.b]),a.write&&a.write(si(c))),a.b=b,a.g=!0)}
function xi(a){a.g=!1;a.l=!0;a.o=!1;if(0<a.K.length)for(var b=a.K[0];b<a.K.length;){var c=a.K[b];10==c>>>12&&(a.K[b]&=-513);b+=[1,1,2,1,1,2,2,1,1,1,2,3,1,1,1,1][c>>>12]}a.stack=[];for(b=0;b<a.Cc.length;b++)a.Cc[b]=0;a.ha&&a.ha();wi(a,65535)}
function yi(a){function b(m){return 32768<=m?m-65536:m}function c(m){switch(m){case 28672:d.stack.push(-d.stack.pop());break;case 28673:d.stack.push(Math.abs(d.stack.pop()));break;case 28674:d.stack.push(~d.stack.pop());break;case 32768:m=d.stack.pop();d.stack.push(b(d.stack.pop()<<m&65535));break;case 32769:m=d.stack.pop();d.stack.push(d.stack.pop()>>m);break;case 32770:d.stack.push(b(d.stack.pop()+d.stack.pop()&65535));break;case 32771:m=d.stack.pop();d.stack.push(b(d.stack.pop()-m&65535));break;
case 32772:d.stack.push(b(d.stack.pop()*d.stack.pop()&65535));break;case 32773:m=d.stack.pop();d.stack.push(b(Math.trunc(d.stack.pop()/m)&65535));break;case 32774:m=d.stack.pop();d.stack.push(b(d.stack.pop()%m&65535));break;case 32775:d.stack.push(b((d.stack.pop()|d.stack.pop())&65535));break;case 32776:d.stack.push(b((d.stack.pop()^d.stack.pop())&65535));break;case 32777:d.stack.push(b(d.stack.pop()&d.stack.pop()&65535));break;case 32778:d.stack.push(d.stack.pop()===d.stack.pop()?1:0);break;case 32779:d.stack.push(d.stack.pop()!==
d.stack.pop()?1:0);break;case 32780:m=d.stack.pop();d.stack.push(d.stack.pop()>m?1:0);break;case 32781:m=d.stack.pop();d.stack.push(d.stack.pop()>=m?1:0);break;case 32782:m=d.stack.pop();d.stack.push(d.stack.pop()<m?1:0);break;case 32783:m=d.stack.pop();d.stack.push(d.stack.pop()<=m?1:0);break;case 32784:m=d.stack.pop();d.stack.push(d.stack.pop()||m?1:0);break;case 32785:m=d.stack.pop();d.stack.push(d.stack.pop()&&m?1:0);break;default:throw"unknown op 0x"+m.toString(16);}}var d=a,e=a.K[a.b],f=e&4095;
switch(e>>>12){case 0:a.g=!1;break;case 1:a.stack.push(2048<=f?f-4096:f);break;case 2:a.b++;a.stack.push(b(a.K[a.b]));break;case 3:a.stack.push(a.Cc[f]);break;case 4:vi(a,f,[a.stack.pop()]);break;case 5:a.b++;e=a.K[a.b];var g=a.stack.pop();if(g>=e)throw"out of bounds";a.stack.push(a.Cc[f+g]);break;case 6:a.b++;e=a.K[a.b];g=a.stack.pop();if(g>=e)throw"Index out of bounds";vi(a,f+g,[a.stack.pop()]);break;case 9:a.b+=(2048<=f?f-4096:f)-1;break;case 10:var h=e&256;c(32768|e&255);f=0!=a.stack.pop();a.b++;
g=b(a.K[a.b]);if(h){h=a.b-1;if(e&512||!f)a.b+=g-2;a.K[h]=f?a.K[h]|512:a.K[h]&-513}else f||(a.b+=g-2);break;case 11:null(f);break;case 12:if(0>f||f>=a.Lb.length)throw"Native call index out of bounds";var k=a.Lb[f].ea.map(function(){return{p:this.stack.pop()}},a),l=[];a.Lb[f].ea.forEach(function(m,x){k[x].Ag=0===m.size?this.stack.pop():m.size},a);a.Lb[f].ea.forEach(function(m){0>m.size&&void 0===l[-m.size]&&(l[-m.size]=0)},a);l=l.map(function(m){return void 0!==m?this.stack.pop():m},a);a.Lb[f].ea.forEach(function(m,
x){0>m.size&&(k[x].Ag=l[-m.size])},a);var z=k.map(function(m){return this.Cc.slice(m.p,m.p+m.Ag)},a);e=!1;a.w&&(e=a.w(a.Lb[f].name,a,z));e||a.Lb[f].Ba(a,z);k.forEach(function(m,x){vi(this,m.p,z[x])},a);break;case 13:a.stack.push(a.b+1);a.b=f-1;break;case 14:a.b=a.stack.pop()-1;break;case 15:throw"op 0x"+e.toString(16)+" (reserved) not implemented";default:c(e)}a.b++}ui.prototype.Zb=function(){for(;this.g&&(yi(this),!this.l););};function zi(a){function b(c){c&=65535;return 32768<=c?c-65536:c}ui.call(this,{Md:a,Va:[{name:"_id",S:[0]},{name:"event.source",S:[0]},{name:"event.args",S:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{name:"_fwversion",S:[0,0]},{name:"_productId",S:[0]},{name:"buttons._raw",S:[0,0,0,0,0]},{name:"button.backward",S:[0]},{name:"button.left",S:[0]},{name:"button.center",S:[0]},{name:"button.forward",S:[0]},{name:"button.right",S:[0]},{name:"buttons._mean",S:[0,0,0,0,0]},{name:"buttons._noise",
S:[0,0,0,0,0]},{name:"prox.horizontal",S:[0,0,0,0,0,0,0]},{name:"prox.comm.rx._payloads",S:[0,0,0,0,0,0,0]},{name:"prox.comm.rx._intensities",S:[0,0,0,0,0,0,0]},{name:"prox.comm.rx",S:[0]},{name:"prox.comm.tx",S:[0]},{name:"prox.ground.ambiant",S:[0,0]},{name:"prox.ground.reflected",S:[0,0]},{name:"prox.ground.delta",S:[0,0]},{name:"motor.left.target",S:[0]},{name:"motor.right.target",S:[0]},{name:"_vbat",S:[0,0]},{name:"_imot",S:[0,0]},{name:"motor.left.speed",S:[0]},{name:"motor.right.speed",S:[0]},
{name:"motor.left.pwm",S:[0]},{name:"motor.right.pwm",S:[0]},{name:"acc",S:[0,0,0]},{name:"temperature",S:[0]},{name:"rc5.address",S:[0]},{name:"rc5.command",S:[0]},{name:"mic.intensity",S:[0]},{name:"mic.threshold",S:[0]},{name:"mic._mean",S:[0]},{name:"timer.period",S:[0,0]},{name:"acc._tap",S:[0]},{name:"sd.present",S:[0]}],Kd:[{name:"button.backward",description:"Backward button state changed"},{name:"button.left",description:"Left button state changed"},{name:"button.center",description:"Center button state changed"},
{name:"button.forward",description:"Forward button state changed"},{name:"button.right",description:"Right button state changed"},{name:"buttons",description:"Buttons values updated"},{name:"prox",description:"Proximity values updated"},{name:"prox.comm",description:"Data received on the proximity communication"},{name:"tap",description:"Tap detected"},{name:"acc",description:"Accelerometer values updated"},{name:"mic",description:"Microphone above threshold"},{name:"sound.finished",description:"Sound playback finished"},
{name:"temperature",description:"Temperature value updated"},{name:"rc5",description:"RC5 message received"},{name:"motor",description:"Motor timer"},{name:"timer0",description:"Timer 0"},{name:"timer1",description:"Timer 1"}],Lb:[{name:"_system_reboot",ea:[],Ba:function(){}},{name:"_system_settings_read",ea:[],Ba:function(){}},{name:"_system_settings_write",ea:[],Ba:function(){}},{name:"_system_settings_flash",ea:[],Ba:function(){}},{name:"math.copy",ea:[],Ba:function(c,d){for(c=0;c<d[0].length;c++)d[0][c]=
d[1][c]}},{name:"math.fill",ea:[],Ba:function(c,d){for(c=0;c<d[0].length;c++)d[0][c]=d[1][0]}},{name:"math.addscalar",ea:[{name:"r",size:-1},{name:"a",size:-1},{name:"b",size:1}],Ba:function(c,d){for(c=0;c<d[0].length;c++)d[0][c]=b(d[1][c]+d[2][0])}},{name:"math.add",ea:[{name:"r",size:-1},{name:"a",size:-1},{name:"b",size:-1}],Ba:function(c,d){for(c=0;c<d[0].length;c++)d[0][c]=b(d[1][c]+d[2][c])}},{name:"math.sub",ea:[{name:"r",size:-1},{name:"a",size:-1},{name:"b",size:-1}],Ba:function(c,d){for(c=
0;c<d[0].length;c++)d[0][c]=b(d[1][c]-d[2][c])}},{name:"math.mul",ea:[{name:"r",size:-1},{name:"a",size:-1},{name:"b",size:-1}],Ba:function(c,d){for(c=0;c<d[0].length;c++)d[0][c]=b(d[1][c]*d[2][c])}},{name:"math.div",ea:[{name:"r",size:-1},{name:"a",size:-1},{name:"b",size:-1}],Ba:function(c,d){for(c=0;c<d[0].length;c++)d[0][c]=b(Math.trunc(d[1][c]/d[2][c]))}},{name:"math.min",ea:[{name:"r",size:-1},{name:"a",size:-1},{name:"b",size:-1}],Ba:function(c,d){for(c=0;c<d[0].length;c++)d[0][c]=Math.min(d[1][c],
d[2][c])}},{name:"math.max",ea:[{name:"r",size:-1},{name:"a",size:-1},{name:"b",size:-1}],Ba:function(c,d){for(c=0;c<d[0].length;c++)d[0][c]=Math.max(d[1][c],d[2][c])}},{name:"math.clamp",ea:[{name:"r",size:-1},{name:"x",size:-1},{name:"low",size:-1},{name:"high",size:-1}],Ba:function(c,d){for(c=0;c<d[0].length;c++)d[0][c]=Math.min(Math.max(d[1][c],d[2][c]),d[3][c])}},{name:"math.dot",ea:[{name:"r",size:-1},{name:"a",size:-1},{name:"b",size:-1},{name:"shift",size:1}],Ba:function(c,d){for(var e=c=
0;e<d[0].length;e++)c+=d[1][e]*d[2][e];d[0][0]=c/Math.pow(2,d[3][0])}},{name:"math.stat",ea:[{name:"x",size:-1},{name:"min",size:1},{name:"max",size:1},{name:"mean",size:1}],Ba:function(c,d){c=0;d[1][0]=32767;d[2][0]=-32768;for(var e=0;e<d[0].length;e++)d[1][0]=Math.min(d[1][0],d[0][e]),d[2][0]=Math.max(d[2][0],d[0][e]),c+=d[0][e];d[3][0]=c/d[0].length}},{name:"math.argbounds",ea:[{name:"x",size:-1},{name:"argmin",size:1},{name:"argmax",size:1}],Ba:function(c,d){c=-Infinity;for(var e=Infinity,f=0;f<
d[0].length;f++)d[0][f]<e&&(e=d[0][f],d[1][0]=f),d[0][f]>c&&(c=d[0][f],d[2][0]=f)}},{name:"math.sort",ea:[{name:"x",size:-1}],Ba:function(c,d){d[0].sort(function(e,f){return e-f})}},{name:"math.muldiv",ea:[{name:"r",size:-1},{name:"a",size:-1},{name:"b",size:-1},{name:"c",size:-1}],Ba:function(c,d){for(c=0;c<d[0].length;c++)d[0][c]=b(d[1][c]*d[2][c]/d[3][c])}},{name:"math.atan2",description:"Atan2",ea:[{name:"r",size:-1},{name:"y",size:-1},{name:"x",size:-1}],Ba:function(c,d){d[2].forEach(function(e,
f){d[0][f]=Math.round(32767*Math.atan2(d[1][f],e)/Math.PI)})}},{name:"math.sin",description:"Sine",ea:[{name:"r",size:-1},{name:"theta",size:-1}],Ba:function(c,d){d[1].forEach(function(e,f){d[0][f]=Math.round(32767*Math.sin(e*Math.PI/32768))})}},{name:"math.cos",description:"Cosine",ea:[{name:"r",size:-1},{name:"theta",size:-1}],Ba:function(c,d){d[1].forEach(function(e,f){d[0][f]=Math.round(32767*Math.cos(e*Math.PI/32768))})}},{name:"math.rot2",ea:[{name:"r",size:2},{name:"v",size:2},{name:"theta",
size:1}]},{name:"math.sqrt",description:"Square root",ea:[{name:"r",size:-1},{name:"x",size:-1}],Ba:function(c,d){d[1].forEach(function(e,f){d[0][f]=0<e?Math.floor(Math.sqrt(e)):0})}},{name:"math.rand",description:"Pseudo-random number",ea:[{name:"r",size:-1}],Ba:function(c,d){for(c=0;c<d[0].length;c++)d[0][c]=Math.floor(65535.9999*Math.random())-32768}},{name:"_leds.set",ea:[{name:"led",size:1},{name:"br",size:1}],Ba:function(){}},{name:"sound.record",ea:[{name:"n",size:1}],Ba:function(){}},{name:"sound.play",
ea:[{name:"n",size:1}],Ba:function(){}},{name:"sound.replay",ea:[{name:"n",size:1}],Ba:function(){}},{name:"sound.system",description:"Start playing system sound",ea:[{name:"n",size:1}],Ba:function(){}},{name:"leds.circle",description:"Set circular leds",ea:[{name:"l0",size:1},{name:"l1",size:1},{name:"l2",size:1},{name:"l3",size:1},{name:"l4",size:1},{name:"l5",size:1},{name:"l6",size:1},{name:"l7",size:1}],Ba:function(c,d){c.state["leds.circle"]=d.map(function(e){return e[0]});c.$c&&c.$c("leds.circle")}},
{name:"leds.top",description:"Set top RGB led",ea:[{name:"r",size:1},{name:"g",size:1},{name:"b",size:1}],Ba:function(c,d){c.state["leds.top"]=d.map(function(e){return e[0]});c.$c&&c.$c("leds.top")}},{name:"leds.bottom.left",description:"Set bottom-left RGB led",ea:[{name:"r",size:1},{name:"g",size:1},{name:"b",size:1}],Ba:function(c,d){c.state["leds.bottom.left"]=d.map(function(e){return e[0]});c.$c&&c.$c("leds.bottom.left")}},{name:"leds.bottom.right",description:"Set bottom-right RGB led",ea:[{name:"r",
size:1},{name:"g",size:1},{name:"b",size:1}],Ba:function(c,d){c.state["leds.bottom.right"]=d.map(function(e){return e[0]});c.$c&&c.$c("leds.bottom.right")}},{name:"sound.freq",description:"Play frequency",ea:[{name:"Hz",size:1},{name:"ds",size:1}],Ba:function(c,d){console.info(d)}},{name:"leds.buttons",description:"Set buttons leds",ea:[{name:"led 0",size:1},{name:"led 1",size:1},{name:"led 2",size:1},{name:"led 3",size:1}]},{name:"leds.prox.h",description:"Set horizontal proximity leds",ea:[{name:"led 0",
size:1},{name:"led 1",size:1},{name:"led 2",size:1},{name:"led 3",size:1},{name:"led 4",size:1},{name:"led 5",size:1},{name:"led 6",size:1},{name:"led 7",size:1}]},{name:"leds.prox.v",description:"Set vertical proximity leds",ea:[{name:"led 0",size:1},{name:"led 1",size:1}]},{name:"leds.rc",description:"Set rc led",ea:[{name:"led",size:1}]},{name:"leds.sound",description:"Set sound led",ea:[{name:"led",size:1}]},{name:"leds.temperature",description:"Set ntc led",ea:[{name:"red",size:1},{name:"blue",
size:1}]},{name:"sound.wave",description:"Set the primary wave of the tone generator",ea:[{name:"wave",size:142}],Ba:function(){}},{name:"prox.comm.enable",description:"Enable or disable the proximity communication",ea:[{name:"state",size:1}]},{name:"sd.open",description:"Open a file on the SD card",ea:[{name:"number",size:1},{name:"status",size:1}]},{name:"sd.write",description:"Write data to the opened file",ea:[{name:"data",size:-1},{name:"written",size:1}]},{name:"sd.read",description:"Read data from the opened file",
ea:[{name:"data",size:-1},{name:"read",size:1}]},{name:"sd.seek",description:"Seek the opened file",ea:[{name:"position",size:1},{name:"status",size:1}]},{name:"_rf.nodeid"},{name:"_poweroff"}],Bd:620});this.state={};this.$c=null}zi.prototype=Object.create(ui.prototype);zi.prototype.constructor=zi;function Ai(){Tf.call(this);this.Xb=!0;this.l=new zi(9999);var a=this;this.l.$c=function(b){a.ha[b]&&a.ha[b](b,a.l.state[b])};this.l.M=function(b,c,d){switch(b){case "timer.period":a.setTimer(c,.001*d,!0)}};this.l.w=function(b,c,d){switch(b){case "sound.play":return a.ha.sound("sound",{pcm:d[0][0]}),!0}return!1};this.qa=new tb(ub)}Ai.prototype=Object.create(Tf.prototype);Ai.prototype.constructor=Ai;Ai.prototype.reset=function(a){Tf.prototype.reset.call(this,a);xi(this.l)};
function Bi(a,b){b=ag(a.qa,b);return null==b?null:a.l.Cc.slice(b.offset,b.offset+b.size)}function Ci(a,b,c){var d=ag(a.qa,b);if(null==d)throw"Unknown VM variable "+b;if(c.length!==d.size)throw"Bad size for variable "+b;Array.prototype.splice.apply(a.l.Cc,[d.offset,d.size].concat(c))}
Ai.prototype.set=function(a,b){if(this.Xb){Tf.prototype.set.call(this,a,b);switch(a){case "button.backward":case "button.left":case "button.center":case "button.forward":case "button.right":Ci(this,a,[b?1:0]);break;case "prox.ground.delta":Ci(this,"prox.ground.delta",b.map(function(c){return 2E3*c}));break;case "prox.horizontal":Ci(this,"prox.horizontal",b.map(function(c){return 4E3*c}));break;case "acc":Ci(this,"acc",b.map(function(c){return 22*c}));break;default:throw"Unknown variable "+a;}this.ha[a]&&
this.ha[a](a,b)}else Tf.prototype.set.call(this,a,b)};
Ai.prototype.get=function(a){if(this.Xb)switch(a){case "leds.top":return(this.l.state&&this.l.state["leds.top"]||[0,0,0]).map(function(b){return 32<=b?1:0>=b?0:b/32});case "leds.bottom.left":return(this.l.state&&this.l.state["leds.bottom.left"]||[0,0,0]).map(function(b){return 32<=b?1:0>=b?0:b/32});case "leds.bottom.right":return(this.l.state&&this.l.state["leds.bottom.right"]||[0,0,0]).map(function(b){return 32<=b?1:0>=b?0:b/32});case "leds.circle":return(this.l.state&&this.l.state["leds.circle"]||
[0,0,0,0,0,0,0,0]).map(function(b){return 16<=b?1:0});case "motor.left":return Bi(this,"motor.left.target")[0]/200;case "motor.right":return Bi(this,"motor.right.target")[0]/200;default:return Tf.prototype.get.call(this,a)}else return Tf.prototype.get.call(this,a)};Ai.prototype.sendEvent=function(a,b){if(this.Xb){if(null!=b)throw"Event arguments not implemented";a=bg(this.qa,a);wi(this.l,a);Di(this)}else Tf.prototype.sendEvent.call(this,a,b)};
Ai.prototype.loadCode=function(a,b){"js"===a?(Tf.prototype.loadCode.call(this,a,b),this.Xb=!1):("asm"===a?(b=new Qf(this.qa,b),b=Pf(b)):(b=(a=Qh(b))?new Nf(this.qa,b):new vb(this.qa,b),b.ha=a?Of:wb,b=xb(b)),a=this.l,a.K.splice.apply(a.K,[0,b.length].concat(b)),xi(this.l),Di(this),this.Xb=!0)};function Di(a){for(var b=0;2E3>b&&a.l.g;b++)yi(a.l)};function Kf(a,b){a.b=new Ib(a.Ra,{ba:a.ba});a.b.Ra=function(){null!==a.l&&(a.l=null,Ei(a))};var c=null;return new vf({Zb:function(d,e){var f=a.F;f.X.loadCode(d,e);null!==c&&clearInterval(c);f.X.start(Fi());c=setInterval(function(){f.X.run(Fi(),function(g,h){Gi(f,g,h)})},10);f.X.qc=f.paused;Ei(a)},Ic:function(){var d=new Ai;d=new Hi(a.b,d);b&&b.bg&&Pd(a.b,b.bg);b&&b.cg&&(a.b.transform=b.cg);a.F=d},Jd:function(){return"Simulator"},wd:"js",languages:["js","aseba","l2","asm"]})};function Ii(){this.b=[]}Ii.prototype.add=function(a){this.b.push(a)};Ii.prototype.H=function(a){this.b.forEach(function(b){b.H(a)})};function Ji(){}Ji.prototype.b=function(){throw"internal";};Ji.prototype.H=function(){};function Ki(a,b,c){this.x=a;this.y=b;this.g=c}Ki.prototype=Object.create(Ji.prototype);Ki.prototype.constructor=Ki;
Ki.prototype.b=function(a,b,c){function d(h,k,l,z,m,x,n){l=[Math.cos(l),x-z,Math.sin(l),n-m];h=[x-h,n-k];k=l[0]*l[3]-l[1]*l[2];h=[(l[3]*h[0]-l[1]*h[1])/k,(l[0]*h[1]-l[2]*h[0])/k];return 0<=h[1]&&1>=h[1]&&0<h[0]?h[0]:Infinity}for(var e=Infinity,f=this.x.length,g=0;g<(this.g?this.x.length:this.x.length-1);g++)e=Math.min(e,d(a,b,c,this.x[g],this.y[g],this.x[(g+1)%f],this.y[(g+1)%f]));return e};
Ki.prototype.H=function(a){a.save();a.beginPath();a.moveTo(this.x[0],this.y[0]);for(var b=1;b<this.x.length;b++)a.lineTo(this.x[b],this.y[b]);this.g&&a.closePath();a.stroke();a.restore()};function Li(a,b,c){this.x=a;this.y=b;this.r=c}Li.prototype=Object.create(Ji.prototype);Li.prototype.constructor=Li;
Li.prototype.b=function(a,b,c){var d=(this.x-a)*Math.cos(c)+(this.y-b)*Math.sin(c);a=(a-this.x)*Math.sin(c)+(this.y-b)*Math.cos(c);a=this.r*this.r-a*a;if(0>a)return Infinity;a=Math.sqrt(a);return 0>d+a?Infinity:0>d-a?d+a:d-a};Li.prototype.H=function(a){a.save();a.beginPath();a.arc(this.x,this.y,this.r,0,2*Math.PI);a.stroke();a.restore()};function Mi(a,b){this.width=a;this.height=b}
function Hi(a,b){var c=this;this.ya=new Ia;this.X=b;this.M=this.jf=this.paused=this.ke=!1;this.kc=Ni;this.b=new Mi(10*this.X.yb,7.07*this.X.yb);b=this.X.yb;this.X.setPositionLimits(-this.b.width/2+b,this.b.width/2-b,-this.b.height/2+b,this.b.height/2-b);this.Ue=this.Yb=null;this.g=document.createElement("canvas");this.Af=!1;this.Ve=this.zb=null;this.l=document.createElement("canvas");this.o=new Ii;this.ee=!1;this.We=this.P=null;Oi(this);this.X.gb=function(){Pi(c);Qi(c);Ri(c)};this.w=a;this.w.state=
{};this.ha=!1}var Ni="ground";Hi.prototype.je=function(){this.ya.b=[]};function Rf(a){var b="teacher"===bb("role");a.Ob=b}function Si(a){var b=a.F;if(b.Yb){b.g.width=b.Yb.width;b.g.height=b.Yb.height;var c=b.g.getContext("2d");c.fillStyle="white";c.fillRect(0,0,b.Yb.width,b.Yb.height);c.drawImage(b.Yb,0,0,b.Yb.width,b.Yb.height)}else b.g.width=b.w?b.w.width:800,b.g.height=b.g.width*b.b.height/b.b.width,c=b.g.getContext("2d"),c.fillStyle="white",c.fillRect(0,0,b.g.width,b.g.height);b.Af=!1;Sb(a)}
function Gi(a,b,c){if(a.jf){var d=a.g.getContext("2d");d.save();d.translate(a.g.width/2,a.g.height/2);d.scale(a.g.width/a.b.width,-a.g.height/a.b.height);d.beginPath();switch(b){case "l":d.moveTo(c[0],c[1]);d.lineTo(c[2],c[3]);break;case "a":d.arc(c[0],c[1],Math.abs(c[2]),c[3],c[4],0>c[2])}d.strokeStyle="#060";d.lineCap="round";d.lineWidth=.1*a.X.yb;d.stroke();d.restore();a.Af=!0}}
function Oi(a){a.o.b=[];a.o.add(new Ki([-a.b.width/2,a.b.width/2,a.b.width/2,-a.b.width/2],[-a.b.height/2,-a.b.height/2,a.b.height/2,a.b.height/2],!0))}
function Ti(a,b){var c=a.F;Oi(c);if(c.P=b){var d=new ue(b),e=c.b.width/d.Ca[2],f=-c.b.width*(.5+d.Ca[0]/d.Ca[2]),g=-c.b.height/d.Ca[3],h=c.b.height*(.5+d.Ca[1]/d.Ca[3]);d.H(null,{wa:{line:function(k,l,z){c.o.add(new Ki(k.map(function(m){return f+e*m}),l.map(function(m){return h+g*m}),z))},Re:function(k,l,z){c.o.add(new Li(f+e*k,h+g*l,(e-g)/2*z))}}})}c.ee=null!=b;Qi(c);Sb(a)}
function Ui(a,b,c){b=Math.round(a.g.width*(b+a.b.width/2)/a.b.width);c=Math.round(a.g.height*(a.b.height/2-c)/a.b.height);return a.g.getContext("2d").getImageData(b,c,1,1).data[0]/255}function Vi(a,b,c){if(null==a.zb)return 0;b=Math.round(a.l.width*(b+a.b.width/2)/a.b.width);c=Math.round(a.l.height*(a.b.height/2-c)/a.b.height);a=a.l.getContext("2d").getImageData(b,c,1,1).data;return-(a[0]+a[1]+a[2])/765}
function Pi(a){for(var b=[],c=0;2>c;c++)b.push(Ui(a,a.X.b[0]+a.X.Sc*Math.cos(a.X.g)+(0===c?-1:1)*a.X.Vd*Math.sin(a.X.g),a.X.b[1]+a.X.Sc*Math.sin(a.X.g)-(0===c?-1:1)*a.X.Vd*Math.cos(a.X.g))+Uf(a.X,.05));a.X.set("prox.ground.delta",b)}
function Qi(a){var b=Math.cos(a.X.g),c=Math.sin(a.X.g),d=[{ud:70,td:60,bb:.7},{ud:85,td:30,bb:.35},{ud:95,td:0,bb:0},{ud:85,td:-30,bb:-.35},{ud:70,td:-60,bb:-.7},{ud:-25,td:35,bb:2.8},{ud:-25,td:-35,bb:-2.8}].map(function(e){var f=this.o,g=this.X.b[0]+e.ud*b-e.td*c,h=this.X.b[1]+e.ud*c+e.td*b;e=this.X.g+e.bb;for(var k=Infinity,l=0;l<f.b.length;l++)k=Math.min(k,f.b[l].b(g,h,e));f=k+Uf(this.X,.01*this.X.r);return 100>f?1:300<f?0:(f-300)*(f-300)/4E4},a);a.X.set("prox.horizontal",d)}
function Ri(a){for(var b=[0,0,a.X.r],c=[-a.X.r,a.X.r,0],d=[],e=0;3>e;e++)d.push(Vi(a,a.X.b[0]+b[e]*Math.cos(a.X.g)+c[e]*Math.sin(a.X.g),a.X.b[1]+b[e]*Math.sin(a.X.g)-c[e]*Math.cos(a.X.g)));b=200*(d[1]-d[0])/(2*a.X.r);d=200*(d[2]-(d[0]+d[1])/2)/a.X.Sc;a.X.set("acc",[b+Uf(a.X,.02),d+Uf(a.X,.02),Math.sqrt(1-b*b-d*d)+Uf(a.X,.02)])}
function zf(a,b,c){switch(c||a.F.kc){case Ni:a.F.Ue=null==b?a.F.Yb:null;a.F.Yb=b;Si(a);Pi(a.F);Sb(a);break;case "height":a.F.Ve=null==b?a.F.zb:null,c=a.F,c.zb=b,c.zb?(c.l.width=c.zb.width,c.l.height=c.zb.height,b=c.l.getContext("2d"),b.fillStyle="white",b.fillRect(0,0,c.zb.width,c.zb.height),b.drawImage(c.zb,0,0,c.zb.width,c.zb.height)):(c.l.width=1,c.l.height=1),Ri(c),Sb(a)}}function yf(a,b,c){switch(c||a.F.kc){case "obstacle":a.F.We=null==b?a.F.P:null,Ti(a,b)}}
Fb.prototype.start=function(a){this.F.paused=a;this.F.ke=!a;Sb(this)};function Wi(a){a=[a[0],Math.max(.2+.8*a[1],a[2]/2),a[2]];var b=Math.max(a[0],Math.max(a[1],a[2]));return"rgb("+a.map(function(c){return Math.round(225*(1-b)+(30+225*b)*c)}).join(",")+")"}function Xi(a){return function(b){a.l!==b&&(a.l=b,Ei(a))}}function af(a,b,c,d,e){var f=new jc(a.b);Ac(f,a,b,["sim","top"],a.F.fc||rc,a.F.Ie||xc);lc(f,c,e,d);return f}
function Sb(a){function b(y){return function(){c.l!==y&&(c.l=y,Ei(c))}}var c=a,d=a.F,e=d.X,f=a.b;if(f.P){d.ha||(d.ha=!0,d.resize(a),Si(a));f.$a=[];var g=d.Nf||a.ha,h=Cc(a,g,["sim","top"]),k=Dc(h),l=ad(f);$c(f);var z=sc(f.ba,{tag:"view",W:["sim"]}),m=sc(f.ba,{tag:"button",W:["sim","event"]}),x=sc(f.ba,{tag:"sim-controller"}),n=sc(f.ba,{tag:"separator",id:"sim-controller-separator"}),r=sc(f.ba,{tag:"separator",W:["sim","top"]}),v=sc(f.ba,{tag:"toolbar",W:["sim","top"]}),p=sc(f.ba,{tag:"sim-playground-area"}),
w=sc(f.ba,{tag:"sim-playground"});z.oc(l.width);z.cc(l.height);z.setPosition(0,0);var q=Math.max(m.width,m.height);x.width=3*mc(m);x.cc(z.height);x.setPosition(z.x+z.width-mc(x),z.y);v.oc(z.width-mc(x));v.height=k;v.setPosition(z.x,z.y);p.oc(z.width-mc(x));p.cc(z.height-v.oa());p.setPosition(z.x,z.y+v.oa());oc(f,function(y){z.H(y)});nc(af(a,g,v,r,h),v,h,Xi(a));oc(f,function(y){x.H(y)});g=[];h=x.y+m.offsetTop();g.push(qc(f,x.x+mc(m)+m.offsetLeft(),h,m,function(y,P,I){(d.fc||rc)("sim-event:forward",
y,f.v,f.ba,["sim","event"],null,!0,!1,I)},function(){e.set("button.forward",!0);e.sendEvent("buttons",null);e.set("button.forward",!1);e.sendEvent("buttons",null)},null,null,b("sim:btn-button.forward"),"button.forward"));h+=m.oa();g.push(qc(f,x.x+m.offsetLeft(),h,m,function(y,P,I){(d.fc||rc)("sim-event:left",y,f.v,f.ba,["sim","event"],null,!0,!1,I)},function(){e.set("button.left",!0);e.sendEvent("buttons",null);e.set("button.left",!1);e.sendEvent("buttons",null)},null,null,b("sim:btn-button.left"),
"button.left"));g.push(qc(f,x.x+mc(m)+m.offsetLeft(),h,m,function(y,P,I){(d.fc||rc)("sim-event:center",y,f.v,f.ba,["sim","event"],null,!0,!1,I)},function(){e.set("button.center",!0);e.sendEvent("buttons",null);e.set("button.center",!1);e.sendEvent("buttons",null)},null,null,b("sim:btn-button.center"),"button.center"));g.push(qc(f,x.x+2*mc(m)+m.offsetLeft(),h,m,function(y,P,I){(d.fc||rc)("sim-event:right",y,f.v,f.ba,["sim","event"],null,!0,!1,I)},function(){e.set("button.right",!0);e.sendEvent("buttons",
null);e.set("button.right",!1);e.sendEvent("buttons",null)},null,null,b("sim:btn-button.right"),"button.right"));h+=m.oa();g.push(qc(f,x.x+mc(m)+m.offsetLeft(),h,m,function(y,P,I){(d.fc||rc)("sim-event:backward",y,f.v,f.ba,["sim","event"],null,!0,!1,I)},function(){e.set("button.backward",!0);e.sendEvent("buttons",null);e.set("button.backward",!1);e.sendEvent("buttons",null)},null,null,b("sim:btn-button.backward"),"button.backward"));h+=m.oa()+n.oa();g.push(qc(f,x.x+.5*mc(m)+m.offsetLeft(),h,m,function(y,
P,I){(d.fc||rc)("sim-event:tap",y,f.v,f.ba,["sim","event"],null,!0,!1,I)},function(){e.sendEvent("tap",null)},null,null,b("sim:btn-tap"),"tap"));g.push(qc(f,x.x+1.5*mc(m)+m.offsetLeft(),h,m,function(y,P,I){(d.fc||rc)("sim-event:clap",y,f.v,f.ba,["sim","event"],null,!0,!1,I)},function(){e.sendEvent("mic",null)},null,null,b("sim:btn-clap"),"clap"));h+=2*q;var t=x.x+1.5*mc(m),u=h+3.5*q;g.push(oc(f,function(y){function P(C,B,H,Z,L,fa){y.save();y.translate(C,B);y.beginPath();y.arc(0,0,H,0,2*Math.PI);y.arc(0,
0,H/2,2*Math.PI,0,!0);y.fillStyle=L||"#bbb";y.fill();y.beginPath();y.arc(0,0,H,(-.5+2*Z)*Math.PI,-.5*Math.PI,!0);y.arc(0,0,H/2,-.5*Math.PI,(-.5+2*Z)*Math.PI,!1);y.fillStyle=fa||"#222";y.fill();y.restore()}y.save();y.beginPath();y.moveTo(t-1.2*q,u);y.lineTo(t-1.2*q,u-1.8*q);y.bezierCurveTo(t-.72*q,u-2.4*q,t-.05*q,u-2.4*q,t,u-2.4*q);y.bezierCurveTo(t+.05*q,u-2.4*q,t+.72*q,u-2.4*q,t+1.2*q,u-1.8*q);y.lineTo(t+1.2*q,u);y.closePath();y.lineWidth=2;y.strokeStyle="black";y.stroke();var I=e.get("prox.ground.delta");
P(t-.45*q,u-1.8*q,.4*q,I[0],"#afa","#060");P(t+.45*q,u-1.8*q,.4*q,I[1],"#9f9","#060");I=e.get("prox.horizontal");P(t-1.45*q,u-2.3*q,.4*q,I[0],"#fcc","#d00");P(t-.8*q,u-2.8*q,.4*q,I[1],"#fcc","#d00");P(t,u-3*q,.4*q,I[2],"#fcc","#d00");P(t+.8*q,u-2.8*q,.4*q,I[3],"#fcc","#d00");P(t+1.45*q,u-2.3*q,.4*q,I[4],"#fcc","#d00");P(t-.8*q,u+.5*q,.4*q,I[5],"#fcc","#d00");P(t+.8*q,u+.5*q,.4*q,I[6],"#fcc","#d00");y.restore()}));var F=h+=5*q;g.push(oc(f,function(y){function P(I,C,B,H){H=Math.max(-1,Math.min(1,H));
y.save();y.translate(I,C);y.beginPath();y.arc(0,0,B,0,2*Math.PI);y.fillStyle="#ccc";y.fill();y.beginPath();y.moveTo(0,0);y.lineTo(B*Math.sin(3*H),-B*Math.cos(3*H));y.lineWidth=Math.max(B/6,1);y.strokeStyle="black";y.stroke();y.restore()}y.save();y.fillStyle="black";y.fillRect(t-1.15*q,F+.5*q,.3*q,.6*q);y.fillRect(t+.85*q,F+.5*q,.3*q,.6*q);y.fillStyle=Wi(e.get("leds.top"));y.fillRect(t-1.2*q,F,2.4*q,.5*q);y.fillStyle=Wi(e.get("leds.bottom.left"));y.fillRect(t-1.2*q,F+.5*q,1.2*q,.5*q);y.fillStyle=Wi(e.get("leds.bottom.right"));
y.fillRect(t,F+.5*q,1.2*q,.5*q);y.lineWidth=1;y.beginPath();y.moveTo(t-1.2*q,F+.5*q);y.lineTo(t+1.2*q,F+.5*q);y.moveTo(t,F+.5*q);y.lineTo(t,F+q);y.strokeStyle="white";y.stroke();y.lineJoin="round";y.strokeStyle="black";y.strokeRect(t-1.2*q,F,2.4*q,q);P(t-1.7*q,F+q,.4*q,e.get("motor.left")/2);P(t+1.7*q,F+q,.4*q,e.get("motor.right")/2);y.restore()}));h+=1.5*q;if(null!=d.zb){var G=h+1.5*q;g.push(oc(f,function(y){var P=e.get("acc");P=[Math.atan2(P[0],P[1]),Math.atan2(P[1],P[2]),Math.atan2(P[0],P[2])];
y.save();y.strokeStyle="black";y.lineWidth=.7*f.v.ja;for(var I=0;3>I;I++){y.save();y.translate(t+(I-1)*q,G);y.save();y.strokeStyle="silver";y.beginPath();y.moveTo(-.4*q,0);y.lineTo(.4*q,0);y.moveTo(0,-.4*q);y.lineTo(0,.4*q);y.stroke();y.restore();y.rotate(-P[I]);switch(I){case 0:var C=.25*q;y.translate(0,1.2*C);y.beginPath();y.moveTo(-1.2*C,0);y.lineTo(-1.2*C,-1.8*C);y.bezierCurveTo(-.72*C,-2.4*C,-.05*C,-2.4*C,0,-2.4*C);y.bezierCurveTo(.05*C,-2.4*C,.72*C,-2.4*C,1.2*C,-1.8*C);y.lineTo(1.2*C,0);y.closePath();
y.lineWidth=2;y.strokeStyle="black";y.stroke();break;case 1:y.strokeRect(-.4*q,-.15*q,.8*q,.3*q);y.beginPath();y.arc(-.2*q,.05*q,.15*q,0,2*Math.PI);y.fillStyle="white";y.fill();y.lineWidth=.07*q;y.stroke();break;case 2:y.strokeRect(-.4*q,-.15*q,.8*q,.3*q),y.fillStyle="black",y.fillRect(-.35*q,.15*q,.15*q,.08*q),y.fillRect(.2*q,.15*q,.15*q,.08*q)}y.restore()}y.restore()}));h+=2.5*q}if(e.Tc){var D=h+2*q;g.push(oc(f,function(y){for(var P=e.get("leds.circle"),I=0;8>I;I++)ge(y,t,D,.9*q,1.2*q,Math.PI*(.44-
.25*I),Math.PI*(.56-.25*I),P[I]?"#fa0":"white","black",f.v.ja)}));h+=3.5*q}var O=h+1.5*q,Q=e.getTimer(0);0<=Q?(g.push(oc(f,function(y){f.state.oe?"lin"===f.state.oe&&4<Q&&(f.state.oe="log"):f.state.oe=4<Q?"log":"lin";ee(y,t,O,q,f.v.ja,function(P){y.textAlign="start";y.textBaseline="top";y.font=(q/2).toFixed(1)+"px sans-serif";y.fillStyle="black";y.fillText(P.toFixed(1),x.x,O-q)},Math.min(Q,"log"===f.state.oe?9.9:3.95),!1,"log"===f.state.oe)})),h+=2.5*q):f.state.oe=!1;var R=Math.min((p.y-x.y+x.y+x.height-
h)/2,x.y+x.height-h);0<R&&g.forEach(function(y){y.y+=R});var V=p.x,da=p.y,ja=p.width,K=p.height;var A=Math.min(ja/d.b.width,K/d.b.height);m=(ja-d.b.width*A)/2;n=(K-d.b.height*A)/2;w.width=d.b.width*A;w.height=d.b.height*A;w.x=V+m;w.y=da+n;if(a.ya.Xa){var S=sc(f.ba,{tag:"widget",id:"vpl-customize"});oc(f,function(){Vc(f,"vpl:customize",V+ja/2,da+K/2,S)})}else{var N=e.yb,X=!1;m=new Jc(null,d.b.width*A,d.b.height*A,V+m,da+n,function(y,P,I,C){y=y.J;y.save();p.H(y);w.H(y);if(null===c.Pc)switch(d.kc){case Ni:y.drawImage(d.g,
P.x+I,P.y+C,P.width,P.height);break;case "height":null!=d.zb&&y.drawImage(d.l,P.x+I,P.y+C,P.width,P.height);break;case "obstacle":y.save(),y.translate(P.x+I+P.width/2,P.y+C+P.height/2),y.scale(A,-A),d.o.H(y),y.restore()}else y.drawImage(d.g,P.x+I,P.y+C,P.width,P.height),null!=d.zb&&(y.save(),y.globalAlpha=.5,y.drawImage(d.l,P.x+I,P.y+C,P.width,P.height),y.restore()),d.ee&&(y.save(),y.translate(P.x+I+P.width/2,P.y+C+P.height/2),y.scale(A,-A),d.o.H(y),y.restore());y.translate(P.x+I+P.width/2,P.y+C+
P.height/2);y.scale(A,A);y.translate(e.b[0],-e.b[1]);y.rotate(.5*Math.PI-e.g);y.beginPath();y.moveTo(0,.2*N);y.lineTo(.5*N,.2*N);y.lineTo(.5*N,-.55*N);y.bezierCurveTo(.3*N,-.8*N,.02*N,-.8*N,0,-.8*N);y.bezierCurveTo(-.02*N,-.8*N,-.3*N,-.8*N,-.5*N,-.55*N);y.lineTo(-.5*N,.2*N);y.closePath();y.fillStyle=Wi(e.get("leds.top"));y.strokeStyle="black";y.lineJoin="round";y.lineWidth=2;y.moveTo(.05*N,0);y.arc(0,0,.05*N,0,2*Math.PI);y.fill();y.stroke();if(!d.ke||d.paused)y.beginPath(),y.arc(0,0,N,0,2*Math.PI),
y.strokeStyle=f.state.mg?"navy":"#3cf",y.lineWidth=.1*N,y.stroke(),y.beginPath(),y.arc(0,-N,.15*N,0,2*Math.PI),y.fillStyle=f.state.Gf?"navy":"white",y.strokeStyle=f.state.Gf?"navy":"#3cf",y.lineWidth=.06*N,y.fill(),y.stroke();y.restore()},{aa:function(y,P,I,C,B,H,Z){y=(Z.x-B-I/2)/A;C=(C/2-(Z.y-H))/A;H=y-e.b[0];Z=C-e.b[1];P=N*Math.cos(e.g);I=N*Math.sin(e.g);return(!d.ke||d.paused)&&(H-P)*(H-P)+(Z-I)*(Z-I)<.1*N*N?(f.state.x=y,f.state.y=C,f.state.Gf=!0,1):H*H+Z*Z<N*N?(d.paused?X=!1:(e.suspend(),X=!0),
f.state.x=y,f.state.y=C,f.state.mg=!0,0):null},Pa:function(y,P,I,C,B,H,Z,L){y=(L.x-H-C/2)/A;B=(B/2-(L.y-Z))/A;switch(I){case 0:I=e.b;e.setPosition([e.b[0]+y-f.state.x,e.b[1]+B-f.state.y],e.g);Gi(d,"l",[I[0],I[1],e.b[0],e.b[1]]);break;case 1:e.setPosition(e.b,e.g+(Math.atan2(B-e.b[1],y-e.b[0])-Math.atan2(f.state.y-e.b[1],f.state.x-e.b[0])))}f.state.x=y;f.state.y=B},ef:function(){f.state.mg=!1;f.state.Gf=!1;X&&e.resume(Fi())}});m.l=!1;Mc(f,m)}a.l&&oc(f,function(y){var P=sc(f.ba,{tag:"hint"});y.fillStyle=
P.color;y.font=tc(P);y.textAlign="start";y.textBaseline="middle";var I=c.g.translate(c.l);P.width=y.measureText(I).width;P.height=1.2*P.fontSize;pc(P,y,P.marginLeft,l.height-P.oa()+P.marginTop,!0);y.fillText(I,P.offsetLeft(),l.height-P.oa()+P.offsetTop()+P.height/2)});Ob(f);!d.paused&&e.shouldRunContinuously()&&Ei(a)}}function Ei(a){a.F.M||(a.F.M=!0,window.requestAnimationFrame(function(){a.F.M=!1;Sb(a)}))}function Fi(){return.001*(new Date).getTime()}
Hi.prototype.resize=function(a){var b=window.innerWidth,c=window.innerHeight;window.vplDisableResize&&(c=this.w.b.getBoundingClientRect(),b=c.width,c=c.height);this.w.v=this.w.v;this.w.resize(b,c);Sb(a)};function Lf(a){a.L.add("sim:close",{action:function(b){b.fb(["sim"],{Te:!0})},object:a,T:function(b){return 1<b.Aa.length&&0<=b.Aa.indexOf("sim")}});a.L.add("sim:restart",{action:function(b){Si(b);b.F.X.reset(Fi());b.F.X.start();b.F.ke=!0;b.F.paused=!1;Sb(b)},object:a});a.L.add("sim:pause",{action:function(b){b.F.ke&&(b.F.paused=!b.F.paused,b.F.paused?b.F.X.suspend():(b.F.X.resume(Fi()),Sb(b)))},isEnabled:function(b){return b.F.ke},Ta:function(b){return b.F.paused},object:a,cb:[{selected:!1},{selected:!0}]});
a.L.add("sim:speedup",{action:function(b){var c=[.5,1,2,5,10];b.F.X.yd=c[(c.indexOf(b.F.X.yd)+1)%c.length]},Ta:function(b){return 1!==b.F.X.yd},getState:function(b){return b.F.X.yd},object:a,cb:[{selected:!1,state:1},{selected:!0,state:.5},{selected:!0,state:2},{selected:!0,state:5},{selected:!0,state:10}]});a.L.add("sim:noise",{action:function(b){b.F.X.cf=!b.F.X.cf},Ta:function(b){return b.F.X.cf},object:a,cb:[{selected:!1},{selected:!0}]});a.L.add("sim:pen",{action:function(b){b.F.jf=!b.F.jf},Ta:function(b){return b.F.jf},
object:a,cb:[{selected:!1},{selected:!0}]});a.L.add("sim:clear",{action:function(b){Si(b)},isEnabled:function(b){return b.F.Af},object:a});a.L.add("sim:map-kind",{action:function(b){switch(b.F.kc){case Ni:b.F.kc="height";break;case "height":b.F.kc="obstacle";break;case "obstacle":b.F.kc=Ni}},getState:function(b){switch(b.F.kc){case Ni:return"ground";case "height":return"height";case "obstacle":return"obstacles";default:return"ground"}},object:a,cb:[{state:"ground"},{state:"height"},{state:"obstacles"}],
T:function(b){return null===b.Pc}});a.L.add("sim:map",{action:function(b){switch(b.F.kc){case Ni:zf(b,null==b.F.Yb?b.F.Ue:null);break;case "height":zf(b,null==b.F.zb?b.F.Ve:null);break;case "obstacle":yf(b,b.F.ee?null:b.F.We)}},Ta:function(b){switch(b.F.kc){case Ni:return null!=b.F.Yb;case "height":return null!=b.F.zb;case "obstacle":return b.F.ee}throw"internal";},getState:function(b){switch(b.F.kc){case Ni:return"ground";case "height":return"height";case "obstacle":return"obstacles";default:return"ground"}},
object:a,cb:[{selected:!1,state:"ground"},{selected:!1,state:"height"},{selected:!1,state:"obstacles"},{selected:!0,state:"ground"},{selected:!0,state:"height"},{selected:!0,state:"obstacles"}],T:function(b){return null===b.Pc}});a.L.add("sim:map-ground",{action:function(b,c){c?b.Be.show("Open ground image file",".gif,.png,.jpg,.svg",function(d){var e=new window.FileReader;e.onload=function(f){f=f.target.result;var g=new Image;g.addEventListener("load",function(){zf(b,g,Ni)});g.src=f};e.readAsDataURL(d)}):
zf(b,null==b.F.Yb?b.F.Ue:null,Ni)},Ta:function(b){return null!=b.F.Yb},object:a,cb:[{selected:!1},{selected:!0}],T:function(b){return b.Pc&&0<=b.Pc.indexOf("ground")}});a.L.add("sim:map-height",{action:function(b,c){c?b.Be.show("Open height image file",".gif,.png,.jpg,.svg",function(d){var e=new window.FileReader;e.onload=function(f){f=f.target.result;var g=new Image;g.addEventListener("load",function(){zf(b,g,"height")});g.src=f};e.readAsDataURL(d)}):zf(b,null==b.F.zb?b.F.Ve:null,"height")},Ta:function(b){return null!=
b.F.zb},object:a,cb:[{selected:!1},{selected:!0}],T:function(b){return b.Pc&&0<=b.Pc.indexOf("height")}});a.L.add("sim:map-obstacles",{action:function(b,c){c?b.Be.show("Open obstacle SVG file",".svg",function(d){var e=new window.FileReader;e.onload=function(f){yf(b,f.target.result,"obstacle")};e.readAsText(d)}):yf(b,b.F.ee?null:b.F.We,"obstacle")},Ta:function(b){return b.F.ee},object:a,cb:[{selected:!1},{selected:!0}],T:function(b){return b.Pc&&0<=b.Pc.indexOf("obstacles")}});a.L.add("sim:vpl",{action:function(b){b.Ld?
b.fb(["vpl"],{Nd:!0}):b.fb(["vpl"],{Id:"sim"})},isEnabled:function(b){return null==b.I||nf(b.I)},object:a,T:function(b){return(null==b.I||!b.I.fa)&&0>b.Aa.indexOf("vpl")}});a.L.add("sim:text",{action:function(b){b.Ld?b.fb(["src"],{Nd:!0,Qf:!b.I.Kc}):b.fb(["src"],{Id:"sim",Qf:!b.I.Kc})},object:a,T:function(b){return 0>b.Aa.indexOf("src")}});a.L.add("sim:teacher-reset",{action:function(b){b.F.je();Sb(b)},object:a,Mc:!0,T:function(b){return b.F.Ob&&b.F.ya.Xa}});a.L.add("sim:teacher",{action:function(b){b.F.ya.Xa=
!b.F.ya.Xa;Sb(b)},Ta:function(b){return b.F.ya.Xa},object:a,Mc:!0,T:function(b){return b.F.Ob},cb:[{selected:!1},{selected:!0}]})};function Hf(a){return new vf({Zb:function(b,c){a.La[a.xa].eb.state.b(c)},Ic:function(){try{var b=Ff("asebahttp")||("http:"!==document.location.origin.slice(0,5)?"http://127.0.0.1:3000":document.location.origin);oa(b,function(){a.La[a.xa].eb.state=ha[0];Rd(a.da)})}catch(c){console.info(c),Rd(a.da)}},isConnected:function(){return null!=a.La[a.xa].eb.state},isEnabled:function(b){return"aseba"===b&&null!=a.La[a.xa].eb.state},Jd:function(){return"Thymio (HTTP)"},wd:"aseba",languages:["aseba","l2"],state:null})}
;function If(a){var b=null;return new vf({Zb:function(c,d){b.run(d)},Ic:function(){try{b=new window.TDM(Ff("w"),{uuid:Ff("uuid")||"auto",change:function(c){a.La[a.xa].eb.state=c?{}:null;Rd(a.da)}})}catch(c){console.info(c),Rd(a.da)}},isConnected:function(){return null!=a.La[a.xa].eb.state&&b.isConnected()},isEnabled:function(c){return"aseba"===c&&null!=a.La[a.xa].eb.state&&b.canRun()},Jd:function(){return"Thymio (TDM)"},wd:"aseba",languages:["aseba"],state:null})};function Yi(a){this.w=a||"ws://127.0.0.1:8002/";this.o={};this.l=this.b=null}Yi.prototype.connect=function(){this.g=new WebSocket(this.w);var a=this;this.g.addEventListener("open",function(){a.g.send(JSON.stringify({type:"nodes"}))});this.g.addEventListener("message",function(b){try{var c=JSON.parse(b.data);switch(c.type){case "connect":if(c.id){var d=c.id;a.o[d]=c;a.b&&a.b(d,c.descr)}break;case "disconnect":d=c.id,delete a.o[d],a.l&&a.l(d)}}catch(e){}})};
Yi.prototype.Zb=function(a,b){this.g.send(JSON.stringify({type:"run",id:a,bc:b}))};function Jf(a){var b=null,c=Ff("uuid")||null;c&&(c=c.replace(/^\{(.*)\}$/,"$1"));var d=null;return new vf({Zb:function(e,f){switch(e){case "aseba":e=new vb(d,f);e.ha=wb;var g=xb(e);break;case "l2":e=new vb(d,f);e.ha=Of;g=xb(e);break;case "asm":e=new Qf(d,f),g=Pf(e)}b.Zb(c,g)},Ic:function(){try{var e=Ff("w")||("http:"!==document.location.origin.slice(0,5)?"ws://127.0.0.1:8002":document.location.origin.replace(/^http/,"ws"));b=new Yi(e);b.b=function(f,g){if(null==c||f===c)d=new tb(g),a.La[a.xa].eb.state=
{},Rd(a.da)};b.l=function(f){if(null==c||f===c)a.La[a.xa].eb.state=null,Rd(a.da)};b.connect()}catch(f){console.info(f),Rd(a.da)}},isConnected:function(){return null!=a.La[a.xa].eb.state},isEnabled:function(e){return("aseba"===e||"l2"===e||"asm"===e)&&null!=a.La[a.xa].eb.state},Jd:function(){return"Thymio (JWS)"},wd:"aseba",languages:["aseba","l2","asm"],state:null})};
}).call(this);
