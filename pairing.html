<!DOCTYPE html>
<html>

<head>

<meta charset="utf-8">
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<meta name="viewport" content="width=device-width, height=device-height, maximum-scale=1, user-scalable=no" />
<meta name="apple-mobile-web-app-capable" content="yes" />

<title>VPL Pairing</title>

<style>
html {
	height: 100%;
}
body {
	height: 100%;
}

td {
	padding: 0.5ex;
}
</style>

<script>

/** Get value corresponding to key in the location hash
	@param {string} key
	@return {string}
*/
function vplGetHashOption(key) {
	var dict = (document.location.hash || "#")
		.slice(1)
		.split("&").map(function (p) {
			return p.split("=");
		})
		.reduce(function (acc, p) {
			acc[p[0]] = p[1];
			return acc;
		}, {});
	return dict[key] || null;
}

function clearTable() {
	var table = document.getElementById("t");
	while (table.firstElementChild) {
		table.removeChild(table.firstElementChild);
	}
}

function fillTable(pairing) {
	var nodes = pairing.getRobots();
	clearTable();
	var table = document.getElementById("t");
	nodes.forEach(function (node) {
		var tr = document.createElement("tr");
		var td = document.createElement("td");
		td.textContent = node.id.toString();
		tr.appendChild(td);
		td = document.createElement("td");
		var btn = document.createElement("button");
		btn.textContent = "Flash";
		btn.addEventListener("click", function () {
			window["TDM"].runOnNode(node,
				"call leds.circle(32,32,32,32,32,32,32,32)\n" +
				"timer.period[0] = 100\n" +
				"onevent timer0\n" +
				"call leds.circle(0,0,0,0,0,0,0,0)\n"
			);
		}, false);
		td.appendChild(btn);
		tr.appendChild(td);
		td = document.createElement("td");
		var a = document.createElement("a");
		var url = document.location.origin + "/vpl.html?ui=ui/classic/ui.json&robot=thymio-tdm#uuid=" + node.id.toString();
		a.textContent = "VPL";
		a.setAttribute("href", url);
		td.appendChild(a);
		tr.appendChild(td);
		table.appendChild(tr);
	});
}

</script>

<script src="thymio/thymio.js"></script>
<script src="ns.js"></script>
<script src="pairing.js"></script>

</head>

<body>

<h1>VPL Pairing</h1>

<table id="t">
</table>

</body>

</html>
