/* Copyright 2018-2021 ECOLE POLYTECHNIQUE FEDERALE DE LAUSANNE - author Yves Piguet */
(function(){
var y,aa,ba,ca;function da(a,b){this.name=a;this.oe=b}var ea=[];function fa(){var a=ha;if(a)for(var b=ea.length-1;0<=b;b--)ea[b]instanceof a&&ea.splice(b,1);else ea=[]}da.prototype.b=function(){throw"not implemented";};da.prototype.addEventListener=function(){throw"not implemented";};function ha(a,b,c){da.call(this,a,b);this.url=c}ha.prototype=Object.create(da.prototype);ha.prototype.constructor=ha;function ia(a,b,c,d){var e=new XMLHttpRequest;e.timeout=5E3;c&&(e.addEventListener("timeout",function(){c(null)}),e.addEventListener("error",function(){c(null)}),e.addEventListener("load",function(){switch(e.status){case 200:c(e.responseText);break;default:c(null)}}));e.open(a,b,!0);e.send(d)}
function ka(a,b){a=a||"";ia("GET",a+"/nodes",function(c){null!==c&&(c=JSON.parse(c),0===c.length?ka(a,b):(fa(),c.forEach(function(b){var c=new ha(b.name,b.aeslId,a+"/nodes/"+b.name,b.protocolVersion);ia("GET",a+"/nodes/"+b.name,function(a){c.description=a?JSON.parse(a):""});ea.push(c)}),b&&b()))})}
function la(a,b){return"<!DOCTYPE aesl-source>\n<network>\n"+[].map(function(a){return"<event size='"+(a.size||0).toString(10)+"' name='"+a.name+"'/>\n"}).join("")+"<keywords flag='true'/>\n<node nodeId='"+(a.oe||1).toString(10)+"' name='"+a.name+"'><![CDATA["+b+"]]\x3e</node>\n</network>\n"}ha.prototype.b=function(a){a=la(this,a);ia("PUT",this.url,void 0,a)};
ha.prototype.addEventListener=function(a,b){a=a.toString();var c=this.url+"/events";a&&(c+="/"+a);c=new EventSource(c);c.onmessage=function(c){b(c.data.split(" ").slice(1).map(function(a){return parseInt(a,10)}),a)};return c};function z(a){this.name=a.name;this.type=a.type;this.xa=a.xa||["b","a"];this.gh=a.gh||!1;this.sa=a.sa||null;this.eb=a.eb||null;this.Te=a.Te||null;this.ja=a.ja;this.Kf=a.Kf||null;this.Ie=a.Ie||null;this.Pc=a.Pc||null;this.Rb=a.Rb||{aseba:"e"===this.type?function(a){return{be:"# onevent "+a.T.name+"\n"}}:function(a){return{ya:"# "+a.T.name+"\n"}}};this.L=a.L||function(a,c){a.text(c.T.name)};this.Ae=a.Ae||!1;this.fa=a.fa||null;this.Oa=a.Oa||null;this.cd=a.cd||null}var ma=[];
function na(a,b,c,d){var e=null;for(c=c||{J:0,xh:1};;){var f=/`([^`]*)`/.exec(a);if(null==f)break;e=(new Function("$","i","slowdown","rgb","toFixed","return "+f[1]+";"))(b,c.J,c.xh,function(a){a=[a[0],Math.max(.2+.8*a[1],a[2]/2),a[2]];var b=Math.max(a[0],Math.max(a[1],a[2]));return a.map(function(a){return.88*(1-b)+(.12+.88*b)*a})},function(a,b){return parseFloat(a.toFixed(void 0===b?2:b)).toString()});a=a.slice(0,f.index)+e+a.slice(f.index+f[0].length)}return d?e:a};function B(a){this.controls=a||[]}function pa(a,b,c,d,e,f,g,h){this.top=a;this.left=b;this.bottom=c;this.right=d;this.l=e;this.i=f;this.b=g;this.u=h||null};function C(a,b,c){this.T=a;this.Db=b;this.Me=c;this.locked=this.disabled=!1;this.marks={};this.h=a.sa?a.sa():null;this.b=this.i=null}C.prototype.qb=function(a,b,c,d){a=new C(this.T,a,b);a.disabled=this.disabled;a.i=c;a.b=d;this.h&&(a.h=this.h.slice());return a};function F(a){a.i&&a.i()}function G(a){a.b&&a.b()}C.prototype.l=function(a,b){return this.disabled?{}:this.T.Rb[a]?this.T.Rb[a](this,b):qa[a].b(this)};function ra(a,b,c){C.call(this,sa[a],b,c)}ra.prototype=Object.create(C.prototype);ra.prototype.constructor=ra;var sa={e:new z({name:"empty e",type:"e",L:function(a,b,c,d){var e=ta("!empty event");e&&e.L(a,b,c,d)}}),a:new z({name:"empty a",type:"a",L:function(a,b,c,d){var e=ta("!empty action");e&&e.L(a,b,c,d)}}),s:new z({name:"empty s",type:"s",L:function(a,b,c,d){var e=ta("!empty state")||ta("!empty event");e&&e.L(a,b,c,d)}})};ra.prototype.l=function(){return{}};function ua(){this.X=[];this.actions=[];this.error=null;this.locked=this.disabled=!1}y=ua.prototype;y.qb=function(){for(var a=new ua,b=0;b<this.X.length;b++)a.Ub(this.X[b],null,null,null);for(b=0;b<this.actions.length;b++)a.Ub(this.actions[b],null,null,null);return a};y.Ob=function(){return 0===this.X.length&&0===this.actions.length};function va(a){for(var b=0;b<a.X.length;b++)if("init"===a.X[b].T.name)return a.X[b];return null}
y.Ub=function(a,b,c,d,e){if(a){switch(a.T.type){case "e":case "s":if(a.Db===this)b&&(this.X.splice(a.Me.index,1),e?(a.i=c,a.b=d):a=a.qb(this,b,c,d),this.X.splice(b.index,0,a));else if(b){if(this.X[b.index]===a)return;e?(a.i=c,a.b=d):a=a.qb(this,b,c,d);this.X[b.index]=a}else e?(a.i=c,a.b=d):a=a.qb(this,{dd:!0,index:this.X.length},c,d),this.X.push(a);break;case "a":case "c":if(a.Db===this)b&&(this.yg(a.Me),e?(a.i=c,a.b=d):a=a.qb(this,b,c,d),(b.dd?this.X:this.actions).splice(b.index,0,a));else if(b){if((b.dd?
this.X:this.actions)[b.index]===a)return;e?(a.i=c,a.b=d):a=a.qb(this,b,c,d);(b.dd?this.X:this.actions)[b.index]=a}else e?(a.i=c,a.b=d):a=a.qb(this,{dd:!1,index:this.actions.length},c,d),this.actions.push(a)}wa(this)}};y.yg=function(a){a.dd?this.X[a.index]&&(this.X.splice(a.index,1),wa(this)):this.actions[a.index]&&(this.actions.splice(a.index,1),wa(this))};
function wa(a){a.X.forEach(function(a,c){a.Db=this;a.Me={dd:!0,index:c}},a);a.actions.forEach(function(a,c){a.Db=this;a.Me={dd:!1,index:c}},a)}
y.ff=function(a){function b(a,b){if(a.disabled)return b.disabled?0:1;if(b.disabled)return-1;a=a.T.name;b=b.T.name;return a>b?1:a<b?-1:0}function c(a,b){if(null===a.h&&null===b.h)return!0;if(null===a.h||null===b.h||a.h.length!==b.h.length)return!1;for(var c=0;c<a.h.length;c++)if(a.h[c]!==b.h[c])return!1;return!0}function d(a){for(var b=0;b<a.X.length;b++)if(!a.X[b].disabled)return!1;return!0}if(!(this.disabled||a.disabled||d(this)||d(a)||0===this.X.length||a.X.length!==this.X.length)){for(var e=this.X.slice(0,
1).concat(this.X.slice(1).sort(b)),f=a.X.slice(0,1).concat(a.X.slice(1).sort(b)),g=0;g<e.length&&!e[g].disabled&&!f[g].disabled;g++)if(e[g].T!==f[g].T||!c(e[g],f[g]))return;if(null==this.error||this.error.Sb)e=new za("Rules with same events"),Aa(e,a),this.error=e;if(null==a.error||a.error.Sb)e=new za("Rules with same events"),Aa(e,this),a.error=e}};function Ba(a){ua.call(this);this.ce=a||""}Ba.prototype=Object.create(ua.prototype);y=Ba.prototype;y.constructor=Ba;y.qb=function(){return new Ba(this.ce)};y.Ob=function(){return!1};y.Ub=function(){throw"internal";};y.yg=function(){throw"internal";};y.ff=function(){};function Ca(){this.b=[];this.sb=this.we=this.cc=!1;this.l=!0;this.i=this.u=!1}function Da(a,b){a.b=b.slice()}Ca.prototype.toggle=function(a){var b=this.b.indexOf(a);0<=b?this.b.splice(b,1):this.b.push(a)};function Ea(){this.b={};this.language="en"}function Ga(a,b,c){a.b[b]||(a.b[b]={});a=a.b[b];for(var d in c)c.hasOwnProperty(d)&&(a[d]=c[d])}Ea.prototype.translate=function(a,b){return(b=this.b[b||this.language])&&b[a]||a};function Ia(){this.b={};this.Ve={}}Ia.prototype.add=function(a){for(var b in a)if(a.hasOwnProperty(b)){this.b[b]||(this.b[b]={});for(var c in a[b])if(a[b].hasOwnProperty(c)){this.b[b][c]||(this.b[b][c]={});for(var d in a[b][c])a[b][c].hasOwnProperty(d)&&(this.b[b][c][d]=a[b][c][d].slice())}}};Ia.prototype.get=function(a,b,c){return this.b[a]&&this.b[a][b]&&this.b[a][b][c]?this.b[a][b][c]:null};
function Ja(a,b){var c="";b.forEach(function(a){function b(b,c){b=a.split(b);if(1<b.length){a=b[0];for(var d=1;d<b.length;d++)a+=(1==d%2?"<":"</")+c+">"+b[d];0==b.length%2&&(a+="</"+c+">")}}a=a.replace(/&\s/g,"&amp; ");var d="p";/^###/.test(a)?(a=a.slice(2),d="h4"):/^##/.test(a)?(a=a.slice(2),d="h3"):/^#/.test(a)&&(a=a.slice(1),d="h2");b(/\*\*|__/,"strong");for(b(/\*|_/,"em");;){var g=/!\[([^\]]*)\]\(([^)]*)\)/.exec(a);if(!g)break;a=a.slice(0,g.index)+'<img src="'+(this.Ve[g[2]]||g[2])+'" alt="'+
g[1]+'">'+a.slice(g.index+g[0].length)}a=a.replace(/\[([^\]]*)\]\(([^)]*)\)/g,'<a href="$2">$1</a>');c="p"===d&&/^<img /.test(a)&&!/^.+<img/.test(a)?c+('<p class="md parimg">'+a+"</"+d+">\n"):c+("<"+d+' class="md">'+a+"</"+d+">\n")},a);return c}
Ia.prototype.Wc=function(a,b,c,d){d=d&&d[a]?"<div style='padding: 2em; max-width: 60em; margin-left: auto; margin-right: auto;'>\n"+d[a]+"</div>\n":"<html>\n<style>\nbody {font-family: sans-serif;}\nimg {float: left; margin-right: 10px; margin-bottom: 20px;}\nh1, h2, hr {clear: left;}\np {margin-left: 120px}\np.parimg {margin-left: 0}\n</style>\n<body>\n<div style='padding: 2em; max-width: 60em; margin-left: auto; margin-right: auto;'>\nBUTTONS<hr>\nBLOCKS</div>\n</body>\n</html>\n";var e="";b.forEach(function(b){(b=
this.get(a,"buttons",b))&&(e+=Ja(this,b))},this);var f="";c.forEach(function(b){(b=this.get(a,"blocks",b))&&(f+=Ja(this,b))},this);return d.replace("BUTTONS",e).replace("BLOCKS",f)};function Ka(a){this.filename=null;this.readOnly=!1;this.mode="b";this.ra=!1;this.Vb=La;this.Zg=!1;this.volume=null;this.j=[];this.sf=1;this.Qb=!1;this.tg=!0;this.wc=this.oc=!1;this.G=this.u=this.w=this.ta=null;this.qd=new Na;this.code={};this.xb="aseba";this.message=null;this.Zb=Pa;this.b=Qa;this.gc=Ra;this.i=Sa;this.W=a||new Ca;this.l=null}var qa={},Ta=!0,Pa=[],Qa=!1,Sa=!0,Ra=[];function Ua(){Pa=Va("b").map(function(a){return a.name});Ra=Va("a").map(function(a){return a.name})}
function Wa(a){var b=H.map(function(a){return a.name});switch(a){case "b":Pa=b;break;case "a":Ra=b}}y=Ka.prototype;y.Ne=function(){this.W.b=[]};function Xa(a,b){b?(b=a.qd,b.Ec=[],b.zd=[]):a.zb();a.mode="b";a.Zb=Pa;a.b=Qa;a.gc=Ra;a.i=Sa;a.j=[];a.code={};a.tg=!0;Ya(a)}y.Ob=function(){for(var a=0;a<this.j.length;a++)if(!this.j[a].Ob())return!1;return!0};y.getError=function(){for(var a=0;a<this.j.length;a++)if(null!==this.j[a].error)return this.j[a].error;return null};
function Za(a){if("b"===a.mode?a.b:a.i)return!1;for(var b=0;b<a.j.length;b++)if(1<a.j[b].X.length||0<a.j[b].X.length&&"s"===a.j[b].X[0].T.type)return!1;return!0}y.zb=function(){this.qd.zb($a(this),{Qb:this.Qb,oc:this.oc,wc:this.wc});this.code={};this.wc=this.oc=this.Qb=!1};function ab(a){a.w&&a.w()}y.ag=function(a){if(0<this.qd.Ec.length){var b=this.qd.ag($a(this),{Qb:this.Qb,oc:this.oc,wc:this.wc});bb(this,b.state,a);this.Qb=b.marks.Qb;this.oc=b.marks.oc;this.wc=b.marks.wc;this.code={}}};
y.xg=function(a){if(0<this.qd.zd.length){var b=this.qd.xg($a(this),{Qb:this.Qb,oc:this.oc,wc:this.wc});bb(this,b.state,a);this.Qb=b.marks.Qb;this.oc=b.marks.oc;this.wc=b.marks.wc;this.code={}}};function cb(a,b){b!==a.mode&&(a.zb(),a.mode=b,a.j.forEach(function(a){a.X.forEach(function(b,c){a.X[c]=b});a.actions.forEach(function(b,c){a.actions[c]=b})}))}var La="s";
function Ya(a){if(0!==a.j.length&&a.j[a.j.length-1].Ob())for(;1<a.j.length&&a.j[a.j.length-2].Ob();)a.j.splice(-2,1);else a.j.push(new ua),Ya(a)}
function $a(a,b){var c={};b&&!1===b.jd||(c.basicBlocks=a.Zb,c.basicMultiEvent=a.b,Ta&&(c.advanced="a"===a.mode,c.advancedBlocks=a.gc,c.advancedMultiEvent=a.i),c.disabledUI=a.W.b);if(b&&!1===b.md)return c;b=a.u?a.u():null;var d=null;null==b&&(d=a.j.map(function(a){function b(a){a&&c.push({name:a.T.name,disabled:a.disabled,locked:a.locked,param:a.T.Kf?a.T.Kf(a):a.h?a.h.slice():null})}var c=[];if(a instanceof Ba)return{comment:a.ce,disabled:a.disabled,locked:a.locked};a.X.forEach(function(a){b(a)});
a.actions.forEach(function(a){b(a)});return{blocks:c,disabled:a.disabled,locked:a.locked}}));c.program=d;c.code=b;return c}function db(a,b){return JSON.stringify($a(a,b),null,"\t")}
function bb(a,b,c,d){var e=!1,f="vpl";try{if(b){!b.disabledUI||d&&d.mi||Da(a.W,b.disabledUI);if(!d||!d.li){var g=1==b.advanced;Ta?(a.mode=g?"a":"b",a.Zb=b.basicBlocks||Pa,a.b=void 0!==b.basicMultiEvent?b.basicMultiEvent:Qa,a.gc=b.advancedBlocks||Ra,a.i=void 0!==b.advancedMultiEvent?b.advancedMultiEvent:Sa):(a.mode="b",a.Zb=g?b.advancedBlocks||Ra:b.basicBlocks||Pa,a.b=g?void 0!==b.advancedMultiEvent?b.advancedMultiEvent:Sa:void 0!==b.basicMultiEvent?b.basicMultiEvent:Qa)}if(!d||!d.Vg)if(b.program?
a.j=b.program.map(function(b){if(b.hasOwnProperty("comment")){var d=new Ba(b.ce);d.disabled=b.disabled||!1;d.locked=b.locked||!1;return d}var f=new ua;b.blocks.forEach(function(b){var d=ta(b.name);if(d){var g=new C(d,null,null);g.disabled=b.disabled||!1;g.locked=b.locked||!1;d.Ie?d.Ie(g,b.param,function(){e&&c&&c("vpl")}):g.h=b.param;f.Ub(g,null,function(){a.zb()},function(){ab(a)},!0)}},this);f.disabled=b.disabled||!1;f.locked=b.locked||!1;return f},a):a.j=[],a.G){var h=b.code;a.G(void 0==b.code?
null:h);null!=h&&(f="src")}}}catch(m){}Ya(a);a.ra="src"===f;c&&c(f);e=!0}function eb(a,b,c,d){try{var e=JSON.parse(b);bb(a,e,c,d);var f=a.qd;f.Ec=[];f.zd=[]}catch(g){}}Ka.prototype.xc=function(a){"string"!==typeof this.code[a]&&(this.code[a]=qa[a].Wc(this));return this.code[a]};function fb(a,b){var c=qa[a];a=gb(c,b,!0);b=gb(c,b,!1);return 0<=a&&0<=b?{be:a,end:b}:null}function hb(a,b){a.l=b}Ka.prototype.log=function(a){this.l&&this.l(a)};function ib(a,b,c){this.language=a;this.i=b;this.l=c;this.marks=[]}function jb(a,b,c){this.id=a;this.se=b;this.i=c;if(0>a||6399<a)throw"internal";this.v=String.fromCharCode(57344+a);this.b=-1}
function kb(a,b){a.forEach(function(a){a.b=b.indexOf(a.v)});a.sort(function(a,b){return a.b-b.b});for(var c=0;c<a.length;c++)a[c].b-=c,b=b.replace(a[c].v,"");a.forEach(function(a){var c;if(a.i){for(;;){for(c=a.b;" "===b[c]||"\t"===b[c];c++);if("\n"===b[c])a.b=c+1;else break}if(" "===b[a.b-1]||"\t"===b[a.b-1]){for(c=a.b-1;" "===b[c]||"\t"===b[c];c--);"\n"===b[c]&&(a.b=c+1)}}else if(" "===b[a.b-1]||"\t"===b[a.b-1]){for(c=a.b-1;" "===b[c]||"\t"===b[c];c--);"\n"===b[c]&&(a.b=c+1)}});return b}
function lb(a){return a.replace(/[\ue000-\uf8ff]/g,"")}function mb(a,b,c){var d=a.marks.length,e=new jb(d,c,!0);a.marks.push(e);c=new jb(d+1,c,!1);a.marks.push(c);return e.v+b+c.v}function gb(a,b,c){for(var d=0;d<a.marks.length;d++)if(a.marks[d].se===b&&a.marks[d].i===c)return a.marks[d].b;return-1}
function nb(a,b,c){if(b.disabled||b.Ob())return{};b.error=null;for(var d=!1,e=!1,f=0;f<b.X.length;f++)if(!b.X[f].disabled){if("e"===b.X[f].T.type){if(d=!0,b.X[f].T.Pc){var g=b.X[f].T.Pc(b.X[f]);if(g&&(ob(g,[f]),!g.Sb||!b.error)&&(b.error=g,!g.Sb))return{error:g}}}else"s"===b.X[f].T.type&&(e=!0);if(("e"===b.X[f].T.type||"s"===b.X[f].T.type)&&null===b.error)for(var h=f+1;h<b.X.length;h++)b.X[h].disabled||b.X[h].T!==b.X[f].T||(g=new za("Same block used multiple times",!0),ob(g,[f,h]),b.error=g)}g=!1;
for(f=0;f<b.actions.length;f++)if(!b.actions[f].disabled&&"a"===b.actions[f].T.type){g=!0;break}if(!d&&!g)return b.error?{error:b.error}:{};if(!d&&!e)return g=new za("Missing event block"),ob(g,[]),b.error=g,{error:g};if(!g)return g=new za("Missing action block"),g.b.push(0),b.error=g,{error:g};if(!b.error)for(f=0;f<b.actions.length;f++)if(!b.actions[f].disabled)for(h=f+1;h<b.actions.length;h++)b.actions[h].disabled||"a"!==b.actions[h].T.type||b.actions[h].T!==b.actions[f].T||(g=new za("Same block used multiple times",
!0),g.b.push(f),g.b.push(h),b.error=g);var m=[],k=[],p=[],n="",t=[],q="",l=[],v="";b.X.forEach(function(a,b){var d=a.l(this.language,c);if(0===b&&d.ca)d.bb&&(n=mb(this,d.bb,a),d.ma&&(q+=d.ma));else if(d.Ug||d.bb)t.push(mb(this,d.Ug||d.bb,a)),d.ma&&(l=l.concat(d.ma));d.kc&&(m=m.concat(d.kc));d.zc&&(k=k.concat(d.zc));d.jc&&(p=p.concat(d.jc));d.ya&&(v+=mb(this,d.ya,a))},a);for(f=0;f<b.actions.length;f++)d=b.actions[f].l(a.language,c),v+=d.ya?mb(a,d.ya,b.actions[f]):"",d.kc&&d.kc.forEach(function(a){0>
m.indexOf(a)&&m.push(a)}),d.zc&&d.zc.forEach(function(a){0>k.indexOf(a)&&k.push(a)}),d.jc&&d.jc.forEach(function(a){0>p.indexOf(a)&&p.push(a)});return 0<v.length?(f="e"===b.X[0].T.type?b.X[0].l(a.language,c):null,d=b.X.slice(1).filter(function(a){return"e"===a.T.type}).map(function(a){return a.l(this.language,c)},a),{pi:b.X[0]?b.X[0].T.name:"",kc:m,zc:k,jc:p,ca:f?f.ca:"",ub:f?f.ub:"",cb:f?f.cb:"",Nd:d.map(function(a){return a.ca||""}),vf:d.map(function(a){return a.ub||""}),wf:d.map(function(a){return a.cb||
""}),ma:q,Md:l,bb:n,Yb:t.join(" "+a.i+" "),ya:(f&&f.ya||"")+v}):{}}function pb(a,b){if(null!==b.volume){var c=ta("!volume");if(null!==c){var d=new C(c,null,null);d.h=[b.volume];if(a=c&&c.Rb[a.language])return"\n"+a(d).ya}}return""}ib.prototype.Wc=function(){throw"internal";};ib.prototype.b=function(){throw"internal";};function qb(){ib.call(this,"aseba","and","1 == 1")}qb.prototype=Object.create(ib.prototype);qb.prototype.constructor=qb;
qb.prototype.Wc=function(a,b){this.marks=[];var c=a.j.map(function(b){return nb(this,b,a)},this),d={},e=[];c.forEach(function(a){a.ca&&(d[a.ca]={ca:a.ca,ub:a.ub,cb:a.cb,ma:"",Ua:""},0>e.indexOf(a.ca)&&e.push(a.ca));a.Nd&&a.Nd.forEach(function(b,c){d[b]={ca:b,ub:a.vf[c],cb:a.wf[c],ma:"",Ua:""};0>e.indexOf(b)&&e.push(b)})});var f=[],g=[],h=[],m=[];c.forEach(function(b,c){b.kc&&b.kc.forEach(function(a){0>f.indexOf(a)&&f.push(a)});b.zc&&b.zc.forEach(function(a){0>g.indexOf(a)&&g.push(a)});b.jc&&b.jc.forEach(function(a){0>
h.indexOf(a)&&h.push(a)});if(b.ca&&(b.gb=m.indexOf(lb(b.bb||b.ca)),0>b.gb)){b.gb=m.length;m.push(lb(b.bb||b.ca));var e=d[b.ca];b.ma&&0>e.ma.indexOf(b.ma)&&(e.ma+=b.ma);e.Ua+=b.bb?"when "+b.bb+" do\neventCache["+b.gb+"] = 1\nend\n":"eventCache["+b.gb+"] = 1\n"}b.ca||(b.ya=mb(this,b.ya||"",a.j[c]))},this);var k="";if(b){var p=new ua,n=new C(ta("init"),null,null);p.Ub(n,null,null,null);b.forEach(function(a){p.Ub(a,null,null,null)});n=nb(this,p,a);var t=!0;n.kc.forEach(function(a){0>f.indexOf(a)&&(t=
!1)});n.jc.forEach(function(a){0>h.indexOf(a)&&(t=!1)});t?k=n.ya:n.Zh&&(k=n.Zh)}var q=[],l="",v="",r=0;for(n=0;n<a.j.length;n++)0<=c[n].gb?(c[n].Md&&c[n].Md.forEach(function(a){0>q.indexOf(a)&&q.push(a)}),l+="if eventCache["+c[n].gb+"] != 0"+(c[n].Yb?" and "+c[n].Yb:"")+" then\ntodo["+r+"] = 1\nend\n",v+="if todo["+r+"] != 0 then\n"+c[n].ya+"end\n",r++):c[n].Yb&&(l+="when "+c[n].Yb+" do\ntodo["+r+"] = 1\nend\n",v+="if todo["+r+"] != 0 then\n"+c[n].ya+"end\n",r++);c=0<f.length?"\n"+f.join("\n"):"";
0<m.length&&(c+="var eventCache[] = ["+m.map(function(){return"0"}).join(", ")+"]\n");if(0<r){c+="var todo[] = [";for(n=0;n<r;n++)c+=0<n?", 0":"0";c+="]\n"}b?c+="\n"+k:(0<g.length&&(c+="\n"+g.join("\n")),l&&(c+=(0<c.length?"\n":"")+"timer.period[1] = 50\n"));for(n=0;n<e.length;n++)!/onevent/.test(d[e[n]].ca)&&(d[e[n]].cb||d[e[n]].ma||d[e[n]].Ua)&&(c+="\n"+(d[e[n]].ca||"")+(d[e[n]].cb||"")+(d[e[n]].ma||"")+(d[e[n]].Ua||"")+(d[e[n]].ub||""));c+=pb(this,a);0<h.length&&(c+="\n"+h.join("\n"));for(n=0;n<
e.length;n++)/onevent/.test(d[e[n]].ca)&&(d[e[n]].cb||d[e[n]].ma||d[e[n]].Ua)&&(c+="\n"+(d[e[n]].ca||"")+(d[e[n]].cb||"")+(d[e[n]].ma||"")+(d[e[n]].Ua||"")+(d[e[n]].ub||""));if(l){c+="\nonevent timer1\n"+q.join("")+l+v;for(n=0;n<m.length;n++)c+="eventCache["+n+"] = 0\n";for(n=0;n<r;n++)c+="todo["+n+"] = 0\n"}"\n"===c[0]&&(c=c.slice(1));var E=0;b=c.split("\n").map(function(a){return a.trim()}).map(function(a){function b(b){for(var c=lb(a),d=0;d<b.length;d++)if(c.slice(0,b[d].length)===b[d]&&!/^\w/.test(c.slice(b[d].length)))return!0;
return!1}if(0<a.length){var c=b("if else elseif for onevent sub when while".split(" "));b(["else","elseif","end","onevent","sub"])&&(E=Math.max(E-1,0));a="\t\t\t\t\t".slice(0,E)+a;c&&E++}return a});for(n=b.length-2;0<=n;n--)/^\s*#/.test(b[n])&&(k=b[n+1].replace(/^(\s*).*$/,"$1"),b[n]=k+b[n].replace(/^\s*/,""));c=b.join("\n");for(n=0;n<a.j.length;n++)for(b=n+1;b<a.j.length;b++)a.j[n].ff(a.j[b]);return c=kb(this.marks,c)};
qb.prototype.b=function(a){var b="# missing Aseba implementation for block "+a.T.name+"\n";switch(a.T.type){case "e":case "s":return{ma:b,bb:"1 == 1"};case "a":return{ya:b};default:return{}}};qa.aseba=new qb;function rb(){ib.call(this,"l2","&&","true")}rb.prototype=Object.create(ib.prototype);rb.prototype.constructor=rb;
rb.prototype.Wc=function(a,b){this.marks=[];var c=a.j.map(function(b){return nb(this,b,a)},this),d={},e=[];c.forEach(function(a){a.ca&&(d[a.ca]={ca:a.ca,ub:a.ub,cb:a.cb,ma:"",Ua:""},0>e.indexOf(a.ca)&&e.push(a.ca));a.Nd&&a.Nd.forEach(function(b,c){d[b]={ca:b,ub:a.vf[c],cb:a.wf[c],ma:"",Ua:""};0>e.indexOf(b)&&e.push(b)})});var f=[],g=[],h=[],m=[];c.forEach(function(b,c){b.kc&&b.kc.forEach(function(a){0>f.indexOf(a)&&f.push(a)});b.zc&&b.zc.forEach(function(a){0>g.indexOf(a)&&g.push(a)});b.jc&&b.jc.forEach(function(a){0>
h.indexOf(a)&&h.push(a)});if(b.ca&&(b.gb=m.indexOf(lb(b.bb||b.ca)),0>b.gb)){b.gb=m.length;m.push(lb(b.bb||b.ca));var e=d[b.ca];b.ma&&0>e.ma.indexOf(b.ma)&&(e.ma+=b.ma);e.Ua+=b.bb?"when ("+b.bb+") {\neventCache["+b.gb+"] = true;\n}\n":"eventCache["+b.gb+"] = true;\n"}b.ca||(b.ya=mb(this,b.ya||"",a.j[c]))},this);var k="";if(b){var p=new ua,n=new C(ta("init"),null,null);p.Ub(n,null,null,null);b.forEach(function(a){p.Ub(a,null,null,null)});k=nb(this,p,a).ya}var t=[],q="",l="",v=0;for(n=0;n<a.j.length;n++)0<=
c[n].gb?(c[n].Md&&c[n].Md.forEach(function(a){0>t.indexOf(a)&&t.push(a)}),q+="if (eventCache["+c[n].gb+"]"+(c[n].Yb?" && "+c[n].Yb:"")+") {\ntodo["+v+"] = true;\n}\n",l+="if (todo["+v+"]) {\n"+c[n].ya+"}\n",v++):c[n].Yb&&(q+="when ("+c[n].Yb+") {\ntodo["+v+"] = true;\n}\n",l+="if (todo["+v+"]) {\n"+c[n].ya+"}\n",v++);c=0<f.length?"\n"+f.join("\n"):"";0<m.length&&(c+="bool eventCache["+m.length+"] = false;\n");b?c+="\n"+k:(n="",0<g.length&&(n+="\n"+g.join("\n")),n&&(c+=(0<c.length?"\n":"")+n.slice(1)),
q&&(c+=(0<c.length?"\n":"")+"timer.period[1] = 50;\n"));for(n=0;n<e.length;n++)!/onevent/.test(d[e[n]].ca)&&(d[e[n]].cb||d[e[n]].ma||d[e[n]].Ua)&&(c+="\n"+(d[e[n]].ca||"")+(d[e[n]].cb||"")+(d[e[n]].ma||"")+(d[e[n]].Ua||"")+(d[e[n]].ub||""));c+=pb(this,a);0<h.length&&(c+="\n"+h.join("\n"));for(n=0;n<e.length;n++)/onevent/.test(d[e[n]].ca)&&(d[e[n]].cb||d[e[n]].ma||d[e[n]].Ua)&&(c+="\n"+(d[e[n]].ca||"")+(d[e[n]].cb||"")+(d[e[n]].ma||"")+(d[e[n]].Ua||"")+(d[e[n]].ub||""));q&&(c+="\nonevent timer1 {\n",
0<v&&(c+="bool todo["+v+"] = false;\n"),c+=t.join("")+q+l+"eventCache = false;\n}\n");"\n"===c[0]&&(c=c.slice(1));var r=0;b=c.split("\n").map(function(a){return a.trim()}).map(function(a){var b=lb(a);if(0<b.length){var c="{"===b.slice(-1);"}"===b[0]&&(r=Math.max(r-1,0));a="\t\t\t\t\t".slice(0,r)+a;c&&r++}return a});for(n=b.length-2;0<=n;n--)/^\s*#/.test(b[n])&&(q=b[n+1].replace(/^(\s*).*$/,"$1"),b[n]=q+b[n].replace(/^\s*/,""));c=b.join("\n");for(n=0;n<a.j.length;n++)for(b=n+1;b<a.j.length;b++)a.j[n].ff(a.j[b]);
return c=kb(this.marks,c)};rb.prototype.b=function(a){var b="// missing L2 implementation for block "+a.T.name+"\n";switch(a.T.type){case "e":case "s":return{ma:b,bb:"true"};case "a":return{ya:b};default:return{}}};qa.l2=new rb;function sb(){ib.call(this,"js","&&","true")}sb.prototype=Object.create(ib.prototype);sb.prototype.constructor=sb;
sb.prototype.Wc=function(a,b){this.marks=[];var c=a.j.map(function(b){return nb(this,b,a)},this),d={},e=[];c.forEach(function(a){a.ca&&(d[a.ca]={ca:a.ca,ub:a.ub,cb:a.cb,ma:"",Ua:""},0>e.indexOf(a.ca)&&e.push(a.ca));a.Nd&&a.Nd.forEach(function(b,c){d[b]={ca:b,ub:a.vf[c],cb:a.wf[c],ma:"",Ua:""};0>e.indexOf(b)&&e.push(b)})});var f=[],g=[],h=[],m=[],k=[],p=0;c.forEach(function(b,c){b.kc&&b.kc.forEach(function(a){0>f.indexOf(a)&&f.push(a)});b.zc&&b.zc.forEach(function(a){0>g.indexOf(a)&&g.push(a)});b.jc&&
b.jc.forEach(function(a){0>h.indexOf(a)&&h.push(a)});var e=b.ya||"";b.bb&&(e="cond = "+b.bb+";\nif (cond && !cond0["+p+"]) {\n"+e+"}\ncond0["+p+"] = cond;\n",p++);if(b.ca&&(b.gb=m.indexOf(lb(b.bb||b.ca)),0>b.gb)){b.gb=m.length;m.push(lb(b.bb||b.ca));var l=d[b.ca];b.ma&&0>l.ma.indexOf(b.ma)&&(l.ma+=b.ma);b.bb?(l.Ua+="cond = "+b.bb+";\nif (cond && !cond0["+p+"]) {\neventCache["+b.gb+"] = true;\n}\ncond0["+p+"] = cond;\n",p++):l.Ua+="eventCache["+b.gb+"] = true;\n"}b.ca||(b.ya=mb(this,e,a.j[c]));va(a.j[c])&&
k.push(c)},this);var n="";if(b){var t=new ua,q=new C(ta("init"),null,null);t.Ub(q,null,null,null);b.forEach(function(a){t.Ub(a,null,null,null)});n=nb(this,t,a).ya}var l=[],v="",r="",E=0;for(q=0;q<a.j.length;q++)0<=c[q].gb?(c[q].Md&&c[q].Md.forEach(function(a){0>l.indexOf(a)&&l.push(a)}),v+="if (eventCache["+c[q].gb+"]"+(c[q].Yb?" && "+c[q].Yb:"")+") {\ntodo["+E+"] = true;\n}\n",r+="if (todo["+E+"]) {\n"+c[q].ya+"}\n",E++):c[q].Yb&&(v+="cond = "+c[q].Yb+";\nif (cond && !cond0["+p+"]) {\ntodo["+E+"] = true;\n}\ncond0["+
p+"] = cond;\n",p++,r+="if (todo["+E+"]) {\n"+c[q].ya+"}\n",E++);0<p&&(f.unshift("var cond0;\nvar cond;\n"),g.unshift("cond0 = [];\n"));c=0<f.length?"\n"+f.join("\n"):"";0<m.length&&(c+="var eventCache = [];\n");0<E&&(c+="var todo = [];\n");b?c+="\n"+n:(q="",0<g.length&&(q+="\n"+g.join("\n")),v&&(q+="this.setTimer(1, 0.1, true);\n"),q&&(c+=(0<c.length?"\n":"")+'this.addEventListener("init", function (name, param) {\n'+q.slice(1)+"});\n"));if(0<h.length)throw"internal error, unsupported sub/onevent in js";
for(q=0;q<e.length;q++)if(d[e[q]].cb||d[e[q]].ma||d[e[q]].Ua)c+="\n"+(d[e[q]].ca||"")+(d[e[q]].cb||"")+(d[e[q]].ma||"")+(d[e[q]].Ua||"")+(d[e[q]].ub||"");if(v){c+='\nthis.addEventListener("timer1", function (name, param) {\n'+l.join("")+v+r;for(q=0;q<m.length;q++)c+="eventCache["+q+"] = false;\n";for(q=0;q<E;q++)c+="todo["+q+"] = false;\n"}0<c.trim().length&&(c+="});");"\n"===c[0]&&(c=c.slice(1));var u=0;b=c.split("\n").map(function(a){return a.trim()}).map(function(a){var b=lb(a);if(0<b.length){var c=
"{"===b.slice(-1);"}"===b[0]&&(u=Math.max(u-1,0));a="\t\t\t\t\t".slice(0,u)+a;c&&u++}return a});for(q=b.length-2;0<=q;q--)/^\s*#/.test(b[q])&&(v=b[q+1].replace(/^(\s*).*$/,"$1"),b[q]=v+b[q].replace(/^\s*/,""));c=b.join("\n");for(q=0;q<a.j.length;q++)for(b=q+1;b<a.j.length;b++)a.j[q].ff(a.j[b]);return c=kb(this.marks,c)};sb.prototype.b=function(a){var b="// missing JavaScript implementation for block "+a.T.name+"\n";switch(a.T.type){case "e":case "s":return{ma:b,bb:"true"};case "a":return{ya:b};default:return{}}};
qa.js=new sb;function tb(){ib.call(this,"python","and","True")}tb.prototype=Object.create(ib.prototype);tb.prototype.constructor=tb;
tb.prototype.Wc=function(a,b){this.marks=[];var c=a.j.map(function(b){return nb(this,b,a)},this),d={},e=[];c.forEach(function(a){a.ca&&(d[a.ca]={ca:a.ca,ub:a.ub,cb:a.cb,ma:"",Ua:""},0>e.indexOf(a.ca)&&e.push(a.ca));a.Nd&&a.Nd.forEach(function(b,c){d[b]={ca:b,ub:a.vf[c],cb:a.wf[c],ma:"",Ua:""};0>e.indexOf(b)&&e.push(b)})});var f=[],g=[],h=[],m=[],k=0;c.forEach(function(b,c){b.kc&&b.kc.forEach(function(a){0>f.indexOf(a)&&f.push(a)});b.zc&&b.zc.forEach(function(a){0>g.indexOf(a)&&g.push(a)});b.jc&&b.jc.forEach(function(a){0>
h.indexOf(a)&&h.push(a)});if(b.ca&&(b.gb=m.indexOf(lb(b.bb||b.ca)),0>b.gb)){b.gb=m.length;m.push(lb(b.bb||b.ca));var e=d[b.ca];b.ma&&0>e.ma.indexOf(b.ma)&&(e.ma+=b.ma);b.bb?(e.Ua+="cond = "+b.bb+"\nif cond and not cond0["+k+"]:\neventCache["+b.gb+"] = True\n<\ncond0["+k+"] = cond\n",k++):e.Ua+="eventCache["+b.gb+"] = True\n"}b.ca||(b.ya=mb(this,b.ya||"",a.j[c]))},this);if(b){var p=new ua,n=new C(ta("init"),null,null);p.Ub(n,null,null,null);b.forEach(function(a){p.Ub(a,null,null,null)});var t=nb(this,
p,a);t.kc.forEach(function(){});t.jc.forEach(function(){})}0<k&&g.unshift("cond0 = [False for i in range("+k+")]\n");var q=[],l="",v="",r=0;for(n=0;n<a.j.length;n++)0<=c[n].gb?(c[n].Md&&c[n].Md.forEach(function(a){0>q.indexOf(a)&&q.push(a)}),l+="if eventCache["+c[n].gb+"]"+(c[n].Yb?" and "+c[n].Yb:"")+":\ntodo["+r+"] = True\n<\n",v+="if todo["+r+"]:\n"+c[n].ya+"<\n",r++):c[n].Yb&&(l+="cond = "+c[n].Yb+"\nif cond and not cond0["+n+"]:\ntodo["+r+"] = 1\n<\ncond0["+n+"] = cond\n",v+="if todo["+r+"]:\n"+
c[n].ya+"<\n",r++);c=0<f.length?f.join("\n"):"";0<m.length&&(c+="eventCache = ["+m.map(function(){return"0"}).join(", ")+"]\n");if(0<r){c+="todo = [";for(n=0;n<r;n++)c+=0<n?", 0":"0";c+="]\n"}b?c+="\n"+t:(0<g.length&&(c+="\n"+g.join("\n")),l&&(c+=(0<c.length?"\n":"")+"thymio.timer.period[1] = 50\n"));for(n=0;n<e.length;n++)!/onevent/.test(d[e[n]].ca)&&(d[e[n]].cb||d[e[n]].ma||d[e[n]].Ua)&&(c+="\n"+(d[e[n]].ca||"")+(d[e[n]].cb||"")+(d[e[n]].ma||"")+(d[e[n]].Ua||"")+(d[e[n]].ub||""));c+=pb(this,a);
0<h.length&&(c+="\n"+h.join("\n"));for(n=0;n<e.length;n++)/onevent/.test(d[e[n]].ca)&&(d[e[n]].cb||d[e[n]].ma||d[e[n]].Ua)&&(c+="\n"+(d[e[n]].ca||"")+(d[e[n]].cb||"")+(d[e[n]].ma||"")+(d[e[n]].Ua||"")+(d[e[n]].ub||""));if(l){c+="\n@thymio.onevent(thymio.TIMER1)\ndef onevent_timer1():\n"+q.join("")+l+v;for(n=0;n<m.length;n++)c+="eventCache["+n+"] = False\n";for(n=0;n<r;n++)c+="todo["+n+"] = False\n";c+="<\n"}"\n"===c[0]&&(c=c.slice(1));c&&(c="import thymio\n\n"+c);c=lb(c);c=c.replace(/\n[ \t]+/g,"\n").replace(/\n<\n\n<\n/g,
"\n<\n<\n");var E=0,u="";c.split("\n").map(function(a){return a.trim()}).forEach(function(a){var b=lb(a);if(0<b.length){var c=":"===b.slice(-1);"<"===b&&(E=Math.max(E-1,0));"<"!==b&&(a="\t\t\t\t\t".slice(0,E)+a,c&&E++)}"<"!==b&&(u+=a+"\n")});c=u;for(n=0;n<a.j.length;n++)for(b=n+1;b<a.j.length;b++)a.j[n].ff(a.j[b]);return c=kb(this.marks,c)};
tb.prototype.b=function(a){var b="# missing Python implementation for block "+a.T.name+"\n";switch(a.T.type){case "e":case "s":return{ma:b,bb:"True"};case "a":return{ya:b};default:return{}}};qa.python=new tb;function ub(){qb.call(this)}ub.prototype=Object.create(ib.prototype);ub.prototype.constructor=ub;ub.prototype.Wc=function(a,b){a=qb.prototype.Wc.call(this,a,b);b=new vb(wb);a=new xb(b,a);a.S=yb;a=zb(a);return Ab(a,!0)};qa.asm=new ub;function Bb(a){this.I=[];this.b=a||null}y=Bb.prototype;y.add=function(a,b){this.I.push(new Cb(a,b))};y.find=function(a){for(var b=0;b<this.I.length;b++)if(this.I[b].name===a)return this.I[b];return null};function Db(a,b){a=a.find(b);return null!=a&&null!=a.b}function Eb(a,b){if(a.b){var c=a.find(b);b={cmd:b};c.w&&(b.selected=c.Na());c.u&&(b.state=c.getState());a.b({type:"cmd",data:b})}}y.nb=function(a,b){this.b&&this.b({type:"drop",data:{cmd:a}});(a=this.find(a))&&a.nb(b)};
y.fb=function(a,b){a=this.find(a);return null!=a&&a.fb(b)};y.aa=function(a){if(window.vplConfig&&window.vplConfig.ignoredCommands&&0<=window.vplConfig.ignoredCommands.indexOf(a))return!1;a=this.find(a);return null!=a&&a.aa()};y.isEnabled=function(a){a=this.find(a);return null!=a&&a.isEnabled()};y.Na=function(a){a=this.find(a);return null!=a&&a.Na()};y.getState=function(a){a=this.find(a);return null!=a?a.getState():null};
function Cb(a,b){this.name=a;this.G=b.isEnabled||null;this.w=b.Na||null;this.u=b.getState||null;this.b=b.action||null;this.i=b.nb||null;this.l=b.fb||null;this.Zc=b.object||null;this.hd=b.hd||!1;this.S=b.aa||null;this.kb=b.kb||null;this.uc=b.uc||null}function Fb(a,b){a.isEnabled()&&a.b&&a.b(a.Zc,b)}function Gb(a,b){if(!a.u)return!1;var c=a.getState();if(b===c)return!0;for(var d=0;100>d;d++){Fb(a,void 0);var e=a.getState();if(e===b)return!0;if(e===c)break}return!1}y=Cb.prototype;
y.nb=function(a){this.fb(a)&&this.i&&this.i(this.Zc,a)};y.fb=function(a){return null!=this.l&&this.l(this.Zc,a)};y.isEnabled=function(){return null==this.G||this.G(this.Zc)};y.Na=function(){return null!=this.w&&this.w(this.Zc)};y.getState=function(){return null!=this.u?this.u(this.Zc):null};y.aa=function(){return null==this.S||this.S(this.Zc)};function Hb(a){Ib||(Ua(),Ib=!0);this.Rc=a;this.ia=new Jb;this.l=new Ea;this.W=new Ca;var b=this;this.I=new Bb(function(a){b.log(a)});this.hc=null;this.G="vpl:close !space vpl:about vpl:help vpl:statement !space vpl:new vpl:save vpl:load vpl:upload vpl:nextProgram vpl:filename vpl:exportToHTML !space vpl:advanced !stretch vpl:readonly !stretch vpl:add-comment !stretch vpl:undo vpl:redo !stretch vpl:connected !stretch vpl:run vpl:stop !space vpl:slowdown vpl:debug vpl:robot !space vpl:flash !stretch vpl:sim vpl:text !stretch vpl:teacher-reset vpl:teacher-save vpl:teacher-setasnew vpl:teacher".split(" ");
this.u="!!stretch vpl:message-error vpl:message-warning !!stretch vpl:duplicate vpl:disable vpl:lock vpl:trashcan".split(" ");this.ec="src:close !space src:new src:save !space src:language src:disass !stretch src:run src:stop !stretch src:sim src:vpl !space src:locked !stretch src:teacher-reset src:teacher".split(" ");this.Ab="sim:close !stretch sim:restart sim:pause !space sim:speedup sim:noise !stretch sim:pen sim:clear !space sim:map-kind sim:map sim:map-ground sim:map-obstacles sim:map-height !stretch sim:vpl sim:text !stretch sim:teacher-reset sim:teacher".split(" ");
this.Ia=["vpl"];this.Xe={vpl:1,src:1,sim:1};this.pd=["ground","height","obstacles"];this.ve=this.Dg=this.Qf=this.Ke=this.ze=this.jf=null;this.Oc=!1;this.Xa={};this.username=null;this.j=new Ka(this.W);hb(this.j,function(a){b.log(a)});this.We=!1;this.wg=!0;this.Kb="";this.rd=!1;this.pb=null;this.ga=new Kb(a,{ia:this.ia,Wf:function(a){(b.pb=a)&&Lb(b)}});this.ga.state={bi:new Mb};this.za="";this.M=this.i=null;this.Fa=[];this.na=-1;this.Lg=this.me=!1;this.w=null;this.ga.Xa=function(){null!==b.w&&(b.w=
null,Lb(b))};this.ga.za=function(){Lb(b)};this.ha=null;this.Ld=[];this.tf=this.sd=null;this.S=new Nb;Ob(this.S);this.b=null;this.R=new Pb(this);Qb(this.ga,function(a,d){b.W.i||(a=b.R,a.i===Rb&&a.Qa===Rb)||(a.i=Rb,a.Qa=Rb,Lb(a.l));if(null!==b.b){a=b.b;var c=d.x;d=d.y;if(a.u&&c>=a.u.left&&c<a.u.right&&d>=a.u.top&&d<a.u.bottom){d=c-a.u.left;for(c=0;c<a.l.length&&d>a.l[c];c++);a=0===c?0===a.l.length||d<a.l[0]/2?0:1:c>=a.l.length?a.l.length:d<(a.l[c-1]+a.l[c])/2?c:c+1}else a=null;null==a?(b.b.finish(!0),
b.b=null):b.b.b=b.b.i=a}return!0})}var Ib=!1;function Sb(a){Tb(a.S,function(b){if(!a.W.l||0<=a.Ia.indexOf("src")||b.altKey||b.ctrlKey||b.metaKey)return!1;if(0<=a.Ia.indexOf("vpl")){a:{var c=a.I;for(var d=b.key,e=a.G.concat(a.u),f=0;f<c.I.length;f++)if((!e||0<=e.indexOf(c.I[f].name))&&c.I[f].uc&&c.I[f].uc===d&&c.I[f].aa()){c=c.I[f];break a}c=null}if(c)return Fb(c,b.altKey),!0}return!1});a.W.u&&Ub(a.R)}Hb.prototype.translate=function(a,b){return this.l.translate(a,b)};
function Vb(a,b){Xa(a.j,b);b=a.R;b.i=Rb;b.Qa=Rb;a.W.i&&(a.R.Qa=I,a.R.vb=0)}function Wb(a,b){a.ze=b?new Xb(b,a.W.l?{ld:function(){Yb(a.S,function(){a.ze.tc()})},kd:function(){a.S.b.pop()}}:null):null}
function Zb(a,b,c){var d=new $b;d.width=d.height=64;var e=ac(16,16),f=bc(function(b){(a.j.Zd||cc)("vpl:save",b,e,a.ia,["vpl","top","detached"],d,a.l,!0,!1,!1,null)},d.width,d.height,d,e,1);f='<img src="'+f.url+'" width='+f.width+" height="+f.height+">";f=b?new Xb(b,{hh:[{title:"\u21d3",Rh:f,Ja:function(){dc(b,"doc.html","text/html")}}],scroll:!0,ld:a.W.l?function(){Yb(a.S,function(){a.Qf.tc()})}:null,kd:a.W.l?function(){a.S.b.pop()}:null}):null;c?a.Dg=f:a.Qf=f}
function ec(a){if(a.Y){var b=a.G.concat(a.u).filter(function(a){return"!"!==a[0]&&this.I.aa(a)},a),c="b"===a.j.mode?a.j.Zb:a.j.gc;c.sort(function(a,b){a=H.indexOf(ta(a));b=H.indexOf(ta(b));return a<b?-1:a>b?1:0});a.Y.Ve={};var d=ac(100,100),e=fc(a,a.ia),f=gc(a,a.G,["vpl","top"]),g=gc(a,a.u,["vpl","bottom"]);a.hc={disabled:!1,aa:!0,ah:!1,isEnabled:!0,Na:!1,state:null};var h=hc(a,a.G,["vpl","top"],e.Dc,e.Hg,f),m=hc(a,a.u,["vpl","bottom"],e.Fd,e.Gg,g),k=50/f["vpl:new"].width;a.G.forEach(function(a){var b=
ic(h,a,f[a],d,k);b&&(a="vpl:cmd:"+a.replace(/:/g,"-"),this.Y.Ve[a]=b.url)},a);a.u.forEach(function(a){var b=ic(m,a,g[a],d,k);b&&(a="vpl:cmd:"+a.replace(/:/g,"-"),this.Y.Ve[a]=b.url)},a);a.hc=null;H.forEach(function(a){try{var b=new C(a,null,null);b.h=a.eb?a.eb():b.h;var c="vpl:block:"+a.name.replace(/ /g,"-"),e=b.toDataURL(this.ia,d,1);this.Y.Ve[c]=e}catch(l){}},a);b=a.Y.Wc(a.l.language,b,c,a.Xa);Zb(a,b)}}
function jc(a,b){var c=a.Oc;c&&a.ve&&a.ve.tc();a.ve=b?new Xb(b,{Uh:!0}):null;b&&c&&a.ve.show()}
Hb.prototype.ob=function(a,b){function c(){0<=a.indexOf("vpl")&&J(d.ga);0<=a.indexOf("src")&&J(d.N.Ta);0<=a.indexOf("sim")&&J(d.i)}var d=this;b&&(b.ra||b.Jg)&&(this.j.ra=!0,this.N.ra=!0,kc(this.N,!1));if(1===a.length&&b&&b.ke&&1<this.Ia.length){if(0<=this.Ia.indexOf(a[0]))return;var e=this.Ia.slice();e[this.Ia[0]===b.ke?1:0]=a[0];a=e}else b&&b.pe?0>this.Ia.indexOf(a[0])&&(a=this.Ia.concat(a)):1===a.length&&b&&b.Ef&&1<this.Ia.length&&0<=this.Ia.indexOf(a[0])?(this.Ia.splice(this.Ia.indexOf(a[0]),1),
a=this.Ia):1===a.length&&b&&b.toggle&&(0<=this.Ia.indexOf(a[0])?(this.Ia.splice(this.Ia.indexOf(a[0]),1),a=this.Ia):a=this.Ia.concat(a));this.Ia=a;null!=this.M&&this.i.tc();this.ga.tc();null!=this.N&&(document.getElementById("src-editor").style.display=0<=a.indexOf("src")?"block":"none",this.N.Ta.tc());0<=a.indexOf("vpl")&&this.ga.show();0<=a.indexOf("src")&&this.N.Ta.show();null!=this.M&&0<=a.indexOf("sim")&&this.i.show();lc(this,window.innerWidth<window.innerHeight);for(e=0;e<a.length;e++)switch(a[e]){case "vpl":this.ga.ta=
function(){if(!d.j.ra){d.j.code={};Ya(d.j);if(d.N){var a=d.N,b=d.j.xc(d.j.xb);if(a.Dd){var c=a.Ge(a.language,b);null!==c&&(mc(a,c,!0),a.Cc.Jb.readOnly=!0,a.Dd=b)}else mc(a,b)}d.log()}Lb(d)};break;case "src":kc(this.N,!(b&&(b.ra||b.Jg)));this.N.focus();this.N.resize(window.innerWidth,window.innerHeight);break;case "sim":this.i.ta=function(){nc(d)}}b&&(b.Ef||b.pe)&&oc(d);this.ga&&(this.ga.yb=c);this.N&&this.N.Ta&&(this.N.Ta.yb=c);this.i&&(this.i.yb=c);0<=a.indexOf("vpl")&&(this.ga.ta(),this.ga.yb?this.ga.yb():
J(this.ga));0<=a.indexOf("src")&&(pc(this),this.N.Ta.yb?this.N.Ta.yb():J(this.N.Ta));0<=a.indexOf("sim")&&(this.start(!1),this.i.ta(),this.i.yb?this.i.yb():J(this.i))};Hb.prototype.setView=Hb.prototype.ob;
function lc(a,b){for(var c=a.Ia.map(function(a){return this.Xe[a]},a),d=c.reduce(function(a,b){return a+b},0),e=0,f=0;f<a.Ia.length;f++){var g=b?{Z:0,oa:1,ba:e,pa:e+c[f]/d}:{Z:e,oa:e+c[f]/d,ba:0,pa:1};e+=c[f]/d;switch(a.Ia[f]){case "vpl":qc(a.ga,g);break;case "src":qc(a.N.Ta,g);break;case "sim":qc(a.i,g)}}}
function oc(a){var b=a.ga.b.parentElement.getBoundingClientRect(),c=b.width;b=window.innerHeight-b.top;lc(a,c<b);window.vplDisableResize&&(b=a.ga.b.getBoundingClientRect(),c=b.width,b=b.height);a.ga.resize(c,b);a.N&&a.N.resize(c,b);a.M&&a.i.resize(c,b);a.Ia.forEach(function(a){switch(a){case "vpl":Lb(this);break;case "src":J(this.N.Ta);break;case "sim":this.M&&nc(this)}},a);a.ze&&rc(a.ze)}
function sc(a,b){if(0<=a.na){var c=null;b&&(c=ta("!stop and blink"));c||(c=ta("!stop"));b=a.j.xb;(c=c&&c.Rb[b])&&a.Fa[a.na].Pa.mc(c(null).ya,b)}}function tc(a){return!a.j.ra&&a.Fa[a.na].Pa.isEnabled(a.j.xb)}function uc(a,b){a.Ld.push(b)}
Hb.prototype.log=function(a){if(null==a){vc(this);a={type:"vpl-changed",data:{filename:this.j.filename,nrules:this.j.j.reduce(function(a,b){return 0<b.X.length+b.actions.length?a+1:a},0),nblocks:this.j.j.reduce(function(a,b){return a+b.X.length+b.actions.length},0),uploadedToServer:this.j.oc,error:this.Kb&&!this.rd?this.Kb:null,warning:this.Kb&&this.rd?this.Kb:null,"error-tr":this.Kb&&!this.rd?this.l.translate(this.Kb):null,"warning-tr":this.Kb&&this.rd?this.l.translate(this.Kb):null,robot:0<=this.na?
this.Fa[this.na].Pa.isConnected()&&this.Fa[this.na].Pa.getName():null}};var b=JSON.stringify(a);if(b===this.sd)return;this.sd=b}this.Ld.forEach(function(b){try{b(a)}catch(d){}})};function wc(a){function b(b){function d(b){for(var c=0;c<E.length;c++)if(E[c].uri){var d=xc(E[c].uri);if(a.Fb[d.Vc].qg(b,d.id))return!0}return!1}var e=b.name;if("!"===e[0])return 0;var h=0;/^\w/.test(e)||(c+='Bad block name "'+e+'"\n',h++);var m=b.defaultParameters,k=b.typicalParameters,p=b.buttons,n=b.radiobuttons,t=b.sliders,q=b.rotating,l=b.diffwheelmotion,v=b.score,r=b.otherParameters?parseInt(b.otherParameters,10):0,E=b.draw;if(E){b=null;for(var u=0;u<E.length;u++)if(E[u].uri)if(null==b){b=xc(E[u].uri).Vc;
var w=a.Fb[b]}else{var D=xc(E[u].uri);D.Vc!==b?(c+='In block "'+e+'", multiple svg\n',h++):w.Jc(D.id)||(c+='In block "'+e+'", uri "'+E[u].uri+'" not found\n',h++)}}p&&p.forEach(function(a){w.Jc(a.id)?d(a.id)||(c+='In block "'+e+'", button id "'+a.id+'" not displayed\n',h++):(c+='In block "'+e+'", button id "'+a.id+'" not found\n',h++);void 0==a.val?(c+='In block "'+e+'", missing property "val"\n',h++):void 0==a.st?(c+='In block "'+e+'", missing property "st"\n',h++):a.val.length!==a.st.length&&(c+=
'In block "'+e+'", properties "val" and "st" have different lengths\n',h++)});n&&n.forEach(function(a){w.Jc(a.id)?d(a.id)?void 0==a.val?(c+='In block "'+e+'", missing property "val"\n',h++):a.val instanceof Array?(c+='In block "'+e+'", illegal array in property "val"\n',h++):void 0==a.st?(c+='In block "'+e+'", missing property "st"\n',h++):2!==a.st.length&&(c+='In block "'+e+'", property "st" must have length 2\n',h++):(c+='In block "'+e+'", radiobutton id "'+a.id+'" not displayed\n',h++):(c+='In block "'+
e+'", radiobutton id "'+a.id+'" not found\n',h++)});t&&t.forEach(function(a){w.Jc(a.id)?d(a.id)||(c+='In block "'+e+'", slider id "'+a.id+'" not displayed\n',h++):(c+='In block "'+e+'", slider id "'+a.id+'" not found\n',h++);w.Jc(a.thumbId)?d(a.thumbId)||(c+='In block "'+e+'", slider thumbId "'+a.thumbId+'" not displayed\n',h++):(c+='In block "'+e+'", slider thumbId "'+a.thumbId+'" not found\n',h++);void 0==a.min&&(c+='In block "'+e+'", slider min undefined\n',h++);void 0==a.max&&(c+='In block "'+
e+'", slider max undefined\n',h++);a.lowerPartId&&!w.Jc(a.lowerPartId)&&(c+='In block "'+e+'", slider lowerPartId "'+a.lowerPartId+'" not found\n',h++);if(a.snap&&(a=a.snap,a instanceof Array))for(var b=0;b<a.length;b++)"string"===typeof a[b]?/^`.+`$/.test(a[b])||(c+='In block "'+e+'", invalid slider snap expression\n',h++):"number"!==typeof a[b]&&(c+='In block "'+e+'", slider snap must be a number or a string\n',h++)});q&&q.forEach(function(a){var b=a.id,f=a.centerId;a=a.thumbId;w.Jc(b)?d(b)||(c+=
'In block "'+e+'", rotating id "'+b+'" not displayed\n',h++):(c+='In block "'+e+'", rotating id "'+b+'" not found\n',h++);w.Jc(f)||(c+='In block "'+e+'", rotating centerId "'+f+'" not found\n',h++);w.Jc(a)?d(a)||(c+='In block "'+e+'", rotating thumbId "'+a+'" not displayed\n',h++):(c+='In block "'+e+'", rotating thumbId "'+a+'" not found\n',h++);w.qg(a,b)||(c+='In block "'+e+'", rotating thumbId "'+a+'" not a descendent of id "'+b+'"\n',h++)});l&&(w.Jc(l.id)?d(l.id)||(c+='In block "'+e+'", diffwheelmotion id "'+
l.id+'" not displayed\n',h++):(c+='In block "'+e+'", diffwheelmotion id "'+l.id+'" not found\n',h++));v&&(w.Jc(v.id)?d(v.id)||(c+='In block "'+e+'", score id "'+v.id+'" not displayed\n',h++):(c+='In block "'+e+'", score id "'+v.id+'" not found\n',h++),"number"!==typeof v.numHeights||v.numHeights!==Math.round(v.numHeights)||0>=v.numHeights)&&(c+='In block "'+e+'", score numHeights must be a strictly positive integer\n',h++);(p||n||t||q||v||0<r)&&!m&&(c+='In block "'+e+'", missing defaultParameters\n',
h++);m&&(l=0,p&&(l+=p.length),n&&(l+=1),t&&(l+=t.length),q&&(l+=q.length),v&&(l+=2*Math.floor((m.length-l)/2)),l+=r,l!==m.length?(c+='In block "'+e+'", defaultParameters.length='+m.length+", needs "+l+" parameters\n",h++):k&&k.length!=l&&(c+='In block "'+e+'", typicalParameters.length='+k.length+", needs "+l+" parameters\n",h++));return h}var c="",d=0;a.blocks&&a.blocks.forEach(function(a){d+=b(a)});0<d&&(c+=d+" error"+(1<d?"s":"")+"\n");return c||null};function yc(a){a.I.add("vpl:close",{action:function(a){a.ob(["vpl"],{Ef:!0})},object:a,aa:function(a){return 1<a.Ia.length&&0<=a.Ia.indexOf("vpl")},uc:"w"});a.I.add("vpl:about",{action:function(a){a.ze.show()},object:a,aa:function(a){return null!=a.ze},uc:"i"});a.I.add("vpl:help",{action:function(a){a.Qf.show()},object:a,aa:function(a){return null!=a.Qf},uc:"?"});a.I.add("vpl:statement",{action:function(a){a.Dg.show()},object:a,aa:function(a){return null!=a.Dg}});a.I.add("vpl:readonly",{isEnabled:function(){return!1},
object:a,aa:function(a){return a.j.readOnly||a.j.ra}});a.I.add("vpl:suspend",{action:function(a){a.Oc=!a.Oc;a.Oc?(tc(a)&&(sc(a,!0),a.j.Qb=!1),a.ve.show()):a.ve.tc()},Na:function(a){return a.Oc},object:a,aa:function(a){return a.j.Vb===La&&null!=a.ve}});a.I.add("vpl:new",{action:function(a){Vb(a);a.jf&&zc(a,a.jf);ab(a.j);Lb(a)},isEnabled:function(a){return!a.j.ra&&!a.j.readOnly&&!a.j.Ob()},object:a,aa:function(a){return!a.j.readOnly},uc:"n"});a.I.add("vpl:save",{action:function(a,c){c?(a=Ac(a,a.ia),
dc(a,"vpl-program.html","text/html")):(c=db(a.j,{jd:!0,md:!0}),dc(c,a.j.filename||"program.vpl3","application/x-vpl3"))},isEnabled:function(a){return!a.j.ra&&!a.j.Ob()},object:a,aa:function(a){return!a.j.readOnly},uc:"s"});a.I.add("vpl:load",{action:function(a){a.Ke.show("Open program file",".aesl,.json,.vpl3,.vpl3ui",function(b){Bc(a,b);ab(a.j)})},isEnabled:function(a){return!a.j.ra&&!a.j.readOnly},object:a,aa:function(a){return!a.j.readOnly},uc:"o"});a.I.add("vpl:upload",{action:function(a){var b=
db(a.j,{jd:!1,md:!0});window.vplUpload(a.j.filename,b);a.j.oc=!0;a.wg=!1},isEnabled:function(a){return!a.j.ra&&!a.j.readOnly&&!a.j.Ob()},Na:function(a){return a.j.oc},getState:function(a){return a.j.Ob()?"empty":a.j.oc?"uploaded":a.wg?"canUpload":"canUploadAgain"},object:a,aa:function(a){return null!=window.vplUpload&&!a.j.readOnly}});a.I.add("vpl:nextProgram",{action:function(a){var b=db(a.j,{jd:!1,md:!0});b=window.vplNextProgram(a.j.filename,b);zc(a,b);b=JSON.parse(b);a.j.filename=b.filename||"program.vpl3"},
isEnabled:function(a){return null!=window.vplNextProgram(a.j.filename,null)},object:a,aa:function(){return null!=window.vplNextProgram}});a.I.add("vpl:exportToHTML",{action:function(a,c){c?(a=Cc(a,a.ia),dc(a,"vpl-ui.html","text/html")):(a=Ac(a,a.ia),dc(a,"vpl-program.html","text/html"))},isEnabled:function(a){return!a.j.ra&&!a.j.Ob()},object:a,uc:"h"});a.I.add("vpl:text",{action:function(a){a.me?a.ob(["src"],{pe:!0}):a.ob(["src"],{ke:"vpl"})},isEnabled:function(a){return!a.j.ra},nb:function(a,c){if(c.data instanceof
C&&c.data.Db){if(c=fb(a.j.xb,c.data))a.ob(["src"]),a.N.Xf(c.be,c.end)}else c.data instanceof ua&&(c=fb(a.j.xb,c.data))&&(a.ob(["src"]),a.N.Xf(c.be,c.end))},fb:function(a,c){return c.data instanceof C&&null!=c.data.Db||c.data instanceof ua},object:a,aa:function(a){return a.N&&0>a.Ia.indexOf("src")}});a.I.add("vpl:text-toggle",{action:function(a){a.ob(["src"],{toggle:!0})},isEnabled:function(a){return!a.j.ra},Na:function(a){return 0<=a.Ia.indexOf("src")},object:a,kb:[{selected:!1},{selected:!0}]});
a.I.add("vpl:advanced",{action:function(a){cb(a.j,"b"===a.j.mode?"a":"b");ec(a)},isEnabled:function(a){return!a.j.ra&&!a.j.readOnly},Na:function(a){return"a"===a.j.mode},object:a,aa:function(a){return Ta&&!a.j.readOnly},kb:[{selected:!1},{selected:!0}]});a.I.add("vpl:undo",{action:function(a){a.j.ag(function(){Lb(a);ab(a.j)})},isEnabled:function(a){return!a.j.ra&&0<a.j.qd.Ec.length},object:a,aa:function(a){return!a.j.readOnly},uc:"z"});a.I.add("vpl:redo",{action:function(a){a.j.xg(function(){Lb(a);
ab(a.j)})},isEnabled:function(a){return!a.j.ra&&0<a.j.qd.zd.length},object:a,aa:function(a){return!a.j.readOnly},uc:"y"});a.I.add("vpl:add-comment",{action:function(a){a.j.zb();var b=a.R.Qa===I?a.R.vb:null,d=a.j,e=new Ba("");null!=b&&b<d.j.length?d.j.splice(b,0,e):0!==d.j.length&&d.j[d.j.length-1].Ob()?(b=d.j.length-1,d.j.splice(b,0,e)):(b=d.j.length,d.j.push(e));Ya(d);ab(a.j);Dc(a,b);Lb(a)},isEnabled:function(a){return!a.j.ra},object:a,aa:function(a){return!a.j.readOnly}});a.I.add("vpl:run",{action:function(a){var b=
a.j.xc(a.j.xb);a.Fa[a.na].Pa.mc(b,a.j.xb);a.j.Qb=!0;a.j.tg=!1},isEnabled:function(a){if(a.j.ra||!a.Fa[a.na].Pa.isEnabled(a.j.xb))return!1;a=a.j.getError();return null==a||a.Sb},Na:function(a){return a.j.Qb},getState:function(a){if(a.j.Ob())return"empty";if(a.j.Qb)return"running";var b=a.j.getError();return b&&!b.Sb?"error":a.j.tg?"canLoad":"canReload"},nb:function(a,c){c.data instanceof C?c.data.Db?(c=qa[a.j.xb].Wc(a.j,[c.data]),a.Fa[a.na].Pa.mc(c,a.j.xb)):a.ga.Lb=Ec(a.ga,c):c.data instanceof ua&&
(c=qa[a.j.xb].Wc(a.j,c.data.actions),a.Fa[a.na].Pa.mc(c,a.j.xb))},fb:function(a,c){if(a=0<=a.na&&a.Fa[a.na].Pa.isEnabled(a.j.xb)&&c.data instanceof ua)a:{a=c.data;for(var b=0;b<a.X.length;b++)if("a"===a.X[b].T.type){a=!0;break a}for(b=0;b<a.actions.length;b++)if("a"===a.actions[b].T.type){a=!0;break a}a=!1}return a||c.data instanceof C&&null!=c.data.Db&&"a"===c.data.T.type},object:a,aa:function(a){return 0<=a.na},kb:[{selected:!1},{selected:!0},{state:"empty"},{state:"running"},{state:"error"},{state:"canLoad"},
{state:"canReload"}],uc:"r"});a.I.add("vpl:stop",{action:function(a){sc(a);a.j.Qb=!1},isEnabled:function(a){return tc(a)},object:a,aa:function(a){return 0<=a.na},uc:"."});a.I.add("vpl:stop-abnormally",{action:function(a){sc(a,!0);a.j.Qb=!1},isEnabled:function(a){return tc(a)},object:a,aa:function(a){return 0<=a.na}});a.I.add("vpl:slowdown",{action:function(a){var b=[.1,.2,.5,1];a.j.sf=b[(b.indexOf(a.j.sf)+1)%b.length]},Na:function(a){return 1!==a.j.sf},getState:function(a){return a.j.sf},object:a,
kb:[{selected:!0,state:.1},{selected:!0,state:.2},{selected:!0,state:.5},{selected:!1,state:1}]});a.I.add("vpl:debug",{action:function(){},Na:function(){return!1},object:a,aa:function(){return!1},kb:[{selected:!1},{selected:!0}]});a.I.add("vpl:flash",{action:function(a){var b=a.j.xc(a.j.xb);a.Fa[a.na].Pa.Lf(b,a.j.xb);a.j.wc=!0},isEnabled:function(a){if(a.j.ra||!a.Fa[a.na].Pa.ef(a.j.xb))return!1;a=a.j.getError();return null==a||a.Sb},Na:function(a){return a.j.wc},object:a,aa:function(a){return 0<=
a.na&&null!=a.Fa[a.na].Pa.mg}});a.I.add("vpl:connected",{Na:function(a){return!a.j.ra&&a.Fa[a.na].Pa.isConnected()},getState:function(a){return a.tf?"monitored":!1===a.tf?"nonmonitored":""},object:a,aa:function(a){return 0<=a.na},kb:[{selected:!1},{selected:!0},{selected:!1,state:"monitored"},{selected:!0,state:"monitored"},{selected:!1,state:"nonmonitored"},{selected:!0,state:"nonmonitored"}]});a.I.add("vpl:robot",{action:function(a){a.na=(a.na+1)%a.Fa.length},getState:function(a){return a.Fa[a.na].name},
object:a,aa:function(a){return 1<a.Fa.length}});a.I.add("vpl:volume",{action:function(a){var b=[null,8,7,6,5,4,3,2,1,0];a.j.volume=b[(b.indexOf(a.j.volume)+1)%b.length]},Na:function(a){return null!==a.j.volume},getState:function(a){return null===a.j.volume?"":a.j.volume.toString(10)},object:a,kb:[{selected:!1,state:""},{selected:!0,state:"8"},{selected:!0,state:"7"},{selected:!0,state:"6"},{selected:!0,state:"5"},{selected:!0,state:"4"},{selected:!0,state:"3"},{selected:!0,state:"2"},{selected:!0,
state:"1"},{selected:!0,state:"0"}]});a.I.add("vpl:sim",{action:function(a){a.me?a.ob(["sim"],{pe:!0}):a.ob(["sim"],{ke:"vpl"})},isEnabled:function(a){return!a.j.ra},object:a,aa:function(a){return 0<=a.na&&null!=a.M&&0>a.Ia.indexOf("sim")}});a.I.add("vpl:duplicate",{isEnabled:function(a){return!a.j.ra},nb:function(a,c){var b=a.j.j.indexOf(c.data);0<=b&&(a.j.zb(),a.j.j.splice(b+1,0,c.data.qb()),ab(a.j),a.ga.ta&&a.ga.ta(),a.log())},fb:function(a,c){return c.data instanceof ua&&!c.data.Ob()},object:a,
aa:function(a){return!a.j.readOnly}});a.I.add("vpl:disable",{isEnabled:function(a){return!a.j.ra},nb:function(a,c){c.data instanceof C?(a.j.zb(),c.data.disabled=!c.data.disabled,ab(a.j),a.ga.ta&&a.ga.ta(),a.log()):c.data instanceof ua&&(a.j.zb(),c=c.data,c.disabled=!c.disabled,c.disabled&&(c.error=null),a.ga.ta&&a.ga.ta(),a.log())},fb:function(a,c){return c.data instanceof ua?!c.data.Ob():c.data instanceof C&&null!==c.data.Db},object:a,aa:function(a){return!a.j.readOnly}});a.I.add("vpl:lock",{isEnabled:function(a){return!a.j.ra},
nb:function(a,c){c.data instanceof C?(a.j.zb(),c.data.locked=!c.data.locked,ab(a.j),a.ga.ta&&a.ga.ta(),a.log()):c.data instanceof ua&&(a.j.zb(),c.data.locked=!c.data.locked,a.ga.ta&&a.ga.ta(),a.log())},fb:function(a,c){return c.data instanceof ua?!c.data.Ob():c.data instanceof C&&null!==c.data.Db},object:a,aa:function(a){return a.j.Zg&&"t"===a.j.Vb&&!a.j.readOnly}});a.I.add("vpl:trashcan",{isEnabled:function(a){return!a.j.ra},nb:function(a,c){c.data instanceof C?null!==c.data.Db&&(a.j.zb(),c.data.Db.yg(c.data.Me),
ab(a.j),a.ga.ta&&a.ga.ta(),a.log()):c.data instanceof ua&&(c=a.j.j.indexOf(c.data),0<=c&&(a.j.zb(),a.j.j.splice(c,1),ab(a.j),a.ga.ta&&a.ga.ta(),a.log()))},fb:function(a,c){return c.data instanceof C?null!==c.data.Db&&!c.data.locked:c.data instanceof ua&&(!c.data.Ob()||a.j.j.indexOf(c.data)+1<a.j.j.length)&&!c.data.locked},object:a,aa:function(a){return!a.j.readOnly}});a.I.add("vpl:message-error",{isEnabled:function(){return!1},getState:function(a){return a.Kb},object:a,aa:function(a){return a.Kb&&
!a.rd}});a.I.add("vpl:message-warning",{isEnabled:function(){return!1},getState:function(a){return a.Kb},object:a,aa:function(a){return a.Kb&&a.rd}});a.I.add("vpl:message-empty",{isEnabled:function(){return!1},object:a,aa:function(a){return!a.Kb}});a.I.add("vpl:filename",{isEnabled:function(){return!1},getState:function(a){return(a.j.filename||"")+(a.username?"\n"+a.username:"")},object:a,aa:function(a){return a.j.filename||a.username?!0:!1}});a.I.add("vpl:teacher",{action:function(a){a.j.W.sb=!a.j.W.sb;
"t"===a.j.Vb?a.j.W.cc=a.j.W.sb:a.j.W.we=a.j.W.sb;a.j.W.sb||ec(a)},isEnabled:function(a){return!a.j.ra&&!a.j.readOnly},Na:function(a){return a.j.W.sb},object:a,hd:!0,aa:function(a){return a.j.Vb!==La&&!a.j.readOnly},kb:[{selected:!1},{selected:!0}]});a.I.add("vpl:teacher-reset",{action:function(a,c){c?(Wa(a.j.mode),a.j.Zb=Pa,a.j.gc=Ra):(Ua(),Xa(a.j),a.j.Ne())},isEnabled:function(a){return!a.j.ra},object:a,hd:!0,aa:function(a){return a.j.Vb!==La&&a.j.W.sb&&!a.j.readOnly}});a.I.add("vpl:teacher-save",
{action:function(a){a=db(a.j,{jd:!0,md:!1});dc(a,"ui.vpl3ui","application/x-vpl3-ui")},isEnabled:function(a){return!a.j.ra},object:a,hd:!0,aa:function(a){return a.j.Vb!==La&&a.j.W.sb&&!a.j.readOnly}});a.I.add("vpl:teacher-setasnew",{action:function(a){var b=db(a.j,{jd:!0,md:!1});a.jf=a.jf===b?null:b},Na:function(a){return a.jf===db(a.j,{jd:!0,md:!1})},object:a,hd:!0,aa:function(a){return a.j.Vb!==La&&a.j.W.sb&&!a.j.readOnly},kb:[{selected:!1},{selected:!0}]})};function Fc(a){this.i=a;this.controls=[];this.b="";this.y=this.x=0}function Gc(a,b,c,d,e){a.controls.push({L:b,Ea:d||null,id:e||"",bd:c,x:0,y:0});a.b+="X"}
function Hc(a,b,c,d){a.x=b.x;a.y=b.y;for(var e=a.b.replace(/^[s ]+/,"").replace(/[s ]+$/,"").replace(/ +/g," ").replace(/s +/g,"s").replace(/ +s/g,"s").replace(/s+/g,"s"),f=0,g=0,h=0,m=0,k=0;k<e.length;k++)switch(e[k]){case "X":f+=L(c[a.controls[m].id]);m++;break;case " ":case "_":g++;break;case "s":case "S":h++}d=d?L(d):0;var p=0;if(f>=b.width)d=0;else for(;;){p=(b.width-(f+d*g))/h;if(p>=d||!(0<d))break;d/=2}m=0;f=b.x;for(k=0;k<e.length;k++)switch(e[k]){case "X":g=a.controls[m];g.x=f+c[g.id].offsetLeft();
f+=L(c[g.id]);g.y=b.y+c[g.id].offsetTop();m++;break;case " ":case "_":f+=d;break;case "s":case "S":f+=p}}
function Ic(a,b,c,d){Jc(a.i,function(c){Kc(b,c,a.x,a.y)});a.controls.forEach(function(b){Lc(this.i,b.x,b.y,c[b.id],function(c,d,e){var f=Math.min(d.width/(b.bd.oa-b.bd.Z),d.height/(b.bd.pa-b.bd.ba));c.save();c.translate(-b.bd.Z,-b.bd.ba);1!==f&&(c.scale(f,f),d=d.qb(),d.width/=f,d.height/=f);b.L(c,d,e)&&Mc(a.i,0,0,d.width,d.height,["button"],["button"]);c.restore()},{action:b.Ea.action||null,nb:b.Ea.nb||null,fb:b.Ea.fb||null,vc:d?function(){d(b.id)}:null},b.id)},a)};function cc(a,b,c,d,e,f,g,h,m,k,p){function n(a,d,e){b.save();e&&(b.scale(-1,1),b.translate(-2*a-c.g,0));b.fillStyle=k&&h?l.Ca:l.wa;b.fillRect(a,d,c.g,c.g);b.fillStyle=h?l.U:l.da;b.beginPath();b.moveTo(a+.1*c.g,d+.6*c.g);b.lineTo(a+.4*c.g,d+.6*c.g);b.lineTo(a+.25*c.g,d+.34*c.g);b.closePath();b.fill();b.beginPath();b.arc(a+.5*c.g,d+.83*c.g,.4*c.g,4.2,5.6);b.strokeStyle=b.fillStyle;b.lineWidth=.08*c.g;b.stroke();b.restore()}function t(a,d,e){var f=c.g;b.save();b.fillStyle=k?l.Ca:l.wa;b.fillRect(a,d,
f,f);b.translate(a+f/2,d+f/2);b.rotate(-e*Math.PI/2);b.translate(-a-f/2,-d-f/2);b.beginPath();b.moveTo(a+.3557*f,d+.25*f);b.lineTo(a+.3557*f,d+.75*f);b.lineTo(a+.7887*f,d+.5*f);b.closePath();b.strokeStyle=l.U;b.lineWidth=2*c.Da;b.stroke();b.restore()}function q(){b.beginPath();b.moveTo(0,.5*c.g);b.lineTo(.5*c.g,.5*c.g);b.lineTo(.5*c.g,-.25*c.g);b.bezierCurveTo(.3*c.g,-.5*c.g,.02*c.g,-.5*c.g,0,-.5*c.g);b.lineTo(0,-.5*c.g);b.bezierCurveTo(-.02*c.g,-.5*c.g,-.3*c.g,-.5*c.g,-.5*c.g,-.25*c.g);b.lineTo(-.5*
c.g,.5*c.g);b.closePath();b.fillStyle=h?l.U:l.da;b.fill()}var l={wa:"navy",Ca:"#37f",ud:"#06f",U:"white",da:"#777",Ic:"#44a",jg:"#ddf",ie:"#99a",Ze:"#a00",dg:"#d10",$e:"#d00",eg:"#f50",je:"#c66",kg:"#800"};l={wa:"white",Ca:"#ddd",ud:"white",U:"#333",da:"#999",Ic:"#ddd",jg:"#555",ie:"#666",Ze:"#fcc",dg:"#fcc",$e:"#faa",eg:"#faa",je:"#866",kg:"#faa"};var v={"vpl:close":function(){b.fillStyle=k&&h?l.Ca:l.wa;b.fillRect(0,0,.5*c.g,c.g);b.beginPath();b.moveTo(.1*c.g,.1*c.g);b.lineTo(.4*c.g,.4*c.g);b.moveTo(.1*
c.g,.4*c.g);b.lineTo(.4*c.g,.1*c.g);b.strokeStyle=h?l.U:l.da;b.lineWidth=c.Da;b.stroke()},"vpl:about":function(){b.fillStyle=k&&h?l.Ca:l.wa;b.fillRect(0,0,c.g,c.g);b.textAlign="center";b.textBaseline="middle";b.font="bold "+Math.round(.7*c.g).toString(10)+"px times";b.fillStyle=h?l.U:l.da;b.fillText("i",.5*c.g,.5*c.g)},"vpl:help":function(){b.fillStyle=k&&h?l.Ca:l.wa;b.fillRect(0,0,c.g,c.g);b.textAlign="center";b.textBaseline="middle";b.font="bold "+Math.round(.7*c.g).toString(10)+"px times";b.fillStyle=
h?l.U:l.da;b.fillText("?",.5*c.g,.5*c.g)},"vpl:statement":function(){b.fillStyle=k&&h?l.Ca:l.wa;b.fillRect(0,0,c.g,c.g);b.strokeStyle=h?l.U:l.da;b.fillStyle=h?l.U:l.da;b.lineWidth=c.Da;b.strokeRect(.25*c.g,.2*c.g,.5*c.g,.6*c.g);b.beginPath();b.arc(.33*c.g,.4*c.g,.03*c.g,0,2*Math.PI);b.arc(.33*c.g,.6*c.g,.03*c.g,0,2*Math.PI);b.fill();for(var a=0;5>a;a++)b.beginPath(),b.moveTo(.4*c.g,c.g*(.32+.1*a)),b.lineTo(.7*c.g,c.g*(.32+.1*a)),b.stroke(),b.lineWidth=.01*c.g,b.setLineDash([.02*c.g,.02*c.g])},"vpl:readonly":function(){var a=
c.g;b.save();b.fillStyle=l.ie;b.strokeStyle=l.ie;b.lineWidth=c.Da;b.translate(.5*a,.7*a);b.save();b.rotate(.6);b.beginPath();b.moveTo(-.015/.22*a,.07*a);b.lineTo(0,.22*a);b.lineTo(.015/.22*a,.07*a);b.fill();b.beginPath();b.moveTo(-.1*a,-.4*a);b.lineTo(-.1*a,0);b.lineTo(0,.22*a);b.lineTo(.1*a,0);b.lineTo(.1*a,-.4*a);b.restore();b.moveTo(-.2*a,-.4*a);b.lineTo(.4*a,.2*a);b.stroke();b.restore()},"vpl:new":function(){b.fillStyle=k&&h?l.Ca:l.wa;b.fillRect(0,0,c.g,c.g);b.beginPath();b.moveTo(.25*c.g,.2*
c.g);b.lineTo(.25*c.g,.8*c.g);b.lineTo(.75*c.g,.8*c.g);b.lineTo(.75*c.g,.3*c.g);b.lineTo(.65*c.g,.2*c.g);b.closePath();b.moveTo(.65*c.g,.2*c.g);b.lineTo(.65*c.g,.3*c.g);b.lineTo(.75*c.g,.3*c.g);b.strokeStyle=h?l.U:l.da;b.lineWidth=c.Da;b.stroke()},"vpl:save":function(){b.fillStyle=k&&h?l.Ca:l.wa;b.fillRect(0,0,c.g,c.g);b.beginPath();b.moveTo(.25*c.g,.2*c.g);b.lineTo(.25*c.g,.7*c.g);b.lineTo(.67*c.g,.7*c.g);b.lineTo(.67*c.g,.27*c.g);b.lineTo(.6*c.g,.2*c.g);b.closePath();b.moveTo(.6*c.g,.2*c.g);b.lineTo(.6*
c.g,.27*c.g);b.lineTo(.67*c.g,.27*c.g);b.strokeStyle=h?l.U:l.da;b.lineWidth=c.Da;b.stroke();b.lineWidth=1.5*c.Da;b.beginPath();b.moveTo(.8*c.g,.5*c.g);b.lineTo(.8*c.g,.8*c.g);b.moveTo(.7*c.g,.7*c.g);b.lineTo(.8*c.g,.8*c.g);b.lineTo(.9*c.g,.7*c.g);b.stroke()},"vpl:exportToHTML":function(){b.fillStyle=k&&h?l.Ca:l.wa;b.fillRect(0,0,c.g,c.g);b.strokeStyle=h?l.U:l.da;b.lineWidth=1.5*c.Da;b.beginPath();b.moveTo(.8*c.g,.2*c.g);b.lineTo(.8*c.g,.5*c.g);b.moveTo(.7*c.g,.4*c.g);b.lineTo(.8*c.g,.5*c.g);b.lineTo(.9*
c.g,.4*c.g);b.textAlign="center";b.textBaseline="middle";b.font="bold "+Math.round(.3*c.g).toString(10)+"px sans-serif";b.fillStyle=h?l.U:l.da;b.fillText("HTML",.5*c.g,.7*c.g);b.stroke()},"vpl:load":function(){b.fillStyle=k&&h?l.Ca:l.wa;b.fillRect(0,0,c.g,c.g);b.beginPath();b.moveTo(.25*c.g,.2*c.g);b.lineTo(.25*c.g,.7*c.g);b.lineTo(.67*c.g,.7*c.g);b.lineTo(.67*c.g,.27*c.g);b.lineTo(.6*c.g,.2*c.g);b.closePath();b.moveTo(.6*c.g,.2*c.g);b.lineTo(.6*c.g,.27*c.g);b.lineTo(.67*c.g,.27*c.g);b.strokeStyle=
h?l.U:l.da;b.lineWidth=c.Da;b.stroke();b.lineWidth=1.5*c.Da;b.beginPath();b.moveTo(.8*c.g,.55*c.g);b.lineTo(.8*c.g,.85*c.g);b.moveTo(.7*c.g,.65*c.g);b.lineTo(.8*c.g,.55*c.g);b.lineTo(.9*c.g,.65*c.g);b.stroke()},"vpl:upload":function(){b.fillStyle=k&&h?l.Ca:l.wa;b.fillRect(0,0,c.g,c.g);b.beginPath();b.moveTo(.25*c.g,.25*c.g);b.lineTo(.25*c.g,.75*c.g);b.lineTo(.67*c.g,.75*c.g);b.lineTo(.67*c.g,.32*c.g);b.lineTo(.6*c.g,.25*c.g);b.closePath();b.moveTo(.6*c.g,.25*c.g);b.lineTo(.6*c.g,.32*c.g);b.lineTo(.67*
c.g,.32*c.g);b.strokeStyle=h?l.U:l.da;b.lineWidth=c.Da;b.stroke();var a=.15;if("uploaded"===p||"canUploadAgain"===p)b.beginPath(),b.moveTo(.7*c.g,.1*c.g),b.lineTo(.7*c.g,.35*c.g),b.lineTo(.9*c.g,.35*c.g),b.lineTo(.9*c.g,.16*c.g),b.lineTo(.84*c.g,.1*c.g),b.closePath(),b.fillStyle=l.ie,b.fill(),a=.4;b.lineWidth=1.5*c.Da;b.beginPath();b.moveTo(.8*c.g,c.g*(a/1.5+.35));b.lineTo(.8*c.g,c.g*a);b.moveTo(.7*c.g,c.g*(a+.1));b.lineTo(.8*c.g,c.g*a);b.lineTo(.9*c.g,c.g*(a+.1));b.stroke();b.fillStyle=h?m||k?l.U:
l.Ic:l.da;b.fillRect(.1*c.g,.8*c.g,.8*c.g,.1*c.g)},"vpl:nextProgram":function(){b.fillStyle=k&&h?l.Ca:l.wa;b.fillRect(0,0,c.g,c.g);b.strokeStyle=h?l.U:l.da;b.fillStyle=h?l.U:l.da;b.lineWidth=c.Da;b.strokeRect(.25*c.g,.2*c.g,.5*c.g,.6*c.g);b.beginPath();b.arc(.33*c.g,.4*c.g,.03*c.g,0,2*Math.PI);b.arc(.33*c.g,.6*c.g,.03*c.g,0,2*Math.PI);b.fill();for(var a=0;5>a;a++)b.beginPath(),b.moveTo(.4*c.g,c.g*(.32+.1*a)),b.lineTo(.7*c.g,c.g*(.32+.1*a)),b.stroke(),b.lineWidth=.01*c.g,b.setLineDash([.02*c.g,.02*
c.g]);b.moveTo(.8*c.g,.8*c.g);b.lineTo(.9*c.g,.7*c.g);b.lineTo(.8*c.g,.6*c.g)},"vpl:text":function(){b.fillStyle=k&&h?l.Ca:l.wa;b.fillRect(0,0,c.g,c.g);b.beginPath();b.moveTo(.25*c.g,.2*c.g);b.lineTo(.25*c.g,.8*c.g);b.lineTo(.75*c.g,.8*c.g);b.lineTo(.75*c.g,.3*c.g);b.lineTo(.65*c.g,.2*c.g);b.closePath();b.moveTo(.65*c.g,.2*c.g);b.lineTo(.65*c.g,.3*c.g);b.lineTo(.75*c.g,.3*c.g);for(var a=.2;.6>a;a+=.1)b.moveTo(.3*c.g,c.g*(.2+a)),b.lineTo(.7*c.g,c.g*(.2+a));b.strokeStyle=h?l.U:l.da;b.lineWidth=c.Da;
b.stroke()},"vpl:text-toggle":function(){b.fillStyle=k&&h?l.Ca:l.wa;b.fillRect(0,0,c.g,c.g);b.beginPath();b.moveTo(.28*c.g,.2*c.g);b.lineTo(.28*c.g,.7*c.g);b.lineTo(.7*c.g,.7*c.g);b.lineTo(.7*c.g,.27*c.g);b.lineTo(.63*c.g,.2*c.g);b.closePath();b.moveTo(.63*c.g,.2*c.g);b.lineTo(.63*c.g,.27*c.g);b.lineTo(.7*c.g,.27*c.g);for(var a=.1;.5>a;a+=.1)b.moveTo(.33*c.g,c.g*(.2+a)),b.lineTo(.63*c.g,c.g*(.2+a));b.strokeStyle=h?l.U:l.da;b.lineWidth=c.Da;b.stroke();b.fillStyle=h?m||k?l.U:l.Ic:l.da;b.fillRect(.1*
c.g,.8*c.g,.8*c.g,.1*c.g)},"vpl:advanced":function(){b.fillStyle=k&&h?l.Ca:m?l.ud:l.wa;b.fillRect(0,0,c.g,c.g);b.fillStyle=h?l.U:l.da;for(var a=0;4>a;a++)for(var d=0;5>d;d++)b.fillRect(.1*c.g*(1+a)+(2>a?0:.43*c.g),.1*c.g*(2+d),.07*c.g,.07*c.g);b.fillStyle=h?m||k?l.U:l.Ic:l.da;b.fillRect(.1*c.g,.8*c.g,.8*c.g,.1*c.g)},"vpl:undo":function(){n(0,0,!1)},"vpl:redo":function(){n(0,0,!0)},"vpl:add-comment":function(){b.fillStyle=k&&h?l.Ca:l.wa;b.fillRect(0,0,c.g,c.g);b.beginPath();b.moveTo(.2*c.g,.6*c.g);
b.lineTo(.8*c.g,.6*c.g);b.moveTo(.7*c.g,.35*c.g);b.lineTo(.9*c.g,.35*c.g);b.moveTo(.8*c.g,.25*c.g);b.lineTo(.8*c.g,.45*c.g);b.strokeStyle=h?l.U:l.da;b.lineWidth=c.Da;b.stroke();b.strokeRect(.1*c.g,.5*c.g,.8*c.g,.2*c.g)},"vpl:run":function(){b.fillStyle=k&&h?l.Ca:l.wa;b.fillRect(0,0,c.g,c.g);b.beginPath();b.moveTo(.3*c.g,.25*c.g);b.lineTo(.3*c.g,.75*c.g);b.lineTo(.8*c.g,.5*c.g);b.closePath();b.fillStyle=h?l.U:l.da;b.fill();b.fillStyle=h?m||k?l.U:l.Ic:l.da;b.fillRect(.1*c.g,.8*c.g,.8*c.g,.1*c.g)},"vpl:stop":function(){b.fillStyle=
k&&h?l.Ca:l.wa;b.fillRect(0,0,c.g,c.g);b.fillStyle=h?l.U:l.da;b.fillRect(.28*c.g,.28*c.g,.44*c.g,.44*c.g)},"vpl:debug":function(){b.fillStyle=k&&h?l.Ca:l.wa;b.fillRect(0,0,c.g,c.g);b.strokeStyle=h?l.U:l.da;b.lineWidth=c.Da;b.save();b.translate(.5*c.g,.42*c.g);b.scale(.0085*c.g,.012*c.g);b.beginPath();b.arc(0,0,20,0,2*Math.PI);b.moveTo(-13,-10);b.bezierCurveTo(0,-5,0,-5,13,-10);b.moveTo(0,-5);b.lineTo(0,20);b.moveTo(-18,-5);b.lineTo(-30,-10);b.moveTo(-18,2);b.lineTo(-32,6);b.moveTo(-15,10);b.lineTo(-26,
18);b.moveTo(18,-5);b.lineTo(30,-10);b.moveTo(18,2);b.lineTo(32,6);b.moveTo(15,10);b.lineTo(26,18);b.restore();b.stroke();b.fillStyle=h?m||k?l.U:l.Ic:l.da;b.fillRect(.1*c.g,.8*c.g,.8*c.g,.1*c.g)},"vpl:flash":function(){var a=c.g;b.fillStyle=k&&h?l.Ca:l.wa;b.fillRect(0,0,a,a);b.save();b.translate(.6*a,.4*a);b.scale(.4,.4);q();b.restore();b.save();b.textAlign="center";b.textBaseline="middle";b.translate(.25*a,.4*a);b.rotate(-Math.PI/2);b.font="bold "+Math.round(a/4).toString(10)+"px sans-serif";b.fillStyle=
h?l.U:l.da;b.fillText("flash",0,0);b.restore();b.fillStyle=h?m||k?l.U:l.Ic:l.da;b.fillRect(.1*c.g,.8*c.g,.8*c.g,.1*c.g)},"vpl:connected":function(){function a(a,d){var e=.08*c.g;b.save();b.fillStyle=h?l.Ca:l.wa;b.fillRect(a-e,d-e,2*e,2*e);b.beginPath();b.moveTo(a-e,d-e);b.lineTo(a+e,d+e);b.moveTo(a+e,d-e);b.lineTo(a-e,d+e);b.stroke();b.restore()}h=!1;b.translate(0,.1*c.g);b.save();b.translate(.8*c.g,.2*c.g);b.scale(.35,.35);q();b.restore();b.fillStyle=h?l.U:l.da;b.strokeStyle=h?l.U:l.da;b.lineWidth=
1.5*c.Da;p&&b.strokeRect(0,.05*c.g,.3*c.g,.3*c.g);b.strokeRect(.3*c.g,.55*c.g,.4*c.g,.3*c.g);b.lineWidth=c.Da;b.beginPath();b.moveTo(.7*c.g,.7*c.g);b.bezierCurveTo(.9*c.g,.7*c.g,.9*c.g,.7*c.g,.85*c.g,.35*c.g);p&&(b.moveTo(.3*c.g,.7*c.g),b.bezierCurveTo(.1*c.g,.7*c.g,.1*c.g,.7*c.g,.15*c.g,.35*c.g));b.stroke();m||a(.86*c.g,.55*c.g);"nonmonitored"===p&&a(.14*c.g,.55*c.g)},"vpl:robot":function(){b.fillStyle=k?l.Ca:l.wa;b.fillRect(0,0,c.g,c.g);switch(p){case "thymio":b.save();b.translate(c.g/2,.35*c.g);
b.scale(.3,.3);b.rotate(.2);q();b.restore();break;case "thymio-tdm":b.save();b.translate(c.g/2,.35*c.g);b.scale(.3,.3);b.rotate(.2);q();b.restore();b.fillStyle=l.U;b.fillRect(.4*c.g,.65*c.g,.2*c.g,.2*c.g);break;case "sim":b.save(),b.translate(c.g/2,.35*c.g),b.scale(.3,.3),b.rotate(.2),q(),b.beginPath(),b.strokeStyle=l.U,b.lineWidth=c.Da/.3,b.strokeRect(-c.g,-.8*c.g,2*c.g,1.6*c.g),b.restore()}b.beginPath();b.moveTo(.2*c.g,.75*c.g);b.lineTo(.5*c.g,.75*c.g);b.lineTo(.5*c.g,c.g*("sim"===p?.6:.3));b.strokeStyle=
l.U;b.lineWidth=c.Da;b.stroke()},"vpl:sim":function(){b.fillStyle=k&&h?l.Ca:l.wa;b.fillRect(0,0,c.g,c.g);b.save();b.translate(c.g/2,.35*c.g);b.scale(.4,.4);b.rotate(.2);q();b.beginPath();b.arc(c.g,.5*c.g,1.4*c.g,-3.2,-3.8,!0);b.strokeStyle=k&&h?l.jg:l.ie;b.lineWidth=.2*c.g;b.stroke();b.beginPath();b.arc(c.g,.5*c.g,.6*c.g,-3.3,-3.8,!0);b.stroke();b.restore()},"vpl:message-empty":function(){},"vpl:message-error":function(){if(p){b.fillStyle=f.color;b.font=Nc(f);b.textAlign="center";b.textBaseline="middle";
var a=g.translate(p);b.fillText(a,f.width/2,f.height/2)}},"vpl:filename":function(){if(p){b.beginPath();var a=3*c.g;b.rect(0,0,a,c.g);b.clip();b.fillStyle=f.color;b.font=Nc(f);b.textAlign="center";b.textBaseline="middle";var d=p.trim().split("\n").slice(0,2).map(function(c){c=c.slice(0,80);if(1<c.length&&b.measureText(c).width>a){for(;1<c.length&&b.measureText(c+"\u2026").width>a;)c=c.slice(0,-1);c+="\u2026"}return c});1<d.length?(b.fillText(d[0],f.width/2,.25*f.height),b.fillText(d[1],f.width/2,
.75*f.height)):b.fillText(d[0],f.width/2,f.height/2)}},"vpl:duplicate":function(){b.fillStyle=k&&h?l.Ca:l.wa;b.fillRect(0,0,c.g,c.g);b.strokeStyle=h?l.U:l.da;b.lineWidth=c.Da;b.strokeRect(.3*c.g,.3*c.g,.4*c.g,.15*c.g);b.strokeRect(.3*c.g,.55*c.g,.4*c.g,.15*c.g)},"vpl:disable":function(){b.fillStyle=k&&h?l.Ca:l.wa;b.fillRect(0,0,c.g,c.g);b.strokeStyle=h?l.U:l.da;b.lineWidth=c.Da;b.strokeRect(.3*c.g,.3*c.g,.4*c.g,.4*c.g);b.beginPath();b.moveTo(.2*c.g,.6*c.g);b.lineTo(.8*c.g,.4*c.g);b.stroke()},"vpl:lock":function(){b.fillStyle=
k&&h?l.Ca:l.wa;b.fillRect(0,0,c.g,c.g);b.strokeStyle=h?l.U:l.da;b.fillStyle=h?l.U:l.da;b.lineWidth=c.Da;b.strokeRect(.3*c.g,.3*c.g,.4*c.g,.4*c.g);Oc(b,.5*c.g,.52*c.g,.04*c.g,l.U)},"vpl:trashcan":function(){b.fillStyle=k&&h?l.Ca:l.wa;b.fillRect(0,0,c.g,c.g);b.beginPath();b.moveTo(.25*c.g,.2*c.g);b.lineTo(.32*c.g,.8*c.g);b.lineTo(.68*c.g,.8*c.g);b.lineTo(.75*c.g,.2*c.g);b.closePath();b.strokeStyle=h?l.U:l.da;b.lineWidth=c.Da;b.stroke()},"vpl:teacher-reset":function(){b.fillStyle=k&&h?l.$e:l.Ze;b.fillRect(0,
0,c.g,c.g);b.beginPath();b.moveTo(.25*c.g,.2*c.g);b.lineTo(.25*c.g,.8*c.g);b.lineTo(.75*c.g,.8*c.g);b.lineTo(.75*c.g,.3*c.g);b.lineTo(.65*c.g,.2*c.g);b.closePath();b.moveTo(.65*c.g,.2*c.g);b.lineTo(.65*c.g,.3*c.g);b.lineTo(.75*c.g,.3*c.g);b.strokeStyle=h?l.U:l.je;b.lineWidth=c.Da;b.stroke();b.fillStyle=h?l.U:l.je;Pc(b,.63*c.g,.7*c.g,.2*c.g)},"vpl:teacher-save":function(){b.fillStyle=k&&h?l.$e:l.Ze;b.fillRect(0,0,c.g,c.g);b.strokeStyle=h?l.U:l.je;b.beginPath();b.moveTo(.25*c.g,.2*c.g);b.lineTo(.25*
c.g,.7*c.g);b.lineTo(.67*c.g,.7*c.g);b.lineTo(.67*c.g,.27*c.g);b.lineTo(.6*c.g,.2*c.g);b.closePath();b.moveTo(.6*c.g,.2*c.g);b.lineTo(.6*c.g,.27*c.g);b.lineTo(.67*c.g,.27*c.g);b.lineWidth=c.Da;b.stroke();b.lineWidth=1.5*c.Da;b.beginPath();b.moveTo(.8*c.g,.5*c.g);b.lineTo(.8*c.g,.8*c.g);b.moveTo(.7*c.g,.7*c.g);b.lineTo(.8*c.g,.8*c.g);b.lineTo(.9*c.g,.7*c.g);b.stroke();b.fillStyle=h?l.U:l.je;Pc(b,.46*c.g,.45*c.g,.2*c.g)},"vpl:teacher-setasnew":function(){b.fillStyle=k&&h?m?l.eg:l.$e:m&&h?l.dg:l.Ze;
b.fillRect(0,0,c.g,c.g);b.strokeStyle=h?l.U:l.je;b.beginPath();b.moveTo(.25*c.g,.2*c.g);b.lineTo(.25*c.g,.7*c.g);b.lineTo(.67*c.g,.7*c.g);b.lineTo(.67*c.g,.27*c.g);b.lineTo(.6*c.g,.2*c.g);b.closePath();b.moveTo(.6*c.g,.2*c.g);b.lineTo(.6*c.g,.27*c.g);b.lineTo(.67*c.g,.27*c.g);b.lineWidth=c.Da;b.stroke();b.lineWidth=1.5*c.Da;b.beginPath();b.moveTo(.8*c.g,.5*c.g);b.lineTo(.5*c.g,.5*c.g);b.moveTo(.6*c.g,.4*c.g);b.lineTo(.5*c.g,.5*c.g);b.lineTo(.6*c.g,.6*c.g);b.stroke();b.fillStyle=h?m||k?l.U:l.kg:l.da;
b.fillRect(.1*c.g,.8*c.g,.8*c.g,.1*c.g)},"vpl:teacher":function(){b.fillStyle=k&&h?m?l.eg:l.$e:m&&h?l.dg:l.Ze;b.fillRect(0,0,c.g,c.g);b.fillStyle=h?l.U:l.je;Pc(b,.5*c.g,.4*c.g,.27*c.g);b.fillStyle=h?m||k?l.U:l.kg:l.da;b.fillRect(.1*c.g,.8*c.g,.8*c.g,.1*c.g)},"src:vpl":function(){b.save();b.fillStyle=k&&h?l.Ca:l.wa;b.fillRect(0,0,c.g,c.g);b.beginPath();b.moveTo(.25*c.g,.2*c.g);b.lineTo(.25*c.g,.8*c.g);b.lineTo(.75*c.g,.8*c.g);b.lineTo(.75*c.g,.3*c.g);b.lineTo(.65*c.g,.2*c.g);b.closePath();b.moveTo(.65*
c.g,.2*c.g);b.lineTo(.65*c.g,.3*c.g);b.lineTo(.75*c.g,.3*c.g);b.strokeStyle=h?l.U:l.da;b.lineWidth=c.Da;b.stroke();b.fillStyle=k&&h?l.U:l.ie;for(var a=.15;.6>a;a+=.15)b.fillRect(.3*c.g,c.g*(.2+a),.4*c.g,.1*c.g);b.restore()},"src:locked":function(){b.save();b.fillStyle=h?k?l.Ca:m?l.ud:l.wa:l.wa;b.fillRect(0,0,c.g,c.g);b.strokeStyle=h?l.U:l.da;b.lineWidth=c.Da;b.fillStyle=h?m?l.jg:l.ie:l.da;for(var a=.15;.6>a;a+=.15)b.fillRect(.15*c.g,c.g*a,.4*c.g,.1*c.g);Oc(b,.77*c.g,.36*c.g,.06*c.g,h?l.U:l.da,!m);
b.fillStyle=h?m||k?l.U:l.Ic:l.da;b.fillRect(.1*c.g,.8*c.g,.8*c.g,.1*c.g);b.restore()},"src:language":function(){var a=c.g;b.save();b.fillStyle=h?k?l.Ca:l.wa:l.wa;b.fillRect(0,0,a,a);b.beginPath();for(var d=0;3>d;d++)b.moveTo(.2*a,a*(.2+.1*d)),b.lineTo(.5*a,a*(.2+.1*d));b.strokeStyle=h?l.U:l.da;b.lineWidth=c.Da;b.stroke();for(d=0;3>d;d++){var e=2*(d+.25)/3*Math.PI;Qc(b,.75*a,.3*a,.15*a,e-.3*Math.PI,e+.3*Math.PI,{$d:!1,td:3*c.Da,style:h?l.U:l.da})}b.textAlign="center";b.textBaseline="middle";b.font=
"bold "+Math.round(a/3).toString(10)+"px sans-serif";b.fillStyle=h?l.U:l.da;b.fillText({aseba:"Aa",l2:"l2",asm:"asm",js:"js",python:"Py"}[p],.5*a,.7*a);b.restore()},"src:disass":function(){var a=c.g;b.save();b.fillStyle=h&&k?l.Ca:m?l.ud:l.wa;b.fillRect(0,0,a,a);b.beginPath();b.moveTo(.2*a,.2*a);b.lineTo(.3*a,.2*a);for(var d=0;5>d;d++)b.moveTo(.4*a,a*(.2+.1*d)),b.lineTo(.45*a,a*(.2+.1*d)),b.moveTo(.55*a,a*(.2+.1*d)),b.lineTo(.65*a,a*(.2+.1*d));b.strokeStyle=h?l.U:l.da;b.lineWidth=c.Da;b.stroke();b.fillStyle=
h&&(m||k)?l.U:l.Ic;b.fillRect(.1*c.g,.8*c.g,.8*c.g,.1*c.g);b.restore()},"src:run":function(){b.fillStyle=k&&h?l.Ca:l.wa;b.fillRect(0,0,c.g,c.g);b.beginPath();b.moveTo(.3*c.g,.25*c.g);b.lineTo(.3*c.g,.75*c.g);b.lineTo(.8*c.g,.5*c.g);b.closePath();b.fillStyle=h?l.U:l.da;b.fill()},"sim:restart":function(){b.save();b.fillStyle=k?l.Ca:l.wa;b.fillRect(0,0,f.width,f.height);var a=c.g;b.lineWidth=.05*a;Qc(b,.5*a,.5*a,.25*a,1.56,0,{$d:!1,td:.2*a,style:l.U});b.restore()},"sim:pause":function(){b.save();b.fillStyle=
k?l.Ca:m?l.ud:l.wa;b.fillRect(0,0,c.g,c.g);b.fillStyle=h?l.U:l.da;b.fillRect(.28*c.g,.28*c.g,.15*c.g,.44*c.g);m?(b.beginPath(),b.moveTo(.54*c.g,.28*c.g),b.lineTo(.62*c.g,.28*c.g),b.lineTo(.75*c.g,.5*c.g),b.lineTo(.62*c.g,.72*c.g),b.lineTo(.54*c.g,.72*c.g),b.fill()):b.fillRect(.57*c.g,.28*c.g,.15*c.g,.44*c.g);b.restore()},"sim:speedup":function(){b.save();b.fillStyle=k&&h?l.Ca:m?l.ud:l.wa;b.fillRect(0,0,c.g,c.g);b.fillStyle=h?l.U:l.da;b.beginPath();for(var a=0;2>a;a++)b.moveTo(c.g*(.3+.22*a),.25*c.g/
2),b.lineTo(c.g*(.3+.22*a),.75*c.g/2),b.lineTo(c.g*(.5+.22*a),.5*c.g/2),b.closePath();b.fill();b.textAlign="center";b.textBaseline="middle";b.font="bold "+Math.round(c.g/3).toString(10)+"px sans-serif";b.fillText(1<=p?"\u00d7"+p.toString(10):"\u00f7"+Math.round(1/p).toString(10),.5*c.g,.7*c.g);b.restore()},"sim:noise":function(){b.save();b.fillStyle=k&&h?l.Ca:m?l.ud:l.wa;b.fillRect(0,0,c.g,c.g);b.beginPath();var a=[.58,1.48,.96,.39,1.36,.09,-.75,-1.58,-.32,-1.36,-1.39,-.94,-1.1,-1.04,-.1,.93,1.22,
.6,.89,.61];b.moveTo(.1*c.g,(.4+.1*a[0])*c.g);for(var d=1;d<a.length;d++)b.lineTo((.1+.8/(a.length-1)*d)*c.g,(.4+.1*a[d])*c.g);b.strokeStyle=h?l.U:l.da;b.lineWidth=c.Da;b.stroke();b.fillStyle=h?m||k?l.U:l.Ic:l.da;b.fillRect(.1*c.g,.8*c.g,.8*c.g,.1*c.g);b.restore()},"sim:pen":function(){var a=c.g;b.save();b.fillStyle=k&&h?l.Ca:m?l.ud:l.wa;b.fillRect(0,0,a,a);b.fillStyle=h?m||k?l.U:l.Ic:l.da;b.fillRect(.1*a,.8*a,.8*a,.1*a);b.translate(.5*a,a*(.4+(m?.13:0)));b.beginPath();b.moveTo(-.015/.22*a,.07*a);
b.lineTo(0,.22*a);b.lineTo(.015/.22*a,.07*a);b.fillStyle=h?l.U:l.da;b.fill();b.beginPath();b.moveTo(-.1*a,-.22*a);b.lineTo(-.1*a,0);b.lineTo(0,.22*a);b.lineTo(.1*a,0);b.lineTo(.1*a,-.22*a);b.strokeStyle=h?l.U:l.da;b.lineWidth=c.Da;b.stroke();b.restore()},"sim:clear":function(){var a=c.g;b.save();b.fillStyle=k&&h?l.Ca:l.wa;b.fillRect(0,0,a,a);b.strokeStyle=h?l.U:l.da;b.lineWidth=c.Da;b.strokeRect(.15*a,.25*a,.7*a,.5*a);b.translate(.5*a,.4*a);b.rotate(.4);b.fillStyle=h?l.U:l.da;b.fillRect(0,0,.3*a,
.2*a);b.restore()},"sim:map-kind":function(){var a=c.g,d=c.Da;b.save();b.fillStyle=k&&h?l.Ca:l.wa;b.fillRect(0,0,c.g,c.g);b.lineWidth=d;b.strokeStyle=h?l.U:l.da;b.fillStyle=h?l.U:l.da;for(var e=["ground","height","obstacles"].indexOf(p),f=0;3>f;f++){var g=2*(f+.25)/3*Math.PI;f===e?b.fillRect(a*(.35+.25*Math.cos(g)),a*(.39+.25*Math.sin(g)),.3*a,.22*a):b.strokeRect(a*(.35+.25*Math.cos(g)),a*(.39+.25*Math.sin(g)),.3*a,.22*a);Qc(b,.5*a,.5*a,.36*a,g-.42*Math.PI,g-.22*Math.PI,{$d:!1,td:3*d,style:l.U})}b.restore()},
"sim:map":function(){var a=c.g;b.save();b.fillStyle=k&&h?l.Ca:m?l.ud:l.wa;b.fillRect(0,0,c.g,c.g);b.fillStyle=h?m||k?l.U:l.Ic:l.da;b.fillRect(.1*a,.8*a,.8*a,.1*a);b.lineWidth=c.Da;b.strokeStyle=h?l.U:l.da;b.strokeRect(.15*a,.15*a,.7*a,.5*a);switch(p){case "ground":b.lineWidth=.08*a;b.beginPath();b.arc(.6*a,.4*a,.15*a,-.5*Math.PI,.5*Math.PI);b.lineTo(.4*a,.55*a);b.arc(.4*a,.4*a,.15*a,.5*Math.PI,1.5*Math.PI);b.closePath();b.stroke();break;case "height":b.beginPath();for(var d=0;.75>=d;d+=.25)for(var e=
0;1>=e;e+=.1){var f=a*(.2+.5*e+.15*d),g=a*(.5-.3*d-.2*(.2*Math.cos(5*e+2*d-3)-(d-.9)*(d-.9)/3));0===e?b.moveTo(f,g):b.lineTo(f,g)}b.stroke();break;case "obstacles":b.strokeRect(.2*a,.2*a,.6*a,.4*a),b.beginPath(),b.moveTo(.4*a,.2*a),b.lineTo(.4*a,.43*a),b.moveTo(.6*a,.6*a),b.lineTo(.6*a,.37*a),b.stroke()}b.restore()},"sim:map-ground":function(){p="ground";v["sim:map"]()},"sim:map-height":function(){p="height";v["sim:map"]()},"sim:map-obstacles":function(){p="obstacles";v["sim:map"]()},"sim-event:forward":function(){t(0,
0,1)},"sim-event:backward":function(){t(0,0,3)},"sim-event:left":function(){t(0,0,2)},"sim-event:right":function(){t(0,0,0)},"sim-event:center":function(){var a=c.g;b.save();b.fillStyle=k?l.Ca:l.wa;b.fillRect(0,0,a,a);b.beginPath();b.arc(.5*a,.5*a,.25*a,0,2*Math.PI);b.strokeStyle=l.U;b.lineWidth=2*c.Da;b.stroke();b.restore()},"sim-event:clap":function(){var a=c.g;b.save();b.fillStyle=k?l.Ca:l.wa;b.fillRect(0,0,a,a);b.beginPath();b.strokeStyle=l.U;b.lineWidth=2*c.Da;b.translate(.5*a,.5*a);b.rotate(.1);
for(var d=0;9>d;d++)b.beginPath(),b.moveTo(.12*a,0),b.lineTo(.24*a,0),b.moveTo(.28*a,0),b.lineTo(.36*a,0),b.stroke(),b.rotate(Math.PI/4.5);b.restore()},"sim-event:tap":function(){var a=c.g;b.save();b.fillStyle=k?l.Ca:l.wa;b.fillRect(0,0,a,a);b.beginPath();b.strokeStyle=l.U;b.lineWidth=2*c.Da;b.translate(.6*a,.6*a);for(var d=1;3>=d;d++)b.beginPath(),b.arc(0,0,.15*a*d,.9*Math.PI,1.7*Math.PI),b.stroke();b.moveTo(.3*a,0);b.lineTo(0,0);b.lineTo(0,.3*a);b.stroke();b.restore()}};v["vpl:message-warning"]=
v["vpl:message-error"];v["vpl:slowdown"]=v["sim:speedup"];v["src:close"]=v["vpl:close"];v["src:new"]=v["vpl:new"];v["src:save"]=v["vpl:save"];v["src:load"]=v["vpl:load"];v["src:stop"]=v["vpl:stop"];v["src:connected"]=v["vpl:connected"];v["src:sim"]=v["vpl:sim"];v["src:teacher"]=v["vpl:teacher"];v["src:teacher-reset"]=v["vpl:teacher-reset"];v["sim:close"]=v["vpl:close"];v["sim:vpl"]=v["src:vpl"];v["sim:text"]=v["vpl:text"];v["sim:teacher"]=v["vpl:teacher"];v["sim:teacher-reset"]=v["vpl:teacher-reset"];
(a=v[a])&&a();return!1}function Rc(a,b){switch(a){case "vpl:close":case "src:close":case "sim:close":return{Z:0,oa:b.g/2,ba:0,pa:b.g};case "vpl:message-error":case "vpl:message-warning":case "vpl:message-empty":return{Z:0,oa:5*b.g,ba:0,pa:b.g};case "vpl:filename":return{Z:0,oa:3*b.g,ba:0,pa:b.g}}return{Z:0,oa:b.g,ba:0,pa:b.g}};function Sc(a,b){var c=0<=a.W.b.indexOf(b);return(a.hc?a.hc.aa:a.I.aa(b))&&(a.W.cc||!c)}
function Tc(a,b,c,d,e,f){var g=0<=b.W.b.indexOf(c);if(Sc(b,c)){var h=a.i,m=b.I.find(c),k=m.hd;Gc(a,function(a,f,m){if(b.hc)e(c,a,h.B,h.ia,d,f,b.l,b.hc.isEnabled&&(k||!b.W.we),b.hc.Na,b.hc.ah,b.hc.state);else{var n=b.I.isEnabled(c)&&(k||!b.W.we);!n&&b.W.i&&(n=b.I.fb(c,{data:Uc(b.R)}));e(c,a,h.B,h.ia,d,f,b.l,n,b.I.Na(c),m,b.I.getState(c))}return b.hc?b.hc.disabled:g},f,{action:b.W.cc&&!k?function(){b.W.toggle(c);return 1}:!Db(b.I,c)||!k&&b.W.we?!b.W.i||b.W.cc&&!k&&b.W.we?null:function(){Vc(b.R,m)}:
function(a){var d=b.I;a=a.Th;var e=d.find(c);e&&(Fb(e,a),Eb(d,c))},nb:b.W.cc&&!k&&b.W.we?null:function(a,d){b.I.nb(c,d)},fb:b.W.cc&&!k&&b.W.we?null:function(a,d){return b.I.fb(c,d)}},c)}}function Wc(a,b,c,d,e,f){a.controls=[];a.b="";for(var g=0;g<c.length;g++)switch(c[g]){case "!space":a.b+=" ";break;case "!!space":a.b+="_";break;case "!stretch":a.b+="s";break;case "!!stretch":a.b+="S";break;default:Tc(a,b,c[g],d,e,f(c[g],a.i.B,b.I.find(c[g]).Zc))}}
function Xc(a,b){for(var c=0;c<b.length;c++)if("!"!==b[c][0]&&a.I.aa(b[c]))return!0;return!1}function gc(a,b,c){for(var d={},e=0;e<b.length;e++)if("!"!==b[e][0]){var f=M(a.ia,{tag:"button",id:b[e].replace(/:/g,"-"),ea:c,lb:a.pb&&a.I.fb(b[e],a.pb)?["possible-drop-target"]:null});d[b[e]]=f}return d}function Yc(a){var b=0,c;for(c in a)a.hasOwnProperty(c)&&(b=Math.max(b,a[c].qa()));return b};var Zc={"vpl:then":function(a,b,c,d){b=Math.min(d.width,d.height);a.strokeStyle=c.Ag;a.lineWidth=.2*b;a.beginPath();a.moveTo(-.25*b,-.5*b);a.lineTo(.25*b,0);a.lineTo(-.25*b,.5*b);a.stroke()},"vpl:error":function(a,b,c,d){b=Math.min(d.width,d.height);a.fillStyle="white";a.strokeStyle=c.ig;a.lineWidth=.07*b;a.beginPath();a.arc(0,0,.5*b,0,2*Math.PI);a.fill();a.stroke();a.fillStyle=c.ig;a.font="bold "+Math.round(.75*b).toString()+"px sans-serif";a.textAlign="center";a.textBaseline="middle";a.fillText("?",
0,.05*b)},"vpl:warning":function(a,b,c,d){b=Math.min(d.width,d.height);a.fillStyle="white";a.strokeStyle=c.Mg;a.lineWidth=.07*b;a.beginPath();a.arc(0,0,.5*b,0,2*Math.PI);a.fill();a.stroke();a.fillStyle=c.Mg;a.font="bold "+Math.round(.75*b).toString()+"px sans-serif";a.textAlign="center";a.textBaseline="middle";a.fillText("!",0,.05*b)},"vpl:moreHigh":function(a,b,c,d){b=Math.min(d.width,d.height);a.beginPath();a.moveTo(-.2*b,.1*b);a.lineTo(0,-.1*b);a.lineTo(.2*b,.1*b);a.lineWidth=.1*b;a.strokeStyle=
"black";a.shadowColor="white";a.shadowBlur=.2*b;a.stroke()},"vpl:moreLow":function(a,b,c,d){b=Math.min(d.width,d.height);a.beginPath();a.moveTo(-.2*b,-.1*b);a.lineTo(0,.1*b);a.lineTo(.2*b,-.1*b);a.lineWidth=.1*b;a.strokeStyle="black";a.shadowColor="white";a.shadowBlur=.2*b;a.stroke()},"vpl:customize":function(a,b,c,d){b=Math.min(d.width,d.height)/2;a.fillStyle=c.Ag;Pc(a,0,0,b)}};function Mb(){this.b=new $c;this.i=new $c;this.i.S=!0;this.l=new $c}function ad(a,b){return function(){a.w!==b&&(a.w=b,Lb(a))}}function bd(a){return function(b){a.w!==b&&(a.w=b,Lb(a))}}var cd={e:"event",s:"state",a:"action",c:"comment"};
function dd(a,b,c,d,e,f,g,h){function m(a){return"a"===a||"c"===a}var k=a.j,p=Math.min(d.width,d.height),n=0!=b.B.m?p/b.B.m:1,t=cd[c.T.type];t&&0>e.indexOf(t)&&e.push(t);var q=new ed(c,d.width,d.height,f,g,function(a,b,f,g,k){var l=a.O;l.save();var m=a.B;a.B=ac(p,a.B.g*n);Kc(d,l,b.x+f,b.y+g);var u=c.T,r=b.data,t=b.x+f,q=b.y+g;a.O.save();a.O.translate(t,q);u.L(a,r,d,k);a.O.restore();c.locked&&fd(a,b.x+f,b.y+g,p,p,!0);(c.disabled||h.disabled)&&Mc(a,b.x+f,b.y+g,p,p,e,e,!c.disabled&&!h.Nh);c.marks.lf&&
gd(a,b.x+f,b.y+g,d.width,d.height,e.concat("kbd-target"));c.marks.kf&&gd(a,b.x+f,b.y+g,d.width,d.height,e.concat("kbd-selected"));null!=c.marks.Je&&null!==c.T.ja&&(k=c.T.ja.controls[c.marks.Je],gd(a,b.x+f+d.width*k.left,b.y+g+d.height*k.top,d.width*(k.right-k.left),d.height*(k.bottom-k.top),e.concat("kbd-selected","param")));a.B=m;l.restore()},h&&h.Uf||c.disabled||c.locked||c.Db&&c.Db.locked||!c.T.fa?h&&h.fa?{fa:h.fa}:null:{fa:c.T.fa,Oa:c.T.Oa},h&&h.Tf?null:function(a,c){a.data.Db&&(k.zb(),a.data.Db.Ub(c.data,
a.data.Me,function(){k.zb()},function(){ab(k)}),ab(k));b.ta&&b.ta()},h&&h.Tf?null:function(a,b){return b.data instanceof C&&(m(a.data.T.type)===m(b.data.T.type)||"c"===b.data.T.type)&&a.data!==b.data});if(!(h&&h.Uf||!c.T.fa)){if(k.Y||c.T.Ae)q.S=function(a){return Ec(b,a)};if(k.S||c.T.Ae)q.Y=function(a){return Ec(b,a)}}q.Xa=!(h&&h.Sf);q.l=!(h&&h.pf);q.vc=ad(a,c.T.name);f=hd(b,c);a.W.i&&h&&h.Xb&&(q.l=!1,q.b=h.Xb.type!==Rb?{fa:function(b,c,d,e,f,g,k){a.R.Qa!==h.Xb.type||a.R.vb!==h.Xb.vd||a.R.w!==h.Xb.wd?
(a.R.Qa=h.Xb.type,a.R.vb=h.Xb.vd,a.R.w=h.Xb.wd):id(a.R,(k.x-f)/d,(k.y-g)/e);J(b);return 0},Oa:function(b,c,d,e,f,g,k,m){d=b.b.getBoundingClientRect();c=m.x-d.left;m=m.y-d.top;m=c>=q.x&&c<q.x+q.width&&m>=q.y&&m<q.y+q.height;a.R.Qa!==(m?h.Xb.type:jd)&&(a.R.Qa=m?h.Xb.type:jd,J(b))}}:{Yc:function(){h.Xb.click&&h.Xb.click()}});kd(b,q,f);return q}
function ld(a,b,c,d,e,f,g,h){var m=new C(c,null,null);c.eb&&(m.h=c.eb());m.marks={kf:g||!1,Je:null,lf:!1};var k=a.j;g=0>("b"===k.mode?k.Zb:k.gc).indexOf(c.name);a=dd(a,b,m,d,["block","library"],e,f,{Uf:!0,Tf:!0,pf:k.ra||k.readOnly,disabled:g||k.readOnly,Nh:g,fa:!a.W.sb||k.ra||k.readOnly?null:function(){var a="b"===k.mode?k.Zb:k.gc;0<=a.indexOf(c.name)?a.splice(a.indexOf(c.name),1):a.push(c.name);return 1},Xb:a.W.sb?null:h});c.eb&&(a.za=function(a){a=a.clone();a.data=new C(c,null,null);return a})}
function md(a,b,c){var d=[],e=0;d=a.X.map(function(b,f){var g=a.error&&a.error.i&&(0===a.error.l.length||0<=a.error.l.indexOf(f))?a.error.Sb?c.Pd:c.Od:c.Ma;g.width=null==b?L(1===d.length?c.Af:c.zf):L(nd(b,0===f,c));e+=L(g);return c.Ma.width});if(0===a.X.length||!b&&null!==a.X[a.X.length-1])c.Ma.width=L(0===a.X.length?c.Af:c.zf),d.push(c.Ma.width),e+=L(c.Ma);b=L(c.Tb);var f=[],g=0;f=a.actions.map(function(b,d){var e=a.error&&!a.error.i&&(0===a.error.b.length||0<=a.error.b.indexOf(d))?a.error.Sb?c.Pd:
c.Od:c.Ma;e.width=null==b?L(1===f.length?c.yf:c.xf):L(nd(b,0===d,c));g+=L(e);return L(e)});if(0===a.actions.length||null!==a.actions[a.actions.length-1])c.Ma.width=L(0===a.actions.length?c.yf:c.xf),f.push(c.Ma.width),g+=L(c.Ma);return{total:e+b+g,X:d,Ig:e,wi:b,actions:f,$h:g}}function nd(a,b,c){switch(a.T.type){case "e":return b?c.Sc:c.Gc;case "a":return c.ad;case "s":return c.Kh;case "c":return c.Hh;default:throw"internal";}}
function od(a,b){switch(a.verticalAlign){case "middle":return(b.height-a.qa())/2;case "bottom":return b.height-a.qa();case "top":return 0;default:return b.height-a.qa()-a.verticalAlign}}function Dc(a,b){var c=a.ga,d=a.j.j[b];a.b&&a.b.se===d||(a.b=new pd(a,{Sh:d.ce,display:function(){c.ta&&c.ta()},finish:function(b){null!==b&&(d.ce=b);a.b=null;c.ta&&c.ta()},se:d}))}
function qd(a,b,c,d,e,f,g,h,m,k){var p=c instanceof Ba,n=g,t=md(c,e,k),q=a.j,l=p?a.b&&a.b.se===c?k.zg:k.Oe:k.tb,v=0<c.X.length&&"e"===c.X[0].T.type?k.Sc:k.Gc,r=new ed(c,l.width+l.paddingLeft+l.paddingRight,rd(l),n-l.paddingLeft-k.Ma.offsetLeft()-v.offsetLeft(),m-l.paddingTop-k.Ma.offsetTop()-v.offsetTop(),function(b,e,m,n){var r=b.O;Kc(l,r,e.x+m,e.y+n,!0);if(p){r.save();r.fillStyle=l.color;r.font=Nc(l);r.textAlign="left";r.textBaseline="middle";if(a.b&&a.b.se===c){var q=r.measureText(a.b.v.slice(0,
a.b.b)),v=q.fontBoundingBoxAscent||0,R=q.fontBoundingBoxDescent||0;if(0===v||0===R)R=v=l.fontSize/2;var Q={top:e.y+n+l.paddingTop+l.height/2-v,bottom:e.y+n+l.paddingTop+l.height/2+R,left:e.x+m+l.paddingLeft,right:e.x+m+l.paddingLeft+r.measureText(a.b.v).width},E=a.b.v.split("").map(function(b,c){return r.measureText(a.b.v.slice(0,c+1)).width});sd(a.b,Q,E);a.b.i===a.b.b?(r.strokeStyle="black",r.beginPath(),r.moveTo(Q.left+q.width,Q.top),r.lineTo(Q.left+q.width,Q.bottom),r.stroke()):(E=r.measureText(a.b.v.slice(a.b.b,
a.b.i)),r.save(),r.fillStyle="silver",r.fillRect(Q.left+q.width-1,Q.top,E.width,v+R),r.restore());r.fillText(a.b.v,Q.left,e.y+n+l.paddingTop+l.height/2)}else r.fillText(c.ce,e.x+m+l.paddingLeft,e.y+n+l.paddingTop+l.height/2);r.restore();a.R.i===I&&a.R.b===d&&gd(b,e.x+m,e.y+n,e.width,e.height,["rule","comment","kbd-selected"]);a.R.Qa===I&&a.R.vb===d&&gd(b,e.x+m,e.y+n,e.width,e.height,["rule","comment","kbd-target"])}else{Kc(k.Tb,r,h-k.Tb.width-k.Tb.marginRight-k.Tb.paddingRight-k.Ma.offsetLeft()-k.ad.offsetLeft()+
m,e.y+(rd(l)-k.Tb.height)/2+n);td(b,"vpl:then",h-L(k.Tb)/2-k.Ma.offsetLeft()-k.ad.offsetLeft()+m,e.y+rd(l)/2+n,k.Tb);c.locked&&fd(b,e.x,e.y,e.width,e.height,!1,c.disabled?"#ddd":"");a.R.i===I&&a.R.b===d&&gd(b,e.x+m,e.y+n,e.width,e.height,["rule","kbd-selected"]);a.R.Qa===I&&a.R.vb===d&&gd(b,e.x+m,e.y+n,e.width,e.height,["rule","kbd-target"]);var D=e.x+m+l.paddingLeft;0<f&&(D+=f-t.Ig);u.forEach(function(a,b){var d=c.error&&c.error.i&&(0===c.error.l.length||0<=c.error.l.indexOf(b))?c.error.Sb?k.Pd:
k.Od:k.Ma;d.width=null==a?L(1===u.length?k.Af:k.zf):L(nd(a,0===b,k));Kc(d,r,D+d.marginLeft,e.y+n+l.paddingTop+k.Ma.marginTop,!0);D+=L(d)});D=e.x+m+l.paddingLeft+h-g;w.forEach(function(a,b){var d=c.error&&!c.error.i&&(0===c.error.b.length||0<=c.error.b.indexOf(b))?c.error.Sb?k.Pd:k.Od:k.Ma;d.width=null==a?L(1===w.length?k.yf:k.xf):L(nd(a,0===b,k));Kc(d,r,D+d.marginLeft,e.y+n+l.paddingTop+k.Ma.marginTop,!0);D+=L(d)})}},p?{Yc:function(){Dc(a,d)}}:null,function(a,c){if(c.data instanceof ua){a=q.j.indexOf(a.data);
var d=q.j.indexOf(c.data);0<=a&&0<=d&&(q.zb(),q.j.splice(d,1),q.j.splice(a,0,c.data),ab(q))}else c.data instanceof C&&(q.zb(),a.data.Ub(c.data,null,function(){q.zb()},function(){ab(q)}),ab(q));b.ta&&b.ta()},function(a,b){return b.data instanceof ua?b.data!==a.data:!p&&b.data.Db!==a.data&&("a"===q.mode||0===a.data.X.length||b.data instanceof C&&"a"===b.data.T.type)});c.disabled&&(r.u=function(a,c,d,e){Mc(b,c.x+d,c.y+e,c.width,c.height,["rule"],["rule"])});if(a.j.ra||a.j.readOnly)r.l=!1;a.W.i&&(r.l=
!1,r.b={fa:function(b){a.R.Qa=I;a.R.vb=d;J(b);return 0},Oa:function(b,c,d,e,f,g,h,k){d=b.b.getBoundingClientRect();c=k.x-d.left;k=k.y-d.top;k=c>=r.x&&c<r.x+r.width&&k>=r.y&&k<r.y+r.height;a.R.Qa!==(k?I:jd)&&(a.R.Qa=k?I:jd,J(b))}});kd(b,r);if(!p){var E,u=c.X;if(0===u.length||!e&&null!==u[u.length-1])u=u.concat(null);n=g;0<f&&(n+=f-t.Ig);u.forEach(function(a,e){var f=a?nd(a,0===e,k):1===u.length?k.Af:k.zf,g=c.error&&c.error.i&&(0===c.error.l.length||0<=c.error.l.indexOf(e))?c.error.Sb?k.Pd:k.Od:k.Ma,
h=od(f,g);a?(a.marks={kf:this.R.i===ud&&this.R.b===d&&this.R.u===e,Je:this.R.i===vd&&this.R.b===d&&this.R.u===e?this.R.G:null,lf:this.R.Qa===ud&&this.R.vb===d&&this.R.w===e},g.width=L(f),E=dd(this,b,a,f,["block"],n,m+h,{Uf:c.disabled||this.j.ra||this.j.readOnly,Sf:c.disabled||this.j.ra||this.j.readOnly,pf:this.j.ra||this.j.readOnly,Xb:{type:ud,vd:d,wd:e}})):(a=new ra("e",c,{dd:!0,index:e}),a.marks={kf:this.R.i===ud&&this.R.b===d&&this.R.u===e,Je:null,lf:this.R.Qa===ud&&this.R.vb===d&&this.R.w===e},
g.width=L(f),E=dd(this,b,a,f,["block"],n,m+h,{Tf:c.disabled||this.j.readOnly,Sf:!0,pf:!0,Xb:{type:ud,vd:d,wd:e}}));r.ha.push(E);n+=L(g)},a);var w=c.actions;if(0===w.length||null!==w[w.length-1])w=w.concat(null);n=h;w.forEach(function(a,e){var f=a?nd(a,0==e,k):1===w.length?k.yf:k.xf,g=c.error&&!c.error.i&&(0===c.error.b.length||0<=c.error.b.indexOf(e))?c.error.Sb?k.Pd:k.Od:k.Ma,h=od(f,g);a?(a.marks={kf:this.R.i===wd&&this.R.b===d&&this.R.u===e,Je:this.R.i===xd&&this.R.b===d&&this.R.u===e?this.R.G:
null,lf:this.R.Qa===wd&&this.R.vb===d&&this.R.w===e},g.width=L(f),E=dd(this,b,a,nd(a,0===e,k),["block"],n,m+h,{Uf:c.disabled||this.j.ra||this.j.readOnly,Sf:c.disabled||this.j.ra||this.j.readOnly,pf:this.j.ra||this.j.readOnly,Xb:{type:wd,vd:d,wd:e}})):(a=new ra("a",c,{dd:!1,index:e}),a.marks={kf:this.R.i===wd&&this.R.b===d&&this.R.u===e,Je:null,lf:this.R.Qa===wd&&this.R.vb===d&&this.R.w===e},g.width=L(f),E=dd(this,b,a,f,["block"],n,m,{Tf:q.readOnly,Sf:!0,pf:!0,Xb:{type:wd,vd:d,wd:e}}));r.ha.push(E);
n+=L(g)},a);Jc(b,function(){if(null!==c.error){var a=c.error.Sb?k.Ch:k.If;td(b,c.error.Sb?"vpl:warning":"vpl:error",g-l.paddingLeft-l.marginLeft-k.Ma.offsetLeft()-v.offsetLeft()-a.width/2-a.marginRight-a.paddingRight,m+.5*v.height,a)}})}}
function yd(a,b,c,d,e,f){var g=f?e.Ch:e.If;Jc(a,function(h){var m=zd(a.ia,{tag:"conflict-line",ea:[f?"warning":"error"]}),k=b-e.tb.paddingLeft-e.tb.marginLeft-e.Ma.offsetLeft()-e.Sc.offsetLeft()-g.width/2-g.marginRight-g.paddingRight,p=c+(e.Ma.height+g.height)/2,n=d+(e.Ma.height-g.height)/2;h.beginPath();h.moveTo(k,p);h.lineTo(k,n);m.stroke(h);h.beginPath();h.arc(k,p,m.lineWidth,0,Math.PI);m.stroke(h);h.beginPath();h.arc(k,n,m.lineWidth,-Math.PI,0);m.stroke(h)})}
function fc(a,b){var c={};a=window.matchMedia&&window.matchMedia("(pointer: coarse)").matches?a.j.S:a.j.Y;c.C=M(b,{tag:"view",ea:["vpl"]});c.Hg=M(b,{tag:"separator",ea:["vpl","top"]});c.Gg=M(b,{tag:"separator",ea:["vpl","bottom"]});c.Dc=M(b,{tag:"toolbar",ea:["vpl","top"]});c.Fd=M(b,{tag:"toolbar",ea:["vpl","bottom"]});c.ua=M(b,{tag:"vpl",id:"scrolling-vpl"});c.Sc=M(b,{tag:"block",ea:["event","event-main"],lb:a?["small"]:[]});c.Gc=M(b,{tag:"block",ea:["event","event-aux"],lb:a?["small"]:[]});c.ad=
M(b,{tag:"block",ea:["action"],lb:a?["small"]:[]});c.Kh=M(b,{tag:"block",ea:["state"],lb:a?["small"]:[]});c.Hh=M(b,{tag:"block",ea:["comment"],lb:a?["small"]:[]});c.ci=M(b,{tag:"block",ea:["event","empty"],lb:a?["small"]:[]});c.xf=M(b,{tag:"block",ea:["action","empty"],lb:a?["small"]:[]});c.Af=M(b,{tag:"block",ea:["event","empty"],lb:a?["only-child","small"]:["only-child"]});c.zf=M(b,{tag:"block",ea:["event","event-aux","empty"],lb:a?["small"]:[]});c.yf=M(b,{tag:"block",ea:["action","empty"],lb:a?
["only-child","small"]:["only-child"]});c.Ma=M(b,{tag:"block-container"});c.Od=M(b,{tag:"block-container",ea:["error"]});c.Pd=M(b,{tag:"block-container",ea:["warning"]});c.tb=M(b,{tag:"rule",lb:a?["small"]:[]});c.Tb=M(b,{tag:"widget",id:"widget-then",lb:a?["small"]:[]});c.Oe=M(b,{tag:"rule",ea:["comment"],lb:a?["small"]:[]});c.zg=M(b,{tag:"rule",ea:["comment"],lb:a?["small","edited"]:["edited"]});c.af=M(b,{tag:"block",ea:["library","event"]});c.Be=M(b,{tag:"block",ea:["library","action"]});c.Lh=M(b,
{tag:"block",ea:["library","state"]});c.Ih=M(b,{tag:"block",ea:["library","comment"]});c.Ya=M(b,{tag:"block-library",ea:["event"]});c.ab=M(b,{tag:"block-library",ea:["action"]});c.If=M(b,{tag:"widget",id:"widget-error",lb:a?["small"]:[]});c.Ch=M(b,{tag:"widget",id:"widget-warning",lb:a?["small"]:[]});return c}
function vc(a){var b=a.W,c=a.j,d=c.xc(c.xb);a.Kb="";a.rd=!1;if(!b.sb)for(b=0;b<c.j.length;b++)if(c.j[b].error)if(c.j[b].error.Sb)a.Kb||(a.Kb=c.j[b].error.w,a.rd=!0);else{a.Kb=c.j[b].error.w;a.rd=!1;break}c=""!==a.Kb&&!a.rd;if(!c)try{var e=a.Fa[a.na].Pa.check(d,a.j.xb,function(){Lb(a)});e&&(a.Kb=e,c=!0)}catch(f){}}function hc(a,b,c,d,e,f){var g=new Fc(a.ga);Wc(g,a,b,c,a.j.Zd||cc,a.j.Se||Rc);Hc(g,d,f,e);return g}
function Ad(a,b,c){for(var d=0;d<H.length;d++){var e=H[d];if((b?"a"===e.type||"c"===e.type:"e"===e.type||"s"===e.type)&&0<=("b"===a.j.mode?a.j.Zb:a.j.gc).indexOf(e.name)){if(0===c)return e;c--}}return null}
function Lb(a){function b(a,b){switch(b.type){case "e":return a.af;case "a":return a.Be;case "s":return a.Lh;case "c":return a.Ih;default:throw"internal";}}var c=a.W,d=a.ga,e=a.j,f=fc(a,d.ia);Bd(d);vc(a);e.Y=d.B.m<d.B.dh;e.S=d.B.m<d.B.eh;var g=Cd(d),h=d.state.bi,m=Xc(a,a.u),k=Za(e),p=0,n=0,t=0,q=0;e.j.forEach(function(a){a instanceof Ba?q++:t++;a=md(a,k,f);p=Math.max(p,a.Ig);n=Math.max(n,a.$h)});var l=0,v=0;H.forEach(function(a){if(c.sb||0<=("b"===e.mode?e.Zb:e.gc).indexOf(a.name))switch(a.type){case "e":case "s":l++;
break;case "a":case "c":v++}},a);a.R.ha=l;a.R.za=v;Dd(d,function(b,c,d){if(a.I.fb("vpl:trashcan",c)){b=Q-f.tb.offsetLeft()-f.Ma.offsetLeft()-f.Sc.offsetLeft();var e=L(f.tb);if(d<b||d>b+e)return a.I.nb("vpl:trashcan",c),!0}return!1});var r=gc(a,a.G,["vpl","top"]),E=Yc(r),u=gc(a,a.u,["vpl","bottom"]),w=Yc(u);f.C.Nc(g.width);f.C.Bc(g.height);f.C.setPosition(0,0);f.Dc.Nc(f.C.width);f.Dc.height=E;f.Dc.setPosition(f.C.x,f.C.y);f.Ya.Bc(f.C.height-f.Dc.qa());var D=Math.max(Math.floor(f.Ya.height/f.af.qa()),
1);E=f.Ya.scroll?1:Math.ceil(l/D);f.Ya.width=E*L(f.af);f.Ya.setPosition(f.C.x,f.C.y+f.Dc.qa());f.ab.Bc(f.C.height-f.Dc.qa());var R=f.ab.scroll?1:Math.ceil(v/D);f.ab.width=R*L(f.Be);f.ab.setPosition(f.C.x+f.C.width-L(f.ab),f.C.y+f.Dc.qa());f.Fd.Nc(f.C.width-L(f.Ya)-L(f.ab));f.Fd.height=w;f.Fd.setPosition(f.C.x+L(f.Ya),f.C.y+f.C.height-f.Fd.qa());f.ua.Nc(f.C.width-L(f.Ya)-L(f.ab));f.ua.Bc(f.C.height-f.Dc.qa()-(m?f.Fd.qa():0));f.ua.setPosition(f.C.x+L(f.Ya),f.C.y+f.Dc.qa());f.Ma.width=f.Od.width=f.Pd.width=
L(f.Sc);f.Ma.height=f.Od.height=f.Pd.height=f.Sc.qa();w=L(f.Tb);D=p+n+w;var Q=f.C.x+(f.C.width-D+L(f.If))/2,Fa=Q+p+w;f.tb.width=D;f.tb.height=f.Ma.qa();f.Oe.width=D;f.Oe.height=f.Oe.fontSize;f.zg.width=D;f.zg.height=f.Oe.fontSize;var oa=[];e.j.forEach(function(a,b){a=a instanceof Ba?f.Oe.qa():f.tb.qa();oa.push(0===b?a:oa[b-1]+a)});d.mb=[];Jc(d,function(a){f.C.L(a)});var xa=hc(a,a.G,["vpl","top"],f.Dc,f.Hg,r);Ic(xa,f.Dc,r,bd(a));if(a.R.i===Ed&&!a.W.sb){w=Fd(a.R);var ja=null;for(D=0;D<xa.controls.length;D++)if(xa.controls[D].id===
w.name){ja=xa.controls[D];break}var T=r[ja.id];Jc(d,function(){gd(d,ja.x,ja.y,T.width,T.height,["button","top","kbd-selected"])})}if(0<m&&(m=hc(a,a.u,["vpl","bottom"],f.Fd,f.Gg,u),Ic(m,f.Fd,u,bd(a)),a.R.i===Gd&&!a.W.sb)){w=Fd(a.R);ja=null;for(D=0;D<m.controls.length;D++)if(m.controls[D].id===w.name){ja=m.controls[D];break}T=u[ja.id];Jc(d,function(){gd(d,ja.x,ja.y,T.width,T.height,["button","bottom","kbd-selected"])})}var O=f.af.qa(),ya=f.Be.qa(),Oa=0,A=0;if(f.Ya.scroll){a.R.S=1;Oa=L(f.af);h.i.Bc(l*
O);f.Ya.width=Oa;f.Ya.height=f.Ya.height;h.i.resize(f.Ya.x,f.Ya.y,f.Ya.width,f.Ya.height);Jc(d,function(a){f.Ya.L(a)});h.i.be(d);var U=0;H.forEach(function(g){if(("e"===g.type||"s"===g.type)&&(c.sb||0<=("b"===e.mode?e.Zb:e.gc).indexOf(g.name))){var h=b(f,g),k=f.Ya.x+h.offsetLeft(),m=f.Ya.y+h.offsetTop()+U*O;ld(this,d,g,h,k,m,a.R.i===Hd&&a.R.b===U,{type:Rb,vd:0,wd:0,click:function(){Id(a.R,g)}});U++}},a);h.i.end();Jc(d,function(){var a=M(d.ia,{tag:"widget",id:"widget-moreHigh"}),b=M(d.ia,{tag:"widget",
id:"widget-moreLow"});Jd(h.i)||td(d,"vpl:moreHigh",f.Ya.x+f.Ya.width/2,f.Ya.y+a.qa()/2,a);Kd(h.i)||td(d,"vpl:moreLow",f.Ya.x+f.Ya.width/2,f.Ya.y+f.Ya.height-b.qa()/2,b)})}else{Jc(d,function(a){f.Ya.L(a)});Oa=E*O+Ld(f.Ya);var N=Math.ceil(l/E);a.R.S=N;U=0;H.forEach(function(g){if(("e"===g.type||"s"===g.type)&&(c.sb||0<=("b"===e.mode?e.Zb:e.gc).indexOf(g.name))){var h=b(f,g),k=f.Ya.x+h.offsetLeft()+Math.floor(U/N)*O,m=f.Ya.y+h.offsetTop()+U%N*O;ld(a,d,g,h,k,m,a.R.i===Hd&&a.R.b===U%N&&a.R.u===Math.floor(U/
N),{type:Rb,vd:0,wd:0,click:function(){Id(a.R,g)}});U++}},a)}f.ab.scroll?(a.R.Y=1,A=L(f.Be),h.l.Bc(v*ya),f.ab.width=A,f.ab.height=f.ab.height,h.l.resize(f.ab.x,f.ab.y,f.ab.width,f.ab.height),Jc(d,function(a){f.ab.L(a)}),h.l.be(d),U=0,H.forEach(function(g){if(("a"===g.type||"c"===g.type)&&(c.sb||0<=("b"===e.mode?e.Zb:e.gc).indexOf(g.name))){var h=b(f,g);ld(this,d,g,h,f.ab.x+f.Be.offsetLeft(),f.ab.y+f.Be.offsetTop()+U*ya,a.R.i===Md&&a.R.b===U,{type:Rb,vd:0,wd:0,click:function(){Id(a.R,g)}});U++}},a),
h.l.end(),Jc(d,function(){var a=M(d.ia,{tag:"widget",id:"widget-moreHigh"}),b=M(d.ia,{tag:"widget",id:"widget-moreLow"});Jd(h.l)||td(d,"vpl:moreHigh",f.ab.x+f.ab.width/2,f.ab.y+a.qa()/2,a);Kd(h.l)||td(d,"vpl:moreLow",f.ab.x+f.ab.width/2,f.ab.y+f.ab.height-b.qa()/2,b)})):(Jc(d,function(a){f.ab.L(a)}),A=R*ya+Ld(f.ab),N=Math.ceil(v/R),a.R.Y=N,U=0,H.forEach(function(g){if(("a"===g.type||"c"===g.type)&&(c.sb||0<=("b"===e.mode?e.Zb:e.gc).indexOf(g.name))){var h=b(f,g),k=f.ab.x+h.offsetLeft()+f.ab.width-
(R-Math.floor(U/N))*ya,m=f.ab.y+h.offsetTop()+U%N*ya;ld(a,d,g,h,k,m,a.R.i===Md&&a.R.b===U%N&&a.R.u===Math.floor(U/N),{type:Rb,vd:0,wd:0,click:function(){Id(a.R,g)}});U++}},a));if(c.sb){(function(){var b=f.Ma.qb();b.width=L(f.Sc);var c=f.Ma.qb();c.width=L(f.Gc);var e=f.Ma.qb();e.width=L(f.ad);var g=L(b)+L(c)+L(f.Tb)+L(e),h=f.tb.qb();h.width=g;var k=f.C.x+(f.C.width-g)/2+(Oa-A)/2-d.B.od/2,m=k+g-L(e);g=f.ua.y+h.offsetTop()+b.offsetTop();var l=!1;g=new ed(a,h.width+h.paddingLeft+h.paddingRight,rd(h),
k-h.paddingLeft-b.offsetLeft(),g-h.paddingTop-b.offsetTop(),function(d,g,n,r){var u=d.O;Kc(h,u,g.x+n,g.y+r,!0);Kc(f.Tb,u,m-f.Tb.width-f.Tb.marginRight-f.Tb.paddingRight-f.Ma.offsetLeft()-f.ad.offsetLeft()+n,g.y+(rd(f.tb)-f.Tb.height)/2+r);td(d,"vpl:then",m-L(f.Tb)/2-f.Ma.offsetLeft()-f.ad.offsetLeft()+n,g.y+rd(f.tb)/2+r,f.Tb);var p=g.x+n+h.paddingLeft;Kc(b,u,p+b.marginLeft,g.y+r+h.paddingTop+b.marginTop,!0);Kc(f.Sc,u,p+b.offsetLeft()+f.Sc.marginLeft,g.y+r+h.paddingTop+b.offsetTop()+f.Sc.marginTop+
od(f.Sc,b),!0);p+=L(b);Kc(c,u,p+c.marginLeft,g.y+r+h.paddingTop+c.marginTop,!0);Kc(f.Gc,u,p+b.offsetLeft()+f.Gc.marginLeft,g.y+r+h.paddingTop+c.offsetTop()+f.Gc.marginTop+od(f.Gc,c),!0);!("a"===a.j.mode?a.j.i:a.j.b)^l&&Mc(d,p+b.offsetLeft()+f.Gc.marginLeft,g.y+r+h.paddingTop+c.offsetTop()+f.Gc.marginTop+od(f.Gc,c),f.Gc.width,f.Gc.height,["block"],["block"],!1);p=g.x+n+f.tb.paddingLeft+m-k;Kc(e,u,p+e.marginLeft,g.y+r+h.paddingTop+e.marginTop,!0);Kc(f.ad,u,p+e.offsetLeft()+f.ad.marginLeft,g.y+r+h.paddingTop+
e.offsetTop()+f.ad.marginTop+od(f.ad,e),!0)},{fa:function(a){l=!0;J(a);return 0},Oa:function(a,b,c,d,e,f,g,h){c=a.b.getBoundingClientRect();b=h.x-c.left;h=h.y-c.top;l=b>=f&&b<f+d&&h>=g&&h<g+e;J(a)},Yc:function(b){l&&("a"===a.j.mode?a.j.i=!a.j.i:a.j.b=!a.j.b);J(b)}},null,null);g.l=!1;kd(d,g)})();var K=M(d.ia,{tag:"widget",id:"vpl-customize"});K.width=f.ua.width/2;K.height=(f.ua.height-f.tb.qa())/2;Jc(d,function(){td(d,"vpl:customize",f.ua.x+f.ua.width/2,f.ua.y+(f.ua.height+f.tb.qa())/2,K)})}else if(e.message)Jc(d,
function(a){var b=e.message.split("\n"),c=Math.min(14,g.height/b.length);a.font=c+"px sans-serif";a.textAlign="start";a.textBaseline="top";var d=f.ua.x+c,h=f.ua.y+c;b.forEach(function(b,e){a.fillText(b,d,h+1.2*c*e)})});else{u=L(f.tb)+f.ua.paddingLeft+f.ua.paddingRight+L(f.If);h.b.Nc(u);h.b.Bc(oa[oa.length-1]);switch(a.R.i){case I:case ud:case wd:case vd:case xd:Nd(h.b,0<a.R.b?oa[a.R.b-1]:0,oa[a.R.b])}h.b.resize(f.ua.x,f.ua.y,f.ua.width,f.ua.height);Jc(d,function(a){f.ua.L(a)});h.b.be(d);Q+=(Oa-A)/
2-d.B.od/2;Fa+=(Oa-A)/2-d.B.od/2;u>f.ua.width&&(Q+=(u-f.ua.width)/2+f.ua.paddingLeft+f.ua.marginLeft,Fa+=(u-f.ua.width)/2+f.ua.paddingLeft+f.ua.marginLeft);var Ma="";e.j.forEach(function(a,b){(0<b?oa[b-1]:0)<f.ua.height+h.b.b&&oa[b]>h.b.b&&qd(this,d,a,b,k,d.B.Yg?p:0,Q,Fa,f.ua.y+(0<b?oa[b-1]:0)+f.tb.offsetTop()+f.Ma.offsetTop(),f);if(null!==a.error&&""===Ma&&(Ma=a.error.w,null!==a.error.u))for(var c=b+1;c<e.j.length;c++)if(e.j[c]===a.error.u){yd(d,Q,f.ua.y+f.tb.qa()*b+f.tb.offsetTop()+f.Ma.offsetTop(),
f.ua.y+f.tb.qa()*c+f.tb.offsetTop()+f.Ma.offsetTop(),f,a.error.Sb);break}},a);h.b.end();if(!Jd(h.b)){var x=M(d.ia,{tag:"widget",id:"widget-moreHigh"});u=new ed(null,L(x),x.qa(),f.ua.x+f.ua.width-L(x),f.ua.y+x.qa()-x.qa(),function(a){td(a,"vpl:moreHigh",f.ua.x+f.ua.width-L(x)/2,f.ua.y+x.qa()/2,x)},{Yc:function(){var a=h.b,b=-f.tb.qa();a.u+=0;a.b+=b;J(d)}},null,null,"scrollUp");kd(d,u)}if(!Kd(h.b)){var Ha=M(d.ia,{tag:"widget",id:"widget-moreLow"});u=new ed(null,L(Ha),Ha.qa(),f.ua.x+f.ua.width-L(Ha),
f.ua.y+f.ua.height-Ha.qa(),function(a){td(a,"vpl:moreLow",f.ua.x+f.ua.width-L(Ha)/2,f.ua.y+f.ua.height-Ha.qa()/2,Ha)},{Yc:function(){var a=h.b,b=f.tb.qa();a.u+=0;a.b+=b;J(d)}},null,null,"scrollDown");kd(d,u)}e.ra&&Jc(d,function(){Mc(d,f.ua.x,f.ua.y,f.ua.width,f.ua.height,["vpl"],["vpl"])})}a.w&&Jc(d,function(b){var c=M(d.ia,{tag:"hint"});b.fillStyle=c.color;b.font=Nc(c);b.textAlign="start";b.textBaseline="middle";var e=a.l.translate(a.w);if(a.W.i){var f=a.l.translate(a.w+";nodrag");";nodrag"!==f.slice(-7)&&
(e=f)}c.width=b.measureText(e).width;c.height=1.2*c.fontSize;Kc(c,b,c.marginLeft,g.height-c.qa()+c.marginTop,!0);b.fillText(e,c.offsetLeft(),g.height-c.qa()+c.offsetTop()+c.height/2)});e.ta&&e.ta();J(d)};function Od(){this.S={};this.i=[];this.za={px:1,cm:96/2.54,mm:96/25.4,"in":96,pc:16,pt:96/72};this.Y={rad:1,deg:Math.PI/180,grad:Math.PI/200,turn:2*Math.PI};this.b=null}Od.prototype.G=function(){this.S={};this.i=[]};
function Pd(a,b,c){function d(){return b+" line "+p+" col "+n}function e(){for(;k<c.length;)if(" "===c[k]||"\t"===c[k])k++,n++;else if("\n"===c[k])k++,n=1,p++;else if("\r"===c[k])k++;else if("/*"===c.slice(k,k+2))for(k+=2,n+=2;k<c.length;)if("*/"===c.slice(k,k+2)){k+=2;n+=2;break}else k++,n++;else break}function f(){"\n"===c[k]?(n=1,p++):"\r"!==c[k]&&n++;k++}function g(){for(var a=0;k+a<c.length&&/[-_a-z0-9]/i.test(c[k+a]);)a++;k+=a;n+=a;return c.slice(k-a,k)}function h(){var a=new Qd;if(!/[a-z_.#*:]/i.test(c[k]))throw"Syntax error "+
d();for(/[a-z_]/i.test(c[k])?a.tag=g():"*"===c[k]&&f();;)if("#"===c[k]){if(a.id)throw"Multiple ids in selector "+d();f();a.id=g()}else if("."===c[k])f(),a.ea.push(g());else if(":"===c[k])f(),a.lb.push(g());else break;return a}function m(){for(var a=0,b=!1;k+a<c.length&&(b||";"!==c[k+a]&&"}"!==c[k+a]);)"\n"===c[k]?(p++,n=1):"\r"!==c[k]?n++:'"'===c[k]&&(b=!b),a++;k+=a;return c.slice(k-a,k).trim()}a.S[b]=c;for(var k=0,p=1,n=1;k<c.length;){e();if(k>=c.length)break;for(var t=[];;){t.push(h());e();if(","!==
c[k])break;k++;n++;e()}if("{"!==c[k])throw"Syntax error "+d();k++;n++;for(var q={};;){for(;;){e();if(";"!==c[k])break;k++}if(k>=c.length)throw"Unclosed block "+d();if("}"===c[k]){k++;n++;break}else if(!/[-a-z_]/i.test(c[k]))throw"Syntax error "+d();var l=g();e();if(":"!==c[k])throw"Missing colon "+d();k++;n++;var v=m();q[l]=a.Xa(l,v)}for(l=0;l<t.length;l++)a.i.push({Yf:t[l],nd:q})}}Od.prototype.Xa=function(a,b){return b};
function Rd(a,b){if(/^(max|min)\(.*\)$/.test(b))return a=b.slice(4,-1).split(",").map(function(a){return Rd(this,a)},a),new Sd(b.slice(0,3),a);b=/^(-?([0-9]+\.?|[0-9]*\.[0-9]+))([a-z]*|%)$/.exec(b);var c=1,d=Td;if(null==b)throw"Illegal length";if("%"===b[3])d=Ud;else if(a.za.hasOwnProperty(b[3]))c=a.za[b[3]];else if("vw"===b[3])d=Vd;else if("vh"===b[3])d=Wd;else if("vmin"===b[3])d=Xd;else if("vmax"===b[3])d=Yd;else if("ww"===b[3])d=Zd;else if("wh"===b[3])d=$d;else if("wmin"===b[3])d=ae;else if("wmax"===
b[3])d=be;else if(0==parseFloat(b[1]))c=0;else throw"Unknown length unit";return new ce(parseFloat(b[1])*c,d)}
var de={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgreen:"#006400",
darkgrey:"#A9A9A9",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",
ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",green:"#008000",greenyellow:"#ADFF2F",grey:"#808080",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgreen:"#90EE90",lightgrey:"#D3D3D3",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",
lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",
moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",
seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32",transparent:"rgba(0,0,0,0)"};function ce(a,b){this.$=a;this.type=b?b:Td}
var Td="abs",Ud="%",Vd="vw",Wd="vh",Xd="vmin",Yd="vmax",Zd="ww",$d="wh",ae="wmin",be="wmax";
ce.prototype.V=function(a){switch(this.type){case Td:return this.$;case Ud:return this.$*(a?a.w/100:1);case Vd:return this.$*(a?a.i:1);case Wd:return this.$*(a?a.b:1);case Xd:return this.$*(a?Math.min(a.i,a.b):1);case Yd:return this.$*(a?Math.max(a.i,a.b):1);case Zd:return this.$*(a?a.u:1);case $d:return this.$*(a?a.l:1);case ae:return this.$*(a?Math.min(a.u,a.l):1);case be:return this.$*(a?Math.max(a.u,a.l):1);default:throw"internal";}};function Sd(a,b){ce.call(this,0);this.Ja=a;this.values=b}
Sd.prototype=Object.create(ce.prototype);Sd.prototype.constructor=Sd;Sd.prototype.V=function(a){switch(this.Ja){case "max":return this.values.reduce(function(b,c){return Math.max(b,c.V(a))},-Infinity);case "min":return this.values.reduce(function(b,c){return Math.min(b,c.V(a))},Infinity);default:throw"internal";}};function ee(a,b,c,d,e){this.w=a;this.i=b;this.b=c;this.u=d;this.l=e}function Qd(){this.id=this.tag=null;this.ea=[];this.lb=[]}
function fe(a,b){a=(a.id?"#"+a.id:a.tag||"")+(a.ea&&0<a.ea.length?"."+a.ea.join("."):"")+(a.lb&&0<a.lb.length?":"+a.lb.join("."):"")||"*";b&&(a+="/"+Math.round(b.w).toString(10)+","+Math.round(b.i).toString(10)+","+Math.round(b.b).toString(10)+","+Math.round(b.u).toString(10)+","+Math.round(b.l).toString(10));return a}
Qd.prototype.match=function(a){if(a.tag&&this.tag&&a.tag!==this.tag||this.id&&this.id!==a.id)return!1;for(var b=0;b<this.ea.length;b++)if(void 0==a.ea||0>a.ea.indexOf(this.ea[b]))return!1;for(b=0;b<this.lb.length;b++)if(void 0==a.lb||0>a.lb.indexOf(this.lb[b]))return!1;return!0};function Jb(){Od.call(this);this.l=[];this.u={};this.w={};this.ha="none hidden dotted dashed solid double".split(" ");this.pb=["normal","italic","oblique"];this.Ab=["normal","bold"]}Jb.prototype=Object.create(Od.prototype);Jb.prototype.constructor=Jb;Jb.prototype.G=function(){Od.prototype.G.call(this);this.u={};this.w={}};
Jb.prototype.defineProperties=function(){for(var a=0;a<this.i.length;a++){var b=new ge,c=this.i[a].Yf;he(b,this.i[a].nd,(null!=c.id?100:0)+10*(c.ea.length+c.lb.length)+(null!=c.tag?1:0));this.l.push({Yf:this.i[a].Yf,sh:b})}};
Jb.prototype.Xa=function(a,b){function c(a){try{Rd(e,a)}catch(q){return!1}return!0}function d(a){return de.hasOwnProperty(a)||/^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(a)||/^rgba\([^()]*\)$/.test(a)}var e=this;b=b.replace(/\s+(?=[^()]*\))/g,"");switch(a){case "margin-left":case "margin-right":case "margin-top":case "margin-bottom":case "padding-left":case "padding-right":case "padding-top":case "padding-bottom":case "border-left-width":case "border-right-width":case "border-top-width":case "border-bottom-width":case "border-corner-length":case "line-width":case "width":case "height":case "min-width":case "min-height":case "max-width":case "max-height":case "font-size":return Rd(this,b);
case "margin":case "padding":case "border-width":switch(a=b.replace(/ +/g," ").split(" ").map(function(a){return Rd(e,a)}),a.length){case 1:return[a[0],a[0],a[0],a[0]];case 2:return[a[0],a[1],a[0],a[1]];case 3:return[a[0],a[1],a[2],a[1]];case 4:return a;default:throw"Wrong number of lengths";}case "border-style":case "border-left-style":case "border-right-style":case "border-top-style":case "border-bottom-style":case "line-style":if(!(0<=e.ha.indexOf(b)))throw"Unknown border style";return b;case "line-cap":if(!(0<=
["butt","round","square"].indexOf(b)))throw"Unknown line cap";return b;case "border-color":case "border-left-color":case "border-right-color":case "border-top-color":case "border-bottom-color":case "color":case "background-color":case "background":case "border-cut-background":if(!d(b))throw"Unknown border color";return b;case "border-left":case "border-right":case "border-top":case "border-bottom":case "border":case "line":var f=null,g=null,h=null;b.replace(/ +/g," ").split(" ").forEach(function(a){if(d(a))f=
a;else if(0<=e.ha.indexOf(a))g=a;else if(c(a))h=Rd(e,a);else throw"Illegal border property";});return{color:f,style:null===g&&(f||h)?"solid":g,width:null===h&&(f||g)?new ce(1):h};case "border-top-left-radius":case "border-top-right-radius":case "border-bottom-right-radius":case "border-bottom-left-radius":case "border-top-left-cut":case "border-top-right-cut":case "border-bottom-left-cut":case "border-bottom-right-cut":switch(a=b.replace(/ +/g," ").split(" ").map(function(a){return Rd(e,a)}),a.length){case 1:return[a[0],
a[0]];case 2:return a;default:throw"Wrong number of radii";}case "border-radius":case "border-cut":switch(a=b.split("/").map(function(a){a=a.replace(/ +/g," ").split(" ").map(function(a){return"/"===a?"/":Rd(e,a)});switch(a.length){case 1:return[a[0],a[0],a[0],a[0]];case 2:return[a[0],a[1],a[0],a[1]];case 3:return[a[0],a[1],a[2],a[1]];case 4:return a;default:throw"Wrong number of radii";}}),a.length){case 1:return a[0].concat(a[0]);case 2:return a[0].concat(a[1]);default:throw"Wrong number of radius dimensions";
}case "font":var m="",k="",p=null,n="";b.replace(/ +/g," ").split(" ").forEach(function(a){if(null===p)if(c(a))p=Rd(e,a);else if(0<=e.pb.indexOf(a))m=a;else if(0<=e.Ab.indexOf(a))k=a;else throw"Unknown font style "+a;else{if(""!==n)throw"Unexpected font style after font-family";n=a}});return{fontFamily:n,fontSize:p,fontStyle:m,fontWeight:k};case "box-shadow":case "line-shadow":return b=b.split(",")[0],a=b.replace(/ +/g," ").split(" "),"inset"===a[0]&&(a=a.slice(1)),3<=a.length&&5>=a.length?{offset:[Rd(this,
a[0]),Rd(this,a[1])],color:a[a.length-1],Bf:4<=a.length?Rd(this,a[2]):null,Zf:5<=a.length?Rd(this,a[3]):null}:{};case "overflow":if(0>["wrap","scroll"].indexOf(b))throw"Unknown overflow mode";return b;case "vertical-align":return 0<=["top","middle","bottom"].indexOf(b)?b:Rd(this,b);default:return b}};
function ie(a,b){for(var c=null,d=0;d<a.l.length;d++)if(a.l[d].Yf.match(b)){if(c){var e=void 0;var f=a.l[d].sh;c=c.qb();for(e in f.nd)f.nd.hasOwnProperty(e)&&(!c.hasOwnProperty(e)||f.b[e]>=c.b[e])&&(c.nd[e]=f.nd[e]);e=c}else e=a.l[d].sh.qb();c=e}for(var g in c)c.hasOwnProperty(g)&&c[g]instanceof ce&&(c[g]=c[g].V(a.b));return c}function M(a,b){var c=fe(b,a.b);if(a.u[c])return a.u[c];b=ie(a,b);b=new $b(b,a.b);return a.u[c]=b}
function zd(a,b){var c=fe(b,a.b);if(a.w[c])return a.w[c];b=ie(a,b);b=new je(b,a.b);return a.w[c]=b}function ge(){this.nd={};this.b={}}function he(a,b,c,d){for(var e in b)b.hasOwnProperty(e)&&(a.nd[e]=b[e],a.b[e]=d&&d[e]||c)}ge.prototype.qb=function(){var a=new ge;he(a,this.nd,0,this.b);return a};
function $b(a,b){this.marginBottom=this.marginTop=this.marginRight=this.marginLeft=this.y=this.x=this.height=this.width=0;this.Eb=!0;this.Ac=!1;this.borderBottomWidth=this.borderTopWidth=this.borderRightWidth=this.borderLeftWidth=0;this.borderBottomStyle=this.borderTopStyle=this.borderRightStyle=this.borderLeftStyle="none";this.borderBottomColor=this.borderTopColor=this.borderRightColor=this.borderLeftColor="black";this.borderTopLeftRadius=[0,0];this.borderTopRightRadius=[0,0];this.borderBottomRightRadius=
[0,0];this.borderBottomLeftRadius=[0,0];this.bf=this.De=this.df=this.cf=!1;this.paddingBottom=this.paddingTop=this.paddingRight=this.paddingLeft=this.Bb=0;this.backgroundColor=this.Ye="transparent";this.color="black";this.fontFamily="sans-serif";this.fontSize=10;this.fontWeight=this.fontStyle="";this.scroll=!1;this.verticalAlign="middle";this.ac=null;this.ue=this.Ad=0;this.shadowColor=null;this.qe={};a&&ke(this,a.nd,b)}$b.prototype=Object.create(ge.prototype);y=$b.prototype;y.constructor=$b;
function ke(a,b,c){var d=-1,e=-1,f=-1,g=-1,h=1E9,m=1E9,k;for(k in b)switch(k){case "margin-left":a.marginLeft=b[k].V(c);break;case "margin-right":a.marginRight=b[k].V(c);break;case "margin-top":a.marginTop=b[k].V(c);break;case "margin-bottom":a.marginBottom=b[k].V(c);break;case "border-left-width":a.borderLeftWidth=b[k].V(c);a.Eb=!1;break;case "border-right-width":a.borderRightWidth=b[k].V(c);a.Eb=!1;break;case "border-top-width":a.borderTopWidth=b[k].V(c);a.Eb=!1;break;case "border-bottom-width":a.borderBottomWidth=
b[k].V(c);a.Eb=!1;break;case "border-corner-length":a.Bb=b[k].V(c);break;case "padding-left":a.paddingLeft=b[k].V(c);break;case "padding-right":a.paddingRight=b[k].V(c);break;case "padding-top":a.paddingTop=b[k].V(c);break;case "padding-bottom":a.paddingBottom=b[k].V(c);break;case "margin":a.marginTop=b[k][0].V(c);a.marginRight=b[k][1].V(c);a.marginBottom=b[k][2].V(c);a.marginLeft=b[k][3].V(c);break;case "border-width":a.borderTopWidth=b[k][0].V(c);"none"===a.borderTopStyle&&0<a.borderTopWidth&&(a.borderTopStyle=
null);a.borderRightWidth=b[k][1].V(c);"none"===a.borderRightStyle&&0<a.borderRightWidth&&(a.borderRightStyle=null);a.borderBottomWidth=b[k][2].V(c);"none"===a.borderBottomStyle&&0<a.borderBottomWidth&&(a.borderBottomStyle=null);a.borderLeftWidth=b[k][3].V(c);"none"===a.borderLeftStyle&&0<a.borderLeftWidth&&(a.borderLeftStyle=null);break;case "padding":a.paddingTop=b[k][0].V(c);a.paddingRight=b[k][1].V(c);a.paddingBottom=b[k][2].V(c);a.paddingLeft=b[k][3].V(c);break;case "border-style":a.borderLeftStyle=
b[k];a.borderRightStyle=b[k];a.borderTopStyle=b[k];a.borderBottomStyle=b[k];break;case "border-left-style":a.borderLeftStyle=b[k];a.Eb=!1;break;case "border-right-style":a.borderRightStyle=b[k];a.Eb=!1;break;case "border-top-style":a.borderTopStyle=b[k];a.Eb=!1;break;case "border-bottom-style":a.borderBottomStyle=b[k];a.Eb=!1;break;case "border-color":a.borderLeftColor=b[k];a.borderRightColor=b[k];a.borderTopColor=b[k];a.borderBottomColor=b[k];break;case "border-left-color":a.borderLeftColor=b[k];
a.Eb=!1;break;case "border-right-color":a.borderRightColor=b[k];a.Eb=!1;break;case "border-top-color":a.borderTopColor=b[k];a.Eb=!1;break;case "border-bottom-color":a.borderBottomColor=b[k];a.Eb=!1;break;case "border-left":null!==b[k].color&&(a.borderLeftColor=b[k].color);null!==b[k].style&&(a.borderLeftStyle=b[k].style);null!==b[k].width&&(a.borderLeftWidth=b[k].width.V(c));a.Eb=!1;break;case "border-right":null!==b[k].color&&(a.borderRightColor=b[k].color);null!==b[k].style&&(a.borderRightStyle=
b[k].style);null!==b[k].width&&(a.borderRightWidth=b[k].width.V(c));a.Eb=!1;break;case "border-top":null!==b[k].color&&(a.borderTopColor=b[k].color);null!==b[k].style&&(a.borderTopStyle=b[k].style);null!==b[k].width&&(a.borderTopWidth=b[k].width.V(c));a.Eb=!1;break;case "border-bottom":null!==b[k].color&&(a.borderBottomColor=b[k].color);null!==b[k].style&&(a.borderBottomStyle=b[k].style);null!==b[k].width&&(a.borderBottomWidth=b[k].width.V(c));a.Eb=!1;break;case "border":null!==b[k].color&&(a.borderLeftColor=
a.borderRightColor=a.borderTopColor=a.borderBottomColor=b[k].color);null!==b[k].style&&(a.borderLeftStyle=a.borderRightStyle=a.borderTopStyle=a.borderBottomStyle=b[k].style);null!==b[k].width&&(a.borderLeftWidth=a.borderRightWidth=a.borderTopWidth=a.borderBottomWidth=b[k].width.V(c));a.Eb=!0;break;case "border-top-left-radius":a.borderTopLeftRadius=b[k].map(function(a){return a.V(c)});a.Ac=!0;break;case "border-top-right-radius":a.borderTopRightRadius=b[k].map(function(a){return a.V(c)});a.Ac=!0;
break;case "border-bottom-right-radius":a.borderBottomRightRadius=b[k].map(function(a){return a.V(c)});a.Ac=!0;break;case "border-bottom-left-radius":a.borderBottomLeftRadius=b[k].map(function(a){return a.V(c)});a.Ac=!0;break;case "border-radius":a.borderTopLeftRadius=[b[k][0].V(c),b[k][4].V(c)];a.borderTopRightRadius=[b[k][1].V(c),b[k][5].V(c)];a.borderBottomRightRadius=[b[k][2].V(c),b[k][6].V(c)];a.borderBottomLeftRadius=[b[k][3].V(c),b[k][7].V(c)];a.Ac=!0;break;case "border-top-left-cut":a.borderTopLeftRadius=
b[k].map(function(a){return a.V(c)});a.cf=!0;a.Ac=!0;break;case "border-top-right-cut":a.borderTopRightRadius=b[k].map(function(a){return a.V(c)});a.df=!0;a.Ac=!0;break;case "border-bottom-left-cut":a.De=b[k].map(function(a){return a.V(c)});a.De=!0;a.Ac=!0;break;case "border-bottom-right-cut":a.borderBottomRightRadius=b[k].map(function(a){return a.V(c)});a.bf=!0;a.Ac=!0;break;case "border-cut":a.borderTopLeftRadius=[b[k][0].V(c),b[k][4].V(c)];a.borderTopRightRadius=[b[k][1].V(c),b[k][5].V(c)];a.borderBottomRightRadius=
[b[k][2].V(c),b[k][6].V(c)];a.borderBottomLeftRadius=[b[k][3].V(c),b[k][7].V(c)];a.cf=!0;a.df=!0;a.De=!0;a.bf=!0;a.Ac=!0;break;case "backdrop-color":a.Ye=b[k];break;case "background-color":case "background":a.backgroundColor=b[k];break;case "color":a.color=b[k];break;case "font":a.fontFamily=b[k].fontFamily;a.fontSize=b[k].fontSize.V(c);a.fontStyle=b[k].fontStyle;a.fontWeight=b[k].fontWeight;break;case "font-family":a.fontFamily=b[k];break;case "font-size":a.fontSize=b[k].V(c);break;case "font-style":a.fontStyle=
b[k];break;case "font-weight":a.fontWeight=b[k];break;case "overflow":a.scroll="scroll"===b[k];break;case "vertical-align":a.verticalAlign=b[k]instanceof ce?b[k].V(c):b[k];break;case "box-shadow":null!==b[k].ac&&(a.ac=b[k].offset.map(function(a){return a?a.V(c):0}),a.Ad=b[k].Bf?b[k].Bf.V(c):0,a.ue=b[k].Zf?b[k].Zf.V(c):0,a.shadowColor=b[k].color);break;case "width":d=b[k].V(c);break;case "min-width":f=b[k].V(c);break;case "max-width":h=b[k].V(c);break;case "height":e=b[k].V(c);break;case "min-height":g=
b[k].V(c);break;case "max-height":m=b[k].V(c);break;default:b.hasOwnProperty(k)&&(a.qe[k]=b[k])}d=Math.max(Math.min(d,h),f);e=Math.max(Math.min(e,m),g);0<=d&&(a.width=d);0<=e&&(a.height=e)}y.setPosition=function(a,b){this.x=a+this.offsetLeft();this.y=b+this.offsetTop()};function L(a){return a.width+Ld(a)}y.qa=function(){return this.height+(this.marginTop+this.borderTopWidth+this.paddingTop+this.paddingBottom+this.borderBottomWidth+this.marginBottom)};
y.Nc=function(a){this.width=a-(this.marginLeft+this.borderLeftWidth+this.paddingLeft+this.paddingRight+this.borderRightWidth+this.marginRight)};y.Bc=function(a){this.height=a-(this.marginTop+this.borderTopWidth+this.paddingTop+this.paddingBottom+this.borderBottomWidth+this.marginBottom)};
y.qb=function(){var a=new $b;a.width=this.width;a.height=this.height;a.x=this.x;a.y=this.y;a.marginLeft=this.marginLeft;a.marginRight=this.marginRight;a.marginTop=this.marginTop;a.marginBottom=this.marginBottom;a.Eb=this.Eb;a.Ac=this.Ac;a.borderLeftWidth=this.borderLeftWidth;a.borderRightWidth=this.borderRightWidth;a.borderTopWidth=this.borderTopWidth;a.borderBottomWidth=this.borderBottomWidth;a.borderLeftStyle=this.borderLeftStyle;a.borderRightStyle=this.borderRightStyle;a.borderTopStyle=this.borderTopStyle;
a.borderBottomStyle=this.borderBottomStyle;a.borderLeftColor=this.borderLeftColor;a.borderRightColor=this.borderRightColor;a.borderTopColor=this.borderTopColor;a.borderBottomColor=this.borderBottomColor;a.borderTopLeftRadius=this.borderTopLeftRadius;a.borderTopRightRadius=this.borderTopRightRadius;a.borderBottomRightRadius=this.borderBottomRightRadius;a.borderBottomLeftRadius=this.borderBottomLeftRadius;a.cf=this.cf;a.df=this.df;a.De=this.De;a.bf=this.bf;a.Bb=this.Bb;a.paddingLeft=this.paddingLeft;
a.paddingRight=this.paddingRight;a.paddingTop=this.paddingTop;a.paddingBottom=this.paddingBottom;a.Ye=this.Ye;a.backgroundColor=this.backgroundColor;a.color=this.color;a.fontFamily=this.fontFamily;a.fontSize=this.fontSize;a.fontStyle=this.fontStyle;a.fontWeight=this.fontWeight;a.scroll=this.scroll;a.verticalAlign=this.verticalAlign;a.ac=this.ac;a.Ad=this.Ad;a.ue=this.ue;a.shadowColor=this.shadowColor;return a};y.offsetLeft=function(){return this.marginLeft+this.borderLeftWidth+this.paddingLeft};
function Ld(a){return a.marginLeft+a.borderLeftWidth+a.paddingLeft+a.paddingRight+a.borderRightWidth+a.marginRight}y.offsetTop=function(){return this.marginTop+this.borderTopWidth+this.paddingTop};function rd(a){return a.height+a.paddingTop+a.paddingBottom}function Nc(a){return(a.fontStyle?a.fontStyle+" ":"")+(a.fontWeight?a.fontWeight+" ":"")+a.fontSize.toFixed(1)+"px "+a.fontFamily}
function je(a,b){this.margin=0;this.Fe=this.style=this.width=null;this.color="black";this.ac=null;this.ue=this.Ad=0;this.shadowColor=null;this.qe={};a&&le(this,a.nd,b);null===this.width&&(this.width=null!==this.style&&"none"!==this.style?1:0);null===this.style&&(this.style=0<this.width?"solid":"none");null===this.Fe&&(this.Fe="butt")}je.prototype=Object.create(ge.prototype);je.prototype.constructor=je;
function le(a,b,c){for(var d in b)switch(d){case "margin":a.margin=b[d].V(c);break;case "line-width":a.width=b[d].V(c);break;case "line-style":a.style=b[d];break;case "line-cap":a.Fe=b[d];break;case "color":a.color=b[d];break;case "line":null!==b[d].color&&(a.color=b[d].color);null!==b[d].style&&(a.style=b[d].style);null!==b[d].width&&(a.width=b[d].width.V(c));break;case "line-shadow":null!==b[d].ac&&(a.ac=b[d].offset.map(function(a){return a?a.V(c):0}),a.Ad=b[d].Bf?b[d].Bf.V(c):0,a.ue=b[d].Zf?b[d].Zf.V(c):
0,a.shadowColor=b[d].color);break;default:b.hasOwnProperty(d)&&(a.qe[d]=b[d])}}je.prototype.qb=function(){var a=new je;a.margin=this.margin;a.width=this.width;a.style=this.style;a.Fe=this.Fe;a.color=this.color;a.ac=this.ac;a.Ad=this.Ad;a.ue=this.ue;a.shadowColor=this.shadowColor;return a};var me=!1;function ne(a,b,c,d){a.strokeStyle=c||"black";switch(d){case "dotted":a.setLineDash([2*b,3*b]);a.lineDashOffset=0;break;case "dashed":a.setLineDash([3*b,3*b]),a.lineDashOffset=0}a.lineWidth=b||0}
function Kc(a,b,c,d,e){function f(){var a=Math.min(g.borderTopLeftRadius[0],h/2),e=Math.min(g.borderTopLeftRadius[1],m/2);b.moveTo(c,d+e);g.cf?b.lineTo(c+a,d):b.bezierCurveTo(c,d+e/2,c+a/2,d,c+a,d);a=Math.min(g.borderTopRightRadius[0],h/2);e=Math.min(g.borderTopRightRadius[1],m/2);b.lineTo(c+h-a,d);g.df?b.lineTo(c+h,d+e):b.bezierCurveTo(c+h-a/2,d,c+h,d+e/2,c+h,d+e);a=Math.min(g.borderBottomRightRadius[0],h/2);e=Math.min(g.borderBottomRightRadius[1],m/2);b.lineTo(c+h,d+m-e);g.bf?b.lineTo(c+h-a,d+m):
b.bezierCurveTo(c+h,d+m-e/2,c+h-a/2,d+m,c+h-a,d+m);a=Math.min(g.borderBottomLeftRadius[0],h/2);e=Math.min(g.borderBottomLeftRadius[1],m/2);b.lineTo(c+a,d+m);g.De?b.lineTo(c,d+m-e):b.bezierCurveTo(c+a/2,d+m,c,d+m-e/2,c,d+m-e);b.closePath()}e||(c-=a.paddingLeft,d-=a.paddingTop);var g=a,h=a.width+a.paddingLeft+a.paddingRight,m=a.height+a.paddingTop+a.paddingBottom;me&&(b.save(),b.strokeStyle="black",b.lineWidth=1,b.strokeRect(c,d,h,m),b.strokeRect(c+a.paddingLeft,d+a.paddingTop,a.width,a.height),b.strokeRect(c-
a.marginLeft,d-a.marginTop,h+a.marginLeft+a.marginRight,m+a.marginTop+a.marginBottom),b.restore());b.save();0<a.Bb&&(b.beginPath(),b.rect(c-a.Bb,d-a.Bb,2*a.Bb,2*a.Bb),b.rect(c+h-a.Bb,d-a.Bb,2*a.Bb,2*a.Bb),b.rect(c-a.Bb,d+m-a.Bb,2*a.Bb,2*a.Bb),b.rect(c+h-a.Bb,d+m-a.Bb,2*a.Bb,2*a.Bb),b.clip());"transparent"!==a.Ye&&(b.fillStyle=a.Ye,b.fillRect(c,d,h,m));b.beginPath();a.Ac?(b.beginPath(),f()):b.rect(c,d,h,m);b.save();a.ac&&(b.shadowOffsetX=a.ac[0],b.shadowOffsetY=a.ac[1],b.shadowColor=a.shadowColor,
b.shadowBlur=a.Ad);a.backgroundColor?b.fillStyle=a.backgroundColor:a.ac&&(b.fillStyle="transparent");b.fill();b.restore();a.Eb?0<a.borderLeftWidth&&a.borderLeftColor&&"none"!==a.borderLeftStyle&&"hidden"!==a.borderLeftStyle&&(ne(b,a.borderLeftWidth,a.borderLeftColor,a.borderLeftStyle),"double"===a.borderLeftStyle&&(b.save(),b.translate(c+h/2,d+m/2),b.scale((h-3*a.borderLeftWidth)/h,(m-3*a.borderLeftWidth)/m),b.translate(-c-h/2,-d-m/2),f(),b.restore()),b.stroke()):(0<a.borderLeftWidth&&a.borderLeftColor&&
"none"!==a.borderLeftStyle&&"hidden"!==a.borderLeftStyle&&(ne(b,a.borderLeftWidth,a.borderLeftColor,a.borderLeftStyle),b.beginPath(),b.moveTo(c,d),b.lineTo(c,d+m),b.stroke()),0<a.borderRightWidth&&a.borderRightColor&&"none"!==a.borderRightStyle&&"hidden"!==a.borderRightStyle&&(ne(b,a.borderRightWidth,a.borderRightColor,a.borderRightStyle),b.beginPath(),b.moveTo(c+h,d),b.lineTo(c+h,d+m),b.stroke()),0<a.borderTopWidth&&a.borderTopColor&&"none"!==a.borderTopStyle&&"hidden"!==a.borderTopStyle&&(ne(b,
a.borderTopWidth,a.borderTopColor,a.borderTopStyle),b.beginPath(),b.moveTo(c,d),b.lineTo(c+h,d),b.stroke()),0<a.borderBottomWidth&&a.borderBottomColor&&"none"!==a.borderBottomStyle&&"hidden"!==a.borderBottomStyle&&(ne(b,a.borderBottomWidth,a.borderBottomColor,a.borderBottomStyle),b.beginPath(),b.moveTo(c,d+m),b.lineTo(c+h,d+m),b.stroke()));b.restore();me&&a.qe["-vpl-debug"]&&(b.save(),b.font="9px sans-serif",b.textAlign="start",b.textBaseline="top",b.fillStyle="black",b.fillText(a.qe["-vpl-debug"],
c,d),b.restore())}$b.prototype.L=function(a){Kc(this,a,this.x,this.y)};je.prototype.stroke=function(a){a.save();this.ac&&(a.shadowOffsetX=this.ac[0],a.shadowOffsetY=this.ac[1],a.shadowColor=this.shadowColor,a.shadowBlur=this.Ad);0<this.width&&this.color&&"none"!==this.style&&"hidden"!==this.style&&(ne(a,this.width,this.color,this.style),a.lineCap=this.Fe,a.stroke());a.restore()};function ed(a,b,c,d,e,f,g,h,m,k){this.data=a;this.width=b;this.height=c;this.x=d;this.y=e;this.i=null;this.ha=[];this.G=f;this.u=null;this.l=this.Xa=!0;this.za=null;this.b=g||null;this.nb=h||null;this.fb=m||null;this.hg=this.pb=!1;this.vc=this.doScroll=null;this.id=k||"";this.w=this.ta=this.Y=this.S=null}ed.prototype.clone=function(){var a=new ed(this.data,this.width,this.height,this.x,this.y,this.G,this.b,this.nb,this.fb,this.id);a.u=this.u;return a};
ed.prototype.L=function(a,b,c,d,e){var f=a.O,g=this.i&&void 0===b;g&&(f.save(),f.beginPath(),f.rect(this.i.x,this.i.y,this.i.qc,this.i.ed),f.clip(),b=this.i.Ng,c=this.i.Og);d?this.u&&this.u(a,this,b||0,c||0,e):this.G&&this.G(a,this,b||0,c||0,e);g&&f.restore()};ed.prototype.toDataURL=function(a,b,c){var d=document.createElement("canvas");b=b||1;d.width=b*this.width;d.height=b*this.height;b=new Kb(d,{lh:b});b.B=a;this.L(b);this.L(b,0,0,!0);return d.toDataURL(c||"image/png")};
function oe(a){return a.i?{Gb:a.i.Ng,Hb:a.i.Og}:{Gb:0,Hb:0}}
function Kb(a,b){function c(a){function b(a){var b=e.b.getBoundingClientRect(),d=oe(a);a.w=a.b.fa?a.b.fa(e,a.data,a.width,a.height,b.left+a.x+d.Gb,b.top+a.y+d.Hb,c):0;return null!==a.w?(a.b.Oa&&a.b.Oa(e,a.data,a.w,a.width,a.height,b.left+a.x+d.Gb,b.top+a.y+d.Hb,c),e.ta&&e.ta(),e.yb?e.yb():J(e),pe=a.b.Oa||a.b.Yc?function(c,f){f?a.b.Yc&&a.b.Yc&&(a.b.Yc(e,a.data,a.w,a.width,a.height,b.left+a.x+d.Gb,b.top+a.y+d.Hb,qe(e,c)),e.ta&&e.ta(),e.yb?e.yb():J(e)):a.b.Oa&&(a.b.Oa(e,a.data,a.w,a.width,a.height,b.left+
a.x+d.Gb,b.top+a.y+d.Hb,qe(e,c)),e.ta&&e.ta(),e.yb?e.yb():J(e))}:null,e.ta&&e.ta(),e.yb?e.yb():J(e),!a.l||null!=a.b&&null!=a.b.Oa):!1}if(e.S){for(var c=qe(e,a),d=0;d<e.pb.length;d++)if(!e.pb[d](a,c))return;if(re(e,c)){var f=e.Lb;f.b&&b(f)}else if(e.Lb)e.w=-1,e.Lb=null,e.ta&&e.ta(),e.yb?e.yb():J(e);else{var p=se(e,c,!0);if(0<p.length){if(f=e.mb[p[0]],0<=e.w&&e.w!==p[0]&&(e.w=-1,e.Lb=null),e.ec=Date.now(),(!f.b||(a instanceof MouseEvent?f.S:f.Y)&&e.w!==p[0]||!b(f))&&f.l){var n=f.za?f.za(f):f,t=null,
q=oe(n),l=c.x-q.Gb,v=c.y-q.Hb,r=pe;pe=function(a,b,c){var d=qe(e,a);e.Wf&&e.Wf(b?null:f);if(b){if((c?f.Y:f.S)&&10>Math.abs(d.x-q.Gb-l)+Math.abs(d.y-q.Hb-v))e.w=p[0],e.Lb=(c?f.Y:f.S)(f,c);else{if(f.b&&f.b.Yc&&10>Math.abs(d.x-q.Gb-l)+Math.abs(d.y-q.Hb-v)){r(a,b,c);return}if(t&&t.nb&&(!t.fb||t.fb(t,n)))t.nb(t,n);else if(null==t||null==t.nb||t.fb&&!t.fb(t,n)){for(b=0;b<e.ha.length&&!e.ha[b].nb(t,n,d.x,d.y);b++);b>=e.ha.length&&e.za&&e.za()}else e.za&&e.za()}J(e);e.b.style.cursor="default"}else{c=se(e,
d,!1);t=null;a=!1;for(b=0;!a&&b<c.length;b++)t=e.mb[c[b]],a=t.nb&&(!t.fb||t.fb(t,n));a&&null!=t?(t.hg=!0,J(e),t.hg=!1):J(e);b=e.O;a&&!t.pb&&(c=oe(t),gd(e,t.x+c.Gb,t.y+c.Hb,t.width,t.height,["drop-target"]));b.save();te(e);e.transform&&(b.translate(e.width/2,e.height/2),CanvasRenderingContext2D.prototype.transform.apply(b,e.transform),b.translate(-e.width/2,-e.height/2));b.translate(e.l*e.Ha.Z,e.i*e.Ha.ba);b.globalAlpha=.5;n.L(e,d.x-l,d.y-v);n.ha.forEach(function(a){a.L(e,d.x-l,d.y-v);a.L(e,d.x-l,
d.y-v,!0)});n.L(e,d.x-l,d.y-v,!0);b.restore();e.b.style.cursor=a?"copy":"default"}}}}else 0<=e.w&&(e.w=-1,e.Lb=null,J(e))}}}var d=b&&b.lh||("devicePixelRatio"in window?window.devicePixelRatio:1);this.b=a;this.l=a.width/d;this.i=a.height/d;this.Ha=b&&b.Ha||{Z:0,oa:1,ba:0,pa:1};this.width=this.l*(this.Ha.oa-this.Ha.Z);this.height=this.i*(this.Ha.pa-this.Ha.ba);this.S=!0;this.pb=[];this.transform=this.Ab=null;this.O=this.b.getContext("2d");this.Xa=this.state=null;this.Wf=b&&b.Wf||null;this.ha=[];this.za=
null;this.ec=0;this.w=-1;this.Lb=null;this.u={};this.clientData={};this.ia=b&&b.ia||new Jb;this.B=null;this.resize(this.width,this.height,b&&b.lh);this.Y={};var e=this;a.addEventListener("mousedown",c,!1);a.addEventListener("touchstart",function(a){var b=a.targetTouches;1===b.length&&(a.preventDefault(),c(b[0]),ue=b[0])},!1);a.addEventListener("wheel",function(a){function b(b){b.doScroll&&(a.preventDefault(),b.doScroll(0===a.deltaMode?a.deltaX:1===a.deltaMode?10*a.deltaX:30*a.deltaX,0===a.deltaMode?
a.deltaY:1===a.deltaMode?10*a.deltaY:30*a.deltaY))}if(e.S){var c=qe(e,a);if(re(e,c))e.Lb&&b(e.Lb);else if(0>e.w){c=se(e,c,!0);for(var d=0;d<c.length;d++)if(null!=e.mb[c[d]].doScroll){b(e.mb[c[d]]);break}}}},!1);a.addEventListener("mousemove",function(a){if(e.S){for(var b=se(e,qe(e,a),!0),c=0;c<b.length;c++)if(null!=e.mb[b[c]].vc){a.preventDefault();e.mb[b[c]].vc();return}e.Xa&&e.Xa()}},!1);this.mb=[];this.G=[];this.yb=this.ta=null}function Qb(a,b){a.pb.push(b)}
function qc(a,b){a.Ha=b||{Z:0,oa:1,ba:0,pa:1};a.width=a.l*(a.Ha.oa-a.Ha.Z);a.height=a.i*(a.Ha.pa-a.Ha.ba)}function Dd(a,b){for(var c=0;c<a.ha.length;c++)if("delete"===a.ha[c].tag){a.ha[c].nb=b;return}a.ha.push({tag:"delete",nb:b})}Kb.prototype.show=function(){this.S=!0};Kb.prototype.tc=function(){this.S=!1};function ve(a,b){a.b.style.filter=b}function we(a,b){a.Ab=b&&b.slice();a.transform=a.Ab}
function qe(a,b){b={x:b.clientX,y:b.clientY,Th:b.altKey};var c=[b.x,b.y];c=[c[0]-a.l*a.Ha.Z,c[1]-a.i*a.Ha.ba];var d=a.transform;if(d){var e=a.width/2;a=a.height/2;d=d.slice(0,4).concat(d[4]-e*d[0]-a*d[2]+e,d[5]-e*d[1]-a*d[3]+a);a=d[0]*d[3]-d[1]*d[2];c=[(d[3]*c[0]-d[2]*c[1]+d[2]*d[5]-d[3]*d[4])/a,(-d[1]*c[0]+d[0]*c[1]+d[1]*d[4]-d[0]*d[5])/a]}b.x=c[0];b.y=c[1];return b}function xe(a){a.ta&&a.ta();a.yb?a.yb():J(a)}
function ac(a,b){return{m:a,dh:60,eh:120,Yg:!1,va:Math.max(1,Math.min(3,Math.round(a/40))),fg:Math.round(a/4).toString(10)+"px sans-serif",ji:"navy",ki:"#37f",ii:"#06f",g:b,Da:Math.max(1,Math.min(3,b/30)),Mh:"bold 15px sans-serif",Cg:"navy",Bg:"#ccc",od:5,ig:"#e44",Mg:"#f88",Ag:"#bbb"}}
function Bd(a,b){a.width=a.l*(a.Ha.oa-a.Ha.Z);a.height=a.i*(a.Ha.pa-a.Ha.ba);a.O=a.b.getContext("2d");b=b||("devicePixelRatio"in window?window.devicePixelRatio:1);1!=b&&(a.O.resetTransform(),a.O.scale(b,b));a.ia.b=new ee(a.width,a.width/100,a.height/100,a.l/100,a.i/100);b=M(a.ia,{tag:"block"}).width;var c=M(a.ia,{tag:"button"}).width;a.B=ac(b,c)}
Kb.prototype.resize=function(a,b,c){var d=c||("devicePixelRatio"in window?window.devicePixelRatio:1);this.b.width=a*d;this.b.height=b*d;this.b.style.width=a+"px";this.b.style.height=b+"px";this.l=a;this.i=b;Bd(this,c)};function hd(a,b){for(var c=0;c<a.mb.length;c++)if(a.mb[c].data===b)return c;return-1}
function se(a,b,c){var d=a.b.getBoundingClientRect(),e=b.x-d.left;b=b.y-d.top;d=[];for(var f=a.mb.length-1;0<=f;f--){var g=oe(a.mb[f]);if(g=(!c||a.mb[f].Xa)&&e>=a.mb[f].x+g.Gb&&e<=a.mb[f].x+g.Gb+a.mb[f].width&&b>=a.mb[f].y+g.Hb&&b<=a.mb[f].y+g.Hb+a.mb[f].height)g=a.mb[f],g=!g.i||e>=g.i.x&&e<g.i.x+g.i.qc&&b>=g.i.y&&b<g.i.y+g.i.ed;g&&d.push(f)}return d}
function Ec(a,b){var c=b.clone();a=Cd(a);var d=Math.min(a.width,a.height)/1.5/c.width;c.width*=d;c.height*=d;c.x=(a.width-c.width)/2;c.y=(a.height-c.height)/2;c.S=null;c.Y=null;c.G=function(a,f){var e=a.O;e.save();e.translate(f.x,f.y);e.scale(d,d);e.translate(-f.x,-f.y);b.G(a,c,f.x-c.x,f.y-c.y,!0);e.restore()};b.u&&(c.u=function(a,f){var e=a.O;e.save();e.translate(f.x,f.y);e.scale(d,d);e.translate(-f.x,-f.y);b.u(a,c,f.x-c.x,f.y-c.y,!0);e.restore()});return c}
function re(a,b){if(null==a.Lb)return!1;var c=a.b.getBoundingClientRect(),d=b.x-c.left;b=b.y-c.top;return d>=a.Lb.x&&d<=a.Lb.x+a.Lb.width&&b>=a.Lb.y&&b<=a.Lb.y+a.Lb.height}function Cd(a){return{width:a.width,height:a.height}}function te(a){a.O.beginPath();a.O.rect(a.l*a.Ha.Z,a.i*a.Ha.ba,a.l*(a.Ha.oa-a.Ha.Z),a.i*(a.Ha.pa-a.Ha.ba));a.O.clip()}
function ye(a,b,c,d,e,f,g){f=f||0;g=g||0;if(0<a.G.length){var h=a.G[a.G.length-1];h.x>b&&(d-=h.x-b,b=h.x);h.x+h.qc<b+d&&(d=h.x+h.qc-b);h.y>c&&(e-=h.y-c,c=h.y);h.y+h.ed<c+e&&(e=h.y+h.ed-c);f+=h.Ng;g+=h.Og}a.G.push({x:b,y:c,qc:d,ed:e,Ng:f,Og:g})}function kd(a,b,c){0<a.G.length&&(b.i=a.G[a.G.length-1]);0<=c?a.mb[c]=b:a.mb.push(b)}function Jc(a,b){var c=new ed(null,-1,-1,0,0,function(a,c,f,g){a=a.O;a.save();a.translate(c.x+f,c.y+g);b(a);a.restore()});kd(a,c);return c}
function Lc(a,b,c,d,e,f,g){var h,m=new ed(null,d.width,d.height,b,c,function(b,c,f,h){b=b.O;b.save();Kc(d,b,c.x+f,c.y+h);b.translate(c.x+f,c.y+h);e(b,d,a.u.id===g&&a.u.Sd||c.hg);b.restore()},f&&(f.action||f.ee||f.fe)?{fa:function(b,c,d,e,q,l,v){a.u={id:g,rect:{x:m.x,y:m.y,qc:d,ed:e},Sd:!0};h=v;f.ee&&f.ee(h);J(a);return 0},Oa:function(b,c,d,e,f,g,h,m){d=b.b.getBoundingClientRect();c=m.x-d.left;m=m.y-d.top;a.u.Sd=c>=a.u.rect.x&&c<a.u.rect.x+a.u.rect.qc&&m>=a.u.rect.y&&m<a.u.rect.y+a.u.rect.ed;J(b)},
Yc:function(){f.action?a.u.Sd&&f.action(h):f.fe&&f.fe(h);a.u={};J(a)}}:null,f&&f.nb,f&&f.fb,g);m.vc=f&&f.vc||null;m.l=!1;m.pb=!0;kd(a,m);return m}function td(a,b,c,d,e){Kc(e,a.O,c-e.width/2,d-e.height/2);var f=a.Y[b];void 0!=f&&(a.O.save(),a.O.translate(c,d),f(a.O,b,a.B,e),a.O.restore())}
function J(a){a.S&&(a.O.clearRect(a.l*a.Ha.Z,a.i*a.Ha.ba,a.l*(a.Ha.oa-a.Ha.Z),a.i*(a.Ha.pa-a.Ha.ba)),a.O.save(),a.transform&&(a.O.translate(a.width/2,a.height/2),CanvasRenderingContext2D.prototype.transform.apply(a.O,a.transform),a.O.translate(-a.width/2,-a.height/2)),a.O.translate(a.l*a.Ha.Z,a.i*a.Ha.ba),a.mb.forEach(function(a){a.L(this)},a),a.mb.forEach(function(a){a.L(this,void 0,void 0,!0)},a),a.Lb&&(a.O.save(),a.O.globalAlpha=.5,a.O.fillStyle="black",a.O.fillRect(a.l*a.Ha.Z,a.i*a.Ha.ba,a.l*
(a.Ha.oa-a.Ha.Z),a.i*(a.Ha.pa-a.Ha.ba)),a.O.restore(),a.Lb.L(a),a.Lb.L(a,0,0,!0)),a.O.restore())};function $c(){this.w=this.G=1;this.i=this.l=this.y=this.x=0;this.S=!1;this.ha="";this.ye=this.b=this.xe=this.u=0;this.Y=null}y=$c.prototype;y.Nc=function(a){this.G=a;this.u=Math.max(0,Math.min(this.u,this.G-this.l))};y.Bc=function(a){this.w=a;this.b=Math.max(0,Math.min(this.b,this.w-this.i))};y.resize=function(a,b,c,d){this.x=a;this.y=b;this.l=c;this.i=d;this.u=Math.max(0,Math.min(this.u,this.G-this.l));this.b=Math.max(0,Math.min(this.b,this.w-this.i))};
y.be=function(a){this.Y=a;var b=this,c=new ed(null,this.l,this.i,this.x,this.y,null,this.G>this.l||this.w>this.i?{fa:function(a,c,f,g,h,m,k){b.xe=k.x;b.ye=k.y;return 0},Oa:function(a,c,f,g,h,m,k,p){a=Math.max(Math.min(p.x-b.xe,b.u),b.u-b.G+b.l);b.u-=a;b.xe+=a;p=Math.max(Math.min(p.y-b.ye,b.b),b.b-b.w+b.i);b.b-=p;b.ye+=p}}:null,null,null);c.l=!1;c.doScroll=function(c,e){b.u+=c;b.b+=e;a.ta()};kd(a,c);this.ha&&Jc(a,function(a){a.save();a.fillStyle=b.ha;a.fillRect(b.x,b.y,b.l,b.i);a.restore()});(this.G>
this.l||this.w>this.i)&&Jc(a,function(c){c.save();if(b.G>b.l){var d=b.l/b.G;d=Math.max(d*b.l,Math.min(20,b.l));var f=b.l-d,g=b.u/(b.G-b.l);f*=g;c.fillStyle=a.B.Bg;c.fillRect(b.x,b.y+b.i+2,b.l,a.B.od);c.fillStyle=a.B.Cg;c.fillRect(b.x+f,b.y+b.i+2,d,a.B.od)}b.w>b.i&&(d=b.i/b.w,d=Math.max(d*b.i,Math.min(20,b.i)),f=b.i-d,g=b.b/(b.w-b.i),f*=g,c.save(),c.fillStyle=a.B.Bg,c.fillRect(b.S?b.x-2-a.B.od:b.x+b.l+2,b.y,a.B.od,b.i),c.fillStyle=a.B.Cg,c.fillRect(b.S?b.x-2-a.B.od:b.x+b.l+2,b.y+f,a.B.od,d));c.restore()});
ye(a,this.x,this.y,this.l,this.i,-this.u,-this.b)};y.end=function(){this.Y.G.pop()};function Nd(a,b,c){c-a.b>a.i&&(a.b=c-a.i);b<a.b&&(a.b=b)}function Jd(a){return a.b<=.001*a.i}function Kd(a){return a.b>=a.w-1.001*a.i};function gd(a,b,c,d,e,f){f=M(a.ia,{tag:"overlay-rectangle",ea:f||[]});f.x=b;f.y=c;f.width=d;f.height=e;f.L(a.O)}
function Mc(a,b,c,d,e,f,g,h){gd(a,b,c,d,e,(f||[]).concat("disabled"));if(!h){a.O.save();f=zd(a.ia,{tag:"crossout-line",ea:g||[]});a.O.beginPath();h=a.ia;g=/^(-?([0-9]+\.?|[0-9]*\.[0-9]+))([a-z]*)$/.exec(f.qe["line-angle"]||"0");if(null==g)throw"Illegal angle";if(h.Y.hasOwnProperty(g[3]))h=h.Y[g[3]];else if(0==parseFloat(g[1]))h=0;else throw"Unknown angle unit";g=parseFloat(g[1])*h;h=Rd(a.ia,f.qe["line-overflow"]||"0").V(a.ia.b);if(Math.abs(g%Math.PI)<.25*Math.PI||Math.abs((Math.PI-g)%Math.PI)<.25*
Math.PI){h=(d/2+h)*Math.sign(Math.cos(g));var m=e/2*Math.sin(g)*Math.sqrt(2)}else m=(e/2+h)*Math.sign(Math.sin(g)),h=d/2*Math.cos(g)*Math.sqrt(2);a.O.moveTo(b+d/2-h,c+e/2-m);a.O.lineTo(b+d/2+h,c+e/2+m);f.stroke(a.O);a.O.restore()}}
function Oc(a,b,c,d,e,f){a.save();a.strokeStyle=e;a.fillStyle=e;a.lineWidth=d;a.fillRect(b-2.5*d,c-d,5*d,4*d);a.beginPath();a.moveTo(b-1.7*d,c);a.lineTo(b-1.7*d,c);f?(a.arc(b-3.4*d,c-2*d,1.7*d,0,Math.PI,!0),a.lineTo(b-5.1*d,c)):(a.arc(b,c-2*d,1.7*d,-Math.PI,0),a.lineTo(b+1.7*d,c));a.stroke();a.restore()}function fd(a,b,c,d,e,f,g){var h=.03*a.B.m;Oc(a.O,b+d+(f?-5:5)*h,c+.15*e,h,g||"#333")}
function Qc(a,b,c,d,e,f,g){a.save();g&&(g.style&&(a.strokeStyle=g.style,a.fillStyle=g.style),void 0!==g.lineWidth&&(a.lineWidth=g.lineWidth),void 0!==g.alpha&&(a.globalAlpha=g.alpha));var h=g&&void 0!==g.td?g.td:5*a.lineWidth;a.beginPath();var m=e+(g&&g.$d?h/d:0),k=f-(g&&g.$d?0:h/d);a.arc(b,c,d,m,k);a.stroke();g&&g.$d?(a.translate(b+d*Math.cos(e),c+d*Math.sin(e)),a.rotate((e+m)/2+Math.PI)):(a.translate(b+d*Math.cos(f),c+d*Math.sin(f)),a.rotate((f+k)/2));a.beginPath();a.moveTo(0,0);a.lineTo(h/2,1.2*
-h);a.lineTo(-h/2,1.2*-h);a.fill();a.restore()}Kb.prototype.text=function(a,b){var c=this.O,d=this.B;c.save();c.fillStyle=b&&b.fillStyle||"white";c.font=d.fg;c.textAlign="center";c.textBaseline="middle";c.translate(.5*d.m+(b&&b.x||0),.5*d.m-(b&&b.y||0));b&&b.Wh&&c.rotate(-b.Wh);c.translate(-.5*d.m,-.5*d.m);c.fillText(a,.5*d.m,.5*d.m);c.restore()};
function ze(a,b){var c=a.O,d=a.B;c.save();c.beginPath();c.rect(0,0,a.B.m,a.B.m);c.clip();b&&(b.scale||b.rotation)&&(b.$f&&c.translate(-b.$f[0],-b.$f[1]),c.translate(.5*d.m,.5*d.m),b.scale&&c.scale(b.scale,b.scale),b.rotation&&c.rotate(-b.rotation),c.translate(-.5*d.m,-.5*d.m));c.beginPath();c.moveTo(.5*d.m,d.m-d.va);b&&"left"===b.rf||(c.lineTo(d.m-d.va,d.m-d.va),c.lineTo(d.m-d.va,.25*d.m),c.bezierCurveTo(.8*d.m,d.va,.52*d.m,d.va,.5*d.m,d.va));b&&"right"===b.rf||(c.lineTo(.5*d.m,d.va),c.bezierCurveTo(.48*
d.m,d.va,.2*d.m,d.va,d.va,.25*d.m),c.lineTo(d.va,d.m-d.va));c.closePath();if(b&&b.lc){a=[b.lc[0],Math.max(.2+.8*b.lc[1],b.lc[2]/2),b.lc[2]];var e=Math.max(a[0],Math.max(a[1],a[2]));c.fillStyle="rgb("+a.map(function(a){return Math.round(225*(1-e)+(30+225*e)*a)}).join(",")+")"}else c.fillStyle="white";c.fill();b&&b.lc&&(c.strokeStyle="white",c.lineWidth=d.va,c.stroke());b&&b.Fc&&(c.fillStyle="black",c.fillRect(0,.6*d.m,.1*d.m,.35*d.m),c.fillRect(.9*d.m,.6*d.m,.1*d.m,.35*d.m));c.restore()}
function Ae(a,b){var c=(b-a)/2,d=b===a?Infinity:(b+a)/(2*c);return{jb:c,cg:d,x:Math.abs(d)>1E3*Math.abs(a+b)?0:d*(.01>c?c*c/2:1-Math.cos(c)),y:Math.abs(d)>1E3*Math.abs(a+b)?(a+b)/2:d*Math.sin(c)}}
function Be(a,b,c,d,e){var f=a.O;a=a.B;d*=a.m;var g=e&&e.r||[-1,0,1],h=e&&e.color||"black";e=e&&void 0!==e.mf?e.mf:1;var m=Ae(b,c);f.save();f.translate(.5*a.m,.5*a.m);f.strokeStyle=h;f.lineWidth=a.va*e;20<Math.abs(m.cg)?(f.beginPath(),g.forEach(function(a){f.moveTo(a*d,0);f.lineTo((m.x+a)*d,-m.y*d)}),f.stroke()):g.forEach(function(a){f.beginPath();var b=-m.cg*d;a=(m.cg+a)*d;var c=m.jb;0<a?f.arc(b,0,a,0,-c,0<c):0>a&&f.arc(b,0,-a,Math.PI,Math.PI-c,0<c);f.stroke()});f.restore();return m}
function Ce(a,b,c,d,e,f,g){a=a.B;e*=a.m;f*=a.m;a=.21*a.m;c=g.x-c-b/2;b=d+b/2-g.y;e=Ae(e,f);return(c-e.x)*(c-e.x)+(b-e.y)*(b-e.y)<a*a}
function De(a){var b=a.O;a=a.B;b.save();b.translate(.5*a.m,.5*a.m);b.scale(.7,.7);b.translate(-.5*a.m,-.5*a.m);b.fillStyle="white";b.fillRect(a.va,.45*a.m,a.m-2*a.va,.35*a.m);b.fillStyle="black";b.beginPath();b.arc(.27*a.m,.72*a.m,.2*a.m,0,2*Math.PI);b.fill();b.fillStyle="white";b.beginPath();b.arc(.27*a.m,.72*a.m,.12*a.m,0,2*Math.PI);b.fill();b.beginPath();b.arc(.8*a.m,.8*a.m-a.va,.1*a.m,0,2*Math.PI);b.fill();b.restore()}
function Ee(a){var b=a.O;a=a.B;b.save();b.lineWidth=a.va;b.strokeStyle="white";for(var c=1;3>=c;c++)b.beginPath(),b.arc(.185*a.m,.48*a.m,.05*a.m*c,.9*Math.PI,1.7*Math.PI),b.stroke();b.restore()}
Kb.prototype.buttons=function(a,b,c){var d=this.O,e=this.B;a.forEach(function(a,g){d.save();d.translate(e.m*(.5+a.x),e.m*(.5-a.y));d.rotate(a.r||0);d.fillStyle=a.fillStyle?a.fillStyle:c&&c.lg&&b?c.lg[b[g]]:b&&!0===b[g]?"red":b&&1===b[g]?"#f66":b&&-1===b[g]?"#333":"white";d.strokeStyle=a.strokeStyle?a.strokeStyle:c&&c.Eg&&b?c.Eg[b[g]]:!b||1!==b[g]&&!0!==b[g]?b&&0>b[g]?"black":"#aaa":"#700";d.lineWidth=e.va;d.lineJoin="round";var f=a.size||1;switch(a.H){case "r":d.fillRect(.08*-e.m*f,.08*-e.m*f,.16*
e.m*f,.16*e.m*f);d.strokeRect(.08*-e.m*f,.08*-e.m*f,.16*e.m*f,.16*e.m*f);break;case "t":d.beginPath();d.moveTo(0,-.122*e.m*f);d.lineTo(.106*e.m*f,.062*e.m*f);d.lineTo(-.106*e.m*f,.062*e.m*f);d.closePath();d.fill();d.stroke();break;case "c":d.beginPath(),d.arc(0,0,.112*e.m*f,0,2*Math.PI),d.fill(),d.stroke()}b&&c&&void 0!==c.de&&c.de===b[g]&&(d.strokeStyle="white",d.beginPath(),d.moveTo(.06*-e.m*f,.06*-e.m*f),d.lineTo(.06*e.m*f,.06*e.m*f),d.moveTo(.06*-e.m*f,.06*e.m*f),d.lineTo(.06*e.m*f,.06*-e.m*f),
d.stroke());d.restore()})};function Fe(a,b,c,d,e,f,g,h,m){var k=a.O;a=a.B;k.save();k.strokeStyle="black";k.lineWidth=a.va*m;m=b.length/2;for(var p=0;p<m;p++)0<b[2*p+1]&&(k.fillStyle=2===b[2*p+1]?"white":"black",k.beginPath(),k.arc(a.m*(c+(d-c)/m*(p+.5)),a.m*(e+(f-e)/g*(b[2*p]+.5)),a.m*h/2,0,2*Math.PI),k.fill(),k.stroke());k.restore()}
function Ge(a,b){var c=a.O,d=a.B,e=null===b?-.15*d.m:0;c.save();c.beginPath();c.moveTo(.4*d.m+e,.3*d.m);c.lineTo(.4*d.m+e,.7*d.m);c.lineTo(.7*d.m+e,.7*d.m);c.lineTo(.7*d.m+e,.37*d.m);c.lineTo(.63*d.m+e,.3*d.m);c.closePath();c.lineWidth=d.va;c.strokeStyle="white";c.lineJoin="round";c.stroke();for(var f=.15;.31>f;f+=.06)c.beginPath(),c.arc(.65*d.m+e,.5*d.m,d.m*f,-.6,.6),c.stroke();null===b?(c.beginPath(),c.moveTo(.12*d.m,.6*d.m),c.lineTo(.88*d.m,.4*d.m),c.lineWidth=1.5*d.va,c.stroke()):a.text(b.toString(10),
{x:-.3*d.m});c.restore()}function He(a){var b=a.O;a=a.B;b.beginPath();b.arc(0,0,.4*a.m,0,2*Math.PI,!0);b.moveTo(0,0);b.lineTo(0,.4*-a.m);b.strokeStyle="#666";b.lineWidth=a.va;b.stroke();b.beginPath();b.arc(0,.4*-a.m,.1*a.m,0,2*Math.PI);b.fillStyle="white";b.fill();b.strokeStyle="black";b.stroke()}
function Ie(a,b,c){var d=a.O,e=a.B;c=c*Math.PI/12;d.save();d.translate(.5*e.m,.5*e.m);d.rotate(c);He(a);d.fillRect(-.28*e.m,-.1*e.m,.56*e.m,.2*e.m);d.fillStyle="black";b?(d.beginPath(),d.arc(-.15*e.m,.03*e.m,.11*e.m,0,2*Math.PI),d.fill(),d.fillStyle="white",d.beginPath(),d.arc(-.15*e.m,.03*e.m,.07*e.m,0,2*Math.PI),d.fill(),d.beginPath(),d.arc(.15*e.m,.07*e.m,.06*e.m,0,2*Math.PI)):(d.fillRect(-.28*e.m,.1*e.m,.08*e.m,.04*e.m),d.fillRect(.2*e.m,.1*e.m,.08*e.m,.04*e.m),d.fillStyle="white",d.beginPath(),
d.arc(0,.06*e.m,.06*e.m,0,2*Math.PI));d.fill();d.restore()}function Je(a,b,c,d,e){b=d.x-b-a/2;c=c+a/2-d.y;a=(b*b+c*c)/(a*a/4);return 1>a&&.4<a&&(e||0<=c)}function Ke(a,b,c,d,e){a=Math.round(12*Math.atan2(d.x-b-a/2,c+a/2-d.y)/Math.PI);return e?12===a?-12:a:Math.max(-6,Math.min(6,a))}
function Le(a,b,c,d,e,f,g,h,m){var k=m?0>=g?0:Math.max(Math.log(10*g)/Math.log(100),0):g/4;a.save();!h&&f&&f(g);a.beginPath();a.arc(b,c,d,0,2*Math.PI);a.fillStyle="white";a.fill();f=.9*d;g=m?.8*d:.6*d;var p=2*Math.PI*(h?.2:k),n=h?"#ddd":"red";m=(g-(m?.5*d:.6*d))/4;a.save();a.beginPath();a.arc(b,c,f,-Math.PI/2,3*Math.PI/2-.05);a.arc(b,c,g-4*m,3*Math.PI/2-.05,Math.PI,!0);a.arc(b+m,c,g-3*m,Math.PI,Math.PI/2,!0);a.arc(b+m,c-m,g-2*m,Math.PI/2,0,!0);a.arc(b,c-m,g-m,0,-Math.PI/2,!0);a.clip();a.fillStyle=
n;a.beginPath();a.arc(b,c,f,-Math.PI/2,-Math.PI/2+p);a.lineTo(b,c);a.fill();a.restore();a.beginPath();a.arc(b,c,d/2,0,2*Math.PI);a.fill();a.beginPath();a.arc(b,c,d,0,2*Math.PI);a.strokeStyle="black";a.lineWidth=e;a.stroke();a.beginPath();a.moveTo(b-.1*d*Math.sin(2*k*Math.PI),c+.1*d*Math.cos(2*k*Math.PI));a.lineTo(b+.9*d*Math.sin(2*k*Math.PI),c-.9*d*Math.cos(2*k*Math.PI));a.lineWidth=2*e;a.stroke();h&&Qc(a,b,c,1.25*d,.5*-Math.PI,.1*-Math.PI,{$d:!0,td:5*e,style:"black"});a.restore()}
function Me(a,b,c,d){var e=a.O,f=a.B.m;Le(e,f/2+(c?-.05*f:.05*f),f/2+(c?.07*f:.03*f),.4*f,a.B.va,function(a){e.textAlign="start";e.textBaseline="top";e.font=Math.round(f/6).toString(10)+"px sans-serif";e.fillStyle="white";e.fillText(a.toFixed(1>a?2:1),f/20,f/40)},b,c,d)}
function Ne(a,b,c,d,e,f,g){a.save();g&&(g.style&&(a.strokeStyle=g.style,a.fillStyle=g.style),void 0!==g.lineWidth&&(a.lineWidth=g.lineWidth),void 0!==g.alpha&&(a.globalAlpha=g.alpha));a.beginPath();e/=2;a.moveTo(b,d+e);for(g=0;g<f;g++){var h=b+(c-b)*(.5+g)/f;a.lineTo(h,d+e);e=-e;a.lineTo(h,d+e)}a.lineTo(c,d+e);a.stroke();a.restore()}
function Oe(a,b,c,d,e,f,g,h,m,k){var p=(d+e)/2,n=(e-d)/2;a.save();a.beginPath();a.arc(b,c,d,-g,-f);a.arc(b+p*Math.cos(f),c-p*Math.sin(f),n,-f-Math.PI,-f,!0);a.arc(b,c,e,-f,-g,!0);a.arc(b+p*Math.cos(g),c-p*Math.sin(g),n,-g,-g+Math.PI,!0);a.fillStyle=h;a.strokeStyle=m;a.lineWidth=k;a.fill();a.stroke();a.restore()}function Pe(a,b,c,d){var e=a.B;Oe(a.O,e.m/2,e.m/2,.3*e.m,.45*e.m,b,c,0>d?"white":2===d?"red":0<d?"#f70":"#ddd",0===d?"#bbb":"black",e.va)}
function Qe(a,b){var c=a.O;c.save();Pe(a,.65*Math.PI,.85*Math.PI,b[0]);Pe(a,.15*Math.PI,.35*Math.PI,b[1]);Pe(a,1.15*Math.PI,1.35*Math.PI,b[2]);Pe(a,1.65*Math.PI,1.85*Math.PI,b[3]);c.restore()}function Re(a,b){var c=a.O;c.save();for(var d=0;8>d;d++)Pe(a,Math.PI*(.46-.25*d),Math.PI*(.54-.25*d),d===b?1:-1);c.restore()}function Se(a,b,c,d,e,f){b=(f.x-d)/b-.5;c=.5-(f.y-e)/c;for(e=0;e<a.length;e++)if(Math.max(Math.abs(b-a[e].x),Math.abs(c-a[e].y))<.11*(a[e].size||1))return e;return null}
function Te(a,b,c,d,e,f){function g(a,b){h.beginPath();h.moveTo(m.m*(.1+.8*a),m.m*(.46-c));h.lineTo(m.m*(.1+.8*b),m.m*(.46-c));h.arc(m.m*(.1+.8*b),m.m*(.5-c),.04*m.m,-Math.PI/2,Math.PI/2);h.lineTo(m.m*(.1+.8*b),m.m*(.54-c));h.lineTo(m.m*(.1+.8*a),m.m*(.54-c));h.arc(m.m*(.1+.8*a),m.m*(.5-c),.04*m.m,Math.PI/2,-Math.PI/2)}var h=a.O,m=a.B;h.save();d&&(h.translate(.5*m.m,.5*m.m),h.rotate(-Math.PI/2),h.scale(1,-1),h.translate(-.5*m.m,-.5*m.m));h.lineWidth=m.va;h.fillStyle="white";h.strokeStyle="black";
g(0,1);h.fill();h.stroke();h.fillStyle=e;switch(f||0){case 1:g(0,b);h.fill();h.stroke();break;case 2:g(b,1),h.fill(),h.stroke()}h.fillStyle=e;h.strokeStyle="black";h.lineWidth=m.va;h.beginPath();h.arc(m.m*(.1+.8*b),m.m*(.5-c),.1*m.m,0,2*Math.PI);h.fill();h.stroke();h.restore()}function Ue(a,b,c,d,e,f,g){c=(g.x-e)/c-.5;d=.5-(g.y-f)/d;return.1>Math.abs((b?c:d)-a)}function Ve(a,b,c,d,e,f){b=(f.x-d)/b-.5;c=.5-(f.y-e)/c;return.5+(a?c:b)/.8}
function We(a,b,c,d,e,f,g,h,m,k,p){a=Math.floor(((p.x-m)/g-a)/((b-a)/e));c=Math.floor((c-(p.y-k)/h)/((c-d)/f));return 0<=a&&a<e&&0<=c&&c<f?{index:a,tone:c}:null}function Xe(a,b,c,d,e){var f=.4*a;a=e.x-c-.55*a;b=d+.53*b-e.y;return a*a+b*b<=f*f}function Ye(a,b,c,d,e,f){a=(Math.PI-Math.atan2(f.x-c-.55*a,-(d+.53*b-f.y)))/(2*Math.PI);return e?Math.exp(a*Math.log(100))/10:4*a}function Ze(a,b,c,d,e){c=e.x-c-a/2;b=b/2-(e.y-d);return Math.abs(Math.sqrt(c*c+b*b)-.375*a)<=.15*a?0<=b?0>c?0:1:0>c?2:3:null}
function $e(a,b,c,d,e){c=e.x-c-a/2;b=b/2-(e.y-d);return Math.abs(Math.sqrt(c*c+b*b)-.375*a)<=.15*a?(a=Math.atan2(c,b)+Math.PI/8,Math.floor((0>a?a+2*Math.PI:a)/(Math.PI/4))):null}function Pc(a,b,c,d){if(0<d){a.beginPath();a.moveTo(b+d*Math.cos(.1),c+d*Math.sin(.2));for(var e=1;6>e;e++)a.lineTo(b+d*Math.cos(e*Math.PI/3+.2),c+d*Math.sin(e*Math.PI/3+.2));a.closePath();a.arc(b,c,.5*d,0,2*Math.PI,!0);a.fill()}};function ta(a){for(var b=0;b<H.length;b++)if(H[b].name===a)return H[b];return null}function Va(a){var b=[];(H||[]).forEach(function(c){"h"!==c.type&&0<=c.xa.indexOf(a)&&b.push(c)});return b};function af(a,b){var c=.1*(a.size||1);return new pa(.5-a.y-c,.5+a.x-c,.5-a.y+c,.5+a.x+c,b,null,null)}function bf(a,b){return b[(b.indexOf(a)+1)%b.length]}function cf(a,b){return a.map(function(a,d){return af(a,function(a){a.h[d]=bf(a.h[d],b)})})}function df(a){return a.map(function(a,c){return af(a,function(a){a.h[0]=c})})}
function ef(a,b,c,d,e,f,g,h){var m=Math.pow(10,Math.round(Math.log10(Math.abs(g-f)/h/10)));return new pa(b,c,d,e,null,function(b){b.h[a]=m*Math.round(Math.min(g,b.h[a]+(g-f)/(h-1))/m)},function(b){b.h[a]=m*Math.round(Math.max(f,b.h[a]-(g-f)/(h-1))/m)})}
function ff(a,b,c,d,e){var f=.5+.37*Math.cos(Math.PI*(.5-2*(a-.3)/b)),g=.5-.37*Math.sin(Math.PI*(.5-2*(a-.3)/b)),h=.5+.37*Math.cos(Math.PI*(.5-2*(a+.3)/b));a=.5-.37*Math.sin(Math.PI*(.5-2*(a+.3)/b));return new pa(Math.min(g,a)-.1,Math.min(f,h)-.1,Math.max(g,a)+.1,Math.max(f,h)+.1,c,d,e)}function gf(a){for(var b=[],c=[1,3,2,0],d=0;4>d;d++)b.push(ff(d+.5,4,function(b){return function(d){d.h[c[b]]=bf(d.h[c[b]],a)}}(d),null,null));return b}
function hf(){for(var a=[],b=0;8>b;b++)a.push(ff(b,8,function(a){return function(b){b.h[0]=a}}(b),function(a){a.h[0]=(a.h[0]+1)%8},function(a){a.h[0]=(a.h[0]+7)%8}));return a}
var H=[new z({name:"!stop",type:"h"}),new z({name:"!stop and blink",type:"h"}),new z({name:"!volume",type:"h"}),new z(function(){var a=[{H:"c",x:0,y:0,r:0},{H:"t",x:0,y:.3,r:0},{H:"t",x:0,y:-.3,r:Math.PI},{H:"t",x:.3,y:0,r:Math.PI/2},{H:"t",x:-.3,y:0,r:-Math.PI/2}];return{name:"button 1",type:"e",sa:function(){return[0]},ja:new B(df(a)),L:function(b,c){ze(b);c=c.h[0];b.buttons(a,[0==c,1==c,2==c,3==c,4==c])},fa:function(b,c,d,e,f,g,h){b=Se(a,d,e,f,g,h);null!==b&&(F(c),c.h[0]=b,G(c));return b}}}()),
new z(function(){var a=[{H:"c",x:0,y:0,r:0},{H:"t",x:0,y:.3,r:0},{H:"t",x:0,y:-.3,r:Math.PI},{H:"t",x:.3,y:0,r:Math.PI/2},{H:"t",x:-.3,y:0,r:-Math.PI/2}];return{name:"button",xa:["c"],type:"e",sa:function(){return[!1,!1,!1,!1,!1]},eb:function(){return[!1,!1,!0,!1,!0]},ja:new B(cf(a,[!1,!0])),L:function(b,c){ze(b);b.buttons(a,c.h)},fa:function(b,c,d,e,f,g,h){b=Se(a,d,e,f,g,h);null!==b&&(F(c),c.h[b]=!c.h[b],G(c));return b},Pc:function(a){for(var b=0;5>b;b++)if(a.h[b])return null;return new za("No button specified",
!0)}}}()),new z(function(){var a=[{H:"r",x:0,y:.4,r:0,v:"2"},{H:"r",x:-.22,y:.35,r:-.45,v:"1"},{H:"r",x:.22,y:.35,r:.45,v:"3"},{H:"r",x:-.4,y:.22,r:-.8,v:"0"},{H:"r",x:.4,y:.22,r:.8,v:"4"},{H:"r",x:-.2,y:-.4,v:"5"},{H:"r",x:.2,y:-.4,v:"6"}];return{name:"horiz prox",xa:["b"],type:"e",sa:function(){return[0,0,0,0,0,0,0]},eb:function(){return[0,1,-1,1,-1,0,0]},ja:new B(cf(a,[0,1,-1])),L:function(b,c){ze(b);b.buttons(a,c.h,{de:-1})},fa:function(b,c,d,e,f,g,h){b=Se(a,d,e,f,g,h);null!==b&&(F(c),c.h[b]=
(c.h[b]+2)%3-1,G(c));return b},Pc:function(a){for(var b=0;7>b;b++)if(a.h[b])return null;return new za("No proximity sensor specified",!0)},cd:function(a,c){switch(c){case "a":return c=new C(ta("horiz prox adv"),null,null),c.h=a.h.concat(c.h.slice(7)),c;default:return a}}}}()),new z(function(){var a=[{H:"r",x:0,y:.4,r:0,v:"2"},{H:"r",x:-.22,y:.35,r:-.45,v:"1"},{H:"r",x:.22,y:.35,r:.45,v:"3"},{H:"r",x:-.4,y:.22,r:-.8,v:"0"},{H:"r",x:.4,y:.22,r:.8,v:"4"},{H:"r",x:-.2,y:-.4,v:"5"},{H:"r",x:.2,y:-.4,v:"6"}];
return{name:"horiz prox adv",xa:["c"],type:"e",sa:function(){return[0,0,0,0,0,0,0,.1,.4]},eb:function(){return[0,1,2,1,2,3,3,.1,.4]},ja:new B(cf(a,[0,1,2,3]).concat(ef(7,.6,-.05,.8,1.05,.25,.75,3),ef(8,.38,-.05,.58,1.05,.25,.75,3))),L:function(b,c){ze(b);b.buttons(a,c.h,{lg:["white","red","#333","#888"],Eg:["#aaa","black","black","black"],de:2});Te(b,c.h[8],.02,!1,"red",2);Te(b,c.h[7],-.2,!1,"black",1)},fa:function(b,c,d,e,f,g,h){b=Se(a,d,e,f,g,h);return null!==b?(F(c),c.h[b]=(c.h[b]+1)%4,G(c),b):
Ue(.02,!1,d,e,f,g,h)?(F(c),8):Ue(-.2,!1,d,e,f,g,h)?(F(c),7):null},Oa:function(a,c,d,e,f,g,h,m){7<=d&&(c.h[d]=Math.max(0,Math.min(1,Ve(!1,e,f,g,h,m))),G(c))},Pc:function(a){for(var b=0;7>b;b++)if(a.h[b])return null;return new za("No sensor specified",!0)},cd:function(a,c){switch(c){case "b":if(c=a.T.sa(),a.h[7]===c[7]&&a.h[8]===c[8])return c=new C(ta("horiz prox"),null,null),c.h=a.h.slice(0,7),c;default:return a}}}}()),new z(function(){var a=[{H:"r",x:0,y:.4,r:0,v:"2"},{H:"r",x:-.22,y:.35,r:-.45,v:"1"},
{H:"r",x:.22,y:.35,r:.45,v:"3"},{H:"r",x:-.4,y:.22,r:-.8,v:"0"},{H:"r",x:.4,y:.22,r:.8,v:"4"},{H:"r",x:-.2,y:-.4,v:"5"},{H:"r",x:.2,y:-.4,v:"6"}];return{name:"horiz prox 1",xa:["a"],type:"e",sa:function(){return[0,0,0,0,0,0,0,.25]},eb:function(){return[0,1,-1,1,-1,0,0,.25]},ja:new B(cf(a,[0,1,-1]).concat(ef(7,.4,-.05,.6,1.05,.25,.75,3))),L:function(b,c){ze(b);b.buttons(a,c.h,{de:-1});Te(b,c.h[7],-.1,!1,"black",1)},fa:function(b,c,d,e,f,g,h){b=Se(a,d,e,f,g,h);return null!==b?(F(c),c.h[b]=(c.h[b]+2)%
3-1,G(c),b):Ue(-.1,!1,d,e,f,g,h)?(F(c),7):null},Oa:function(a,c,d,e,f,g,h,m){7<=d&&(c.h[d]=Math.max(.25,Math.min(.75,Math.round(4*Ve(!1,e,f,g,h,m))/4)),G(c))},Pc:function(a){for(var b=0;7>b;b++)if(a.h[b])return null;return new za("No sensor specified",!0)},cd:function(a,c){switch(c){case "b":if(c=a.T.sa(),a.h[7]===c[7])return c=new C(ta("horiz prox"),null,null),c.h=a.h.slice(0,7),c;default:return a}}}}()),new z(function(){var a=[{H:"r",x:-.15,y:.35,v:"0"},{H:"r",x:.15,y:.35,v:"1"}];return{name:"ground",
xa:["b"],type:"e",sa:function(){return[0,0]},eb:function(){return[1,-1]},ja:new B(cf(a,[0,1,-1])),L:function(b,c){ze(b,{Fc:!0});b.buttons(a,c.h,{de:-1})},fa:function(b,c,d,e,f,g,h){b=Se(a,d,e,f,g,h);null!==b&&(F(c),c.h[b]=(c.h[b]+2)%3-1,G(c));return b},Pc:function(a){return a.h[0]||a.h[1]?null:new za("No ground sensor specified",!0)},cd:function(a,c){switch(c){case "a":return c=new C(ta("ground adv"),null,null),c.h=a.h.concat(c.h.slice(2)),c;default:return a}}}}()),new z(function(){var a=[{H:"r",
x:-.15,y:.35,v:"0"},{H:"r",x:.15,y:.35,v:"1"}];return{name:"ground adv",xa:["c"],type:"e",sa:function(){return[0,0,.4,.6]},eb:function(){return[1,2,.4,.6]},ja:new B(cf(a,[0,1,2,3]).concat(ef(2,.6,-.05,.8,1.05,.25,.75,3),ef(3,.38,-.05,.58,1.05,.25,.75,3))),L:function(b,c){ze(b,{Fc:!0});b.buttons(a,c.h,{lg:["white","red","#333","#888"],Eg:["#aaa","black","black","black"],de:2});Te(b,c.h[3],.02,!1,"red",2);Te(b,c.h[2],-.2,!1,"black",1)},fa:function(b,c,d,e,f,g,h){b=Se(a,d,e,f,g,h);return null!==b?(F(c),
c.h[b]=(c.h[b]+1)%4,G(c),b):Ue(.02,!1,d,e,f,g,h)?(F(c),3):Ue(-.2,!1,d,e,f,g,h)?(F(c),2):null},Oa:function(a,c,d,e,f,g,h,m){2<=d&&(c.h[d]=Math.max(0,Math.min(1,Ve(!1,e,f,g,h,m))),G(c))},Pc:function(a){return a.h[0]||a.h[1]?null:new za("No ground sensor specified",!0)},cd:function(a,c){switch(c){case "b":if(c=a.T.sa(),a.h[2]===c[2]&&a.h[3]===c[3])return c=new C(ta("ground"),null,null),c.h=a.h.slice(0,2),c;default:return a}}}}()),new z(function(){var a=[{H:"r",x:-.15,y:.35,v:"0"},{H:"r",x:.15,y:.35,
v:"1"}];return{name:"ground 1",xa:["a"],type:"e",sa:function(){return[0,0,.5]},eb:function(){return[1,-1,.5]},ja:new B(cf(a,[0,1,-1]).concat(ef(2,.4,-.05,.6,1.05,.25,.75,3))),L:function(b,c){ze(b,{Fc:!0});b.buttons(a,c.h,{de:-1});Te(b,c.h[2],0,!1,"black",1)},fa:function(b,c,d,e,f,g,h){b=Se(a,d,e,f,g,h);return null!==b?(F(c),c.h[b]=(c.h[b]+2)%3-1,G(c),b):Ue(0,!1,d,e,f,g,h)?(F(c),2):null},Oa:function(a,c,d,e,f,g,h,m){2<=d&&(c.h[d]=Math.max(.25,Math.min(.75,Math.round(4*Ve(!1,e,f,g,h,m))/4)),G(c))},
Pc:function(a){return a.h[0]||a.h[1]?null:new za("No ground sensor specified",!0)},cd:function(a,c){switch(c){case "b":if(c=a.T.sa(),a.h[2]===c[2])return c=new C(ta("ground"),null,null),c.h=a.h.slice(0,2),c;default:return a}}}}()),new z({name:"tap",xa:["b","a"],type:"e",L:function(a){a.O.translate(.05*a.B.m,0);De(a);Ee(a)},cd:function(a,b){switch(b){case "a":return new C(ta("accelerometer"),null,null);default:return a}}}),new z(function(){var a=[{H:"c",x:-.33,y:-.3,r:0},{H:"c",x:0,y:-.3,r:0},{H:"c",
x:.33,y:-.3,r:0}];return{name:"accelerometer",xa:["c"],type:"e",sa:function(){return[0,0]},ja:new B(df(a).concat(new pa(.1,.1,.9,.9,null,function(a){a.h[1]=0===a.h[0]?0:1===a.h[0]?Math.min(a.h[1]+1,6):Math.max(a.h[1]-1,-6)},function(a){a.h[1]=0===a.h[0]?0:1===a.h[0]?Math.max(a.h[1]-1,-6):Math.min(a.h[1]+1,6)}))),L:function(b,c){var d=c.h[0];c=c.h[1];0===d?(b.O.save(),b.O.translate(.08*b.B.m,-.2*b.B.m),De(b),Ee(b),b.O.restore()):Ie(b,2===d,2===d?-c:c);b.buttons(a,[0===d,1===d,2===d])},fa:function(b,
c,d,e,f,g,h){if(0!==c.h[0]&&Je(d,f,g,h))return F(c),1;b=Se(a,d,e,f,g,h);return null!==b?(F(c),c.h[0]=b,G(c),2):null},Oa:function(a,c,d,e,f,g,h,m){1===d&&(a=Ke(e,g,h,m),c.h[1]=2===c.h[0]?-a:a,G(c))},cd:function(a,c){switch(c){case "b":if(0===a.h[0])return new C(ta("tap"),null,null);default:return a}}}}()),new z({name:"roll",xa:["a"],type:"e",sa:function(){return[0]},eb:function(){return[2]},ja:new B([new pa(.1,.1,.9,.9,null,function(a){a.h[0]=(a.h[0]+13)%24-12},function(a){a.h[0]=(a.h[0]+11)%24-12})]),
L:function(a,b){Ie(a,!1,b.h[0])},fa:function(a,b,c,d,e,f,g){return Je(c,e,f,g,!0)?(F(b),1):null},Oa:function(a,b,c,d,e,f,g,h){b.h[0]=Ke(d,f,g,h,!0);G(b)}}),new z({name:"pitch",xa:["a"],type:"e",sa:function(){return[0]},eb:function(){return[2]},ja:new B([new pa(.1,.1,.9,.9,null,function(a){a.h[0]=(a.h[0]+13)%24-12},function(a){a.h[0]=(a.h[0]+11)%24-12})]),L:function(a,b){Ie(a,!0,b.h[0])},fa:function(a,b,c,d,e,f,g){return Je(c,e,f,g,!0)?(F(b),1):null},Oa:function(a,b,c,d,e,f,g,h){b.h[0]=Ke(d,f,g,h,
!0);G(b)}}),new z({name:"yaw",xa:["a"],type:"e",sa:function(){return[0]},eb:function(){return[2]},ja:new B([new pa(.1,.1,.9,.9,null,function(a){a.h[0]=(a.h[0]+13)%24-12},function(a){a.h[0]=(a.h[0]+11)%24-12})]),L:function(a,b){var c=a.O,d=a.B;b=b.h[0]*Math.PI/12;c.save();c.translate(.5*d.m,.5*d.m);c.rotate(b);He(a);c.translate(-d.m/2,-d.m/2);ze(a,{Fc:!0,scale:.45});c.restore()},fa:function(a,b,c,d,e,f,g){return Je(c,e,f,g,!0)?(F(b),1):null},Oa:function(a,b,c,d,e,f,g,h){b.h[0]=Ke(d,f,g,h,!0);G(b)}}),
new z({name:"clap",type:"e",L:function(a){var b=a.O;a=a.B;b.save();b.beginPath();b.arc(.7*a.m,.6*a.m,.15*a.m,0,2*Math.PI);b.fillStyle="white";b.fill();b.beginPath();b.moveTo(.7*a.m,.6*a.m);b.lineTo(.8*a.m,.95*a.m);b.strokeStyle="white";b.lineWidth=.13*a.m;b.stroke();b.lineWidth=1.5*a.va;b.translate(.3*a.m,.3*a.m);b.rotate(.1);for(var c=0;9>c;c++)b.beginPath(),b.moveTo(.07*a.m,0),b.lineTo(.14*a.m,0),b.moveTo(.17*a.m,0),b.lineTo(.22*a.m,0),b.stroke(),b.rotate(Math.PI/4.5);b.restore()}}),new z({name:"init",
xa:["b","a"],type:"e",L:function(a){var b=a.O;a=a.B;var c=.4*a.m;b.save();b.fillStyle="black";b.strokeStyle="black";b.lineWidth=a.va;b.beginPath();b.arc(.3*a.m,.5*a.m,.08*a.m,0,2*Math.PI);b.fill();b.beginPath();b.moveTo(.42*a.m,.5*a.m);b.lineTo(.7*a.m,.5*a.m);b.stroke();c*=.4;b.beginPath();b.moveTo(.8*a.m,.5*a.m);b.lineTo(.8*a.m-c*Math.sqrt(3)/2,.5*a.m+c/2);b.lineTo(.8*a.m-c*Math.sqrt(3)/2,.5*a.m-c/2);b.fill();b.restore()},gh:!0}),new z({name:"timer",xa:["a"],type:"e",L:function(a){Me(a,0,!0,!1)}}),
new z(function(){var a=[{H:"c",x:.3,y:.2},{H:"c",x:.3,y:-.2}];return{name:"clock",xa:[],type:"e",sa:function(){return[10]},ja:new B([af(a[0],function(a){a.h[0]=10}),af(a[1],function(a){a.h[0]=20})]),L:function(b,c){ze(b);var d=b.B.m;Ne(b.O,.1*d,.6*d,.3*d,.15*d,4,{style:10===c.h[0]?"black":"#222",lineWidth:b.B.va});Ne(b.O,.1*d,.6*d,.7*d,.15*d,8,{style:20===c.h[0]?"black":"#222",lineWidth:b.B.va});b.buttons(a,[10===c.h[0],20===c.h[0]])},fa:function(b,c,d,e,f,g,h){b=Se(a,d,e,f,g,h);null!==b&&(F(c),c.h[0]=
0===b?10:20,G(c));return b}}}()),new z(function(){var a=[{H:"t",x:-.25,y:0,r:-Math.PI/2},{H:"t",x:0,y:.25,r:0},{H:"t",x:0,y:-.25,r:Math.PI},{H:"t",x:.25,y:0,r:Math.PI/2},{H:"c",x:0,y:0,r:0}];return{name:"remote control arrows",xa:[],type:"e",sa:function(){return[0]},ja:new B(df(a)),L:function(b,c){var d=b.O,e=b.B;d.save();d.fillStyle="#eee";d.fillRect(.1*e.m,e.va,.8*e.m,e.m-2*e.va);d.restore();c=c.h[0];b.buttons(a,[0==c,1==c,2==c,3==c,4==c])},fa:function(b,c,d,e,f,g,h){b=Se(a,d,e,f,g,h);null!==b&&
(F(c),c.h[0]=b,G(c));return b}}}()),new z({name:"state",xa:["a"],type:"s",sa:function(){return[0,0,0,0]},eb:function(){return[1,0,0,-1]},ja:new B(gf([0,1,-1])),L:function(a,b){ze(a);Qe(a,b.h)},fa:function(a,b,c,d,e,f,g){a=Ze(c,d,e,f,g);null!==a&&(F(b),b.h[a]=(b.h[a]+2)%3-1,G(b));return a},cd:function(a,b){return"b"===b&&0===a.h[0]&&0===a.h[1]&&0===a.h[2]&&0===a.h[3]?null:a}}),new z({name:"state 8",xa:["c"],type:"s",sa:function(){return[0]},ja:new B(hf()),L:function(a,b){ze(a);Re(a,b.h[0])},fa:function(a,
b,c,d,e,f,g){a=$e(c,d,e,f,g);null!==a&&(F(b),b.h[0]=a,G(b));return a}}),new z(function(){var a=[{H:"t",x:-.3,y:.3,r:0},{H:"t",x:-.3,y:-.3,r:Math.PI},{H:"t",x:.1,y:.3,r:0},{H:"t",x:.1,y:-.3,r:Math.PI},{H:"c",x:.35,y:-.3,r:0}];return{name:"counter comparison",xa:["a"],type:"s",sa:function(){return[0,0]},ja:new B([new pa(0,0,1,.4,null,function(a){a.h[0]=Math.min(1,a.h[0]+1)},function(a){a.h[0]=Math.max(-1,a.h[0]-1)}),new pa(0,.4,1,.8,null,function(a){a.h[1]=Math.min(255,a.h[1]+1)},function(a){a.h[1]=
Math.max(0,a.h[1]-1)}),af(a[4],function(a){a.h[1]=0})]),L:function(b,c){b.text(0===c.h[0]?"=":0<c.h[0]?"\u2265":"\u2264",{x:-.3*b.B.m,fillStyle:"black"});b.text(c.h[1].toString(10),{x:.1*b.B.m,fillStyle:"black"});b.buttons(a,[1>c.h[0]?-2:0,-1<c.h[0]?-2:0,255>c.h[1]?-2:0,0<c.h[1]?-2:0,0!==c.h[1]?-2:0])},fa:function(b,c,d,e,f,g,h){b=Se(a,d,e,f,g,h);if(null!==b){F(c);switch(b){case 0:c.h[0]=Math.min(1,c.h[0]+1);break;case 1:c.h[0]=Math.max(-1,c.h[0]-1);break;case 2:c.h[1]=Math.min(255,c.h[1]+1);break;
case 3:c.h[1]=Math.max(0,c.h[1]-1);break;case 4:c.h[1]=0}G(c)}return b}}}()),new z({name:"color state",xa:["c"],type:"s",sa:function(){return[0,0,0]},ja:new B([ef(0,.1,-.05,.3,1.05,0,1,2),ef(1,.4,-.05,.6,1.05,0,1,2),ef(2,.7,-.05,.9,1.05,0,1,2)]),L:function(a,b){ze(a,{lc:b.h});Te(a,b.h[0],.3,!1,"red");Te(a,b.h[1],0,!1,"#0c0");Te(a,b.h[2],-.3,!1,"#08f")},fa:function(a,b,c,d,e,f,g){return Ue(.3,!1,c,d,e,f,g)?(F(b),0):Ue(0,!1,c,d,e,f,g)?(F(b),1):Ue(-.3,!1,c,d,e,f,g)?(F(b),2):null},Oa:function(a,b,c,d,
e,f,g,h){b.h[c]=Math.max(0,Math.min(1,Math.round(Ve(!1,d,e,f,g,h))));G(b)}}),new z(function(){var a=[{H:"r",x:-.15,y:.3,size:1.4,v:"black",fillStyle:"#666",strokeStyle:"white"},{H:"r",x:-.3,y:0,size:1.4,v:"red",fillStyle:"red",strokeStyle:"white"},{H:"r",x:0,y:0,size:1.4,v:"green",fillStyle:"#0c0",strokeStyle:"white"},{H:"r",x:.3,y:0,size:1.4,v:"yellow",fillStyle:"yellow",strokeStyle:"silver"},{H:"r",x:-.3,y:-.3,size:1.4,v:"blue",fillStyle:"blue",strokeStyle:"white"},{H:"r",x:0,y:-.3,size:1.4,v:"magenta",
fillStyle:"magenta",strokeStyle:"white"},{H:"r",x:.3,y:-.3,size:1.4,v:"cyan",fillStyle:"cyan",strokeStyle:"white"},{H:"r",x:.15,y:.3,size:1.4,v:"white",fillStyle:"white",strokeStyle:"silver"}];return{name:"color 8 state",xa:["a"],type:"s",sa:function(){return[0]},ja:new B(df(a)),L:function(b,c){ze(b,{lc:[c.h&1,(c.h&2)/2,(c.h&4)/4]});b.buttons(a,[1>c.h[0]?-2:0,-1<c.h[0]?-2:0])},fa:function(b,c,d,e,f,g,h){b=Se(a,d,e,f,g,h);null!==b&&(F(c),c.h=[b],G(c));return b}}}()),new z({name:"motor state",xa:["c"],
type:"s",sa:function(){return[0,0]},ja:new B([ef(0,-.05,0,1.05,.2,-1,1,3),ef(1,-.05,.8,1.05,1,-1,1,3)]),L:function(a,b){var c=Be(a,2.4*b.h[0],2.4*b.h[1],.19);ze(a,{Fc:!0,scale:.45,rotation:c.jb,$f:[.19*c.x*a.B.m+.13*a.B.m*Math.sin(c.jb),.19*c.y*a.B.m+.13*a.B.m*Math.cos(c.jb)]});a.O.save();a.O.globalAlpha=.2;Be(a,2.4*b.h[0],2.4*b.h[1],.19);a.O.restore();Te(a,.5+.5*b.h[0],-.4,!0,0===b.h[0]?"white":b.h[0]===b.h[1]?"#0c0":b.h[0]===-b.h[1]?"#f70":"#fd0");Te(a,.5+.5*b.h[1],.4,!0,0===b.h[1]?"white":b.h[0]===
b.h[1]?"#0c0":b.h[0]===-b.h[1]?"#f70":"#fd0")},fa:function(a,b,c,d,e,f,g){return Ue(-.4,!0,c,d,e,f,g)?(F(b),0):Ue(.4,!0,c,d,e,f,g)?(F(b),1):Ce(a,c,e,f,.5*b.h[0],.5*b.h[1],g)?(F(b),2):null},Oa:function(a,b,c,d,e,f,g,h){2>c?(a=Ve(!0,d,e,f,g,h),b.h[c]=.25>a?-1:.75<a?1:0):(a=Ve(!0,d,e,f,g,h),a=.25>a?-1:.75<a?1:0,b.h[0]=a,b.h[1]=a);G(b)}}),new z({name:"motor",type:"a",sa:function(){return[0,0]},eb:function(){return[.5,.2]},ja:new B([ef(0,-.05,0,1.05,.2,-1,1,11),ef(1,-.05,.8,1.05,1,-1,1,11)]),L:function(a,
b){var c=Be(a,2.4*b.h[0],2.4*b.h[1],.19);ze(a,{Fc:!0,scale:.45,rotation:c.jb,$f:[.19*c.x*a.B.m+.13*a.B.m*Math.sin(c.jb),.19*c.y*a.B.m+.13*a.B.m*Math.cos(c.jb)]});a.O.save();a.O.globalAlpha=.2;Be(a,2.4*b.h[0],2.4*b.h[1],.19);a.O.restore();Te(a,.5+.5*b.h[0],-.4,!0,0===b.h[0]?"white":b.h[0]===b.h[1]?"#0c0":b.h[0]===-b.h[1]?"#f70":"#fd0");Te(a,.5+.5*b.h[1],.4,!0,0===b.h[1]?"white":b.h[0]===b.h[1]?"#0c0":b.h[0]===-b.h[1]?"#f70":"#fd0")},fa:function(a,b,c,d,e,f,g){return Ue(-.4,!0,c,d,e,f,g)?(F(b),0):Ue(.4,
!0,c,d,e,f,g)?(F(b),1):Ce(a,c,e,f,.5*b.h[0],.5*b.h[1],g)?(F(b),2):null},Oa:function(a,b,c,d,e,f,g,h){2>c?(a=2*Ve(!0,d,e,f,g,h)-1,d=b.h[1-c],.1>Math.abs(a)?a=0:.1>Math.abs(a-d)?a=d:.1>Math.abs(a+d)&&(a=-d),b.h[c]=Math.max(-1,Math.min(1,a))):(a=2*Ve(!0,d,e,f,g,h)-1,a=.1>Math.abs(a)?0:Math.max(-1,Math.min(1,a)),.05>Math.abs(b.h[0]-b.h[1])?(b.h[0]=a,b.h[1]=a):Math.abs(b.h[0])>Math.abs(b.h[1])?(b.h[1]*=a/b.h[0],b.h[0]=a):(b.h[0]*=a/b.h[1],b.h[1]=a));G(b)}}),new z(function(){var a=[{H:"c",x:0,y:0,r:0},
{H:"t",x:0,y:.35,r:0},{H:"t",x:0,y:-.35,r:Math.PI},{H:"t",x:-.3,y:.32,r:-.4},{H:"t",x:.3,y:.32,r:.4},{H:"t",x:-.35,y:.05,r:-Math.PI/2},{H:"t",x:.35,y:.05,r:Math.PI/2}];return{name:"move",xa:["c"],type:"a",sa:function(){return[0]},L:function(b,c){ze(b,{Fc:!0,scale:.45});b.buttons(a,[0===c.h[0]?1:-2,1===c.h[0]?1:-2,2===c.h[0]?1:-2,3===c.h[0]?1:-2,4===c.h[0]?1:-2,5===c.h[0]?1:-2,6===c.h[0]?1:-2])},fa:function(b,c,d,e,f,g,h){b=Se(a,d,e,f,g,h);null!==b&&(F(c),c.h[0]=b,G(c));return b}}}()),new z({name:"nn obstacles",
xa:[],type:"a",sa:function(){return[0,0,0,0]},eb:function(){return[.3,.2,.1,.3]},ja:new B([new pa(0,0,.25,1,null,function(a){a.h[0]=Math.min(1,a.h[0]+.1)},function(a){a.h[0]=Math.max(0,a.h[0]-.1)},function(a,b){console.info(b)}),new pa(.25,0,.5,1,null,function(a){a.h[1]=Math.min(1,a.h[1]+.1)},function(a){a.h[1]=Math.max(0,a.h[1]-.1)},function(a,b){console.info(b)}),new pa(.5,0,.75,1,null,function(a){a.h[2]=Math.min(1,a.h[2]+.1)},function(a){a.h[2]=Math.max(0,a.h[2]-.1)},function(a,b){console.info(b)}),
new pa(.75,0,1,1,null,function(a){a.h[3]=Math.min(1,a.h[3]+.1)},function(a){a.h[3]=Math.max(0,a.h[3]-.1)},function(a,b){console.info(b)})]),L:function(a,b,c,d){c=d?.5:1;var e=a.O,f=a.B;e.save();d&&e.scale(c,c);e.fillStyle="white";e.font=f.fg;e.textAlign="center";e.textBaseline="middle";e.translate(.5*f.m,.5*f.m);e.translate(-.5*f.m,-.5*f.m);d?(e.fillText("\u21d1",.25*f.m,.35*f.m),e.fillText(b.h[0].toFixed(1),.6*f.m,.35*f.m),e.fillText("\u21a7",.25*f.m,.81*f.m),e.fillText(b.h[1].toFixed(1),.6*f.m,
.81*f.m),e.fillText("+",.25*f.m,1.27*f.m),e.fillText(b.h[2].toFixed(1),.6*f.m,1.27*f.m),e.fillText("\u2212",.25*f.m,1.69*f.m),e.fillText(b.h[3].toFixed(1),.6*f.m,1.69*f.m),e.translate(f.m,0),Te(a,b.h[0],.15,!1,"white"),Te(a,b.h[1],-.3,!1,"white"),Te(a,b.h[2],-.75,!1,"white"),Te(a,b.h[3],-1.2,!1,"white")):(e.fillText("\u21d1",.25*f.m,.17*f.m),e.fillText(b.h[0].toFixed(1),.6*f.m,.17*f.m),e.fillText("\u21a7",.25*f.m,.4*f.m),e.fillText(b.h[1].toFixed(1),.6*f.m,.4*f.m),e.fillText("+",.25*f.m,.63*f.m),
e.fillText(b.h[2].toFixed(1),.6*f.m,.63*f.m),e.fillText("\u2212",.25*f.m,.87*f.m),e.fillText(b.h[3].toFixed(1),.6*f.m,.87*f.m));e.restore()},Ae:!0,fa:function(a,b,c,d,e,f,g){return Ue(.35,!1,c/2,d,e+c/2,f,g)?(F(b),0):Ue(.12,!1,c/2,d,e+c/2,f,g)?(F(b),1):Ue(-.12,!1,c/2,d,e+c/2,f,g)?(F(b),2):Ue(-.35,!1,c/2,d,e+c/2,f,g)?(F(b),3):null},Oa:function(a,b,c,d,e,f,g,h){b.h[c]=Math.max(0,Math.min(1,Math.round(20*Ve(!1,d/2,e,f+d/2,g,h))/20));G(b)}}),new z({name:"top color",xa:["a"],type:"a",sa:function(){return[0,
0,0]},ja:new B([ef(0,.1,-.05,.3,1.05,0,1,11),ef(1,.4,-.05,.6,1.05,0,1,11),ef(2,.7,-.05,.9,1.05,0,1,11)]),L:function(a,b){ze(a,{lc:b.h});Te(a,b.h[0],.3,!1,"red");Te(a,b.h[1],0,!1,"#0c0");Te(a,b.h[2],-.3,!1,"#08f")},fa:function(a,b,c,d,e,f,g){return Ue(.3,!1,c,d,e,f,g)?(F(b),0):Ue(0,!1,c,d,e,f,g)?(F(b),1):Ue(-.3,!1,c,d,e,f,g)?(F(b),2):null},Oa:function(a,b,c,d,e,f,g,h){b.h[c]=Math.max(0,Math.min(1,Ve(!1,d,e,f,g,h)));G(b)}}),new z(function(){var a=[{H:"r",x:-.15,y:.3,size:1.4,v:"black",fillStyle:"#666",
strokeStyle:"white"},{H:"r",x:-.3,y:0,size:1.4,v:"red",fillStyle:"red",strokeStyle:"white"},{H:"r",x:0,y:0,size:1.4,v:"green",fillStyle:"#0c0",strokeStyle:"white"},{H:"r",x:.3,y:0,size:1.4,v:"yellow",fillStyle:"yellow",strokeStyle:"silver"},{H:"r",x:-.3,y:-.3,size:1.4,v:"blue",fillStyle:"blue",strokeStyle:"white"},{H:"r",x:0,y:-.3,size:1.4,v:"magenta",fillStyle:"magenta",strokeStyle:"white"},{H:"r",x:.3,y:-.3,size:1.4,v:"cyan",fillStyle:"cyan",strokeStyle:"white"},{H:"r",x:.15,y:.3,size:1.4,v:"white",
fillStyle:"white",strokeStyle:"silver"}];return{name:"top color 8",xa:["b"],type:"a",sa:function(){return[0]},ja:new B(df(a)),L:function(b,c){ze(b,{lc:[c.h&1,(c.h&2)/2,(c.h&4)/4]});b.buttons(a,[1>c.h[0]?-2:0,-1<c.h[0]?-2:0])},fa:function(b,c,d,e,f,g,h){b=Se(a,d,e,f,g,h);null!==b&&(F(c),c.h=[b],G(c));return b}}}()),new z({name:"bottom color",xa:["a"],type:"a",sa:function(){return[0,0,0]},ja:new B([ef(0,.1,-.05,.3,1.05,0,1,11),ef(1,.4,-.05,.6,1.05,0,1,11),ef(2,.7,-.05,.9,1.05,0,1,11)]),L:function(a,
b){ze(a,{Fc:!0,lc:b.h});Te(a,b.h[0],.3,!1,"red");Te(a,b.h[1],0,!1,"#0c0");Te(a,b.h[2],-.3,!1,"#08f")},fa:function(a,b,c,d,e,f,g){return Ue(.3,!1,c,d,e,f,g)?(F(b),0):Ue(0,!1,c,d,e,f,g)?(F(b),1):Ue(-.3,!1,c,d,e,f,g)?(F(b),2):null},Oa:function(a,b,c,d,e,f,g,h){b.h[c]=Math.max(0,Math.min(1,Ve(!1,d,e,f,g,h)));G(b)}}),new z({name:"bottom-left color",xa:["c"],type:"a",sa:function(){return[0,0,0]},ja:new B([ef(0,.1,-.05,.3,1.05,0,1,11),ef(1,.4,-.05,.6,1.05,0,1,11),ef(2,.7,-.05,.9,1.05,0,1,11)]),L:function(a,
b){ze(a,{Fc:!0,lc:b.h,rf:"left"});Te(a,b.h[0],.3,!1,"red");Te(a,b.h[1],0,!1,"#0c0");Te(a,b.h[2],-.3,!1,"#08f")},fa:function(a,b,c,d,e,f,g){return Ue(.3,!1,c,d,e,f,g)?(F(b),0):Ue(0,!1,c,d,e,f,g)?(F(b),1):Ue(-.3,!1,c,d,e,f,g)?(F(b),2):null},Oa:function(a,b,c,d,e,f,g,h){b.h[c]=Math.max(0,Math.min(1,Ve(!1,d,e,f,g,h)));G(b)}}),new z({name:"bottom-right color",xa:["c"],type:"a",sa:function(){return[0,0,0]},ja:new B([ef(0,.1,-.05,.3,1.05,0,1,11),ef(1,.4,-.05,.6,1.05,0,1,11),ef(2,.7,-.05,.9,1.05,0,1,11)]),
L:function(a,b){ze(a,{Fc:!0,lc:b.h,rf:"right"});Te(a,b.h[0],.3,!1,"red");Te(a,b.h[1],0,!1,"#0c0");Te(a,b.h[2],-.3,!1,"#08f")},fa:function(a,b,c,d,e,f,g){return Ue(.3,!1,c,d,e,f,g)?(F(b),0):Ue(0,!1,c,d,e,f,g)?(F(b),1):Ue(-.3,!1,c,d,e,f,g)?(F(b),2):null},Oa:function(a,b,c,d,e,f,g,h){b.h[c]=Math.max(0,Math.min(1,Ve(!1,d,e,f,g,h)));G(b)}}),new z(function(){var a=[{H:"r",x:-.15,y:.3,size:1.4,v:"black",fillStyle:"#666",strokeStyle:"white"},{H:"r",x:-.3,y:0,size:1.4,v:"red",fillStyle:"red",strokeStyle:"white"},
{H:"r",x:0,y:0,size:1.4,v:"green",fillStyle:"#0c0",strokeStyle:"white"},{H:"r",x:.3,y:0,size:1.4,v:"yellow",fillStyle:"yellow",strokeStyle:"silver"},{H:"r",x:-.3,y:-.3,size:1.4,v:"blue",fillStyle:"blue",strokeStyle:"white"},{H:"r",x:0,y:-.3,size:1.4,v:"magenta",fillStyle:"magenta",strokeStyle:"white"},{H:"r",x:.3,y:-.3,size:1.4,v:"cyan",fillStyle:"cyan",strokeStyle:"white"},{H:"r",x:.15,y:.3,size:1.4,v:"white",fillStyle:"white",strokeStyle:"silver"}];return{name:"bottom color 8",xa:["b"],type:"a",
sa:function(){return[0]},ja:new B(df(a)),L:function(b,c){ze(b,{Fc:!0,lc:[c.h&1,(c.h&2)/2,(c.h&4)/4]});b.buttons(a,[1>c.h[0]?-2:0,-1<c.h[0]?-2:0])},fa:function(b,c,d,e,f,g,h){b=Se(a,d,e,f,g,h);null!==b&&(F(c),c.h=[b],G(c));return b}}}()),new z(function(){var a=[{H:"r",x:-.15,y:.3,size:1.4,v:"black",fillStyle:"#666",strokeStyle:"white"},{H:"r",x:-.3,y:0,size:1.4,v:"red",fillStyle:"red",strokeStyle:"white"},{H:"r",x:0,y:0,size:1.4,v:"green",fillStyle:"#0c0",strokeStyle:"white"},{H:"r",x:.3,y:0,size:1.4,
v:"yellow",fillStyle:"yellow",strokeStyle:"silver"},{H:"r",x:-.3,y:-.3,size:1.4,v:"blue",fillStyle:"blue",strokeStyle:"white"},{H:"r",x:0,y:-.3,size:1.4,v:"magenta",fillStyle:"magenta",strokeStyle:"white"},{H:"r",x:.3,y:-.3,size:1.4,v:"cyan",fillStyle:"cyan",strokeStyle:"white"},{H:"r",x:.15,y:.3,size:1.4,v:"white",fillStyle:"white",strokeStyle:"silver"}];return{name:"bottom-left color 8",xa:["c"],type:"a",sa:function(){return[0]},ja:new B(df(a)),L:function(b,c){ze(b,{Fc:!0,lc:[c.h&1,(c.h&2)/2,(c.h&
4)/4],rf:"left"});b.buttons(a,[1>c.h[0]?-2:0,-1<c.h[0]?-2:0])},fa:function(b,c,d,e,f,g,h){b=Se(a,d,e,f,g,h);null!==b&&(F(c),c.h=[b],G(c));return b}}}()),new z(function(){var a=[{H:"r",x:-.15,y:.3,size:1.4,v:"black",fillStyle:"#666",strokeStyle:"white"},{H:"r",x:-.3,y:0,size:1.4,v:"red",fillStyle:"red",strokeStyle:"white"},{H:"r",x:0,y:0,size:1.4,v:"green",fillStyle:"#0c0",strokeStyle:"white"},{H:"r",x:.3,y:0,size:1.4,v:"yellow",fillStyle:"yellow",strokeStyle:"silver"},{H:"r",x:-.3,y:-.3,size:1.4,
v:"blue",fillStyle:"blue",strokeStyle:"white"},{H:"r",x:0,y:-.3,size:1.4,v:"magenta",fillStyle:"magenta",strokeStyle:"white"},{H:"r",x:.3,y:-.3,size:1.4,v:"cyan",fillStyle:"cyan",strokeStyle:"white"},{H:"r",x:.15,y:.3,size:1.4,v:"white",fillStyle:"white",strokeStyle:"silver"}];return{name:"bottom-right color 8",xa:["c"],type:"a",sa:function(){return[0]},ja:new B(df(a)),L:function(b,c){ze(b,{Fc:!0,lc:[c.h&1,(c.h&2)/2,(c.h&4)/4],rf:"right"});b.buttons(a,[1>c.h[0]?-2:0,-1<c.h[0]?-2:0])},fa:function(b,
c,d,e,f,g,h){b=Se(a,d,e,f,g,h);null!==b&&(F(c),c.h=[b],G(c));return b}}}()),new z({name:"notes",type:"a",sa:function(){return[0,1,1,1,2,1,0,1,2,1,4,2]},ja:new B(function(a,b,c,d,e,f){var g=[];for(c=0;c<e;c++)(function(c){g.push(new pa(.1,a+c*(b-a)/e,.9,a+(c+1)*(b-a)/e,function(a){a.h[2*c+1]=bf(a.h[2*c+1],[0,1,2])},function(a){0===a.h[2*c+1]?(a.h[2*c]=0,a.h[2*c+1]=1):a.h[2*c]=Math.min(a.h[2*c]+1,f-1)},function(a){0===a.h[2*c+1]?(a.h[2*c]=0,a.h[2*c+1]=1):a.h[2*c]=Math.max(a.h[2*c]-1,0)},function(a,
b,d){b=f-1-Math.floor(d*f*.9999);0===a.h[2*c+1]?(a.h[2*c]=b,a.h[2*c+1]=1):a.h[2*c]===b?a.h[2*c+1]=bf(a.h[2*c+1],[0,1,2]):a.h[2*c]=b}))})(c);return g}(.1,.9,.9,.1,6,5)),L:function(a,b){b=b.h;var c=a.O,d=a.B;c.save();c.fillStyle="#eee";for(var e=0;5>e;e++)c.fillRect(.1*d.m,d.m*(.1+.16*e),.8*d.m,.16*d.m-d.va);Fe(a,b,.1,.9,.9,.1,5,.14,1);c.restore()},fa:function(a,b,c,d,e,f,g){return(a=We(.1,.9,.9,.1,6,5,c,d,e,f,g))?(F(b),b.h[2*a.index]===a.tone?b.h[2*a.index+1]=(b.h[2*a.index+1]+1)%3:(b.h[2*a.index]=
a.tone,b.h[2*a.index+1]=1),G(b),0):null}}),new z(function(){var a=[{H:"t",x:-.3,y:.3,r:0},{H:"t",x:-.3,y:-.3,r:Math.PI}];return{name:"play",xa:["c"],type:"a",sa:function(){return[0]},ja:new B([new pa(0,0,1,.4,null,function(a){a.h[0]=(a.h[0]+1)%100},function(a){a.h[0]=(a.h[0]+99)%100})]),L:function(b,c){Ge(b,c.h[0]);b.buttons(a,[-2,-2])},fa:function(b,c,d,e,f,g,h){b=Se(a,d,e,f,g,h);if(null!==b){F(c);switch(b){case 0:c.h[0]=(c.h[0]+1)%100;break;case 1:c.h[0]=(c.h[0]+99)%100}G(c)}return b}}}()),new z({name:"play stop",
xa:["c"],type:"a",L:function(a){Ge(a,null)}}),new z({name:"set state",xa:["a"],type:"a",sa:function(){return[0,0,0,0]},eb:function(){return[0,1,-1,0]},ja:new B(gf([0,1,-1])),L:function(a,b){ze(a);Qe(a,b.h)},fa:function(a,b,c,d,e,f,g){a=Ze(c,d,e,f,g);null!==a&&(F(b),b.h[a]=(b.h[a]+2)%3-1,G(b));return a}}),new z({name:"toggle state",xa:["c"],type:"a",sa:function(){return[!1,!1,!1,!1]},eb:function(){return[!0,!1,!1,!1]},ja:new B(gf([!1,!0])),L:function(a,b){ze(a);Qe(a,b.h.map(function(a){return a?2:
0}));Qc(a.O,a.B.m/2,a.B.m/2,.2*a.B.m,-1.4,1.4,{style:"black",lineWidth:a.B.va,td:5*a.B.va});Qc(a.O,a.B.m/2,a.B.m/2,.2*a.B.m,Math.PI-1.4,Math.PI+1.4,{style:"black",lineWidth:a.B.va,td:5*a.B.va})},fa:function(a,b,c,d,e,f,g){a=Ze(c,d,e,f,g);null!==a&&(F(b),b.h[a]=!b.h[a],G(b));return a}}),new z({name:"set state 8",xa:["c"],type:"a",sa:function(){return[0]},ja:new B(hf()),L:function(a,b){ze(a);Re(a,b.h[0])},fa:function(a,b,c,d,e,f,g){a=$e(c,d,e,f,g);null!==a&&(F(b),b.h[0]=a,G(b));return a}}),new z(function(){var a=
[{H:"c",x:-.2,y:0},{H:"c",x:.2,y:0}];return{name:"change state 8",xa:["c"],type:"a",sa:function(){return[1]},ja:new B([af(a[0],function(a){a.h[0]=-1}),af(a[1],function(a){a.h[0]=1})]),L:function(b,c){ze(b);var d=b.O;d.save();for(var e=0;8>e;e++)Pe(b,Math.PI*(.46-.25*e),Math.PI*(.54-.25*e),0);d.restore();Qc(b.O,b.B.m/2,b.B.m/2,.375*b.B.m,-.8,.8,{style:"black",lineWidth:b.B.va,td:5*b.B.va});Qc(b.O,b.B.m/2,b.B.m/2,.375*b.B.m,Math.PI-.8,Math.PI+.8,{$d:!0,style:"black",lineWidth:b.B.va,td:5*b.B.va});b.buttons(a,
[0>c.h[0],0<c.h[0]])},fa:function(b,c,d,e,f,g,h){b=Se(a,d,e,f,g,h);null!==b&&(F(c),c.h[0]=0===b?-1:1,G(c));return b}}}()),new z(function(){var a=[{H:"t",x:0,y:.3,r:0},{H:"t",x:0,y:-.3,r:Math.PI}];return{name:"set counter",xa:["a"],type:"a",sa:function(){return[0]},ja:new B([new pa(.1,.25,.9,.75,null,function(a){a.h[0]=Math.min(1,a.h[0]+1)},function(a){a.h[0]=Math.max(-1,a.h[0]-1)})]),L:function(b,c){b.text(0===c.h[0]?"= 0":0<c.h[0]?"+1":"\u22121");b.buttons(a,[1>c.h[0]?-2:0,-1<c.h[0]?-2:0])},fa:function(b,
c,d,e,f,g,h){b=Se(a,d,e,f,g,h);if(null!==b){F(c);switch(b){case 0:c.h[0]=Math.min(1,c.h[0]+1);break;case 1:c.h[0]=Math.max(-1,c.h[0]-1)}G(c)}return b}}}()),new z({name:"set timer",xa:["a"],type:"a",sa:function(){return[1]},ja:new B([new pa(.13,.14,.93,.96,null,function(a){a.h[0]=Math.min(a.h[0]+.1,4)},function(a){a.h[0]=Math.max(a.h[0]-.1,0)})]),L:function(a,b){Me(a,b.h[0],!1,!1)},fa:function(a,b,c,d,e,f,g){return Xe(c,d,e,f,g)?(F(b),1):null},Oa:function(a,b,c,d,e,f,g,h){b.h[0]=Ye(d,e,f,g,!1,h);G(b)}}),
new z({name:"set timer log",xa:["c"],type:"a",sa:function(){return[1]},ja:new B([new pa(.13,.14,.93,.96,null,function(a){a.h[0]=Math.round(100*Math.min(1.05*a.h[0],10))/100},function(a){a.h[0]=Math.round(100*Math.max(.95*a.h[0],.1))/100})]),L:function(a,b){Me(a,b.h[0],!1,!0)},fa:function(a,b,c,d,e,f,g){return Xe(c,d,e,f,g)?(F(b),1):null},Oa:function(a,b,c,d,e,f,g,h){b.h[0]=Ye(d,e,f,g,!0,h);G(b)}}),new z(function(){function a(a,b){if(a.h[1]){var c=new Image;c.src=a.h[1];c.addEventListener("load",function(){a.h[2]=
c;b&&b()},!1)}}var b=[{H:"c",x:-.33,y:-.3,r:0}];return{name:"picture comment",xa:["a"],type:"c",sa:function(){return[!1,"",null]},Kf:function(a){return 2<=a.h.length?[!1,a.h[1]]:[!1,""]},Ie:function(b,d,e){b.h=2<=d.length?[!1,d[1]]:[!1,""];a(b,e)},L:function(a,d){d.h[2]&&a.O.drawImage(d.h[2],0,0,240,240,0,0,a.B.m,a.B.m);a.buttons(b,[d.h[0]])},fa:function(c,d,e,f,g,h,m){e=Se(b,e,f,g,h,m);0===e&&(d.h[0]?aa&&(aa.pause&&aa.pause(),ba.getTracks().forEach(function(a){a.stop()}),aa=null):(F(d),navigator.mediaDevices.getUserMedia({audio:!1,
video:{width:320,height:240}}).then(function(b){ba=b;aa=document.createElement("video");aa.srcObject=b;aa.addEventListener("loadedmetadata",function(){aa.play();var b=setInterval(function(){aa?(ca||(ca=document.createElement("canvas"),ca.width=240,ca.height=240),ca.getContext("2d").drawImage(aa,0,0,240,240,0,0,240,240),d.h[1]=ca.toDataURL("image/png"),a(d,function(){c.ta&&c.ta();J(c)})):clearInterval(b)},100)},!1)})),d.h[0]=!d.h[0],G(d));return e}}}())];function jf(a,b){function c(a){return a instanceof Array?a.join(""):a}function d(a,b,c){return a.map(function(a){return na(a,b,c)})}var e=b||{};["aseba","l2","js","python"].forEach(function(b){a[b]&&(e[b]=function(e,f){var g=e?e.h:[],h={xh:f?f.sf:1,J:0};e={};a[b].initVarDecl&&(e.kc=d(a[b].initVarDecl.map(c),g,h));a[b].initCodeDecl&&(e.jc=d(a[b].initCodeDecl.map(c),g,h));a[b].initCodeExec&&(e.zc=d(a[b].initCodeExec.map(c),g,h));a[b].sectionBegin&&(e.ca=na(c(a[b].sectionBegin),g,h));a[b].sectionEnd&&
(e.ub=na(c(a[b].sectionEnd),g,h));a[b].sectionPreamble&&(e.cb=na(c(a[b].sectionPreamble),g,h));a[b].clauseInit&&(e.ma=na(c(a[b].clauseInit),g,h));if(a[b].clauseAnd){var p="";g.forEach(function(d,e){h.J=e;(d=na(c(a[b].clauseAnd),g,h))&&(p+=(0<p.length?" "+qa[b].i+" ":"")+d)});e.bb=p||qa[b].l}else a[b].clause&&(e.bb=na(c(a[b].clause),g,h));a[b].clauseAsCondition&&(e.Ug=na(c(a[b].clauseAsCondition),g,h));e.hi=a[b].clauseOptional||!1;a[b].statement1?e.ya=g.map(function(d,e){h.J=e;return na(c(a[b].statement1),
g,h)}).join(""):a[b].statement&&(e.ya=na(c(a[b].statement),g,h));a[b].error&&(e.bb=na(c(a.error.error),g,h));return e})});return e};function kf(a){this.S=new DOMParser;this.b=this.S.parseFromString(a,"text/xml");this.i=this.b.documentElement;this.C=(this.i.getAttribute("viewBox")||"0 0 1 1").split(" ").map(function(a){return parseFloat(a)});this.w={}}
var lf={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgreen:"#006400",
darkgrey:"#A9A9A9",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",
ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",green:"#008000",greenyellow:"#ADFF2F",grey:"#808080",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgreen:"#90EE90",lightgrey:"#D3D3D3",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",
lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",
moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",
seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"};function mf(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}function nf(a){var b={};mf(b,a);return b}
function of(a,b){b.split(";").forEach(function(b){b=b.trim().split(":").map(function(a){return a.trim()});2===b.length&&(a[b[0]]=b[1])})}
function pf(a,b,c,d,e){a&&(a=a.replace(/\s*\(\s*/g,"(").replace(/\s*\)\s*/g,")").replace(/ +,/g,",").replace(/, +/g,",").replace(/ +/g,","),a.split(")").slice(0,-1).forEach(function(a){var f=a.split("(")[0];a=a.split("(")[1].split(",").map(function(a){return parseFloat(a)});switch(f){case "translate":b(a[0]||0,a[1]||0);break;case "rotate":f=(a[0]||0)*Math.PI/180;var h=a[1]||0;a=a[2]||0;0!==h||0!==a?(b(-h,-a),c(f),b(h,a)):c(f);break;case "scale":f=a[0]||1;d(f,a[1]||f);break;case "matrix":e(a[0],a[1],
a[2],a[3],a[4],a[5]);break;default:throw"transform not implemented: "+f;}}))}function qf(a,b){pf(a,function(a,d){b.translate(a,d)},function(a){b.rotate(a)},function(a,d){b.scale(a,d)},function(a,d,e,f,g,h){b.nf(a,d,e,f,g,h)})}
kf.prototype.L=function(a,b){function c(e,k,l){function r(){for(var a=0;a<e.childElementCount;a++)c(e.children[a],k,l)}function u(a,b){a=e.getAttribute(a);return null===a?b||0:parseFloat(a)}function v(a,b){a=n.apply(new rf(a,b));t.push(a.x);q.push(a.y)}function w(a,b,c){if(null==a||""==a)return b;a=/^\s*(-?[0-9.]+)\s*([a-z%]*)\s*$/i.exec(a);b=parseFloat(a[1]);switch(a[2]||"px"){case "pt":return 25.4*b/72*3;case "pc":return 25.4*b/6*3;case "in":return 25.4*b*3;case "mm":return 3*b;case "cm":return 30*
b;case "em":return 18*b;case "ex":return 9*b;case "%":return b*c/100;default:return b}}function E(c){c=c.replace(/\.([0-9]+)(?=\.)/g,".$1 ").replace(/([.0-9])-/g,"$1 -").replace(/\s*([a-z])\s*/gi,";$1").replace(/\s*,\s*/g,",").replace(/\s+/g,",");var e=0,f=0,g=0,h=0,k=0,l=0,m=[],n=[],r=!0;a&&a.beginPath();c.slice(1).split(";").forEach(function(c){var x=c[0];c=1<c.length?c.slice(1).split(",").map(function(a){return parseFloat(a)}):[];switch(x){case "M":if(2<=c.length){e=c[0];f=c[1];k=e;l=f;a&&a.moveTo(e,
f);v(e,f);r&&1<m.length&&b&&b.Ea&&b.Ea.line&&b.Ea.line(m,n,!1);r=!0;m=t.slice(-1);n=q.slice(-1);for(x=2;x+1<c.length;x+=2)e=c[x],f=c[x+1],a&&a.lineTo(e,f),v(e,f),m.push(t[t.length-1]),n.push(q[q.length-1]);g=e;h=f}break;case "m":if(2<=c.length)for(e+=c[0],f+=c[1],k=e,l=f,a&&a.moveTo(e,f),v(e,f),r&&1<m.length&&b&&b.Ea&&b.Ea.line&&b.Ea.line(m,n,!1),r=!0,m=t.slice(-1),n=q.slice(-1),x=2;x+1<c.length;x+=2)e+=c[x],f+=c[x+1],a&&a.lineTo(e,f),v(e,f),m.push(t[t.length-1]),n.push(q[q.length-1]);g=e;h=f;break;
case "L":for(x=0;x+1<c.length;x+=2)e=c[x],f=c[x+1],a&&a.lineTo(e,f),v(e,f),m.push(t[t.length-1]),n.push(q[q.length-1]);g=e;h=f;break;case "l":for(x=0;x+1<c.length;x+=2)e+=c[x],f+=c[x+1],a&&a.lineTo(e,f),v(e,f),m.push(t[t.length-1]),n.push(q[q.length-1]);g=e;h=f;break;case "H":for(x=0;x<c.length;x++)e=c[x],a&&a.lineTo(e,f),v(e,f),m.push(t[t.length-1]),n.push(q[q.length-1]);g=e;h=f;break;case "h":for(x=0;x<c.length;x++)e+=c[x],a&&a.lineTo(e,f),v(e,f),m.push(t[t.length-1]),n.push(q[q.length-1]);g=e;
h=f;break;case "V":for(x=0;x<c.length;x++)f=c[x],a&&a.lineTo(e,f),v(e,f),m.push(t[t.length-1]),n.push(q[q.length-1]);g=e;h=f;break;case "v":for(x=0;x<c.length;x++)f+=c[x],a&&a.lineTo(e,f),v(e,f),m.push(t[t.length-1]),n.push(q[q.length-1]);g=e;h=f;break;case "A":for(x=0;x+6<c.length;x+=7){var u=c[x+5],p=c[x+6],w=d(c[x],c[x+1],c[x+2]*Math.PI/180,0!=c[x+3],0==c[x+4],e,f,u,p);e=u;f=p;v(w.x,w.y);v(e,f);r=!1}g=e;h=f;break;case "a":for(x=0;x+6<c.length;x+=7)u=e+c[x+5],p=f+c[x+6],w=d(c[x],c[x+1],c[x+2]*Math.PI/
180,0!=c[x+3],0==c[x+4],e,f,u,p),e=u,f=p,v(w.x,w.y),v(e,f),r=!1;g=e;h=f;break;case "C":for(x=0;x+5<c.length;x+=6)a&&a.bezierCurveTo(c[x],c[x+1],c[x+2],c[x+3],c[x+4],c[x+5]),e=c[x+4],f=c[x+5],g=2*e-c[x+2],h=2*f-c[x+3],v(e,f),r=!1;break;case "c":for(x=0;x+5<c.length;x+=6)a&&a.bezierCurveTo(e+c[x],f+c[x+1],e+c[x+2],f+c[x+3],e+c[x+4],f+c[x+5]),g=e+2*c[x+4]-c[x+2],h=f+2*c[x+5]-c[x+3],e+=c[x+4],f+=c[x+5],v(e,f),r=!1;break;case "S":for(x=0;x+3<c.length;x+=4)a&&a.bezierCurveTo(g,h,c[x],c[x+1],c[x+2],c[x+
3]),e=c[x+2],f=c[x+3],g=2*e-c[x],h=2*f-c[x+1],v(e,f),r=!1;break;case "s":for(x=0;x+3<c.length;x+=4)a&&a.bezierCurveTo(g,h,e+c[x],f+c[x+1],e+c[x+2],f+c[x+3]),g=e-c[x],h=f-c[x+1],e+=c[x+2],f+=c[x+3],v(e,f),r=!1;break;case "Q":for(x=0;x+3<c.length;x+=4)a&&a.quadraticCurveTo(c[x],c[x+1],c[x+2],c[x+3]),e=c[x+2],f=c[x+3],g=2*e-c[x],h=2*f-c[x+1],v(e,f),r=!1;break;case "q":for(x=0;x+3<c.length;x+=4)a&&a.quadraticCurveTo(e+c[x],f+c[x+1],e+c[x+2],f+c[x+3]),g=e+2*c[x+2]-c[x],h=f+2*c[x+3]-c[x+1],e+=c[x+2],f+=
c[x+3],v(e,f),r=!1;break;case "T":for(x=0;x+1<c.length;x+=2)a&&a.quadraticCurveTo(g,h,c[x],c[x+1]),e=c[x],f=c[x+1],g=2*e-g,h=2*f-h,v(e,f),r=!1;break;case "t":for(x=0;x+1<c.length;x+=2)a&&a.quadraticCurveTo(g,h,e+c[x],f+c[x+1]),e+=c[x],f+=c[x+1],g=2*e-g,h=2*f-h,v(e,f),r=!1;break;case "Z":case "z":e=k;f=l;a&&a.closePath();r&&1<m.length&&b&&b.Ea&&b.Ea.line&&b.Ea.line(m,n,!0);r=!0;m=[];n=[];break;default:throw"unimplemented path command: "+x;}});r&&1<m.length&&b&&b.Ea&&b.Ea.line&&b.Ea.line(m,n,!1)}function D(b){function c(a,
b){if(0<b.length){a.splice(0,a.length);for(var c=0;c<b.length&&1>c;c++){var d=(b[c].getAttribute("offset")||"0").trim(),e=/%$/.test(d)?parseFloat(d.slice(0,-1))/100:parseFloat(d),f=b[c].getAttribute("style");d={};f&&of(d,f);isNaN(e)||(f=b[c].getAttribute("stop-color")||d["stop-color"]||"#000",lf.hasOwnProperty(f)&&(f=lf[f]),d=(b[c].getAttribute("stop-opacity")||d["stop-opacity"]||"1").trim(),d=/%$/.test(d)?parseFloat(d.slice(0,-1))/100:parseFloat(d),1!==d&&(/^#[0-9a-f]{3}$/i.test(f)?f="rgba("+f.slice(1).split("").map(function(a){return 17*
parseInt(a,16)}).map(function(a){return a.toString(10)}).join(",")+","+d.toFixed(2)+")":/^#[0-9a-f]{6}$/i.test(f)?f="rgba("+[f.slice(1,3),f.slice(3,5),f.slice(5)].map(function(a){return parseInt(a,16)}).map(function(a){return a.toString(10)}).join(",")+","+d.toFixed(2)+")":/^rgb(\d+%?(,|\s+)\d+%?(,|\s+)\d+%?)$/i.test(f)?f=f.slice(0,-1).replace(/\s+/g,",")+","+d.toFixed(2)+")":/^hsl(\d+%?(,|\s+)\d+%?(,|\s+)\d+%?)$/i.test(f)&&(f=f.slice(0,-1).replace(/\s+/g,",")+","+d.toFixed(2)+")")),a.push({offset:e,
color:f}))}}}function d(a,b){if(a.attributes["xlink:href"]){var e=a.getAttribute("xlink:href");"#"===e[0]&&(e=m.b.getElementById(e.slice(1)))&&(b=d(e,b))}b.Hd=a.attributes.x1?parseFloat(a.getAttribute("x1")):b.Hd||0;b.Jd=a.attributes.y1?parseFloat(a.getAttribute("y1")):b.Jd||0;b.Id=a.attributes.x2?parseFloat(a.getAttribute("x2")):b.Id||0;b.Kd=a.attributes.y2?parseFloat(a.getAttribute("y2")):b.Kd||0;b.Xc=a.attributes.gradientUnits?a.getAttribute("gradientUnits"):b.Xc||"objectBoundingBox";b.ic=a.attributes.gradientTransform?
a.getAttribute("gradientTransform"):b.ic||"";b.rb=b.rb||[];c(b.rb,a.getElementsByTagName("stop"));return b}function e(a,b){if(a.attributes["xlink:href"]){var d=a.getAttribute("xlink:href");"#"===d[0]&&(d=m.b.getElementById(d.slice(1)))&&(b=e(d,b))}b.Tc=a.attributes.cx?parseFloat(a.getAttribute("cx")):b.Tc||0;b.Uc=a.attributes.cy?parseFloat(a.getAttribute("cy")):b.Uc||0;b.r=a.attributes.r?parseFloat(a.getAttribute("r")):b.r||0;b.Xc=a.attributes.gradientUnits?a.getAttribute("gradientUnits"):b.Xc||"objectBoundingBox";
b.ic=a.attributes.gradientTransform?a.getAttribute("gradientTransform"):b.ic||"";b.rb=b.rb||[];c(b.rb,a.getElementsByTagName("stop"));return b}var f=/^url\(#(.+)\)$/.exec(b);if(f&&f[1]&&(f=m.b.getElementById(f[1])))switch(f.tagName){case "linearGradient":b=d(f,{});if("objectBoundingBox"===b.Xc)throw"objectBoundingBox not supported";if(b.ic)throw f=new sf,qf(b.ic,f),"gradientTransform not supported";var g=a.createLinearGradient(b.Hd,b.Jd,b.Id,b.Kd);for(f=0;f<b.rb.length;f++)g.addColorStop(b.rb[f].offset,
b.rb[f].color);return g;case "radialGradient":b=e(f,{});if("objectBoundingBox"===b.Xc)throw"objectBoundingBox not supported";b.ic&&(f=new sf,qf(b.ic,f),g=tf(f,{x:b.Tc,y:b.Uc}),f=b.r/Math.sqrt(Math.abs(f.b[0]*f.b[4])),b.Tc=g.x,b.Uc=g.y,b.r=f);g=a.createRadialGradient(b.Tc,b.Uc,0,b.Tc,b.Uc,b.r);for(f=0;f<b.rb.length;f++)g.addColorStop(b.rb[f].offset,b.rb[f].color);return g}return b}function T(b,c,d,e,f,g){0>=f||0>=g?a.rect(b,c,d,e):(f=Math.min((f+g)/2,Math.min(d,e)/2),a.moveTo(b+d-f,c),a.arc(b+d-f,
c+f,f,1.5*Math.PI,2*Math.PI),a.lineTo(b+d,c+e-f),a.arc(b+d-f,c+e-f,f,0,.5*Math.PI),a.lineTo(b+f,c+e),a.arc(b+f,c+e-f,f,.5*Math.PI,Math.PI),a.lineTo(b,c+f),a.arc(b+f,c+f,f,Math.PI,1.5*Math.PI),a.closePath())}function O(){if(a){var b=(k||"")+";"+(l||""),c={};b&&of(c,b);"hidden"!==c.visibility&&(c.opacity&&(a.globalAlpha*=parseFloat(c.opacity)),c.fill&&"none"===c.fill||(a.fillStyle="white"===c.fill||"#fff"===c.fill||"#ffffff"===c.fill?"white":D(c.fill)||"none",a.fill()),c.stroke&&"none"!==c.stroke&&
(a.lineWidth=w(c["stroke-width"]||"1px",1,100),a.strokeStyle=c.stroke||"none",a.miterLimit=c["stroke-miterlimit"]||4,a.lineJoin=c["stroke-linejoin"]||"miter",a.lineCap=c["stroke-linecap"]||"butt",c["stroke-dasharray"]&&(a.setLineDash(c["stroke-dasharray"].split(" ").map(function(a){return parseFloat(a)})),a.lineDashOffset=c["stroke-dashoffset"]?parseFloat(c["stroke-dashoffset"]):0),a.stroke()))}}function ya(c,d,e){if(a){var f=(k||"")+";"+(l||""),g={};f&&of(g,f);"hidden"!==g.visibility&&(a.font=(g["font-size"]||
"12px")+" "+(g["font-family"]||"helvetica"),g.fill&&"none"!==g.fill&&(a.fillStyle="white"===g.fill||"#fff"===g.fill||"#ffffff"===g.fill?"white":b&&b.fill||"silver",a.fillText(c,d,e)),g.stroke&&"none"!==g.stroke&&(a.strokeStyle=b&&b.stroke||"black",a.strokeText(c,d,e)))}}function Oa(b,c){b=uf({x:b,y:c});a.save();a.strokeStyle="black";a.lineWidth=1;a.strokeRect(b.Z,b.ba,b.oa-b.Z,b.pa-b.ba);a.restore()}var A=e.getAttribute("id"),U=A&&b&&b.Qd&&b.Qd[A];A=A&&b&&b.Df&&b.Df[A];a&&a.save();n.save();U&&a&&
f(e,U);A&&a&&g(e,A);(function(){var a=(b&&b.Xg||"")+";"+(e.getAttribute("style")||""),c=e.getAttribute("class");c&&p.hasOwnProperty(c)&&(a=p[c]+";"+a);k=(k||"")+";"+a;(a=e.getAttribute("fill"))&&(k+=";fill:"+a);(a=e.getAttribute("stroke"))&&(k+=";stroke:"+a);(a=e.getAttribute("stroke-width"))&&(k+="stroke-width:"+a);(a=e.getAttribute("stroke-dasharray"))&&(k+=";stroke-dasharray:"+a.split(",").join(" "));(a=e.getAttribute("stroke-dashoffset"))&&(k+=";stroke-dashoffset:"+a);if(b&&b.style)if((a=e.getAttribute("id"))&&
b.style.hasOwnProperty(a))l=(l||"")+";"+b.style[a];else for(var d in b.style)b.style.hasOwnProperty(d)&&"!"===d[0]&&d.slice(1)!==a&&(l=(l||"")+";"+b.style[d])})();U=t.length;switch(e.tagName){case "svg":n.save();h(e.getAttribute("transform"));r();n.restore();break;case "g":n.save();h(e.getAttribute("transform"));r();n.restore();break;case "path":a&&a.save();n.save();h(e.getAttribute("transform"));E(e.getAttribute("d")||"");O();a&&a.restore();n.restore();break;case "line":A=u("x1");var N=u("y1"),K=
u("x2"),Ma=u("y2");a&&a.save();n.save();h(e.getAttribute("transform"));a&&a.beginPath();a&&a.moveTo(A,N);a&&a.lineTo(K,Ma);O();v(A,N);v(K,Ma);b&&b.Ea&&b.Ea.line&&b.Ea.line([A,K],[N,Ma],!1);a&&a.restore();n.restore();break;case "polygon":case "polyline":A=e.getAttribute("points").trim().replace(/\s+/g," ").split(" ").map(function(a){return parseFloat(a)});if(4<=A.length){a&&a.save();n.save();h(e.getAttribute("transform"));a&&a.beginPath();a&&a.moveTo(A[0],A[1]);v(A[0],A[1]);for(N=2;N+1<A.length;N+=
2)a&&a.lineTo(A[N],A[N+1]),v(A[N],A[N+1]);"polygon"===e.tagName&&a.closePath();O();b&&b.Ea&&b.Ea.line&&b.Ea.line(t.slice(-A.length/2),q.slice(-A.length/2),"polygon"===e.tagName);a&&a.restore();n.restore()}break;case "circle":A=u("cx");N=u("cy");K=u("r");a&&a.save();n.save();h(e.getAttribute("transform"));a&&a.beginPath();a&&a.arc(A,N,K,0,2*Math.PI);O();v(A-K,N-K);v(A-K,N+K);v(A+K,N-K);v(A+K,N+K);b&&b.Ea&&b.Ea.Cf&&(A=t.slice(-4),N=q.slice(-4),K=(A[3]-A[0])*(A[3]-A[0])+(N[3]-N[0])*(N[3]-N[0]),Ma=(A[2]-
A[1])*(A[2]-A[1])+(N[2]-N[1])*(N[2]-N[1]),.001>Math.abs(K-Ma)/(K+Ma)&&.001>((A[3]-A[0])*(A[2]-A[1])+(N[3]-N[0])*(N[2]-N[1]))/K&&b.Ea.Cf((A[0]+A[2])/2,(N[0]+N[2])/2,Math.sqrt(K/8)));a&&a.restore();n.restore();break;case "rect":A=u("x");N=u("y");K=u("width");Ma=u("height");var x=u("rx"),Ha=u("ry",x);x=u("rx",Ha);a&&a.save();n.save();h(e.getAttribute("transform"));a&&(a.beginPath(),0<x||0<Ha?T(A,N,K,Ma,x,Ha):a.rect(A,N,K,Ma));O();v(A,N);v(A,N+Ma);v(A+K,N);v(A+K,N+Ma);a&&a.restore();n.restore();break;
case "text":A=u("x"),N=u("y"),a&&a.save(),n.save(),h(e.getAttribute("transform")),ya(e.textContent,A,N),v(A,N),a&&a.restore(),n.restore()}a&&a.restore();n.restore();a&&b&&b.Wg&&Oa(t.slice(U),q.slice(U))}function d(b,c,d,e,f,g,h,k,l){if(0===b||0===c)return a&&a.lineTo(k,l),new rf(k,l);var m=Math.cos(d),n=Math.sin(d),r=(m*g+n*h)/b;h=(-n*g+m*h)/c;g=(m*k+n*l)/b;k=(-n*k+m*l)/c;l=(g-r)/2;m=(k-h)/2;n=l*l+m*m;n=Math.sqrt((1-n)/n);isNaN(n)?n=0:e===f&&(n=-n);e=(r+g)/2+n*m;l=(h+k)/2-n*l;r=Math.atan2((h-l)/b,
(r-e)/c);h=Math.atan2((k-l)/b,(g-e)/c);a&&(a.rotate(d),a.scale(b,c),f?a.arc(e,l,1,r,h,!0):a.arc(e,l,1,r,h),a.scale(1/b,1/c),a.rotate(-d));g=new sf;g.rotate(d);g.scale(b,c);b=f?r<h?(r+h)/2+Math.PI:(r+h)/2:r<h?(r+h)/2:(r+h)/2+Math.PI;return g.apply(new rf(e+Math.cos(b),l+Math.sin(b)))}function e(a){switch(a.tagName){case "svg":case "defs":for(var b=0;b<a.childElementCount;b++)e(a.children[b]);break;case "style":k+=a.textContent}}function f(b,c){if(c.jb&&0!=c.jb){var d=c.xe,e=c.ye;if(void 0==d||void 0==
e)d=m.L(null,{element:b}),b=uf(d),d=(b.Z+b.oa)/2,e=(b.ba+b.pa)/2;a.translate(d+(c.Gb||0),e+(c.Hb||0));a.rotate(c.jb);a.translate(-d,-e)}else(c.Gb||c.Hb)&&a.translate(c.Gb,c.Hb)}function g(b,c){a.beginPath();a.rect(c.x,c.y,c.qc,c.ed);a.clip()}function h(b){pf(b,function(b,c){a&&a.translate(b,c);n.translate(b,c)},function(b){a&&a.rotate(b);n.rotate(b)},function(b,c){a&&a.scale(b,c);n.scale(b,c)},function(b,c,d,e,f,g){a&&a.transform(b,c,d,e,f,g);n.nf(b,c,d,e,f,g)})}var m=this,k="",p={},n=new vf,t=[],
q=[];e(this.i);(function(){k.split("}").forEach(function(a){var b=a.split("{");b[0].split(",").forEach(function(a){a=a.trim();/^\.[-a-z0-9]+/i.test(a)&&(a=a.slice(1),p[a]=p[a]?p[a]+";"+b[1]:b[1])})})})();var l=this.i;b&&b.he?l=this.b.getElementById(b.he):b&&b.element&&(l=b.element);if(l){b&&b.Of&&b.Of(a,this.C);if(a){for(var v=[],r=l.parentElement;null!=r;r=r.parentElement)v.push(r);for(r=v.length-1;0<=r;r--){var E=v[r].getAttribute("id");(E=E&&b&&b.Qd&&b.Qd[E])&&f(v[r],E);E=v[r].getAttribute("transform");
h(E)}}c(l)}return{x:t,y:q}};function uf(a){if(0===a.x.length)return{Z:0,oa:0,ba:0,pa:0};for(var b=a.x[0],c=a.x[0],d=a.y[0],e=a.y[0],f=1;f<a.x.length;f++)b=Math.min(b,a.x[f]),c=Math.max(c,a.x[f]),d=Math.min(d,a.y[f]),e=Math.max(e,a.y[f]);return{Z:b,oa:c,ba:d,pa:e}}function wf(a,b){if(a.w[b])return a.w[b];var c=a.L(null,{he:b});c=uf(c);return a.w[b]=c}kf.prototype.Sd=function(a,b,c){a=wf(this,a);return b>=a.Z&&b<=a.oa&&c>=a.ba&&c<=a.pa};kf.prototype.Jc=function(a){return null!=this.b.getElementById(a)};
kf.prototype.qg=function(a,b){a=this.b.getElementById(a);b=this.b.getElementById(b);return null!=b&&null!=a&&b.contains(a)};function xf(a){kf.call(this,a);this.l={};this.G={};this.u={};yf(this)}xf.prototype=Object.create(kf.prototype);xf.prototype.constructor=xf;
function yf(a){function b(a){switch(a.tagName){case "svg":case "defs":for(var c=0;c<a.childElementCount;c++)b(a.children[c]);break;case "style":f+=a.textContent}}function c(a){return a?(a=a.replace(/\s*\(\s*/g,"(").replace(/\s*\)\s*/g,")").replace(/ +,/g,",").replace(/, +/g,",").replace(/ +/g,","),a.split(")").slice(0,-1).map(function(a){var b=a.split("(")[0];a=a.split("(")[1].split(",").map(function(a){return parseFloat(a)});switch(b){case "translate":return{ib:b,D:[a[0]||0,a[1]||0]};case "rotate":return{ib:b,
D:[(a[0]||0)*Math.PI/180,a[1]||0,a[2]||0]};case "scale":var c=a[0]||1;return{ib:b,D:[c,a[1]||c]};case "matrix":return{ib:b,D:a};default:throw"transform not implemented: "+b;}})):null}function d(a,b){function f(b){for(var c=[],e=0;e<a.childElementCount;e++){var f=d(a.children[e],b);f&&c.push(f)}return c}function g(b,c){b=a.getAttribute(b);return null===b?c||0:parseFloat(b)}function h(a){a=a.replace(/\.([0-9]+)(?=\.)/g,".$1 ").replace(/([.0-9])-/g,"$1 -").replace(/\s*([a-z])\s*/gi,";$1").replace(/\s*,\s*/g,
",").replace(/\s+/g,",");var b=[],c=0,d=0,e=0,f=0,g=0,h=0;a.slice(1).split(";").forEach(function(a){var k=a[0];a=1<a.length?a.slice(1).split(",").map(function(a){return parseFloat(a)}):[];switch(k){case "M":if(2<=a.length){c=a[0];d=a[1];g=c;h=d;b.push({ib:"M",D:[c,d]});for(k=2;k+1<a.length;k+=2)c=a[k],d=a[k+1],b.push({ib:"L",D:[c,d]});e=c;f=d}break;case "m":if(2<=a.length)for(c+=a[0],d+=a[1],g=c,h=d,b.push({ib:"M",D:[c,d]}),k=2;k+1<a.length;k+=2)c+=a[k],d+=a[k+1],b.push({ib:"L",D:[c,d]});e=c;f=d;
break;case "L":for(k=0;k+1<a.length;k+=2)c=a[k],d=a[k+1],b.push({ib:"L",D:[c,d]});e=c;f=d;break;case "l":for(k=0;k+1<a.length;k+=2)c+=a[k],d+=a[k+1],b.push({ib:"L",D:[c,d]});e=c;f=d;break;case "H":for(k=0;k<a.length;k++)c=a[k],b.push({ib:"L",D:[c,d]});e=c;f=d;break;case "h":for(k=0;k<a.length;k++)c+=a[k],b.push({ib:"L",D:[c,d]});e=c;f=d;break;case "V":for(k=0;k<a.length;k++)d=a[k],b.push({ib:"L",D:[c,d]});e=c;f=d;break;case "v":for(k=0;k<a.length;k++)d+=a[k],b.push({ib:"L",D:[c,d]});e=c;f=d;break;
case "A":for(k=0;k+6<a.length;k+=7){var l=a[k+5],m=a[k+6];b.push({ib:"A",D:[a[k],a[k+1],a[k+2]*Math.PI/180,0!=a[k+3]?1:0,0==a[k+4]?1:0,c,d,l,m]});c=l;d=m}e=c;f=d;break;case "a":for(k=0;k+6<a.length;k+=7)l=c+a[k+5],m=d+a[k+6],b.push({ib:"A",D:[a[k],a[k+1],a[k+2]*Math.PI/180,0!=a[k+3],0==a[k+4],c,d,l,m]}),c=l,d=m;e=c;f=d;break;case "C":for(k=0;k+5<a.length;k+=6)b.push({ib:"C",D:a.slice(k,k+6)}),c=a[k+4],d=a[k+5],e=2*c-a[k+2],f=2*d-a[k+3];break;case "c":for(k=0;k+5<a.length;k+=6)b.push({ib:"C",D:[c+
a[k],d+a[k+1],c+a[k+2],d+a[k+3],c+a[k+4],d+a[k+5]]}),e=c+2*a[k+4]-a[k+2],f=d+2*a[k+5]-a[k+3],c+=a[k+4],d+=a[k+5];break;case "S":for(k=0;k+3<a.length;k+=4)b.push({ib:"S",D:[e,f,a[k],a[k+1],a[k+2],a[k+3]]}),c=a[k+2],d=a[k+3],e=2*c-a[k],f=2*d-a[k+1];break;case "s":for(k=0;k+3<a.length;k+=4)b.push({ib:"S",D:[e,f,c+a[k],d+a[k+1],c+a[k+2],d+a[k+3]]}),e=c-a[k],f=d-a[k+1],c+=a[k+2],d+=a[k+3];break;case "Q":for(k=0;k+3<a.length;k+=4)b.push({ib:"Q",D:[a[k],a[k+1],a[k+2],a[k+3]]}),c=a[k+2],d=a[k+3],e=2*c-a[k],
f=2*d-a[k+1];break;case "q":for(k=0;k+3<a.length;k+=4)b.push({ib:"Q",D:[c+a[k],d+a[k+1],c+a[k+2],d+a[k+3]]}),e=c+2*a[k+2]-a[k],f=d+2*a[k+3]-a[k+1],c+=a[k+2],d+=a[k+3];break;case "T":for(k=0;k+1<a.length;k+=2)b.push({ib:"Q",D:[e,f,a[k],a[k+1]]}),c=a[k],d=a[k+1],e=2*c-e,f=2*d-f;break;case "t":for(k=0;k+1<a.length;k+=2)b.push({ib:"Q",D:[e,f,c+a[k],d+a[k+1]]}),c+=a[k],d+=a[k+1],e=2*c-e,f=2*d-f;break;case "Z":case "z":c=g;d=h;b.push({ib:"Z",D:[]});break;default:throw"unimplemented path command: "+k;}});
return b}var n=a.getAttribute("id"),t=function(){var b=a.getAttribute("style")||"",c=a.getAttribute("class");c&&e.u.hasOwnProperty(c)&&(b=e.u[c]+";"+b);c={};of(c,b);(b=a.getAttribute("fill"))&&(c.fill=b);(b=a.getAttribute("stroke"))&&(c.stroke=b);(b=a.getAttribute("stroke-width"))&&(c["stroke-width"]=b);(b=a.getAttribute("stroke-dasharray"))&&(c["stroke-dasharray"]=b.split(","));(b=a.getAttribute("stroke-dashoffset"))&&(c["stroke-dashoffset"]=b);(b=a.getAttribute("id"))&&(c.id=b);return c}();b={name:a.tagName,
id:n,style:t,parent:b};switch(a.tagName){case "svg":b.children=f(b);break;case "g":b.children=f(b);b.transform=c(a.getAttribute("transform"));break;case "path":b.path=h(a.getAttribute("d")||"");b.transform=c(a.getAttribute("transform"));break;case "line":b.Hd=g("x1");b.Jd=g("y1");b.Id=g("x2");b.Kd=g("y2");b.transform=c(a.getAttribute("transform"));break;case "polygon":case "polyline":b.Lc=a.getAttribute("points").trim().replace(/\s+/g," ").split(" ").map(function(a){return parseFloat(a)});b.transform=
c(a.getAttribute("transform"));break;case "circle":b.x=g("cx");b.y=g("cy");b.r=g("r");b.transform=c(a.getAttribute("transform"));break;case "rect":b.x=g("x");b.y=g("y");b.width=g("width");b.height=g("height");n=g("rx");t=g("ry",n);n=g("rx",t);b.th=n;b.uh=t;b.transform=c(a.getAttribute("transform"));break;case "text":b.x=g("x");b.y=g("y");b.text=a.textContent;b.transform=c(a.getAttribute("transform"));break;default:return null}return b}var e=a,f="";b(a.i);a.u=function(){var a={};f.split("}").forEach(function(b){var c=
b.split("{");c[0].split(",").forEach(function(b){b=b.trim();/^\.[-a-z0-9]+/i.test(b)&&(b=b.slice(1),a[b]=a[b]?a[b]+";"+c[1]:c[1])})});return a}();a.i&&(a.l=d(a.i,null))}function zf(a,b){function c(a,b){if(a.id===b)return a;if(a.children)for(var d=0;d<a.children.length;d++){var e=c(a.children[d],b);if(e)return e}return null}if(a.G[b])return a.G[b];var d=c(a.l,b);d&&(a.G[b]=d);return d}
function Af(a,b,c,d,e){a&&a.forEach(function(a){switch(a.ib){case "translate":b(a.D[0],a.D[1]);break;case "rotate":0!==a.D[1]||0!==a.D[2]?(b(-a.D[1],-a.D[2]),c(a.D[0]),b(a.D[1],a.D[2])):c(a.D[0]);break;case "scale":d(a.D[0],a.D[1]);break;case "matrix":e(a.D[0],a.D[1],a.D[2],a.D[3],a.D[4],a.D[5])}})}
xf.prototype.L=function(a,b){function c(l,n,r){function p(){for(var a=0;a<l.children.length;a++)c(l.children[a],n,r)}function q(a,b){a=h.apply(new rf(a,b));m.push(a.x);k.push(a.y)}function t(a,b,c){if(null==a||""==a)return b;a=/^\s*(-?[0-9.]+)\s*([a-z%]*)\s*$/i.exec(a);b=parseFloat(a[1]);switch(a[2]||"px"){case "pt":return 25.4*b/72*3;case "pc":return 25.4*b/6*3;case "in":return 25.4*b*3;case "mm":return 3*b;case "cm":return 30*b;case "em":return 18*b;case "ex":return 9*b;case "%":return b*c/100;
default:return b}}function v(c){var d=0,e=0,f=[],g=[],h=!0;a&&a.beginPath();c.forEach(function(c){switch(c.ib){case "M":2<=c.D.length&&(d=c.D[0],e=c.D[1],a&&a.moveTo(d,e),q(d,e),h&&1<f.length&&b&&b.Ea&&b.Ea.line&&b.Ea.line(f,g,!1),h=!0,f=m.slice(-1),g=k.slice(-1));break;case "L":d=c.D[0];e=c.D[1];a&&a.lineTo(d,e);q(d,e);f.push(m[m.length-1]);g.push(k[k.length-1]);break;case "A":var l=c.D[5],n=c.D[6];var x=c.D[0];var r=c.D[1],p=c.D[2],t=0!=c.D[3],v=0!=c.D[4],u=c.D[5],w=c.D[6],Ha=c.D[7],A=c.D[8];if(0===
x||0===r)a&&a.lineTo(Ha,A),x=new rf(Ha,A);else{var T=Math.cos(p),O=Math.sin(p);c=(T*u+O*w)/x;w=(-O*u+T*w)/r;u=(T*Ha+O*A)/x;Ha=(-O*Ha+T*A)/r;A=(u-c)/2;T=(Ha-w)/2;O=A*A+T*T;O=Math.sqrt((1-O)/O);isNaN(O)?O=0:t===v&&(O=-O);t=(c+u)/2+O*T;A=(w+Ha)/2-O*A;c=Math.atan2((w-A)/x,(c-t)/r);w=Math.atan2((Ha-A)/x,(u-t)/r);a&&(a.rotate(p),a.scale(x,r),v?a.arc(t,A,1,c,w,!0):a.arc(t,A,1,c,w),a.scale(1/x,1/r),a.rotate(-p));u=new sf;u.rotate(p);u.scale(x,r);x=v?c<w?(c+w)/2+Math.PI:(c+w)/2:c<w?(c+w)/2:(c+w)/2+Math.PI;
x=u.apply(new rf(t+Math.cos(x),A+Math.sin(x)))}d=l;e=n;q(x.x,x.y);q(d,e);h=!1;break;case "C":a&&a.bezierCurveTo(c.D[0],c.D[1],c.D[2],c.D[3],c.D[4],c.D[5]);d=c.D[4];e=c.D[5];q(d,e);h=!1;break;case "S":a&&a.bezierCurveTo(c.D[0],c.D[1],c.D[2],c.D[3],c.D[4],c.D[5]);d=c.D[4];e=c.D[5];q(d,e);h=!1;break;case "Q":a&&a.quadraticCurveTo(c.D[0],c.D[1],c.D[2],c.D[3]);d=c.D[2];e=c.D[3];q(d,e);h=!1;break;case "Z":a&&a.closePath(),h&&1<f.length&&b&&b.Ea&&b.Ea.line&&b.Ea.line(f,g,!0),h=!0,f=[],g=[]}});h&&1<f.length&&
b&&b.Ea&&b.Ea.line&&b.Ea.line(f,g,!1)}function R(b){function c(a,b){if(0<b.length){a.splice(0,a.length);for(var c=0;c<b.length&&1>c;c++){var d=(b[c].getAttribute("offset")||"0").trim(),e=/%$/.test(d)?parseFloat(d.slice(0,-1))/100:parseFloat(d),f=b[c].getAttribute("style");d={};f&&of(d,f);isNaN(e)||(f=b[c].getAttribute("stop-color")||d["stop-color"]||"#000",lf.hasOwnProperty(f)&&(f=lf[f]),d=(b[c].getAttribute("stop-opacity")||d["stop-opacity"]||"1").trim(),d=/%$/.test(d)?parseFloat(d.slice(0,-1))/
100:parseFloat(d),1!==d&&(/^#[0-9a-f]{3}$/i.test(f)?f="rgba("+f.slice(1).split("").map(function(a){return 17*parseInt(a,16)}).map(function(a){return a.toString(10)}).join(",")+","+d.toFixed(2)+")":/^#[0-9a-f]{6}$/i.test(f)?f="rgba("+[f.slice(1,3),f.slice(3,5),f.slice(5)].map(function(a){return parseInt(a,16)}).map(function(a){return a.toString(10)}).join(",")+","+d.toFixed(2)+")":/^rgb(\d+%?(,|\s+)\d+%?(,|\s+)\d+%?)$/i.test(f)?f=f.slice(0,-1).replace(/\s+/g,",")+","+d.toFixed(2)+")":/^hsl(\d+%?(,|\s+)\d+%?(,|\s+)\d+%?)$/i.test(f)&&
(f=f.slice(0,-1).replace(/\s+/g,",")+","+d.toFixed(2)+")")),a.push({offset:e,color:f}))}}}function d(a,b){if(a.attributes["xlink:href"]){var e=a.getAttribute("xlink:href");"#"===e[0]&&(e=g.b.getElementById(e.slice(1)))&&(b=d(e,b))}b.Hd=a.attributes.x1?parseFloat(a.getAttribute("x1")):b.Hd||0;b.Jd=a.attributes.y1?parseFloat(a.getAttribute("y1")):b.Jd||0;b.Id=a.attributes.x2?parseFloat(a.getAttribute("x2")):b.Id||0;b.Kd=a.attributes.y2?parseFloat(a.getAttribute("y2")):b.Kd||0;b.Xc=a.attributes.gradientUnits?
a.getAttribute("gradientUnits"):b.Xc||"objectBoundingBox";b.ic=a.attributes.gradientTransform?a.getAttribute("gradientTransform"):b.ic||"";b.rb=b.rb||[];c(b.rb,a.getElementsByTagName("stop"));return b}function e(a,b){if(a.attributes["xlink:href"]){var d=a.getAttribute("xlink:href");"#"===d[0]&&(d=g.b.getElementById(d.slice(1)))&&(b=e(d,b))}b.Tc=a.attributes.cx?parseFloat(a.getAttribute("cx")):b.Tc||0;b.Uc=a.attributes.cy?parseFloat(a.getAttribute("cy")):b.Uc||0;b.r=a.attributes.r?parseFloat(a.getAttribute("r")):
b.r||0;b.Xc=a.attributes.gradientUnits?a.getAttribute("gradientUnits"):b.Xc||"objectBoundingBox";b.ic=a.attributes.gradientTransform?a.getAttribute("gradientTransform"):b.ic||"";b.rb=b.rb||[];c(b.rb,a.getElementsByTagName("stop"));return b}var f=/^url\(#(.+)\)$/.exec(b);if(f&&f[1]&&(f=g.b.getElementById(f[1])))switch(f.tagName){case "linearGradient":b=d(f,{});if("objectBoundingBox"===b.Xc)throw"objectBoundingBox not supported";if(b.ic)throw f=new sf,qf(b.ic,f),"gradientTransform not supported";var h=
a.createLinearGradient(b.Hd,b.Jd,b.Id,b.Kd);for(f=0;f<b.rb.length;f++)h.addColorStop(b.rb[f].offset,b.rb[f].color);return h;case "radialGradient":b=e(f,{});if("objectBoundingBox"===b.Xc)throw"objectBoundingBox not supported";b.ic&&(f=new sf,qf(b.ic,f),h=tf(f,{x:b.Tc,y:b.Uc}),f=b.r/Math.sqrt(Math.abs(f.b[0]*f.b[4])),b.Tc=h.x,b.Uc=h.y,b.r=f);h=a.createRadialGradient(b.Tc,b.Uc,0,b.Tc,b.Uc,b.r);for(f=0;f<b.rb.length;f++)h.addColorStop(b.rb[f].offset,b.rb[f].color);return h}return b}function Q(b,c,d,e,
f,g){0>=f||0>=g?a.rect(b,c,d,e):(f=Math.min((f+g)/2,Math.min(d,e)/2),a.moveTo(b+d-f,c),a.arc(b+d-f,c+f,f,1.5*Math.PI,2*Math.PI),a.lineTo(b+d,c+e-f),a.arc(b+d-f,c+e-f,f,0,.5*Math.PI),a.lineTo(b+f,c+e),a.arc(b+f,c+e-f,f,.5*Math.PI,Math.PI),a.lineTo(b,c+f),a.arc(b+f,c+f,f,Math.PI,1.5*Math.PI),a.closePath())}function Fa(){if(a){var b={};n&&mf(b,n);r&&mf(b,r);"hidden"!==b.visibility&&(b.opacity&&(a.globalAlpha*=parseFloat(b.opacity)),b.fill&&"none"===b.fill||(a.fillStyle="white"===b.fill||"#fff"===b.fill||
"#ffffff"===b.fill?"white":R(b.fill)||"none",a.fill()),b.stroke&&"none"!==b.stroke&&(a.lineWidth=t(b["stroke-width"]||"1px",1,100),a.strokeStyle=b.stroke||"none",a.miterLimit=b["stroke-miterlimit"]||4,a.lineJoin=b["stroke-linejoin"]||"miter",a.lineCap=b["stroke-linecap"]||"butt",b["stroke-dasharray"]&&(a.setLineDash(b["stroke-dasharray"].split(" ").map(function(a){return parseFloat(a)})),a.lineDashOffset=b["stroke-dashoffset"]?parseFloat(b["stroke-dashoffset"]):0),a.stroke()))}}function oa(c,d,e){if(a){var f=
{};n&&mf(f,n);r&&mf(f,r);"hidden"!==f.visibility&&(a.font=(f["font-size"]||"12px")+" "+(f["font-family"]||"helvetica"),f.fill&&"none"!==f.fill&&(a.fillStyle="white"===f.fill||"#fff"===f.fill||"#ffffff"===f.fill?"white":b&&b.fill||"silver",a.fillText(c,d,e)),f.stroke&&"none"!==f.stroke&&(a.strokeStyle=b&&b.stroke||"black",a.strokeText(c,d,e)))}}function xa(b,c){b=uf({x:b,y:c});a.save();a.strokeStyle="black";a.lineWidth=1;a.strokeRect(b.Z,b.ba,b.oa-b.Z,b.pa-b.ba);a.restore()}var ja=l.id&&b&&b.Qd&&b.Qd[l.id],
T=l.id&&b&&b.Df&&b.Df[l.id];a&&a.save();h.save();ja&&a&&d(l,ja);T&&a&&e(T);n=nf(n);r=nf(r);(function(){l.style&&mf(n,l.style);b&&b.Xg&&of(n,b.Xg);l.id&&b&&b.style&&b.style.hasOwnProperty(l.id)&&of(r,b.style[l.id]);for(var a in b.style)b.style.hasOwnProperty(a)&&"!"===a[0]&&a.slice(1)!==l.id&&of(r,b.style[a])})();ja=m.length;switch(l.name){case "svg":h.save();f(l.transform);p();h.restore();break;case "g":h.save();f(l.transform);p();h.restore();break;case "path":a&&a.save();h.save();f(l.transform);
v(l.path);Fa();a&&a.restore();h.restore();break;case "line":a&&a.save();h.save();f(l.transform);a&&a.beginPath();a&&a.moveTo(l.Hd,l.Jd);a&&a.lineTo(l.Id,l.Kd);Fa();q(l.Hd,l.Jd);q(l.Id,l.Kd);b&&b.Ea&&b.Ea.line&&b.Ea.line([l.Hd,l.Id],[l.Jd,l.Kd],!1);a&&a.restore();h.restore();break;case "polygon":case "polyline":if(4<=l.Lc.length){a&&a.save();h.save();f(l.transform);a&&a.beginPath();a&&a.moveTo(l.Lc[0],l.Lc[1]);q(l.Lc[0],l.Lc[1]);for(T=2;T+1<l.Lc.length;T+=2)a&&a.lineTo(l.Lc[T],l.Lc[T+1]),q(l.Lc[T],
l.Lc[T+1]);"polygon"===l.name&&a&&a.closePath();Fa();b&&b.Ea&&b.Ea.line&&b.Ea.line(m.slice(-l.Lc.length/2),k.slice(-l.Lc.length/2),"polygon"===l.name);a&&a.restore();h.restore()}break;case "circle":a&&a.save();h.save();f(l.transform);a&&a.beginPath();a&&a.arc(l.x,l.y,l.r,0,2*Math.PI);Fa();q(l.x-l.r,l.y-l.r);q(l.x-l.r,l.y+l.r);q(l.x+l.r,l.y-l.r);q(l.x+l.r,l.y+l.r);if(b&&b.Ea&&b.Ea.Cf){T=m.slice(-4);var O=k.slice(-4),ya=(T[3]-T[0])*(T[3]-T[0])+(O[3]-O[0])*(O[3]-O[0]),Oa=(T[2]-T[1])*(T[2]-T[1])+(O[2]-
O[1])*(O[2]-O[1]);.001>Math.abs(ya-Oa)/(ya+Oa)&&.001>((T[3]-T[0])*(T[2]-T[1])+(O[3]-O[0])*(O[2]-O[1]))/ya&&b.Ea.Cf((T[0]+T[2])/2,(O[0]+O[2])/2,Math.sqrt(ya/8))}a&&a.restore();h.restore();break;case "rect":a&&a.save();h.save();f(l.transform);a&&(a.beginPath(),0<l.th||0<l.uh?Q(l.x,l.y,l.width,l.height,l.th,l.uh):a.rect(l.x,l.y,l.width,l.height));Fa();q(l.x,l.y);q(l.x,l.y+l.height);q(l.x+l.width,l.y);q(l.x+l.width,l.y+l.height);a&&a.restore();h.restore();break;case "text":a&&a.save(),h.save(),f(l.transform),
oa(l.text,l.x,l.y),q(l.x,l.y),a&&a.restore(),h.restore()}a&&a.restore();h.restore();a&&b&&b.Wg&&xa(m.slice(ja),k.slice(ja))}function d(b,c){if(c.jb&&0!=c.jb){var d=c.xe,e=c.ye;if(void 0==d||void 0==e)d=g.L(null,{Zc:b}),b=uf(d),d=(b.Z+b.oa)/2,e=(b.ba+b.pa)/2;a.translate(d+(c.Gb||0),e+(c.Hb||0));a.rotate(c.jb);a.translate(-d,-e)}else(c.Gb||c.Hb)&&a.translate(c.Gb,c.Hb)}function e(b){a.beginPath();a.rect(b.x,b.y,b.qc,b.ed);a.clip()}function f(b){Af(b,function(b,c){a&&a.translate(b,c);h.translate(b,c)},
function(b){a&&a.rotate(b);h.rotate(b)},function(b,c){a&&a.scale(b,c);h.scale(b,c)},function(b,c,d,e,f,g){a&&a.transform(b,c,d,e,f,g);h.nf(b,c,d,e,f,g)})}var g=this,h=new vf,m=[],k=[],p=this.l;b&&b.he?p=zf(this,b.he):b&&b.Zc&&(p=b.Zc);if(p){b&&b.Of&&b.Of(a,this.C);if(a){for(var n=[],t=p.parentElement;null!=t;t=t.parentElement)n.push(t);for(t=n.length-1;0<=t;t--){var q=n[t].id;(q=q&&b&&b.Qd&&b.Qd[q])&&d(n[t],q);f(n[t].transform)}}c(p,{},{})}return{x:m,y:k}};
function Bf(a,b){if(a.id===b)return a;if(a.children)for(var c=0;c<a.children.length;c++){var d=Bf(a.children[c],b);if(d)return d}return null}xf.prototype.Jc=function(a){return null!=Bf(this.l,a)};xf.prototype.qg=function(a,b){var c=Bf(this.l,b);if(null==c)throw"Undefined SVG element id "+b;return null!=Bf(c,a)};function sf(a){this.b=a||[1,0,0,0,1,0]}y=sf.prototype;y.qb=function(){return new sf(this.b)};y.apply=function(a){return new rf(this.b[0]*a.x+this.b[1]*a.y+this.b[2],this.b[3]*a.x+this.b[4]*a.y+this.b[5])};function tf(a,b){var c=a.b[0]*a.b[4]-a.b[3]*a.b[1];return new rf((a.b[4]*b.x-a.b[1]*b.y+a.b[1]*a.b[5]-a.b[4]*a.b[2])/c,(-a.b[3]*b.x+a.b[0]*b.y+a.b[3]*a.b[2]-a.b[0]*a.b[5])/c)}
y.translate=function(a,b){this.b=[this.b[0],this.b[1],this.b[0]*a+this.b[1]*b+this.b[2],this.b[3],this.b[4],this.b[3]*a+this.b[4]*b+this.b[5]]};y.scale=function(a,b){this.b=[this.b[0]*a,this.b[1]*b,this.b[2],this.b[3]*a,this.b[4]*b,this.b[5]]};y.rotate=function(a){var b=Math.cos(a);a=Math.sin(a);this.b=[b*this.b[0]+a*this.b[1],-a*this.b[0]+b*this.b[1],this.b[2],b*this.b[3]+a*this.b[4],-a*this.b[3]+b*this.b[4],this.b[5]]};
y.nf=function(a,b,c,d,e,f){this.b=[a*this.b[0]+c*this.b[1],b*this.b[0]+d*this.b[1],a*this.b[2]+c*this.b[3],b*this.b[2]+d*this.b[3],a*this.b[4]+c*this.b[5]+e,b*this.b[4]+d*this.b[5]+f]};function rf(a,b){this.x=a||0;this.y=b||0}function vf(){this.stack=[new sf]}y=vf.prototype;y.apply=function(a){return this.stack[this.stack.length-1].apply(a)};y.save=function(){this.stack.push(this.stack[this.stack.length-1].qb())};y.restore=function(){if(2>this.stack.length)throw"restore doesn't match save";this.stack.pop()};
y.translate=function(a,b){this.stack[this.stack.length-1].translate(a,b)};y.scale=function(a,b){this.stack[this.stack.length-1].scale(a,b)};y.rotate=function(a){this.stack[this.stack.length-1].rotate(a)};y.nf=function(a,b,c,d,e,f){this.stack[this.stack.length-1].nf(a,b,c,d,e,f)};function Cf(a){for(var b=0;b<a.draw.length;b++)if(a.draw[b].uri)return a.draw[b].uri;throw"URI not found";}function xc(a){a=a.split("#");return{Vc:a[0],id:a[1]}}function Df(a,b,c){a.O.save();c.Of=function(a,b){this.clientData.Ce=b;a.translate(-b[0],-b[1]);a.scale(this.B.m/(b[2]-b[0]),this.B.m/(b[3]-b[1]))}.bind(a);b.L(a.O,c);a.O.restore()}
function Ef(a,b,c,d,e){return{x:(a.clientData.Ce[2]-a.clientData.Ce[0])/d*(b+a.clientData.Ce[0]),y:(a.clientData.Ce[3]-a.clientData.Ce[1])/e*(c+a.clientData.Ce[1])}}
function Ff(a,b,c){var d={},e=(a.buttons?a.buttons.length:0)+(a.radiobuttons?1:0);if(void 0!=a.sliders){for(var f=0;f<a.sliders.length;f++){var g=a.sliders[f],h=wf(b,g.id),m=wf(b,g.thumbId),k=(m.Z+m.oa)/2,p=(m.ba+m.pa)/2;h.oa-h.Z<h.pa-h.ba?(h.Z=h.oa=(h.Z+h.oa)/2,k=h.Z):(h.ba=h.pa=(h.ba+h.pa)/2,p=h.ba);m=(c[e+f]-g.min)/(g.max-g.min);d[g.thumbId]={Gb:m*(h.oa-h.Z)-(k-h.Z),Hb:m*(h.ba-h.pa)-(p-h.pa)}}e+=a.sliders.length}if(void 0!=a.rotating)for(f=0;f<a.rotating.length;f++)g=a.rotating[f],m=g.numSteps?
2*Math.PI/g.numSteps:1,h=wf(b,g.centerId),d[g.id]={jb:c[e+f]*m,xe:(h.Z+h.oa)/2,ye:(h.ba+h.pa)/2};return d}function Gf(a,b,c){return Math.min(Math.max((c-a)/(b-a),0),1)}
function Hf(a,b,c,d,e,f,g,h,m){e=Ef(a,m.x-g,m.y-h,e,f);var k=a.clientData.Bd.min+(a.clientData.Bd.max-a.clientData.Bd.min)*Gf(a.clientData.min,a.clientData.max,a.clientData.Ue?e.y:e.x),p=a.clientData.Bd.min,n=a.clientData.Bd.max;(e=a.clientData.Bd.discrete)&&0<e.length?k=e.reduce(function(a,b){return Math.abs(k-b)<Math.abs(k-a)?b:a},e[0]):(a=a.clientData.Bd.snap)&&a.forEach(function(a,c){"string"===typeof a&&/^`.+`$/.test(a)&&(a=na(a,b.h,c,!0));Math.abs(k-a)<Math.abs(n-p)/10&&(k=a)});b.h[(d.buttons?
d.buttons.length:0)+(d.radiobuttons?1:0)+c]=Math.max(Math.min(p,n),Math.min(Math.max(p,n),k));G(b)}
function If(a,b,c,d){if(0!==c.draw.length){var e=xc(Cf(c)).Vc,f=e?Ff(c,b.Fb[e],d.h):{},g=null;if(c.diffwheelmotion&&c.diffwheelmotion.id){g=c.diffwheelmotion;var h=g.id,m=g.dx||0,k=g.dy||0,p=g.adjscale||1,n=g.color||"black",t=void 0===g.linewidth?1:g.linewidth;g=wf(b.Fb[e],h);var q=(c.buttons?c.buttons.length:0)+(c.radiobuttons?1:0),l=2.4*d.h[q];q=2.4*d.h[q+1];var v=a.B.m;g=(.5+m)*(g.oa-g.Z)*p/v;m=Be(a,l,q,g,{color:n,mf:t});f[h]={Gb:-(m.x*g*v+k*v*Math.sin(m.jb)),Hb:-(m.y*g*v+k*v*Math.cos(m.jb)),jb:-m.jb};
g={Ph:l,Qh:q,Xh:g,color:n,mf:t}}c.draw.forEach(function(a){if(a.uri){var g=xc(a.uri),h=b.Fb[g.Vc];g=g.id;for(var k={},m=c.buttons?c.buttons.length:0,l=c.radiobuttons?c.radiobuttons.length:0,n=c.styles?c.styles.length:0,p=0;p<m;p++){var q=c.buttons[p].val,r=c.buttons[p].st;q=q.indexOf(d.h[p]);0<=q&&(k[c.buttons[p].id]=r[q])}for(p=0;p<l;p++)q=c.radiobuttons[p].val,r=c.radiobuttons[p].st,k[c.radiobuttons[p].id]=r[d.h[m]===q?1:0];for(p=0;p<n;p++)k[(c.styles[p].complement?"!":"")+c.styles[p].id]=na(c.styles[p].st,
d.h);m=b.Fb[e];l=d.h;n={};if(void 0!=c.sliders)for(p=0;p<c.sliders.length;p++){r=c.sliders[p];q=wf(m,r.id);var t=r.lowerPartId&&wf(m,r.lowerPartId);if(t){var v=(l[p]-r.min)/(r.max-r.min),O=t.oa-t.Z,ya=t.pa-t.ba;n[r.lowerPartId]=q.oa-q.Z<q.pa-q.ba?{x:t.Z-ya,y:t.ba,qc:O+2*ya,ed:ya*v}:{x:t.Z,y:t.ba-ya,qc:O*v,ed:ya+2*O}}}Df(this,h,{he:g,style:k,Qd:f,Df:n,Wg:!1})}a.js&&(a=new Function("ctx","$",a.js),this.O.save(),this.O.scale(this.B.m/1E3,this.B.m/1E3),this.O.beginPath(),a(this.O,d.h),this.O.restore())},
a);g&&Be(a,g.Ph,g.Qh,g.Xh,{color:g.color,mf:g.mf});c.score&&c.score.id&&(h=(c.buttons?c.buttons.length:0)+(c.radiobuttons?1:0)+(c.sliders?c.sliders.length:0),k=c.score,n=k.numHeights||5,g=wf(b.Fb[e],k.id),t=b.Fb[e].C,Fe(a,d.h.slice(h),(g.Z-t[0])/(t[2]-t[0]),(g.oa-t[0])/(t[2]-t[0]),(g.pa-t[1])/(t[3]-t[1]),(g.ba-t[1])/(t[3]-t[1]),n,(g.pa-g.ba)/(t[3]-t[1])/n*(k.noteSize||1),void 0===k.linewidth?1:k.linewidth))}}
function Jf(a,b,c){function d(a){for(var b=0;b<c.length;b++)if(c[b].name===a)return b;return-1}b.forEach(function(b){var e=b.name;if(!e)throw"Missing block name";var g=d(e),h=0<=g?c[g]:null,m=h?h.type:"?";if(b.type||!h)switch(b.type){case "event":m="e";break;case "action":m="a";break;case "state":m="s";break;case "comment":m="c";break;case "hidden":m="h";break;default:throw"Unknown block type "+b.type+" for block "+e;}var k=h?h.xa:[];b.modes&&!h&&b.modes.forEach(function(a){switch(a){case "basic":k.push("b");
break;case "advanced":k.push("a");break;default:throw"Unknown block mode "+a;}});var p=h?h.Pc:null,n=b.validation;n&&(p=function(a){for(var b=0;b<n.length;b++){var c=n[b].assert;if("string"===typeof c&&/^`.+`$/.test(c)?!na(c,a.h,void 0,!0):!c)return(a=n[b].warning)?new za(a,!0):new za(n[b].error||"Error")}});var t=h?h.L:function(c,d){If(c,a,b,d)},q=h?h.fa:function(c,d,e,f,g,h,k){a:{var m=xc(Cf(b)).Vc,l=0,n=b.buttons;if(n){var p;b:{var q=a.Fb[m],r=Ef(c,k.x-g,k.y-h,e,f);for(p=0;p<n.length;p++)if(q.Sd(n[p].id,
r.x,r.y)){q=n[p].val.indexOf(d.h[p]);0<=q&&(F(d),d.h[p]=n[p].val[(q+1)%n[p].val.length],G(d));break b}p=null}if(null!==p){d=l+p;break a}l+=n.length}if(p=b.radiobuttons){b:{q=a.Fb[m];n=n||0;r=Ef(c,k.x-g,k.y-h,e,f);for(var t=0;t<p.length;t++)if(q.Sd(p[t].id,r.x,r.y)){F(d);d.h[n]=p[t].val;G(d);p=0;break b}p=null}if(null!==p){d=l+p;break a}l++}if(p=n=b.pushbuttons){b:{p=a.Fb[m];q=Ef(c,k.x-g,k.y-h,e,f);for(r=0;r<n.length;r++)if(p.Sd(n[r].id,q.x,q.y)){F(d);n=n[r].newParameters;"string"===typeof n&&/^`.+`$/.test(n)&&
(n=na(n,d.h,void 0,!0));d.h=n;G(d);n=!0;break b}n=null}p=null!==n}if(p)d=-1;else{if(n=b.sliders){b:{p=a.Fb[m];q=Ef(c,k.x-g,k.y-h,e,f);for(r=0;r<n.length;r++){c.clientData.Bd=n[r];var u=wf(p,c.clientData.Bd.id);c.clientData.Ue=u.oa-u.Z<u.pa-u.ba;c.clientData.min=c.clientData.Ue?u.pa:u.Z;c.clientData.max=c.clientData.Ue?u.ba:u.oa;t=(u.Z+u.oa)/2;u=(u.ba+u.pa)/2;var w=wf(p,c.clientData.Bd.thumbId);if(Math.abs((c.clientData.Ue?q.x:q.y)-(c.clientData.Ue?t:u))<(c.clientData.Ue?w.oa-w.Z:w.pa-w.ba)){F(d);
p=r;break b}}p=null}if(null!==p){d=l+p;break a}l+=n.length}if(n=b.rotating){b:{p=a.Fb[m];q=d.h.slice(l,l+n.length);r=Ef(c,k.x-g,k.y-h,e,f);for(t=0;t<n.length;t++){u=wf(p,n[t].centerId);u={x:(u.Z+u.oa)/2,y:(u.ba+u.pa)/2};var v=n[t].numSteps?2*Math.PI/n[t].numSteps:1;w=u.x+(r.x-u.x)*Math.cos(q[t]*v)+(r.y-u.y)*Math.sin(q[t]*v);v=u.y-(r.x-u.x)*Math.sin(q[t]*v)+(r.y-u.y)*Math.cos(q[t]*v);if(p.Sd(n[t].thumbId,w,v)){c.clientData.ui=n[t];c.clientData.Rg=u;c.clientData.Vh=Math.atan2(v-u.y,w-u.x);F(d);p=t;
break b}}p=null}if(null!==p){d=l+p;break a}l+=n.length}if(b.score&&(q=a.Fb[m],c=(b.buttons?b.buttons.length:0)+(b.radiobuttons?1:0)+(b.sliders?b.sliders.length:0),m=d.h.slice(c).length/2,n=b.score.numHeights||5,p=wf(q,b.score.id),q=q.C,(e=We((p.Z-q[0])/(q[2]-q[0]),(p.oa-q[0])/(q[2]-q[0]),(p.pa-q[1])/(q[3]-q[1]),(p.ba-q[1])/(q[3]-q[1]),m,n,e,f,g,h,k))?(F(d),d.h[c+2*e.index]===e.tone?d.h[c+2*e.index+1]=(d.h[c+2*e.index+1]+1)%3:(d.h[c+2*e.index]=e.tone,d.h[c+2*e.index+1]=1),G(d),p=0):p=null,null!==p)){d=
l+p;break a}d=null}}return d},l=h?h.Oa:function(a,c,d,e,f,g,h,k){var m=(b.buttons?b.buttons.length:0)+(b.radiobuttons?1:0),l=b.sliders?b.sliders.length:0;d>=m&&d<m+l?Hf(a,c,d-m,b,e,f,g,h,k):(m+=l,l=b.rotating?b.rotating.length:0,d>=m&&d<m+l&&(d-=m,e=Ef(a,k.x-g,k.y-h,e,f),c.h[(b.buttons?b.buttons.length:0)+(b.radiobuttons?1:0)+(b.sliders?b.sliders.length:0)+d]=Math.round(((Math.atan2(e.y-a.clientData.Rg.y,e.x-a.clientData.Rg.x)-a.clientData.Vh+Math.PI)%(2*Math.PI)-Math.PI)/(b.rotating[d].numSteps?
2*Math.PI/b.rotating[d].numSteps:1)),G(c)))},v=jf(b,h&&h.Rb),r=h&&h.ja||null;if((null==h||null==h.L)&&"h"!==m){var E=xc(Cf(b)).Vc,u=a.Fb[E],w=0;b.buttons&&(b.buttons.forEach(function(a,b){var c=wf(u,a.id);c=new pa((c.ba-u.C[1])/(u.C[3]-u.C[1]),(c.Z-u.C[0])/(u.C[2]-u.C[0]),(c.pa-u.C[1])/(u.C[3]-u.C[1]),(c.oa-u.C[0])/(u.C[2]-u.C[0]),function(c){var d=a.val.indexOf(c.h[b]);0<=d&&(F(c),c.h[b]=a.val[(d+1)%a.val.length],G(c))},null,null);null==r&&(r=new B);r.controls.push(c)}),w=b.buttons.length);var D=
0;b.radiobuttons&&(b.radiobuttons.forEach(function(a){var b=wf(u,a.id);b=new pa((b.ba-u.C[1])/(u.C[3]-u.C[1]),(b.Z-u.C[0])/(u.C[2]-u.C[0]),(b.pa-u.C[1])/(u.C[3]-u.C[1]),(b.oa-u.C[0])/(u.C[2]-u.C[0]),function(b){F(b);b.h[w]=a.val;G(b)},null,null);null==r&&(r=new B);r.controls.push(b)}),D=b.radiobuttons.length);var R=0;b.pushbuttons&&(b.pushbuttons.forEach(function(a){var b=wf(u,a.id);b=new pa((b.ba-u.C[1])/(u.C[3]-u.C[1]),(b.Z-u.C[0])/(u.C[2]-u.C[0]),(b.pa-u.C[1])/(u.C[3]-u.C[1]),(b.oa-u.C[0])/(u.C[2]-
u.C[0]),function(b){F(b);var c=a.newParameters;"string"===typeof c&&/^`.+`$/.test(c)&&(c=na(c,b.h,void 0,!0));b.h=c;G(b)},null,null);null==r&&(r=new B);r.controls.push(b)}),R=b.pushbuttons.length);var Q=0;b.sliders&&(b.sliders.forEach(function(a,b){var c=wf(u,a.id),d=wf(u,a.thumbId),e=Math.abs(d.oa-d.Z);d=Math.abs(d.pa-d.ba);var f=a.min,g=a.max,h=a.discrete;a=new pa((c.ba-d/2-u.C[1])/(u.C[3]-u.C[1]),(c.Z-e/2-u.C[0])/(u.C[2]-u.C[0]),(c.pa+d/2-u.C[1])/(u.C[3]-u.C[1]),(c.oa+e/2-u.C[0])/(u.C[2]-u.C[0]),
null,function(a){var c=a.h[w+D+R+b];h?(c=h.indexOf(c),c=0<=c&&c+1<h.length?h[c+1]:0<h.length?h[h.length-1]:Math.max(f,g)):c=Math.min(Math.max(f,g),c+Math.abs(g-f)/10);a.h[w+D+R+b]=c},function(a){var c=a.h[w+D+R+b];h?(c=h.indexOf(c),c=0<=c&&0<c?h[c-1]:0<h.length?h[0]:Math.min(f,g)):c=Math.max(Math.min(f,g),c-Math.abs(g-f)/10);a.h[w+D+R+b]=c});null==r&&(r=new B);r.controls.push(a)}),Q=b.sliders.length);var Fa=0;b.rotating&&(b.rotating.forEach(function(a,b){var c=wf(u,a.id),d=wf(u,a.centerId),e=(d.Z+
d.oa)/2;d=(d.ba+d.pa)/2;c=Math.max(Math.max(Math.abs(c.Z-e),Math.abs(c.oa-e)),Math.max(Math.abs(c.ba-d),Math.abs(c.pa-d)));var f=a.numSteps,g=-Math.floor(f/2);a=new pa((d-c-u.C[1])/(u.C[3]-u.C[1]),(e-c-u.C[0])/(u.C[2]-u.C[0]),(d+c-u.C[1])/(u.C[3]-u.C[1]),(e+c-u.C[0])/(u.C[2]-u.C[0]),null,function(a){a.h[w+D+R+Q+b]=(a.h[w+D+R+Q+b]+f-g+1)%f+g},function(a){a.h[w+D+R+Q+b]=(a.h[w+D+R+Q+b]+f-g-1)%f+g});null==r&&(r=new B);r.controls.push(a)}),Fa=b.rotating.length);if(b.score){var oa=wf(u,b.score.id),xa=
(b.defaultParameters.length-w-D-R-Q-Fa)/2,ja=b.score.numHeights||5;for(E=0;E<xa;E++)(function(a){var b=w+D+R+Q+Fa,c=new pa((oa.ba-u.C[1])/(u.C[3]-u.C[1]),(oa.Z-u.C[0]+(oa.oa-oa.Z)*a/xa)/(u.C[2]-u.C[0]),(oa.pa-u.C[1])/(u.C[3]-u.C[1]),(oa.Z-u.C[0]+(oa.oa-oa.Z)*(a+1)/xa)/(u.C[2]-u.C[0]),function(c){c.h[b+2*a+1]=bf(c.h[b+2*a+1],[0,1,2])},function(c){0===c.h[b+2*a+1]?(c.h[b+2*a]=0,c.h[b+2*a+1]=1):c.h[b+2*a]=Math.min(c.h[b+2*a]+1,ja-1)},function(c){0===c.h[b+2*a+1]?(c.h[b+2*a]=0,c.h[b+2*a+1]=1):c.h[b+2*
a]=Math.max(c.h[b+2*a]-1,0)},function(c,d,e){d=ja-1-Math.floor(e*ja*.9999);0===c.h[b+2*a+1]?(c.h[b+2*a]=d,c.h[b+2*a+1]=1):c.h[b+2*a]===d?c.h[b+2*a+1]=bf(c.h[b+2*a+1],[0,1,2]):c.h[b+2*a]=d});null==r&&(r=new B);r.controls.push(c)})(E)}}e={name:e,type:m,xa:k,sa:h?h.sa:function(){return b.defaultParameters||[]},eb:h?h.eb:function(){return b.typicalParameters||b.defaultParameters||[]},Te:h?h.Te||null:b.typicalParamSet||null,ja:r,L:t,Ae:h?h.Ae||!1:b.alwaysZoom||!1,fa:q,Oa:l,Rb:v,Pc:p};0<=g?c[g]=new z(e):
c.push(new z(e))})}
function Kf(a){ac=function(b,d){return{m:b,dh:void 0===a.styles.minInteractiveBlockSize?60:a.styles.minInteractiveBlockSize,eh:void 0===a.styles.minTouchInteractiveBlockSize?120:a.styles.minTouchInteractiveBlockSize,Yg:void 0===a.styles.eventRightAlign?!1:a.styles.eventRightAlign,va:void 0===a.styles.blockLineWidth?Math.max(1,Math.min(3,b/40)):a.styles.blockLineWidth,fg:Math.round(b/4).toString(10)+"px sans-serif",g:d,Da:void 0===a.styles.controlLineWidth?Math.max(1,Math.min(3,b/40)):a.styles.controlLineWidth,
Mh:"bold 15px sans-serif",ig:a.styles.errorColor||"#f88",Mg:a.styles.warningColor||"#f88",background:a.styles.background||"white",Ag:a.styles.ruleMarks||"#bbb",Cg:a.styles.scrollbarThumbColor||"navy",Bg:a.styles.scrollbarBackgroundColor||"#ccc",od:a.styles.scrollbarWidth||5}};var b=[];Jf(a,a.blocks||[],b);H=b};function za(a,b){this.w=a;this.Sb=b||!1;this.i=!1;this.l=[];this.b=[];this.u=null}function ob(a,b){a.i=!0;a.l=b}function Aa(a,b){a.i=!0;a.u=b};function Na(){this.Ec=[];this.zd=[]}function Lf(a,b){this.state=a;this.marks=b||{}}function Mf(a,b){function c(a){if(b){if(a.marks)for(var c in a.marks)a.marks.hasOwnProperty(c)&&b[c]&&(a.marks[c]=!1)}else a.marks={}}a.Ec.forEach(c);a.zd.forEach(c)}Na.prototype.zb=function(a,b){b&&Mf(this,b);this.Ec.push(new Lf(a,b));20<this.Ec.length&&(this.Ec=this.Ec.slice(-20));this.zd=[]};Na.prototype.ag=function(a,b){b&&Mf(this,b);return 0<this.Ec.length?(this.zd.push(new Lf(a,b)),this.Ec.pop()):new Lf(a,b)};
Na.prototype.xg=function(a,b){b&&Mf(this,b);return 0<this.zd.length?(this.Ec.push(new Lf(a,b)),this.zd.pop()):new Lf(a,b)};C.prototype.toDataURL=function(a,b,c){function d(a){a&&(a[0]*=g,a[1]*=h)}var e=this;switch(this.T.type){case "e":var f=M(a,{tag:"block",ea:["event","html"]});break;case "a":f=M(a,{tag:"block",ea:["action","html"]});break;case "s":f=M(a,{tag:"block",ea:["state","html"]});break;case "c":f=M(a,{tag:"block",ea:["comment","html"]});break;default:throw"internal";}var g=b.m/f.width,h=b.m/f.height;f.width=b.m;f.height=b.m;d(f.borderBottomLeftRadius);d(f.borderBottomRightRadius);d(f.borderTopLeftRadius);d(f.borderTopRightRadius);
return(new ed(this,L(f),f.qa(),0,0,function(a,b,c,d,g){c=b.x+f.offsetLeft()+c;d=b.y+f.offsetTop()+d;Kc(f,a.O,c,d);var h=e.T;b=b.data;var k=f;a.O.save();a.O.translate(c,d);h.L(a,b,k,g);a.O.restore()})).toDataURL(b,c||1)};function Nf(a,b,c,d,e){a=a.toDataURL(b,c,d);c="<img width='"+c.m.toString(10)+"' height='"+c.m.toString(10)+"' src='"+a+"'>";return e?"<a href='"+a+"' download='"+e+"'>"+c+"</a>":c}
function Of(a,b,c,d,e){var f=M(c,{tag:"widget",id:"widget-"+b.replace(/^.*:/g,"")}),g=L(f),h=f.qa();return{url:(new ed(null,g,h,0,0,function(c,d,e,n){c.Y=a.Y;td(c,b,g/2+e,h/2+n,f)})).toDataURL(d,e||1),width:g,height:h}}function Pf(a,b,c,d,e,f){a=Of(a,b,c,d,e);b="<img width='"+a.width.toString(10)+"' height='"+a.height.toString(10)+"' src='"+a.url+"'>";return f?"<a href='"+a.url+"' download='"+f+"'>"+b+"</a>":b}
function bc(a,b,c,d,e,f){return{url:(new ed(null,b,c,0,0,function(b){a(b.O,d,!1)})).toDataURL(e,f||1),width:b,height:c}}function ic(a,b,c,d,e){for(var f=0;f<a.controls.length;f++){var g=a.controls[f];if(g.id===b)return bc(function(a,b,c){g.L(a,b,c)},g.bd.oa-g.bd.Z,g.bd.pa-g.bd.ba,c,d,e)}return null}
function Ac(a,b){var c=ac(100,100),d=Pf(a.ga,"vpl:then",b,c,5);return"<!DOCTYPE html>\n<html>\n"+(a.za?"<head>\n<style>\n"+a.za+"</style>\n</head>\n":"")+"<body>\n<table class='program'>\n"+a.j.j.map(function(a){return a instanceof Ba?"<tr class='rule-comment'>\n<td class='comment'>\n"+a.ce+"\n</td>\n</tr>\n":a.Ob()?"":"<tr class='rule'>\n<td class='events'>\n<table class='events'>\n<tr class='events'>\n"+a.X.map(function(a,d){var e="block";switch(a.T.type){case "e":e=e+" event"+(0===d?" event-main":
" event-aux");break;case "s":e+=" state";break;case "c":e+=" comment"}return"<td class='"+e+"'>"+Nf(a,b,c,5)+"</td>\n"}).join("")+"</tr>\n</table>\n</td>\n<td class='then'>"+d+"</td>\n<td class='actions'>\n<table class='actions'>\n<tr class='actions'>\n"+a.actions.map(function(a){var d="block";switch(a.T.type){case "a":d+=" action";break;case "c":d+=" comment"}return"<td class='"+d+"'>"+Nf(a,b,c,5)+"</td>\n"}).join("")+"</tr>\n</table>\n</td>\n</tr>\n"}).join("")+"</table>\n</body>\n</html>\n"}
function Cc(a,b,c){function d(a,b){return b.controls.map(function(c){return(a.I.find(c.id).kb||[{}]).map(function(d){a.hc.Na=!0===d.selected;a.hc.state=d.state||null;var g=!0===d.selected?"selected":!1===d.selected?"unselected":"";d.state&&(g+=(0<g.length?" ":"")+"="+d.state);d=c.id+(g?"-"+g.replace(/\s+/g,"-").replace("=",""):"")+".png";var k=ic(b,c.id,h[c.id],e,f),m="<img width='"+k.width.toString(10)+"' height='"+k.height.toString(10)+"' src='"+k.url+"'>";return"<tr><td>"+(d?"<a href='"+k.url+
"' download='"+d+"'>"+m+"</a>":m)+"</td><td>"+c.id+"</td><td>"+g+"</td></tr>\n"}).join("")}).join("")}var e=ac(100,100),f=5,g=fc(a,b);a.hc={disabled:!1,aa:!0,ah:!1,isEnabled:!0,Na:!1,state:null};var h=gc(a,a.G,["vpl","top"]),m=hc(a,a.G,["vpl","top"],g.Dc,g.Hg,h);h=Object.assign(h,gc(a,a.u,["vpl","bottom"]));g=hc(a,a.u,["vpl","bottom"],g.Fd,g.Gg,h);a.ec.forEach(function(a){h[a]=M(b,{tag:"button",id:a.replace(/:/g,"-"),ea:["src","top"]})},a);var k=null;null!=a.N&&(k=Qf(a,a.ec,M(b,{tag:"toolbar",ea:["src",
"top"]}),M(b,{tag:"separator",ea:["src","top"]}),h));a.Ab.forEach(function(a){h[a]=M(b,{tag:"button",id:a.replace(/:/g,"-"),ea:["sim","top"]})},a);var p=a.M,n=null,t=[],q=null;if(null!=p){n=Rf(a,a.Ab,M(b,{tag:"toolbar",ea:["sim","top"]}),M(b,{tag:"separator",ea:["sim","top"]}),h);t="sim-event:forward sim-event:backward sim-event:left sim-event:right sim-event:center sim-event:clap sim-event:tap".split(" ");var l=M(b,{tag:"button",ea:["sim","event"]});q=t.map(function(a){return bc(function(c,d,f){(p.Zd||
cc)(a,c,e,b,["sim","event"],null,!0,!1,f)},l.width,l.height,l,e,f)})}var v=a.j;c=c?"<!DOCTYPE html>\n<html>\n"+(a.za?"<head>\n<style>\n"+a.za+"</style>\n</head>\n":"")+"<body>\n<table>\n"+function(){for(var a=0,c=0,d="";;){for(;a<H.length&&("e"!==H[a].type&&"s"!==H[a].type||0>("b"===v.mode?v.Zb:v.gc).indexOf(H[a].name));)a++;var g="";if(a<H.length){var h=new C(H[a],null,null);H[a].eb&&(h.h=H[a].eb());g=Nf(h,b,e,f,H[a].name.replace(/ /g,"_")+".png");a++}for(;c<H.length&&("a"!==H[c].type&&"c"!==H[c].type||
0>("b"===v.mode?v.Zb:v.gc).indexOf(H[c].name));)c++;h="";c<H.length&&(h=new C(H[c],null,null),H[c].eb&&(h.h=H[c].eb()),h=Nf(h,b,e,f,H[c].name.replace(/ /g,"_")+".png"),c++);if(g||h)d+="<tr>\n<td>"+g+"</td>\n<td>"+h+"</td>\n</tr>\n";else break}return d}()+"</table></html>":"<!DOCTYPE html>\n<html>\n"+(a.za?"<head>\n<style>\n"+a.za+"</style>\n</head>\n":"")+"<body>\n<table>\n"+H.map(function(a){var c=null;switch(a.type){case "e":c="event";break;case "s":c="state";break;case "a":c="action";break;case "c":c=
"comment";break;default:return""}var d=new C(a,null,null),g="<tr class='"+c+"'>\n<td>\n";a.Te?a.Te.forEach(function(c,h){d.h=c;g+=Nf(d,b,e,f,a.name.replace(/ /g,"_")+"-"+h.toString(10)+".png")}):(d.h=a.eb?a.eb():d.h,g+=Nf(d,b,e,f,a.name.replace(/ /g,"_")+".png"));return g+="</td>\n<td>"+a.name+"</td>\n</tr>\n"}).join("")+"</table>\n<table>\n"+Object.keys(a.ga.Y).map(function(a){return"<tr><td>"+Pf(this.ga,a,b,e,f,a+".png")+"</td><td>"+a+"</td></tr>\n"},a).join("")+"</table>\n<table>\n"+d(a,m)+d(a,
g)+(null!=a.N?d(a,k):"")+(null!=p?d(a,n)+q.map(function(a,b){b=t[b];var c="<img width='"+a.width.toString(10)+"' height='"+a.height.toString(10)+"' src='"+a.url+"'>",d=b.replace(/ /g,"_")+".png";return"<tr><td>"+("<a href='"+a.url+"' download='"+d+"'>"+c+"</a>")+"</td><td>"+b+"</td></tr>\n"}):"")+"</table>\n</body>\n</html>\n";a.hc=null;return c};function Sf(a,b){b=(new DOMParser).parseFromString(b,"text/xml").getElementsByTagName("node");if(1>b.length)throw"empty";b=b[0].getElementsByTagName("program");if(1!==b.length)throw"program";var c="0"!==b[0].getAttribute("advanced_mode");b=b[0].getElementsByTagName("set");Xa(a);a.mode=c?"a":"b";for(c=0;c<b.length;c++){var d=Tf(b[c],function(){a.zb()},function(){ab(a)});a.j.push(d)}}
function Tf(a,b,c){a=a.getElementsByTagName("block");for(var d=new ua,e=0;e<a.length;e++){a:{var f=a[e];f.getAttribute("type");var g=f.getAttribute("name");var h=[];for(var m=[],k=0;1E3>k;k++){var p=f.getAttribute("value"+k);if(null===p)break;h.push(p);m.push(parseFloat(p))}for(k=0;k<ma.length;k++)if(g===ma[k].Fh&&(!ma[k].Sa||na(ma[k].Sa,ma[k].zh?h:m,void 0,!0))){f=ma[k].Jh;if(void 0==f){h=null;break a}h=ma[k].parameters?na(ma[k].parameters,ma[k].zh?h:m,void 0,!0):null;m=ta(f);k=new C(m,null,null);
m.Ie?m.Ie(k,h):k.h=h;h=k;break a}throw"unknown AESL block "+g;}h&&d.Ub(h,null,b,c,!0)}return d}
var dc=function(){var a=null;return function(b,c,d){null===a&&(a=document.createElement("a"),document.body.appendChild(a),a.style.display="none");d=d||"application/xml";if("function"===typeof window.Blob&&window.URL){var e=new window.Blob([b],{type:d});e=window.URL.createObjectURL(e)}else e="data:"+d+";base64,"+window.btoa(b);var f=a;d=d||"application/xml";"function"===typeof window.Blob&&window.URL?(b=new window.Blob([b],{type:d}),b=window.URL.createObjectURL(b)):b="data:"+d+";base64,"+window.btoa(b);
f.href=b;f.download=c||"untitled.xml";a.click();"string"!==typeof e&&window.URL.revokeObjectURL(e)}}();function Uf(){this.Jb=document.getElementById("editor");this.Jb.value="";this.b=this.Jb.parentElement;var a=window.innerWidth,b=window.getComputedStyle(this.Jb);this.Jb.style.width=a-10-parseInt(b.paddingLeft,10)-parseInt(b.paddingRight,10)+"px";this.Jb.style.border="0px";this.Jb.style.outline="none";this.Jb.style.resize="none";this.Jb.style.whiteSpace="pre";this.Jb.setAttribute("wrap","off");this.i=null}Uf.prototype.Xf=function(a,b){this.Jb.setSelectionRange(a,b)};
Uf.prototype.resize=function(){var a=this.b.getBoundingClientRect().width,b=window.getComputedStyle(this.Jb);this.Jb.style.width=a-10-parseInt(b.paddingLeft,10)-parseInt(b.paddingRight,10)+"px"};function Vf(a,b){a.Jb.value=b;window.getComputedStyle(a.Jb)};function Wf(a,b,c){this.ra=b;this.language=c||"aseba";this.b="";this.fd=!0;this.Dd=this.Ge=this.Kg=null;this.Vb=!1;this.W=a.W||new Ca;this.Cc=new Uf;this.Cc.Jb.readOnly=this.fd;this.Cc.i=function(a){window.vplBreakpointsFunction&&window.vplBreakpointsFunction(a)};var d=this;this.Ta=new Kb(a.Rc,{ia:a.ia});document.getElementById("editor").addEventListener("input",function(){pc(a);Xf(d)===a.j.ra&&(a.j.ra=!a.j.ra,Lb(a))},!1);var e=document.getElementById("editor");e&&document.getElementById("editor").addEventListener("keydown",
function(a){if(9===a.keyCode){a.preventDefault();a.b=!0;a=e.value;var b=this.selectionStart;a=a.slice(0,b)+"\t"+a.slice(this.selectionEnd);Vf(d.Cc,a);this.selectionStart=this.selectionEnd=b+1;return!1}return!0},!1)}function Yf(a,b){a.Kg=b}y=Wf.prototype;y.Ne=function(){this.W.b=[]};function mc(a,b,c){null===b?Vf(a.Cc,a.b):(a.b=b,Vf(a.Cc,b));c||(a.Dd=null)}y.xc=function(){return document.getElementById("editor").value.replace(/\s+$/,"")};function Xf(a){return a.xc()===a.b.trim()}
y.Xf=function(a,b){this.Cc.Xf(a,b)};function Zf(a){var b=M(a.Ta.ia,{tag:"button",ea:["src","top"]});b.height=a.Ta.B.g;a=M(a.Ta.ia,{tag:"toolbar",ea:["src","top"]});a.height=b.qa();return{height:a.height,qa:a.qa()}}function Qf(a,b,c,d,e){var f=new Fc(a.N.Ta);Wc(f,a,b,["src","top"],a.N.Zd||cc,a.N.Se||Rc);Hc(f,c,e,d);return f}
function pc(a){var b=a.N;b.Ta.mb=[];var c=b.Fg||a.ec,d=gc(a,c,["src","top"]),e=Zf(b).height,f=Cd(b.Ta);Bd(b.Ta);var g=M(b.Ta.ia,{tag:"view",ea:["src"]});M(b.Ta.ia,{tag:"button",ea:["src","top"]});var h=M(b.Ta.ia,{tag:"separator",ea:["src","top"]}),m=M(b.Ta.ia,{tag:"toolbar",ea:["src","top"]});g.Nc(f.width);g.Bc(f.height);g.setPosition(0,0);m.Nc(g.width);m.height=e;m.setPosition(g.x,g.y);Jc(b.Ta,function(a){g.L(a)});Ic(Qf(a,c,m,h,d),m,d);J(b.Ta)}
function kc(a,b){(a.fd=b)&&Vf(a.Cc,a.b);a.Cc.Jb.readOnly=b;pc(window.vplApp)}
y.resize=function(a,b){this.Ta.resize(a,b);a=this.Ta.b.getBoundingClientRect();b=document.getElementById("src-editor");var c=Cd(this.Ta);var d=M(this.Ta.ia,{tag:"view",ea:["src"]});d.Nc(c.width);d.Bc(c.height);d.setPosition(0,0);var e=Zf(this);c=d.x;var f=d.y+e.qa;var g=d.width;d=d.height-e.qa;b.style.left=a.left+a.width*this.Ta.Ha.Z+c+"px";b.style.width=g+"px";b.style.top=a.top+a.height*this.Ta.Ha.ba+f+"px";b.style.height=d+"px";this.Cc.resize();pc(window.vplApp)};
y.focus=function(){document.getElementById("editor").focus();J(this.Ta)};function $f(a){a.I.add("src:close",{action:function(a){a.ob(["src"],{Ef:!0})},object:a,aa:function(a){return 1<a.Ia.length&&0<=a.Ia.indexOf("src")}});a.I.add("src:new",{action:function(a){Vf(a.N.Cc,"");J(a.N.Ta)},isEnabled:function(a){return!a.N.fd&&0<a.N.xc().length},object:a});a.I.add("src:save",{action:function(a){var b=db(a.j,{jd:!1,md:!0});dc(b,a.j.filename||"program.vpl3","application/x-vpl3")},isEnabled:function(a){return 0<a.N.xc().length},object:a});a.I.add("src:vpl",{action:function(a){a.me?
a.ob(["vpl"],{pe:!0}):a.ob(["vpl"],{ke:"src"})},isEnabled:function(a){return Xf(a.N)},object:a,aa:function(a){return!a.N.ra&&0>a.Ia.indexOf("vpl")}});a.I.add("src:locked",{action:function(a){kc(a.N,!a.N.fd);J(a.N.Ta);a.N.fd&&(a.j.ra=!1,Lb(a))},isEnabled:function(a){return null===a.N.Dd},Na:function(a){return a.N.fd},object:a,aa:function(a){return!a.N.ra},kb:[{selected:!1},{selected:!0}]});a.I.add("src:language",{action:function(a){var b=a.N.Kg();a.N.language=b.language;a.N.fd&&mc(a.N,b.code)},isEnabled:function(a){return null===
a.N.Dd},getState:function(a){return a.N.language},object:a,aa:function(a){return null!=a.N.Kg},kb:[{state:"aseba"},{state:"l2"},{state:"asm"},{state:"js"},{state:"python"}]});a.I.add("src:disass",{action:function(a){if(null!==a.N.Dd)mc(a.N,a.N.Dd),a.N.Cc.Jb.readOnly=a.N.fd;else{var b=a.N.xc(),d=a.N.Ge(a.N.language,b);null!==d&&(mc(a.N,d,!0),a.N.Cc.Jb.readOnly=!0,a.N.Dd=b)}pc(a)},isEnabled:function(a){return null!=a.N.Ge&&null!==a.N.Ge(a.N.language,"")},Na:function(a){return null!==a.N.Dd},object:a,
aa:function(a){return null!==a.N.Ge},kb:[{selected:!1},{selected:!0}]});a.I.add("src:run",{action:function(a){var b=a.N.xc();a.Fa[a.na].Pa.mc(b,a.N.language)},isEnabled:function(a){return a.Fa[a.na].Pa.isEnabled(a.N.language)},object:a,aa:function(a){return 0<=a.na}});a.I.add("src:stop",{action:function(a){sc(a)},isEnabled:function(a){return tc(a)},object:a,aa:function(a){return 0<=a.na}});a.I.add("src:connected",{isEnabled:function(a){return!a.j.ra&&0<=a.na&&a.Fa[a.na].Pa.isConnected()},object:a,
aa:function(a){return 0<a.Fa.length},kb:[{selected:!1},{selected:!0},{selected:!1,state:"monitored"},{selected:!0,state:"monitored"},{selected:!1,state:"nonmonitored"},{selected:!0,state:"nonmonitored"}]});a.I.add("src:sim",{action:function(a){a.me?a.ob(["sim"],{pe:!0}):a.ob(["sim"],{ke:"src"})},object:a,aa:function(a){return null!=a.Fa.find(function(a){return"sim"===a.name})&&null!=a.M&&0>a.Ia.indexOf("sim")}});a.I.add("src:teacher-reset",{action:function(a){a.N.Ne();pc(a)},object:a,hd:!0,aa:function(a){return a.N.Vb&&
a.N.W.cc}});a.I.add("src:teacher",{action:function(a){a.N.W.cc=!a.N.W.cc;pc(a)},Na:function(a){return a.N.W.cc},object:a,hd:!0,aa:function(a){return a.N.Vb},kb:[{selected:!1},{selected:!0}]})};function ag(a){var b=["vpl:message-error","vpl:message-warning","vpl:filename"];return function(c,d,e,f,g,h,m,k,p,n,t){function q(a){if(void 0==a)return!0;for(var b=0;b<a.length;b++)switch(a[b]){case "pressed":if(!n||!k)return!1;break;case "unpressed":if(n&&k)return!1;break;case "selected":if(!p)return!1;break;case "unselected":if(p)return!1;break;case "disabled":if(k)return!1;break;case "enabled":if(!k)return!1;break;default:if("="===a[b][0]&&(t||"").toString()!==a[b].slice(1))return!1}return!0}
if(a.buttons)for(var l=0;l<a.buttons.length;l++)if(a.buttons[l].name===c&&q(a.buttons[l].state)){var v=a.buttons[l];v.draw.forEach(function(b){if(b.uri){var c=xc(b.uri);d.save();b.alpha&&(d.globalAlpha=b.alpha);var e={};v.styles&&v.styles.forEach(function(a){e[(a.complement?"!":"")+a.id]=a.st});a.Fb[c.Vc].L(d,{he:c.id,style:e});b.debug&&(d.fillStyle="black",d.textAlign="center",d.textBaseline="middle",d.fillText(b.debug,h.width/2,h.height/2));d.restore()}b.js&&(c={pressed:n&&k,unpressed:!(n&&k),selected:p,
unselected:!p,disabled:!k,enabled:k,state:t},b=new Function("ctx","$",b.js),d.save(),d.scale(h.width/1E3,h.height/1E3),d.beginPath(),b(d,c),d.restore())});return}0<=b.indexOf(c)?cc(c,d,e,f,g,h,m,k,p,n,t):(d.fillStyle="brown",d.fillRect(0,0,h.width,h.height),d.fillStyle="white",d.textAlign="left",d.textBaseline="top",d.font=Math.round(h.height/6).toString(10)+"px sans-serif",d.fillText(c,.02*h.width,.02*h.height),d.fillText((n?"pr ":"")+(p?"sel ":"")+(k?"":"dis"),.02*h.width,.22*h.height),t&&d.fillText("="+
t,.02*h.width,.42*h.height))}}function bg(a){return function(b,c){if(a.buttons)for(var d=0;d<a.buttons.length;d++){var e=a.buttons[d];if(e.name===b&&(void 0==e.state||0>e.state.indexOf("pressed")&&0>e.state.indexOf("selected")&&0>e.state.indexOf("disabled")))return b=xc(e.draw[0].uri),wf(a.Fb[b.Vc],b.id)}return{Z:0,oa:c.g,ba:0,pa:c.g}}}
function cg(a){function b(b){for(var c=0;c<a.widgets.length;c++)if(a.widgets[c].name===b)return a.widgets[c];return null}if(void 0==a.widgets)return{};var c={};["vpl:then","vpl:error","vpl:warning","vpl:moreHigh","vpl:moreLow"].forEach(function(d){var e=b(d);if(e){var f=xc(e.draw[0].uri),g=wf(a.Fb[f.Vc],f.id);c[d]=function(b,c,d,f){e.draw.forEach(function(c){if(c.uri){var d=xc(c.uri);c.alpha&&(b.globalAlpha=c.alpha);b.save();var e=Math.min(f.width/(g.oa-g.Z),f.height/(g.pa-g.ba));b.scale(e,e);b.translate(-(g.Z+
g.oa)/2,-(g.ba+g.pa)/2);a.Fb[d.Vc].L(b,{he:d.id});b.restore();c.debug&&(b.fillStyle="black",b.textAlign="center",b.textBaseline="middle",b.fillText(c.debug,0,0))}c.js&&(c=new Function("ctx",c.js),b.save(),b.scale(f.width,f.height),b.beginPath(),c(b),b.restore())})}}});return c};function dg(a){this.Xa=a&&a.mc?a.mc:null;this.u=a&&a.check?a.check:null;this.S=a&&a.yc?a.yc:null;this.w=a&&a.close?a.close:null;this.Y=a&&a.isConnected?a.isConnected:null;this.i=a&&a.isEnabled?a.isEnabled:null;this.mg=a&&a.Lf?a.Lf:null;this.l=a&&a.ef?a.ef:null;this.G=a&&a.getName?a.getName:null;this.$c=a&&a.$c?a.$c:"aseba";this.languages=a&&a.languages?a.languages:[this.$c];this.state=a&&a.state?a.state:null;this.ka=a&&a.ka?a.ka:{};this.b=this.za=this.ha=null}y=dg.prototype;
y.isConnected=function(){return null==this.Y||this.Y()};y.isEnabled=function(a){return null!=this.Xa&&0<=this.languages.indexOf(a)&&(null==this.i||this.i(a))};y.getName=function(){return null!=this.G?this.G():null};y.yc=function(a){this.S&&this.S(a)};y.close=function(){this.w&&this.w()};y.check=function(a,b,c){if(null==this.u||a===this.ha&&b===this.za)return this.b;var d=this;this.u(b,a,function(e){d.ha=a;d.za=b;e!==d.b&&(d.b=e,c(e))});return this.b};
y.mc=function(a,b){this.isEnabled(b)&&this.Xa(b,a)};y.ef=function(a){return null!=this.mg&&0<=this.languages.indexOf(a)&&(null==this.l||this.l(a))};y.Lf=function(a,b){this.ef(b)&&this.mg(b,a)};function Xb(a,b){function c(a,b,c,k){var g=document.createElement("div");null!=b?g.innerHTML=b:(g.textContent=a,g.style.font="bold 30px sans-serif",g.style.textAlign="left",g.style.padding="5px",g.style.paddingLeft="10px");g.style.position="absolute";g.style.width="32px";g.style.height="32px";g.style.top="0";g.style.cursor="default";c?(g.style.right=f.toString(10)+"px",f+=40):(g.style.left=e.toString(10)+"px",e+=40);g.addEventListener("click",function(){k()},!1);d.u.push(g)}this.w=a;this.b=document.createElement("div");
this.b.style.width="100%";this.b.style.height="100%";this.b.style.position="fixed";this.b.style.top="0";this.b.style.left="0";this.b.style.zIndex="1000";this.b.style.backgroundColor="rgba(1,1,1,0.5)";this.b.style.display="none";this.i=document.createElement("div");this.i.style.width="80%";this.i.style.height="80%";this.i.style.position="fixed";this.i.style.top="50%";this.i.style.left="50%";this.i.style.backgroundColor="white";this.b.appendChild(this.i);document.body.appendChild(this.b);a=document.createElement("div");
a.style.width="100%";a.style.height="100%";b&&b.scroll&&(a.style.overflowY="scroll");this.i.appendChild(a);this.l=document.createElement("div");this.l.style.backgroundColor="white";this.l.style.width="100%";this.l.style.height="100%";a.appendChild(this.l);this.u=[];var d=this,e=0,f=30;b&&b.Uh||c("\u00d7",null,!1,function(){d.tc()});b&&b.hh&&b.hh.forEach(function(a){c(a.title,a.Rh,!0,a.Ja)});this.ld=b&&b.ld||null;this.kd=b&&b.kd||null}
Xb.prototype.show=function(){this.u.forEach(function(a){this.i.appendChild(a)},this);this.l.innerHTML=this.w;this.b.style.display="block";rc(this);this.ld&&this.ld()};Xb.prototype.tc=function(){this.b.style.display="none";this.kd&&this.kd()};function rc(a){var b=a.i.getBoundingClientRect();a.i.style.marginLeft=-b.width/2+"px";a.i.style.marginTop=-b.height/2+"px"};function zc(a,b,c){try{eb(a.j,b,function(a){if(0>this.Ia.indexOf(a))if(1===this.Ia.length)this.ob([a]);else{var b=this.Ia.slice();b[0<=b.indexOf("vpl")?b.indexOf("vpl"):0<=b.indexOf("src")?b.indexOf("src"):0]=a;this.ob(b)}this.wg=!0;ec(this);0<=this.Ia.indexOf("vpl")&&this.ga.ta()},c)}catch(d){}}
function Bc(a,b){var c=/(\.[^.]*|)$/.exec(b.name)[0].slice(1).toLowerCase(),d=new window.FileReader;switch(c){case "aesl":case "vpl3":case "vpl3ui":case "json":return d.onload=function(d){d=d.target.result;var e=b.name,g=!1;"<"===d.trim()[0]?Sf(a.j,d):(g="vpl3ui"===c,zc(a,d,{Vg:g}));g||(a.j.filename=e);a.ga.ta()},d.readAsText(b),!0}return!1}
function eg(a,b){var c=/^[^.]+\.(.*)$/.exec(b.name);c=c?c[1]:"";var d=new window.FileReader;switch(c.toLowerCase()){case "svg":case "png":case "jpg":case "gif":return a.M&&("obstacle"===a.M.Hc?(d.onload=function(b){fg(a,b.target.result)},d.readAsText(b)):(d.onload=function(b){b=b.target.result;var c=new Image;c.addEventListener("load",function(){gg(a,c)});c.src=b},d.readAsDataURL(b))),!0}return!1}
function hg(a,b){var c=/^[^.]+\.(.*)$/.exec(b.name);c=c?c[1]:"";var d=new window.FileReader;switch(c.toLowerCase()){case "wav":a.M&&(d.onload=function(c){a.M.la.setFile(b.name,c.target.result)},d.readAsArrayBuffer(b))}};function ig(a,b){var c=this;this.b=document.createElement("div");this.b.style.width="100%";this.b.style.height="100%";this.b.style.position="fixed";this.b.style.top="0";this.b.style.left="0";this.b.style.zIndex="1000";this.b.style.backgroundColor="rgba(1,1,1,0.5)";this.b.style.display="none";this.i=document.createElement("div");this.i.style.width="40em";this.i.style.position="fixed";this.i.style.top="50%";this.i.style.left="50%";this.i.style.backgroundColor="white";this.i.style.padding="2em";this.b.appendChild(this.i);
document.body.appendChild(this.b);var d=document.createElement("p");this.w=d;this.i.appendChild(d);d=document.createElement("table");d.style.width="100%";this.i.appendChild(d);var e=document.createElement("tr");d.appendChild(e);var f=document.createElement("td");e.appendChild(f);this.input=document.createElement("input");this.input.setAttribute("type","file");this.input.style.width="35em";f.appendChild(this.input);f=document.createElement("td");f.align="right";e.appendChild(f);e=document.createElement("input");
e.setAttribute("type","button");e.setAttribute("value",a.l.translate("OK"));e.addEventListener("click",function(){var a=c.input.files[0];a&&c.l(a);c.tc()},!1);f.appendChild(e);f.appendChild(document.createTextNode("\u00a0\u00a0"));e=document.createElement("input");e.setAttribute("type","button");e.setAttribute("value",a.l.translate("Cancel"));e.addEventListener("click",function(){c.tc()},!1);f.appendChild(e);f=document.createElement("div");f.style.position="absolute";f.style.width="32px";f.style.height=
"32px";f.style.top="0";f.style.left="0";f.textContent="\u00d7";f.style.font="bold 30px sans-serif";f.style.textAlign="left";f.style.padding="5px";f.style.paddingLeft="10px";f.addEventListener("click",function(){c.tc()},!1);d.appendChild(f);this.u=a.l;this.l=null;this.ld=b&&b.ld||null;this.kd=b&&b.kd||null}
ig.prototype.show=function(a,b,c){this.w.textContent=this.u.translate(a);this.input.setAttribute("accept",b);this.l=c;this.b.style.display="block";a=this.i.getBoundingClientRect();this.i.style.marginLeft=-a.width/2+"px";this.i.style.marginTop=-a.height/2+"px";this.ld&&this.ld()};ig.prototype.tc=function(){this.b.style.display="none";this.kd&&this.kd()};function jg(a,b,c){this.b=a;this.l=b;this.rc=null;this.i=!1;this.sessionId=c;var d=this;setInterval(function(){null!=d.rc&&2<=d.rc.readyState&&(!1!==d.b.tf&&(d.b.tf=!1,Lb(d.b)),d.connect())},5E3)}function kg(a,b,c,d){a=a.b.I;if(a.aa(b)&&Db(a,b)&&a.isEnabled(b))if(void 0!==c){d=a.find(b);var e;if(e=d)d.w?c===d.Na()?e=!0:(Fb(d,void 0),e=c===d.Na()):e=!1;e&&Eb(a,b)}else if(void 0!==d)(c=a.find(b))&&Gb(c,d)&&Eb(a,b);else if(c=a.find(b))Fb(c,void 0),Eb(a,b)}
jg.prototype.connect=function(){var a=this;this.rc=new WebSocket(this.l);this.rc.addEventListener("open",function(){a.b.tf=!0;a.rc.send(JSON.stringify({sender:{type:"vpl",sessionid:a.sessionId,role:a.b.j.Vb?"teacher":"student"},type:"hello"}));window.addEventListener("unload",function(){a.rc.send(JSON.stringify({sender:{type:"vpl",sessionid:a.sessionId,role:a.b.j.Vb?"teacher":"student"},type:"bye"}))});Lb(a.b)});this.rc.addEventListener("message",function(b){function c(a,b,c){function d(c){return"<div style='display: table; height: 100%; width: 100%; overflow: hidden;'><div style='display: table-cell; vertical-align: middle; text-align: center;'>"+
("<img src='data:"+c+";base64,"+(b?a:btoa(a))+"' style='max-width:100%;max-height:100%;'>")+"</div></div>"}switch(c.toLowerCase()){case "html":case "htm":return b?atob(a):a;case "txt":return b&&(a=atob(a)),"<pre style='width: 100%; height: 100%; padding: 3em;'>"+a.replace(/&/g,"&amp;").replace(/</g,"&lt;")+"</pre>";case "md":return b&&(a=atob(a)),"<div style='width: 100%; height: 100%; padding: 3em;'>"+Ja(new Ia,a.split("\n"))+"</div>";case "gif":return d("image/gif");case "jpg":case "jpeg":return d("image/jpeg");
case "png":return d("image/png");case "svg":return d("image/svg+xml");default:return""}}try{var d=JSON.parse(b.data);"defaultfile"!==d.type||a.b.We||(d.type="file");window.vplListenToCom&&window.vplListenToCom(d);switch(d.type){case "cmd":kg(a,d.data.cmd,d.data.selected,d.data.state);xe(a.b.ga);break;case "file":var e=d.data.content,f=d.data.base64||!1,g=/(\.[^.]*|)$/.exec(d.data.name||"")[0].slice(1).toLowerCase();switch(d.data.kind){case "vpl":f&&(e=btoa(e));/^[\s]*{/.test(e)?zc(a.b,e,{Vg:"vpl3ui"===
g}):(Sf(a.b.j,e),a.b.ga.ta());"vpl3ui"!==g&&(a.b.j.filename=d.data.name||null);xe(a.b.ga);break;case "aseba":f&&(e=btoa(e));a.b.Fa[a.b.na].Pa.mc(e,"aseba");a.b.j.Qb=!1;break;case "about":Wb(a.b,c(e,f,g));break;case "help":Zb(a.b,c(e,f,g));break;case "settings":f&&(e=btoa(e));var h=JSON.parse(e);h.hasOwnProperty("volume")&&(a.b.j.volume=h.volume);break;case "statement":Zb(a.b,c(e,f,g),!0);xe(a.b.ga);break;case "suspend":jc(a.b,c(e,f,g))}break;case "robot":var m=d.data.robot,k=d.data.url||null,p=d.data.url||
null,n=d.data.uuid||null,t=d.data.pass||null;b=null;switch(m){case "thymio":k&&(b=lg(a.b,{Gh:k}),b.yc(b.$c));break;case "thymio-tdm":!p&&0<=a.b.na&&a.b.Fa[a.b.na].Pa.ka.qc&&(p=a.b.Fa[a.b.na].Pa.ka.qc);p&&(b=mg(a.b,{qc:p,Bh:n,jh:t}),b.yc(b.$c));break;case "sim":b=ng(a.b,{}),b.yc(b.$c)}b&&(kg(a,"vpl:stop"),0<=this.na&&this.Fa[this.na].Pa.stop(),a.b.Fa=[{name:m,Pa:b}],a.b.na=0,xe(a.b.ga));break;default:xe(a.b.ga)}}catch(q){console.info(q)}});this.i||(uc(this.b,function(b){a.log(b)}),this.i=!0)};
jg.prototype.log=function(a){try{if("cmd"===a.type&&a.data&&0<=["vpl:run","vpl:save","vpl:upload"].indexOf(a.data.cmd)){var b=db(this.b.j,{jd:!1,md:!0});this.rc.send(JSON.stringify({sender:{type:"vpl",sessionid:this.sessionId},type:"file",data:{name:this.b.j.filename,content:b},reason:a.data.cmd}))}this.rc.send(JSON.stringify({sender:{type:"vpl",sessionid:this.sessionId},type:"log",data:a||null}))}catch(c){}};function Nb(){this.b=[]}function Ob(a){function b(a){0<c.b.length&&c.b[c.b.length-1](a)&&a.preventDefault()}var c=a;window.addEventListener("keydown",function(a){b(a)});window.addEventListener("message",function(a){a.origin===window.origin&&b(a.data)},!1)}function Tb(a,b){a.b.push(b)}function Yb(a,b){a.b.push(function(a){return"Escape"===a.key?(b(),!0):!1})}function og(a,b){var c=a.b.pop();Tb(a,function(a){return c(a)||b(a)})};function pd(a,b){this.w=a;this.v=b.Sh||"";this.se=b.se;this.b=0;this.i=this.v.length;this.u=null;this.l=[];this.G=b.display||function(){};this.S=b.finish||function(){};var c=this;Tb(this.w.S,function(a){if(a.ctrlKey||a.metaKey)return!1;switch(a.key){case "Escape":c.finish(!1);break;case "Enter":c.finish(!0);break;case "ArrowLeft":c.i>c.b?(c.i=c.b,c.display()):0<c.b&&(c.b--,c.i=c.b,c.display());break;case "ArrowRight":c.i>c.b?(c.b=c.i,c.display()):c.b<c.v.length&&(c.b++,c.i=c.b,c.display());break;
case "Backspace":c.i>c.b?(c.v=c.v.slice(0,c.b)+c.v.slice(c.i),c.i=c.b,c.display()):0<c.b&&(c.v=c.v.slice(0,c.b-1)+c.v.slice(c.b),c.b--,c.i=c.b,c.display());break;case "Delete":c.i>c.b?(c.v=c.v.slice(0,c.b)+c.v.slice(c.i),c.i=c.b,c.display()):c.b<c.v.length&&(c.v=c.v.slice(0,c.b)+c.v.slice(c.b+1),c.display());break;default:/^\w{2,}$/.test(a.key)||(c.v=c.v.slice(0,c.b)+a.key+c.v.slice(c.i),c.b+=a.key.length,c.i=c.b,c.display())}return!0})}pd.prototype.display=function(){this.G(this.v,this.b,this.i)};
pd.prototype.finish=function(a){this.S(a?this.v:null);this.w.S.b.pop()};function sd(a,b,c){a.u=b;a.l=c};function Pb(a){this.l=a;this.ha=0;this.S=1;this.za=0;this.Y=1;this.i=Rb;this.G=this.u=this.b=0;this.Qa=Rb;this.w=this.vb=0}var Rb="",Ed="tb1",Gd="tb2",ud="bl",wd="br",vd="blp",xd="brp",I="r",Hd="ll",Md="lr",jd={ti:Rb,zi:Ed,yi:Gd,di:ud,fi:wd,ei:vd,gi:xd,vi:I,ri:Hd,si:Md};function pg(a){switch(a.i){case I:return a.l.j.j[a.b];case ud:return a.l.j.j[a.b].X[a.u];case wd:return a.l.j.j[a.b].actions[a.u];default:return null}}
function qg(a){switch(a.i){case vd:return a.l.j.j[a.b].X[a.u];case xd:return a.l.j.j[a.b].actions[a.u];default:return null}}function rg(a){switch(a.i){case Hd:return Ad(a.l,!1,a.b+a.S*a.u);case Md:return Ad(a.l,!0,a.b+a.Y*a.u);default:return null}}function Uc(a){switch(a.Qa){case I:return a.l.j.j[a.vb];case ud:return a.l.j.j[a.vb].X[a.w]||a.l.j.j[a.vb];case wd:return a.l.j.j[a.vb].actions[a.w]||a.l.j.j[a.vb];default:return null}}
function sg(a,b){if(b=b?a.l.u:a.l.G){for(var c=0,d=0;d<b.length;d++)if(b[d]&&"!"!==b[d][0]&&Sc(a.l,b[d])){var e=a.l.I.find(b[d]);(e.b||e.i)&&c++}return c}return 0}function Fd(a){switch(a.i){case Ed:var b=a.l.G;break;case Gd:b=a.l.u;break;default:return null}for(var c=a.b,d=0;d<b.length;d++)if(b[d]&&"!"!==b[d][0]&&Sc(a.l,b[d])){var e=a.l.I.find(b[d]);if(e.b||e.i){if(0===c)return e;c--}}return null}
function Id(a,b){var c=Uc(a),d=a.l;c instanceof C&&(a.Qa===ud?"a"===b.type:"e"===b.type||"s"===b.type)&&(c=c.Db,a.Qa=I);c instanceof ua&&!(c instanceof Ba)?(b=new C(b,null,null),c.Ub(b,null,function(){d.j.zb()},function(){ab(d.j)})):c instanceof C&&(b=new C(b,null,null),c.Db.Ub(b,{dd:a.Qa===ud,index:a.w},function(){d.j.zb()},function(){ab(d.j)}));Ya(d.j)}function Vc(a,b){if(b.b)b.b(a.l,!1);else{var c=Uc(a);(c&&b.l?b.l(a.l,{data:c}):b.i)&&b.i(a.l,{data:c})}}
function Ub(a){og(a.l.S,function(b){function c(){return a.l.j.j[a.b].X.length+(Za(a.l.j)?0:1)}function d(){return a.l.j.j[a.b].actions.length+1}function e(){var b=pg(a)||rg(a);b instanceof C?a.l.w=b.T.name:b instanceof z?a.l.w=b.name:a.l.w=null}if(a.l.W.sb)return!1;switch(b.key){case "Escape":switch(a.i){case ud:case wd:a.Qa==a.i&&a.vb==a.b&&a.w==a.u?a.Qa=Rb:a.i=I;break;case vd:a.i=ud;break;case xd:a.i=wd;break;default:a.i=Rb,a.Qa=Rb}e();Lb(a.l);return!0;case "Enter":switch(a.i){case Rb:a.i=I;a.b=
0;a.Qa=I;a.vb=0;break;case I:b=pg(a);b instanceof Ba?Dc(a.l,a.b):(a.i=ud,a.u=0);break;case ud:case wd:b=pg(a);b instanceof C&&b.T.ja&&(a.i=a.i===ud?vd:xd,a.G=0);break;case Ed:case Gd:b=Fd(a),null!=b&&Vc(a,b)}e();Lb(a.l);return!0;case " ":switch(a.i){case ud:case wd:a.Qa=a.i;a.vb=a.b;a.w=a.u;break;case vd:case xd:var f=qg(a);null!=f.T.ja&&(b=f.T.ja.controls[a.G],b.l&&b.l(f));break;case I:a.Qa=a.i;a.vb=a.b;a.u=0;break;case Hd:case Md:b=rg(a),Id(a,b)}e();Lb(a.l);return!0;case "Backspace":b=pg(a);switch(a.i){case I:case ud:case wd:if(a.l.I.fb("vpl:trashcan",
{data:b})){a.l.I.nb("vpl:trashcan",{data:b});switch(a.i){case I:a.b>=a.l.j.j.length&&a.b--;break;case ud:0<a.u&&a.u+1>=c()&&a.u--;break;case wd:0<a.u&&a.u+1>=d()&&a.u--}a.Qa=Rb;e();Lb(a.l)}}return!0;case "ArrowRight":switch(a.i){case I:if(null===a.Qa||a.Qa===I)a.Qa=I,a.vb=a.b;a.i=Md;a.b=0;a.u=0;break;case Hd:a.u<Math.floor(a.ha/a.S)-(a.b<a.ha%a.S?0:1)?a.u++:(a.i=I,a.b=0);break;case Md:a.u=Math.min(a.u+1,Math.floor(a.za/a.Y)-(a.b<a.za%a.Y?0:1));break;case ud:a.u+1>=c()?(a.i=wd,a.u=0):a.u++;break;case wd:a.u<
d()-1?a.u++:a.i=I;break;case vd:case xd:f=qg(a);null!=f.T.ja&&(b=f.T.ja.controls[a.G],b.i&&b.i(f));break;case Ed:a.b=Math.min(a.b+1,sg(a,!1)-1);break;case Gd:a.b=Math.min(a.b+1,sg(a,!0)-1)}e();Lb(a.l);return!0;case "ArrowLeft":switch(a.i){case I:if(null===a.Qa||a.Qa===I)a.Qa=I,a.vb=a.b;a.i=Hd;a.b=0;a.u=Math.ceil(a.ha/a.S)-1;break;case Hd:a.u=Math.max(a.u-1,0);break;case Md:0<a.u?a.u--:(a.i=I,a.b=0);break;case ud:0<a.u?a.u--:a.i=I;break;case wd:0===a.u?(a.i=ud,a.u=c()-1):a.u--;break;case vd:case xd:f=
qg(a);null!=f.T.ja&&(b=f.T.ja.controls[a.G],b.b&&b.b(f));break;case Ed:a.b=Math.max(a.b-1,0);break;case Gd:a.b=Math.max(a.b-1,0)}e();Lb(a.l);return!0;case "ArrowUp":switch(a.i){case I:0===a.b?0<sg(a,!1)&&(a.i=Ed,a.b=0):a.b=Math.max(a.b-1,0);break;case ud:case wd:0===a.b?0<sg(a,!1)&&(a.i=Ed,a.b=0):(a.b=Math.max(a.b-1,0),a.u=Math.min(a.u,(a.i===ud?c():d())-1));break;case Hd:case Md:a.b=Math.max(a.b-1,0);break;case vd:case xd:f=qg(a);null!=f.T.ja&&(b=f.T.ja.controls[a.G],b.i&&b.i(f));break;case Gd:a.i=
I,a.b=Math.max(a.l.j.j.length-1,0)}e();Lb(a.l);return!0;case "ArrowDown":switch(a.i){case I:a.b>=a.l.j.j.length-1?0<sg(a,!0)&&(a.i=Gd,a.b=0):a.b=Math.min(a.b+1,a.l.j.j.length-1);break;case ud:case wd:a.b>=a.l.j.j.length-1?0<sg(a,!0)&&(a.i=Gd,a.b=0):(a.b=Math.min(a.b+1,a.l.j.j.length-1),a.l.j.j[a.b]instanceof Ba?a.i=I:a.u=Math.min(a.u,(a.i===ud?c():d())-1));break;case Hd:a.b=Math.min(a.b+1,(a.u<Math.floor(a.ha/a.S)?a.S:a.ha%a.S)-1);break;case Md:a.b=Math.min(a.b+1,(a.u<Math.floor(a.za/a.Y)?a.Y:a.za%
a.Y)-1);break;case vd:case xd:f=qg(a);null!=f.T.ja&&(b=f.T.ja.controls[a.G],b.b&&b.b(f));break;case Ed:a.i=I,a.b=0}e();Lb(a.l);return!0;case "Tab":switch(a.i){case vd:case xd:f=qg(a),null!=f.T.ja&&(f=f.T.ja.controls.length,a.G=(a.G+(b.shiftKey?f-1:1))%f)}e();Lb(a.l);return!0}return!1})}
function id(a,b,c){function d(a){return a.bottom-a.top>a.right-a.left?c<(a.top+a.bottom)/2:b>(a.left+a.right)/2}a=Uc(a);if(a instanceof C){var e=a.T.ja;if(void 0!=e)for(var f=0;f<e.controls.length;f++){var g=e.controls[f];if(b>=g.left&&b<=g.right&&c>=g.top&&c<=g.bottom){g.u?g.u(a,(b-g.left)/(g.right-g.left),(c-g.top)/(g.bottom-g.top)):g.l?g.l(a):g.b&&!d(g)?g.b(a):g.i&&d(g)&&g.i(a);break}}}};var pe=null;document.addEventListener("mousemove",function(a){null!==pe&&(pe(a,!1,!1),a.preventDefault())},!1);document.addEventListener("mouseup",function(a){null!==pe&&(pe(a,!0,!1),pe=null,a.preventDefault())},!1);var ue=null;document.addEventListener("touchmove",function(a){null!==pe&&(ue=a.targetTouches[0],pe(ue,!1,!0),a.preventDefault());return!1},{capture:!1,passive:!1});document.addEventListener("touchend",function(a){null!==pe&&(pe(ue,!0,!0),pe=null,a.preventDefault());return!1},!1);
function tg(a,b,c,d,e){var f=0<=a.indexOf("/")?a.replace(/\/[^/]*$/,"/"):"",g={},h=new XMLHttpRequest;h.addEventListener("load",function(){if(200===h.status){g[a]=h.responseText;var b=JSON.parse(h.responseText),k=c(b),p=k.length,n=!1;k.forEach(function(c){var h=new XMLHttpRequest;h.addEventListener("load",function(){200===h.status?(g[c]=h.responseText,p--,n||0!==p||d(b,g)):n||(n=!0,e("HTTP error "+h.status))});h.addEventListener("error",function(){n||(n=!0,e("XMLHttpRequest error for "+a))});h.open("GET",
f+c);h.send()})}else e("HTTP error "+h.status)});h.addEventListener("error",e);h.open("GET",a);h.send()}
function ug(a,b,c,d,e){function f(a){var b=document.getElementById(a);if(null==b)throw"Missing script element "+a;return b.textContent}try{var g=f(a),h=JSON.parse(g),m={};h.svgFilenames&&h.svgFilenames.forEach(function(a){g=f(a);m[a]=g});h.overlays&&h.overlays.forEach(function(a){g=f(a);m[a]=g});h.css&&h.css.forEach(function(a){g=f(a).trim();m[a]=g});if(h.doc)for(var k in h.doc)if(h.doc.hasOwnProperty(k))for(var p in h.doc[k])h.doc[k].hasOwnProperty(p)&&(g=f(h.doc[k][p]).trim(),m[h.doc[k][p]]=g);
d(h,m)}catch(n){e(n)}}function vg(a){var b="";window.vplQueryOptions?b=window.vplQueryOptions:b=(b=/^[^?]*\?([^#]*)/.exec(document.location.href))&&b[1];if(b){b=b.split("&").map(function(a){return a.split("=").map(function(a){return decodeURIComponent(a)})});for(var c=0;c<b.length;c++)if(b[c][0]===a)return b[c][1]}return""}
function wg(a){return(document.location.hash||"#").slice(1).split("&").map(function(a){return a.split("=").map(decodeURIComponent)}).reduce(function(a,c){a[c[0]]=c[1];return a},{})[a]||null}
function xg(a,b){var c=[];a&&a.overlays&&a.overlays.forEach(function(b){try{var d=JSON.parse(a.Wd[b])}catch(A){console.error(A.message)}for(var e in d)if(d.hasOwnProperty(e))switch(e){case "blocks":case "blockList":case "aeslImportRules":case "buttons":case "widgets":a[e]=a[e]?a[e].concat(d[e]):d[e];break;case "toolbars":for(var f in d[e])d[e].hasOwnProperty(f)&&(a[e]=a[e]||{},a[e][f]=d[e][f]);break;case "i18n":for(f in d[e])if(d[e].hasOwnProperty(f)){a[e]=a[e]||{};a[e][f]=a[e][f]||{};for(var g in d[e][f])d[e][f].hasOwnProperty(g)&&
(a[e][f][g]=d[e][f][g])}break;case "help":c.push(d[e])}});var d=document.getElementById("programCanvas"),e=vg("role"),f=vg("shortcuts"),g=new Hb(d);f&&(g.W.l="true"===f);g.W.u=0<=vg("accessibility").split("+").indexOf("kbd");g.W.i=0<=vg("accessibility").split("+").indexOf("nodrag");g.pd=void 0==window.vplSimMaps?"ground,height,obstacles":"merged"===window.vplSimMaps?null:window.vplSimMaps.split(",");window.vplApp=g;g.username=vg("user")||window.vplUsername||g.username;Sb(g);a&&wc&&(g.j.message=wc(a),
g.j.message&&window.console.info(g.j.message));a&&a.css&&(g.ia.G(),a.css.forEach(function(b){Pd(g.ia,b,a.Wd[b])}),g.ia.defineProperties());if(a&&a.i18n)for(var h in a.i18n)a.i18n.hasOwnProperty(h)&&Ga(g.l,h,a.i18n[h]);d=vg("uilanguage")||"en";g.l.language=d;g.Ke=new ig(g,g.W.l?{ld:function(){Yb(g.S,function(){g.Ke.tc()})},kd:function(){g.S.b.pop()}}:null);window.vplStorageSetFunction&&(g.j.w=function(){var a=db(window.vplApp.j);window.vplStorageSetFunction("program.vpl3",a)});h=void 0==a||a["hardcoded-gui"]||
"classic"===vg("appearance");g.Lg="local"===vg("storage");g.me="false"!==vg("multiview");var m=vg("language");me="true"===vg("cssdebug");var k=cc,p=Rc,n=Zc;if(a){if(h)null!==a.blocks&&0<a.blocks.length&&(a.blocks||[]).forEach(function(a){var b=ta(a.name);jf(a,b.Rb);a.typicalParamSet&&(b.Te=a.typicalParamSet)});else if(null!==a.buttons&&0<a.buttons.length&&(k=ag(a),p=bg(a)),null!==a.widgets&&0<a.widgets.length&&(n=cg(a)),null!==a.blocks&&0<a.blocks.length)try{Kf(a)}catch(ja){window.console&&window.console.error(ja)}if(a.blockList){var t=
[];H.forEach(function(a){"h"===a.type&&t.push(a)});a.blockList.forEach(function(a){t.push(ta(a))});H=t}a.aeslImportRules&&0<a.aeslImportRules.length&&(ma=a.aeslImportRules.map(function(a){return{Fh:a.aeslName,Sa:a.condition||null,Jh:a.blockName,parameters:a.parameters||null,zh:a.stringParam||!1}}));a.miscSettings&&void 0!=a.miscSettings.advancedModeEnabled&&(Ta=1==a.miscSettings.advancedModeEnabled);a.miscSettings&&void 0!=a.miscSettings.basicMultiEvent&&(Qa=1==a.miscSettings.basicMultiEvent);a.miscSettings&&
void 0!=a.miscSettings.advancedMultiEvent&&(Sa=1==a.miscSettings.advancedMultiEvent);a.miscSettings&&a.miscSettings.viewRelativeSizes&&(d=a.miscSettings.viewRelativeSizes,g.Xe={vpl:d.vpl||1,src:d.src||1,sim:d.sim||1})}d=vg("server");f=vg("session");var q="true"===vg("adv"),l="true"===vg("exp");Ta="true"===vg("advmode");var v=0,r=0,E="",u=vg("blur").trim()||"";/^\d+$/.test(u)&&(v=parseInt(u,10)/10);u=vg("grayscale")||"";/^\d+$/.test(u)&&(r=parseInt(u,10)/100);if(0<v||0<r)E="blur("+v.toFixed(1)+"px) grayscale("+
r.toFixed(2)+")";v=1;r=0;u=!1;var w=null;u=vg("scale").trim()||"";/^\d+(\.\d*)?$/.test(u)&&(v=parseFloat(u));u=vg("rotation").trim()||"";/^-?\d+(\.\d*)?$/.test(u)&&(r=parseFloat(u)*Math.PI/180);u=vg("mirror").trim()||"";u="true"===u;if(1!==v||0!==r||u)w=[v*Math.cos(r)*(u?-1:1),v*Math.sin(r)*(u?-1:1),-v*Math.sin(r),v*Math.cos(r),0,0];m||(m=0<=g.na?g.Fa[g.na].Pa.$c:"aseba");Ua();Xa(g.j,!0);g.j.Ne();v=vg("view");u=0===v.length?["vpl"]:v.split("+");r=vg("robot");if(0<=u.indexOf("sim")||"sim"===r)r="sim";
r.replace(/[+;]/g,",").split(",").forEach(function(a){var b=null;switch(a){case "thymio":b=lg(g);b.yc(m);break;case "thymio-tdm":b=mg(g);b.yc(m);break;case "thymio-jws":b=yg(g);b.yc(m);break;case "sim":b=ng(g,{Sg:E,Tg:w}),b.yc(m)}b&&g.Fa.push({name:a,Pa:b})});g.na=0<g.Fa.length?0:-1;if(!qa[m])throw"Unsupported language "+m;Da(g.W,q?[]:["src:language"]);g.j.xb=m;g.ga.Y=n;null!=g.i&&(g.i.Y=n);yc(g);!h&&a&&a.toolbars&&(a.toolbars.vpl&&(g.G=a.toolbars.vpl),a.toolbars.vpl2&&(g.u=a.toolbars.vpl2));g.j.Zd=
k;g.j.Se=p;Wf&&document.getElementById("editor")&&(g.N=new Wf(g,g.j.ra,m),ve(g.N.Ta,E),g.j.u=function(){return Xf(g.N)?null:g.N.xc()},g.j.G=function(a){mc(g.N,a)},g.N.Ta.Y=n,$f(g),!h&&a&&a.toolbars&&a.toolbars.editor&&(g.N.Fg=a.toolbars.editor),g.N.Zd=k,g.N.Se=p,g.N.Vb="teacher"===e);null!=g.M&&(zg(g),!h&&a&&a.toolbars&&a.toolbars.simulator&&(g.M.Fg=a.toolbars.simulator),g.M.Zd=k,g.M.Se=p);E&&ve(g.ga,E);we(g.ga,w);document.getElementsByTagName("body")[0].addEventListener("dragover",function(a){a.stopPropagation();
a.preventDefault();a.dataTransfer.dropEffect="copy"},!1);document.getElementsByTagName("body")[0].addEventListener("drop",function(a){a.stopPropagation();a.preventDefault();a=a.dataTransfer.files;1===a.length&&(a=a[0],Bc(g,a)||eg(g,a)||hg(g,a))},!1);if(g.M){g.M.W=g.W;var D=new Image;D.addEventListener("load",function(){g.M.Ff=D});D.src="data:image/svg+xml;base64,"+btoa('<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="297mm" height="210mm" viewBox="0 0 1052 744" version="1.1"><defs><linearGradient id="gradient" x1="-1000" y1="0" x2="-800" y2="0" gradientUnits="userSpaceOnUse"><stop style="stop-color:#000;stop-opacity:1;" offset="0" /><stop style="stop-color:#000;stop-opacity:0;" offset="1" /></linearGradient></defs><g transform="translate(0,-308)"><rect style="fill:url(#gradient);stroke:none" width="319" height="687" x="-1027" y="336" transform="scale(-1,1)" /><path style="fill:none;stroke:#000;stroke-width:30;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none" d="M 114,592 C 102,417 750,306 778,532 806,757 674,675 559,622 444,568 259,567 278,664 296,762 726,730 778,808 829,887 725,955 616,936 507,917 144,1083 129,837 Z" /></g></svg>');
var R=new Image;R.addEventListener("load",function(){g.M.Gf=R});R.src="data:image/svg+xml;base64,"+btoa('<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" width="297mm" height="210mm" viewBox="0 0 1052 744" version="1.1"><defs><radialGradient id="gradient" cx="400" cy="650" fx="400" fy="650" r="230" gradientTransform="matrix(1.6,0,0,1.16,-113,-75)" gradientUnits="userSpaceOnUse"><stop style="stop-color:#000;stop-opacity:1;" offset="0" /><stop style="stop-color:#000;stop-opacity:0;" offset="1" /></radialGradient></defs><g transform="translate(0,-308)"><rect style="fill:url(#gradient);fill-opacity:1;stroke:none" width="939" height="650" x="54" y="357" /></g></svg>');
g.M.Hf='<?xml version="1.0" encoding="UTF-8"?><svg xmlns="http://www.w3.org/2000/svg" width="297mm" height="210mm" viewBox="0 0 1052 744" version="1.1"><g transform="translate(0,-308)"><path style="fill:none;stroke:#000;stroke-width:6;stroke-linecap:butt;stroke-linejoin:miter" d="M 172,928 137,420 763,371 905,688 708,981 Z" /><path style="fill:none;stroke:#949494;stroke-width:6;stroke-linecap:butt;stroke-linejoin:miter" d="m 402,754 168,91 101,-142" /><circle style="fill:none;stroke:#000;stroke-width:6" cx="531" cy="550" r="59" /></g></svg>'}Vb(g,
!0);if(window.vplStorageGetFunction)window.vplStorageGetFunction("program.vpl3",function(a,b){try{a&&(g.j.filename=b&&b.filename||"program.vpl3",g.j.readOnly=void 0!=b&&1==b.readOnly,void 0!=b&&1==b.customizationMode&&(g.W.sb=!0,g.W.cc="teacher"===e),eb(g.j,a,function(){ec(g);Lb(g)}),g.We=!0)}catch(O){}});else if(g.Lg)try{var Q=window.localStorage.getItem("program.vpl3");Q&&eb(g.j,Q,function(){ec(g);Lb(g)})}catch(ja){}"text"===vg("view")?g.ob(["src"],{ra:!0}):(g.ob(["vpl"]),g.j.Zg=l,g.j.Vb="teacher"===
e?"t":"teacher1"===e?"custb":La,Lb(g),g.N&&(document.getElementById("editor").textContent=g.j.xc(g.j.xb)));var Fa=["aseba","l2","asm","js","python"];g.N&&0<=Fa.indexOf(m)&&Yf(g.N,function(){m=Fa[(Fa.indexOf(m)+1)%Fa.length];g.j.xb=m;var a=g.j.xc(m);return{language:m,code:a}});if(q&&g.N){var oa=new vb(wb);g.N.Ge=function(a,b){try{switch(a){case "aseba":var c=new xb(oa,b);c.S=yb;var d=zb(c);return Ag(b,d,c.nc);case "l2":return c=new Bg(oa,b),c.S=Cg,d=zb(c),Ag(b,d,c.nc);case "asm":return d=Dg(new Eg(oa,
b)),Ab(d);default:return null}}catch(Oa){return"; "+Oa}}}a&&a.fragments&&a.fragments["about.html"]&&Wb(g,a.fragments["about.html"].replace(/UIROOT/g,b));a&&a.fragments&&a.fragments["help.html"]&&Zb(g,a.fragments["help.html"].replace(/UIROOT/g,b));if(a&&a.help||0<c.length){g.Y=new Ia;a&&a.help&&g.Y.add(a.help);g.Xa={};if(a&&a.doc)for(var xa in a.doc)a.doc.hasOwnProperty(xa)&&a.Wd[a.doc[xa]["doctemplate.html"]]&&(g.Xa[xa]=a.Wd[a.doc[xa]["doctemplate.html"]]);c.forEach(function(a){g.Y.add(a)});ec(g)}a&&
a.fragments&&a.fragments["vpl-export-html.css"]&&(g.za=a.fragments["vpl-export-html.css"]);oc(g);xe(g.ga);window.addEventListener("resize",function(){oc(g)},!1);g.M&&(g.M.Vb="teacher"===e);if("text"===v)g.ob(["src"],{ra:!0});else{b=["vpl","src","sim"];if(1>u.length||3<u.length||""===v)v="vpl";else for(Q=0;Q<u.length;Q++){if(0>!b.indexOf(u[Q])){v="vpl";break}for(xa=0;xa<Q;xa++)if(u[Q]===u[xa]){v="vpl";break}}g.ob(u)}oc(g);d&&(window.vplCommandServer=new jg(g,d,f),window.vplCommandServer.connect(),
window.vplSendToCom=function(a){window.vplCommandServer.rc.send(JSON.stringify({sender:{type:"vpl",sessionid:window.vplCommandServer.sessionId},type:"client",data:a||null}))})}
window.addEventListener("load",function(){if(Fg&&wb){var a=new Fg;if(a.Gd!==wb.maxVarSize)throw"internal: vm var size mismatch";if(a.La.length!==wb.variables.length)throw"internal: vm var count mismatch";for(var b=0;b<a.La.length;b++)if(a.La[b].name!==wb.variables[b].name||a.La[b].$.length!==wb.variables[b].size)throw"internal: vm var mismatch";if(a.Kc.length!==wb.localEvents.length)throw"internal: vm ev count mismatch";for(b=0;b<a.Kc.length;b++)if(a.Kc[b].name!==wb.localEvents[b].name)throw"internal: vm var mismatch";
if(a.Pb.length!==wb.nativeFunctions.length)throw"internal: vm nat fun count mismatch";for(b=0;b<a.Kc.length;b++)if(a.Pb[b].name!==wb.nativeFunctions[b].name)throw"internal: vm nat fun mismatch";}a=vg("ui")||"ui.json";b=null!=document.getElementById(a);var c=window.vplUIRoot?window.vplUIRoot:b?".":0<=a.indexOf("/")?a.replace(/\/[^/]*$/,""):".";(b?ug:tg)(a,c,function(a){var b=(a.svgFilenames||[]).concat(a.overlays||[]).concat(a.css||[]);if(a.doc)for(var c in a.doc)if(a.doc.hasOwnProperty(c))for(var d in a.doc[c])a.doc[c].hasOwnProperty(d)&&
b.push(a.doc[c][d]);return b},function(a,b){a.Wd={};a.Fb={};a.svgFilenames&&a.svgFilenames.forEach(function(c){a.Wd[c]=b[c];a.Fb[c]=new xf(b[c])});a.overlays&&a.overlays.forEach(function(c){a.Wd[c]=b[c]});a.css&&a.css.forEach(function(c){a.Wd[c]=b[c]});if(a.doc)for(var d in a.doc)if(a.doc.hasOwnProperty(d))for(var e in a.doc[d])a.doc[d].hasOwnProperty(e)&&(a.Wd[a.doc[d][e]]=b[a.doc[d][e]]);xg(a,c)},function(a){window.console&&window.console.error(a);xg()})},!1);
window.vplIsProgramChanged=function(){return 0<window.vplApp.j.qd.Ec.length};window.vplGetProgramAsJSON=function(a){return db(window.vplApp.j,a?{jd:!0,md:!1}:void 0)};window.vplGetUIAsJSON=function(){return db(window.vplApp.j,{jd:!0,md:!1})};window.vplConvertToHTML=function(a,b){var c=window.vplApp;a=JSON.parse(a);bb(c.j,a);b=b?Cc(c,c.ia,!0):Ac(c,c.ia);c.j.ag();return b};window.vplConvertMDToHtml=function(a){return Ja(new Ia,a.split("\n"))};
window.addEventListener("unload",function(){var a=db(window.vplApp.j);try{window.vplStorageSetFunction?window.vplStorageSetFunction("program.vpl3",a):window.vplApp.Lg&&window.localStorage.setItem("program.vpl3",a)}catch(b){}},!1);function Gg(){this.Xd=1}Gg.prototype.reset=function(){};Gg.prototype.resetEventListeners=function(){};Gg.prototype.set=function(){};Gg.prototype.get=function(){return null};Gg.prototype.setClientState=function(){};Gg.prototype.getClientState=function(){return null};Gg.prototype.addEventListener=function(){};Gg.prototype.sendEvent=function(){};Gg.prototype.start=function(){this.sendEvent("init",null)};Gg.prototype.setTimer=function(){};Gg.prototype.getTimer=function(){return-1};
Gg.prototype.loadCode=function(){};Gg.prototype.shouldRunContinuously=function(){return!1};Gg.prototype.run=function(){};Gg.prototype.suspend=function(){};Gg.prototype.resume=function(){};function P(){this.Xd=1;this.za={Z:-Infinity,oa:Infinity,ba:-Infinity,pa:Infinity};this.u=this.Y=0;this.r=70;this.b=[0,0];this.i=0;this.Pf=!1;this.files={};this.pb=120;this.ec=80;this.Ld=20;this.state={};this.S={};this.Xa=null;this.sd={};this.l=[];this.ha={};this.Rc=!1;this.G=null;P.prototype.reset.call(this,0);P.prototype.resetEventListeners.call(this)}P.prototype=Object.create(Gg.prototype);P.prototype.constructor=P;P.prototype.setPositionLimits=function(a,b,c,d){this.za={Z:a,oa:b,ba:c,pa:d}};
P.prototype.setFile=function(a,b){this.files[a]=b};
P.prototype.reset=function(a){this.u=this.Y=a;this.b=[0,0];this.i=0;this.state={"button.center":!1,"button.left":!1,"button.right":!1,"button.forward":!1,"button.backward":!1,"prox.ground.delta":[1,1],"prox.horizontal":[0,0,0,0,0,0,0],acc:[0,0,1],"motor.left":0,"motor.right":0,"leds.top":[0,0,0],"leds.bottom.left":[0,0,0],"leds.bottom.right":[0,0,0],"leds.circle":[0,0,0,0,0,0,0,0],sound:{}};this.Rc=!1;var b=this;this.S={"leds.circle":function(){b.Rc=!0},sound:function(a,d){function c(){if(!(g>=d.f.length)){b.G||
(b.G=new (window.AudioContext||window.webkitAudioContext));var a=b.G.createOscillator();a.type="sawtooth";a.frequency.value=d.f[g];var e=b.G.createGain();e.connect(b.G.destination);a.connect(e);a.start(0);var f=d.d[g]/50;e.gain.exponentialRampToValueAtTime(.01,b.G.currentTime+f);a.stop(b.G.currentTime+f);a.addEventListener("ended",c);g++}}if(d.hasOwnProperty("pcm")){if(a=b.files["P"+d.pcm+".wav"]){b.G||(b.G=new (window.AudioContext||window.webkitAudioContext));var f=b.G;f.decodeAudioData(a.slice(),
function(a){var b=f.createBufferSource();b.buffer=a;b.connect(f.destination);b.start(0)})}}else if(d.f){var g=0;c()}}};this.l=[];this.Oc=!1};P.prototype.resetEventListeners=function(){this.ha={}};P.prototype.enforcePositionLimits=function(){this.b=[Math.max(this.za.Z,Math.min(this.za.oa,this.b[0])),Math.max(this.za.ba,Math.min(this.za.pa,this.b[1]))]};P.prototype.setPosition=function(a,b){this.b=a;this.i=b;this.enforcePositionLimits();this.Xa&&this.Xa.call(this)};
P.prototype.set=function(a,b){this.state[a]=b;this.S[a]&&this.S[a](a,b)};P.prototype.get=function(a){return this.state[a]};P.prototype.setClientState=function(a,b){this.sd[a]=b};P.prototype.getClientState=function(a){a=this.sd[a];a instanceof Array&&(a=a.slice());return a};P.prototype.addEventListener=function(a,b){this.ha[a]=b};P.prototype.sendEvent=function(a,b){this.ha[a]&&this.ha[a].call(this,a,b);for(var c in this.ha)if(0===c.indexOf(a+"."))this.ha[c](a,b)};
P.prototype.setTimer=function(a,b,c,d){this.l[a]={name:b,next:this.u-this.Y+c,kh:d?c:-1}};P.prototype.getTimer=function(a){return void 0===this.l[a]||0>this.l[a].next?-1:this.Y+this.l[a]-this.u};P.prototype.loadCode=function(a,b){if("js"!==a)throw"unsupported language "+a;(new Function(b)).call(this)};
P.prototype.shouldRunContinuously=function(){if(this.Oc)return!1;if(0!==this.get("motor.left")||0!==this.get("motor.right"))return!0;for(var a=0;a<this.l.length;a++)if(this.l[a]&&0<this.l[a].next)return!0;return!1};function Hg(a,b){return a.Pf?b*Math.sqrt(-2*Math.log(Math.random()))*Math.sin(2*Math.PI*Math.random()):0}
P.prototype.run=function(a,b){0===this.Y&&this.reset(a);1!==this.Xd&&(this.Y-=(this.Xd-1)*(a-this.u),this.u=this.Xd*(this.u-a)+a);for(var c=Math.max(.01,(a-this.u)/10),d=this.b;!this.Oc&&this.u<a;){c=Math.min(c,a-this.u);var e=(100*this.get("motor.left")+Hg(this,1))*c,f=(100*this.get("motor.right")+Hg(this,1))*c;if(0!==e||0!=f){if(1E-6>Math.abs(e-f)||Math.abs(e-f)<1E-4*(Math.abs(e)+Math.abs(f)))this.b=[this.b[0]+.5*(e+f)*Math.cos(this.i),this.b[1]+.5*(e+f)*Math.sin(this.i)];else{var g=(e+f)*this.r/
(e-f);e=(f-e)/(2*this.r);this.b=[this.b[0]+g*(Math.sin(this.i)-Math.sin(this.i+e)),this.b[1]-g*(Math.cos(this.i)-Math.cos(this.i+e))];this.i+=e}this.enforcePositionLimits();this.Xa&&this.Xa.call(this)}this.u+=c;for(g=0;g<this.l.length;g++)this.l[g]&&0<this.l[g].next&&this.u>=this.Y+this.l[g].next+Hg(this,.01)&&(this.l[g].next=0<=this.l[g].kh?this.l[g].next+this.l[g].kh:-1,this.sendEvent(this.l[g].name,null))}b&&b("l",d.concat(this.b))};P.prototype.suspend=function(){this.Oc=!0};
P.prototype.resume=function(a){this.Oc&&(this.Y+=a-this.u,this.u=a,this.Oc=!1)};var Ig="shift left;shift right;add;sub;mult;div;mod;bitor;bitxor;bitand;eq;ne;gt;ge;lt;le;or;and".split(";");function Jg(a,b){function c(a){return 32784<=a?a-65536:a}function d(a){return 2048<=a?a-4096:a}var e=[],f=a[0];if(0<a.length){if(1!==f%2||f>a.length)throw"Bad event table";e.push({fc:0,Vd:a.slice(0,1),Rf:-1,v:"dc "+a[0]})}for(var g=[],h=1;h<f;h+=2)g.push({id:a[h],fc:a[h+1]}),e.push({fc:h,Vd:a.slice(h,h+2),Rf:-1,v:"dc 0x"+a[h].toString(16)+", "+a[h+1]});for(h=f;h<a.length;h++){f={fc:h,Vd:a.slice(h,h+1),Rf:a[h]>>>12};if(!b)for(var m=0;m<g.length;m++)if(g[m].fc===h){f.id="onevent_"+g[m].id.toString(16);
break}m=a[h];switch(m>>>12){case 0:f.v="stop";break;case 1:f.v="push.s "+((m&4095)-(m&2048?4096:0));break;case 2:f.Vd=a.slice(h,h+2);f.v="push "+c(a[++h]);break;case 3:f.v="load "+(m&4095);break;case 4:f.v="store "+(m&4095);break;case 5:f.Vd=a.slice(h,h+2);f.v="load.ind "+(m&4095)+" size="+a[++h];break;case 6:f.Vd=a.slice(h,h+2);f.v="store.ind "+(m&4095)+" size="+a[++h];break;case 7:case 8:switch(m){case 28672:f.v="neg";break;case 28673:f.v="abs";break;case 28674:f.v="bitnot";break;case 28675:f.v=
"not ; not implemented";break;case 32768:f.v="sl";break;case 32769:f.v="asr";break;case 32770:f.v="add";break;case 32771:f.v="sub";break;case 32772:f.v="mult";break;case 32773:f.v="div";break;case 32774:f.v="mod";break;case 32775:f.v="bitor";break;case 32776:f.v="bitxor";break;case 32777:f.v="bitand";break;case 32778:f.v="eq";break;case 32779:f.v="ne";break;case 32780:f.v="gt";break;case 32781:f.v="ge";break;case 32782:f.v="lt";break;case 32783:f.v="le";break;case 32784:f.v="or";break;case 32785:f.v=
"and";break;default:throw"Unknown instruction "+m.toString(16);}break;case 9:f.v="jump "+(h+d(m&4095));break;case 10:f.Vd=a.slice(h,h+2);f.v=(m&256?m&512?"dont.":"do.":"")+"jump."+(m&256?"when":"if")+".not "+Ig[m&31]+" "+(h+c(a[h+1]));h++;break;case 11:f.v="emit id="+(m&4095)+" data="+c(a[h+1])+" count="+c(a[h+2]);h+=2;break;case 12:f.v="callnat "+(m&4095);break;case 13:f.v="callsub "+(m&4095);break;case 14:f.v="ret";break;default:throw"Unknown instruction "+m.toString(16);}e.push(f)}return e}
function Ab(a,b){var c=Jg(a).map(function(c){var d=c.fc.toString(10);d="    ".slice(d.length-1)+d;var f=c.Vd.map(function(a){a=a.toString(16);return"000".slice(a.length-1)+a}).join(" ");f+="     ".slice(f.length-4);return(c.id?c.id+":\n":"")+(b?"    ":d+"  "+f+"  ")+c.v+(c.fc===a[0]-2||0===c.Rf||14===c.Rf?"\n":"")}).join("\n");0===c.length&&(c="; empty");return c};function Ag(a,b,c){function d(a){var b=e[a].fc.toString(10);b="    ".slice(b.length-1)+b;var c=e[a].Vd.map(function(a){a=a.toString(16);return"000".slice(a.length-1)+a}).join(" ");c+="     ".slice(c.length-4);f+=(e[a].id?e[a].id+":\n":"")+b+"  "+c+"  "+e[a].v+"\n";e.splice(a,1)}var e=Jg(b,!0);a=a.split("\n");c=c.slice().sort(function(a,b){return a.fc-b.fc});c=[new Kg(-1,-1,-1,0)].concat(c).concat(new Kg(Infinity,Infinity,Infinity,b.length));var f="";for(b=0;b<a.length;b++){for(var g=!1,h=0;h<c.length-
1;)if(c[h].line<=b){for(var m=c[h].fc;m<c[h+1].fc;m++)for(var k=0;k<e.length;)e[k].fc===m?(!g&&0<b&&(f+="\n"),g=!0,d(k)):k++;c.splice(h,1)}else h++;g&&(f+="\n");f+=a[b]+"\n"}for(k=0;k<e.length;)d(k);return f};function vb(a){this.name=a.name;this.b=a.maxVarSize;this.La=[];for(var b=this.Wa=0;b<a.variables.length;b++)this.La.push(new Lg(a.variables[b].name,a.variables[b].size,[1],this.Wa,Mg)),this.Wa+=a.variables[b].size;this.Pb=a.nativeFunctions.map(function(a,b){return{id:b,name:a.name,D:a.args}});this.Kc=a.localEvents.map(function(a){return{name:a.name}})}function Ng(a,b){for(var c=0;c<a.Pb.length;c++)if(a.Pb[c].name===b)return a.Pb[c];return null}
function Og(a,b){for(var c=0;c<a.La.length;c++)if(a.La[c].name===b)return a.La[c];return null}function Pg(a,b){if("init"===b)return 65535;for(var c=0;c<a.Kc.length;c++)if(a.Kc[c].name===b)return 65534-c;throw"unknown local event "+b;}function xb(a,b){this.pb=Qg;this.Ld=!1;this.Ba=a;this.i=b;this.w=b.length;this.J=0;this.line=1;this.Ra=0;this.F=[];this.o=0;this.b=[];this.Pg=[];this.S=[];this.G={};this.hb=[];this.za=[];this.Ab=this.ec=this.Ba.b;this.rg=!1;this.Va=0;this.nc=[]}
function Lg(a,b,c,d,e){this.name=a;this.size=b;this.B=c;this.offset=d;this.resultType=e}Lg.prototype.Rd=function(a,b){return[12288|this.offset+(b||0)]};Lg.prototype.Nf=function(a,b){return[16384|this.offset+(b||0)]};Lg.prototype.hf=function(){return[20480|this.offset,this.size]};Lg.prototype.og=function(){return[24576|this.offset,this.size]};
xb.prototype.wh=function(){for(;this.J<this.w;)if(" "===this.i[this.J]||"\t"===this.i[this.J])this.J++,this.Ra++;else if("\n"===this.i[this.J])this.J++,this.Ra=0,this.line++;else if("\r"===this.i[this.J])this.J++;else if("#*"===this.i.slice(this.J,this.J+2))for(this.J+=2,this.Ra+=2;this.J<this.w&&"*#"!==this.i.slice(this.J-2,this.J);)"\n"===this.i[this.J]?(this.Ra=0,this.line++):"\r"!==this.i[this.J]&&this.Ra++,this.J++;else if("#"===this.i[this.J])for(;this.J<this.w&&"\n"!==this.i[this.J];)this.J++,
this.Ra++;else break};function Rg(a,b){a.za.push(b.length-1)}function Sg(a,b,c){if(0===a.za.length)throw"internal";void 0===c&&(c=b.length);a=a.za.pop();b[a]=36864===b[a]?b[a]+(c-a&4095):c-a+1&65535}xb.prototype.Rc=function(a,b,c,d,e){var f;a:{for(f=0;f<this.hb.length;f++)if(this.hb[f].name===a){f=!0;break a}for(f=0;f<this.Ba.La.length;f++)if(this.Ba.La[f].name===a){f=!0;break a}f=!1}if(f)throw'duplicate variable declaration "'+a+'"';this.hb.push(new Lg(a,b,c,d,e))};
function Tg(a,b){for(var c=a.hb.length-1;0<=c;c--)if(a.hb[c].name===b.name)return a.hb[c];for(c=0;c<a.Ba.La.length;c++)if(a.Ba.La[c].name===b.name)return a.Ba.La[c];throw"unknown variable "+b.name+" "+S(b.head);}function Ug(a,b){for(var c=0;c<a.S.length;c++)if(a.S[c].name===b)return a.S[c];return null}function Vg(a,b){a.Ab-=b;return a.Ab}xb.prototype.Xa=function(){return[]};var Wg="== != <= >= |= ^= &= *= /= %= += -= <<= >>= ++ -- ( ) [ ] - ~ * / % + << >> & ^ | > < = , : abs and callsub call const do elseif else emit end for if in not onevent or return step sub then var when while".split(" ");
function Xg(a,b,c){this.Yd=a;this.Ed=b;this.Cd=c}function S(a){return"line "+a.Ed.toString()+" col "+a.Cd.toString()}function Yg(a,b,c,d){Xg.call(this,a,b,c);this.n=d}Yg.prototype=Object.create(Xg.prototype);Yg.prototype.constructor=Yg;function Zg(a,b,c,d){Xg.call(this,a,b,c);this.n=d}Zg.prototype=Object.create(Yg.prototype);Zg.prototype.constructor=Zg;function $g(a,b,c,d){Xg.call(this,a,b,c);this.name=d}$g.prototype=Object.create(Xg.prototype);$g.prototype.constructor=$g;
function ah(a,b,c,d){Xg.call(this,a,b,c);this.name=d}ah.prototype=Object.create(Xg.prototype);ah.prototype.constructor=ah;
xb.prototype.gg=function(a){for(;;){a:{var b=(b=a)||Wg;this.wh();if(this.J>=this.w)var c=null;else{for(var d=0;d<b.length;d++)if(c=b[d].length,this.i.slice(this.J,this.J+c)===b[d]&&!/[a-zA-Z0-9_.]{2}/.test(this.i.slice(this.J+c-1,this.J+c+1))){b=new ah(this.J,this.line,this.Ra,b[d]);this.J+=c;this.Ra+=c;c=b;break a}c=0;if("0x"===this.i.slice(this.J,this.J+2)){for(this.J+=2;this.J+c<this.w&&/[0-9a-fA-F]/.test(this.i[this.J+c]);)c++;if(0===c)throw"hexadecimal number syntax error";b=parseInt(this.i.slice(this.J,
this.J+c),16);b=new Yg(this.J,this.line,this.Ra,b);this.J+=c;this.Ra+=2+c}else if("0b"===this.i.slice(this.J,this.J+2)){for(this.J+=2;this.J+c<this.w&&/[01]/.test(this.i[this.J+c]);)c++;if(0===c)throw"binary number syntax error";b=parseInt(this.i.slice(this.J,this.J+c),2);b=new Yg(this.J,this.line,this.Ra,b);this.J+=c;this.Ra+=2+c}else if(/[0-9]/.test(this.i[this.J])){for(;this.J+c<this.w&&/[0-9]/.test(this.i[this.J+c]);)c++;if(this.Ld&&this.J+c<this.w&&"."===this.i[this.J+c]){for(c++;this.J+c<this.w&&
/[0-9]/.test(this.i[this.J+c]);c++);b=parseFloat(this.i.slice(this.J,this.J+c));b=new Zg(this.J,this.line,this.Ra,b)}else b=parseInt(this.i.slice(this.J,this.J+c),10),b=new Yg(this.J,this.line,this.Ra,b);this.J+=c;this.Ra+=c}else if(/[a-zA-Z_]/.test(this.i[this.J])){for(;this.J+c<this.w&&/[a-zA-Z0-9_.]/.test(this.i[this.J+c]);)c++;if(0===c)throw"name syntax error";b=new $g(this.J,this.line,this.Ra,this.i.slice(this.J,this.J+c));this.J+=c;this.Ra+=c}else throw"syntax error line "+this.line.toString()+
" col "+this.Ra.toString();c=b}}if(null===c)break;this.F.push(c)}};function Kg(a,b,c,d){this.yh=a;this.line=b;this.Ra=c;this.fc=d}function bh(a,b,c){(b=b.head||b.children[0]&&b.children[0].head)&&a.nc.push(new Kg(b.Yd,b.Ed,b.Cd,void 0===c?a.Va:c))}function V(a){this.head=a;this.children=[];this.wb=0;this.resultType=ch;this.Ib=!0}function dh(a,b){for(var c=0;c<a.length;c++)a[c]=a[c].K(b)}V.prototype.K=function(){return this};V.prototype.$a=function(a){this.children.forEach(function(b){b.$a(a)})};
V.prototype.w=function(a){this.$a(a);for(var b=0;b<this.children.length;b++)this.children[b]=this.children[b].w(a);return this};function eh(a,b){V.call(this,a);this.n=void 0===b?this.head.n:b;this.resultType=Mg}eh.prototype=Object.create(V.prototype);eh.prototype.constructor=eh;eh.prototype.$a=function(){this.wb=1};function fh(a){a&=65535;return 32768<=a?a-65536:a}function gh(a,b){eh.call(this,a,b);this.resultType=hh}gh.prototype=Object.create(eh.prototype);gh.prototype.constructor=gh;
function ih(a){V.call(this,a);this.name=a.name;this.b=!1}ih.prototype=Object.create(V.prototype);ih.prototype.constructor=ih;ih.prototype.$a=function(a){a.G.hasOwnProperty(this.name)?(this.wb=1,this.resultType=a.G[this.name].resultType):(a=Tg(a,this),this.wb=a.size,this.resultType=a.resultType)};ih.prototype.K=function(a){return a.G.hasOwnProperty(this.name)?a.G[this.name].resultType===hh?new gh(this.head,a.G[this.name].$):new eh(this.head,a.G[this.name].$):this};
function jh(a){var b=new ih(a.head);b.resultType=a.resultType;b.b=!0;return b}var ch="?",Mg="n",hh="fx";function kh(a,b,c,d){V.call(this,a);this.type=b;this.resultType=c?c.resultType:ch;this.Ka=c;this.children=d||[]}kh.prototype=Object.create(V.prototype);kh.prototype.constructor=kh;
kh.prototype.$a=function(a){V.prototype.$a.call(this,a);for(var b=1,c=0;c<this.children.length;c++)if(1===b)b=this.children[c].wb;else if(1!==this.children[c].wb&&this.children[c].wb!==b)throw"incompatible sizes "+S(this.head);this.wb=b;this.Ka&&this.Ka.Aa&&(this.resultType=this.Ka.Aa(a,this,this.children.map(function(a){return a.resultType})))};kh.prototype.K=function(a){this.children=this.children.map(function(b){return b.K(a)});return this.Ka&&this.Ka.K?this.Ka.K(this,a):this};
kh.prototype.w=function(a){var b=V.prototype.w.call(this,a);if(b.type===W&&b.Ka.priority===lh&&(b.children[1]instanceof mh||b.children[1]instanceof ih&&1!==b.children[1].wb)){var c=b.children[0];if(!(c instanceof ih)||b.Ib)throw"bad array assignment "+S(b.head);for(var d=b.children[1],e=new nh(b.head),f=0;f<d.wb;f++){var g=c;1<d.wb&&(g=new oh(c.head,[new eh(c.head,f)]),g.resultType=c.resultType);if(d instanceof mh)var h=d.children[f];else h=new oh(d.head,[new eh(c.head,f)]),h.resultType=d.resultType;
g=new kh(b.head,b.type,b.Ka,[g,h]);g.resultType=c.resultType;g.Ib=!1;g=g.K(a);e.children.push(g)}return e}return b};function oh(a,b){ih.call(this,a);this.children=b}oh.prototype=Object.create(ih.prototype);oh.prototype.constructor=oh;oh.prototype.$a=function(a){V.prototype.$a.call(this,a);a=Tg(a,this);this.wb=1;this.resultType=a.resultType};function ph(a){for(var b=0;b<a.children.length;b++)if(!(a.children[b]instanceof eh))return!1;return!0}
function qh(a,b){for(var c=0,d=1,e=0;e<a.children.length;e++){if(!(a.children[e]instanceof eh))throw"internal";c+=d*a.children[e].n;d*=b.B[e]}return c}function mh(a){V.call(this,a);this.B=[]}mh.prototype=Object.create(V.prototype);mh.prototype.constructor=mh;mh.prototype.$a=function(a){this.wb=this.children.length;this.children[0]&&(this.children.forEach(function(b){b.$a(a)}),this.resultType=this.children[0].resultType)};function X(a,b){V.call(this,a);this.type=b||rh;this.ha=!1;this.Za=[null]}
X.prototype=Object.create(V.prototype);y=X.prototype;y.constructor=X;y.sg=function(){throw"internal";};y.mh=function(){};y.oh=function(){throw"internal";};y.nh=function(){};y.re=function(){};function sh(a,b){b.Ab=b.ec;bh(b,a)}var rh=1;function th(a,b){this.b=a;this.ya=b}th.prototype.A=function(){return"internal"};function uh(a,b){X.call(this,a,2);this.Jf=b}uh.prototype=Object.create(X.prototype);uh.prototype.constructor=uh;uh.prototype.K=function(a){dh(this.children,a);return this};
uh.prototype.sg=function(){return this};function vh(a,b){X.call(this,a,2);this.Ah=b}vh.prototype=Object.create(X.prototype);vh.prototype.constructor=vh;vh.prototype.K=function(a){dh(this.children,a);return this};vh.prototype.sg=function(){return this};function wh(a){X.call(this,a)}wh.prototype=Object.create(X.prototype);wh.prototype.constructor=wh;function xh(a,b,c){X.call(this,a);this.b=b;this.$=c;this.resultType=c.resultType}xh.prototype=Object.create(X.prototype);xh.prototype.constructor=xh;
function yh(a,b,c,d,e){X.call(this,a);this.S=b.name;this.resultType=c;this.b=d||null;this.size=-1;this.B=[];this.offset=-1;e&&this.children.push(e)}yh.prototype=Object.create(X.prototype);yh.prototype.constructor=yh;yh.prototype.$a=function(a){this.children[0]&&(V.prototype.$a.call(this,a),this.resultType=this.children[0].children[1].resultType)};yh.prototype.K=function(a){dh(this.children,a);return this};function zh(a){X.call(this,a.head);this.children.push(a)}zh.prototype=Object.create(X.prototype);
zh.prototype.constructor=zh;zh.prototype.K=function(a){dh(this.children,a);return this};function nh(a){X.call(this,a)}nh.prototype=Object.create(X.prototype);nh.prototype.constructor=nh;nh.prototype.K=function(a){dh(this.children,a);return this};function Ah(a,b){X.call(this,a,3);this.b=[b];this.i=[];this.l=[]}Ah.prototype=Object.create(X.prototype);y=Ah.prototype;y.constructor=Ah;y.$a=function(a){this.b.forEach(function(b){b.$a(a)});this.i.forEach(function(b){b.forEach(function(b){b.$a(a)})})};
y.K=function(a){dh(this.b,a);this.i.forEach(function(b){dh(b,a)});return this};y.oh=function(a){if(this.i.length>=this.b.length)throw"multiple else "+S(a.head);a instanceof Bh&&this.b.push(a.Sa);this.i.push(this.children);this.l.push(a);this.children=[];this.Za.push(a.Za[0])};
y.re=function(a,b){this.i.push(this.children);this.children=[];this.l.push(b);for(a=0;a<this.b.length;)if(this.b[a]instanceof eh)if(0===this.b[a].n)this.b.splice(a,1),this.i.splice(a,1);else{this.b.splice(a);this.i.splice(a+1);break}else a++};function Bh(a,b){X.call(this,a,4);this.Sa=b}Bh.prototype=Object.create(X.prototype);Bh.prototype.constructor=Bh;Bh.prototype.K=function(a){this.Sa=this.Sa.K(a);dh(this.children,a);return this};function Ch(a){X.call(this,a,4)}Ch.prototype=Object.create(X.prototype);
Ch.prototype.constructor=Ch;function Dh(a,b){X.call(this,a,3);this.Sa=b}Dh.prototype=Object.create(X.prototype);Dh.prototype.constructor=Dh;Dh.prototype.$a=function(a){V.prototype.$a.call(this,a);this.Sa.$a(a)};Dh.prototype.K=function(a){this.Sa=this.Sa.K(a);dh(this.children,a);return this};function Eh(a,b){X.call(this,a,3);this.Sa=b;this.b=[]}Eh.prototype=Object.create(X.prototype);Eh.prototype.constructor=Eh;Eh.prototype.$a=function(a){V.prototype.$a.call(this,a);this.Sa.$a(a)};
Eh.prototype.K=function(a){this.Sa=this.Sa.K(a);dh(this.children,a);return this};Eh.prototype.re=function(a,b){this.Sa instanceof eh&&(0===this.Sa.n&&(this.children=[]),this.Sa=null);this.b.push(b)};function Fh(a,b,c,d,e){X.call(this,a,3);this.l=new ih(b);this.children.push(c);this.children.push(d);this.b=e||null;this.i=[]}Fh.prototype=Object.create(X.prototype);Fh.prototype.constructor=Fh;Fh.prototype.$a=function(a){V.prototype.$a.call(this,a);this.b&&this.b.$a(a)};
Fh.prototype.K=function(a){this.b&&(this.b=this.b.K(a));dh(this.children,a);return this};Fh.prototype.re=function(a,b){this.i.push(b)};function Gh(a,b,c){X.call(this,a);this.name=b;this.children=c}Gh.prototype=Object.create(X.prototype);Gh.prototype.constructor=Gh;Gh.prototype.K=function(a){dh(this.children,a);return this};function Hh(a,b){X.call(this,a);this.name=b}Hh.prototype=Object.create(X.prototype);Hh.prototype.constructor=Hh;function Ih(a){X.call(this,a,5)}Ih.prototype=Object.create(X.prototype);
Ih.prototype.constructor=Ih;var lh=30,W=1;function Y(a,b,c){this.name=a;this.type=b;this.priority=c&&c.priority||0;this.resultType=c&&c.resultType||(c&&c.Aa?ch:Mg);this.Aa=c&&c.Aa||null;this.K=c&&c.K||null;this.P=c&&c.P||[];this.A=c&&c.A||null}function Jh(a,b){for(var c=[],d=0;d<a.children.length;d++){if(!(a.children[d]instanceof eh))return a;c.push(a.children[d].n)}return new eh(a.head,fh(b(c)))}
var Qg=[new Y("--",0,{priority:150}),new Y("++",0,{priority:150}),new Y("-",0,{priority:150,K:function(a){return Jh(a,function(a){return-a[0]})},P:[28672]}),new Y("~",0,{priority:150,K:function(a){return Jh(a,function(a){return~a[0]})},P:[28674]}),new Y("abs",0,{priority:150,K:function(a){return Jh(a,function(a){return Math.abs(a[0])})},P:[28673]}),new Y("not",0,{priority:150,resultType:"b",K:function(a){return Jh(a,function(a){return 0==a[0]?1:0})},P:[4096,32778]}),new Y("size",0,{priority:150,K:function(a,
b){var c=0<a.children[0].wb?a.children[0].wb:a.children[0]instanceof mh?a.children[0].children.length:-1;if(0>c&&a.children[0]instanceof ih)for(var d=b.hb.length-1;0<=d;d--)if(b.hb[d].name===a.children[0].name){c=b.hb[d].size;break}return 0<c?new eh(a.head,c):a}}),new Y("--",2,{priority:150}),new Y("++",2,{priority:150}),new Y("+=",W,{priority:lh}),new Y("-=",W,{priority:lh}),new Y("*=",W,{priority:lh}),new Y("/=",W,{priority:lh}),new Y("%=",W,{priority:lh}),new Y("<<=",W,{priority:lh}),new Y(">>=",
W,{priority:lh}),new Y("&=",W,{priority:lh}),new Y("|=",W,{priority:lh}),new Y("^=",W,{priority:lh}),new Y("*",W,{priority:140,K:function(a){return Jh(a,function(a){return a[0]*a[1]})},P:[32772]}),new Y("/",W,{priority:140,K:function(a){return Jh(a,function(a){return Math.trunc(a[0]/a[1])})},P:[32773]}),new Y("%",W,{priority:140,K:function(a){return Jh(a,function(a){return a[0]%a[1]})},P:[32774]}),new Y("+",W,{priority:130,K:function(a){return Jh(a,function(a){return a[0]+a[1]})},P:[32770]}),new Y("-",
W,{priority:130,K:function(a){return Jh(a,function(a){return a[0]-a[1]})},P:[32771]}),new Y("<<",W,{priority:120,K:function(a){return Jh(a,function(a){return a[0]<<a[1]})},P:[32768]}),new Y(">>",W,{priority:120,K:function(a){return Jh(a,function(a){return a[0]>>a[1]})},P:[32769]}),new Y("==",W,{priority:80,resultType:"b",K:function(a){return Jh(a,function(a){return a[0]===a[1]?1:0})},P:[32778]}),new Y("!=",W,{priority:80,resultType:"b",K:function(a){return Jh(a,function(a){return a[0]!==a[1]?1:0})},
P:[32779]}),new Y("<",W,{priority:80,resultType:"b",K:function(a){return Jh(a,function(a){return a[0]<a[1]?1:0})},P:[32782]}),new Y("<=",W,{priority:80,resultType:"b",K:function(a){return Jh(a,function(a){return a[0]<=a[1]?1:0})},P:[32783]}),new Y(">",W,{priority:80,resultType:"b",K:function(a){return Jh(a,function(a){return a[0]>a[1]?1:0})},P:[32780]}),new Y(">=",W,{priority:80,resultType:"b",K:function(a){return Jh(a,function(a){return a[0]>=a[1]?1:0})},P:[32781]}),new Y("&",W,{priority:110,K:function(a){return Jh(a,
function(a){return a[0]&a[1]})},P:[32777]}),new Y("|",W,{priority:90,K:function(a){return Jh(a,function(a){return a[0]|a[1]})},P:[32775]}),new Y("^",W,{priority:100,K:function(a){return Jh(a,function(a){return a[0]^a[1]})},P:[32776]}),new Y("and",W,{priority:60,resultType:"b",K:function(a){return Jh(a,function(a){return a[0]&&a[1]?1:0})},P:[32785]}),new Y("or",W,{priority:50,resultType:"b",K:function(a){return Jh(a,function(a){return a[0]||a[1]?1:0})},P:[32784]}),new Y("=",W,{priority:lh})];
function Kh(a,b,c){for(var d=0;d<a.pb.length;d++)if(a.pb[d].type===c&&a.pb[d].name===b)return a.pb[d];return null}function Lh(a,b,c){return a.F[a.o+b]instanceof c}function Z(a,b,c){return a.F[a.o+b]instanceof ah&&a.F[a.o+b].name===c}y=xb.prototype;y.bh=function(a){return new kh(a,4,null)};
function Mh(a,b){b=b||10;if(Lh(a,0,Zg)){var c=new gh(a.F[a.o]);a.o++}else if(Lh(a,0,Yg))c=new eh(a.F[a.o]),a.o++;else if(Lh(a,0,$g))Z(a,1,"(")?(c=a.bh(a.F[a.o]),a.o++,Z(a,1,")")?a.o+=2:c.children=Nh(a)):(c=new ih(a.F[a.o]),a.o++);else if(Z(a,0,"(")){a.o++;c=Mh(a,20);if(!Z(a,0,")"))throw"subexpression in expression "+S(a.F[a.o]);a.o++}else if(Z(a,0,"[")){c=new mh(a.F[a.o]);a.o++;var d=[];for(var e=0,f=0,g=0;;){d.push(Mh(a,25));0===g&&f++;g++;if(1<f&&g>e)throw"non-rectangular array "+S(a.F[a.o]);g>
e&&(e=g);if(Lh(a,0,ah))if(a.o++,"]"===a.F[a.o-1].name)break;else if(","===a.F[a.o-1].name)continue;else if(";"===a.F[a.o-1].name){e=g;g=0;continue}throw"array "+S(a.F[a.o-1]);}for(g=0;g<e;g++)for(var h=0;h<f;h++)c.children.push(d[h*e+g])}else if(Lh(a,0,ah)&&(d=Kh(a,a.F[a.o].name,0)))c=new kh(a.F[a.o],0,d),a.o++,c.children.push(Mh(a,150)),d.Aa&&(c.resultType=d.Aa(a,c,[c.children[0].resultType]));else if(Lh(a,0,ah)&&(d=Kh(a,a.F[a.o].name,3)))c=new kh(a.F[a.o],3,d),a.o++;else{if(a.o<a.F.length)throw"unexpected token in expression "+
S(a.F[a.o]);throw"unexpected end of file";}for(;Lh(a,0,ah);)if((d=Kh(a,a.F[a.o].name,2))&&d.priority>=b)c=new kh(a.F[a.o],2,d,[c]),a.o++;else if((d=Kh(a,a.F[a.o].name,W))&&(b===lh?d.priority>=b:d.priority>b))c=new kh(a.F[a.o],W,d,[c]),a.o++,c.children.push(Mh(a,d.priority)),d.Aa&&(c.resultType=d.Aa(a,c,c.children.map(function(a){return a.resultType})));else if("["===a.F[a.o].name){if(!(c instanceof ih))throw"unexpected indexing";d=c.resultType;e=Nh(a,!0);c=new oh(c.head,e);c.resultType=d}else break;
return c}function Nh(a,b){var c=[];if(!Z(a,0,b?"[":"("))throw"left "+(b?"bracket":"parenthesis")+" expected";for(a.o++;;){var d=Mh(a,25);c.push(d);if(!Lh(a,0,ah))throw"syntax error in arguments";if(Z(a,0,b?"]":")")){a.o++;break}else if(Z(a,0,","))a.o++;else throw"syntax error in arguments "+S(a.F[a.o]);}return c}
y.ih=function(){if(this.o>=this.F.length)throw"no more tokens";if(this.F[this.o]instanceof ah){var a=this.F[this.o];switch(a.name){case "const":if(!Lh(this,1,$g)||!Z(this,2,"="))throw'syntax error for "const" '+S(a);var b=this.F[this.o+1];this.o+=3;var c=Mh(this);c=c.K(this);if(!(c instanceof eh))throw"non-constant expression in constant definition "+S(this.F[this.o]);return[new xh(a,b.name,c)];case "var":if(!Lh(this,1,$g))throw'unexpected token after "var" '+S(a);b=this.F[this.o+1];this.o+=2;if(Lh(this,
0,ah))switch(this.F[this.o].name){case "[":if(Z(this,1,"]")){this.o+=2;if(!Z(this,0,"="))throw"missing size or initial value in array declaration"+S(this.F[this.o-2]);c=new kh(this.F[this.o],W,Kh(this,"=",W),[new ih(b)]);this.o++;c.children.push(Mh(this));c.resultType=c.children[1].resultType;c.Ib=!1;var d=new kh(new ah(c.head.Yd,c.head.Ed,c.head.Cd,"size"),0,Kh(this,"size",0),[c.children[1]]);return[new yh(a,b,c.resultType,[d],c)]}this.o++;d=Mh(this);if(!Z(this,0,"]"))throw"array size syntax error"+
S(this.F[this.o]);this.o++;return Z(this,0,"=")?(c=new kh(this.F[this.o],W,Kh(this,"=",W),[new ih(b)]),this.o++,c.children.push(Mh(this)),c.resultType=c.children[1].resultType,c.Ib=!1,c=c.K(this),[new yh(a,b,c.resultType,[d],c)]):[new yh(a,b,ch,[d])];case "=":return c=new kh(this.F[this.o],W,Kh(this,"=",W),[new ih(b)]),this.o++,c.children.push(Mh(this)),c.resultType=c.children[1].resultType,c.Ib=!1,c=c.K(this),[new yh(a,b,c.resultType,null,c)]}return[new yh(a,b,ch)];case "if":case "elseif":this.o++;
c=Mh(this);if(!Z(this,0,"then"))throw'"then" expected after "if" statement '+S(this.F[this.o]);this.o++;return["if"===a.name?new Ah(a,c):new Bh(a,c)];case "when":this.o++;c=Mh(this);if(!Z(this,0,"do"))throw'"do" expected after "when" statement '+S(this.F[this.o]);this.o++;return[new Dh(a,c)];case "while":this.o++;c=Mh(this);if(!Z(this,0,"do"))throw'"do" expected after "while" statement '+S(this.F[this.o]);this.o++;return[new Eh(a,c)];case "for":if(!Lh(this,1,$g)||!Z(this,2,"in"))throw'"for" syntax error '+
S(a);b=this.F[this.o+1];this.o+=3;c=Mh(this);if(!Z(this,0,":"))throw'range expected in "for" statement '+S(this.F[this.o]);this.o++;d=Mh(this);var e=null;Z(this,0,"step")&&(this.o++,e=Mh(this));if(!Z(this,0,"do"))throw'"do" expected after "for" statement '+S(this.F[this.o]);this.o++;return[new Fh(a,b,c,d,e)];case "end":return this.o++,[new Ih(a)];case "call":if(!Lh(this,1,$g))throw'"call" syntax error '+S(a);b=this.F[this.o+1];this.o+=2;return Z(this,0,"(")?[new Gh(a,b.name,Nh(this))]:[new Gh(a,b.name,
[])];case "callsub":if(!Lh(this,1,$g))throw'"callsub" syntax error '+S(a);b=this.F[this.o+1];this.o+=2;return[new Hh(a,b.name)];case "else":return this.o++,[new Ch(a)];case "onevent":if(!Lh(this,1,$g))throw'unexpected token after "onevent" '+S(a);b=this.F[this.o+1];this.o+=2;return[new uh(a,b.name)];case "return":return this.o++,[new wh(a)];case "sub":if(!Lh(this,1,$g))throw'unexpected token after "sub" '+S(a);b=this.F[this.o+1];this.o+=2;return[new vh(a,b.name)]}}c=Mh(this);c instanceof kh&&(c.Ib=
!1);c=c.K(this);return[new zh(c)]};y.qh=function(){};y.ph=function(){};
y.uf=function(a){if(a instanceof xh){a.$=a.$.K(this);if(!(a.$ instanceof eh))throw"constant definition "+S(a.head);this.G[a.b]={$:a.$.n,resultType:a.$.resultType}}else a instanceof yh&&(a.size=1,a.B=[],a.b&&(a.b=a.b.map(function(b){b=b.K(this);if(!(b instanceof eh)||0>=b.n)throw"array variable size "+S(a.head);a.size*=b.n;a.B.push(b.n);return b},this)),a.offset=this.Wa,a.children[0]&&(a.resultType=a.children[0].resultType),this.Wa+=a.size,this.Rc(a.S,a.size,a.B,a.offset,a.resultType))};y.te=function(){};
y.Ga=function(){};y.getContext=function(){return null};y.Qg=function(){this.Wa=this.Ba.Wa;for(var a=0;a<this.b.length;a++)this.uf(this.b[a])};function Oh(a,b,c){switch(b.type){case 3:c.push(a.getContext());a.Ga(b.Za[0]);break;case 4:a.Ga(b.Za[0]);break;case 5:a.Ga(c.pop())}}
function Ph(a){function b(){if(1<f.length){var a=f[f.length-1].head;throw"unterminated "+a.name+" "+S(a);}c.l.push(f[0])}var c=a,d=[];a.Qg();a.te();d=[];a.b.forEach(function(a){Oh(this,a,d);a.$a(this)},a);a.te();d=[];for(var e=0;e<a.b.length;e++)Oh(a,a.b[e],d),a.b[e]=a.b[e].K(a);a.te();d=[];for(e=0;e<a.b.length;e++)Oh(a,a.b[e],d),a.b[e]=a.b[e].w(a);a.l=[];var f=[new uh(null,"init")];a.te();for(e=0;e<a.b.length;e++)switch(a.b[e].type){case rh:a.b[e].re(a,a.b[e]);f[f.length-1].children.push(a.b[e]);
break;case 2:a.Ga(a.b[e].Za[0]);b();f=[a.b[e].sg()];break;case 3:a.Ga(a.b[e].Za[0]);a.b[e].mh(a);f.push(a.b[e]);break;case 4:a.Ga(a.b[e].Za[0]);f[f.length-1].oh(a.b[e]);break;case 5:if(2>f.length)throw"unexpected end "+S(a.b[e].head);a.Ga(a.b[e].Za[0]);f[f.length-1].nh(a.b[e]);var g=f.pop();a.Ga(a.b[e].Za[a.b[e].Za.length-1]);g.re(a,a.b[e]);f[f.length-1].children.push(g);break;default:throw"not implemented "+a.b[e].type;}b()}y.rh=function(){};y.$g=function(){return null};
V.prototype.A=function(a){for(var b=[],c=a.Va,d=0;d<this.children.length;d++)b=b.concat(this.children[d].A(a)),a.Va=c+b.length;return b};function Qh(a){return-2048<=a&&2048>a?[4096|a&4095]:[8192,a&65535]}eh.prototype.A=function(){return this.Ib?Qh(this.n):[]};ih.prototype.A=function(a){return this.b?[]:a.G.hasOwnProperty(this.name)?Qh(a.G[this.name].$):Tg(a,this).Rd(a)};
kh.prototype.A=function(a){function b(b,d,e,f){function g(b,g){f===c.vg&&(h=h.concat(b.Rd(a,g)));e&&(h=h.concat(b.Rd(a,g)));h=h.concat(d.A(a)).concat(a.Xa(d.resultType,b.resultType)).concat(b.Nf(a,g));f===c.qf&&(h=h.concat(b.Rd(a,g)))}var h=[];if(b instanceof oh){var k=Tg(a,b);if(ph(b)){b=qh(b,k);if(b>=k.size)throw"index out of range";g(k,b)}else if(f!==c.bg||e){var l=Vg(a,1);h=h.concat(Rh(b,a)).concat(16384|l);f===c.vg&&(h=h.concat(12288|l).concat(k.hf(a)));e&&(h=h.concat(12288|l).concat(k.hf(a)));
h=h.concat(d.A(a)).concat(a.Xa(d.resultType,k.resultType)).concat(12288|l).concat(k.og(a));f===c.qf&&(h=h.concat(12288|l).concat(k.hf(a)))}else h=h.concat(d.A(a)).concat(a.Xa(d.resultType,k.resultType)).concat(Rh(b,a)).concat(k.og(a))}else if(b instanceof ih)k=Tg(a,b),g(k);else throw"bad assignment";return h}var c={bg:0,qf:1,vg:2},d=this.head.name;switch(d){case "=":return b(this.children[0],this.children[1],!1,this.Ib?c.qf:c.bg);case "++":case "--":if(!(this.children[0]instanceof ih))throw"invalid operand "+
S(this.head);var e=d[0],f=Kh(a,e,W);e=new kh(new ah(this.head.Yd,this.head.Ed,this.head.Cd,e),W,f,[jh(this.children[0]),new eh(new Yg(this.head.Yd,this.head.Ed,this.head.Cd,1))]);f.Aa&&(d=Tg(a,this.children[0]),e.resultType=f.Aa(a,e,[d.resultType,Mg]));return b(this.children[0],e,!0,this.Ib?0===this.type?c.qf:c.vg:c.bg);default:if(this.type===W&&this.Ka.priority===lh){if(!(this.children[0]instanceof ih))throw"invalid operand "+S(this.head);e=d.slice(0,-1);f=Kh(a,e,W);e=new kh(new ah(this.head.Yd,
this.head.Ed,this.head.Cd,e),W,f,[jh(this.children[0]),this.children[1]]);f.Aa&&(d=Tg(a,this.children[0]),e.resultType=f.Aa(a,e,[d.resultType,this.children[1].resultType]));return b(this.children[0],e,!0,this.Ib?c.qf:c.bg)}if(this.Ka&&this.Ka.A)return this.Ka.A(this,a);switch(this.type){case 0:return V.prototype.A.call(this,a).concat(this.Ka.P);case W:return V.prototype.A.call(this,a).concat(this.Ka.P);case 3:return this.Ka.P;case 4:f=a.$g(this);if(null!==f)return f;e=Ug(a,d);if(null!=e){if(e.xd!==
this.children.length)throw"wrong number of arguments";f=[];d=Vg(a,e.xd+(e.Le||0));for(var g=0;g<this.children.length;g++)f=f.concat(this.children[g].A(a)),f=f.concat(16384|d+g);return f=f.concat(e.Rb(a,a.Ba,this.children.map(function(a){return a.resultType}),d))}throw"unknown function "+d+" "+S(this.head);default:throw"internal";}}};
function Sh(a,b,c){return a instanceof kh&&2===a.children.length?a.children[0].A(b).concat(a.children[1].A(b)).concat([40960|(c?256:0)|a.Ka.P[0]&255,0]):a.A(b).concat(4096,40960|(c?256:0)|Ig.indexOf("ne"),0)}function Rh(a,b){var c=Tg(b,a);if(a.children.length>c.B.length)throw"too many indices"+S(a.head);for(var d=[],e=1,f=0;f<a.children.length;f++)d=d.concat(a.children[f].A(b)),0<f&&(d=d.concat(4096|e,32772,32770)),e*=c.B[f];return d}
oh.prototype.A=function(a){if(this.b)return[];var b=Tg(a,this);if(ph(this)){var c=qh(this,b);if(c>=b.size)throw"index out of range "+S(this.head);return b.Rd(a,c)}return Rh(this,a).concat(b.hf(a))};mh.prototype.A=function(){throw"internal";};X.prototype.A=function(){throw"internal";};uh.prototype.A=function(a){var b=a.getContext();sh(this,a);a.Ga(this.Za[0]);var c="init"===this.Jf?a.Pg:[];a.Va+=c.length;c=c.concat(V.prototype.A.call(this,a)).concat(0);a.Ga(b);return c};
vh.prototype.A=function(a){var b=a.getContext();sh(this,a);a.Ga(this.Za[0]);var c=V.prototype.A.call(this,a).concat(57344);a.Ga(b);return c};xh.prototype.A=function(a){sh(this,a);return[]};yh.prototype.A=function(a){sh(this,a);return 0===this.children.length?[]:V.prototype.A.call(this,a)};zh.prototype.A=function(a){sh(this,a);return this.children[0].A(a)};nh.prototype.A=function(a,b){sh(this,a);var c=[];this.children.forEach(function(d){c=c.concat(d.A(a,b))});return c};
Ah.prototype.A=function(a){var b=a.getContext();sh(this,a);for(var c=a.Va,d=[],e=0,f=0;f<this.b.length;f++)a.Va=c+d.length,0<f&&bh(a,this.l[f-1]),d=d.concat(Sh(this.b[f],a)),a.Va=c+d.length,Rg(a,d),a.Ga(this.Za[f]),this.i[f].forEach(function(b){d=d.concat(b.A(a));a.Va=c+d.length}),a.Ga(b),f+1<this.i.length?(d=d.concat(36864),Sg(a,d),Rg(a,d),e++):Sg(a,d);a.Va=c+d.length;this.i.length>this.b.length&&(bh(a,this.l[this.b.length-1],a.Va+d.length),a.Ga(this.Za[this.b.length]),this.i[this.b.length].forEach(function(b){d=
d.concat(b.A(a));a.Va=c+d.length}));for(;0<e--;)Sg(a,d);a.Ga(b);return d};Dh.prototype.A=function(a){var b=a.getContext();sh(this,a);var c=a.Va,d=Sh(this.Sa,a,!0);Rg(a,d);a.Ga(this.Za[0]);this.children.forEach(function(b){a.Va=c+d.length;d=d.concat(b.A(a))});Sg(a,d);a.Ga(b);return d};
Eh.prototype.A=function(a){if(null==this.Sa&&0===this.children.length)return[];var b=a.getContext();sh(this,a);var c=a.Va,d=[];null!=this.Sa&&(d=Sh(this.Sa,a));Rg(a,d);a.Ga(this.Za[0]);this.children.forEach(function(b){a.Va=c+d.length;d=d.concat(b.A(a))});a.Va=c+d.length;bh(a,this.b[0]);d=d.concat(36864|-d.length&4095);Sg(a,d);a.Ga(b);return d};
Fh.prototype.A=function(a){var b=a.getContext();sh(this,a);var c=a.Va,d=this.children[0].A(a),e=Tg(a,this.l);d=d.concat(e.Nf(a));var f=d.length;d=d.concat(e.Rd(a)).concat(this.children[1].A(a)).concat(40975,0);Rg(a,d);a.Ga(this.Za[0]);for(var g=2;g<this.children.length;g++)a.Va=c+d.length,d=d.concat(this.children[g].A(a));a.Va=c+d.length;bh(a,this.i[0]);d=d.concat(e.Rd(a));d=this.b?d.concat(this.b.A(a)):d.concat(Qh(1));d=d.concat(32770,e.Nf(a),36864|f-d.length-2&4095);Sg(a,d);a.Ga(b);return d};
Gh.prototype.A=function(a){sh(this,a);var b=Ng(a.Ba,this.name);if(!b)throw'native function "'+this.name+'" not found';if(this.children.length!==b.D.length)throw'wrong number of arguments for native function "'+this.name+'"';for(var c=[],d=[],e=[],f=this.children.length-1;0<=f;f--){var g=this.children[f];if(0>b.D[f])if(void 0==d[-b.D[f]-1])d[-b.D[f]-1]=g.wb;else{if(d[-b.D[f]-1]!==g.wb)throw'argument size mismatch in native function "'+this.name+'"';}else 0===b.D[f]&&e.push(g.wb);if(g instanceof oh)c=
c.concat(Qh(Tg(a,g).offset)).concat(Rh(g,a)).concat(32770);else if(g instanceof ih)c=c.concat(Qh(Tg(a,g).offset));else{for(var h=Vg(a,g.wb),m=0;m<g.wb;m++)c=c.concat((g instanceof mh?g.children[m]:g).A(a)),c=c.concat(16384|h+m);c=c.concat(Qh(h))}}for(f=e.length-1;0<=f;f--)c=Qh(e[f]).concat(c);for(f=d.length-1;0<=f;f--)void 0!==d[f]&&(c=Qh(d[f]).concat(c));return c=c.concat(49152|b.id)};wh.prototype.A=function(a){sh(this,a);return[(a.rg?14:0)<<12]};function Th(a,b){th.call(this,a,b)}Th.prototype=Object.create(th.prototype);
Th.prototype.constructor=Th;Th.prototype.A=function(){var a=this.ya.name;if(void 0===this.b.sd[a])throw'unknown function "'+a+'" '+S(this.ya.head);return 53248|this.b.sd[a]};Hh.prototype.A=function(a){sh(this,a);return[new Th(a,this)]};function Uh(a,b){b=b||0;for(var c=0;c<a.length;c++)a[c]instanceof th&&(a[c]=a[c].A(b+c))}
xb.prototype.A=function(){this.za=[];this.te();this.nc=[];var a=this.l.map(function(a){this.Va=0;this.Ga(a.Za[0]);this.rg=a instanceof vh;this.nc=[];return{ae:a.A(this,!0),mapping:this.nc}},this);if(0<this.za.length)throw"internal";for(var b=0,c=0;c<this.l.length;c++)this.l[c]instanceof uh&&b++;this.sd={};var d=[],e=[1+2*b];this.nc=[];for(c=0;c<this.l.length;c++)this.nc=this.nc.concat(a[c].mapping.map(function(a){return new Kg(a.yh,a.line,a.Ra,a.fc+1+2*b+d.length)})),this.l[c]instanceof uh?(e=e.concat(Pg(this.Ba,
this.l[c].Jf),1+2*b+d.length),d=d.concat(a[c].ae)):this.l[c]instanceof vh&&(this.sd[this.l[c].Ah]=1+2*b+d.length,d=d.concat(a[c].ae));Uh(d,1+2*b);return e.concat(d)};function zb(a){a.gg();a.qh();a.o=0;for(a.b=[];a.o<a.F.length;)a.b=a.b.concat(a.ih());a.ph();Ph(a);a.rh();return a.A()};function Vh(a,b,c){void 0===c&&(c=1);return{name:a,xd:c,Le:1,gf:function(a){return null!=Ng(a,b)},Rb:function(a,e,f,g){a=Ng(e,b);e=[4097];for(f=0;f<c;f++)e=e.concat([4096|g+c-1-f]);return e=e.concat([4096|g+c,49152|a.id,12288|g+c])}}}var yb=[Vh("min","math.min",2),Vh("max","math.max",2),Vh("clamp","math.clamp",3),Vh("muldiv","math.muldiv",3),Vh("atan2","math.atan2",2),Vh("sin","math.sin"),Vh("cos","math.cos"),Vh("sqrt","math.sqrt"),Vh("rand","math.rand",0)];function Bg(a,b){xb.call(this,a,b);this.Ld=!0;this.pb=Wh;this.Cb=100;this.Dh=[];this.Mf=[];this.Xe=[];this.labels=[[]];this.We=[];this.Nb=!1;this.label=null;this.Y=ch;this.ha=[]}Bg.prototype=Object.create(xb.prototype);Bg.prototype.constructor=Bg;var Xh="== != <= >= |= ^= &= *= /= %= += -= <<= >>= ++ -- ( ) [ ] - ~ ! * / % + << >> && || & ^ | > < = , ? : { } ; bool break case const continue default do else emit false fixed for goto if int onevent return size switch true void when while".split(" ");
function Yh(a,b,c){return c[0]}function Zh(a,b,c){for(a=0;a<c.length;a++)switch(c[a]){case ch:case hh:return c[a];case "v":throw"cannot use void result in expression";}return Mg}function $h(a,b,c){if(!(a instanceof mh)&&a.resultType!==b&&a.resultType!==ch){if("v"===a.resultType)throw"cannot use void result "+S(a.head);if(b=ai(b))a=new kh(new ah(a.head.Yd,a.head.Ed,a.head.Cd,b),0,Kh(c,b,0),[a]),a=a.K(c)}return a}function bi(a,b){a.children[1]=$h(a.children[1],a.resultType,b);return a}
Bg.prototype.Xa=function(a,b){if(a===ch||b===ch)throw"internal";if("v"===a)throw"bad conversion from void";switch(a){case Mg:case "b":switch(b){case hh:return[4196,32772]}break;case hh:switch(b){case Mg:case "b":return[4196,32773]}}return[]};function ci(a,b,c){var d=[];a.forEach(function(a){d=a instanceof gh&&b===Mg?d.concat(Qh(Math.trunc(a.n))):a instanceof eh&&a.resultType===Mg&&b===hh?d.concat(Qh(a.n*c.Cb)):d.concat(a.A(c)).concat(c.Xa(a.resultType,b))});return d}
function di(a,b,c,d){var e=Vg(a,4);return(b instanceof V?b.A(a):Qh(b)).concat(16384|e).concat(c instanceof V?c.A(a):Qh(c)).concat(16384|e+1).concat(d instanceof V?d.A(a):Qh(d)).concat([16384|e+2,4097,4096|e+2,4096|e+1,4096|e,4096|e+3,49152|Ng(a.Ba,"math.muldiv").id,12288|e+3])}
function ei(a,b,c,d){for(var e=!1,f=[],g=0;g<a.children.length;g++){if(a.children[g]instanceof gh)e=!0;else if(!(a.children[g]instanceof eh))return a;f.push(a.children[g].n)}c=(e&&d?d:c)(f);d=a.Ka.resultType;a.Ka.Aa&&(d=a.Ka.Aa(b,a,a.children.map(function(a){return a.resultType})));switch(d){case Mg:case "b":return new eh(a.head,fh(c));case hh:return new gh(a.head,c);default:throw"internal";}}
var Wh=[new Y("--",0,{priority:150,Aa:Yh}),new Y("++",0,{priority:150,Aa:Yh}),new Y("-",0,{priority:150,Aa:Yh,K:function(a,b){return ei(a,b,function(a){return-a[0]})},P:[28672]}),new Y("~",0,{priority:150,K:function(a,b){return ei(a,b,function(a){return~a[0]})},P:[28674]}),new Y("!",0,{priority:150,resultType:"b",K:function(a,b){return ei(a,b,function(a){return 0==a[0]?1:0})},P:[4096,32778]}),new Y("bool",0,{priority:150,resultType:"b",K:function(a,b){return ei(a,b,function(a){return 0!=a[0]?1:0})},
P:[],A:function(a,b){b=a.children[0].A(b);"b"!==a.children[0].resultType&&(b=b.concat(4096,32779));return b}}),new Y("fixed",0,{priority:150,resultType:hh,K:function(a,b){return ei(a,b,function(a){return a[0]})},P:[],A:function(a,b){var c=a.children[0].A(b);a.children[0].resultType!==hh&&(c=c.concat(4096|b.Cb,32772));return c}}),new Y("int",0,{priority:150,K:function(a,b){return ei(a,b,function(a){return a[0]})},P:[],A:function(a,b){var c=a.children[0].A(b);a.children[0].resultType===hh&&(c=c.concat(4096|
b.Cb,32773));return c}}),new Y("size",0,{priority:150,K:function(a,b){var c=0<a.children[0].wb?a.children[0].wb:a.children[0]instanceof mh?a.children[0].children.length:-1;if(0>c&&a.children[0]instanceof ih)for(var d=b.hb.length-1;0<=d;d--)if(b.hb[d].name===a.children[0].name){c=b.hb[d].size;break}return 0<c?new eh(a.head,c):a}}),new Y("--",2,{priority:150,Aa:Yh}),new Y("++",2,{priority:150,Aa:Yh}),new Y("+=",W,{priority:lh,Aa:Yh,K:bi}),new Y("-=",W,{priority:lh,Aa:Yh}),new Y("*=",W,{priority:lh,
Aa:Yh}),new Y("/=",W,{priority:lh,Aa:Yh}),new Y("%=",W,{priority:lh,Aa:Yh}),new Y("<<=",W,{priority:lh}),new Y(">>=",W,{priority:lh}),new Y("&=",W,{priority:lh}),new Y("|=",W,{priority:lh}),new Y("^=",W,{priority:lh}),new Y("*",W,{priority:140,Aa:Zh,P:[32772],K:function(a,b){return ei(a,b,function(a){return a[0]*a[1]})},A:function(a,b){var c=a.children[1].resultType===hh,d=[];a.children[0].resultType===hh&&c?d=d.concat(di(b,a.children[0],a.children[1],b.Cb)):(a.children.forEach(function(a){d=d.concat(a.A(b))}),
d=d.concat(a.Ka.P));return d}}),new Y("/",W,{priority:140,Aa:Zh,P:[32773],K:function(a,b){return ei(a,b,function(b){if(0===b[1])throw"division by 0 "+S(a.head);return Math.trunc(b[0]/b[1])},function(b){if(0===b[1])throw"division by 0 "+S(a.head);return b[0]/b[1]})},A:function(a,b){var c=a.children[1].resultType===hh,d=[];a.children[0].resultType===hh?c?d=d.concat(di(b,a.children[0],b.Cb,a.children[1])):(a.children.forEach(function(a){d=d.concat(a.A(b))}),d=d.concat(a.Ka.P)):c?d=d.concat(di(b,a.children[0],
b.Cb*b.Cb,a.children[1])):(a.children.forEach(function(a){d=d.concat(a.A(b))}),d=d.concat(a.Ka.P));return d}}),new Y("%",W,{priority:140,Aa:Zh,K:function(a,b){return ei(a,b,function(b){if(0===b[1])throw"division by 0 "+S(a.head);return b[0]%b[1]})},P:[32774],A:function(a,b){return ci(a.children,a.resultType,b).concat(a.Ka.P)}}),new Y("+",W,{priority:130,Aa:Zh,K:function(a,b){return ei(a,b,function(a){return a[0]+a[1]})},P:[32770],A:function(a,b){return ci(a.children,a.resultType,b).concat(a.Ka.P)}}),
new Y("-",W,{priority:130,Aa:Zh,K:function(a,b){return ei(a,b,function(a){return a[0]-a[1]})},P:[32771],A:function(a,b){return ci(a.children,a.resultType,b).concat(a.Ka.P)}}),new Y("<<",W,{priority:120,K:function(a,b){return ei(a,b,function(a){return a[0]<<a[1]})},P:[32768],A:function(a,b){return a.children[0].A(b).concat(ci(a.children.slice(1),Mg,b)).concat(a.Ka.P)}}),new Y(">>",W,{priority:120,K:function(a,b){return ei(a,b,function(a){return a[0]>>a[1]})},P:[32769],A:function(a,b){return a.children[0].A(b).concat(ci(a.children.slice(1),
Mg,b)).concat(a.Ka.P)}}),new Y("==",W,{priority:80,resultType:"b",K:function(a,b){return ei(a,b,function(a){return a[0]===a[1]?1:0})},P:[32778],A:function(a,b){var c=a.children.map(function(a){return a.resultType});return ci(a.children,Zh(b,a,c),b).concat(a.Ka.P)}}),new Y("!=",W,{priority:80,resultType:"b",K:function(a,b){return ei(a,b,function(a){return a[0]!==a[1]?1:0})},P:[32779],A:function(a,b){var c=a.children.map(function(a){return a.resultType});return ci(a.children,Zh(b,a,c),b).concat(a.Ka.P)}}),
new Y("<",W,{priority:80,resultType:"b",K:function(a,b){return ei(a,b,function(a){return a[0]<a[1]?1:0})},P:[32782],A:function(a,b){var c=a.children.map(function(a){return a.resultType});return ci(a.children,Zh(b,a,c),b).concat(a.Ka.P)}}),new Y("<=",W,{priority:80,resultType:"b",K:function(a,b){return ei(a,b,function(a){return a[0]<=a[1]?1:0})},P:[32783],A:function(a,b){var c=a.children.map(function(a){return a.resultType});return ci(a.children,Zh(b,a,c),b).concat(a.Ka.P)}}),new Y(">",W,{priority:80,
resultType:"b",K:function(a,b){return ei(a,b,function(a){return a[0]>a[1]?1:0})},P:[32780],A:function(a,b){var c=a.children.map(function(a){return a.resultType});return ci(a.children,Zh(b,a,c),b).concat(a.Ka.P)}}),new Y(">=",W,{priority:80,resultType:"b",K:function(a,b){return ei(a,b,function(a){return a[0]>=a[1]?1:0})},P:[32781],A:function(a,b){var c=a.children.map(function(a){return a.resultType});return ci(a.children,Zh(b,a,c),b).concat(a.Ka.P)}}),new Y("&",W,{priority:110,K:function(a,b){return ei(a,
b,function(a){return a[0]&a[1]})},P:[32777]}),new Y("|",W,{priority:90,K:function(a,b){return ei(a,b,function(a){return a[0]|a[1]})},P:[32775]}),new Y("^",W,{priority:100,K:function(a,b){return ei(a,b,function(a){return a[0]^a[1]})},P:[32776]}),new Y("&&",W,{priority:60,Aa:Yh,K:function(a,b){return ei(a,b,function(a){return a[0]&&a[1]?1:0})},P:[32785],A:function(a,b){var c=a.children[0].A(b).concat([16384|b.Mc,12288|b.Mc,4096,40960|Ig.indexOf("eq"),4,12288|b.Mc,36864]);Rg(b,c);a=$h(a.children[1],
a.children[0].resultType,b).K(b);c=c.concat(a.A(b));Sg(b,c);return c}}),new Y("||",W,{priority:50,Aa:Yh,K:function(a,b){return ei(a,b,function(a){return a[0]||a[1]?1:0})},P:[32784],A:function(a,b){var c=a.children[0].A(b).concat([16384|b.Mc,12288|b.Mc,4096,40960|Ig.indexOf("ne"),4,12288|b.Mc,36864]);Rg(b,c);a=$h(a.children[1],a.children[0].resultType,b).K(b);c=c.concat(a.A(b));Sg(b,c);return c}}),new Y("?",W,{priority:40,Aa:function(a,b,c){return c[1]},K:function(a){if(!(a.children[1]instanceof kh)||
0==a.children[1].Ka||":"!==a.children[1].Ka.name)throw"missing else part in conditional expression "+S(a.head);return a.children[0]instanceof eh?a.children[1].children[a.children[0].n?0:1]:a},A:function(a,b){var c=Sh(a.children[0],b);Rg(b,c);c=c.concat(a.children[1].children[0].A(b)).concat(36864);Sg(b,c);Rg(b,c);c=c.concat(a.children[1].children[1].A(b));Sg(b,c);return c}}),new Y(":",W,{priority:41,Aa:Yh,K:function(a,b){a.children[1]=$h(a.children[1],a.children[0].resultType,b);return a},A:function(a){throw"unexpected colon outside conditional expression "+
S(a.head);}}),new Y("=",W,{priority:lh,Aa:Yh,K:bi}),new Y(",",W,{priority:25,Aa:function(a,b){return b[1]},K:function(a){a.children[0].Ib=!1;return a}}),new Y("false",3,{resultType:"b",K:function(a,b){return ei(a,b,function(){return 0})},P:[4096]}),new Y("true",3,{resultType:"b",K:function(a,b){return ei(a,b,function(){return 1})},P:[4097]})];y=Bg.prototype;
y.wh=function(){for(;this.J<this.w;)if(" "===this.i[this.J]||"\t"===this.i[this.J])this.J++,this.Ra++;else if("\n"===this.i[this.J])this.J++,this.Ra=0,this.line++;else if("\r"===this.i[this.J])this.J++;else if("/*"===this.i.slice(this.J,this.J+2))for(this.J+=2,this.Ra+=2;this.J<this.w&&"*/"!==this.i.slice(this.J-2,this.J);)"\n"===this.i[this.J]?(this.Ra=0,this.line++):"\r"!==this.i[this.J]&&this.Ra++,this.J++;else if("//"===this.i.slice(this.J,this.J+2))for(;this.J<this.w&&"\n"!==this.i[this.J];)this.J++,
this.Ra++;else break};y.gg=function(a){return xb.prototype.gg.call(this,a||Xh)};y.qh=function(){this.F.forEach(function(a,b){a instanceof ah&&("def"===a.name||0<=["int","bool","fixed","void"].indexOf(a.name))&&this.F[b+1]instanceof $g&&this.F[b+2]instanceof ah&&"("===this.F[b+2].name&&this.Dh.push(this.F[b+1].name)},this)};
function fi(a,b){switch(a.name){case "var":case "def":return b||Mg;case "void":return"v";case "int":return Mg;case "bool":return"b";case "fixed":return hh;default:throw"internal";}}function ai(a){switch(a){case Mg:return"int";case hh:return"fixed";case "b":return"bool";default:return""}}function gi(a){return Z(a,0,"int")||Z(a,0,"bool")||Z(a,0,"fixed")}
y.ih=function(){function a(){var a=[];for(this.o++;;){d=this.F[this.o];this.o++;if(!Lh(this,0,ah))throw"syntax error "+S(c);switch(this.F[this.o].name){case "[":if(Z(this,1,"]")){this.o+=2;if(!Z(this,0,"="))throw"missing size or initial value in array declaration"+S(this.F[this.o-2]);e=new kh(this.F[this.o],W,Kh(this,"=",W),[new ih(d)]);this.o++;e.children.push(Mh(this,25));e.resultType=fi(c,e.children[1].resultType);e.children[1].$a(this);e.Ib=!1;var b=new kh(new ah(this.F[this.o].Yd,this.F[this.o].Ed,
this.F[this.o].Cd,"size"),0,Kh(this,"size",0),[e.children[1]]);a.push(new yh(c,d,e.resultType,[b],e))}else b=Nh(this,!0),Z(this,0,"=")?(e=new kh(this.F[this.o],W,Kh(this,"=",W),[new ih(d)]),this.o++,e.children.push(Mh(this,25)),e.resultType=fi(c,e.children[1].resultType),e.Ib=!1,a.push(new yh(c,d,e.resultType,b,e))):a.push(new yh(c,d,fi(c),b));break;case "=":e=new kh(this.F[this.o],W,Kh(this,"=",W),[new ih(d)]);this.o++;e.children.push(Mh(this,25));e.resultType=fi(c,e.children[1].resultType);e.Ib=
!1;e=e.K(this);a.push(new yh(c,d,e.resultType,null,e));break;default:a.push(new yh(c,d,fi(c)))}if(Z(this,0,","))this.o++;else{if(Z(this,0,";"))return this.o++,a;throw"missing semicolon "+S(this.F[this.o]);}}}function b(){var a=fi(c);d=this.F[this.o+1];this.o+=3;var b=[];if(!Z(this,0,")"))for(;;){var e=Mg;gi(this)&&(e=fi(this.F[this.o]),this.o++);if(!Lh(this,0,$g))throw"bad function definition argument "+S(this.F[this.o]);var f=this.F[this.o].name,g=[],h=!1;this.o++;Z(this,0,"[")&&(h=!0,g=Nh(this,
!0));b.push({name:f,type:e,Oh:g,size:1,B:[],gd:h});if(Z(this,0,","))this.o++;else if(Z(this,0,")"))break;else throw"syntax error in function definition "+S(this.F[this.o]);}this.o++;if(!Z(this,0,"{"))throw"block expected after function header "+S(this.F[this.o]);this.o++;return new hi(c,d.name,a,b)}if(this.o>=this.F.length)throw"no more tokens";var c=this.F[this.o];if(this.F[this.o]instanceof ah)switch(c.name){case "const":if(!Lh(this,1,$g)||!Z(this,2,"="))throw'syntax error for "const" '+S(c);var d=
this.F[this.o+1];this.o+=3;var e=Mh(this,25);e=e.K(this);if(!(e instanceof eh))throw"non-constant expression in constant definition "+S(this.F[this.o]);if(!Z(this,0,";"))throw"missing semicolon "+S(c);this.o++;return[new xh(c,d.name,e)];case "int":case "bool":case "fixed":if(!Lh(this,1,$g))throw'unexpected token after "'+c.name+'" '+S(c);return Z(this,2,"(")?[b.call(this)]:a.call(this);case "void":return[b.call(this)];case "if":this.o++;var f=Nh(this);if(1!==f.length)throw'bad condition in "if" statement '+
S(this.F[this.o]);var g=new Ah(c,f[0]);Z(this,0,"{")?this.o++:g.ha=!0;return[g];case "when":this.o++;f=Nh(this);if(1!==f.length)throw'bad condition in "when" statement '+S(this.F[this.o]);if(!Z(this,0,"{"))throw'block expected after "when" statement '+S(this.F[this.o]);this.o++;return[new Dh(c,f[0])];case "switch":this.o++;f=Nh(this);if(1!==f.length)throw'bad expression in "switch" statement '+S(this.F[this.o]);if(!Z(this,0,"{"))throw'block expected after "switch" statement '+S(this.F[this.o]);this.o++;
return[new ii(c,f[0])];case "case":this.o++;e=Mh(this);if(!Z(this,0,":"))throw'missing colon after "case" '+S(this.F[this.o]);this.o++;return[new ji(c,e)];case "default":if(!Z(this,1,":"))throw'missing colon after "default" '+S(this.F[this.o]);this.o+=2;return[new ji(c,null)];case "goto":if(!Lh(this,1,$g))throw'missing label after "goto" '+S(this.F[this.o]);d=this.F[this.o+1];this.o+=2;return[new ki(c,d.name)];case "while":this.o++;f=Nh(this);if(1!==f.length)throw'bad condition in "while" statement '+
S(this.F[this.o]);if(Z(this,0,";"))return this.o++,[new li(c,f[0])];if(!Z(this,0,"{"))throw'block expected after "while" statement '+S(this.F[this.o]);this.o++;return[new mi(c,f[0])];case "do":if(!Z(this,1,"{"))throw'block expected after "do" statement '+S(this.F[this.o]);this.o+=2;return[new ni(c)];case "for":if(!Z(this,1,"("))throw'"for" syntax error '+S(c);this.o+=2;d=null;var h=Mg;if(Z(this,0,";"))e=null;else{if(Z(this,0,"var")||gi(this)){if(!Lh(this,1,$g))throw'bad variable declaration in "for" statement '+
S(this.F[this.o]);h=fi(this.F[this.o]);this.o++;d=this.F[this.o]}e=Mh(this);if(!Z(this,0,";"))throw'semicolon expected in "for" statement '+S(this.F[this.o]);}this.o++;if(Z(this,0,";"))g=null;else if(g=Mh(this),!Z(this,0,";"))throw'semicolon expected in "for" statement '+S(this.F[this.o]);this.o++;if(Z(this,0,")"))f=null;else if(f=Mh(this),!Z(this,0,")"))throw'semicolon expected in "for" statement '+S(this.F[this.o]);this.o++;if(!Z(this,0,"{"))throw'block expected after "for" statement '+S(this.F[this.o]);
this.o++;return[new oi(c,d,h,e,g,f)];case ";":return this.o++,[new pi(c)];case "{":return this.o++,[new qi(c)];case "}":this.o++;if(Z(this,0,"else")){this.o++;if(Z(this,0,"if")){this.o++;f=Nh(this);if(1>f.length)throw'empty condition in "if" statement '+S(this.F[this.o]);1<f.length&&(g=new nh(c),g.children=f.slice(0,-1).map(function(a){a instanceof kh&&(a.Ib=!1);return a}),f=f.slice(-1));if(!Z(this,0,"{"))throw'block expected after "if" statement '+S(this.F[this.o]);this.o++;return[new Bh(c,f[0])]}if(!Z(this,
0,"{"))throw'block expected after "else" statement '+S(this.F[this.o]);this.o++;return[new Ch(c)]}return[new Ih(c)];case "else":throw'unexpected "else" '+S(this.F[this.o]);case "onevent":if(!Lh(this,1,$g))throw'unexpected token after "onevent" '+S(c);if(!Z(this,2,"{"))throw'block expected after "onevent" statement '+S(this.F[this.o]);d=this.F[this.o+1];this.o+=3;return[new ri(c,d.name)];case "return":this.o++;Z(this,0,";")?e=null:e=Mh(this);if(!Z(this,0,";"))throw"missing semicolon "+S(c);this.o++;
return[new si(c,e)];case "break":d=null;Lh(this,1,$g)&&(d=this.F[this.o+1],this.o++);if(!Z(this,1,";"))throw"missing semicolon "+S(c);this.o+=2;return[new ti(c,!1,d?d.name:null)];case "continue":d=null;Lh(this,1,$g)&&(d=this.F[this.o+1],this.o++);if(!Z(this,1,";"))throw"missing semicolon "+S(c);this.o+=2;return[new ti(c,!0,d?d.name:null)]}if(Lh(this,0,$g)&&Z(this,1,"(")&&(d=this.F[this.o],Ng(this.Ba,d.name)))return this.o++,[new Gh(c,d.name,Nh(this))];if(Lh(this,0,$g)&&Z(this,1,":"))return d=this.F[this.o],
this.o+=2,[new ui(c,d.name)];e=Mh(this);e.Ib=!1;if(!Z(this,0,";"))throw"missing semicolon "+(this.o<this.F.length?S(this.F[this.o]):"eof");this.o++;e=e.K(this);return[new zh(e)]};
y.uf=function(a){if(a instanceof hi){for(var b=0;b<a.D.length;b++)a.D[b].size=1,a.D[b].B=a.D[b].Oh.map(function(c){c=c.K(this);if(!(c instanceof eh))throw"non-constant expression in argument dimension "+S(c.head);if(0>=c.n||Math.round(c.n)!==c.n)throw"bad value for argument dimension "+S(c.head);a.D[b].size*=c.n;return c.n},this),this.Rc(a.D[b].name,a.D[b].size,a.D[b].B,this.Wa,a.D[b].type,a.D[b].gd),this.Wa+=a.D[b].gd?1:a.D[b].size;a.Za[1]={hb:this.hb.slice(),labels:this.labels.slice()}}else a instanceof
oi?a.Y&&(this.Rc(a.Y.name,1,[1],this.Wa,a.za),this.Wa+=1,a.Za[1]={hb:this.hb.slice(),labels:this.labels.slice()}):xb.prototype.uf.call(this,a)};y.te=function(){this.hb=this.Xe;this.labels=this.We};y.Ga=function(a){a&&(this.hb=a.hb,this.labels=a.labels)};y.getContext=function(){return{hb:this.hb,labels:this.labels.slice()}};function vi(a,b,c,d,e,f,g){Lg.call(this,a,b,c,d,e);this.Nb=f;this.gd=g||!1}vi.prototype=Object.create(Lg.prototype);y=vi.prototype;y.constructor=vi;
y.Rd=function(a,b){return this.Nb?this.gd?[12288|a.u,20480|this.offset,a.Ba.b,20480|(b||0),a.Ba.b]:[12288|a.u,20480|this.offset+(b||0),a.Ba.b]:[12288|this.offset+(b||0)]};y.Nf=function(a,b){return this.Nb?this.gd?[12288|a.u,20480|this.offset,a.Ba.b,24576|(b||0),a.Ba.b]:[12288|a.u,24576|this.offset+(b||0),a.Ba.b]:[16384|this.offset+(b||0)]};y.hf=function(a){return this.Nb?this.gd?[12288|a.u,20480|this.offset,a.Ba.b,32770,20480,a.Ba.b]:[12288|a.u,32770,20480|this.offset,a.Ba.b]:[20480|this.offset,this.size]};
y.og=function(a){return this.Nb?this.gd?[12288|a.u,20480|this.offset,a.Ba.b,32770,24576,a.Ba.b]:[12288|a.u,32770,24576|this.offset,a.Ba.b]:[24576|this.offset,this.size]};Bg.prototype.Rc=function(a,b,c,d,e,f){this.hb.push(new vi(a,b,c,d,e,this.Nb,f))};function wi(a){kh.call(this,a,4,null)}wi.prototype=Object.create(kh.prototype);wi.prototype.constructor=wi;y=Bg.prototype;
y.bh=function(a){var b=new wi(a,this.Nb,this.Wa);b.Ka={Aa:function(b,d){var c;a:{for(c=0;c<b.Mf.length;c++)if(b.Mf[c].ng===a.name){c=b.Mf[c];break a}c=null}return c?c.resultType:(c=Ug(b,a.name))&&c.Aa?c.Aa(b,c,d):Mg}};return b};
y.Qg=function(){this.Wa=this.Ba.Wa;this.Nb=!1;for(var a=[],b=0;b<this.b.length;b++){if(0<=[Ih,Bh,Ch].indexOf(this.b[b].constructor)){if(0===a.length)throw"unexpected end of block "+S(this.b[b].head);var c=a.pop();this.Wa=c.Wa;this.Nb=c.Nb;c.Yh.Za[0]={hb:this.hb.slice(),labels:this.labels.slice()};this.hb.splice(c.ai);this.labels.pop();0===a.length&&(this.Y=ch)}0<=[Ah,Dh,ii,mi,qi,oi,ri,hi,Bh,Ch].indexOf(this.b[b].constructor)&&(a.push({Wa:this.Wa,Nb:this.Nb,ai:this.hb.length,Yh:this.b[b]}),this.labels.push([]),
this.b[b]instanceof hi&&(this.Nb=!0,this.Y=this.b[b].resultType,this.Wa=0));this.uf(this.b[b]);if(this.b[b]instanceof ui){c=this.b[b].label;for(var d=this.labels.length-1,e=0;e<this.labels[d].length;e++)if(this.labels[d][e].label===c)throw'duplicate label "'+c+'"';this.labels[d].push({label:c})}}this.Xe=this.hb.slice();this.We=this.labels};
y.ph=function(){for(var a=1;a<this.b.length;)this.b[a]instanceof li&&this.b[a-1]instanceof Ih?this.b.splice(a-1,1):a++;this.b.forEach(function(a){a instanceof hi&&(this.Mf.push(a),this.Y=a.resultType)},this);for(a=0;a<this.b.length-1;a++)this.b[a]instanceof ui&&(this.b[a+1]instanceof mi?this.b[a+1].label=this.b[a].label:this.b[a+1]instanceof ni?this.b[a+1].label=this.b[a].label:this.b[a+1]instanceof oi?this.b[a+1].label=this.b[a].label:this.b[a+1]instanceof ii&&(this.b[a+1].label=this.b[a].label))};
y.rh=function(){for(var a=0;a<this.b.length;a++)(this.b[a]instanceof ri||this.b[a]instanceof hi)&&this.l.push(this.b[a])};function xi(a,b){for(var c=a.length-1;0<=c;c--)for(var d=a[c].length-1;0<=d;d--)if(a[c][d].label===b)return a[c][d];return null}
y.A=function(){this.za=[];this.te();this.nc=[];this.Mc=this.Ab=this.ec=this.Ba.b-2;this.u=this.Mc+1;this.Pg=[];var a=this.l.map(function(a){this.Va=0;this.Ga(a.Za[0]);this.rg=a instanceof vh||a instanceof hi;this.Nb=a instanceof hi;this.nc=[];a=a.A(this,!0);Uh(a);return{ae:a,mapping:this.nc}},this);if(0<this.za.length)throw"internal";for(var b=0,c=0;c<this.l.length;c++)this.l[c]instanceof uh&&b++;var d=[],e={},f=[];this.nc=[];for(c=0;c<this.l.length;c++){var g=1+2*b+f.length;this.l[c]instanceof ri||
this.l[c]instanceof uh?(d.push({id:Pg(this.Ba,this.l[c].Jf),offset:f.length}),f=f.concat(a[c].ae)):this.l[c]instanceof vh?(e[this.l[c].Ah]=f.length,f=f.concat(a[c].ae)):this.l[c]instanceof hi&&(e[this.l[c].ng]=f.length,f=f.concat(a[c].ae));this.nc=this.nc.concat(a[c].mapping.map(function(a){return new Kg(a.yh,a.line,a.Ra,a.fc+g)}))}a=[1+2*d.length];for(c=0;c<d.length;c++)a=a.concat(d[c].id,1+2*d.length+d[c].offset);for(c=0;c<f.length;c++)if("string"===typeof f[c]){if(void 0===e[f[c]])throw yi(f[c]),
'unknown function "'+f[c]+'"';f[c]=53248|e[f[c]]+a.length}return a.concat(f)};
y.$g=function(a){for(var b=a.head.name,c=0;c<this.l.length;c++)if(this.l[c]instanceof hi&&this.l[c].ng===b){if(a.children.length!==this.l[c].D.length)throw"wrong number of arguments "+S(a.head);b=a.Ib?[b,12288|this.Mc]:[b];this.Nb?0<this.Wa&&(b=[12288|this.u,4096|this.Wa,32770,16384|this.u].concat(b).concat(12288|this.u,4096|this.Wa,32771,16384|this.u)):b=[4096|this.Wa,16384|this.u].concat(b);for(var d=[],e=0;e<a.children.length;e++){if(this.l[c].D[e].size!==a.children[e].wb)throw"incompatible size "+
S(a.children[e].head);if(this.l[c].D[e].gd){if(!(a.children[e]instanceof ih))throw"variable reference expected "+S(a.children[e].head);if(this.l[c].D[e].type!==a.children[e].resultType)throw"variable reference type mismatch "+S(a.children[e].head);}if(this.l[c].D[e].gd){var f=Tg(this,a.children[e]);d=d.concat(f.Nb?f.gd?[12288|this.u,20480|f.offset,this.Ba.b]:[12288|this.u,4096|f.offset,32770]:[4096|f.offset]).concat(this.Nb?[12288|this.u,24576|e+this.Wa,this.Ba.b]:16384|e+this.Wa)}else a.children[e]=
$h(a.children[e],this.l[c].D[e].type,this).K(this),d=d.concat(a.children[e].A(this)).concat(this.Xa(a.children[e].resultType,this.l[c].D[e].type)).concat(this.Nb?[12288|this.u,24576|e+this.Wa,this.Ba.b]:16384|e+this.Wa)}return d.concat(b)}return null};function zi(a){a=a.trim();if(""===a)return!1;var b=["#","//","/*"].map(function(b){b=a.indexOf(b);return 0>b?a.length:b}).sort(function(a,b){return a-b})[0];return b<a.length?"#"!==a[b]:/[;{]/.test(a)}
gh.prototype.A=function(a){return Qh(Math.round(this.n*a.Cb))};function qi(a){X.call(this,a,3)}qi.prototype=Object.create(X.prototype);qi.prototype.constructor=qi;qi.prototype.K=function(a){dh(this.children,a);return this};qi.prototype.A=function(a){var b=a.getContext();sh(this,a);a.Ga(this.Za[0]);var c=V.prototype.A.call(this,a);a.Ga(b);return c};function pi(a){X.call(this,a)}pi.prototype=Object.create(X.prototype);pi.prototype.constructor=pi;pi.prototype.A=function(){return[]};
function mi(a,b){Eh.call(this,a,b);this.label=null}mi.prototype=Object.create(Eh.prototype);mi.prototype.constructor=mi;mi.prototype.A=function(a){if(null==this.Sa&&0===this.children.length)return[];var b=a.getContext();sh(this,a);var c=[],d=a.Va;a.ha.push({});null!=this.Sa&&(c=Sh(this.Sa,a));Rg(a,c);a.Ga(this.Za[0]);this.children.forEach(function(b){a.Va=d+c.length;c=c.concat(b.A(a))});c=c.concat(36864|-c.length&4095);Sg(a,c);Ai(c,0,c.length,this.label);a.ha.pop();a.Ga(b);return c};
function ni(a){X.call(this,a,3);this.label=this.Sa=null}ni.prototype=Object.create(X.prototype);ni.prototype.constructor=ni;ni.prototype.nh=function(a){if(!(a instanceof li))throw'unexpected closing statement for "do"';this.Sa=a.Sa};
ni.prototype.A=function(a){if(null==this.Sa&&0===this.children.length)return[];var b=a.getContext();sh(this,a);var c=[],d=a.Va;a.ha.push({});a.Ga(this.Za[0]);this.children.forEach(function(b){a.Va=d+c.length;c=c.concat(b.A(a))});null!=this.Sa&&(c=c.concat(Sh(new kh(new ah(this.Sa.head.Yd,this.Sa.head.Ed,this.Sa.head.Cd,"not"),0,Kh(a,"!",0),[this.Sa]),a)),Rg(a,c),Sg(a,c,0));Ai(c,0,c.length,this.label);a.ha.pop();a.Ga(b);return c};function li(a,b){X.call(this,a,5);this.Sa=b}li.prototype=Object.create(X.prototype);
li.prototype.constructor=li;function oi(a,b,c,d,e,f){X.call(this,a,3);d&&(d.Ib=!1);f&&(f.Ib=!1);this.Y=b;this.za=c;this.i=d;this.b=e;this.l=f;this.label=null;this.S=[]}oi.prototype=Object.create(X.prototype);y=oi.prototype;y.constructor=oi;y.$a=function(a){V.prototype.$a.call(this,a);this.i&&this.i.$a(a);this.b&&this.b.$a(a);this.l&&this.l.$a(a)};y.K=function(a){this.i&&(this.i=this.i.K(a));this.b&&(this.b=this.b.K(a));this.l&&(this.l=this.l.K(a));dh(this.children,a);return this};
y.re=function(a,b){this.S.push(b)};
y.A=function(a){var b=a.getContext();sh(this,a);a.Ga(this.Za[1]);var c=a.Va,d=this.i?this.i.A(a):[];a.ha.push({});var e=d.length;this.b&&(d=d.concat(Sh(this.b,a)),Rg(a,d));a.Ga(this.Za[0]);for(var f=0;f<this.children.length;f++)a.Va=c+d.length,d=d.concat(this.children[f].A(a));a.Ga(this.Za[1]);f=d.length;a.Va=c+d.length;bh(a,this.S[0]);this.l&&(d=d.concat(this.l.A(a)));d=d.concat(36864|e-d.length&4095);this.b&&Sg(a,d);Ai(d,f,d.length,this.label);a.ha.pop();a.Ga(b);return d};
function ti(a,b,c){X.call(this,a);this.G=b;this.label=c}ti.prototype=Object.create(X.prototype);ti.prototype.constructor=ti;function Bi(a,b){th.call(this,a,b)}Bi.prototype=Object.create(th.prototype);Bi.prototype.constructor=Bi;function Ai(a,b,c,d){for(var e=0;e<a.length;e++)if(a[e]instanceof Bi){var f=a[e].ya.label;if(null==f||f===d)a[e]=a[e].ya.G?36864|b-e&4095:36864|c-e&4095}}
function yi(a){if(a instanceof Bi){var b=a.ya.label;if(null!=b)throw"unknown "+(a.ya.G?"continue":"break")+' label "'+b+'"'+S(a.ya.head);throw'unexpected "'+(a.ya.G?"continue":"break")+'" '+S(a.ya.head);}}ti.prototype.A=function(a){if(0===a.ha.length)throw(this.G?'"continue"':'"break"')+" outside loop "+S(this.head);sh(this,a);return[new Bi(a,this)]};function ii(a,b){X.call(this,a,3);this.u=b;this.label=null}ii.prototype=Object.create(X.prototype);ii.prototype.constructor=ii;
ii.prototype.A=function(a){var b=a.Va,c=this.u.A(a).concat(16384|a.Mc),d=a.getContext();a.Ga(this.Za[0]);var e=!(this.children[0]instanceof ji);e&&(c=c.concat(36864),Rg(a,c));a.ha.push({});for(var f=!1,g=0;g<this.children.length;)if(a.Va=b+c.length,this.children[g]instanceof ji){for(var h=[],m=!1;g<this.children.length&&this.children[g]instanceof ji;){if(null!=this.children[g].u){var k=this.children[g].u.K(a);if(!(k instanceof eh))throw'non-constant expression in "case" '+S(this.children[g].head);
h.push(k.n)}else m=!0;g++}m?e&&(Sg(a,c),e=!1):(1===h.length?(f&&(c=c.concat(36869)),e&&Sg(a,c),c=c.concat(12288|a.Mc).concat(Qh(h[0])).concat(40960|Ig.indexOf("eq"),0)):(f&&(c=c.concat(36864|4*h.length+1)),e&&Sg(a,c),h.forEach(function(b,d){c=c.concat(12288|a.Mc).concat(Qh(b)).concat(40960|Ig.indexOf("ne"),4*(h.length-d)-1)}),c=c.concat(36864)),Rg(a,c),e=!0);f=!0}else c=c.concat(this.children[g].A(a)),f=!(this.children[g]instanceof ti)&&!(this.children[g]instanceof si),g++;Ai(c,-1,c.length,this.label);
a.ha.pop();a.Ga(d);return c};function ji(a,b){X.call(this,a);this.u=b}ji.prototype=Object.create(X.prototype);ji.prototype.constructor=ji;ji.prototype.A=function(){throw(this.u?'"case"':'"default"')+" outside switch "+S(this.head);};function ui(a,b){X.call(this,a);this.label=b}ui.prototype=Object.create(X.prototype);ui.prototype.constructor=ui;ui.prototype.A=function(a){a.label=this.label;xi(a.labels,this.label).Eh=a.Va;return[]};function ki(a,b){X.call(this,a);this.label=b}ki.prototype=Object.create(X.prototype);
ki.prototype.constructor=ki;function Ci(a,b,c){th.call(this,a,b);this.labels=c}Ci.prototype=Object.create(th.prototype);Ci.prototype.constructor=Ci;Ci.prototype.A=function(a){var b=xi(this.labels,this.ya.label);if(null===b)throw'unknown label "'+this.ya.label+'" '+S(this.ya.head);return 36864|b.Eh-a&4095};ki.prototype.A=function(a){return[new Ci(a,this,a.labels.slice())]};function ri(a,b){X.call(this,a,3);this.Jf=b}ri.prototype=Object.create(X.prototype);ri.prototype.constructor=ri;
ri.prototype.K=function(a){dh(this.children,a);return this};ri.prototype.A=function(a,b){if(b){b=a.getContext();sh(this,a);a.Ga(this.Za[0]);var c=V.prototype.A.call(this,a).concat(0);a.Ga(b);return c}return[]};function hi(a,b,c,d){X.call(this,a,3);this.ng=b;this.resultType=c;this.D=d}hi.prototype=Object.create(X.prototype);hi.prototype.constructor=hi;hi.prototype.mh=function(a){a.Y=this.resultType};hi.prototype.K=function(a){dh(this.children,a);return this};
hi.prototype.A=function(a,b){if(b){b=a.getContext();sh(this,a);a.Ga(this.Za[0]);var c=V.prototype.A.call(this,a).concat(57344);a.Ga(b);return c}return[]};function si(a,b){X.call(this,a);b&&this.children.push(b)}si.prototype=Object.create(X.prototype);si.prototype.constructor=si;
si.prototype.re=function(a){if(a.Y===ch)throw'"return" outside function definition '+S(this.head);if("v"===a.Y&&0<this.children.length)throw"unexpected return value in void function "+S(this.head);if("v"!==a.Y&&0===this.children.length)throw"missing return value in non-void function "+S(this.head);0<this.children.length&&(this.children[0]=$h(this.children[0],a.Y,a).K(a))};
si.prototype.A=function(a){sh(this,a);var b=[];0<this.children.length&&(b=this.children[0].A(a).concat(a.Xa(this.children[0].resultType,a.Y)).concat(16384|a.Mc));return b.concat(57344)};var Cg=[{name:"abs",xd:1,Aa:function(a,b){return b[0]},gf:function(){return!0},Rb:function(a,b,c,d){return[12288|d,28673]}},{name:"atan2",xd:2,Le:1,Aa:function(){return hh},gf:function(a){return null!=Ng(a,"math.atan2")},Rb:function(a,b,c,d){return(c[0]===hh&&c[1]!==hh?[12288|d+1,4096|a.Cb,32772,16384|d+1]:c[0]!==hh&&c[1]===hh?[12288|d,4096|a.Cb,32772,16384|d]:[]).concat([4097,4096|d+1,4096|d,4096|d+2,49152|Ng(b,"math.atan2").id,12288|d+2,4096|Math.floor(32768/(a.Cb*Math.PI)),32773])}},{name:"cos",
xd:1,Le:1,Aa:function(){return hh},gf:function(a){return null!=Ng(a,"math.cos")},Rb:function(a,b,c,d){return[12288|d,4096|Math.round(32767/((c[0]===hh?a.Cb:1)*Math.PI)),32772,16384|d,4097,4096|d,4096|d+1,49152|Ng(b,"math.cos").id,12288|d+1,4096|Math.floor(32768/a.Cb),32773]}},Vh("rand","math.rand",0),{name:"random",xd:0,Le:1,Aa:function(){return hh},gf:function(a){return null!=Ng(a,"math.rand")},Rb:function(a,b,c,d){return[4097,4096|d,49152|Ng(b,"math.rand").id,12288|d,28673,4096|Math.floor(32768/
a.Cb),32773]}},{name:"stop",xd:0,Aa:function(){return"v"},Rb:function(){return[0]}},{name:"sin",xd:1,Le:1,Aa:function(){return hh},gf:function(a){return null!=Ng(a,"math.sin")},Rb:function(a,b,c,d){return[12288|d,4096|Math.round(32767/((c[0]===hh?a.Cb:1)*Math.PI)),32772,16384|d,4097,4096|d,4096|d+1,49152|Ng(b,"math.sin").id,12288|d+1,4096|Math.floor(32768/a.Cb),32773]}},{name:"sqrt",xd:1,Le:6,Aa:function(){return hh},Rb:function(a,b,c,d){b=Qh(c[0]===hh?a.Cb:a.Cb*a.Cb);return[4096|a.Cb,16384|d+1,4106,
16384|d+2,12288|d,16384|d+4].concat(b).concat([16384|d+5,12288|d+1,16384|d+6,4097,4096|d+6,4096|d+5,4096|d+4,4096|d+3,49152|Ng(a.Ba,"math.muldiv").id,12288|d+3,12288|d+1,32770,4098,32773,16384|d+1,12288|d+2,4097,32771,16384|d+2,12288|d+2,4096,40960|Ig.indexOf("le"),-(23+b.length)&65535,12288|d+1])}}];var wb={name:"thymio-II",maxVarSize:620,variables:[{name:"_id",size:1},{name:"event.source",size:1},{name:"event.args",size:32},{name:"_fwversion",size:2},{name:"_productId",size:1},{name:"buttons._raw",size:5},{name:"button.backward",size:1},{name:"button.left",size:1},{name:"button.center",size:1},{name:"button.forward",size:1},{name:"button.right",size:1},{name:"buttons._mean",size:5},{name:"buttons._noise",size:5},{name:"prox.horizontal",size:7},{name:"prox.comm.rx._payloads",size:7},{name:"prox.comm.rx._intensities",
size:7},{name:"prox.comm.rx",size:1},{name:"prox.comm.tx",size:1},{name:"prox.ground.ambiant",size:2},{name:"prox.ground.reflected",size:2},{name:"prox.ground.delta",size:2},{name:"motor.left.target",size:1},{name:"motor.right.target",size:1},{name:"_vbat",size:2},{name:"_imot",size:2},{name:"motor.left.speed",size:1},{name:"motor.right.speed",size:1},{name:"motor.left.pwm",size:1},{name:"motor.right.pwm",size:1},{name:"_integrator",size:2},{name:"acc",size:3},{name:"leds.top",size:3},{name:"leds.bottom.left",
size:3},{name:"leds.bottom.right",size:3},{name:"leds.circle",size:8},{name:"temperature",size:1},{name:"rc5.address",size:1},{name:"rc5.command",size:1},{name:"mic.intensity",size:1},{name:"mic.threshold",size:1},{name:"mic._mean",size:1},{name:"timer.period",size:2},{name:"acc._tap",size:1},{name:"sd.present",size:1}],localEvents:[{name:"button.backward"},{name:"button.left"},{name:"button.center"},{name:"button.forward"},{name:"button.right"},{name:"buttons"},{name:"prox"},{name:"prox.comm"},{name:"tap"},
{name:"acc"},{name:"mic"},{name:"sound.finished"},{name:"temperature"},{name:"rc5"},{name:"motor"},{name:"timer0"},{name:"timer1"}],nativeFunctions:[{name:"_system_reboot",args:[]},{name:"_system_settings_read",args:[1,1]},{name:"_system_settings_write",args:[1,1]},{name:"_system_settings_flash",args:[]},{name:"math.copy",args:[-1,-1]},{name:"math.fill",args:[-1,1]},{name:"math.addscalar",args:[-1,-1,1]},{name:"math.add",args:[-1,-1,-1]},{name:"math.sub",args:[-1,-1,-1]},{name:"math.mul",args:[-1,
-1,-1]},{name:"math.div",args:[-1,-1,-1]},{name:"math.min",args:[-1,-1,-1]},{name:"math.max",args:[-1,-1,-1]},{name:"math.clamp",args:[-1,-1,-1,-1]},{name:"math.dot",args:[1,-1,-1,1]},{name:"math.stat",args:[-1,1,1,1]},{name:"math.argbounds",args:[-1,1,1]},{name:"math.sort",args:[-1]},{name:"math.muldiv",args:[-1,-1,-1,-1]},{name:"math.atan2",args:[-1,-1,-1]},{name:"math.sin",args:[-1,-1]},{name:"math.cos",args:[-1,-1]},{name:"math.rot2",args:[2,2,1]},{name:"math.sqrt",args:[-1,-1]},{name:"math.rand",
args:[-1]},{name:"_leds.set",args:[1,1]},{name:"sound.record",args:[1]},{name:"sound.play",args:[1]},{name:"sound.replay",args:[1]},{name:"sound.system",args:[1]},{name:"leds.circle",args:[1,1,1,1,1,1,1,1]},{name:"leds.top",args:[1,1,1]},{name:"leds.bottom.left",args:[1,1,1]},{name:"leds.bottom.right",args:[1,1,1]},{name:"sound.freq",args:[1,1]},{name:"leds.buttons",args:[1,1,1,1]},{name:"leds.prox.h",args:[1,1,1,1,1,1,1,1]},{name:"leds.prox.v",args:[1,1]},{name:"leds.rc",args:[1]},{name:"leds.sound",
args:[1]},{name:"leds.temperature",args:[1,1]},{name:"sound.wave",args:[142]},{name:"prox.comm.enable",args:[1]},{name:"sd.open",args:[1,1]},{name:"sd.write",args:[-1,1]},{name:"sd.read",args:[-1,1]},{name:"sd.seek",args:[1,1]},{name:"_rf.nodeid",args:[1]},{name:"_poweroff",args:[]}]};function Eg(a,b){this.Ba=a;this.b=b}function Di(a){var b={};a.Ba.La.forEach(function(a){b[a.name]=a.offset});b._userdata=a.Ba.Wa;b._topdata=a.Ba.b;b["_ev.init"]=65535;a.Ba.Kc.forEach(function(a,d){b["_ev."+a.name]=65534-d});a.Ba.Pb.forEach(function(a){b["_nf."+a.name]=a.id});return b}
function Dg(a){for(var b=a.b.split("\n"),c=[],d=Di(a),e=0;2>e;e++){c=[];var f=null;b.forEach(function(a,b){var g=/^\s*(;.*)?$/.exec(a);if(!g)if(g=/^\s*([\w_.]+:)\s*(;.*)?$/i.exec(a))f=g[1].slice(0,-1),d[f]=c.length;else if(g=/^\s*([\w_.]+:)?\s*([a-z0-9.]+)([-+a-z0-9\s._,=]*)(;.*)?$/i.exec(a)){if(g[1]&&(f=g[1].slice(0,-1),d[f]=c.length),a=g[2],g=g[3].trim(),a){var h=0<g.length?g.split(",").map(function(a){return a.trim().split(/\s+/)}):[];h=[].concat.apply([],h);g=Ei[a];if(void 0==g)throw'Unknown instruction "'+
a+'" (line '+(b+1).toString(10)+")";if(-1!==g.$b&&(g.$b||0)!=h.length)throw"Wrong number of arguments (line "+(b+1).toString(10)+")";void 0!==g.code?c=c.concat(g.code):g.Wb&&(a=h.map(function(a){/^[a-z]+=/.test(a)&&(a=a.replace(/^[a-z]+=/,""));return/^(0x[0-9a-f]+|[0-9]+)$/i.test(a)?parseInt(a,0):a}),c=c.concat(g.Wb(c.length,a,f,d,e,b+1)));f&&d[f]!==c.length&&(f=null)}}else throw"Syntax error (line "+(b+1).toString(10)+")";},a)}return c}
function Fi(a,b,c,d){function e(e){if(!c)return 0;if(/^(0x[0-9a-f]+|[0-9]+)$/i.test(e))return parseInt(e,0);if(!b.hasOwnProperty(e))throw'Unknown symbol "'+a+'" (line '+d.toString(10)+")";return b[e]}if("string"===typeof a){for(var f=0,g=!1,h=0;h<a.length;){var m=/^(\+|-|[._a-z0-9]+)/i.exec(a.slice(h));if(null==m)throw"Syntax error (line "+d.toString(10)+")";switch(m[0]){case "+":g=!1;break;case "-":g=!0;break;default:f+=g?-e(m[0]):e(m[0])}h+=m[0].length}return f}return a}
var Ei={dc:{$b:-1,Wb:function(a,b,c,d,e,f){return b.map(function(a){a=Fi(a,d,1===e,f);return a&65535})}},equ:{$b:1,Wb:function(a,b,c,d,e,f){if(!c)throw'No label for pseudo-instruction "equ" (line '+f.toString(10)+")";d&&(d[c]=Fi(b[0],d,1===e,f));return[]}},stop:{code:[0]},"push.s":{$b:1,Wb:function(a,b,c,d,e,f){a=Fi(b[0],d,1===e,f);if(2048<=a||2048<-a)throw"Small integer overflow (line "+f.toString(10)+")";return[4096|a&4095]}},push:{$b:1,Wb:function(a,b,c,d,e,f){a=Fi(b[0],d,1===e,f);if(32768<=a||
32768<-a)throw"Integer overflow (line "+f.toString(10)+")";return[8192,a&65535]}},load:{$b:1,Wb:function(a,b,c,d,e,f){a=Fi(b[0],d,1===e,f);if(0>a||4096<=a)throw"Data address out of range (line "+f.toString(10)+")";return[12288|a&4095]}},store:{$b:1,Wb:function(a,b,c,d,e,f){a=Fi(b[0],d,1===e,f);if(0>a||4096<=a)throw"Data address out of range (line "+f.toString(10)+")";return[16384|a&4095]}},"load.ind":{$b:2,Wb:function(a,b,c,d,e,f){a=Fi(b[0],d,1===e,f);if(0>a||4096<=a)throw"Data address out of range (line "+
f.toString(10)+")";b=Fi(b[1],d,1===e,f);if(0>b||65536<=b)throw"Array size overflow (line "+f.toString(10)+")";return[20480|a&4095,b&65535]}},"store.ind":{$b:2,Wb:function(a,b,c,d,e,f){a=Fi(b[0],d,1===e,f);if(0>a||4096<=a)throw"Data address out of range (line "+f.toString(10)+")";b=Fi(b[1],d,1===e,f);if(0>b||65536<=b)throw"Array size overflow (line "+f.toString(10)+")";return[24576|a&4095,b&65535]}},neg:{code:[28672]},abs:{code:[28673]},bitnot:{code:[28674]},not:{Wb:function(a,b,c,d,e,f){throw"Unary not not implemented in the VM (line "+
f.toString(10)+")";}},sl:{code:[32768]},asr:{code:[32769]},add:{code:[32770]},sub:{code:[32771]},mult:{code:[32772]},div:{code:[32773]},mod:{code:[32774]},bitor:{code:[32775]},bitxor:{code:[32776]},bitand:{code:[32777]},eq:{code:[32778]},ne:{code:[32779]},gt:{code:[32780]},ge:{code:[32781]},lt:{code:[32782]},le:{code:[32783]},or:{code:[32784]},and:{code:[32785]},jump:{$b:1,Wb:function(a,b,c,d,e,f){b=Fi(b[0],d,1===e,f);if(2048<=b-a||2048<a-b)throw"Jump too far (line "+f.toString(10)+")";return[36864|
b-a&4095]}},"jump.if.not":{$b:2,Wb:function(a,b,c,d,e,f){c=Ei[b[0]];if(void 0==c||void 0==c.code||1!==c.code.length||32768!==(c.code[0]&61440))throw'Unknown op "'+b[0]+'" for jump.if.not (line '+f.toString(10)+")";b=Fi(b[1],d,1===e,f);if(32768<=b-a||32768<a-b)throw"Jump too far (line "+f.toString(10)+")";return[40960|c.code[0]&255,b-a&65535]}},"do.jump.when.not":{$b:2,Wb:function(a,b,c,d,e,f){c=Ei[b[0]];if(void 0==c||void 0==c.code||1!==c.code.length||32768!==(c.code[0]&61440))throw'Unknown op "'+
b[0]+'" for do.jump.when.not (line '+f.toString(10)+")";b=Fi(b[1],d,1===e,f);if(32768<=b-a||32768<a-b)throw"Jump too far (line "+f.toString(10)+")";return[41216|c.code[0]&255,b-a&65535]}},"do.jump.always":{$b:2,Wb:function(a,b,c,d,e,f){c=Ei[b[0]];if(void 0==c||void 0==c.code||1!==c.code.length||32768!==(c.code[0]&61440))throw'Unknown op "'+b[0]+'" for do.jump.always (line '+f.toString(10)+")";b=Fi(b[1],d,1===e,f);if(32768<=b-a||32768<a-b)throw"Jump too far (line "+f.toString(10)+")";return[41728|
c.code[0]&255,b-a&65535]}},emit:{$b:3,Wb:function(a,b,c,d,e,f){a=Fi(b[0],d,1===e,f);if(0>a||4096<=a)throw"Event id out of range (line "+f.toString(10)+")";c=Fi(b[1],d,1===e,f);if(0>c||65536<=c)throw"Address out of range (line "+f.toString(10)+")";b=Fi(b[2],d,1===e,f);if(0>b||65536<=b)throw"Size out of range (line "+f.toString(10)+")";return[45056|a&4095,c&65535,b&65535]}},callnat:{$b:1,Wb:function(a,b,c,d,e,f){a=Fi(b[0],d,1===e,f);if(0>a||4096<=a)throw"Native call id out of range (line "+f.toString(10)+
")";return[49152|a&4095]}},callsub:{$b:1,Wb:function(a,b,c,d,e,f){a=Fi(b[0],d,1===e,f);if(0>a||4096<=a)throw"Subroutine address out of range (line "+f.toString(10)+")";return[53248|a&4095]}},ret:{code:[57344]}};function Gi(a,b,c){this.id=a;this.u=b;if(c instanceof ArrayBuffer)this.i=c;else if(c){for(a=b=0;a<c.length;a++)b="string"===typeof c[a]?b+(1+c[a].length):b+2;b=new ArrayBuffer(b);for(var d=new DataView(b),e=a=0;a<c.length;a++)if("string"===typeof c[a]){d.setUint8(e++,c[a].length);for(var f=0;f<c[a].length;f++)d.setUint8(e++,c[a].charCodeAt(f))}else 32768>c[a]?d.setInt16(e,c[a],!0):d.setUint16(e,c[a],!0),e+=2;this.i=b}else this.i=new ArrayBuffer(0)}
function Hi(a){function b(a){for(var b=[],d=0,e=0;e<a.length;e++)if(a[e]){for(var f=c.getUint8(d),g="",t=0;t<f;t++)g+=String.fromCharCode(c.getUint8(d+1+t));b.push(g);d+=1+f}else b.push(c.getUint16(d,!0)),d+=2;return b}var c=new DataView(a.i);switch(a.id){case Ii:var d=b([!0,!1,!1,!1,!1,!1,!1,!1]);a.nodeName=d[0];a.Ee=d[2];a.Qe=d[3];a.Gd=d[4];break;case Ji:d=b([!1,!0]);a.Wa=d[0];a.S=d[1];break;case Ki:d=b([!0,!0]);break;case Li:var e=[!0,!0,!1];d=b(e);a.functionName=d[0];a.w=d[2];for(var f=0;f<a.w;f++)e.push(!1),
e.push(!0);d=b(e);a.ka=[];for(f=0;f<a.w;f++)a.ka.push({size:d[3+2*f]-(d[3+2*f]&32768?65536:0),name:d[4+2*f]});break;case Mi:c.getUint16(0,!0);a.Qc=[];for(f=2;f<c.byteLength;f+=2)a.Qc.push(c.getUint16(f,!0));break;case Ni:a.b=c.getUint16(0,!0);f=c.getUint16(2,!0);a.flags={flags:f,ni:0!==(f&1),xi:0!==(f&2),oi:0!==(f&4)};break;case Oi:a.b=c.getUint16(2,!0);a.result=c.getUint16(4,!0);break;case Pi:a.l=c.getUint16(0,!0);c.getUint16(2,!0);d=[];for(f=4;f<c.byteLength;f+=2)d.push(c.getUint16(f,!0));a.ae=
d;break;case Qi:case Ri:case Si:case Ti:case Ui:case Vi:case Wi:a.l=c.getUint16(0,!0);break;case Xi:case Yi:a.l=c.getUint16(0,!0);a.b=c.getUint16(2,!0);break;case Zi:a.l=c.getUint16(0,!0);c.getUint16(2,!0);c.getUint16(4,!0);break;case $i:a.l=c.getUint16(0,!0);c.getUint16(2,!0);d=[];for(f=4;f<c.byteLength;f+=2)d.push(c.getUint16(f,!0));break;case aj:a.version=c.getUint16(0,!0)}}
function bj(a){var b=new ArrayBuffer(6+a.i.byteLength),c=new DataView(b);c.setUint16(0,a.i.byteLength,!0);c.setUint16(2,a.u,!0);c.setUint16(4,a.id,!0);(new Uint8Array(b)).set(new Uint8Array(a.i),6);return b}Gi.prototype.qb=function(){var a=new Gi(this.id,this.u,this.i);Hi(a);return a};Gi.prototype.toString=function(){var a=cj[this.id]||"0x"+this.id.toString(16);a+=" from "+this.u.toString(10);0<=this.l&&(a+=" to "+this.l.toString());return a};
var Ii=36864,Ji=36865,Ki=36866,Li=36867,Mi=36869,Ni=36874,Oi=36875,Pi=40961,Ri=40962,Si=40963,Ti=40964,Ui=40965,Vi=40966,Wi=40967,Xi=40968,Yi=40969,Qi=40970,Zi=40971,$i=40972,aj=40977,cj={36864:"description",36865:"namedVariableDescription",36866:"localEventDescription",36867:"nativeFunctionDescription",36869:"variables",36874:"executionStateChanged",36876:"nodePresent",40960:"getDescription",40961:"setBytecode",40962:"reset",40963:"run",40964:"pause",40965:"step",40966:"stop",40967:"getExecutionState",
40968:"breakpointSet",40969:"breakpointClear",40970:"breakpointClearAll",40971:"getVariables",40972:"setVariables",40976:"getNodeDescription",40977:"listNodes"};function dj(a){this.oe=a&&a.oe||54321;this.La=a&&a.La||[];this.Kc=a&&a.Kc||[];this.Pb=a&&a.Pb||[];this.Ee=a&&a.Ee||500;this.Qe=a&&a.Qe||200;this.Gd=a&&a.Gd||200;a=[];for(var b=0,c=0;c<this.La.length;c++)this.La[c].offset=b,a=a.concat(this.La[c].$),b+=this.La[c].$.length;for(;a.length<this.Gd;)a.push(0);this.Qc=a;this.P=[];this.b=0;this.i=!1;this.l=!0;this.u=!1;this.stack=[];this.S=[];this.write=this.w=this.G=null}
dj.prototype.qb=function(){var a=new dj({oe:this.oe,La:this.La,Kc:this.Kc,Pb:this.Pb,Ee:this.Ee,Qe:this.Qe,Gd:this.Gd});a.Ee=this.Ee;a.Qe=this.Qe;a.Gd=this.Gd;a.P=this.P.slice();a.b=this.b;a.i=this.i;a.l=this.l;a.u=this.u;a.stack=this.stack.slice();a.S=this.S.slice();return a};
function ej(a,b,c){if(a.G)for(var d=0;d<a.La.length;d++)if(a.La[d].offset+a.La[d].$.length>b&&a.La[d].offset<b+c.length)for(var e=0;e<a.La[d].$.length;e++)0<=a.La[d].offset+e-b&&a.La[d].offset+e-b<c.length&&a.G(a.La[d].name,e,c[a.La[d].offset+e-b],a.Qc[a.La[d].offset+e],a.Qc.slice(a.La[d].offset,a.La[d].offset+a.La[d].$.length));c.forEach(function(a,c){this.Qc[b+c]=a},a)}
function fj(a,b){a:{if(0<a.P.length)for(var c=1;c<a.P[0];c+=2)if(a.P[c]==b){b=a.P[c+1];break a}b=null}null!==b&&(a.i&&(c=new Gi(36872,a.oe,[a.b]),a.write&&a.write(bj(c))),a.b=b,a.i=!0)}function gj(a){a.i=!1;a.l=!0;a.u=!1;if(0<a.P.length)for(var b=a.P[0];b<a.P.length;){var c=a.P[b];10==c>>>12&&(a.P[b]&=-513);b+=[1,1,2,1,1,2,2,1,1,1,2,3,1,1,1,1][c>>>12]}a.stack=[];for(b=0;b<a.Qc.length;b++)a.Qc[b]=0;a.Y&&a.Y();fj(a,65535)}
function hj(a){function b(a){return 32768<=a?a-65536:a}function c(a){switch(a){case 28672:d.stack.push(-d.stack.pop());break;case 28673:d.stack.push(Math.abs(d.stack.pop()));break;case 28674:d.stack.push(~d.stack.pop());break;case 32768:a=d.stack.pop();d.stack.push(b(d.stack.pop()<<a&65535));break;case 32769:a=d.stack.pop();d.stack.push(d.stack.pop()>>a);break;case 32770:d.stack.push(b(d.stack.pop()+d.stack.pop()&65535));break;case 32771:a=d.stack.pop();d.stack.push(b(d.stack.pop()-a&65535));break;
case 32772:d.stack.push(b(d.stack.pop()*d.stack.pop()&65535));break;case 32773:a=d.stack.pop();d.stack.push(b(Math.trunc(d.stack.pop()/a)&65535));break;case 32774:a=d.stack.pop();d.stack.push(b(d.stack.pop()%a&65535));break;case 32775:d.stack.push(b((d.stack.pop()|d.stack.pop())&65535));break;case 32776:d.stack.push(b((d.stack.pop()^d.stack.pop())&65535));break;case 32777:d.stack.push(b(d.stack.pop()&d.stack.pop()&65535));break;case 32778:d.stack.push(d.stack.pop()===d.stack.pop()?1:0);break;case 32779:d.stack.push(d.stack.pop()!==
d.stack.pop()?1:0);break;case 32780:a=d.stack.pop();d.stack.push(d.stack.pop()>a?1:0);break;case 32781:a=d.stack.pop();d.stack.push(d.stack.pop()>=a?1:0);break;case 32782:a=d.stack.pop();d.stack.push(d.stack.pop()<a?1:0);break;case 32783:a=d.stack.pop();d.stack.push(d.stack.pop()<=a?1:0);break;case 32784:a=d.stack.pop();d.stack.push(d.stack.pop()||a?1:0);break;case 32785:a=d.stack.pop();d.stack.push(d.stack.pop()&&a?1:0);break;default:throw"unknown op 0x"+a.toString(16);}}var d=a,e=a.P[a.b],f=e&4095;
switch(e>>>12){case 0:a.i=!1;break;case 1:a.stack.push(2048<=f?f-4096:f);break;case 2:a.b++;a.stack.push(b(a.P[a.b]));break;case 3:a.stack.push(a.Qc[f]);break;case 4:ej(a,f,[a.stack.pop()]);break;case 5:a.b++;e=a.P[a.b];var g=a.stack.pop();if(g>=e)throw"out of bounds";a.stack.push(a.Qc[f+g]);break;case 6:a.b++;e=a.P[a.b];g=a.stack.pop();if(g>=e)throw"Index out of bounds";ej(a,f+g,[a.stack.pop()]);break;case 9:a.b+=(2048<=f?f-4096:f)-1;break;case 10:var h=e&256;c(32768|e&255);f=0!=a.stack.pop();a.b++;
g=b(a.P[a.b]);if(h){h=a.b-1;if(e&512||!f)a.b+=g-2;a.P[h]=f?a.P[h]|512:a.P[h]&-513}else f||(a.b+=g-2);break;case 11:null(f);break;case 12:if(0>f||f>=a.Pb.length)throw"Native call index out of bounds";var m=a.Pb[f].ka.map(function(){return{p:this.stack.pop()}},a),k=[];a.Pb[f].ka.forEach(function(a,b){m[b].vh=0===a.size?this.stack.pop():a.size},a);a.Pb[f].ka.forEach(function(a){0>a.size&&void 0===k[-a.size]&&(k[-a.size]=0)},a);k=k.map(function(a){return void 0!==a?this.stack.pop():a},a);a.Pb[f].ka.forEach(function(a,
b){0>a.size&&(m[b].vh=k[-a.size])},a);var p=m.map(function(a){return this.Qc.slice(a.p,a.p+a.vh)},a);e=!1;a.w&&(e=a.w(a.Pb[f].name,a,p));e||a.Pb[f].Ja(a,p);m.forEach(function(a,b){ej(this,a.p,p[b])},a);break;case 13:a.stack.push(a.b+1);a.b=f-1;break;case 14:a.b=a.stack.pop()-1;break;case 15:throw"op 0x"+e.toString(16)+" (reserved) not implemented";default:c(e)}a.b++}dj.prototype.mc=function(){for(;this.i&&(hj(this),!this.l););};function Fg(a){function b(a){a&=65535;return 32768<=a?a-65536:a}dj.call(this,{oe:a,La:[{name:"_id",$:[0]},{name:"event.source",$:[0]},{name:"event.args",$:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{name:"_fwversion",$:[0,0]},{name:"_productId",$:[0]},{name:"buttons._raw",$:[0,0,0,0,0]},{name:"button.backward",$:[0]},{name:"button.left",$:[0]},{name:"button.center",$:[0]},{name:"button.forward",$:[0]},{name:"button.right",$:[0]},{name:"buttons._mean",$:[0,0,0,0,0]},{name:"buttons._noise",
$:[0,0,0,0,0]},{name:"prox.horizontal",$:[0,0,0,0,0,0,0]},{name:"prox.comm.rx._payloads",$:[0,0,0,0,0,0,0]},{name:"prox.comm.rx._intensities",$:[0,0,0,0,0,0,0]},{name:"prox.comm.rx",$:[0]},{name:"prox.comm.tx",$:[0]},{name:"prox.ground.ambiant",$:[0,0]},{name:"prox.ground.reflected",$:[0,0]},{name:"prox.ground.delta",$:[0,0]},{name:"motor.left.target",$:[0]},{name:"motor.right.target",$:[0]},{name:"_vbat",$:[0,0]},{name:"_imot",$:[0,0]},{name:"motor.left.speed",$:[0]},{name:"motor.right.speed",$:[0]},
{name:"motor.left.pwm",$:[0]},{name:"motor.right.pwm",$:[0]},{name:"_integrator",$:[0,0]},{name:"acc",$:[0,0,0]},{name:"leds.top",$:[0,0,0]},{name:"leds.bottom.left",$:[0,0,0]},{name:"leds.bottom.right",$:[0,0,0]},{name:"leds.circle",$:[0,0,0,0,0,0,0,0]},{name:"temperature",$:[0]},{name:"rc5.address",$:[0]},{name:"rc5.command",$:[0]},{name:"mic.intensity",$:[0]},{name:"mic.threshold",$:[0]},{name:"mic._mean",$:[0]},{name:"timer.period",$:[0,0]},{name:"acc._tap",$:[0]},{name:"sd.present",$:[0]}],Kc:[{name:"button.backward",
description:"Backward button state changed"},{name:"button.left",description:"Left button state changed"},{name:"button.center",description:"Center button state changed"},{name:"button.forward",description:"Forward button state changed"},{name:"button.right",description:"Right button state changed"},{name:"buttons",description:"Buttons values updated"},{name:"prox",description:"Proximity values updated"},{name:"prox.comm",description:"Data received on the proximity communication"},{name:"tap",description:"Tap detected"},
{name:"acc",description:"Accelerometer values updated"},{name:"mic",description:"Microphone above threshold"},{name:"sound.finished",description:"Sound playback finished"},{name:"temperature",description:"Temperature value updated"},{name:"rc5",description:"RC5 message received"},{name:"motor",description:"Motor timer"},{name:"timer0",description:"Timer 0"},{name:"timer1",description:"Timer 1"}],Pb:[{name:"_system_reboot",ka:[],Ja:function(){}},{name:"_system_settings_read",ka:[],Ja:function(){}},
{name:"_system_settings_write",ka:[],Ja:function(){}},{name:"_system_settings_flash",ka:[],Ja:function(){}},{name:"math.copy",ka:[],Ja:function(a,b){for(a=0;a<b[0].length;a++)b[0][a]=b[1][a]}},{name:"math.fill",ka:[],Ja:function(a,b){for(a=0;a<b[0].length;a++)b[0][a]=b[1][0]}},{name:"math.addscalar",ka:[{name:"r",size:-1},{name:"a",size:-1},{name:"b",size:1}],Ja:function(a,d){for(a=0;a<d[0].length;a++)d[0][a]=b(d[1][a]+d[2][0])}},{name:"math.add",ka:[{name:"r",size:-1},{name:"a",size:-1},{name:"b",
size:-1}],Ja:function(a,d){for(a=0;a<d[0].length;a++)d[0][a]=b(d[1][a]+d[2][a])}},{name:"math.sub",ka:[{name:"r",size:-1},{name:"a",size:-1},{name:"b",size:-1}],Ja:function(a,d){for(a=0;a<d[0].length;a++)d[0][a]=b(d[1][a]-d[2][a])}},{name:"math.mul",ka:[{name:"r",size:-1},{name:"a",size:-1},{name:"b",size:-1}],Ja:function(a,d){for(a=0;a<d[0].length;a++)d[0][a]=b(d[1][a]*d[2][a])}},{name:"math.div",ka:[{name:"r",size:-1},{name:"a",size:-1},{name:"b",size:-1}],Ja:function(a,d){for(a=0;a<d[0].length;a++)d[0][a]=
b(Math.trunc(d[1][a]/d[2][a]))}},{name:"math.min",ka:[{name:"r",size:-1},{name:"a",size:-1},{name:"b",size:-1}],Ja:function(a,b){for(a=0;a<b[0].length;a++)b[0][a]=Math.min(b[1][a],b[2][a])}},{name:"math.max",ka:[{name:"r",size:-1},{name:"a",size:-1},{name:"b",size:-1}],Ja:function(a,b){for(a=0;a<b[0].length;a++)b[0][a]=Math.max(b[1][a],b[2][a])}},{name:"math.clamp",ka:[{name:"r",size:-1},{name:"x",size:-1},{name:"low",size:-1},{name:"high",size:-1}],Ja:function(a,b){for(a=0;a<b[0].length;a++)b[0][a]=
Math.min(Math.max(b[1][a],b[2][a]),b[3][a])}},{name:"math.dot",ka:[{name:"r",size:-1},{name:"a",size:-1},{name:"b",size:-1},{name:"shift",size:1}],Ja:function(a,b){for(var c=a=0;c<b[0].length;c++)a+=b[1][c]*b[2][c];b[0][0]=a/Math.pow(2,b[3][0])}},{name:"math.stat",ka:[{name:"x",size:-1},{name:"min",size:1},{name:"max",size:1},{name:"mean",size:1}],Ja:function(a,b){a=0;b[1][0]=32767;b[2][0]=-32768;for(var c=0;c<b[0].length;c++)b[1][0]=Math.min(b[1][0],b[0][c]),b[2][0]=Math.max(b[2][0],b[0][c]),a+=
b[0][c];b[3][0]=a/b[0].length}},{name:"math.argbounds",ka:[{name:"x",size:-1},{name:"argmin",size:1},{name:"argmax",size:1}],Ja:function(a,b){a=-Infinity;for(var c=Infinity,d=0;d<b[0].length;d++)b[0][d]<c&&(c=b[0][d],b[1][0]=d),b[0][d]>a&&(a=b[0][d],b[2][0]=d)}},{name:"math.sort",ka:[{name:"x",size:-1}],Ja:function(a,b){b[0].sort(function(a,b){return a-b})}},{name:"math.muldiv",ka:[{name:"r",size:-1},{name:"a",size:-1},{name:"b",size:-1},{name:"c",size:-1}],Ja:function(a,d){for(a=0;a<d[0].length;a++)d[0][a]=
b(d[1][a]*d[2][a]/d[3][a])}},{name:"math.atan2",description:"Atan2",ka:[{name:"r",size:-1},{name:"y",size:-1},{name:"x",size:-1}],Ja:function(a,b){b[2].forEach(function(a,c){b[0][c]=Math.round(32767*Math.atan2(b[1][c],a)/Math.PI)})}},{name:"math.sin",description:"Sine",ka:[{name:"r",size:-1},{name:"theta",size:-1}],Ja:function(a,b){b[1].forEach(function(a,c){b[0][c]=Math.round(32767*Math.sin(a*Math.PI/32768))})}},{name:"math.cos",description:"Cosine",ka:[{name:"r",size:-1},{name:"theta",size:-1}],
Ja:function(a,b){b[1].forEach(function(a,c){b[0][c]=Math.round(32767*Math.cos(a*Math.PI/32768))})}},{name:"math.rot2",ka:[{name:"r",size:2},{name:"v",size:2},{name:"theta",size:1}]},{name:"math.sqrt",description:"Square root",ka:[{name:"r",size:-1},{name:"x",size:-1}],Ja:function(a,b){b[1].forEach(function(a,c){b[0][c]=0<a?Math.floor(Math.sqrt(a)):0})}},{name:"math.rand",description:"Pseudo-random number",ka:[{name:"r",size:-1}],Ja:function(a,b){for(a=0;a<b[0].length;a++)b[0][a]=Math.floor(65535.9999*
Math.random())-32768}},{name:"_leds.set",ka:[{name:"led",size:1},{name:"br",size:1}],Ja:function(){}},{name:"sound.record",ka:[{name:"n",size:1}],Ja:function(){}},{name:"sound.play",ka:[{name:"n",size:1}],Ja:function(){}},{name:"sound.replay",ka:[{name:"n",size:1}],Ja:function(){}},{name:"sound.system",description:"Start playing system sound",ka:[{name:"n",size:1}],Ja:function(){}},{name:"leds.circle",description:"Set circular leds",ka:[{name:"l0",size:1},{name:"l1",size:1},{name:"l2",size:1},{name:"l3",
size:1},{name:"l4",size:1},{name:"l5",size:1},{name:"l6",size:1},{name:"l7",size:1}],Ja:function(a,b){a.state["leds.circle"]=b.map(function(a){return a[0]});a.yd&&a.yd("leds.circle")}},{name:"leds.top",description:"Set top RGB led",ka:[{name:"r",size:1},{name:"g",size:1},{name:"b",size:1}],Ja:function(a,b){a.state["leds.top"]=b.map(function(a){return a[0]});a.yd&&a.yd("leds.top")}},{name:"leds.bottom.left",description:"Set bottom-left RGB led",ka:[{name:"r",size:1},{name:"g",size:1},{name:"b",size:1}],
Ja:function(a,b){a.state["leds.bottom.left"]=b.map(function(a){return a[0]});a.yd&&a.yd("leds.bottom.left")}},{name:"leds.bottom.right",description:"Set bottom-right RGB led",ka:[{name:"r",size:1},{name:"g",size:1},{name:"b",size:1}],Ja:function(a,b){a.state["leds.bottom.right"]=b.map(function(a){return a[0]});a.yd&&a.yd("leds.bottom.right")}},{name:"sound.freq",description:"Play frequency",ka:[{name:"Hz",size:1},{name:"ds",size:1}],Ja:function(a,b){console.info(b)}},{name:"leds.buttons",description:"Set buttons leds",
ka:[{name:"led 0",size:1},{name:"led 1",size:1},{name:"led 2",size:1},{name:"led 3",size:1}]},{name:"leds.prox.h",description:"Set horizontal proximity leds",ka:[{name:"led 0",size:1},{name:"led 1",size:1},{name:"led 2",size:1},{name:"led 3",size:1},{name:"led 4",size:1},{name:"led 5",size:1},{name:"led 6",size:1},{name:"led 7",size:1}]},{name:"leds.prox.v",description:"Set vertical proximity leds",ka:[{name:"led 0",size:1},{name:"led 1",size:1}]},{name:"leds.rc",description:"Set rc led",ka:[{name:"led",
size:1}]},{name:"leds.sound",description:"Set sound led",ka:[{name:"led",size:1}]},{name:"leds.temperature",description:"Set ntc led",ka:[{name:"red",size:1},{name:"blue",size:1}]},{name:"sound.wave",description:"Set the primary wave of the tone generator",ka:[{name:"wave",size:142}],Ja:function(){}},{name:"prox.comm.enable",description:"Enable or disable the proximity communication",ka:[{name:"state",size:1}]},{name:"sd.open",description:"Open a file on the SD card",ka:[{name:"number",size:1},{name:"status",
size:1}]},{name:"sd.write",description:"Write data to the opened file",ka:[{name:"data",size:-1},{name:"written",size:1}]},{name:"sd.read",description:"Read data from the opened file",ka:[{name:"data",size:-1},{name:"read",size:1}]},{name:"sd.seek",description:"Seek the opened file",ka:[{name:"position",size:1},{name:"status",size:1}]},{name:"_rf.nodeid"},{name:"_poweroff"}],Gd:620});this.state={};this.yd=null}Fg.prototype=Object.create(dj.prototype);Fg.prototype.constructor=Fg;function ij(){P.call(this);this.Ab=!0;this.w=new Fg(9999);var a=this;this.w.yd=function(b){a.S[b]&&a.S[b](b,a.w.state[b])};this.w.G=function(b,c,d,e,f){switch(b){case "leds.circle":e=f.slice();e[c]=d;a.S[b]&&a.S[b](b,e);break;case "timer.period":a.setTimer(c,"timer"+c.toString(10),.001*d,!0)}};this.w.w=function(b,c,d){switch(b){case "sound.play":return a.S.sound("sound",{pcm:d[0][0]}),!0}return!1};this.Ba=new vb(wb)}ij.prototype=Object.create(P.prototype);ij.prototype.constructor=ij;
ij.prototype.reset=function(a){P.prototype.reset.call(this,a);gj(this.w);this.setTimer(20,"prox",.1,!0);this.setTimer(21,"acc",.0625,!0);this.setTimer(22,"buttons",.05,!0);this.setTimer(23,"temperature",1,!0)};function jj(a,b){b=Og(a.Ba,b);return null==b?null:a.w.Qc.slice(b.offset,b.offset+b.size)}function kj(a,b,c){var d=Og(a.Ba,b);if(null==d)throw"Unknown VM variable "+b;if(c.length!==d.size)throw"Bad size for variable "+b;Array.prototype.splice.apply(a.w.Qc,[d.offset,d.size].concat(c))}
ij.prototype.set=function(a,b){if(this.Ab){P.prototype.set.call(this,a,b);switch(a){case "button.backward":case "button.left":case "button.center":case "button.forward":case "button.right":kj(this,a,[b?1:0]);break;case "prox.ground.delta":kj(this,"prox.ground.delta",b.map(function(a){return 2E3*a}));break;case "prox.horizontal":kj(this,"prox.horizontal",b.map(function(a){return 4E3*a}));break;case "acc":kj(this,"acc",b.map(function(a){return 22*a}));break;default:throw"Unknown variable "+a;}this.S[a]&&
this.S[a](a,b)}else P.prototype.set.call(this,a,b)};
ij.prototype.get=function(a){if(this.Ab)switch(a){case "leds.top":return jj(this,"leds.top").map(function(a){return 32<=a?1:0>=a?0:a/32});case "leds.bottom.left":return jj(this,"leds.bottom.left").map(function(a){return 32<=a?1:0>=a?0:a/32});case "leds.bottom.right":return jj(this,"leds.bottom.right").map(function(a){return 32<=a?1:0>=a?0:a/32});case "leds.circle":return jj(this,"leds.circle").map(function(a){return 16<=a?1:0});case "motor.left":return jj(this,"motor.left.target")[0]/200;case "motor.right":return jj(this,
"motor.right.target")[0]/200;default:return P.prototype.get.call(this,a)}else return P.prototype.get.call(this,a)};ij.prototype.sendEvent=function(a,b){if(this.Ab){if(null!=b)throw"Event arguments not implemented";a=Pg(this.Ba,a);fj(this.w,a);lj(this)}else P.prototype.sendEvent.call(this,a,b)};
ij.prototype.loadCode=function(a,b){"js"===a?(P.prototype.loadCode.call(this,a,b),this.Ab=!1):("asm"===a?(b=new Eg(this.Ba,b),b=Dg(b)):(b=(a=zi(b))?new Bg(this.Ba,b):new xb(this.Ba,b),b.S=a?Cg:yb,b=zb(b)),a=this.w,a.P.splice.apply(a.P,[0,b.length].concat(b)),gj(this.w),lj(this),this.Ab=!0)};function lj(a){for(var b=0;2E3>b&&a.w.i;b++)hj(a.w)};function ng(a,b){a.i=new Kb(a.Rc,{ia:a.ia});a.i.Xa=function(){null!==a.ha&&(a.ha=null,mj(a))};var c=null;return new dg({mc:function(b,e){var d=a.M;d.la.loadCode(b,e);null!==c&&clearInterval(c);d.la.start(nj());c=setInterval(function(){d.la.run(nj(),function(a,b){oj(d,a,b)})},10);d.la.Oc=d.paused;mj(a)},yc:function(){var c=new ij;c=new pj(a.i,c);b&&b.Sg&&ve(a.i,b.Sg);b&&b.Tg&&(a.i.transform=b.Tg);a.M=c},getName:function(){return"Simulator"},$c:"js",languages:["js","aseba","l2","asm"]})};function qj(){this.b=[]}qj.prototype.add=function(a){this.b.push(a)};qj.prototype.L=function(a){this.b.forEach(function(b){b.L(a)})};function rj(){}rj.prototype.b=function(){throw"internal";};rj.prototype.L=function(){};function sj(a,b,c){this.x=a;this.y=b;this.i=c}sj.prototype=Object.create(rj.prototype);sj.prototype.constructor=sj;
sj.prototype.b=function(a,b,c){for(var d=Infinity,e=this.x.length,f=0;f<(this.i?this.x.length:this.x.length-1);f++){var g=this.x[(f+1)%e],h=this.y[(f+1)%e],m=[Math.cos(c),g-this.x[f],Math.sin(c),h-this.y[f]];g=[g-a,h-b];h=m[0]*m[3]-m[1]*m[2];m=[(m[3]*g[0]-m[1]*g[1])/h,(m[0]*g[1]-m[2]*g[0])/h];d=Math.min(d,0<=m[1]&&1>=m[1]&&0<m[0]?m[0]:Infinity)}return d};
sj.prototype.L=function(a){a.save();a.beginPath();a.moveTo(this.x[0],this.y[0]);for(var b=1;b<this.x.length;b++)a.lineTo(this.x[b],this.y[b]);this.i&&a.closePath();a.stroke();a.restore()};function tj(a,b,c){this.x=a;this.y=b;this.r=c}tj.prototype=Object.create(rj.prototype);tj.prototype.constructor=tj;
tj.prototype.b=function(a,b,c){var d=(this.x-a)*Math.cos(c)+(this.y-b)*Math.sin(c);a=(a-this.x)*Math.sin(c)+(this.y-b)*Math.cos(c);a=this.r*this.r-a*a;if(0>a)return Infinity;a=Math.sqrt(a);return 0>d+a?Infinity:0>d-a?d+a:d-a};tj.prototype.L=function(a){a.save();a.beginPath();a.arc(this.x,this.y,this.r,0,2*Math.PI);a.stroke();a.restore()};function uj(a,b){this.width=a;this.height=b}
function pj(a,b){var c=this;this.W=new Ca;this.la=b;this.S=this.Vf=this.paused=this.Pe=!1;this.Hc=vj;this.b=new uj(10*this.la.pb,7.07*this.la.pb);b=this.la.pb;this.la.setPositionLimits(-this.b.width/2+b,this.b.width/2-b,-this.b.height/2+b,this.b.height/2-b);this.Ff=this.sc=null;this.i=document.createElement("canvas");this.u=document.createElement("canvas");this.pg=!1;this.Gf=this.Mb=null;this.l=document.createElement("canvas");this.w=new qj;this.He=!1;this.Hf=this.Y=null;wj(this);this.la.Xa=function(){xj(c);
yj(c);zj(c)};this.G=a;this.G.state={};this.ha=!1}var vj="ground";pj.prototype.Ne=function(){this.W.b=[]};function Aj(a){var b=a.u.getContext("2d");b.filter="blur("+(a.u.width/300).toFixed(1)+"px)";b.fillStyle="white";b.fillRect(0,0,a.u.width,a.u.height);b.drawImage(a.i,0,0)}
function Bj(a){var b=a.M;if(b.sc){b.i.width=b.sc.width;b.i.height=b.sc.height;var c=b.i.getContext("2d");c.fillStyle="white";c.fillRect(0,0,b.sc.width,b.sc.height);c.drawImage(b.sc,0,0,b.sc.width,b.sc.height)}else b.i.width=b.G?b.G.width:800,b.i.height=b.i.width*b.b.height/b.b.width,c=b.i.getContext("2d"),c.fillStyle="white",c.fillRect(0,0,b.i.width,b.i.height);b.u.width=b.i.width;b.u.height=b.i.height;b.pg=!1;Aj(b);nc(a)}
function oj(a,b,c){if(a.Vf){var d=a.i.getContext("2d");d.save();d.translate(a.i.width/2,a.i.height/2);d.scale(a.i.width/a.b.width,-a.i.height/a.b.height);d.beginPath();switch(b){case "l":d.moveTo(c[0],c[1]);d.lineTo(c[2],c[3]);break;case "a":d.arc(c[0],c[1],Math.abs(c[2]),c[3],c[4],0>c[2])}d.strokeStyle="#060";d.lineCap="round";d.lineWidth=.1*a.la.pb;d.stroke();d.restore();a.pg=!0;Aj(a)}}
function wj(a){a.w.b=[];a.w.add(new sj([-a.b.width/2,a.b.width/2,a.b.width/2,-a.b.width/2],[-a.b.height/2,-a.b.height/2,a.b.height/2,a.b.height/2],!0))}
function Cj(a,b){var c=a.M;wj(c);if(c.Y=b){var d=new kf(b),e=c.b.width/d.C[2],f=-c.b.width*(.5+d.C[0]/d.C[2]),g=-c.b.height/d.C[3],h=c.b.height*(.5+d.C[1]/d.C[3]);d.L(null,{Ea:{line:function(a,b,d){c.w.add(new sj(a.map(function(a){return f+e*a}),b.map(function(a){return h+g*a}),d))},Cf:function(a,b,d){c.w.add(new tj(f+e*a,h+g*b,(e-g)/2*d))}}})}c.He=null!=b;yj(c);nc(a)}
function Dj(a,b,c){b=Math.round(a.u.width*(b+a.b.width/2)/a.b.width);c=Math.round(a.u.height*(a.b.height/2-c)/a.b.height);return a.u.getContext("2d").getImageData(b,c,1,1).data[0]/255}function Ej(a,b,c){if(null==a.Mb)return 0;b=Math.round(a.l.width*(b+a.b.width/2)/a.b.width);c=Math.round(a.l.height*(a.b.height/2-c)/a.b.height);a=a.l.getContext("2d").getImageData(b,c,1,1).data;return-(a[0]+a[1]+a[2])/765}
function xj(a){for(var b=[],c=0;2>c;c++)b.push(Dj(a,a.la.b[0]+a.la.ec*Math.cos(a.la.i)+(0===c?-1:1)*a.la.Ld*Math.sin(a.la.i),a.la.b[1]+a.la.ec*Math.sin(a.la.i)-(0===c?-1:1)*a.la.Ld*Math.cos(a.la.i))+Hg(a.la,.05));a.la.set("prox.ground.delta",b)}
function yj(a){var b=Math.cos(a.la.i),c=Math.sin(a.la.i),d=[{Ud:70,Td:60,jb:.7},{Ud:85,Td:30,jb:.35},{Ud:95,Td:0,jb:0},{Ud:85,Td:-30,jb:-.35},{Ud:70,Td:-60,jb:-.7},{Ud:-25,Td:35,jb:2.8},{Ud:-25,Td:-35,jb:-2.8}].map(function(a){var d=this.w,e=this.la.b[0]+a.Ud*b-a.Td*c,h=this.la.b[1]+a.Ud*c+a.Td*b;a=this.la.i+a.jb;for(var m=Infinity,k=0;k<d.b.length;k++)m=Math.min(m,d.b[k].b(e,h,a));d=m+Hg(this.la,.01*this.la.r);return 100>d?1:300<d?0:(d-300)*(d-300)/4E4},a);a.la.set("prox.horizontal",d)}
function zj(a){for(var b=[0,0,a.la.r],c=[-a.la.r,a.la.r,0],d=[],e=0;3>e;e++)d.push(Ej(a,a.la.b[0]+b[e]*Math.cos(a.la.i)+c[e]*Math.sin(a.la.i),a.la.b[1]+b[e]*Math.sin(a.la.i)-c[e]*Math.cos(a.la.i)));b=200*(d[1]-d[0])/(2*a.la.r);d=200*(d[2]-(d[0]+d[1])/2)/a.la.ec;a.la.set("acc",[b+Hg(a.la,.02),d+Hg(a.la,.02),Math.sqrt(1-b*b-d*d)+Hg(a.la,.02)])}
function gg(a,b,c){switch(c||a.M.Hc){case vj:a.M.Ff=null==b?a.M.sc:null;a.M.sc=b;Bj(a);xj(a.M);nc(a);break;case "height":a.M.Gf=null==b?a.M.Mb:null,c=a.M,c.Mb=b,c.Mb?(c.l.width=c.Mb.width,c.l.height=c.Mb.height,b=c.l.getContext("2d"),b.fillStyle="white",b.fillRect(0,0,c.Mb.width,c.Mb.height),b.drawImage(c.Mb,0,0,c.Mb.width,c.Mb.height)):(c.l.width=1,c.l.height=1),zj(c),nc(a)}}function fg(a,b,c){switch(c||a.M.Hc){case "obstacle":a.M.Hf=null==b?a.M.Y:null,Cj(a,b)}}
Hb.prototype.start=function(a){this.M.paused=a;this.M.Pe=!a;nc(this)};function Fj(a){a=[a[0],Math.max(.2+.8*a[1],a[2]/2),a[2]];var b=Math.max(a[0],Math.max(a[1],a[2]));return"rgb("+a.map(function(a){return Math.round(225*(1-b)+(30+225*b)*a)}).join(",")+")"}function Gj(a){return function(b){a.ha!==b&&(a.ha=b,mj(a))}}function Rf(a,b,c,d,e){var f=new Fc(a.i);Wc(f,a,b,["sim","top"],a.M.Zd||cc,a.M.Se||Rc);Hc(f,c,e,d);return f}
function nc(a){function b(a){return function(){d.ha!==a&&(d.ha=a,mj(d))}}function c(a,b,c,d){var f=(e.Se||Rc)(a,g.B);c=Math.min(c.width/(f.oa-f.Z),c.height/(f.pa-f.ba));b.save();b.translate(-f.Z,-f.ba);b.scale(c,c);(e.Zd||cc)(a,b,g.B,g.ia,["sim","event"],null,!0,!1,d);b.restore()}var d=a,e=a.M,f=e.la,g=a.i;if(g.S){e.ha||(e.ha=!0,e.resize(a),Bj(a));g.mb=[];var h=e.Fg||a.Ab,m=gc(a,h,["sim","top"]),k=Yc(m),p=Cd(g);Bd(g);var n=M(g.ia,{tag:"view",ea:["sim"]}),t=M(g.ia,{tag:"button",ea:["sim","event"]}),
q=M(g.ia,{tag:"sim-controller"}),l=M(g.ia,{tag:"separator",id:"sim-controller-separator"}),v=M(g.ia,{tag:"separator",ea:["sim","top"]}),r=M(g.ia,{tag:"toolbar",ea:["sim","top"]}),E=M(g.ia,{tag:"sim-playground-area"}),u=M(g.ia,{tag:"sim-playground"});n.Nc(p.width);n.Bc(p.height);n.setPosition(0,0);var w=Math.max(t.width,t.height);q.width=3*L(t);q.Bc(n.height);q.setPosition(n.x+n.width-L(q),n.y);r.Nc(n.width-L(q));r.height=k;r.setPosition(n.x,n.y);E.Nc(n.width-L(q));E.Bc(n.height-r.qa());E.setPosition(n.x,
n.y+r.qa());Jc(g,function(a){n.L(a)});Ic(Rf(a,h,r,v,m),r,m,Gj(a));Jc(g,function(a){q.L(a)});h=[];m=q.y+t.offsetTop();h.push(Lc(g,q.x+L(t)+t.offsetLeft(),m,t,function(a,b,d){c("sim-event:forward",a,b,d)},{ee:function(){f.set("button.forward",!0);f.sendEvent("button.forward",null)},fe:function(){f.set("button.forward",!1);f.sendEvent("button.forward",null)},vc:b("sim:btn-button.forward")},"button.forward"));m+=t.qa();h.push(Lc(g,q.x+t.offsetLeft(),m,t,function(a,b,d){c("sim-event:left",a,b,d)},{ee:function(){f.set("button.left",
!0);f.sendEvent("button.left",null)},fe:function(){f.set("button.left",!1);f.sendEvent("button.left",null)},vc:b("sim:btn-button.left")},"button.left"));h.push(Lc(g,q.x+L(t)+t.offsetLeft(),m,t,function(a,b,d){c("sim-event:center",a,b,d)},{ee:function(){f.set("button.center",!0);f.sendEvent("button.center",null)},fe:function(){f.set("button.center",!1);f.sendEvent("button.center",null)},vc:b("sim:btn-button.center")},"button.center"));h.push(Lc(g,q.x+2*L(t)+t.offsetLeft(),m,t,function(a,b,d){c("sim-event:right",
a,b,d)},{ee:function(){f.set("button.center",!0);f.sendEvent("button.center",null)},fe:function(){f.set("button.center",!1);f.sendEvent("button.center",null)},vc:b("sim:btn-button.right")},"button.right"));m+=t.qa();h.push(Lc(g,q.x+L(t)+t.offsetLeft(),m,t,function(a,b,d){c("sim-event:backward",a,b,d)},{ee:function(){f.set("button.backward",!0);f.sendEvent("button.backward",null)},fe:function(){f.set("button.backward",!1);f.sendEvent("button.backward",null)},vc:b("sim:btn-button.backward")},"button.backward"));
m+=t.qa()+l.qa();h.push(Lc(g,q.x+.5*L(t)+t.offsetLeft(),m,t,function(a,b,d){c("sim-event:tap",a,b,d)},{action:function(){f.sendEvent("tap",null)},vc:b("sim:btn-tap")},"tap"));h.push(Lc(g,q.x+1.5*L(t)+t.offsetLeft(),m,t,function(a,b,d){c("sim-event:clap",a,b,d)},{action:function(){f.sendEvent("mic",null)},vc:b("sim:btn-clap")},"clap"));m+=2*w;var D=q.x+1.5*L(t),R=m+3.5*w;h.push(Jc(g,function(a){function b(b,c,d,e,f,g){function h(b,c){a.beginPath();a.arc(0,0,b,0,2*Math.PI);a.fillStyle=c;a.fill()}a.save();
a.translate(b,c);h(d,g||"#222");h(.95*d,f||"#bbb");h(.95*d*e,g||"#222");a.restore()}a.save();a.beginPath();a.moveTo(D-1.2*w,R);a.lineTo(D-1.2*w,R-1.8*w);a.bezierCurveTo(D-.72*w,R-2.4*w,D-.05*w,R-2.4*w,D,R-2.4*w);a.bezierCurveTo(D+.05*w,R-2.4*w,D+.72*w,R-2.4*w,D+1.2*w,R-1.8*w);a.lineTo(D+1.2*w,R);a.closePath();a.lineWidth=2;a.strokeStyle="black";a.stroke();var c=f.get("prox.ground.delta");b(D-.45*w,R-1.8*w,.4*w,c[0],"#afa","#060");b(D+.45*w,R-1.8*w,.4*w,c[1],"#9f9","#060");c=f.get("prox.horizontal");
b(D-1.45*w,R-2.3*w,.4*w,c[0],"#fcc","#d00");b(D-.8*w,R-2.8*w,.4*w,c[1],"#fcc","#d00");b(D,R-3*w,.4*w,c[2],"#fcc","#d00");b(D+.8*w,R-2.8*w,.4*w,c[3],"#fcc","#d00");b(D+1.45*w,R-2.3*w,.4*w,c[4],"#fcc","#d00");b(D-.8*w,R+.5*w,.4*w,c[5],"#fcc","#d00");b(D+.8*w,R+.5*w,.4*w,c[6],"#fcc","#d00");a.restore()}));var Q=m+=5*w;h.push(Jc(g,function(a){function b(b,c,d,e){e=Math.max(-1,Math.min(1,e));a.save();a.translate(b,c);a.beginPath();a.arc(0,0,d,0,2*Math.PI);a.fillStyle="#ccc";a.fill();a.beginPath();a.moveTo(0,
0);a.lineTo(d*Math.sin(3*e),-d*Math.cos(3*e));a.lineWidth=Math.max(d/6,1);a.strokeStyle="black";a.stroke();a.restore()}a.save();a.fillStyle="black";a.fillRect(D-1.15*w,Q+.5*w,.3*w,.6*w);a.fillRect(D+.85*w,Q+.5*w,.3*w,.6*w);a.fillStyle=Fj(f.get("leds.top"));a.fillRect(D-1.2*w,Q,2.4*w,.5*w);a.fillStyle=Fj(f.get("leds.bottom.left"));a.fillRect(D-1.2*w,Q+.5*w,1.2*w,.5*w);a.fillStyle=Fj(f.get("leds.bottom.right"));a.fillRect(D,Q+.5*w,1.2*w,.5*w);a.lineWidth=1;a.beginPath();a.moveTo(D-1.2*w,Q+.5*w);a.lineTo(D+
1.2*w,Q+.5*w);a.moveTo(D,Q+.5*w);a.lineTo(D,Q+w);a.strokeStyle="white";a.stroke();a.lineJoin="round";a.strokeStyle="black";a.strokeRect(D-1.2*w,Q,2.4*w,w);b(D-1.7*w,Q+w,.4*w,f.get("motor.left")/2);b(D+1.7*w,Q+w,.4*w,f.get("motor.right")/2);a.restore()}));m+=1.5*w;if(null!=e.Mb){var Fa=m+1.5*w;h.push(Jc(g,function(a){var b=f.get("acc");b=[Math.atan2(b[0],b[1]),Math.atan2(b[1],b[2]),Math.atan2(b[0],b[2])];a.save();a.strokeStyle="black";a.lineWidth=.7*g.B.va;for(var c=0;3>c;c++){a.save();a.translate(D+
(c-1)*w,Fa);a.save();a.strokeStyle="silver";a.beginPath();a.moveTo(-.4*w,0);a.lineTo(.4*w,0);a.moveTo(0,-.4*w);a.lineTo(0,.4*w);a.stroke();a.restore();a.rotate(-b[c]);switch(c){case 0:var d=.25*w;a.translate(0,1.2*d);a.beginPath();a.moveTo(-1.2*d,0);a.lineTo(-1.2*d,-1.8*d);a.bezierCurveTo(-.72*d,-2.4*d,-.05*d,-2.4*d,0,-2.4*d);a.bezierCurveTo(.05*d,-2.4*d,.72*d,-2.4*d,1.2*d,-1.8*d);a.lineTo(1.2*d,0);a.closePath();a.lineWidth=2;a.strokeStyle="black";a.stroke();break;case 1:a.strokeRect(-.4*w,-.15*w,
.8*w,.3*w);a.beginPath();a.arc(-.2*w,.05*w,.15*w,0,2*Math.PI);a.fillStyle="white";a.fill();a.lineWidth=.07*w;a.stroke();break;case 2:a.strokeRect(-.4*w,-.15*w,.8*w,.3*w),a.fillStyle="black",a.fillRect(-.35*w,.15*w,.15*w,.08*w),a.fillRect(.2*w,.15*w,.15*w,.08*w)}a.restore()}a.restore()}));m+=2.5*w}if(f.Rc){var oa=m+2*w;h.push(Jc(g,function(a){for(var b=f.get("leds.circle"),c=0;8>c;c++)Oe(a,D,oa,.9*w,1.2*w,Math.PI*(.44-.25*c),Math.PI*(.56-.25*c),b[c]?"#fa0":"white","black",g.B.va)}));m+=3.5*w}var xa=
m+1.5*w,ja=f.getTimer(0);0<=ja?(h.push(Jc(g,function(a){g.state.Re?"lin"===g.state.Re&&4<ja&&(g.state.Re="log"):g.state.Re=4<ja?"log":"lin";Le(a,D,xa,w,g.B.va,function(b){a.textAlign="start";a.textBaseline="top";a.font=(w/2).toFixed(1)+"px sans-serif";a.fillStyle="black";a.fillText(b.toFixed(1),q.x,xa-w)},Math.min(ja,"log"===g.state.Re?9.9:3.95),!1,"log"===g.state.Re)})),m+=2.5*w):g.state.Re=!1;var T=Math.min((E.y-q.y+q.y+q.height-m)/2,q.y+q.height-m);0<T&&h.forEach(function(a){a.y+=T});var O=E.x,
ya=E.y,Oa=E.width,A=E.height;var U=Math.min(Oa/e.b.width,A/e.b.height);t=(Oa-e.b.width*U)/2;l=(A-e.b.height*U)/2;u.width=e.b.width*U;u.height=e.b.height*U;u.x=O+t;u.y=ya+l;if(a.W.cc){var N=M(g.ia,{tag:"widget",id:"vpl-customize"});Jc(g,function(){td(g,"vpl:customize",O+Oa/2,ya+A/2,N)})}else{var K=f.pb,Ma=!1;t=new ed(null,e.b.width*U,e.b.height*U,O+t,ya+l,function(a,b,c,h){a=a.O;a.save();E.L(a);u.L(a);if(null===d.pd)switch(e.Hc){case vj:a.drawImage(e.i,b.x+c,b.y+h,b.width,b.height);break;case "height":null!=
e.Mb&&a.drawImage(e.l,b.x+c,b.y+h,b.width,b.height);break;case "obstacle":a.save(),a.translate(b.x+c+b.width/2,b.y+h+b.height/2),a.scale(U,-U),e.w.L(a),a.restore()}else a.drawImage(e.i,b.x+c,b.y+h,b.width,b.height),null!=e.Mb&&(a.save(),a.globalAlpha=.5,a.drawImage(e.l,b.x+c,b.y+h,b.width,b.height),a.restore()),e.He&&(a.save(),a.translate(b.x+c+b.width/2,b.y+h+b.height/2),a.scale(U,-U),e.w.L(a),a.restore());a.translate(b.x+c+b.width/2,b.y+h+b.height/2);a.scale(U,U);a.translate(f.b[0],-f.b[1]);a.rotate(.5*
Math.PI-f.i);a.beginPath();a.moveTo(0,.2*K);a.lineTo(.5*K,.2*K);a.lineTo(.5*K,-.55*K);a.bezierCurveTo(.3*K,-.8*K,.02*K,-.8*K,0,-.8*K);a.bezierCurveTo(-.02*K,-.8*K,-.3*K,-.8*K,-.5*K,-.55*K);a.lineTo(-.5*K,.2*K);a.closePath();a.fillStyle=Fj(f.get("leds.top"));a.strokeStyle="black";a.lineJoin="round";a.lineWidth=2;a.moveTo(.05*K,0);a.arc(0,0,.05*K,0,2*Math.PI);a.fill();a.stroke();if(!e.Pe||e.paused)a.beginPath(),a.arc(0,0,K,0,2*Math.PI),a.strokeStyle=g.state.fh?"navy":"#3cf",a.lineWidth=.1*K,a.stroke(),
a.beginPath(),a.arc(0,-K,.15*K,0,2*Math.PI),a.fillStyle=g.state.ug?"navy":"white",a.strokeStyle=g.state.ug?"navy":"#3cf",a.lineWidth=.06*K,a.fill(),a.stroke();a.restore()},{fa:function(a,b,c,d,h,k,l){a=(l.x-h-c/2)/U;d=(d/2-(l.y-k))/U;k=a-f.b[0];l=d-f.b[1];b=K*Math.cos(f.i);c=K*Math.sin(f.i);return(!e.Pe||e.paused)&&(k-b)*(k-b)+(l-c)*(l-c)<.1*K*K?(g.state.x=a,g.state.y=d,g.state.ug=!0,1):k*k+l*l<K*K?(e.paused?Ma=!1:(f.suspend(),Ma=!0),g.state.x=a,g.state.y=d,g.state.fh=!0,0):null},Oa:function(a,b,
c,d,h,k,l,m){a=(m.x-k-d/2)/U;h=(h/2-(m.y-l))/U;switch(c){case 0:c=f.b;f.setPosition([f.b[0]+a-g.state.x,f.b[1]+h-g.state.y],f.i);oj(e,"l",[c[0],c[1],f.b[0],f.b[1]]);break;case 1:f.setPosition(f.b,f.i+(Math.atan2(h-f.b[1],a-f.b[0])-Math.atan2(g.state.y-f.b[1],g.state.x-f.b[0])))}g.state.x=a;g.state.y=h},Yc:function(){g.state.fh=!1;g.state.ug=!1;Ma&&f.resume(nj())}});t.l=!1;kd(g,t)}a.ha&&Jc(g,function(a){var b=M(g.ia,{tag:"hint"});a.fillStyle=b.color;a.font=Nc(b);a.textAlign="start";a.textBaseline=
"middle";var c=d.l.translate(d.ha);b.width=a.measureText(c).width;b.height=1.2*b.fontSize;Kc(b,a,b.marginLeft,p.height-b.qa()+b.marginTop,!0);a.fillText(c,b.offsetLeft(),p.height-b.qa()+b.offsetTop()+b.height/2)});J(g);!e.paused&&f.shouldRunContinuously()&&mj(a)}}function mj(a){a.M.S||(a.M.S=!0,window.requestAnimationFrame(function(){a.M.S=!1;nc(a)}))}function nj(){return.001*(new Date).getTime()}
pj.prototype.resize=function(a){var b=window.innerWidth,c=window.innerHeight;window.vplDisableResize&&(c=this.G.b.getBoundingClientRect(),b=c.width,c=c.height);this.G.B=this.G.B;this.G.resize(b,c);nc(a)};function zg(a){a.I.add("sim:close",{action:function(a){a.ob(["sim"],{Ef:!0})},object:a,aa:function(a){return 1<a.Ia.length&&0<=a.Ia.indexOf("sim")}});a.I.add("sim:restart",{action:function(a){Bj(a);a.M.la.reset(nj());a.M.la.start();a.M.Pe=!0;a.M.paused=!1;nc(a)},object:a});a.I.add("sim:pause",{action:function(a){a.M.Pe&&(a.M.paused=!a.M.paused,a.M.paused?a.M.la.suspend():(a.M.la.resume(nj()),nc(a)))},isEnabled:function(a){return a.M.Pe},Na:function(a){return a.M.paused},object:a,kb:[{selected:!1},
{selected:!0}]});a.I.add("sim:speedup",{action:function(a){var b=[.5,1,2,5,10];a.M.la.Xd=b[(b.indexOf(a.M.la.Xd)+1)%b.length]},Na:function(a){return 1!==a.M.la.Xd},getState:function(a){return a.M.la.Xd},object:a,kb:[{selected:!1,state:1},{selected:!0,state:.5},{selected:!0,state:2},{selected:!0,state:5},{selected:!0,state:10}]});a.I.add("sim:noise",{action:function(a){a.M.la.Pf=!a.M.la.Pf},Na:function(a){return a.M.la.Pf},object:a,kb:[{selected:!1},{selected:!0}]});a.I.add("sim:pen",{action:function(a){a.M.Vf=
!a.M.Vf},Na:function(a){return a.M.Vf},object:a,kb:[{selected:!1},{selected:!0}]});a.I.add("sim:clear",{action:function(a){Bj(a)},isEnabled:function(a){return a.M.pg},object:a});a.I.add("sim:map-kind",{action:function(a){switch(a.M.Hc){case vj:a.M.Hc="height";break;case "height":a.M.Hc="obstacle";break;case "obstacle":a.M.Hc=vj}},getState:function(a){switch(a.M.Hc){case vj:return"ground";case "height":return"height";case "obstacle":return"obstacles";default:return"ground"}},object:a,kb:[{state:"ground"},
{state:"height"},{state:"obstacles"}],aa:function(a){return null===a.pd}});a.I.add("sim:map",{action:function(a){switch(a.M.Hc){case vj:gg(a,null==a.M.sc?a.M.Ff:null);break;case "height":gg(a,null==a.M.Mb?a.M.Gf:null);break;case "obstacle":fg(a,a.M.He?null:a.M.Hf)}},Na:function(a){switch(a.M.Hc){case vj:return null!=a.M.sc;case "height":return null!=a.M.Mb;case "obstacle":return a.M.He}throw"internal";},getState:function(a){switch(a.M.Hc){case vj:return"ground";case "height":return"height";case "obstacle":return"obstacles";
default:return"ground"}},object:a,kb:[{selected:!1,state:"ground"},{selected:!1,state:"height"},{selected:!1,state:"obstacles"},{selected:!0,state:"ground"},{selected:!0,state:"height"},{selected:!0,state:"obstacles"}],aa:function(a){return null===a.pd}});a.I.add("sim:map-ground",{action:function(a,c){c?a.Ke.show("Open ground image file",".gif,.png,.jpg,.svg",function(b){var c=new window.FileReader;c.onload=function(b){b=b.target.result;var c=new Image;c.addEventListener("load",function(){gg(a,c,
vj)});c.src=b};c.readAsDataURL(b)}):gg(a,null==a.M.sc?a.M.Ff:null,vj)},Na:function(a){return null!=a.M.sc},object:a,kb:[{selected:!1},{selected:!0}],aa:function(a){return a.pd&&0<=a.pd.indexOf("ground")}});a.I.add("sim:map-height",{action:function(a,c){c?a.Ke.show("Open height image file",".gif,.png,.jpg,.svg",function(b){var c=new window.FileReader;c.onload=function(b){b=b.target.result;var c=new Image;c.addEventListener("load",function(){gg(a,c,"height")});c.src=b};c.readAsDataURL(b)}):gg(a,null==
a.M.Mb?a.M.Gf:null,"height")},Na:function(a){return null!=a.M.Mb},object:a,kb:[{selected:!1},{selected:!0}],aa:function(a){return a.pd&&0<=a.pd.indexOf("height")}});a.I.add("sim:map-obstacles",{action:function(a,c){c?a.Ke.show("Open obstacle SVG file",".svg",function(b){var c=new window.FileReader;c.onload=function(b){fg(a,b.target.result,"obstacle")};c.readAsText(b)}):fg(a,a.M.He?null:a.M.Hf,"obstacle")},Na:function(a){return a.M.He},object:a,kb:[{selected:!1},{selected:!0}],aa:function(a){return a.pd&&
0<=a.pd.indexOf("obstacles")}});a.I.add("sim:vpl",{action:function(a){a.me?a.ob(["vpl"],{pe:!0}):a.ob(["vpl"],{ke:"sim"})},isEnabled:function(a){return null==a.N||Xf(a.N)},object:a,aa:function(a){return(null==a.N||!a.N.ra)&&0>a.Ia.indexOf("vpl")}});a.I.add("sim:text",{action:function(a){a.me?a.ob(["src"],{pe:!0,Jg:!a.N.fd}):a.ob(["src"],{ke:"sim",Jg:!a.N.fd})},object:a,aa:function(a){return 0>a.Ia.indexOf("src")}});a.I.add("sim:teacher-reset",{action:function(a){a.M.Ne();nc(a)},object:a,hd:!0,aa:function(a){return a.M.Vb&&
a.M.W.cc}});a.I.add("sim:teacher",{action:function(a){a.M.W.cc=!a.M.W.cc;nc(a)},Na:function(a){return a.M.W.cc},object:a,hd:!0,aa:function(a){return a.M.Vb},kb:[{selected:!1},{selected:!0}]})};function lg(a,b){return new dg({mc:function(b,d){a.Fa[a.na].Pa.state.b(d)},yc:function(){try{var c=(b?b.Gh:wg("asebahttp"))||("http:"!==document.location.origin.slice(0,5)?"http://127.0.0.1:3000":document.location.origin);ka(c,function(){a.Fa[a.na].Pa.state=ea[0];xe(a.ga)})}catch(d){console.info(d),xe(a.ga)}},isConnected:function(){return null!=a.Fa[a.na].Pa.state},isEnabled:function(b){return"aseba"===b&&null!=a.Fa[a.na].Pa.state},getName:function(){return"Thymio (HTTP)"},$c:"aseba",languages:["aseba",
"l2"],state:null})};function mg(a,b){var c=null;void 0==b&&(b={qc:wg("w"),jh:wg("pass")||"",Bh:wg("uuid")||"auto"});return new dg({mc:function(a,b){c.run(b,null,function(a){console.info("Run error");console.info(a)})},check:function(a,b,f){c.check(b,function(){f(null)},function(a){f(a)});return null},yc:function(){try{c=new window.TDM(b.qc,{password:b.jh||"",uuid:b.Bh||"auto",change:function(b){a.Fa[a.na].Pa.state=b?{}:null;xe(a.ga)}})}catch(d){console.info(d),xe(a.ga)}},close:function(){c.close()},isConnected:function(){return null!=
a.Fa[a.na].Pa.state&&c.isConnected()},isEnabled:function(b){return"aseba"===b&&null!=a.Fa[a.na].Pa.state&&c.canRun()},getName:function(){return"Thymio (TDM)"},Lf:function(a,b){c.flash(b)},ef:function(b){return"aseba"===b&&null!=a.Fa[a.na].Pa.state&&c.canRun()},$c:"aseba",languages:["aseba"],state:null,ka:b})};function Hj(a){this.u=a||"ws://127.0.0.1:8002/";this.l={};this.i=this.b=null}Hj.prototype.connect=function(){this.rc=new WebSocket(this.u);var a=this;this.rc.addEventListener("open",function(){a.rc.send(JSON.stringify({type:"nodes"}))});this.rc.addEventListener("message",function(b){try{var c=JSON.parse(b.data);switch(c.type){case "connect":if(c.id){var d=c.id;a.l[d]=c;a.b&&a.b(d,c.descr)}break;case "disconnect":d=c.id,delete a.l[d],a.i&&a.i(d)}}catch(e){}})};
Hj.prototype.mc=function(a,b){this.rc.send(JSON.stringify({type:"run",id:a,bc:b}))};function yg(a){var b=null,c=wg("uuid")||null;c&&(c=c.replace(/^\{(.*)\}$/,"$1"));var d=null;return new dg({mc:function(a,f){switch(a){case "aseba":a=new xb(d,f);a.S=yb;var e=zb(a);break;case "l2":a=new xb(d,f);a.S=Cg;e=zb(a);break;case "asm":a=new Eg(d,f),e=Dg(a)}b.mc(c,e)},yc:function(){try{var e=wg("w")||("http:"!==document.location.origin.slice(0,5)?"ws://127.0.0.1:8002":document.location.origin.replace(/^http/,"ws"));b=new Hj(e);b.b=function(b,e){if(null==c||b===c)d=new vb(e),a.Fa[a.na].Pa.state=
{},xe(a.ga)};b.i=function(b){if(null==c||b===c)a.Fa[a.na].Pa.state=null,xe(a.ga)};b.connect()}catch(f){console.info(f),xe(a.ga)}},isConnected:function(){return null!=a.Fa[a.na].Pa.state},isEnabled:function(b){return("aseba"===b||"l2"===b||"asm"===b)&&null!=a.Fa[a.na].Pa.state},getName:function(){return"Thymio (JWS)"},$c:"aseba",languages:["aseba","l2","asm"],state:null})};
}).call(this);
